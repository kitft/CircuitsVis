var fQ=Object.create;var Rv=Object.defineProperty;var dQ=Object.getOwnPropertyDescriptor;var mQ=Object.getOwnPropertyNames;var hQ=Object.getPrototypeOf,gQ=Object.prototype.hasOwnProperty;var xQ=(t,e,r)=>e in t?Rv(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var Qe=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),qo=(t,e)=>{for(var r in e)Rv(t,r,{get:e[r],enumerable:!0})},yQ=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of mQ(e))!gQ.call(t,o)&&o!==r&&Rv(t,o,{get:()=>e[o],enumerable:!(n=dQ(e,o))||n.enumerable});return t};var nt=(t,e,r)=>(r=t!=null?fQ(hQ(t)):{},yQ(e||!t||!t.__esModule?Rv(r,"default",{value:t,enumerable:!0}):r,t));var Bt=(t,e,r)=>(xQ(t,typeof e!="symbol"?e+"":e,r),r);var YF=Qe((Vwe,XF)=>{XF.exports=Jt;var ms=null;try{ms=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Jt(t,e,r){this.low=t|0,this.high=e|0,this.unsigned=!!r}Jt.prototype.__isLong__;Object.defineProperty(Jt.prototype,"__isLong__",{value:!0});function ko(t){return(t&&t.__isLong__)===!0}Jt.isLong=ko;var BF={},VF={};function Bp(t,e){var r,n,o;return e?(t>>>=0,(o=0<=t&&t<256)&&(n=VF[t],n)?n:(r=er(t,(t|0)<0?-1:0,!0),o&&(VF[t]=r),r)):(t|=0,(o=-128<=t&&t<128)&&(n=BF[t],n)?n:(r=er(t,t<0?-1:0,!1),o&&(BF[t]=r),r))}Jt.fromInt=Bp;function hs(t,e){if(isNaN(t))return e?zp:gs;if(e){if(t<0)return zp;if(t>=HF)return KF}else{if(t<=-GF)return So;if(t+1>=GF)return jF}return t<0?hs(-t,e).neg():er(t%Cm|0,t/Cm|0,e)}Jt.fromNumber=hs;function er(t,e,r){return new Jt(t,e,r)}Jt.fromBits=er;var o1=Math.pow;function OI(t,e,r){if(t.length===0)throw Error("empty string");if(t==="NaN"||t==="Infinity"||t==="+Infinity"||t==="-Infinity")return gs;if(typeof e=="number"?(r=e,e=!1):e=!!e,r=r||10,r<2||36<r)throw RangeError("radix");var n;if((n=t.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return OI(t.substring(1),e,r).neg();for(var o=hs(o1(r,8)),s=gs,i=0;i<t.length;i+=8){var a=Math.min(8,t.length-i),l=parseInt(t.substring(i,i+a),r);if(a<8){var u=hs(o1(r,a));s=s.mul(u).add(hs(l))}else s=s.mul(o),s=s.add(hs(l))}return s.unsigned=e,s}Jt.fromString=OI;function ni(t,e){return typeof t=="number"?hs(t,e):typeof t=="string"?OI(t,e):er(t.low,t.high,typeof e=="boolean"?e:t.unsigned)}Jt.fromValue=ni;var WF=1<<16,VQ=1<<24,Cm=WF*WF,HF=Cm*Cm,GF=HF/2,UF=Bp(VQ),gs=Bp(0);Jt.ZERO=gs;var zp=Bp(0,!0);Jt.UZERO=zp;var wm=Bp(1);Jt.ONE=wm;var qF=Bp(1,!0);Jt.UONE=qF;var RI=Bp(-1);Jt.NEG_ONE=RI;var jF=er(-1,2147483647,!1);Jt.MAX_VALUE=jF;var KF=er(-1,-1,!0);Jt.MAX_UNSIGNED_VALUE=KF;var So=er(0,-2147483648,!1);Jt.MIN_VALUE=So;var ve=Jt.prototype;ve.toInt=function(){return this.unsigned?this.low>>>0:this.low};ve.toNumber=function(){return this.unsigned?(this.high>>>0)*Cm+(this.low>>>0):this.high*Cm+(this.low>>>0)};ve.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(So)){var r=hs(e),n=this.div(r),o=n.mul(r).sub(this);return n.toString(e)+o.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var s=hs(o1(e,6),this.unsigned),i=this,a="";;){var l=i.div(s),u=i.sub(l.mul(s)).toInt()>>>0,c=u.toString(e);if(i=l,i.isZero())return c+a;for(;c.length<6;)c="0"+c;a=""+c+a}};ve.getHighBits=function(){return this.high};ve.getHighBitsUnsigned=function(){return this.high>>>0};ve.getLowBits=function(){return this.low};ve.getLowBitsUnsigned=function(){return this.low>>>0};ve.getNumBitsAbs=function(){if(this.isNegative())return this.eq(So)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,r=31;r>0&&(e&1<<r)==0;r--);return this.high!=0?r+33:r+1};ve.isZero=function(){return this.high===0&&this.low===0};ve.eqz=ve.isZero;ve.isNegative=function(){return!this.unsigned&&this.high<0};ve.isPositive=function(){return this.unsigned||this.high>=0};ve.isOdd=function(){return(this.low&1)===1};ve.isEven=function(){return(this.low&1)===0};ve.equals=function(e){return ko(e)||(e=ni(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};ve.eq=ve.equals;ve.notEquals=function(e){return!this.eq(e)};ve.neq=ve.notEquals;ve.ne=ve.notEquals;ve.lessThan=function(e){return this.comp(e)<0};ve.lt=ve.lessThan;ve.lessThanOrEqual=function(e){return this.comp(e)<=0};ve.lte=ve.lessThanOrEqual;ve.le=ve.lessThanOrEqual;ve.greaterThan=function(e){return this.comp(e)>0};ve.gt=ve.greaterThan;ve.greaterThanOrEqual=function(e){return this.comp(e)>=0};ve.gte=ve.greaterThanOrEqual;ve.ge=ve.greaterThanOrEqual;ve.compare=function(e){if(ko(e)||(e=ni(e)),this.eq(e))return 0;var r=this.isNegative(),n=e.isNegative();return r&&!n?-1:!r&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};ve.comp=ve.compare;ve.negate=function(){return!this.unsigned&&this.eq(So)?So:this.not().add(wm)};ve.neg=ve.negate;ve.add=function(e){ko(e)||(e=ni(e));var r=this.high>>>16,n=this.high&65535,o=this.low>>>16,s=this.low&65535,i=e.high>>>16,a=e.high&65535,l=e.low>>>16,u=e.low&65535,c=0,p=0,f=0,d=0;return d+=s+u,f+=d>>>16,d&=65535,f+=o+l,p+=f>>>16,f&=65535,p+=n+a,c+=p>>>16,p&=65535,c+=r+i,c&=65535,er(f<<16|d,c<<16|p,this.unsigned)};ve.subtract=function(e){return ko(e)||(e=ni(e)),this.add(e.neg())};ve.sub=ve.subtract;ve.multiply=function(e){if(this.isZero())return gs;if(ko(e)||(e=ni(e)),ms){var r=ms.mul(this.low,this.high,e.low,e.high);return er(r,ms.get_high(),this.unsigned)}if(e.isZero())return gs;if(this.eq(So))return e.isOdd()?So:gs;if(e.eq(So))return this.isOdd()?So:gs;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(UF)&&e.lt(UF))return hs(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,o=this.high&65535,s=this.low>>>16,i=this.low&65535,a=e.high>>>16,l=e.high&65535,u=e.low>>>16,c=e.low&65535,p=0,f=0,d=0,m=0;return m+=i*c,d+=m>>>16,m&=65535,d+=s*c,f+=d>>>16,d&=65535,d+=i*u,f+=d>>>16,d&=65535,f+=o*c,p+=f>>>16,f&=65535,f+=s*u,p+=f>>>16,f&=65535,f+=i*l,p+=f>>>16,f&=65535,p+=n*c+o*u+s*l+i*a,p&=65535,er(d<<16|m,p<<16|f,this.unsigned)};ve.mul=ve.multiply;ve.divide=function(e){if(ko(e)||(e=ni(e)),e.isZero())throw Error("division by zero");if(ms){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var r=(this.unsigned?ms.div_u:ms.div_s)(this.low,this.high,e.low,e.high);return er(r,ms.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?zp:gs;var n,o,s;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return zp;if(e.gt(this.shru(1)))return qF;s=zp}else{if(this.eq(So)){if(e.eq(wm)||e.eq(RI))return So;if(e.eq(So))return wm;var i=this.shr(1);return n=i.div(e).shl(1),n.eq(gs)?e.isNegative()?wm:RI:(o=this.sub(e.mul(n)),s=n.add(o.div(e)),s)}else if(e.eq(So))return this.unsigned?zp:gs;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();s=gs}for(o=this;o.gte(e);){n=Math.max(1,Math.floor(o.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(n)/Math.LN2),l=a<=48?1:o1(2,a-48),u=hs(n),c=u.mul(e);c.isNegative()||c.gt(o);)n-=l,u=hs(n,this.unsigned),c=u.mul(e);u.isZero()&&(u=wm),s=s.add(u),o=o.sub(c)}return s};ve.div=ve.divide;ve.modulo=function(e){if(ko(e)||(e=ni(e)),ms){var r=(this.unsigned?ms.rem_u:ms.rem_s)(this.low,this.high,e.low,e.high);return er(r,ms.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};ve.mod=ve.modulo;ve.rem=ve.modulo;ve.not=function(){return er(~this.low,~this.high,this.unsigned)};ve.and=function(e){return ko(e)||(e=ni(e)),er(this.low&e.low,this.high&e.high,this.unsigned)};ve.or=function(e){return ko(e)||(e=ni(e)),er(this.low|e.low,this.high|e.high,this.unsigned)};ve.xor=function(e){return ko(e)||(e=ni(e)),er(this.low^e.low,this.high^e.high,this.unsigned)};ve.shiftLeft=function(e){return ko(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?er(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):er(0,this.low<<e-32,this.unsigned)};ve.shl=ve.shiftLeft;ve.shiftRight=function(e){return ko(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?er(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):er(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};ve.shr=ve.shiftRight;ve.shiftRightUnsigned=function(e){if(ko(e)&&(e=e.toInt()),e&=63,e===0)return this;var r=this.high;if(e<32){var n=this.low;return er(n>>>e|r<<32-e,r>>>e,this.unsigned)}else return e===32?er(r,0,this.unsigned):er(r>>>e-32,0,this.unsigned)};ve.shru=ve.shiftRightUnsigned;ve.shr_u=ve.shiftRightUnsigned;ve.toSigned=function(){return this.unsigned?er(this.low,this.high,!1):this};ve.toUnsigned=function(){return this.unsigned?this:er(this.low,this.high,!0)};ve.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};ve.toBytesLE=function(){var e=this.high,r=this.low;return[r&255,r>>>8&255,r>>>16&255,r>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};ve.toBytesBE=function(){var e=this.high,r=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,r>>>24,r>>>16&255,r>>>8&255,r&255]};Jt.fromBytes=function(e,r,n){return n?Jt.fromBytesLE(e,r):Jt.fromBytesBE(e,r)};Jt.fromBytesLE=function(e,r){return new Jt(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,r)};Jt.fromBytesBE=function(e,r){return new Jt(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],r)}});var AP=Qe(()=>{});var DP=Qe(()=>{});var CL=Qe((wL,G2)=>{(function(t,e,r){function n(a){var l=this,u=i();l.next=function(){var c=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=c-(l.c=c|0)},l.c=1,l.s0=u(" "),l.s1=u(" "),l.s2=u(" "),l.s0-=u(a),l.s0<0&&(l.s0+=1),l.s1-=u(a),l.s1<0&&(l.s1+=1),l.s2-=u(a),l.s2<0&&(l.s2+=1),u=null}function o(a,l){return l.c=a.c,l.s0=a.s0,l.s1=a.s1,l.s2=a.s2,l}function s(a,l){var u=new n(a),c=l&&l.state,p=u.next;return p.int32=function(){return u.next()*4294967296|0},p.double=function(){return p()+(p()*2097152|0)*11102230246251565e-32},p.quick=p,c&&(typeof c=="object"&&o(c,u),p.state=function(){return o(u,{})}),p}function i(){var a=4022871197,l=function(u){u=String(u);for(var c=0;c<u.length;c++){a+=u.charCodeAt(c);var p=.02519603282416938*a;a=p>>>0,p-=a,p*=a,a=p>>>0,p-=a,a+=p*4294967296}return(a>>>0)*23283064365386963e-26};return l}e&&e.exports?e.exports=s:r&&r.amd?r(function(){return s}):this.alea=s})(wL,typeof G2=="object"&&G2,typeof define=="function"&&define)});var kL=Qe((SL,U2)=>{(function(t,e,r){function n(i){var a=this,l="";a.x=0,a.y=0,a.z=0,a.w=0,a.next=function(){var c=a.x^a.x<<11;return a.x=a.y,a.y=a.z,a.z=a.w,a.w^=a.w>>>19^c^c>>>8},i===(i|0)?a.x=i:l+=i;for(var u=0;u<l.length+64;u++)a.x^=l.charCodeAt(u)|0,a.next()}function o(i,a){return a.x=i.x,a.y=i.y,a.z=i.z,a.w=i.w,a}function s(i,a){var l=new n(i),u=a&&a.state,c=function(){return(l.next()>>>0)/4294967296};return c.double=function(){do var p=l.next()>>>11,f=(l.next()>>>0)/4294967296,d=(p+f)/(1<<21);while(d===0);return d},c.int32=l.next,c.quick=c,u&&(typeof u=="object"&&o(u,l),c.state=function(){return o(l,{})}),c}e&&e.exports?e.exports=s:r&&r.amd?r(function(){return s}):this.xor128=s})(SL,typeof U2=="object"&&U2,typeof define=="function"&&define)});var NL=Qe((TL,H2)=>{(function(t,e,r){function n(i){var a=this,l="";a.next=function(){var c=a.x^a.x>>>2;return a.x=a.y,a.y=a.z,a.z=a.w,a.w=a.v,(a.d=a.d+362437|0)+(a.v=a.v^a.v<<4^(c^c<<1))|0},a.x=0,a.y=0,a.z=0,a.w=0,a.v=0,i===(i|0)?a.x=i:l+=i;for(var u=0;u<l.length+64;u++)a.x^=l.charCodeAt(u)|0,u==l.length&&(a.d=a.x<<10^a.x>>>4),a.next()}function o(i,a){return a.x=i.x,a.y=i.y,a.z=i.z,a.w=i.w,a.v=i.v,a.d=i.d,a}function s(i,a){var l=new n(i),u=a&&a.state,c=function(){return(l.next()>>>0)/4294967296};return c.double=function(){do var p=l.next()>>>11,f=(l.next()>>>0)/4294967296,d=(p+f)/(1<<21);while(d===0);return d},c.int32=l.next,c.quick=c,u&&(typeof u=="object"&&o(u,l),c.state=function(){return o(l,{})}),c}e&&e.exports?e.exports=s:r&&r.amd?r(function(){return s}):this.xorwow=s})(TL,typeof H2=="object"&&H2,typeof define=="function"&&define)});var EL=Qe((IL,q2)=>{(function(t,e,r){function n(i){var a=this;a.next=function(){var u=a.x,c=a.i,p,f,d;return p=u[c],p^=p>>>7,f=p^p<<24,p=u[c+1&7],f^=p^p>>>10,p=u[c+3&7],f^=p^p>>>3,p=u[c+4&7],f^=p^p<<7,p=u[c+7&7],p=p^p<<13,f^=p^p<<9,u[c]=f,a.i=c+1&7,f};function l(u,c){var p,f,d=[];if(c===(c|0))f=d[0]=c;else for(c=""+c,p=0;p<c.length;++p)d[p&7]=d[p&7]<<15^c.charCodeAt(p)+d[p+1&7]<<13;for(;d.length<8;)d.push(0);for(p=0;p<8&&d[p]===0;++p);for(p==8?f=d[7]=-1:f=d[p],u.x=d,u.i=0,p=256;p>0;--p)u.next()}l(a,i)}function o(i,a){return a.x=i.x.slice(),a.i=i.i,a}function s(i,a){i==null&&(i=+new Date);var l=new n(i),u=a&&a.state,c=function(){return(l.next()>>>0)/4294967296};return c.double=function(){do var p=l.next()>>>11,f=(l.next()>>>0)/4294967296,d=(p+f)/(1<<21);while(d===0);return d},c.int32=l.next,c.quick=c,u&&(u.x&&o(u,l),c.state=function(){return o(l,{})}),c}e&&e.exports?e.exports=s:r&&r.amd?r(function(){return s}):this.xorshift7=s})(IL,typeof q2=="object"&&q2,typeof define=="function"&&define)});var AL=Qe((_L,j2)=>{(function(t,e,r){function n(i){var a=this;a.next=function(){var u=a.w,c=a.X,p=a.i,f,d;return a.w=u=u+1640531527|0,d=c[p+34&127],f=c[p=p+1&127],d^=d<<13,f^=f<<17,d^=d>>>15,f^=f>>>12,d=c[p]=d^f,a.i=p,d+(u^u>>>16)|0};function l(u,c){var p,f,d,m,h,x=[],g=128;for(c===(c|0)?(f=c,c=null):(c=c+"\0",f=0,g=Math.max(g,c.length)),d=0,m=-32;m<g;++m)c&&(f^=c.charCodeAt((m+32)%c.length)),m===0&&(h=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,m>=0&&(h=h+1640531527|0,p=x[m&127]^=f+h,d=p==0?d+1:0);for(d>=128&&(x[(c&&c.length||0)&127]=-1),d=127,m=4*128;m>0;--m)f=x[d+34&127],p=x[d=d+1&127],f^=f<<13,p^=p<<17,f^=f>>>15,p^=p>>>12,x[d]=f^p;u.w=h,u.X=x,u.i=d}l(a,i)}function o(i,a){return a.i=i.i,a.w=i.w,a.X=i.X.slice(),a}function s(i,a){i==null&&(i=+new Date);var l=new n(i),u=a&&a.state,c=function(){return(l.next()>>>0)/4294967296};return c.double=function(){do var p=l.next()>>>11,f=(l.next()>>>0)/4294967296,d=(p+f)/(1<<21);while(d===0);return d},c.int32=l.next,c.quick=c,u&&(u.X&&o(u,l),c.state=function(){return o(l,{})}),c}e&&e.exports?e.exports=s:r&&r.amd?r(function(){return s}):this.xor4096=s})(_L,typeof j2=="object"&&j2,typeof define=="function"&&define)});var $L=Qe((DL,K2)=>{(function(t,e,r){function n(i){var a=this,l="";a.next=function(){var c=a.b,p=a.c,f=a.d,d=a.a;return c=c<<25^c>>>7^p,p=p-f|0,f=f<<24^f>>>8^d,d=d-c|0,a.b=c=c<<20^c>>>12^p,a.c=p=p-f|0,a.d=f<<16^p>>>16^d,a.a=d-c|0},a.a=0,a.b=0,a.c=-1640531527,a.d=1367130551,i===Math.floor(i)?(a.a=i/4294967296|0,a.b=i|0):l+=i;for(var u=0;u<l.length+20;u++)a.b^=l.charCodeAt(u)|0,a.next()}function o(i,a){return a.a=i.a,a.b=i.b,a.c=i.c,a.d=i.d,a}function s(i,a){var l=new n(i),u=a&&a.state,c=function(){return(l.next()>>>0)/4294967296};return c.double=function(){do var p=l.next()>>>11,f=(l.next()>>>0)/4294967296,d=(p+f)/(1<<21);while(d===0);return d},c.int32=l.next,c.quick=c,u&&(typeof u=="object"&&o(u,l),c.state=function(){return o(l,{})}),c}e&&e.exports?e.exports=s:r&&r.amd?r(function(){return s}):this.tychei=s})(DL,typeof K2=="object"&&K2,typeof define=="function"&&define)});var RL=Qe(()=>{});var FL=Qe((OL,E1)=>{(function(t,e,r){var n=256,o=6,s=52,i="random",a=r.pow(n,o),l=r.pow(2,s),u=l*2,c=n-1,p;function f(b,v,C){var S=[];v=v==!0?{entropy:!0}:v||{};var k=x(h(v.entropy?[b,y(e)]:b??g(),3),S),I=new d(S),A=function(){for(var $=I.g(o),O=a,j=0;$<l;)$=($+j)*n,O*=n,j=I.g(1);for(;$>=u;)$/=2,O/=2,j>>>=1;return($+j)/O};return A.int32=function(){return I.g(4)|0},A.quick=function(){return I.g(4)/4294967296},A.double=A,x(y(I.S),e),(v.pass||C||function($,O,j,H){return H&&(H.S&&m(H,I),$.state=function(){return m(I,{})}),j?(r[i]=$,O):$})(A,k,"global"in v?v.global:this==r,v.state)}function d(b){var v,C=b.length,S=this,k=0,I=S.i=S.j=0,A=S.S=[];for(C||(b=[C++]);k<n;)A[k]=k++;for(k=0;k<n;k++)A[k]=A[I=c&I+b[k%C]+(v=A[k])],A[I]=v;(S.g=function($){for(var O,j=0,H=S.i,Y=S.j,B=S.S;$--;)O=B[H=c&H+1],j=j*n+B[c&(B[H]=B[Y=c&Y+O])+(B[Y]=O)];return S.i=H,S.j=Y,j})(n)}function m(b,v){return v.i=b.i,v.j=b.j,v.S=b.S.slice(),v}function h(b,v){var C=[],S=typeof b,k;if(v&&S=="object")for(k in b)try{C.push(h(b[k],v-1))}catch{}return C.length?C:S=="string"?b:b+"\0"}function x(b,v){for(var C=b+"",S,k=0;k<C.length;)v[c&k]=c&(S^=v[c&k]*19)+C.charCodeAt(k++);return y(v)}function g(){try{var b;return p&&(b=p.randomBytes)?b=b(n):(b=new Uint8Array(n),(t.crypto||t.msCrypto).getRandomValues(b)),y(b)}catch{var v=t.navigator,C=v&&v.plugins;return[+new Date,t,C,t.screen,y(e)]}}function y(b){return String.fromCharCode.apply(0,b)}if(x(r.random(),e),typeof E1=="object"&&E1.exports){E1.exports=f;try{p=RL()}catch{}}else typeof define=="function"&&define.amd?define(function(){return f}):r["seed"+i]=f})(typeof self<"u"?self:OL,[],Math)});var Bx=Qe((gPe,PL)=>{var bte=CL(),vte=kL(),wte=NL(),Cte=EL(),Ste=AL(),kte=$L(),of=FL();of.alea=bte;of.xor128=vte;of.xorwow=wte;of.xorshift7=Cte;of.xor4096=Ste;of.tychei=kte;PL.exports=of});var aB=Qe(()=>{});var xH=Qe(ut=>{"use strict";var K0=Symbol.for("react.element"),Hme=Symbol.for("react.portal"),qme=Symbol.for("react.fragment"),jme=Symbol.for("react.strict_mode"),Kme=Symbol.for("react.profiler"),Xme=Symbol.for("react.provider"),Yme=Symbol.for("react.context"),Qme=Symbol.for("react.forward_ref"),Zme=Symbol.for("react.suspense"),Jme=Symbol.for("react.memo"),ehe=Symbol.for("react.lazy"),aH=Symbol.iterator;function the(t){return t===null||typeof t!="object"?null:(t=aH&&t[aH]||t["@@iterator"],typeof t=="function"?t:null)}var cH={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},pH=Object.assign,fH={};function Yh(t,e,r){this.props=t,this.context=e,this.refs=fH,this.updater=r||cH}Yh.prototype.isReactComponent={};Yh.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Yh.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function dH(){}dH.prototype=Yh.prototype;function xA(t,e,r){this.props=t,this.context=e,this.refs=fH,this.updater=r||cH}var yA=xA.prototype=new dH;yA.constructor=xA;pH(yA,Yh.prototype);yA.isPureReactComponent=!0;var lH=Array.isArray,mH=Object.prototype.hasOwnProperty,bA={current:null},hH={key:!0,ref:!0,__self:!0,__source:!0};function gH(t,e,r){var n,o={},s=null,i=null;if(e!=null)for(n in e.ref!==void 0&&(i=e.ref),e.key!==void 0&&(s=""+e.key),e)mH.call(e,n)&&!hH.hasOwnProperty(n)&&(o[n]=e[n]);var a=arguments.length-2;if(a===1)o.children=r;else if(1<a){for(var l=Array(a),u=0;u<a;u++)l[u]=arguments[u+2];o.children=l}if(t&&t.defaultProps)for(n in a=t.defaultProps,a)o[n]===void 0&&(o[n]=a[n]);return{$$typeof:K0,type:t,key:s,ref:i,props:o,_owner:bA.current}}function rhe(t,e){return{$$typeof:K0,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function vA(t){return typeof t=="object"&&t!==null&&t.$$typeof===K0}function nhe(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(r){return e[r]})}var uH=/\/+/g;function gA(t,e){return typeof t=="object"&&t!==null&&t.key!=null?nhe(""+t.key):e.toString(36)}function ok(t,e,r,n,o){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var i=!1;if(t===null)i=!0;else switch(s){case"string":case"number":i=!0;break;case"object":switch(t.$$typeof){case K0:case Hme:i=!0}}if(i)return i=t,o=o(i),t=n===""?"."+gA(i,0):n,lH(o)?(r="",t!=null&&(r=t.replace(uH,"$&/")+"/"),ok(o,e,r,"",function(u){return u})):o!=null&&(vA(o)&&(o=rhe(o,r+(!o.key||i&&i.key===o.key?"":(""+o.key).replace(uH,"$&/")+"/")+t)),e.push(o)),1;if(i=0,n=n===""?".":n+":",lH(t))for(var a=0;a<t.length;a++){s=t[a];var l=n+gA(s,a);i+=ok(s,e,r,l,o)}else if(l=the(t),typeof l=="function")for(t=l.call(t),a=0;!(s=t.next()).done;)s=s.value,l=n+gA(s,a++),i+=ok(s,e,r,l,o);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return i}function nk(t,e,r){if(t==null)return t;var n=[],o=0;return ok(t,n,"","",function(s){return e.call(r,s,o++)}),n}function ohe(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(r){(t._status===0||t._status===-1)&&(t._status=1,t._result=r)},function(r){(t._status===0||t._status===-1)&&(t._status=2,t._result=r)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var po={current:null},sk={transition:null},she={ReactCurrentDispatcher:po,ReactCurrentBatchConfig:sk,ReactCurrentOwner:bA};ut.Children={map:nk,forEach:function(t,e,r){nk(t,function(){e.apply(this,arguments)},r)},count:function(t){var e=0;return nk(t,function(){e++}),e},toArray:function(t){return nk(t,function(e){return e})||[]},only:function(t){if(!vA(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};ut.Component=Yh;ut.Fragment=qme;ut.Profiler=Kme;ut.PureComponent=xA;ut.StrictMode=jme;ut.Suspense=Zme;ut.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=she;ut.cloneElement=function(t,e,r){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var n=pH({},t.props),o=t.key,s=t.ref,i=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,i=bA.current),e.key!==void 0&&(o=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)mH.call(e,l)&&!hH.hasOwnProperty(l)&&(n[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)n.children=r;else if(1<l){a=Array(l);for(var u=0;u<l;u++)a[u]=arguments[u+2];n.children=a}return{$$typeof:K0,type:t.type,key:o,ref:s,props:n,_owner:i}};ut.createContext=function(t){return t={$$typeof:Yme,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:Xme,_context:t},t.Consumer=t};ut.createElement=gH;ut.createFactory=function(t){var e=gH.bind(null,t);return e.type=t,e};ut.createRef=function(){return{current:null}};ut.forwardRef=function(t){return{$$typeof:Qme,render:t}};ut.isValidElement=vA;ut.lazy=function(t){return{$$typeof:ehe,_payload:{_status:-1,_result:t},_init:ohe}};ut.memo=function(t,e){return{$$typeof:Jme,type:t,compare:e===void 0?null:e}};ut.startTransition=function(t){var e=sk.transition;sk.transition={};try{t()}finally{sk.transition=e}};ut.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};ut.useCallback=function(t,e){return po.current.useCallback(t,e)};ut.useContext=function(t){return po.current.useContext(t)};ut.useDebugValue=function(){};ut.useDeferredValue=function(t){return po.current.useDeferredValue(t)};ut.useEffect=function(t,e){return po.current.useEffect(t,e)};ut.useId=function(){return po.current.useId()};ut.useImperativeHandle=function(t,e,r){return po.current.useImperativeHandle(t,e,r)};ut.useInsertionEffect=function(t,e){return po.current.useInsertionEffect(t,e)};ut.useLayoutEffect=function(t,e){return po.current.useLayoutEffect(t,e)};ut.useMemo=function(t,e){return po.current.useMemo(t,e)};ut.useReducer=function(t,e,r){return po.current.useReducer(t,e,r)};ut.useRef=function(t){return po.current.useRef(t)};ut.useState=function(t){return po.current.useState(t)};ut.useSyncExternalStore=function(t,e,r){return po.current.useSyncExternalStore(t,e,r)};ut.useTransition=function(){return po.current.useTransition()};ut.version="18.2.0"});var ct=Qe((pqt,yH)=>{"use strict";yH.exports=xH()});var vH=Qe((fqt,bH)=>{"use strict";var ihe="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";bH.exports=ihe});var kH=Qe((dqt,SH)=>{"use strict";var ahe=vH();function wH(){}function CH(){}CH.resetWarningCache=wH;SH.exports=function(){function t(n,o,s,i,a,l){if(l!==ahe){var u=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw u.name="Invariant Violation",u}}t.isRequired=t;function e(){return t}var r={array:t,bigint:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:CH,resetWarningCache:wH};return r.PropTypes=r,r}});var zl=Qe((gqt,TH)=>{TH.exports=kH()();var mqt,hqt});var zf=Qe(Qh=>{"use strict";Object.defineProperty(Qh,"__esModule",{value:!0});Qh.setConfiguration=Qh.getConfiguration=void 0;var wA={breakpoints:[576,768,992,1200,1600,1920],containerWidths:[540,750,960,1140,1540,1810],gutterWidth:30,gridColumns:12,defaultScreenClass:"xxl",maxScreenClass:"xxl"},lhe=()=>wA;Qh.getConfiguration=lhe;var uhe=t=>{wA={...wA,...t}};Qh.setConfiguration=uhe});var NH=Qe(ik=>{"use strict";Object.defineProperty(ik,"__esModule",{value:!0});ik.default=void 0;var che="div";ik.default=che});var IH=Qe(ak=>{"use strict";Object.defineProperty(ak,"__esModule",{value:!0});ak.default=void 0;var phe="span";ak.default=phe});var EH=Qe(lk=>{"use strict";Object.defineProperty(lk,"__esModule",{value:!0});lk.default=void 0;var fhe=typeof window<"u"?window:void 0;lk.default=fhe});var Zh=Qe(X0=>{"use strict";Object.defineProperty(X0,"__esModule",{value:!0});Object.defineProperty(X0,"Div",{enumerable:!0,get:function(){return dhe.default}});Object.defineProperty(X0,"Span",{enumerable:!0,get:function(){return mhe.default}});Object.defineProperty(X0,"Window",{enumerable:!0,get:function(){return hhe.default}});var dhe=CA(NH()),mhe=CA(IH()),hhe=CA(EH());function CA(t){return t&&t.__esModule?t:{default:t}}});var ck=Qe(Jh=>{"use strict";Object.defineProperty(Jh,"__esModule",{value:!0});Jh.useScreenClass=Jh.screenClasses=void 0;var _H=ct(),ghe=zf(),Y0=Zh(),xhe=t=>t&&t.current&&t.current.clientWidth?t.current.clientWidth:typeof Y0.Window<"u"&&Y0.Window.innerWidth?Y0.Window.innerWidth:null,uk=["xs","sm","md","lg","xl","xxl","xxxl"];Jh.screenClasses=uk;var yhe=(t,e)=>{let r=()=>{let{breakpoints:s,defaultScreenClass:i,maxScreenClass:a}=(0,ghe.getConfiguration)(),l=i,u=xhe(t);u?(l="xs",s[0]&&u>=s[0]&&(l="sm"),s[1]&&u>=s[1]&&(l="md"),s[2]&&u>=s[2]&&(l="lg"),s[3]&&u>=s[3]&&(l="xl"),s[4]&&u>=s[4]&&(l="xxl"),s[5]&&u>=s[5]&&(l="xxxl")):e&&(l=e);let c=uk.indexOf(l),p=uk.indexOf(a);return p>=0&&c>p&&(l=uk[p]),l},[n,o]=(0,_H.useState)(()=>r());return(0,_H.useEffect)(()=>{let s=()=>o(r());return Y0.Window.addEventListener("resize",s,!1),()=>{Y0.Window.removeEventListener("resize",s,!1)}},[]),n};Jh.useScreenClass=yhe});var DH=Qe(fk=>{"use strict";Object.defineProperty(fk,"__esModule",{value:!0});fk.default=void 0;var AH=ck(),bhe=t=>Object.keys(t).reduce((e,r)=>e||t[r],!1),pk=(t,e)=>{if(typeof t!="number")return;let r=Math.max(0,Math.min(e,t));return"".concat(100/e*r,"%")},vhe=t=>{let{forceWidth:e=null,width:r={},offset:n={},pull:o={},push:s={},order:i={},debug:a,screenClass:l,gutterWidth:u,moreStyle:c,gridColumns:p}=t,f={boxSizing:"border-box",minHeight:1,position:"relative",paddingLeft:u/2,paddingRight:u/2,width:"100%"};return a&&(f.outline="1px solid silver",f.background="rgba(0,0,0,.05)",f.lineHeight="32px"),f.flexBasis="100%",f.flexGrow=0,f.flexShrink=0,f.maxWidth="100%",f.marginLeft="0%",f.right="auto",f.left="auto",AH.screenClasses.forEach((d,m)=>{if(AH.screenClasses.indexOf(l)>=m){let h=pk(r[d],p),x=r[d]==="content";f.flexBasis=x?"auto":h||f.flexBasis,f.width=f.flexBasis,f.maxWidth=h||f.maxWidth,f.marginLeft=pk(n[d],p)||f.marginLeft,f.right=pk(o[d],p)||f.right,f.left=pk(s[d],p)||f.left,i[d]&&(f.order=i[d])}}),bhe(r)||(f.flexBasis=0,f.flexGrow=1),e&&(f.flexBasis="unset",f.flexGrow="unset",f.flexShrink="unset",f.width=e),{...f,...c}};fk.default=vhe});var $H=Qe(dk=>{"use strict";Object.defineProperty(dk,"__esModule",{value:!0});dk.default=void 0;var whe=t=>{let{gutterWidth:e,align:r,justify:n,debug:o,moreStyle:s,direction:i,wrap:a}=t,l=r;r==="start"&&(l="flex-start"),r==="end"&&(l="flex-end");let u=n;n==="start"&&(u="flex-start"),n==="end"&&(u="flex-end"),n==="between"&&(u="space-between"),n==="around"&&(u="space-around"),n==="center"&&(u="center"),n==="initial"&&(u="initial"),n==="inherit"&&(u="inherit");let c=["column","row","column-reverse","row-reverse"].includes(i)?i:void 0,p=a;a==="nowrap"&&(p="nowrap"),a==="wrap"&&(p="wrap"),a==="reverse"&&(p="wrap-reverse");let f={marginLeft:-e/2,marginRight:-e/2,display:"flex",flexGrow:0,flexShrink:0,alignItems:l,justifyContent:u,flexDirection:c,flexWrap:p};return o&&(f.background="rgba(128,128,128,.05)"),{...f,...s}};dk.default=whe});var TA=Qe(eg=>{"use strict";Object.defineProperty(eg,"__esModule",{value:!0});eg.default=eg.GutterWidthContext=void 0;var mk=SA(ct()),ns=SA(zl()),Che=zf(),She=SA($H()),khe=Zh();function SA(t){return t&&t.__esModule?t:{default:t}}var RH=mk.default.createContext(!1);eg.GutterWidthContext=RH;var kA=mk.default.forwardRef((t,e)=>{let{children:r,style:n,align:o,justify:s,wrap:i,debug:a,nogutter:l,gutterWidth:u,component:c,direction:p,...f}=t,d=(0,Che.getConfiguration)().gutterWidth;l&&(d=0),typeof u=="number"&&(d=u);let m=(0,She.default)({gutterWidth:d,align:o,justify:s,debug:a,moreStyle:n,direction:p,wrap:i});return mk.default.createElement(c,{ref:e,style:m,...f},mk.default.createElement(RH.Provider,{value:d},r))});kA.propTypes={children:ns.default.node.isRequired,align:ns.default.oneOf(["normal","start","center","end","stretch"]),justify:ns.default.oneOf(["start","center","end","between","around","initial","inherit"]),direction:ns.default.oneOf(["column","row","column-reverse","row-reverse"]),wrap:ns.default.oneOf(["nowrap","wrap","reverse"]),nogutter:ns.default.bool,gutterWidth:ns.default.number,style:ns.default.objectOf(ns.default.oneOfType([ns.default.number,ns.default.string])),debug:ns.default.bool,component:ns.default.elementType};kA.defaultProps={align:"normal",justify:"start",direction:"row",wrap:"wrap",nogutter:!1,gutterWidth:null,style:{},debug:!1,component:khe.Div};var The=kA;eg.default=The});var EA=Qe(Fc=>{"use strict";Object.defineProperty(Fc,"__esModule",{value:!0});Fc.default=Fc.ScreenClassContext=Fc.NO_PROVIDER_FLAG=void 0;var Oc=Ahe(ct()),NA=_he(zl()),Nhe=ck(),Ihe=zf(),Ehe=Zh();function _he(t){return t&&t.__esModule?t:{default:t}}function OH(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(OH=function(n){return n?r:e})(t)}function Ahe(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||typeof t!="object"&&typeof t!="function")return{default:t};var r=OH(e);if(r&&r.has(t))return r.get(t);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if(s!=="default"&&Object.prototype.hasOwnProperty.call(t,s)){var i=o?Object.getOwnPropertyDescriptor(t,s):null;i&&(i.get||i.set)?Object.defineProperty(n,s,i):n[s]=t[s]}return n.default=t,r&&r.set(t,n),n}var FH="NO_PROVIDER_FLAG";Fc.NO_PROVIDER_FLAG=FH;var PH=Oc.default.createContext(FH);Fc.ScreenClassContext=PH;var IA=t=>{let{useOwnWidth:e,children:r,fallbackScreenClass:n}=t,o=(0,Oc.useRef)(),[s,i]=(0,Oc.useState)(!1),a=(0,Nhe.useScreenClass)(o,n),{defaultScreenClass:l}=(0,Ihe.getConfiguration)(),u=s?a:n||l;return(0,Oc.useEffect)(()=>i(!0),[]),Oc.default.createElement(PH.Provider,{value:u},e?Oc.default.createElement(Ehe.Div,{ref:e?o:null},r):Oc.default.createElement(Oc.default.Fragment,null,r))};IA.propTypes={children:NA.default.node.isRequired,useOwnWidth:NA.default.bool,fallbackScreenClass:NA.default.oneOf([null,"xs","sm","md","lg","xl","xxl","xxxl"])};IA.defaultProps={useOwnWidth:!1,fallbackScreenClass:null};var Dhe=IA;Fc.default=Dhe});var tg=Qe(gk=>{"use strict";Object.defineProperty(gk,"__esModule",{value:!0});gk.default=void 0;var _A=MH(ct()),$he=MH(zl()),hk=Rhe(EA());function LH(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(LH=function(n){return n?r:e})(t)}function Rhe(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||typeof t!="object"&&typeof t!="function")return{default:t};var r=LH(e);if(r&&r.has(t))return r.get(t);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if(s!=="default"&&Object.prototype.hasOwnProperty.call(t,s)){var i=o?Object.getOwnPropertyDescriptor(t,s):null;i&&(i.get||i.set)?Object.defineProperty(n,s,i):n[s]=t[s]}return n.default=t,r&&r.set(t,n),n}function MH(t){return t&&t.__esModule?t:{default:t}}var zH=t=>{let{children:e}=t;return _A.default.createElement(hk.ScreenClassContext.Consumer,null,r=>r===hk.NO_PROVIDER_FLAG?_A.default.createElement(hk.default,null,_A.default.createElement(hk.ScreenClassContext.Consumer,null,n=>e(n))):e(r))};zH.propTypes={children:$he.default.func.isRequired};var Ohe=zH;gk.default=Ohe});var VH=Qe(yk=>{"use strict";Object.defineProperty(yk,"__esModule",{value:!0});yk.default=void 0;var xk=Bhe(ct()),Re=AA(zl()),Fhe=AA(DH()),Phe=zf(),Lhe=TA(),Mhe=AA(tg()),zhe=Zh();function AA(t){return t&&t.__esModule?t:{default:t}}function BH(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(BH=function(n){return n?r:e})(t)}function Bhe(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||typeof t!="object"&&typeof t!="function")return{default:t};var r=BH(e);if(r&&r.has(t))return r.get(t);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if(s!=="default"&&Object.prototype.hasOwnProperty.call(t,s)){var i=o?Object.getOwnPropertyDescriptor(t,s):null;i&&(i.get||i.set)?Object.defineProperty(n,s,i):n[s]=t[s]}return n.default=t,r&&r.set(t,n),n}var DA=xk.default.forwardRef((t,e)=>{let{children:r,xs:n,sm:o,md:s,lg:i,xl:a,xxl:l,xxxl:u,offset:c,pull:p,push:f,order:d,debug:m,style:h,component:x,width:g,...y}=t;return xk.default.createElement(Mhe.default,null,b=>xk.default.createElement(Lhe.GutterWidthContext.Consumer,null,v=>{let C=(0,Fhe.default)({forceWidth:g,width:{xs:n,sm:o,md:s,lg:i,xl:a,xxl:l,xxxl:u},offset:c,pull:p,push:f,order:d,debug:m,screenClass:b,gutterWidth:v,gridColumns:(0,Phe.getConfiguration)().gridColumns,moreStyle:h});return(0,xk.createElement)(x,{ref:e,style:C,...y,children:r})}))});DA.propTypes={children:Re.default.node,xs:Re.default.oneOfType([Re.default.number,Re.default.oneOf(["content"])]),sm:Re.default.oneOfType([Re.default.number,Re.default.oneOf(["content"])]),md:Re.default.oneOfType([Re.default.number,Re.default.oneOf(["content"])]),lg:Re.default.oneOfType([Re.default.number,Re.default.oneOf(["content"])]),xl:Re.default.oneOfType([Re.default.number,Re.default.oneOf(["content"])]),xxl:Re.default.oneOfType([Re.default.number,Re.default.oneOf(["content"])]),xxxl:Re.default.oneOfType([Re.default.number,Re.default.oneOf(["content"])]),width:Re.default.oneOfType([Re.default.number,Re.default.string]),offset:Re.default.shape({xs:Re.default.number,sm:Re.default.number,md:Re.default.number,lg:Re.default.number,xl:Re.default.number,xxl:Re.default.number,xxxl:Re.default.number}),push:Re.default.shape({xs:Re.default.number,sm:Re.default.number,md:Re.default.number,lg:Re.default.number,xl:Re.default.number,xxl:Re.default.number,xxxl:Re.default.number}),pull:Re.default.shape({xs:Re.default.number,sm:Re.default.number,md:Re.default.number,lg:Re.default.number,xl:Re.default.number,xxl:Re.default.number,xxxl:Re.default.number}),order:Re.default.shape({xs:Re.default.number,sm:Re.default.number,md:Re.default.number,lg:Re.default.number,xl:Re.default.number,xxl:Re.default.number,xxxl:Re.default.number}),style:Re.default.objectOf(Re.default.oneOfType([Re.default.number,Re.default.string])),debug:Re.default.bool,component:Re.default.elementType};DA.defaultProps={children:null,xs:null,sm:null,md:null,lg:null,xl:null,xxl:null,xxxl:null,width:null,offset:{},push:{},pull:{},style:{},order:{},debug:!1,component:zhe.Div};var Vhe=DA;yk.default=Vhe});var WH=Qe(bk=>{"use strict";Object.defineProperty(bk,"__esModule",{value:!0});bk.default=void 0;var Whe=t=>{let{fluid:e,xs:r,sm:n,md:o,lg:s,xl:i,xxl:a,xxxl:l,screenClass:u,containerWidths:c,gutterWidth:p,moreStyle:f}=t,d={boxSizing:"border-box",position:"relative",marginLeft:"auto",marginRight:"auto",paddingLeft:p/2,paddingRight:p/2};return e&&!r&&!n&&!o&&!s&&!i?{...d,...f}:(u==="xs"&&c[0]&&!r&&(d.maxWidth=c[0]),u==="sm"&&c[0]&&!n&&(d.maxWidth=c[0]),u==="md"&&c[1]&&!o&&(d.maxWidth=c[1]),u==="lg"&&c[2]&&!s&&(d.maxWidth=c[2]),u==="xl"&&c[3]&&!i&&(d.maxWidth=c[3]),u==="xxl"&&c[4]&&!a&&(d.maxWidth=c[4]),u==="xxxl"&&c[5]&&!l&&(d.maxWidth=c[5]),{...d,...f})};bk.default=Whe});var HH=Qe(vk=>{"use strict";Object.defineProperty(vk,"__esModule",{value:!0});vk.default=void 0;var $A=qhe(ct()),Fo=RA(zl()),Ghe=RA(WH()),GH=zf(),Uhe=RA(tg()),Hhe=Zh();function RA(t){return t&&t.__esModule?t:{default:t}}function UH(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(UH=function(n){return n?r:e})(t)}function qhe(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||typeof t!="object"&&typeof t!="function")return{default:t};var r=UH(e);if(r&&r.has(t))return r.get(t);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if(s!=="default"&&Object.prototype.hasOwnProperty.call(t,s)){var i=o?Object.getOwnPropertyDescriptor(t,s):null;i&&(i.get||i.set)?Object.defineProperty(n,s,i):n[s]=t[s]}return n.default=t,r&&r.set(t,n),n}var OA=$A.default.forwardRef((t,e)=>{let{children:r,fluid:n,xs:o,sm:s,md:i,lg:a,xl:l,xxl:u,xxxl:c,style:p,component:f,...d}=t;return $A.default.createElement(Uhe.default,null,m=>(0,$A.createElement)(f,{ref:e,style:(0,Ghe.default)({fluid:n,xs:o,sm:s,md:i,lg:a,xl:l,xxl:u,xxxl:c,screenClass:m,containerWidths:(0,GH.getConfiguration)().containerWidths,gutterWidth:(0,GH.getConfiguration)().gutterWidth,moreStyle:p}),...d},r))});OA.propTypes={children:Fo.default.node.isRequired,fluid:Fo.default.bool,xs:Fo.default.bool,sm:Fo.default.bool,md:Fo.default.bool,lg:Fo.default.bool,xl:Fo.default.bool,xxl:Fo.default.bool,xxxl:Fo.default.bool,style:Fo.default.objectOf(Fo.default.oneOfType([Fo.default.number,Fo.default.string])),component:Fo.default.elementType};OA.defaultProps={fluid:!1,xs:!1,sm:!1,md:!1,lg:!1,xl:!1,xxl:!1,xxxl:!1,style:{},component:Hhe.Div};var jhe=OA;vk.default=jhe});var jH=Qe(rg=>{"use strict";Object.defineProperty(rg,"__esModule",{value:!0});rg.hidden=rg.default=void 0;var qH=t=>{let{screenClass:e,xs:r,sm:n,md:o,lg:s,xl:i,xxl:a,xxxl:l}=t;return e==="xxl"?a:e==="xxxl"?l:e==="xl"?i:e==="lg"?s:e==="md"?o:e==="sm"?n:r};rg.hidden=qH;var Khe=qH;rg.default=Khe});var XH=Qe(wk=>{"use strict";Object.defineProperty(wk,"__esModule",{value:!0});wk.default=void 0;var Xhe=FA(ct()),Pc=FA(zl()),Yhe=Zhe(jH()),Qhe=FA(tg());function KH(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(KH=function(n){return n?r:e})(t)}function Zhe(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||typeof t!="object"&&typeof t!="function")return{default:t};var r=KH(e);if(r&&r.has(t))return r.get(t);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if(s!=="default"&&Object.prototype.hasOwnProperty.call(t,s)){var i=o?Object.getOwnPropertyDescriptor(t,s):null;i&&(i.get||i.set)?Object.defineProperty(n,s,i):n[s]=t[s]}return n.default=t,r&&r.set(t,n),n}function FA(t){return t&&t.__esModule?t:{default:t}}var PA=t=>{let{children:e,xs:r,sm:n,md:o,lg:s,xl:i,xxl:a,xxxl:l}=t;return Xhe.default.createElement(Qhe.default,null,u=>Yhe.hidden({screenClass:u,xs:r,sm:n,md:o,lg:s,xl:i,xxl:a,xxxl:l})?null:e)};PA.propTypes={children:Pc.default.node.isRequired,xs:Pc.default.bool,sm:Pc.default.bool,md:Pc.default.bool,lg:Pc.default.bool,xl:Pc.default.bool,xxl:Pc.default.bool,xxxl:Pc.default.bool};PA.defaultProps={xs:!1,sm:!1,md:!1,lg:!1,xl:!1,xxl:!1,xxxl:!1};var Jhe=PA;wk.default=Jhe});var QH=Qe(ng=>{"use strict";Object.defineProperty(ng,"__esModule",{value:!0});ng.visible=ng.default=void 0;var YH=t=>{let{screenClass:e,xs:r,sm:n,md:o,lg:s,xl:i,xxl:a,xxxl:l}=t;return e==="xxl"?a:e==="xxxl"?l:e==="xl"?i:e==="lg"?s:e==="md"?o:e==="sm"?n:r};ng.visible=YH;var ege=YH;ng.default=ege});var JH=Qe(Ck=>{"use strict";Object.defineProperty(Ck,"__esModule",{value:!0});Ck.default=void 0;var tge=LA(ct()),Lc=LA(zl()),rge=oge(QH()),nge=LA(tg());function ZH(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(ZH=function(n){return n?r:e})(t)}function oge(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||typeof t!="object"&&typeof t!="function")return{default:t};var r=ZH(e);if(r&&r.has(t))return r.get(t);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if(s!=="default"&&Object.prototype.hasOwnProperty.call(t,s)){var i=o?Object.getOwnPropertyDescriptor(t,s):null;i&&(i.get||i.set)?Object.defineProperty(n,s,i):n[s]=t[s]}return n.default=t,r&&r.set(t,n),n}function LA(t){return t&&t.__esModule?t:{default:t}}var MA=t=>{let{children:e,xs:r,sm:n,md:o,lg:s,xl:i,xxl:a,xxxl:l}=t;return tge.default.createElement(nge.default,null,u=>rge.visible({screenClass:u,xs:r,sm:n,md:o,lg:s,xl:i,xxl:a,xxxl:l})?e:null)};MA.propTypes={children:Lc.default.node.isRequired,xs:Lc.default.bool,sm:Lc.default.bool,md:Lc.default.bool,lg:Lc.default.bool,xl:Lc.default.bool,xxl:Lc.default.bool,xxxl:Lc.default.bool};MA.defaultProps={xs:!1,sm:!1,md:!1,lg:!1,xl:!1,xxl:!1,xxxl:!1};var sge=MA;Ck.default=sge});var t7=Qe(Sk=>{"use strict";Object.defineProperty(Sk,"__esModule",{value:!0});Sk.default=void 0;var ige=zA(ct()),age=zA(zl()),lge=zA(tg());function zA(t){return t&&t.__esModule?t:{default:t}}var e7=t=>{let{render:e}=t;return ige.default.createElement(lge.default,null,r=>e(r))};e7.propTypes={render:age.default.func.isRequired};var uge=e7;Sk.default=uge});var Bf=Qe(zs=>{"use strict";Object.defineProperty(zs,"__esModule",{value:!0});Object.defineProperty(zs,"Col",{enumerable:!0,get:function(){return cge.default}});Object.defineProperty(zs,"Container",{enumerable:!0,get:function(){return pge.default}});Object.defineProperty(zs,"Hidden",{enumerable:!0,get:function(){return dge.default}});Object.defineProperty(zs,"Row",{enumerable:!0,get:function(){return fge.default}});Object.defineProperty(zs,"ScreenClassContext",{enumerable:!0,get:function(){return r7.ScreenClassContext}});Object.defineProperty(zs,"ScreenClassProvider",{enumerable:!0,get:function(){return r7.default}});Object.defineProperty(zs,"ScreenClassRender",{enumerable:!0,get:function(){return hge.default}});Object.defineProperty(zs,"Visible",{enumerable:!0,get:function(){return mge.default}});Object.defineProperty(zs,"setConfiguration",{enumerable:!0,get:function(){return gge.setConfiguration}});Object.defineProperty(zs,"useScreenClass",{enumerable:!0,get:function(){return xge.useScreenClass}});var cge=og(VH()),pge=og(HH()),fge=og(TA()),dge=og(XH()),mge=og(JH()),hge=og(t7()),r7=yge(EA()),gge=zf(),xge=ck();function n7(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(n7=function(n){return n?r:e})(t)}function yge(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||typeof t!="object"&&typeof t!="function")return{default:t};var r=n7(e);if(r&&r.has(t))return r.get(t);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if(s!=="default"&&Object.prototype.hasOwnProperty.call(t,s)){var i=o?Object.getOwnPropertyDescriptor(t,s):null;i&&(i.get||i.set)?Object.defineProperty(n,s,i):n[s]=t[s]}return n.default=t,r&&r.set(t,n),n}function og(t){return t&&t.__esModule?t:{default:t}}});var S7=Qe(rr=>{"use strict";function QA(t,e){var r=t.length;t.push(e);e:for(;0<r;){var n=r-1>>>1,o=t[n];if(0<Ik(o,e))t[n]=e,t[r]=o,r=n;else break e}}function bi(t){return t.length===0?null:t[0]}function _k(t){if(t.length===0)return null;var e=t[0],r=t.pop();if(r!==e){t[0]=r;e:for(var n=0,o=t.length,s=o>>>1;n<s;){var i=2*(n+1)-1,a=t[i],l=i+1,u=t[l];if(0>Ik(a,r))l<o&&0>Ik(u,a)?(t[n]=u,t[l]=r,n=l):(t[n]=a,t[i]=r,n=i);else if(l<o&&0>Ik(u,r))t[n]=u,t[l]=r,n=l;else break e}}return e}function Ik(t,e){var r=t.sortIndex-e.sortIndex;return r!==0?r:t.id-e.id}typeof performance=="object"&&typeof performance.now=="function"?(m7=performance,rr.unstable_now=function(){return m7.now()}):(KA=Date,h7=KA.now(),rr.unstable_now=function(){return KA.now()-h7});var m7,KA,h7,na=[],Mc=[],Nge=1,Vs=null,Zn=3,Ak=!1,Vf=!1,J0=!1,y7=typeof setTimeout=="function"?setTimeout:null,b7=typeof clearTimeout=="function"?clearTimeout:null,g7=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ZA(t){for(var e=bi(Mc);e!==null;){if(e.callback===null)_k(Mc);else if(e.startTime<=t)_k(Mc),e.sortIndex=e.expirationTime,QA(na,e);else break;e=bi(Mc)}}function JA(t){if(J0=!1,ZA(t),!Vf)if(bi(na)!==null)Vf=!0,tD(eD);else{var e=bi(Mc);e!==null&&rD(JA,e.startTime-t)}}function eD(t,e){Vf=!1,J0&&(J0=!1,b7(eb),eb=-1),Ak=!0;var r=Zn;try{for(ZA(e),Vs=bi(na);Vs!==null&&(!(Vs.expirationTime>e)||t&&!C7());){var n=Vs.callback;if(typeof n=="function"){Vs.callback=null,Zn=Vs.priorityLevel;var o=n(Vs.expirationTime<=e);e=rr.unstable_now(),typeof o=="function"?Vs.callback=o:Vs===bi(na)&&_k(na),ZA(e)}else _k(na);Vs=bi(na)}if(Vs!==null)var s=!0;else{var i=bi(Mc);i!==null&&rD(JA,i.startTime-e),s=!1}return s}finally{Vs=null,Zn=r,Ak=!1}}var Dk=!1,Ek=null,eb=-1,v7=5,w7=-1;function C7(){return!(rr.unstable_now()-w7<v7)}function XA(){if(Ek!==null){var t=rr.unstable_now();w7=t;var e=!0;try{e=Ek(!0,t)}finally{e?Z0():(Dk=!1,Ek=null)}}else Dk=!1}var Z0;typeof g7=="function"?Z0=function(){g7(XA)}:typeof MessageChannel<"u"?(YA=new MessageChannel,x7=YA.port2,YA.port1.onmessage=XA,Z0=function(){x7.postMessage(null)}):Z0=function(){y7(XA,0)};var YA,x7;function tD(t){Ek=t,Dk||(Dk=!0,Z0())}function rD(t,e){eb=y7(function(){t(rr.unstable_now())},e)}rr.unstable_IdlePriority=5;rr.unstable_ImmediatePriority=1;rr.unstable_LowPriority=4;rr.unstable_NormalPriority=3;rr.unstable_Profiling=null;rr.unstable_UserBlockingPriority=2;rr.unstable_cancelCallback=function(t){t.callback=null};rr.unstable_continueExecution=function(){Vf||Ak||(Vf=!0,tD(eD))};rr.unstable_forceFrameRate=function(t){0>t||125<t?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):v7=0<t?Math.floor(1e3/t):5};rr.unstable_getCurrentPriorityLevel=function(){return Zn};rr.unstable_getFirstCallbackNode=function(){return bi(na)};rr.unstable_next=function(t){switch(Zn){case 1:case 2:case 3:var e=3;break;default:e=Zn}var r=Zn;Zn=e;try{return t()}finally{Zn=r}};rr.unstable_pauseExecution=function(){};rr.unstable_requestPaint=function(){};rr.unstable_runWithPriority=function(t,e){switch(t){case 1:case 2:case 3:case 4:case 5:break;default:t=3}var r=Zn;Zn=t;try{return e()}finally{Zn=r}};rr.unstable_scheduleCallback=function(t,e,r){var n=rr.unstable_now();switch(typeof r=="object"&&r!==null?(r=r.delay,r=typeof r=="number"&&0<r?n+r:n):r=n,t){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return o=r+o,t={id:Nge++,callback:e,priorityLevel:t,startTime:r,expirationTime:o,sortIndex:-1},r>n?(t.sortIndex=r,QA(Mc,t),bi(na)===null&&t===bi(Mc)&&(J0?(b7(eb),eb=-1):J0=!0,rD(JA,r-n))):(t.sortIndex=o,QA(na,t),Vf||Ak||(Vf=!0,tD(eD))),t};rr.unstable_shouldYield=C7;rr.unstable_wrapCallback=function(t){var e=Zn;return function(){var r=Zn;Zn=e;try{return t.apply(this,arguments)}finally{Zn=r}}}});var T7=Qe((Wqt,k7)=>{"use strict";k7.exports=S7()});var Dj=Qe(us=>{"use strict";var $9=ct(),as=T7();function he(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,r=1;r<arguments.length;r++)e+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var R9=new Set,Cb={};function ed(t,e){Tg(t,e),Tg(t+"Capture",e)}function Tg(t,e){for(Cb[t]=e,t=0;t<e.length;t++)R9.add(e[t])}var ql=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),TD=Object.prototype.hasOwnProperty,Ige=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,N7={},I7={};function Ege(t){return TD.call(I7,t)?!0:TD.call(N7,t)?!1:Ige.test(t)?I7[t]=!0:(N7[t]=!0,!1)}function _ge(t,e,r,n){if(r!==null&&r.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return n?!1:r!==null?!r.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function Age(t,e,r,n){if(e===null||typeof e>"u"||_ge(t,e,r,n))return!0;if(n)return!1;if(r!==null)switch(r.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function ho(t,e,r,n,o,s,i){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=n,this.attributeNamespace=o,this.mustUseProperty=r,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=i}var Ln={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Ln[t]=new ho(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Ln[e]=new ho(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Ln[t]=new ho(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Ln[t]=new ho(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Ln[t]=new ho(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Ln[t]=new ho(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Ln[t]=new ho(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Ln[t]=new ho(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Ln[t]=new ho(t,5,!1,t.toLowerCase(),null,!1,!1)});var x$=/[\-:]([a-z])/g;function y$(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(x$,y$);Ln[e]=new ho(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(x$,y$);Ln[e]=new ho(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(x$,y$);Ln[e]=new ho(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Ln[t]=new ho(t,1,!1,t.toLowerCase(),null,!1,!1)});Ln.xlinkHref=new ho("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Ln[t]=new ho(t,1,!1,t.toLowerCase(),null,!0,!0)});function b$(t,e,r,n){var o=Ln.hasOwnProperty(e)?Ln[e]:null;(o!==null?o.type!==0:n||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Age(e,r,o,n)&&(r=null),n||o===null?Ege(e)&&(r===null?t.removeAttribute(e):t.setAttribute(e,""+r)):o.mustUseProperty?t[o.propertyName]=r===null?o.type===3?!1:"":r:(e=o.attributeName,n=o.attributeNamespace,r===null?t.removeAttribute(e):(o=o.type,r=o===3||o===4&&r===!0?"":""+r,n?t.setAttributeNS(n,e,r):t.setAttribute(e,r))))}var Yl=$9.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,$k=Symbol.for("react.element"),ag=Symbol.for("react.portal"),lg=Symbol.for("react.fragment"),v$=Symbol.for("react.strict_mode"),ND=Symbol.for("react.profiler"),O9=Symbol.for("react.provider"),F9=Symbol.for("react.context"),w$=Symbol.for("react.forward_ref"),ID=Symbol.for("react.suspense"),ED=Symbol.for("react.suspense_list"),C$=Symbol.for("react.memo"),Bc=Symbol.for("react.lazy");Symbol.for("react.scope");Symbol.for("react.debug_trace_mode");var P9=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden");Symbol.for("react.cache");Symbol.for("react.tracing_marker");var E7=Symbol.iterator;function tb(t){return t===null||typeof t!="object"?null:(t=E7&&t[E7]||t["@@iterator"],typeof t=="function"?t:null)}var Ir=Object.assign,nD;function ub(t){if(nD===void 0)try{throw Error()}catch(r){var e=r.stack.trim().match(/\n( *(at )?)/);nD=e&&e[1]||""}return`
`+nD+t}var oD=!1;function sD(t,e){if(!t||oD)return"";oD=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var n=u}Reflect.construct(t,[],e)}else{try{e.call()}catch(u){n=u}t.call(e.prototype)}else{try{throw Error()}catch(u){n=u}t()}}catch(u){if(u&&n&&typeof u.stack=="string"){for(var o=u.stack.split(`
`),s=n.stack.split(`
`),i=o.length-1,a=s.length-1;1<=i&&0<=a&&o[i]!==s[a];)a--;for(;1<=i&&0<=a;i--,a--)if(o[i]!==s[a]){if(i!==1||a!==1)do if(i--,a--,0>a||o[i]!==s[a]){var l=`
`+o[i].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=i&&0<=a);break}}}finally{oD=!1,Error.prepareStackTrace=r}return(t=t?t.displayName||t.name:"")?ub(t):""}function Dge(t){switch(t.tag){case 5:return ub(t.type);case 16:return ub("Lazy");case 13:return ub("Suspense");case 19:return ub("SuspenseList");case 0:case 2:case 15:return t=sD(t.type,!1),t;case 11:return t=sD(t.type.render,!1),t;case 1:return t=sD(t.type,!0),t;default:return""}}function _D(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case lg:return"Fragment";case ag:return"Portal";case ND:return"Profiler";case v$:return"StrictMode";case ID:return"Suspense";case ED:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case F9:return(t.displayName||"Context")+".Consumer";case O9:return(t._context.displayName||"Context")+".Provider";case w$:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case C$:return e=t.displayName||null,e!==null?e:_D(t.type)||"Memo";case Bc:e=t._payload,t=t._init;try{return _D(t(e))}catch{}}return null}function $ge(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return _D(e);case 8:return e===v$?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function ep(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function L9(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Rge(t){var e=L9(t)?"checked":"value",r=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),n=""+t[e];if(!t.hasOwnProperty(e)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var o=r.get,s=r.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return o.call(this)},set:function(i){n=""+i,s.call(this,i)}}),Object.defineProperty(t,e,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(i){n=""+i},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Rk(t){t._valueTracker||(t._valueTracker=Rge(t))}function M9(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var r=e.getValue(),n="";return t&&(n=L9(t)?t.checked?"true":"false":t.value),t=n,t!==r?(e.setValue(t),!0):!1}function aT(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function AD(t,e){var r=e.checked;return Ir({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??t._wrapperState.initialChecked})}function _7(t,e){var r=e.defaultValue==null?"":e.defaultValue,n=e.checked!=null?e.checked:e.defaultChecked;r=ep(e.value!=null?e.value:r),t._wrapperState={initialChecked:n,initialValue:r,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function z9(t,e){e=e.checked,e!=null&&b$(t,"checked",e,!1)}function DD(t,e){z9(t,e);var r=ep(e.value),n=e.type;if(r!=null)n==="number"?(r===0&&t.value===""||t.value!=r)&&(t.value=""+r):t.value!==""+r&&(t.value=""+r);else if(n==="submit"||n==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?$D(t,e.type,r):e.hasOwnProperty("defaultValue")&&$D(t,e.type,ep(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function A7(t,e,r){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var n=e.type;if(!(n!=="submit"&&n!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,r||e===t.value||(t.value=e),t.defaultValue=e}r=t.name,r!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,r!==""&&(t.name=r)}function $D(t,e,r){(e!=="number"||aT(t.ownerDocument)!==t)&&(r==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+r&&(t.defaultValue=""+r))}var cb=Array.isArray;function bg(t,e,r,n){if(t=t.options,e){e={};for(var o=0;o<r.length;o++)e["$"+r[o]]=!0;for(r=0;r<t.length;r++)o=e.hasOwnProperty("$"+t[r].value),t[r].selected!==o&&(t[r].selected=o),o&&n&&(t[r].defaultSelected=!0)}else{for(r=""+ep(r),e=null,o=0;o<t.length;o++){if(t[o].value===r){t[o].selected=!0,n&&(t[o].defaultSelected=!0);return}e!==null||t[o].disabled||(e=t[o])}e!==null&&(e.selected=!0)}}function RD(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(he(91));return Ir({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function D7(t,e){var r=e.value;if(r==null){if(r=e.children,e=e.defaultValue,r!=null){if(e!=null)throw Error(he(92));if(cb(r)){if(1<r.length)throw Error(he(93));r=r[0]}e=r}e==null&&(e=""),r=e}t._wrapperState={initialValue:ep(r)}}function B9(t,e){var r=ep(e.value),n=ep(e.defaultValue);r!=null&&(r=""+r,r!==t.value&&(t.value=r),e.defaultValue==null&&t.defaultValue!==r&&(t.defaultValue=r)),n!=null&&(t.defaultValue=""+n)}function $7(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function V9(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function OD(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?V9(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Ok,W9=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,r,n,o){MSApp.execUnsafeLocalFunction(function(){return t(e,r,n,o)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Ok=Ok||document.createElement("div"),Ok.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Ok.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Sb(t,e){if(e){var r=t.firstChild;if(r&&r===t.lastChild&&r.nodeType===3){r.nodeValue=e;return}}t.textContent=e}var db={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Oge=["Webkit","ms","Moz","O"];Object.keys(db).forEach(function(t){Oge.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),db[e]=db[t]})});function G9(t,e,r){return e==null||typeof e=="boolean"||e===""?"":r||typeof e!="number"||e===0||db.hasOwnProperty(t)&&db[t]?(""+e).trim():e+"px"}function U9(t,e){t=t.style;for(var r in e)if(e.hasOwnProperty(r)){var n=r.indexOf("--")===0,o=G9(r,e[r],n);r==="float"&&(r="cssFloat"),n?t.setProperty(r,o):t[r]=o}}var Fge=Ir({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function FD(t,e){if(e){if(Fge[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(he(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(he(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(he(61))}if(e.style!=null&&typeof e.style!="object")throw Error(he(62))}}function PD(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var LD=null;function S$(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var MD=null,vg=null,wg=null;function R7(t){if(t=Vb(t)){if(typeof MD!="function")throw Error(he(280));var e=t.stateNode;e&&(e=FT(e),MD(t.stateNode,t.type,e))}}function H9(t){vg?wg?wg.push(t):wg=[t]:vg=t}function q9(){if(vg){var t=vg,e=wg;if(wg=vg=null,R7(t),e)for(t=0;t<e.length;t++)R7(e[t])}}function j9(t,e){return t(e)}function K9(){}var iD=!1;function X9(t,e,r){if(iD)return t(e,r);iD=!0;try{return j9(t,e,r)}finally{iD=!1,(vg!==null||wg!==null)&&(K9(),q9())}}function kb(t,e){var r=t.stateNode;if(r===null)return null;var n=FT(r);if(n===null)return null;r=n[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(t=t.type,n=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!n;break e;default:t=!1}if(t)return null;if(r&&typeof r!="function")throw Error(he(231,e,typeof r));return r}var zD=!1;if(ql)try{sg={},Object.defineProperty(sg,"passive",{get:function(){zD=!0}}),window.addEventListener("test",sg,sg),window.removeEventListener("test",sg,sg)}catch{zD=!1}var sg;function Pge(t,e,r,n,o,s,i,a,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(r,u)}catch(c){this.onError(c)}}var mb=!1,lT=null,uT=!1,BD=null,Lge={onError:function(t){mb=!0,lT=t}};function Mge(t,e,r,n,o,s,i,a,l){mb=!1,lT=null,Pge.apply(Lge,arguments)}function zge(t,e,r,n,o,s,i,a,l){if(Mge.apply(this,arguments),mb){if(mb){var u=lT;mb=!1,lT=null}else throw Error(he(198));uT||(uT=!0,BD=u)}}function td(t){var e=t,r=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,(e.flags&4098)!==0&&(r=e.return),t=e.return;while(t)}return e.tag===3?r:null}function Y9(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function O7(t){if(td(t)!==t)throw Error(he(188))}function Bge(t){var e=t.alternate;if(!e){if(e=td(t),e===null)throw Error(he(188));return e!==t?null:t}for(var r=t,n=e;;){var o=r.return;if(o===null)break;var s=o.alternate;if(s===null){if(n=o.return,n!==null){r=n;continue}break}if(o.child===s.child){for(s=o.child;s;){if(s===r)return O7(o),t;if(s===n)return O7(o),e;s=s.sibling}throw Error(he(188))}if(r.return!==n.return)r=o,n=s;else{for(var i=!1,a=o.child;a;){if(a===r){i=!0,r=o,n=s;break}if(a===n){i=!0,n=o,r=s;break}a=a.sibling}if(!i){for(a=s.child;a;){if(a===r){i=!0,r=s,n=o;break}if(a===n){i=!0,n=s,r=o;break}a=a.sibling}if(!i)throw Error(he(189))}}if(r.alternate!==n)throw Error(he(190))}if(r.tag!==3)throw Error(he(188));return r.stateNode.current===r?t:e}function Q9(t){return t=Bge(t),t!==null?Z9(t):null}function Z9(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=Z9(t);if(e!==null)return e;t=t.sibling}return null}var J9=as.unstable_scheduleCallback,F7=as.unstable_cancelCallback,Vge=as.unstable_shouldYield,Wge=as.unstable_requestPaint,Br=as.unstable_now,Gge=as.unstable_getCurrentPriorityLevel,k$=as.unstable_ImmediatePriority,eq=as.unstable_UserBlockingPriority,cT=as.unstable_NormalPriority,Uge=as.unstable_LowPriority,tq=as.unstable_IdlePriority,DT=null,aa=null;function Hge(t){if(aa&&typeof aa.onCommitFiberRoot=="function")try{aa.onCommitFiberRoot(DT,t,void 0,(t.current.flags&128)===128)}catch{}}var ki=Math.clz32?Math.clz32:Kge,qge=Math.log,jge=Math.LN2;function Kge(t){return t>>>=0,t===0?32:31-(qge(t)/jge|0)|0}var Fk=64,Pk=4194304;function pb(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function pT(t,e){var r=t.pendingLanes;if(r===0)return 0;var n=0,o=t.suspendedLanes,s=t.pingedLanes,i=r&268435455;if(i!==0){var a=i&~o;a!==0?n=pb(a):(s&=i,s!==0&&(n=pb(s)))}else i=r&~o,i!==0?n=pb(i):s!==0&&(n=pb(s));if(n===0)return 0;if(e!==0&&e!==n&&(e&o)===0&&(o=n&-n,s=e&-e,o>=s||o===16&&(s&4194240)!==0))return e;if((n&4)!==0&&(n|=r&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=n;0<e;)r=31-ki(e),o=1<<r,n|=t[r],e&=~o;return n}function Xge(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Yge(t,e){for(var r=t.suspendedLanes,n=t.pingedLanes,o=t.expirationTimes,s=t.pendingLanes;0<s;){var i=31-ki(s),a=1<<i,l=o[i];l===-1?((a&r)===0||(a&n)!==0)&&(o[i]=Xge(a,e)):l<=e&&(t.expiredLanes|=a),s&=~a}}function VD(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function rq(){var t=Fk;return Fk<<=1,(Fk&4194240)===0&&(Fk=64),t}function aD(t){for(var e=[],r=0;31>r;r++)e.push(t);return e}function zb(t,e,r){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-ki(e),t[e]=r}function Qge(t,e){var r=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var n=t.eventTimes;for(t=t.expirationTimes;0<r;){var o=31-ki(r),s=1<<o;e[o]=0,n[o]=-1,t[o]=-1,r&=~s}}function T$(t,e){var r=t.entangledLanes|=e;for(t=t.entanglements;r;){var n=31-ki(r),o=1<<n;o&e|t[n]&e&&(t[n]|=e),r&=~o}}var Mt=0;function nq(t){return t&=-t,1<t?4<t?(t&268435455)!==0?16:536870912:4:1}var oq,N$,sq,iq,aq,WD=!1,Lk=[],qc=null,jc=null,Kc=null,Tb=new Map,Nb=new Map,Wc=[],Zge="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function P7(t,e){switch(t){case"focusin":case"focusout":qc=null;break;case"dragenter":case"dragleave":jc=null;break;case"mouseover":case"mouseout":Kc=null;break;case"pointerover":case"pointerout":Tb.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Nb.delete(e.pointerId)}}function rb(t,e,r,n,o,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:r,eventSystemFlags:n,nativeEvent:s,targetContainers:[o]},e!==null&&(e=Vb(e),e!==null&&N$(e)),t):(t.eventSystemFlags|=n,e=t.targetContainers,o!==null&&e.indexOf(o)===-1&&e.push(o),t)}function Jge(t,e,r,n,o){switch(e){case"focusin":return qc=rb(qc,t,e,r,n,o),!0;case"dragenter":return jc=rb(jc,t,e,r,n,o),!0;case"mouseover":return Kc=rb(Kc,t,e,r,n,o),!0;case"pointerover":var s=o.pointerId;return Tb.set(s,rb(Tb.get(s)||null,t,e,r,n,o)),!0;case"gotpointercapture":return s=o.pointerId,Nb.set(s,rb(Nb.get(s)||null,t,e,r,n,o)),!0}return!1}function lq(t){var e=Uf(t.target);if(e!==null){var r=td(e);if(r!==null){if(e=r.tag,e===13){if(e=Y9(r),e!==null){t.blockedOn=e,aq(t.priority,function(){sq(r)});return}}else if(e===3&&r.stateNode.current.memoizedState.isDehydrated){t.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Qk(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var r=GD(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(r===null){r=t.nativeEvent;var n=new r.constructor(r.type,r);LD=n,r.target.dispatchEvent(n),LD=null}else return e=Vb(r),e!==null&&N$(e),t.blockedOn=r,!1;e.shift()}return!0}function L7(t,e,r){Qk(t)&&r.delete(e)}function exe(){WD=!1,qc!==null&&Qk(qc)&&(qc=null),jc!==null&&Qk(jc)&&(jc=null),Kc!==null&&Qk(Kc)&&(Kc=null),Tb.forEach(L7),Nb.forEach(L7)}function nb(t,e){t.blockedOn===e&&(t.blockedOn=null,WD||(WD=!0,as.unstable_scheduleCallback(as.unstable_NormalPriority,exe)))}function Ib(t){function e(o){return nb(o,t)}if(0<Lk.length){nb(Lk[0],t);for(var r=1;r<Lk.length;r++){var n=Lk[r];n.blockedOn===t&&(n.blockedOn=null)}}for(qc!==null&&nb(qc,t),jc!==null&&nb(jc,t),Kc!==null&&nb(Kc,t),Tb.forEach(e),Nb.forEach(e),r=0;r<Wc.length;r++)n=Wc[r],n.blockedOn===t&&(n.blockedOn=null);for(;0<Wc.length&&(r=Wc[0],r.blockedOn===null);)lq(r),r.blockedOn===null&&Wc.shift()}var Cg=Yl.ReactCurrentBatchConfig,fT=!0;function txe(t,e,r,n){var o=Mt,s=Cg.transition;Cg.transition=null;try{Mt=1,I$(t,e,r,n)}finally{Mt=o,Cg.transition=s}}function rxe(t,e,r,n){var o=Mt,s=Cg.transition;Cg.transition=null;try{Mt=4,I$(t,e,r,n)}finally{Mt=o,Cg.transition=s}}function I$(t,e,r,n){if(fT){var o=GD(t,e,r,n);if(o===null)mD(t,e,n,dT,r),P7(t,n);else if(Jge(o,t,e,r,n))n.stopPropagation();else if(P7(t,n),e&4&&-1<Zge.indexOf(t)){for(;o!==null;){var s=Vb(o);if(s!==null&&oq(s),s=GD(t,e,r,n),s===null&&mD(t,e,n,dT,r),s===o)break;o=s}o!==null&&n.stopPropagation()}else mD(t,e,n,null,r)}}var dT=null;function GD(t,e,r,n){if(dT=null,t=S$(n),t=Uf(t),t!==null)if(e=td(t),e===null)t=null;else if(r=e.tag,r===13){if(t=Y9(e),t!==null)return t;t=null}else if(r===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return dT=t,null}function uq(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Gge()){case k$:return 1;case eq:return 4;case cT:case Uge:return 16;case tq:return 536870912;default:return 16}default:return 16}}var Uc=null,E$=null,Zk=null;function cq(){if(Zk)return Zk;var t,e=E$,r=e.length,n,o="value"in Uc?Uc.value:Uc.textContent,s=o.length;for(t=0;t<r&&e[t]===o[t];t++);var i=r-t;for(n=1;n<=i&&e[r-n]===o[s-n];n++);return Zk=o.slice(t,1<n?1-n:void 0)}function Jk(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Mk(){return!0}function M7(){return!1}function ls(t){function e(r,n,o,s,i){this._reactName=r,this._targetInst=o,this.type=n,this.nativeEvent=s,this.target=i,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(r=t[a],this[a]=r?r(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?Mk:M7,this.isPropagationStopped=M7,this}return Ir(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=Mk)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=Mk)},persist:function(){},isPersistent:Mk}),e}var $g={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},_$=ls($g),Bb=Ir({},$g,{view:0,detail:0}),nxe=ls(Bb),lD,uD,ob,$T=Ir({},Bb,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:A$,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==ob&&(ob&&t.type==="mousemove"?(lD=t.screenX-ob.screenX,uD=t.screenY-ob.screenY):uD=lD=0,ob=t),lD)},movementY:function(t){return"movementY"in t?t.movementY:uD}}),z7=ls($T),oxe=Ir({},$T,{dataTransfer:0}),sxe=ls(oxe),ixe=Ir({},Bb,{relatedTarget:0}),cD=ls(ixe),axe=Ir({},$g,{animationName:0,elapsedTime:0,pseudoElement:0}),lxe=ls(axe),uxe=Ir({},$g,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),cxe=ls(uxe),pxe=Ir({},$g,{data:0}),B7=ls(pxe),fxe={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},dxe={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},mxe={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function hxe(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=mxe[t])?!!e[t]:!1}function A$(){return hxe}var gxe=Ir({},Bb,{key:function(t){if(t.key){var e=fxe[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Jk(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?dxe[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:A$,charCode:function(t){return t.type==="keypress"?Jk(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Jk(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),xxe=ls(gxe),yxe=Ir({},$T,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),V7=ls(yxe),bxe=Ir({},Bb,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:A$}),vxe=ls(bxe),wxe=Ir({},$g,{propertyName:0,elapsedTime:0,pseudoElement:0}),Cxe=ls(wxe),Sxe=Ir({},$T,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),kxe=ls(Sxe),Txe=[9,13,27,32],D$=ql&&"CompositionEvent"in window,hb=null;ql&&"documentMode"in document&&(hb=document.documentMode);var Nxe=ql&&"TextEvent"in window&&!hb,pq=ql&&(!D$||hb&&8<hb&&11>=hb),W7=String.fromCharCode(32),G7=!1;function fq(t,e){switch(t){case"keyup":return Txe.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function dq(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var ug=!1;function Ixe(t,e){switch(t){case"compositionend":return dq(e);case"keypress":return e.which!==32?null:(G7=!0,W7);case"textInput":return t=e.data,t===W7&&G7?null:t;default:return null}}function Exe(t,e){if(ug)return t==="compositionend"||!D$&&fq(t,e)?(t=cq(),Zk=E$=Uc=null,ug=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return pq&&e.locale!=="ko"?null:e.data;default:return null}}var _xe={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function U7(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!_xe[t.type]:e==="textarea"}function mq(t,e,r,n){H9(n),e=mT(e,"onChange"),0<e.length&&(r=new _$("onChange","change",null,r,n),t.push({event:r,listeners:e}))}var gb=null,Eb=null;function Axe(t){Tq(t,0)}function RT(t){var e=fg(t);if(M9(e))return t}function Dxe(t,e){if(t==="change")return e}var hq=!1;ql&&(ql?(Bk="oninput"in document,Bk||(pD=document.createElement("div"),pD.setAttribute("oninput","return;"),Bk=typeof pD.oninput=="function"),zk=Bk):zk=!1,hq=zk&&(!document.documentMode||9<document.documentMode));var zk,Bk,pD;function H7(){gb&&(gb.detachEvent("onpropertychange",gq),Eb=gb=null)}function gq(t){if(t.propertyName==="value"&&RT(Eb)){var e=[];mq(e,Eb,t,S$(t)),X9(Axe,e)}}function $xe(t,e,r){t==="focusin"?(H7(),gb=e,Eb=r,gb.attachEvent("onpropertychange",gq)):t==="focusout"&&H7()}function Rxe(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return RT(Eb)}function Oxe(t,e){if(t==="click")return RT(e)}function Fxe(t,e){if(t==="input"||t==="change")return RT(e)}function Pxe(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Ni=typeof Object.is=="function"?Object.is:Pxe;function _b(t,e){if(Ni(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var o=r[n];if(!TD.call(e,o)||!Ni(t[o],e[o]))return!1}return!0}function q7(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function j7(t,e){var r=q7(t);t=0;for(var n;r;){if(r.nodeType===3){if(n=t+r.textContent.length,t<=e&&n>=e)return{node:r,offset:e-t};t=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=q7(r)}}function xq(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?xq(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function yq(){for(var t=window,e=aT();e instanceof t.HTMLIFrameElement;){try{var r=typeof e.contentWindow.location.href=="string"}catch{r=!1}if(r)t=e.contentWindow;else break;e=aT(t.document)}return e}function $$(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function Lxe(t){var e=yq(),r=t.focusedElem,n=t.selectionRange;if(e!==r&&r&&r.ownerDocument&&xq(r.ownerDocument.documentElement,r)){if(n!==null&&$$(r)){if(e=n.start,t=n.end,t===void 0&&(t=e),"selectionStart"in r)r.selectionStart=e,r.selectionEnd=Math.min(t,r.value.length);else if(t=(e=r.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var o=r.textContent.length,s=Math.min(n.start,o);n=n.end===void 0?s:Math.min(n.end,o),!t.extend&&s>n&&(o=n,n=s,s=o),o=j7(r,s);var i=j7(r,n);o&&i&&(t.rangeCount!==1||t.anchorNode!==o.node||t.anchorOffset!==o.offset||t.focusNode!==i.node||t.focusOffset!==i.offset)&&(e=e.createRange(),e.setStart(o.node,o.offset),t.removeAllRanges(),s>n?(t.addRange(e),t.extend(i.node,i.offset)):(e.setEnd(i.node,i.offset),t.addRange(e)))}}for(e=[],t=r;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<e.length;r++)t=e[r],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var Mxe=ql&&"documentMode"in document&&11>=document.documentMode,cg=null,UD=null,xb=null,HD=!1;function K7(t,e,r){var n=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;HD||cg==null||cg!==aT(n)||(n=cg,"selectionStart"in n&&$$(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),xb&&_b(xb,n)||(xb=n,n=mT(UD,"onSelect"),0<n.length&&(e=new _$("onSelect","select",null,e,r),t.push({event:e,listeners:n}),e.target=cg)))}function Vk(t,e){var r={};return r[t.toLowerCase()]=e.toLowerCase(),r["Webkit"+t]="webkit"+e,r["Moz"+t]="moz"+e,r}var pg={animationend:Vk("Animation","AnimationEnd"),animationiteration:Vk("Animation","AnimationIteration"),animationstart:Vk("Animation","AnimationStart"),transitionend:Vk("Transition","TransitionEnd")},fD={},bq={};ql&&(bq=document.createElement("div").style,"AnimationEvent"in window||(delete pg.animationend.animation,delete pg.animationiteration.animation,delete pg.animationstart.animation),"TransitionEvent"in window||delete pg.transitionend.transition);function OT(t){if(fD[t])return fD[t];if(!pg[t])return t;var e=pg[t],r;for(r in e)if(e.hasOwnProperty(r)&&r in bq)return fD[t]=e[r];return t}var vq=OT("animationend"),wq=OT("animationiteration"),Cq=OT("animationstart"),Sq=OT("transitionend"),kq=new Map,X7="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function rp(t,e){kq.set(t,e),ed(e,[t])}for(Wk=0;Wk<X7.length;Wk++)Gk=X7[Wk],Y7=Gk.toLowerCase(),Q7=Gk[0].toUpperCase()+Gk.slice(1),rp(Y7,"on"+Q7);var Gk,Y7,Q7,Wk;rp(vq,"onAnimationEnd");rp(wq,"onAnimationIteration");rp(Cq,"onAnimationStart");rp("dblclick","onDoubleClick");rp("focusin","onFocus");rp("focusout","onBlur");rp(Sq,"onTransitionEnd");Tg("onMouseEnter",["mouseout","mouseover"]);Tg("onMouseLeave",["mouseout","mouseover"]);Tg("onPointerEnter",["pointerout","pointerover"]);Tg("onPointerLeave",["pointerout","pointerover"]);ed("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ed("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ed("onBeforeInput",["compositionend","keypress","textInput","paste"]);ed("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ed("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ed("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var fb="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),zxe=new Set("cancel close invalid load scroll toggle".split(" ").concat(fb));function Z7(t,e,r){var n=t.type||"unknown-event";t.currentTarget=r,zge(n,e,void 0,t),t.currentTarget=null}function Tq(t,e){e=(e&4)!==0;for(var r=0;r<t.length;r++){var n=t[r],o=n.event;n=n.listeners;e:{var s=void 0;if(e)for(var i=n.length-1;0<=i;i--){var a=n[i],l=a.instance,u=a.currentTarget;if(a=a.listener,l!==s&&o.isPropagationStopped())break e;Z7(o,a,u),s=l}else for(i=0;i<n.length;i++){if(a=n[i],l=a.instance,u=a.currentTarget,a=a.listener,l!==s&&o.isPropagationStopped())break e;Z7(o,a,u),s=l}}}if(uT)throw t=BD,uT=!1,BD=null,t}function pr(t,e){var r=e[YD];r===void 0&&(r=e[YD]=new Set);var n=t+"__bubble";r.has(n)||(Nq(e,t,2,!1),r.add(n))}function dD(t,e,r){var n=0;e&&(n|=4),Nq(r,t,n,e)}var Uk="_reactListening"+Math.random().toString(36).slice(2);function Ab(t){if(!t[Uk]){t[Uk]=!0,R9.forEach(function(r){r!=="selectionchange"&&(zxe.has(r)||dD(r,!1,t),dD(r,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Uk]||(e[Uk]=!0,dD("selectionchange",!1,e))}}function Nq(t,e,r,n){switch(uq(e)){case 1:var o=txe;break;case 4:o=rxe;break;default:o=I$}r=o.bind(null,e,r,t),o=void 0,!zD||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(o=!0),n?o!==void 0?t.addEventListener(e,r,{capture:!0,passive:o}):t.addEventListener(e,r,!0):o!==void 0?t.addEventListener(e,r,{passive:o}):t.addEventListener(e,r,!1)}function mD(t,e,r,n,o){var s=n;if((e&1)===0&&(e&2)===0&&n!==null)e:for(;;){if(n===null)return;var i=n.tag;if(i===3||i===4){var a=n.stateNode.containerInfo;if(a===o||a.nodeType===8&&a.parentNode===o)break;if(i===4)for(i=n.return;i!==null;){var l=i.tag;if((l===3||l===4)&&(l=i.stateNode.containerInfo,l===o||l.nodeType===8&&l.parentNode===o))return;i=i.return}for(;a!==null;){if(i=Uf(a),i===null)return;if(l=i.tag,l===5||l===6){n=s=i;continue e}a=a.parentNode}}n=n.return}X9(function(){var u=s,c=S$(r),p=[];e:{var f=kq.get(t);if(f!==void 0){var d=_$,m=t;switch(t){case"keypress":if(Jk(r)===0)break e;case"keydown":case"keyup":d=xxe;break;case"focusin":m="focus",d=cD;break;case"focusout":m="blur",d=cD;break;case"beforeblur":case"afterblur":d=cD;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":d=z7;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":d=sxe;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":d=vxe;break;case vq:case wq:case Cq:d=lxe;break;case Sq:d=Cxe;break;case"scroll":d=nxe;break;case"wheel":d=kxe;break;case"copy":case"cut":case"paste":d=cxe;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":d=V7}var h=(e&4)!==0,x=!h&&t==="scroll",g=h?f!==null?f+"Capture":null:f;h=[];for(var y=u,b;y!==null;){b=y;var v=b.stateNode;if(b.tag===5&&v!==null&&(b=v,g!==null&&(v=kb(y,g),v!=null&&h.push(Db(y,v,b)))),x)break;y=y.return}0<h.length&&(f=new d(f,m,null,r,c),p.push({event:f,listeners:h}))}}if((e&7)===0){e:{if(f=t==="mouseover"||t==="pointerover",d=t==="mouseout"||t==="pointerout",f&&r!==LD&&(m=r.relatedTarget||r.fromElement)&&(Uf(m)||m[jl]))break e;if((d||f)&&(f=c.window===c?c:(f=c.ownerDocument)?f.defaultView||f.parentWindow:window,d?(m=r.relatedTarget||r.toElement,d=u,m=m?Uf(m):null,m!==null&&(x=td(m),m!==x||m.tag!==5&&m.tag!==6)&&(m=null)):(d=null,m=u),d!==m)){if(h=z7,v="onMouseLeave",g="onMouseEnter",y="mouse",(t==="pointerout"||t==="pointerover")&&(h=V7,v="onPointerLeave",g="onPointerEnter",y="pointer"),x=d==null?f:fg(d),b=m==null?f:fg(m),f=new h(v,y+"leave",d,r,c),f.target=x,f.relatedTarget=b,v=null,Uf(c)===u&&(h=new h(g,y+"enter",m,r,c),h.target=b,h.relatedTarget=x,v=h),x=v,d&&m)t:{for(h=d,g=m,y=0,b=h;b;b=ig(b))y++;for(b=0,v=g;v;v=ig(v))b++;for(;0<y-b;)h=ig(h),y--;for(;0<b-y;)g=ig(g),b--;for(;y--;){if(h===g||g!==null&&h===g.alternate)break t;h=ig(h),g=ig(g)}h=null}else h=null;d!==null&&J7(p,f,d,h,!1),m!==null&&x!==null&&J7(p,x,m,h,!0)}}e:{if(f=u?fg(u):window,d=f.nodeName&&f.nodeName.toLowerCase(),d==="select"||d==="input"&&f.type==="file")var C=Dxe;else if(U7(f))if(hq)C=Fxe;else{C=Rxe;var S=$xe}else(d=f.nodeName)&&d.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(C=Oxe);if(C&&(C=C(t,u))){mq(p,C,r,c);break e}S&&S(t,f,u),t==="focusout"&&(S=f._wrapperState)&&S.controlled&&f.type==="number"&&$D(f,"number",f.value)}switch(S=u?fg(u):window,t){case"focusin":(U7(S)||S.contentEditable==="true")&&(cg=S,UD=u,xb=null);break;case"focusout":xb=UD=cg=null;break;case"mousedown":HD=!0;break;case"contextmenu":case"mouseup":case"dragend":HD=!1,K7(p,r,c);break;case"selectionchange":if(Mxe)break;case"keydown":case"keyup":K7(p,r,c)}var k;if(D$)e:{switch(t){case"compositionstart":var I="onCompositionStart";break e;case"compositionend":I="onCompositionEnd";break e;case"compositionupdate":I="onCompositionUpdate";break e}I=void 0}else ug?fq(t,r)&&(I="onCompositionEnd"):t==="keydown"&&r.keyCode===229&&(I="onCompositionStart");I&&(pq&&r.locale!=="ko"&&(ug||I!=="onCompositionStart"?I==="onCompositionEnd"&&ug&&(k=cq()):(Uc=c,E$="value"in Uc?Uc.value:Uc.textContent,ug=!0)),S=mT(u,I),0<S.length&&(I=new B7(I,t,null,r,c),p.push({event:I,listeners:S}),k?I.data=k:(k=dq(r),k!==null&&(I.data=k)))),(k=Nxe?Ixe(t,r):Exe(t,r))&&(u=mT(u,"onBeforeInput"),0<u.length&&(c=new B7("onBeforeInput","beforeinput",null,r,c),p.push({event:c,listeners:u}),c.data=k))}Tq(p,e)})}function Db(t,e,r){return{instance:t,listener:e,currentTarget:r}}function mT(t,e){for(var r=e+"Capture",n=[];t!==null;){var o=t,s=o.stateNode;o.tag===5&&s!==null&&(o=s,s=kb(t,r),s!=null&&n.unshift(Db(t,s,o)),s=kb(t,e),s!=null&&n.push(Db(t,s,o))),t=t.return}return n}function ig(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function J7(t,e,r,n,o){for(var s=e._reactName,i=[];r!==null&&r!==n;){var a=r,l=a.alternate,u=a.stateNode;if(l!==null&&l===n)break;a.tag===5&&u!==null&&(a=u,o?(l=kb(r,s),l!=null&&i.unshift(Db(r,l,a))):o||(l=kb(r,s),l!=null&&i.push(Db(r,l,a)))),r=r.return}i.length!==0&&t.push({event:e,listeners:i})}var Bxe=/\r\n?/g,Vxe=/\u0000|\uFFFD/g;function e9(t){return(typeof t=="string"?t:""+t).replace(Bxe,`
`).replace(Vxe,"")}function Hk(t,e,r){if(e=e9(e),e9(t)!==e&&r)throw Error(he(425))}function hT(){}var qD=null,jD=null;function KD(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var XD=typeof setTimeout=="function"?setTimeout:void 0,Wxe=typeof clearTimeout=="function"?clearTimeout:void 0,t9=typeof Promise=="function"?Promise:void 0,Gxe=typeof queueMicrotask=="function"?queueMicrotask:typeof t9<"u"?function(t){return t9.resolve(null).then(t).catch(Uxe)}:XD;function Uxe(t){setTimeout(function(){throw t})}function hD(t,e){var r=e,n=0;do{var o=r.nextSibling;if(t.removeChild(r),o&&o.nodeType===8)if(r=o.data,r==="/$"){if(n===0){t.removeChild(o),Ib(e);return}n--}else r!=="$"&&r!=="$?"&&r!=="$!"||n++;r=o}while(r);Ib(e)}function Xc(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function r9(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var r=t.data;if(r==="$"||r==="$!"||r==="$?"){if(e===0)return t;e--}else r==="/$"&&e++}t=t.previousSibling}return null}var Rg=Math.random().toString(36).slice(2),ia="__reactFiber$"+Rg,$b="__reactProps$"+Rg,jl="__reactContainer$"+Rg,YD="__reactEvents$"+Rg,Hxe="__reactListeners$"+Rg,qxe="__reactHandles$"+Rg;function Uf(t){var e=t[ia];if(e)return e;for(var r=t.parentNode;r;){if(e=r[jl]||r[ia]){if(r=e.alternate,e.child!==null||r!==null&&r.child!==null)for(t=r9(t);t!==null;){if(r=t[ia])return r;t=r9(t)}return e}t=r,r=t.parentNode}return null}function Vb(t){return t=t[ia]||t[jl],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function fg(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(he(33))}function FT(t){return t[$b]||null}var QD=[],dg=-1;function np(t){return{current:t}}function fr(t){0>dg||(t.current=QD[dg],QD[dg]=null,dg--)}function nr(t,e){dg++,QD[dg]=t.current,t.current=e}var tp={},ro=np(tp),Mo=np(!1),Xf=tp;function Ng(t,e){var r=t.type.contextTypes;if(!r)return tp;var n=t.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===e)return n.__reactInternalMemoizedMaskedChildContext;var o={},s;for(s in r)o[s]=e[s];return n&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=o),o}function zo(t){return t=t.childContextTypes,t!=null}function gT(){fr(Mo),fr(ro)}function n9(t,e,r){if(ro.current!==tp)throw Error(he(168));nr(ro,e),nr(Mo,r)}function Iq(t,e,r){var n=t.stateNode;if(e=e.childContextTypes,typeof n.getChildContext!="function")return r;n=n.getChildContext();for(var o in n)if(!(o in e))throw Error(he(108,$ge(t)||"Unknown",o));return Ir({},r,n)}function xT(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||tp,Xf=ro.current,nr(ro,t),nr(Mo,Mo.current),!0}function o9(t,e,r){var n=t.stateNode;if(!n)throw Error(he(169));r?(t=Iq(t,e,Xf),n.__reactInternalMemoizedMergedChildContext=t,fr(Mo),fr(ro),nr(ro,t)):fr(Mo),nr(Mo,r)}var Wl=null,PT=!1,gD=!1;function Eq(t){Wl===null?Wl=[t]:Wl.push(t)}function jxe(t){PT=!0,Eq(t)}function op(){if(!gD&&Wl!==null){gD=!0;var t=0,e=Mt;try{var r=Wl;for(Mt=1;t<r.length;t++){var n=r[t];do n=n(!0);while(n!==null)}Wl=null,PT=!1}catch(o){throw Wl!==null&&(Wl=Wl.slice(t+1)),J9(k$,op),o}finally{Mt=e,gD=!1}}return null}var mg=[],hg=0,yT=null,bT=0,Ws=[],Gs=0,Yf=null,Gl=1,Ul="";function Wf(t,e){mg[hg++]=bT,mg[hg++]=yT,yT=t,bT=e}function _q(t,e,r){Ws[Gs++]=Gl,Ws[Gs++]=Ul,Ws[Gs++]=Yf,Yf=t;var n=Gl;t=Ul;var o=32-ki(n)-1;n&=~(1<<o),r+=1;var s=32-ki(e)+o;if(30<s){var i=o-o%5;s=(n&(1<<i)-1).toString(32),n>>=i,o-=i,Gl=1<<32-ki(e)+o|r<<o|n,Ul=s+t}else Gl=1<<s|r<<o|n,Ul=t}function R$(t){t.return!==null&&(Wf(t,1),_q(t,1,0))}function O$(t){for(;t===yT;)yT=mg[--hg],mg[hg]=null,bT=mg[--hg],mg[hg]=null;for(;t===Yf;)Yf=Ws[--Gs],Ws[Gs]=null,Ul=Ws[--Gs],Ws[Gs]=null,Gl=Ws[--Gs],Ws[Gs]=null}var is=null,ss=null,gr=!1,Si=null;function Aq(t,e){var r=Us(5,null,null,0);r.elementType="DELETED",r.stateNode=e,r.return=t,e=t.deletions,e===null?(t.deletions=[r],t.flags|=16):e.push(r)}function s9(t,e){switch(t.tag){case 5:var r=t.type;return e=e.nodeType!==1||r.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,is=t,ss=Xc(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,is=t,ss=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(r=Yf!==null?{id:Gl,overflow:Ul}:null,t.memoizedState={dehydrated:e,treeContext:r,retryLane:1073741824},r=Us(18,null,null,0),r.stateNode=e,r.return=t,t.child=r,is=t,ss=null,!0):!1;default:return!1}}function ZD(t){return(t.mode&1)!==0&&(t.flags&128)===0}function JD(t){if(gr){var e=ss;if(e){var r=e;if(!s9(t,e)){if(ZD(t))throw Error(he(418));e=Xc(r.nextSibling);var n=is;e&&s9(t,e)?Aq(n,r):(t.flags=t.flags&-4097|2,gr=!1,is=t)}}else{if(ZD(t))throw Error(he(418));t.flags=t.flags&-4097|2,gr=!1,is=t}}}function i9(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;is=t}function qk(t){if(t!==is)return!1;if(!gr)return i9(t),gr=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!KD(t.type,t.memoizedProps)),e&&(e=ss)){if(ZD(t))throw Dq(),Error(he(418));for(;e;)Aq(t,e),e=Xc(e.nextSibling)}if(i9(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(he(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var r=t.data;if(r==="/$"){if(e===0){ss=Xc(t.nextSibling);break e}e--}else r!=="$"&&r!=="$!"&&r!=="$?"||e++}t=t.nextSibling}ss=null}}else ss=is?Xc(t.stateNode.nextSibling):null;return!0}function Dq(){for(var t=ss;t;)t=Xc(t.nextSibling)}function Ig(){ss=is=null,gr=!1}function F$(t){Si===null?Si=[t]:Si.push(t)}var Kxe=Yl.ReactCurrentBatchConfig;function wi(t,e){if(t&&t.defaultProps){e=Ir({},e),t=t.defaultProps;for(var r in t)e[r]===void 0&&(e[r]=t[r]);return e}return e}var vT=np(null),wT=null,gg=null,P$=null;function L$(){P$=gg=wT=null}function M$(t){var e=vT.current;fr(vT),t._currentValue=e}function e$(t,e,r){for(;t!==null;){var n=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,n!==null&&(n.childLanes|=e)):n!==null&&(n.childLanes&e)!==e&&(n.childLanes|=e),t===r)break;t=t.return}}function Sg(t,e){wT=t,P$=gg=null,t=t.dependencies,t!==null&&t.firstContext!==null&&((t.lanes&e)!==0&&(Lo=!0),t.firstContext=null)}function qs(t){var e=t._currentValue;if(P$!==t)if(t={context:t,memoizedValue:e,next:null},gg===null){if(wT===null)throw Error(he(308));gg=t,wT.dependencies={lanes:0,firstContext:t}}else gg=gg.next=t;return e}var Hf=null;function z$(t){Hf===null?Hf=[t]:Hf.push(t)}function $q(t,e,r,n){var o=e.interleaved;return o===null?(r.next=r,z$(e)):(r.next=o.next,o.next=r),e.interleaved=r,Kl(t,n)}function Kl(t,e){t.lanes|=e;var r=t.alternate;for(r!==null&&(r.lanes|=e),r=t,t=t.return;t!==null;)t.childLanes|=e,r=t.alternate,r!==null&&(r.childLanes|=e),r=t,t=t.return;return r.tag===3?r.stateNode:null}var Vc=!1;function B$(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Rq(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Hl(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Yc(t,e,r){var n=t.updateQueue;if(n===null)return null;if(n=n.shared,(xt&2)!==0){var o=n.pending;return o===null?e.next=e:(e.next=o.next,o.next=e),n.pending=e,Kl(t,r)}return o=n.interleaved,o===null?(e.next=e,z$(n)):(e.next=o.next,o.next=e),n.interleaved=e,Kl(t,r)}function eT(t,e,r){if(e=e.updateQueue,e!==null&&(e=e.shared,(r&4194240)!==0)){var n=e.lanes;n&=t.pendingLanes,r|=n,e.lanes=r,T$(t,r)}}function a9(t,e){var r=t.updateQueue,n=t.alternate;if(n!==null&&(n=n.updateQueue,r===n)){var o=null,s=null;if(r=r.firstBaseUpdate,r!==null){do{var i={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};s===null?o=s=i:s=s.next=i,r=r.next}while(r!==null);s===null?o=s=e:s=s.next=e}else o=s=e;r={baseState:n.baseState,firstBaseUpdate:o,lastBaseUpdate:s,shared:n.shared,effects:n.effects},t.updateQueue=r;return}t=r.lastBaseUpdate,t===null?r.firstBaseUpdate=e:t.next=e,r.lastBaseUpdate=e}function CT(t,e,r,n){var o=t.updateQueue;Vc=!1;var s=o.firstBaseUpdate,i=o.lastBaseUpdate,a=o.shared.pending;if(a!==null){o.shared.pending=null;var l=a,u=l.next;l.next=null,i===null?s=u:i.next=u,i=l;var c=t.alternate;c!==null&&(c=c.updateQueue,a=c.lastBaseUpdate,a!==i&&(a===null?c.firstBaseUpdate=u:a.next=u,c.lastBaseUpdate=l))}if(s!==null){var p=o.baseState;i=0,c=u=l=null,a=s;do{var f=a.lane,d=a.eventTime;if((n&f)===f){c!==null&&(c=c.next={eventTime:d,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var m=t,h=a;switch(f=e,d=r,h.tag){case 1:if(m=h.payload,typeof m=="function"){p=m.call(d,p,f);break e}p=m;break e;case 3:m.flags=m.flags&-65537|128;case 0:if(m=h.payload,f=typeof m=="function"?m.call(d,p,f):m,f==null)break e;p=Ir({},p,f);break e;case 2:Vc=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,f=o.effects,f===null?o.effects=[a]:f.push(a))}else d={eventTime:d,lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},c===null?(u=c=d,l=p):c=c.next=d,i|=f;if(a=a.next,a===null){if(a=o.shared.pending,a===null)break;f=a,a=f.next,f.next=null,o.lastBaseUpdate=f,o.shared.pending=null}}while(1);if(c===null&&(l=p),o.baseState=l,o.firstBaseUpdate=u,o.lastBaseUpdate=c,e=o.shared.interleaved,e!==null){o=e;do i|=o.lane,o=o.next;while(o!==e)}else s===null&&(o.shared.lanes=0);Zf|=i,t.lanes=i,t.memoizedState=p}}function l9(t,e,r){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var n=t[e],o=n.callback;if(o!==null){if(n.callback=null,n=r,typeof o!="function")throw Error(he(191,o));o.call(n)}}}var Oq=new $9.Component().refs;function t$(t,e,r,n){e=t.memoizedState,r=r(n,e),r=r==null?e:Ir({},e,r),t.memoizedState=r,t.lanes===0&&(t.updateQueue.baseState=r)}var LT={isMounted:function(t){return(t=t._reactInternals)?td(t)===t:!1},enqueueSetState:function(t,e,r){t=t._reactInternals;var n=mo(),o=Zc(t),s=Hl(n,o);s.payload=e,r!=null&&(s.callback=r),e=Yc(t,s,o),e!==null&&(Ti(e,t,o,n),eT(e,t,o))},enqueueReplaceState:function(t,e,r){t=t._reactInternals;var n=mo(),o=Zc(t),s=Hl(n,o);s.tag=1,s.payload=e,r!=null&&(s.callback=r),e=Yc(t,s,o),e!==null&&(Ti(e,t,o,n),eT(e,t,o))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var r=mo(),n=Zc(t),o=Hl(r,n);o.tag=2,e!=null&&(o.callback=e),e=Yc(t,o,n),e!==null&&(Ti(e,t,n,r),eT(e,t,n))}};function u9(t,e,r,n,o,s,i){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(n,s,i):e.prototype&&e.prototype.isPureReactComponent?!_b(r,n)||!_b(o,s):!0}function Fq(t,e,r){var n=!1,o=tp,s=e.contextType;return typeof s=="object"&&s!==null?s=qs(s):(o=zo(e)?Xf:ro.current,n=e.contextTypes,s=(n=n!=null)?Ng(t,o):tp),e=new e(r,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=LT,t.stateNode=e,e._reactInternals=t,n&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=o,t.__reactInternalMemoizedMaskedChildContext=s),e}function c9(t,e,r,n){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(r,n),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(r,n),e.state!==t&&LT.enqueueReplaceState(e,e.state,null)}function r$(t,e,r,n){var o=t.stateNode;o.props=r,o.state=t.memoizedState,o.refs=Oq,B$(t);var s=e.contextType;typeof s=="object"&&s!==null?o.context=qs(s):(s=zo(e)?Xf:ro.current,o.context=Ng(t,s)),o.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(t$(t,e,s,r),o.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof o.getSnapshotBeforeUpdate=="function"||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(e=o.state,typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount(),e!==o.state&&LT.enqueueReplaceState(o,o.state,null),CT(t,r,o,n),o.state=t.memoizedState),typeof o.componentDidMount=="function"&&(t.flags|=4194308)}function sb(t,e,r){if(t=r.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(he(309));var n=r.stateNode}if(!n)throw Error(he(147,t));var o=n,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(i){var a=o.refs;a===Oq&&(a=o.refs={}),i===null?delete a[s]:a[s]=i},e._stringRef=s,e)}if(typeof t!="string")throw Error(he(284));if(!r._owner)throw Error(he(290,t))}return t}function jk(t,e){throw t=Object.prototype.toString.call(e),Error(he(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function p9(t){var e=t._init;return e(t._payload)}function Pq(t){function e(g,y){if(t){var b=g.deletions;b===null?(g.deletions=[y],g.flags|=16):b.push(y)}}function r(g,y){if(!t)return null;for(;y!==null;)e(g,y),y=y.sibling;return null}function n(g,y){for(g=new Map;y!==null;)y.key!==null?g.set(y.key,y):g.set(y.index,y),y=y.sibling;return g}function o(g,y){return g=Jc(g,y),g.index=0,g.sibling=null,g}function s(g,y,b){return g.index=b,t?(b=g.alternate,b!==null?(b=b.index,b<y?(g.flags|=2,y):b):(g.flags|=2,y)):(g.flags|=1048576,y)}function i(g){return t&&g.alternate===null&&(g.flags|=2),g}function a(g,y,b,v){return y===null||y.tag!==6?(y=SD(b,g.mode,v),y.return=g,y):(y=o(y,b),y.return=g,y)}function l(g,y,b,v){var C=b.type;return C===lg?c(g,y,b.props.children,v,b.key):y!==null&&(y.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===Bc&&p9(C)===y.type)?(v=o(y,b.props),v.ref=sb(g,y,b),v.return=g,v):(v=iT(b.type,b.key,b.props,null,g.mode,v),v.ref=sb(g,y,b),v.return=g,v)}function u(g,y,b,v){return y===null||y.tag!==4||y.stateNode.containerInfo!==b.containerInfo||y.stateNode.implementation!==b.implementation?(y=kD(b,g.mode,v),y.return=g,y):(y=o(y,b.children||[]),y.return=g,y)}function c(g,y,b,v,C){return y===null||y.tag!==7?(y=Kf(b,g.mode,v,C),y.return=g,y):(y=o(y,b),y.return=g,y)}function p(g,y,b){if(typeof y=="string"&&y!==""||typeof y=="number")return y=SD(""+y,g.mode,b),y.return=g,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case $k:return b=iT(y.type,y.key,y.props,null,g.mode,b),b.ref=sb(g,null,y),b.return=g,b;case ag:return y=kD(y,g.mode,b),y.return=g,y;case Bc:var v=y._init;return p(g,v(y._payload),b)}if(cb(y)||tb(y))return y=Kf(y,g.mode,b,null),y.return=g,y;jk(g,y)}return null}function f(g,y,b,v){var C=y!==null?y.key:null;if(typeof b=="string"&&b!==""||typeof b=="number")return C!==null?null:a(g,y,""+b,v);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case $k:return b.key===C?l(g,y,b,v):null;case ag:return b.key===C?u(g,y,b,v):null;case Bc:return C=b._init,f(g,y,C(b._payload),v)}if(cb(b)||tb(b))return C!==null?null:c(g,y,b,v,null);jk(g,b)}return null}function d(g,y,b,v,C){if(typeof v=="string"&&v!==""||typeof v=="number")return g=g.get(b)||null,a(y,g,""+v,C);if(typeof v=="object"&&v!==null){switch(v.$$typeof){case $k:return g=g.get(v.key===null?b:v.key)||null,l(y,g,v,C);case ag:return g=g.get(v.key===null?b:v.key)||null,u(y,g,v,C);case Bc:var S=v._init;return d(g,y,b,S(v._payload),C)}if(cb(v)||tb(v))return g=g.get(b)||null,c(y,g,v,C,null);jk(y,v)}return null}function m(g,y,b,v){for(var C=null,S=null,k=y,I=y=0,A=null;k!==null&&I<b.length;I++){k.index>I?(A=k,k=null):A=k.sibling;var $=f(g,k,b[I],v);if($===null){k===null&&(k=A);break}t&&k&&$.alternate===null&&e(g,k),y=s($,y,I),S===null?C=$:S.sibling=$,S=$,k=A}if(I===b.length)return r(g,k),gr&&Wf(g,I),C;if(k===null){for(;I<b.length;I++)k=p(g,b[I],v),k!==null&&(y=s(k,y,I),S===null?C=k:S.sibling=k,S=k);return gr&&Wf(g,I),C}for(k=n(g,k);I<b.length;I++)A=d(k,g,I,b[I],v),A!==null&&(t&&A.alternate!==null&&k.delete(A.key===null?I:A.key),y=s(A,y,I),S===null?C=A:S.sibling=A,S=A);return t&&k.forEach(function(O){return e(g,O)}),gr&&Wf(g,I),C}function h(g,y,b,v){var C=tb(b);if(typeof C!="function")throw Error(he(150));if(b=C.call(b),b==null)throw Error(he(151));for(var S=C=null,k=y,I=y=0,A=null,$=b.next();k!==null&&!$.done;I++,$=b.next()){k.index>I?(A=k,k=null):A=k.sibling;var O=f(g,k,$.value,v);if(O===null){k===null&&(k=A);break}t&&k&&O.alternate===null&&e(g,k),y=s(O,y,I),S===null?C=O:S.sibling=O,S=O,k=A}if($.done)return r(g,k),gr&&Wf(g,I),C;if(k===null){for(;!$.done;I++,$=b.next())$=p(g,$.value,v),$!==null&&(y=s($,y,I),S===null?C=$:S.sibling=$,S=$);return gr&&Wf(g,I),C}for(k=n(g,k);!$.done;I++,$=b.next())$=d(k,g,I,$.value,v),$!==null&&(t&&$.alternate!==null&&k.delete($.key===null?I:$.key),y=s($,y,I),S===null?C=$:S.sibling=$,S=$);return t&&k.forEach(function(j){return e(g,j)}),gr&&Wf(g,I),C}function x(g,y,b,v){if(typeof b=="object"&&b!==null&&b.type===lg&&b.key===null&&(b=b.props.children),typeof b=="object"&&b!==null){switch(b.$$typeof){case $k:e:{for(var C=b.key,S=y;S!==null;){if(S.key===C){if(C=b.type,C===lg){if(S.tag===7){r(g,S.sibling),y=o(S,b.props.children),y.return=g,g=y;break e}}else if(S.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===Bc&&p9(C)===S.type){r(g,S.sibling),y=o(S,b.props),y.ref=sb(g,S,b),y.return=g,g=y;break e}r(g,S);break}else e(g,S);S=S.sibling}b.type===lg?(y=Kf(b.props.children,g.mode,v,b.key),y.return=g,g=y):(v=iT(b.type,b.key,b.props,null,g.mode,v),v.ref=sb(g,y,b),v.return=g,g=v)}return i(g);case ag:e:{for(S=b.key;y!==null;){if(y.key===S)if(y.tag===4&&y.stateNode.containerInfo===b.containerInfo&&y.stateNode.implementation===b.implementation){r(g,y.sibling),y=o(y,b.children||[]),y.return=g,g=y;break e}else{r(g,y);break}else e(g,y);y=y.sibling}y=kD(b,g.mode,v),y.return=g,g=y}return i(g);case Bc:return S=b._init,x(g,y,S(b._payload),v)}if(cb(b))return m(g,y,b,v);if(tb(b))return h(g,y,b,v);jk(g,b)}return typeof b=="string"&&b!==""||typeof b=="number"?(b=""+b,y!==null&&y.tag===6?(r(g,y.sibling),y=o(y,b),y.return=g,g=y):(r(g,y),y=SD(b,g.mode,v),y.return=g,g=y),i(g)):r(g,y)}return x}var Eg=Pq(!0),Lq=Pq(!1),Wb={},la=np(Wb),Rb=np(Wb),Ob=np(Wb);function qf(t){if(t===Wb)throw Error(he(174));return t}function V$(t,e){switch(nr(Ob,e),nr(Rb,t),nr(la,Wb),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:OD(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=OD(e,t)}fr(la),nr(la,e)}function _g(){fr(la),fr(Rb),fr(Ob)}function Mq(t){qf(Ob.current);var e=qf(la.current),r=OD(e,t.type);e!==r&&(nr(Rb,t),nr(la,r))}function W$(t){Rb.current===t&&(fr(la),fr(Rb))}var Tr=np(0);function ST(t){for(var e=t;e!==null;){if(e.tag===13){var r=e.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if((e.flags&128)!==0)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var xD=[];function G$(){for(var t=0;t<xD.length;t++)xD[t]._workInProgressVersionPrimary=null;xD.length=0}var tT=Yl.ReactCurrentDispatcher,yD=Yl.ReactCurrentBatchConfig,Qf=0,Nr=null,pn=null,kn=null,kT=!1,yb=!1,Fb=0,Xxe=0;function Jn(){throw Error(he(321))}function U$(t,e){if(e===null)return!1;for(var r=0;r<e.length&&r<t.length;r++)if(!Ni(t[r],e[r]))return!1;return!0}function H$(t,e,r,n,o,s){if(Qf=s,Nr=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,tT.current=t===null||t.memoizedState===null?Jxe:eye,t=r(n,o),yb){s=0;do{if(yb=!1,Fb=0,25<=s)throw Error(he(301));s+=1,kn=pn=null,e.updateQueue=null,tT.current=tye,t=r(n,o)}while(yb)}if(tT.current=TT,e=pn!==null&&pn.next!==null,Qf=0,kn=pn=Nr=null,kT=!1,e)throw Error(he(300));return t}function q$(){var t=Fb!==0;return Fb=0,t}function sa(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return kn===null?Nr.memoizedState=kn=t:kn=kn.next=t,kn}function js(){if(pn===null){var t=Nr.alternate;t=t!==null?t.memoizedState:null}else t=pn.next;var e=kn===null?Nr.memoizedState:kn.next;if(e!==null)kn=e,pn=t;else{if(t===null)throw Error(he(310));pn=t,t={memoizedState:pn.memoizedState,baseState:pn.baseState,baseQueue:pn.baseQueue,queue:pn.queue,next:null},kn===null?Nr.memoizedState=kn=t:kn=kn.next=t}return kn}function Pb(t,e){return typeof e=="function"?e(t):e}function bD(t){var e=js(),r=e.queue;if(r===null)throw Error(he(311));r.lastRenderedReducer=t;var n=pn,o=n.baseQueue,s=r.pending;if(s!==null){if(o!==null){var i=o.next;o.next=s.next,s.next=i}n.baseQueue=o=s,r.pending=null}if(o!==null){s=o.next,n=n.baseState;var a=i=null,l=null,u=s;do{var c=u.lane;if((Qf&c)===c)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),n=u.hasEagerState?u.eagerState:t(n,u.action);else{var p={lane:c,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(a=l=p,i=n):l=l.next=p,Nr.lanes|=c,Zf|=c}u=u.next}while(u!==null&&u!==s);l===null?i=n:l.next=a,Ni(n,e.memoizedState)||(Lo=!0),e.memoizedState=n,e.baseState=i,e.baseQueue=l,r.lastRenderedState=n}if(t=r.interleaved,t!==null){o=t;do s=o.lane,Nr.lanes|=s,Zf|=s,o=o.next;while(o!==t)}else o===null&&(r.lanes=0);return[e.memoizedState,r.dispatch]}function vD(t){var e=js(),r=e.queue;if(r===null)throw Error(he(311));r.lastRenderedReducer=t;var n=r.dispatch,o=r.pending,s=e.memoizedState;if(o!==null){r.pending=null;var i=o=o.next;do s=t(s,i.action),i=i.next;while(i!==o);Ni(s,e.memoizedState)||(Lo=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),r.lastRenderedState=s}return[s,n]}function zq(){}function Bq(t,e){var r=Nr,n=js(),o=e(),s=!Ni(n.memoizedState,o);if(s&&(n.memoizedState=o,Lo=!0),n=n.queue,j$(Gq.bind(null,r,n,t),[t]),n.getSnapshot!==e||s||kn!==null&&kn.memoizedState.tag&1){if(r.flags|=2048,Lb(9,Wq.bind(null,r,n,o,e),void 0,null),Tn===null)throw Error(he(349));(Qf&30)!==0||Vq(r,e,o)}return o}function Vq(t,e,r){t.flags|=16384,t={getSnapshot:e,value:r},e=Nr.updateQueue,e===null?(e={lastEffect:null,stores:null},Nr.updateQueue=e,e.stores=[t]):(r=e.stores,r===null?e.stores=[t]:r.push(t))}function Wq(t,e,r,n){e.value=r,e.getSnapshot=n,Uq(e)&&Hq(t)}function Gq(t,e,r){return r(function(){Uq(e)&&Hq(t)})}function Uq(t){var e=t.getSnapshot;t=t.value;try{var r=e();return!Ni(t,r)}catch{return!0}}function Hq(t){var e=Kl(t,1);e!==null&&Ti(e,t,1,-1)}function f9(t){var e=sa();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Pb,lastRenderedState:t},e.queue=t,t=t.dispatch=Zxe.bind(null,Nr,t),[e.memoizedState,t]}function Lb(t,e,r,n){return t={tag:t,create:e,destroy:r,deps:n,next:null},e=Nr.updateQueue,e===null?(e={lastEffect:null,stores:null},Nr.updateQueue=e,e.lastEffect=t.next=t):(r=e.lastEffect,r===null?e.lastEffect=t.next=t:(n=r.next,r.next=t,t.next=n,e.lastEffect=t)),t}function qq(){return js().memoizedState}function rT(t,e,r,n){var o=sa();Nr.flags|=t,o.memoizedState=Lb(1|e,r,void 0,n===void 0?null:n)}function MT(t,e,r,n){var o=js();n=n===void 0?null:n;var s=void 0;if(pn!==null){var i=pn.memoizedState;if(s=i.destroy,n!==null&&U$(n,i.deps)){o.memoizedState=Lb(e,r,s,n);return}}Nr.flags|=t,o.memoizedState=Lb(1|e,r,s,n)}function d9(t,e){return rT(8390656,8,t,e)}function j$(t,e){return MT(2048,8,t,e)}function jq(t,e){return MT(4,2,t,e)}function Kq(t,e){return MT(4,4,t,e)}function Xq(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function Yq(t,e,r){return r=r!=null?r.concat([t]):null,MT(4,4,Xq.bind(null,e,t),r)}function K$(){}function Qq(t,e){var r=js();e=e===void 0?null:e;var n=r.memoizedState;return n!==null&&e!==null&&U$(e,n[1])?n[0]:(r.memoizedState=[t,e],t)}function Zq(t,e){var r=js();e=e===void 0?null:e;var n=r.memoizedState;return n!==null&&e!==null&&U$(e,n[1])?n[0]:(t=t(),r.memoizedState=[t,e],t)}function Jq(t,e,r){return(Qf&21)===0?(t.baseState&&(t.baseState=!1,Lo=!0),t.memoizedState=r):(Ni(r,e)||(r=rq(),Nr.lanes|=r,Zf|=r,t.baseState=!0),e)}function Yxe(t,e){var r=Mt;Mt=r!==0&&4>r?r:4,t(!0);var n=yD.transition;yD.transition={};try{t(!1),e()}finally{Mt=r,yD.transition=n}}function ej(){return js().memoizedState}function Qxe(t,e,r){var n=Zc(t);if(r={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null},tj(t))rj(e,r);else if(r=$q(t,e,r,n),r!==null){var o=mo();Ti(r,t,n,o),nj(r,e,n)}}function Zxe(t,e,r){var n=Zc(t),o={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null};if(tj(t))rj(e,o);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var i=e.lastRenderedState,a=s(i,r);if(o.hasEagerState=!0,o.eagerState=a,Ni(a,i)){var l=e.interleaved;l===null?(o.next=o,z$(e)):(o.next=l.next,l.next=o),e.interleaved=o;return}}catch{}finally{}r=$q(t,e,o,n),r!==null&&(o=mo(),Ti(r,t,n,o),nj(r,e,n))}}function tj(t){var e=t.alternate;return t===Nr||e!==null&&e===Nr}function rj(t,e){yb=kT=!0;var r=t.pending;r===null?e.next=e:(e.next=r.next,r.next=e),t.pending=e}function nj(t,e,r){if((r&4194240)!==0){var n=e.lanes;n&=t.pendingLanes,r|=n,e.lanes=r,T$(t,r)}}var TT={readContext:qs,useCallback:Jn,useContext:Jn,useEffect:Jn,useImperativeHandle:Jn,useInsertionEffect:Jn,useLayoutEffect:Jn,useMemo:Jn,useReducer:Jn,useRef:Jn,useState:Jn,useDebugValue:Jn,useDeferredValue:Jn,useTransition:Jn,useMutableSource:Jn,useSyncExternalStore:Jn,useId:Jn,unstable_isNewReconciler:!1},Jxe={readContext:qs,useCallback:function(t,e){return sa().memoizedState=[t,e===void 0?null:e],t},useContext:qs,useEffect:d9,useImperativeHandle:function(t,e,r){return r=r!=null?r.concat([t]):null,rT(4194308,4,Xq.bind(null,e,t),r)},useLayoutEffect:function(t,e){return rT(4194308,4,t,e)},useInsertionEffect:function(t,e){return rT(4,2,t,e)},useMemo:function(t,e){var r=sa();return e=e===void 0?null:e,t=t(),r.memoizedState=[t,e],t},useReducer:function(t,e,r){var n=sa();return e=r!==void 0?r(e):e,n.memoizedState=n.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},n.queue=t,t=t.dispatch=Qxe.bind(null,Nr,t),[n.memoizedState,t]},useRef:function(t){var e=sa();return t={current:t},e.memoizedState=t},useState:f9,useDebugValue:K$,useDeferredValue:function(t){return sa().memoizedState=t},useTransition:function(){var t=f9(!1),e=t[0];return t=Yxe.bind(null,t[1]),sa().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,r){var n=Nr,o=sa();if(gr){if(r===void 0)throw Error(he(407));r=r()}else{if(r=e(),Tn===null)throw Error(he(349));(Qf&30)!==0||Vq(n,e,r)}o.memoizedState=r;var s={value:r,getSnapshot:e};return o.queue=s,d9(Gq.bind(null,n,s,t),[t]),n.flags|=2048,Lb(9,Wq.bind(null,n,s,r,e),void 0,null),r},useId:function(){var t=sa(),e=Tn.identifierPrefix;if(gr){var r=Ul,n=Gl;r=(n&~(1<<32-ki(n)-1)).toString(32)+r,e=":"+e+"R"+r,r=Fb++,0<r&&(e+="H"+r.toString(32)),e+=":"}else r=Xxe++,e=":"+e+"r"+r.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},eye={readContext:qs,useCallback:Qq,useContext:qs,useEffect:j$,useImperativeHandle:Yq,useInsertionEffect:jq,useLayoutEffect:Kq,useMemo:Zq,useReducer:bD,useRef:qq,useState:function(){return bD(Pb)},useDebugValue:K$,useDeferredValue:function(t){var e=js();return Jq(e,pn.memoizedState,t)},useTransition:function(){var t=bD(Pb)[0],e=js().memoizedState;return[t,e]},useMutableSource:zq,useSyncExternalStore:Bq,useId:ej,unstable_isNewReconciler:!1},tye={readContext:qs,useCallback:Qq,useContext:qs,useEffect:j$,useImperativeHandle:Yq,useInsertionEffect:jq,useLayoutEffect:Kq,useMemo:Zq,useReducer:vD,useRef:qq,useState:function(){return vD(Pb)},useDebugValue:K$,useDeferredValue:function(t){var e=js();return pn===null?e.memoizedState=t:Jq(e,pn.memoizedState,t)},useTransition:function(){var t=vD(Pb)[0],e=js().memoizedState;return[t,e]},useMutableSource:zq,useSyncExternalStore:Bq,useId:ej,unstable_isNewReconciler:!1};function Ag(t,e){try{var r="",n=e;do r+=Dge(n),n=n.return;while(n);var o=r}catch(s){o=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:o,digest:null}}function wD(t,e,r){return{value:t,source:null,stack:r??null,digest:e??null}}function n$(t,e){try{console.error(e.value)}catch(r){setTimeout(function(){throw r})}}var rye=typeof WeakMap=="function"?WeakMap:Map;function oj(t,e,r){r=Hl(-1,r),r.tag=3,r.payload={element:null};var n=e.value;return r.callback=function(){IT||(IT=!0,d$=n),n$(t,e)},r}function sj(t,e,r){r=Hl(-1,r),r.tag=3;var n=t.type.getDerivedStateFromError;if(typeof n=="function"){var o=e.value;r.payload=function(){return n(o)},r.callback=function(){n$(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(r.callback=function(){n$(t,e),typeof n!="function"&&(Qc===null?Qc=new Set([this]):Qc.add(this));var i=e.stack;this.componentDidCatch(e.value,{componentStack:i!==null?i:""})}),r}function m9(t,e,r){var n=t.pingCache;if(n===null){n=t.pingCache=new rye;var o=new Set;n.set(e,o)}else o=n.get(e),o===void 0&&(o=new Set,n.set(e,o));o.has(r)||(o.add(r),t=gye.bind(null,t,e,r),e.then(t,t))}function h9(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function g9(t,e,r,n,o){return(t.mode&1)===0?(t===e?t.flags|=65536:(t.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(e=Hl(-1,1),e.tag=2,Yc(r,e,1))),r.lanes|=1),t):(t.flags|=65536,t.lanes=o,t)}var nye=Yl.ReactCurrentOwner,Lo=!1;function fo(t,e,r,n){e.child=t===null?Lq(e,null,r,n):Eg(e,t.child,r,n)}function x9(t,e,r,n,o){r=r.render;var s=e.ref;return Sg(e,o),n=H$(t,e,r,n,s,o),r=q$(),t!==null&&!Lo?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~o,Xl(t,e,o)):(gr&&r&&R$(e),e.flags|=1,fo(t,e,n,o),e.child)}function y9(t,e,r,n,o){if(t===null){var s=r.type;return typeof s=="function"&&!rR(s)&&s.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(e.tag=15,e.type=s,ij(t,e,s,n,o)):(t=iT(r.type,null,n,e,e.mode,o),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,(t.lanes&o)===0){var i=s.memoizedProps;if(r=r.compare,r=r!==null?r:_b,r(i,n)&&t.ref===e.ref)return Xl(t,e,o)}return e.flags|=1,t=Jc(s,n),t.ref=e.ref,t.return=e,e.child=t}function ij(t,e,r,n,o){if(t!==null){var s=t.memoizedProps;if(_b(s,n)&&t.ref===e.ref)if(Lo=!1,e.pendingProps=n=s,(t.lanes&o)!==0)(t.flags&131072)!==0&&(Lo=!0);else return e.lanes=t.lanes,Xl(t,e,o)}return o$(t,e,r,n,o)}function aj(t,e,r){var n=e.pendingProps,o=n.children,s=t!==null?t.memoizedState:null;if(n.mode==="hidden")if((e.mode&1)===0)e.memoizedState={baseLanes:0,cachePool:null,transitions:null},nr(yg,os),os|=r;else{if((r&1073741824)===0)return t=s!==null?s.baseLanes|r:r,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,nr(yg,os),os|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=s!==null?s.baseLanes:r,nr(yg,os),os|=n}else s!==null?(n=s.baseLanes|r,e.memoizedState=null):n=r,nr(yg,os),os|=n;return fo(t,e,o,r),e.child}function lj(t,e){var r=e.ref;(t===null&&r!==null||t!==null&&t.ref!==r)&&(e.flags|=512,e.flags|=2097152)}function o$(t,e,r,n,o){var s=zo(r)?Xf:ro.current;return s=Ng(e,s),Sg(e,o),r=H$(t,e,r,n,s,o),n=q$(),t!==null&&!Lo?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~o,Xl(t,e,o)):(gr&&n&&R$(e),e.flags|=1,fo(t,e,r,o),e.child)}function b9(t,e,r,n,o){if(zo(r)){var s=!0;xT(e)}else s=!1;if(Sg(e,o),e.stateNode===null)nT(t,e),Fq(e,r,n),r$(e,r,n,o),n=!0;else if(t===null){var i=e.stateNode,a=e.memoizedProps;i.props=a;var l=i.context,u=r.contextType;typeof u=="object"&&u!==null?u=qs(u):(u=zo(r)?Xf:ro.current,u=Ng(e,u));var c=r.getDerivedStateFromProps,p=typeof c=="function"||typeof i.getSnapshotBeforeUpdate=="function";p||typeof i.UNSAFE_componentWillReceiveProps!="function"&&typeof i.componentWillReceiveProps!="function"||(a!==n||l!==u)&&c9(e,i,n,u),Vc=!1;var f=e.memoizedState;i.state=f,CT(e,n,i,o),l=e.memoizedState,a!==n||f!==l||Mo.current||Vc?(typeof c=="function"&&(t$(e,r,c,n),l=e.memoizedState),(a=Vc||u9(e,r,a,n,f,l,u))?(p||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount()),typeof i.componentDidMount=="function"&&(e.flags|=4194308)):(typeof i.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=n,e.memoizedState=l),i.props=n,i.state=l,i.context=u,n=a):(typeof i.componentDidMount=="function"&&(e.flags|=4194308),n=!1)}else{i=e.stateNode,Rq(t,e),a=e.memoizedProps,u=e.type===e.elementType?a:wi(e.type,a),i.props=u,p=e.pendingProps,f=i.context,l=r.contextType,typeof l=="object"&&l!==null?l=qs(l):(l=zo(r)?Xf:ro.current,l=Ng(e,l));var d=r.getDerivedStateFromProps;(c=typeof d=="function"||typeof i.getSnapshotBeforeUpdate=="function")||typeof i.UNSAFE_componentWillReceiveProps!="function"&&typeof i.componentWillReceiveProps!="function"||(a!==p||f!==l)&&c9(e,i,n,l),Vc=!1,f=e.memoizedState,i.state=f,CT(e,n,i,o);var m=e.memoizedState;a!==p||f!==m||Mo.current||Vc?(typeof d=="function"&&(t$(e,r,d,n),m=e.memoizedState),(u=Vc||u9(e,r,u,n,f,m,l)||!1)?(c||typeof i.UNSAFE_componentWillUpdate!="function"&&typeof i.componentWillUpdate!="function"||(typeof i.componentWillUpdate=="function"&&i.componentWillUpdate(n,m,l),typeof i.UNSAFE_componentWillUpdate=="function"&&i.UNSAFE_componentWillUpdate(n,m,l)),typeof i.componentDidUpdate=="function"&&(e.flags|=4),typeof i.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof i.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof i.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),e.memoizedProps=n,e.memoizedState=m),i.props=n,i.state=m,i.context=l,n=u):(typeof i.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof i.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),n=!1)}return s$(t,e,r,n,s,o)}function s$(t,e,r,n,o,s){lj(t,e);var i=(e.flags&128)!==0;if(!n&&!i)return o&&o9(e,r,!1),Xl(t,e,s);n=e.stateNode,nye.current=e;var a=i&&typeof r.getDerivedStateFromError!="function"?null:n.render();return e.flags|=1,t!==null&&i?(e.child=Eg(e,t.child,null,s),e.child=Eg(e,null,a,s)):fo(t,e,a,s),e.memoizedState=n.state,o&&o9(e,r,!0),e.child}function uj(t){var e=t.stateNode;e.pendingContext?n9(t,e.pendingContext,e.pendingContext!==e.context):e.context&&n9(t,e.context,!1),V$(t,e.containerInfo)}function v9(t,e,r,n,o){return Ig(),F$(o),e.flags|=256,fo(t,e,r,n),e.child}var i$={dehydrated:null,treeContext:null,retryLane:0};function a$(t){return{baseLanes:t,cachePool:null,transitions:null}}function cj(t,e,r){var n=e.pendingProps,o=Tr.current,s=!1,i=(e.flags&128)!==0,a;if((a=i)||(a=t!==null&&t.memoizedState===null?!1:(o&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(o|=1),nr(Tr,o&1),t===null)return JD(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?((e.mode&1)===0?e.lanes=1:t.data==="$!"?e.lanes=8:e.lanes=1073741824,null):(i=n.children,t=n.fallback,s?(n=e.mode,s=e.child,i={mode:"hidden",children:i},(n&1)===0&&s!==null?(s.childLanes=0,s.pendingProps=i):s=VT(i,n,0,null),t=Kf(t,n,r,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=a$(r),e.memoizedState=i$,t):X$(e,i));if(o=t.memoizedState,o!==null&&(a=o.dehydrated,a!==null))return oye(t,e,i,n,a,o,r);if(s){s=n.fallback,i=e.mode,o=t.child,a=o.sibling;var l={mode:"hidden",children:n.children};return(i&1)===0&&e.child!==o?(n=e.child,n.childLanes=0,n.pendingProps=l,e.deletions=null):(n=Jc(o,l),n.subtreeFlags=o.subtreeFlags&14680064),a!==null?s=Jc(a,s):(s=Kf(s,i,r,null),s.flags|=2),s.return=e,n.return=e,n.sibling=s,e.child=n,n=s,s=e.child,i=t.child.memoizedState,i=i===null?a$(r):{baseLanes:i.baseLanes|r,cachePool:null,transitions:i.transitions},s.memoizedState=i,s.childLanes=t.childLanes&~r,e.memoizedState=i$,n}return s=t.child,t=s.sibling,n=Jc(s,{mode:"visible",children:n.children}),(e.mode&1)===0&&(n.lanes=r),n.return=e,n.sibling=null,t!==null&&(r=e.deletions,r===null?(e.deletions=[t],e.flags|=16):r.push(t)),e.child=n,e.memoizedState=null,n}function X$(t,e){return e=VT({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function Kk(t,e,r,n){return n!==null&&F$(n),Eg(e,t.child,null,r),t=X$(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function oye(t,e,r,n,o,s,i){if(r)return e.flags&256?(e.flags&=-257,n=wD(Error(he(422))),Kk(t,e,i,n)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=n.fallback,o=e.mode,n=VT({mode:"visible",children:n.children},o,0,null),s=Kf(s,o,i,null),s.flags|=2,n.return=e,s.return=e,n.sibling=s,e.child=n,(e.mode&1)!==0&&Eg(e,t.child,null,i),e.child.memoizedState=a$(i),e.memoizedState=i$,s);if((e.mode&1)===0)return Kk(t,e,i,null);if(o.data==="$!"){if(n=o.nextSibling&&o.nextSibling.dataset,n)var a=n.dgst;return n=a,s=Error(he(419)),n=wD(s,n,void 0),Kk(t,e,i,n)}if(a=(i&t.childLanes)!==0,Lo||a){if(n=Tn,n!==null){switch(i&-i){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}o=(o&(n.suspendedLanes|i))!==0?0:o,o!==0&&o!==s.retryLane&&(s.retryLane=o,Kl(t,o),Ti(n,t,o,-1))}return tR(),n=wD(Error(he(421))),Kk(t,e,i,n)}return o.data==="$?"?(e.flags|=128,e.child=t.child,e=xye.bind(null,t),o._reactRetry=e,null):(t=s.treeContext,ss=Xc(o.nextSibling),is=e,gr=!0,Si=null,t!==null&&(Ws[Gs++]=Gl,Ws[Gs++]=Ul,Ws[Gs++]=Yf,Gl=t.id,Ul=t.overflow,Yf=e),e=X$(e,n.children),e.flags|=4096,e)}function w9(t,e,r){t.lanes|=e;var n=t.alternate;n!==null&&(n.lanes|=e),e$(t.return,e,r)}function CD(t,e,r,n,o){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:o}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=n,s.tail=r,s.tailMode=o)}function pj(t,e,r){var n=e.pendingProps,o=n.revealOrder,s=n.tail;if(fo(t,e,n.children,r),n=Tr.current,(n&2)!==0)n=n&1|2,e.flags|=128;else{if(t!==null&&(t.flags&128)!==0)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&w9(t,r,e);else if(t.tag===19)w9(t,r,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}n&=1}if(nr(Tr,n),(e.mode&1)===0)e.memoizedState=null;else switch(o){case"forwards":for(r=e.child,o=null;r!==null;)t=r.alternate,t!==null&&ST(t)===null&&(o=r),r=r.sibling;r=o,r===null?(o=e.child,e.child=null):(o=r.sibling,r.sibling=null),CD(e,!1,o,r,s);break;case"backwards":for(r=null,o=e.child,e.child=null;o!==null;){if(t=o.alternate,t!==null&&ST(t)===null){e.child=o;break}t=o.sibling,o.sibling=r,r=o,o=t}CD(e,!0,r,null,s);break;case"together":CD(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function nT(t,e){(e.mode&1)===0&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Xl(t,e,r){if(t!==null&&(e.dependencies=t.dependencies),Zf|=e.lanes,(r&e.childLanes)===0)return null;if(t!==null&&e.child!==t.child)throw Error(he(153));if(e.child!==null){for(t=e.child,r=Jc(t,t.pendingProps),e.child=r,r.return=e;t.sibling!==null;)t=t.sibling,r=r.sibling=Jc(t,t.pendingProps),r.return=e;r.sibling=null}return e.child}function sye(t,e,r){switch(e.tag){case 3:uj(e),Ig();break;case 5:Mq(e);break;case 1:zo(e.type)&&xT(e);break;case 4:V$(e,e.stateNode.containerInfo);break;case 10:var n=e.type._context,o=e.memoizedProps.value;nr(vT,n._currentValue),n._currentValue=o;break;case 13:if(n=e.memoizedState,n!==null)return n.dehydrated!==null?(nr(Tr,Tr.current&1),e.flags|=128,null):(r&e.child.childLanes)!==0?cj(t,e,r):(nr(Tr,Tr.current&1),t=Xl(t,e,r),t!==null?t.sibling:null);nr(Tr,Tr.current&1);break;case 19:if(n=(r&e.childLanes)!==0,(t.flags&128)!==0){if(n)return pj(t,e,r);e.flags|=128}if(o=e.memoizedState,o!==null&&(o.rendering=null,o.tail=null,o.lastEffect=null),nr(Tr,Tr.current),n)break;return null;case 22:case 23:return e.lanes=0,aj(t,e,r)}return Xl(t,e,r)}var fj,l$,dj,mj;fj=function(t,e){for(var r=e.child;r!==null;){if(r.tag===5||r.tag===6)t.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break;for(;r.sibling===null;){if(r.return===null||r.return===e)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};l$=function(){};dj=function(t,e,r,n){var o=t.memoizedProps;if(o!==n){t=e.stateNode,qf(la.current);var s=null;switch(r){case"input":o=AD(t,o),n=AD(t,n),s=[];break;case"select":o=Ir({},o,{value:void 0}),n=Ir({},n,{value:void 0}),s=[];break;case"textarea":o=RD(t,o),n=RD(t,n),s=[];break;default:typeof o.onClick!="function"&&typeof n.onClick=="function"&&(t.onclick=hT)}FD(r,n);var i;r=null;for(u in o)if(!n.hasOwnProperty(u)&&o.hasOwnProperty(u)&&o[u]!=null)if(u==="style"){var a=o[u];for(i in a)a.hasOwnProperty(i)&&(r||(r={}),r[i]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Cb.hasOwnProperty(u)?s||(s=[]):(s=s||[]).push(u,null));for(u in n){var l=n[u];if(a=o?.[u],n.hasOwnProperty(u)&&l!==a&&(l!=null||a!=null))if(u==="style")if(a){for(i in a)!a.hasOwnProperty(i)||l&&l.hasOwnProperty(i)||(r||(r={}),r[i]="");for(i in l)l.hasOwnProperty(i)&&a[i]!==l[i]&&(r||(r={}),r[i]=l[i])}else r||(s||(s=[]),s.push(u,r)),r=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Cb.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&pr("scroll",t),s||a===l||(s=[])):(s=s||[]).push(u,l))}r&&(s=s||[]).push("style",r);var u=s;(e.updateQueue=u)&&(e.flags|=4)}};mj=function(t,e,r,n){r!==n&&(e.flags|=4)};function ib(t,e){if(!gr)switch(t.tailMode){case"hidden":e=t.tail;for(var r=null;e!==null;)e.alternate!==null&&(r=e),e=e.sibling;r===null?t.tail=null:r.sibling=null;break;case"collapsed":r=t.tail;for(var n=null;r!==null;)r.alternate!==null&&(n=r),r=r.sibling;n===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:n.sibling=null}}function eo(t){var e=t.alternate!==null&&t.alternate.child===t.child,r=0,n=0;if(e)for(var o=t.child;o!==null;)r|=o.lanes|o.childLanes,n|=o.subtreeFlags&14680064,n|=o.flags&14680064,o.return=t,o=o.sibling;else for(o=t.child;o!==null;)r|=o.lanes|o.childLanes,n|=o.subtreeFlags,n|=o.flags,o.return=t,o=o.sibling;return t.subtreeFlags|=n,t.childLanes=r,e}function iye(t,e,r){var n=e.pendingProps;switch(O$(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return eo(e),null;case 1:return zo(e.type)&&gT(),eo(e),null;case 3:return n=e.stateNode,_g(),fr(Mo),fr(ro),G$(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(t===null||t.child===null)&&(qk(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&(e.flags&256)===0||(e.flags|=1024,Si!==null&&(g$(Si),Si=null))),l$(t,e),eo(e),null;case 5:W$(e);var o=qf(Ob.current);if(r=e.type,t!==null&&e.stateNode!=null)dj(t,e,r,n,o),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!n){if(e.stateNode===null)throw Error(he(166));return eo(e),null}if(t=qf(la.current),qk(e)){n=e.stateNode,r=e.type;var s=e.memoizedProps;switch(n[ia]=e,n[$b]=s,t=(e.mode&1)!==0,r){case"dialog":pr("cancel",n),pr("close",n);break;case"iframe":case"object":case"embed":pr("load",n);break;case"video":case"audio":for(o=0;o<fb.length;o++)pr(fb[o],n);break;case"source":pr("error",n);break;case"img":case"image":case"link":pr("error",n),pr("load",n);break;case"details":pr("toggle",n);break;case"input":_7(n,s),pr("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!s.multiple},pr("invalid",n);break;case"textarea":D7(n,s),pr("invalid",n)}FD(r,s),o=null;for(var i in s)if(s.hasOwnProperty(i)){var a=s[i];i==="children"?typeof a=="string"?n.textContent!==a&&(s.suppressHydrationWarning!==!0&&Hk(n.textContent,a,t),o=["children",a]):typeof a=="number"&&n.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&Hk(n.textContent,a,t),o=["children",""+a]):Cb.hasOwnProperty(i)&&a!=null&&i==="onScroll"&&pr("scroll",n)}switch(r){case"input":Rk(n),A7(n,s,!0);break;case"textarea":Rk(n),$7(n);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(n.onclick=hT)}n=o,e.updateQueue=n,n!==null&&(e.flags|=4)}else{i=o.nodeType===9?o:o.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=V9(r)),t==="http://www.w3.org/1999/xhtml"?r==="script"?(t=i.createElement("div"),t.innerHTML="<script></script>",t=t.removeChild(t.firstChild)):typeof n.is=="string"?t=i.createElement(r,{is:n.is}):(t=i.createElement(r),r==="select"&&(i=t,n.multiple?i.multiple=!0:n.size&&(i.size=n.size))):t=i.createElementNS(t,r),t[ia]=e,t[$b]=n,fj(t,e,!1,!1),e.stateNode=t;e:{switch(i=PD(r,n),r){case"dialog":pr("cancel",t),pr("close",t),o=n;break;case"iframe":case"object":case"embed":pr("load",t),o=n;break;case"video":case"audio":for(o=0;o<fb.length;o++)pr(fb[o],t);o=n;break;case"source":pr("error",t),o=n;break;case"img":case"image":case"link":pr("error",t),pr("load",t),o=n;break;case"details":pr("toggle",t),o=n;break;case"input":_7(t,n),o=AD(t,n),pr("invalid",t);break;case"option":o=n;break;case"select":t._wrapperState={wasMultiple:!!n.multiple},o=Ir({},n,{value:void 0}),pr("invalid",t);break;case"textarea":D7(t,n),o=RD(t,n),pr("invalid",t);break;default:o=n}FD(r,o),a=o;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?U9(t,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&W9(t,l)):s==="children"?typeof l=="string"?(r!=="textarea"||l!=="")&&Sb(t,l):typeof l=="number"&&Sb(t,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(Cb.hasOwnProperty(s)?l!=null&&s==="onScroll"&&pr("scroll",t):l!=null&&b$(t,s,l,i))}switch(r){case"input":Rk(t),A7(t,n,!1);break;case"textarea":Rk(t),$7(t);break;case"option":n.value!=null&&t.setAttribute("value",""+ep(n.value));break;case"select":t.multiple=!!n.multiple,s=n.value,s!=null?bg(t,!!n.multiple,s,!1):n.defaultValue!=null&&bg(t,!!n.multiple,n.defaultValue,!0);break;default:typeof o.onClick=="function"&&(t.onclick=hT)}switch(r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return eo(e),null;case 6:if(t&&e.stateNode!=null)mj(t,e,t.memoizedProps,n);else{if(typeof n!="string"&&e.stateNode===null)throw Error(he(166));if(r=qf(Ob.current),qf(la.current),qk(e)){if(n=e.stateNode,r=e.memoizedProps,n[ia]=e,(s=n.nodeValue!==r)&&(t=is,t!==null))switch(t.tag){case 3:Hk(n.nodeValue,r,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Hk(n.nodeValue,r,(t.mode&1)!==0)}s&&(e.flags|=4)}else n=(r.nodeType===9?r:r.ownerDocument).createTextNode(n),n[ia]=e,e.stateNode=n}return eo(e),null;case 13:if(fr(Tr),n=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(gr&&ss!==null&&(e.mode&1)!==0&&(e.flags&128)===0)Dq(),Ig(),e.flags|=98560,s=!1;else if(s=qk(e),n!==null&&n.dehydrated!==null){if(t===null){if(!s)throw Error(he(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(he(317));s[ia]=e}else Ig(),(e.flags&128)===0&&(e.memoizedState=null),e.flags|=4;eo(e),s=!1}else Si!==null&&(g$(Si),Si=null),s=!0;if(!s)return e.flags&65536?e:null}return(e.flags&128)!==0?(e.lanes=r,e):(n=n!==null,n!==(t!==null&&t.memoizedState!==null)&&n&&(e.child.flags|=8192,(e.mode&1)!==0&&(t===null||(Tr.current&1)!==0?fn===0&&(fn=3):tR())),e.updateQueue!==null&&(e.flags|=4),eo(e),null);case 4:return _g(),l$(t,e),t===null&&Ab(e.stateNode.containerInfo),eo(e),null;case 10:return M$(e.type._context),eo(e),null;case 17:return zo(e.type)&&gT(),eo(e),null;case 19:if(fr(Tr),s=e.memoizedState,s===null)return eo(e),null;if(n=(e.flags&128)!==0,i=s.rendering,i===null)if(n)ib(s,!1);else{if(fn!==0||t!==null&&(t.flags&128)!==0)for(t=e.child;t!==null;){if(i=ST(t),i!==null){for(e.flags|=128,ib(s,!1),n=i.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),e.subtreeFlags=0,n=r,r=e.child;r!==null;)s=r,t=n,s.flags&=14680066,i=s.alternate,i===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=i.childLanes,s.lanes=i.lanes,s.child=i.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=i.memoizedProps,s.memoizedState=i.memoizedState,s.updateQueue=i.updateQueue,s.type=i.type,t=i.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),r=r.sibling;return nr(Tr,Tr.current&1|2),e.child}t=t.sibling}s.tail!==null&&Br()>Dg&&(e.flags|=128,n=!0,ib(s,!1),e.lanes=4194304)}else{if(!n)if(t=ST(i),t!==null){if(e.flags|=128,n=!0,r=t.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),ib(s,!0),s.tail===null&&s.tailMode==="hidden"&&!i.alternate&&!gr)return eo(e),null}else 2*Br()-s.renderingStartTime>Dg&&r!==1073741824&&(e.flags|=128,n=!0,ib(s,!1),e.lanes=4194304);s.isBackwards?(i.sibling=e.child,e.child=i):(r=s.last,r!==null?r.sibling=i:e.child=i,s.last=i)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=Br(),e.sibling=null,r=Tr.current,nr(Tr,n?r&1|2:r&1),e):(eo(e),null);case 22:case 23:return eR(),n=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==n&&(e.flags|=8192),n&&(e.mode&1)!==0?(os&1073741824)!==0&&(eo(e),e.subtreeFlags&6&&(e.flags|=8192)):eo(e),null;case 24:return null;case 25:return null}throw Error(he(156,e.tag))}function aye(t,e){switch(O$(e),e.tag){case 1:return zo(e.type)&&gT(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return _g(),fr(Mo),fr(ro),G$(),t=e.flags,(t&65536)!==0&&(t&128)===0?(e.flags=t&-65537|128,e):null;case 5:return W$(e),null;case 13:if(fr(Tr),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(he(340));Ig()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return fr(Tr),null;case 4:return _g(),null;case 10:return M$(e.type._context),null;case 22:case 23:return eR(),null;case 24:return null;default:return null}}var Xk=!1,to=!1,lye=typeof WeakSet=="function"?WeakSet:Set,_e=null;function xg(t,e){var r=t.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(n){Fr(t,e,n)}else r.current=null}function u$(t,e,r){try{r()}catch(n){Fr(t,e,n)}}var C9=!1;function uye(t,e){if(qD=fT,t=yq(),$$(t)){if("selectionStart"in t)var r={start:t.selectionStart,end:t.selectionEnd};else e:{r=(r=t.ownerDocument)&&r.defaultView||window;var n=r.getSelection&&r.getSelection();if(n&&n.rangeCount!==0){r=n.anchorNode;var o=n.anchorOffset,s=n.focusNode;n=n.focusOffset;try{r.nodeType,s.nodeType}catch{r=null;break e}var i=0,a=-1,l=-1,u=0,c=0,p=t,f=null;t:for(;;){for(var d;p!==r||o!==0&&p.nodeType!==3||(a=i+o),p!==s||n!==0&&p.nodeType!==3||(l=i+n),p.nodeType===3&&(i+=p.nodeValue.length),(d=p.firstChild)!==null;)f=p,p=d;for(;;){if(p===t)break t;if(f===r&&++u===o&&(a=i),f===s&&++c===n&&(l=i),(d=p.nextSibling)!==null)break;p=f,f=p.parentNode}p=d}r=a===-1||l===-1?null:{start:a,end:l}}else r=null}r=r||{start:0,end:0}}else r=null;for(jD={focusedElem:t,selectionRange:r},fT=!1,_e=e;_e!==null;)if(e=_e,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,_e=t;else for(;_e!==null;){e=_e;try{var m=e.alternate;if((e.flags&1024)!==0)switch(e.tag){case 0:case 11:case 15:break;case 1:if(m!==null){var h=m.memoizedProps,x=m.memoizedState,g=e.stateNode,y=g.getSnapshotBeforeUpdate(e.elementType===e.type?h:wi(e.type,h),x);g.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var b=e.stateNode.containerInfo;b.nodeType===1?b.textContent="":b.nodeType===9&&b.documentElement&&b.removeChild(b.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(he(163))}}catch(v){Fr(e,e.return,v)}if(t=e.sibling,t!==null){t.return=e.return,_e=t;break}_e=e.return}return m=C9,C9=!1,m}function bb(t,e,r){var n=e.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var o=n=n.next;do{if((o.tag&t)===t){var s=o.destroy;o.destroy=void 0,s!==void 0&&u$(e,r,s)}o=o.next}while(o!==n)}}function zT(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var r=e=e.next;do{if((r.tag&t)===t){var n=r.create;r.destroy=n()}r=r.next}while(r!==e)}}function c$(t){var e=t.ref;if(e!==null){var r=t.stateNode;switch(t.tag){case 5:t=r;break;default:t=r}typeof e=="function"?e(t):e.current=t}}function hj(t){var e=t.alternate;e!==null&&(t.alternate=null,hj(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[ia],delete e[$b],delete e[YD],delete e[Hxe],delete e[qxe])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function gj(t){return t.tag===5||t.tag===3||t.tag===4}function S9(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||gj(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function p$(t,e,r){var n=t.tag;if(n===5||n===6)t=t.stateNode,e?r.nodeType===8?r.parentNode.insertBefore(t,e):r.insertBefore(t,e):(r.nodeType===8?(e=r.parentNode,e.insertBefore(t,r)):(e=r,e.appendChild(t)),r=r._reactRootContainer,r!=null||e.onclick!==null||(e.onclick=hT));else if(n!==4&&(t=t.child,t!==null))for(p$(t,e,r),t=t.sibling;t!==null;)p$(t,e,r),t=t.sibling}function f$(t,e,r){var n=t.tag;if(n===5||n===6)t=t.stateNode,e?r.insertBefore(t,e):r.appendChild(t);else if(n!==4&&(t=t.child,t!==null))for(f$(t,e,r),t=t.sibling;t!==null;)f$(t,e,r),t=t.sibling}var Fn=null,Ci=!1;function zc(t,e,r){for(r=r.child;r!==null;)xj(t,e,r),r=r.sibling}function xj(t,e,r){if(aa&&typeof aa.onCommitFiberUnmount=="function")try{aa.onCommitFiberUnmount(DT,r)}catch{}switch(r.tag){case 5:to||xg(r,e);case 6:var n=Fn,o=Ci;Fn=null,zc(t,e,r),Fn=n,Ci=o,Fn!==null&&(Ci?(t=Fn,r=r.stateNode,t.nodeType===8?t.parentNode.removeChild(r):t.removeChild(r)):Fn.removeChild(r.stateNode));break;case 18:Fn!==null&&(Ci?(t=Fn,r=r.stateNode,t.nodeType===8?hD(t.parentNode,r):t.nodeType===1&&hD(t,r),Ib(t)):hD(Fn,r.stateNode));break;case 4:n=Fn,o=Ci,Fn=r.stateNode.containerInfo,Ci=!0,zc(t,e,r),Fn=n,Ci=o;break;case 0:case 11:case 14:case 15:if(!to&&(n=r.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){o=n=n.next;do{var s=o,i=s.destroy;s=s.tag,i!==void 0&&((s&2)!==0||(s&4)!==0)&&u$(r,e,i),o=o.next}while(o!==n)}zc(t,e,r);break;case 1:if(!to&&(xg(r,e),n=r.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=r.memoizedProps,n.state=r.memoizedState,n.componentWillUnmount()}catch(a){Fr(r,e,a)}zc(t,e,r);break;case 21:zc(t,e,r);break;case 22:r.mode&1?(to=(n=to)||r.memoizedState!==null,zc(t,e,r),to=n):zc(t,e,r);break;default:zc(t,e,r)}}function k9(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var r=t.stateNode;r===null&&(r=t.stateNode=new lye),e.forEach(function(n){var o=yye.bind(null,t,n);r.has(n)||(r.add(n),n.then(o,o))})}}function vi(t,e){var r=e.deletions;if(r!==null)for(var n=0;n<r.length;n++){var o=r[n];try{var s=t,i=e,a=i;e:for(;a!==null;){switch(a.tag){case 5:Fn=a.stateNode,Ci=!1;break e;case 3:Fn=a.stateNode.containerInfo,Ci=!0;break e;case 4:Fn=a.stateNode.containerInfo,Ci=!0;break e}a=a.return}if(Fn===null)throw Error(he(160));xj(s,i,o),Fn=null,Ci=!1;var l=o.alternate;l!==null&&(l.return=null),o.return=null}catch(u){Fr(o,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)yj(e,t),e=e.sibling}function yj(t,e){var r=t.alternate,n=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(vi(e,t),oa(t),n&4){try{bb(3,t,t.return),zT(3,t)}catch(h){Fr(t,t.return,h)}try{bb(5,t,t.return)}catch(h){Fr(t,t.return,h)}}break;case 1:vi(e,t),oa(t),n&512&&r!==null&&xg(r,r.return);break;case 5:if(vi(e,t),oa(t),n&512&&r!==null&&xg(r,r.return),t.flags&32){var o=t.stateNode;try{Sb(o,"")}catch(h){Fr(t,t.return,h)}}if(n&4&&(o=t.stateNode,o!=null)){var s=t.memoizedProps,i=r!==null?r.memoizedProps:s,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&z9(o,s),PD(a,i);var u=PD(a,s);for(i=0;i<l.length;i+=2){var c=l[i],p=l[i+1];c==="style"?U9(o,p):c==="dangerouslySetInnerHTML"?W9(o,p):c==="children"?Sb(o,p):b$(o,c,p,u)}switch(a){case"input":DD(o,s);break;case"textarea":B9(o,s);break;case"select":var f=o._wrapperState.wasMultiple;o._wrapperState.wasMultiple=!!s.multiple;var d=s.value;d!=null?bg(o,!!s.multiple,d,!1):f!==!!s.multiple&&(s.defaultValue!=null?bg(o,!!s.multiple,s.defaultValue,!0):bg(o,!!s.multiple,s.multiple?[]:"",!1))}o[$b]=s}catch(h){Fr(t,t.return,h)}}break;case 6:if(vi(e,t),oa(t),n&4){if(t.stateNode===null)throw Error(he(162));o=t.stateNode,s=t.memoizedProps;try{o.nodeValue=s}catch(h){Fr(t,t.return,h)}}break;case 3:if(vi(e,t),oa(t),n&4&&r!==null&&r.memoizedState.isDehydrated)try{Ib(e.containerInfo)}catch(h){Fr(t,t.return,h)}break;case 4:vi(e,t),oa(t);break;case 13:vi(e,t),oa(t),o=t.child,o.flags&8192&&(s=o.memoizedState!==null,o.stateNode.isHidden=s,!s||o.alternate!==null&&o.alternate.memoizedState!==null||(Z$=Br())),n&4&&k9(t);break;case 22:if(c=r!==null&&r.memoizedState!==null,t.mode&1?(to=(u=to)||c,vi(e,t),to=u):vi(e,t),oa(t),n&8192){if(u=t.memoizedState!==null,(t.stateNode.isHidden=u)&&!c&&(t.mode&1)!==0)for(_e=t,c=t.child;c!==null;){for(p=_e=c;_e!==null;){switch(f=_e,d=f.child,f.tag){case 0:case 11:case 14:case 15:bb(4,f,f.return);break;case 1:xg(f,f.return);var m=f.stateNode;if(typeof m.componentWillUnmount=="function"){n=f,r=f.return;try{e=n,m.props=e.memoizedProps,m.state=e.memoizedState,m.componentWillUnmount()}catch(h){Fr(n,r,h)}}break;case 5:xg(f,f.return);break;case 22:if(f.memoizedState!==null){N9(p);continue}}d!==null?(d.return=f,_e=d):N9(p)}c=c.sibling}e:for(c=null,p=t;;){if(p.tag===5){if(c===null){c=p;try{o=p.stateNode,u?(s=o.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=p.stateNode,l=p.memoizedProps.style,i=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=G9("display",i))}catch(h){Fr(t,t.return,h)}}}else if(p.tag===6){if(c===null)try{p.stateNode.nodeValue=u?"":p.memoizedProps}catch(h){Fr(t,t.return,h)}}else if((p.tag!==22&&p.tag!==23||p.memoizedState===null||p===t)&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===t)break e;for(;p.sibling===null;){if(p.return===null||p.return===t)break e;c===p&&(c=null),p=p.return}c===p&&(c=null),p.sibling.return=p.return,p=p.sibling}}break;case 19:vi(e,t),oa(t),n&4&&k9(t);break;case 21:break;default:vi(e,t),oa(t)}}function oa(t){var e=t.flags;if(e&2){try{e:{for(var r=t.return;r!==null;){if(gj(r)){var n=r;break e}r=r.return}throw Error(he(160))}switch(n.tag){case 5:var o=n.stateNode;n.flags&32&&(Sb(o,""),n.flags&=-33);var s=S9(t);f$(t,s,o);break;case 3:case 4:var i=n.stateNode.containerInfo,a=S9(t);p$(t,a,i);break;default:throw Error(he(161))}}catch(l){Fr(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function cye(t,e,r){_e=t,bj(t,e,r)}function bj(t,e,r){for(var n=(t.mode&1)!==0;_e!==null;){var o=_e,s=o.child;if(o.tag===22&&n){var i=o.memoizedState!==null||Xk;if(!i){var a=o.alternate,l=a!==null&&a.memoizedState!==null||to;a=Xk;var u=to;if(Xk=i,(to=l)&&!u)for(_e=o;_e!==null;)i=_e,l=i.child,i.tag===22&&i.memoizedState!==null?I9(o):l!==null?(l.return=i,_e=l):I9(o);for(;s!==null;)_e=s,bj(s,e,r),s=s.sibling;_e=o,Xk=a,to=u}T9(t,e,r)}else(o.subtreeFlags&8772)!==0&&s!==null?(s.return=o,_e=s):T9(t,e,r)}}function T9(t){for(;_e!==null;){var e=_e;if((e.flags&8772)!==0){var r=e.alternate;try{if((e.flags&8772)!==0)switch(e.tag){case 0:case 11:case 15:to||zT(5,e);break;case 1:var n=e.stateNode;if(e.flags&4&&!to)if(r===null)n.componentDidMount();else{var o=e.elementType===e.type?r.memoizedProps:wi(e.type,r.memoizedProps);n.componentDidUpdate(o,r.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&l9(e,s,n);break;case 3:var i=e.updateQueue;if(i!==null){if(r=null,e.child!==null)switch(e.child.tag){case 5:r=e.child.stateNode;break;case 1:r=e.child.stateNode}l9(e,i,r)}break;case 5:var a=e.stateNode;if(r===null&&e.flags&4){r=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&r.focus();break;case"img":l.src&&(r.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var c=u.memoizedState;if(c!==null){var p=c.dehydrated;p!==null&&Ib(p)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(he(163))}to||e.flags&512&&c$(e)}catch(f){Fr(e,e.return,f)}}if(e===t){_e=null;break}if(r=e.sibling,r!==null){r.return=e.return,_e=r;break}_e=e.return}}function N9(t){for(;_e!==null;){var e=_e;if(e===t){_e=null;break}var r=e.sibling;if(r!==null){r.return=e.return,_e=r;break}_e=e.return}}function I9(t){for(;_e!==null;){var e=_e;try{switch(e.tag){case 0:case 11:case 15:var r=e.return;try{zT(4,e)}catch(l){Fr(e,r,l)}break;case 1:var n=e.stateNode;if(typeof n.componentDidMount=="function"){var o=e.return;try{n.componentDidMount()}catch(l){Fr(e,o,l)}}var s=e.return;try{c$(e)}catch(l){Fr(e,s,l)}break;case 5:var i=e.return;try{c$(e)}catch(l){Fr(e,i,l)}}}catch(l){Fr(e,e.return,l)}if(e===t){_e=null;break}var a=e.sibling;if(a!==null){a.return=e.return,_e=a;break}_e=e.return}}var pye=Math.ceil,NT=Yl.ReactCurrentDispatcher,Y$=Yl.ReactCurrentOwner,Hs=Yl.ReactCurrentBatchConfig,xt=0,Tn=null,Yr=null,Pn=0,os=0,yg=np(0),fn=0,Mb=null,Zf=0,BT=0,Q$=0,vb=null,Po=null,Z$=0,Dg=1/0,Vl=null,IT=!1,d$=null,Qc=null,Yk=!1,Hc=null,ET=0,wb=0,m$=null,oT=-1,sT=0;function mo(){return(xt&6)!==0?Br():oT!==-1?oT:oT=Br()}function Zc(t){return(t.mode&1)===0?1:(xt&2)!==0&&Pn!==0?Pn&-Pn:Kxe.transition!==null?(sT===0&&(sT=rq()),sT):(t=Mt,t!==0||(t=window.event,t=t===void 0?16:uq(t.type)),t)}function Ti(t,e,r,n){if(50<wb)throw wb=0,m$=null,Error(he(185));zb(t,r,n),((xt&2)===0||t!==Tn)&&(t===Tn&&((xt&2)===0&&(BT|=r),fn===4&&Gc(t,Pn)),Bo(t,n),r===1&&xt===0&&(e.mode&1)===0&&(Dg=Br()+500,PT&&op()))}function Bo(t,e){var r=t.callbackNode;Yge(t,e);var n=pT(t,t===Tn?Pn:0);if(n===0)r!==null&&F7(r),t.callbackNode=null,t.callbackPriority=0;else if(e=n&-n,t.callbackPriority!==e){if(r!=null&&F7(r),e===1)t.tag===0?jxe(E9.bind(null,t)):Eq(E9.bind(null,t)),Gxe(function(){(xt&6)===0&&op()}),r=null;else{switch(nq(n)){case 1:r=k$;break;case 4:r=eq;break;case 16:r=cT;break;case 536870912:r=tq;break;default:r=cT}r=Ij(r,vj.bind(null,t))}t.callbackPriority=e,t.callbackNode=r}}function vj(t,e){if(oT=-1,sT=0,(xt&6)!==0)throw Error(he(327));var r=t.callbackNode;if(kg()&&t.callbackNode!==r)return null;var n=pT(t,t===Tn?Pn:0);if(n===0)return null;if((n&30)!==0||(n&t.expiredLanes)!==0||e)e=_T(t,n);else{e=n;var o=xt;xt|=2;var s=Cj();(Tn!==t||Pn!==e)&&(Vl=null,Dg=Br()+500,jf(t,e));do try{mye();break}catch(a){wj(t,a)}while(1);L$(),NT.current=s,xt=o,Yr!==null?e=0:(Tn=null,Pn=0,e=fn)}if(e!==0){if(e===2&&(o=VD(t),o!==0&&(n=o,e=h$(t,o))),e===1)throw r=Mb,jf(t,0),Gc(t,n),Bo(t,Br()),r;if(e===6)Gc(t,n);else{if(o=t.current.alternate,(n&30)===0&&!fye(o)&&(e=_T(t,n),e===2&&(s=VD(t),s!==0&&(n=s,e=h$(t,s))),e===1))throw r=Mb,jf(t,0),Gc(t,n),Bo(t,Br()),r;switch(t.finishedWork=o,t.finishedLanes=n,e){case 0:case 1:throw Error(he(345));case 2:Gf(t,Po,Vl);break;case 3:if(Gc(t,n),(n&130023424)===n&&(e=Z$+500-Br(),10<e)){if(pT(t,0)!==0)break;if(o=t.suspendedLanes,(o&n)!==n){mo(),t.pingedLanes|=t.suspendedLanes&o;break}t.timeoutHandle=XD(Gf.bind(null,t,Po,Vl),e);break}Gf(t,Po,Vl);break;case 4:if(Gc(t,n),(n&4194240)===n)break;for(e=t.eventTimes,o=-1;0<n;){var i=31-ki(n);s=1<<i,i=e[i],i>o&&(o=i),n&=~s}if(n=o,n=Br()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*pye(n/1960))-n,10<n){t.timeoutHandle=XD(Gf.bind(null,t,Po,Vl),n);break}Gf(t,Po,Vl);break;case 5:Gf(t,Po,Vl);break;default:throw Error(he(329))}}}return Bo(t,Br()),t.callbackNode===r?vj.bind(null,t):null}function h$(t,e){var r=vb;return t.current.memoizedState.isDehydrated&&(jf(t,e).flags|=256),t=_T(t,e),t!==2&&(e=Po,Po=r,e!==null&&g$(e)),t}function g$(t){Po===null?Po=t:Po.push.apply(Po,t)}function fye(t){for(var e=t;;){if(e.flags&16384){var r=e.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var n=0;n<r.length;n++){var o=r[n],s=o.getSnapshot;o=o.value;try{if(!Ni(s(),o))return!1}catch{return!1}}}if(r=e.child,e.subtreeFlags&16384&&r!==null)r.return=e,e=r;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Gc(t,e){for(e&=~Q$,e&=~BT,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var r=31-ki(e),n=1<<r;t[r]=-1,e&=~n}}function E9(t){if((xt&6)!==0)throw Error(he(327));kg();var e=pT(t,0);if((e&1)===0)return Bo(t,Br()),null;var r=_T(t,e);if(t.tag!==0&&r===2){var n=VD(t);n!==0&&(e=n,r=h$(t,n))}if(r===1)throw r=Mb,jf(t,0),Gc(t,e),Bo(t,Br()),r;if(r===6)throw Error(he(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Gf(t,Po,Vl),Bo(t,Br()),null}function J$(t,e){var r=xt;xt|=1;try{return t(e)}finally{xt=r,xt===0&&(Dg=Br()+500,PT&&op())}}function Jf(t){Hc!==null&&Hc.tag===0&&(xt&6)===0&&kg();var e=xt;xt|=1;var r=Hs.transition,n=Mt;try{if(Hs.transition=null,Mt=1,t)return t()}finally{Mt=n,Hs.transition=r,xt=e,(xt&6)===0&&op()}}function eR(){os=yg.current,fr(yg)}function jf(t,e){t.finishedWork=null,t.finishedLanes=0;var r=t.timeoutHandle;if(r!==-1&&(t.timeoutHandle=-1,Wxe(r)),Yr!==null)for(r=Yr.return;r!==null;){var n=r;switch(O$(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&gT();break;case 3:_g(),fr(Mo),fr(ro),G$();break;case 5:W$(n);break;case 4:_g();break;case 13:fr(Tr);break;case 19:fr(Tr);break;case 10:M$(n.type._context);break;case 22:case 23:eR()}r=r.return}if(Tn=t,Yr=t=Jc(t.current,null),Pn=os=e,fn=0,Mb=null,Q$=BT=Zf=0,Po=vb=null,Hf!==null){for(e=0;e<Hf.length;e++)if(r=Hf[e],n=r.interleaved,n!==null){r.interleaved=null;var o=n.next,s=r.pending;if(s!==null){var i=s.next;s.next=o,n.next=i}r.pending=n}Hf=null}return t}function wj(t,e){do{var r=Yr;try{if(L$(),tT.current=TT,kT){for(var n=Nr.memoizedState;n!==null;){var o=n.queue;o!==null&&(o.pending=null),n=n.next}kT=!1}if(Qf=0,kn=pn=Nr=null,yb=!1,Fb=0,Y$.current=null,r===null||r.return===null){fn=1,Mb=e,Yr=null;break}e:{var s=t,i=r.return,a=r,l=e;if(e=Pn,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,c=a,p=c.tag;if((c.mode&1)===0&&(p===0||p===11||p===15)){var f=c.alternate;f?(c.updateQueue=f.updateQueue,c.memoizedState=f.memoizedState,c.lanes=f.lanes):(c.updateQueue=null,c.memoizedState=null)}var d=h9(i);if(d!==null){d.flags&=-257,g9(d,i,a,s,e),d.mode&1&&m9(s,u,e),e=d,l=u;var m=e.updateQueue;if(m===null){var h=new Set;h.add(l),e.updateQueue=h}else m.add(l);break e}else{if((e&1)===0){m9(s,u,e),tR();break e}l=Error(he(426))}}else if(gr&&a.mode&1){var x=h9(i);if(x!==null){(x.flags&65536)===0&&(x.flags|=256),g9(x,i,a,s,e),F$(Ag(l,a));break e}}s=l=Ag(l,a),fn!==4&&(fn=2),vb===null?vb=[s]:vb.push(s),s=i;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var g=oj(s,l,e);a9(s,g);break e;case 1:a=l;var y=s.type,b=s.stateNode;if((s.flags&128)===0&&(typeof y.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(Qc===null||!Qc.has(b)))){s.flags|=65536,e&=-e,s.lanes|=e;var v=sj(s,a,e);a9(s,v);break e}}s=s.return}while(s!==null)}kj(r)}catch(C){e=C,Yr===r&&r!==null&&(Yr=r=r.return);continue}break}while(1)}function Cj(){var t=NT.current;return NT.current=TT,t===null?TT:t}function tR(){(fn===0||fn===3||fn===2)&&(fn=4),Tn===null||(Zf&268435455)===0&&(BT&268435455)===0||Gc(Tn,Pn)}function _T(t,e){var r=xt;xt|=2;var n=Cj();(Tn!==t||Pn!==e)&&(Vl=null,jf(t,e));do try{dye();break}catch(o){wj(t,o)}while(1);if(L$(),xt=r,NT.current=n,Yr!==null)throw Error(he(261));return Tn=null,Pn=0,fn}function dye(){for(;Yr!==null;)Sj(Yr)}function mye(){for(;Yr!==null&&!Vge();)Sj(Yr)}function Sj(t){var e=Nj(t.alternate,t,os);t.memoizedProps=t.pendingProps,e===null?kj(t):Yr=e,Y$.current=null}function kj(t){var e=t;do{var r=e.alternate;if(t=e.return,(e.flags&32768)===0){if(r=iye(r,e,os),r!==null){Yr=r;return}}else{if(r=aye(r,e),r!==null){r.flags&=32767,Yr=r;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{fn=6,Yr=null;return}}if(e=e.sibling,e!==null){Yr=e;return}Yr=e=t}while(e!==null);fn===0&&(fn=5)}function Gf(t,e,r){var n=Mt,o=Hs.transition;try{Hs.transition=null,Mt=1,hye(t,e,r,n)}finally{Hs.transition=o,Mt=n}return null}function hye(t,e,r,n){do kg();while(Hc!==null);if((xt&6)!==0)throw Error(he(327));r=t.finishedWork;var o=t.finishedLanes;if(r===null)return null;if(t.finishedWork=null,t.finishedLanes=0,r===t.current)throw Error(he(177));t.callbackNode=null,t.callbackPriority=0;var s=r.lanes|r.childLanes;if(Qge(t,s),t===Tn&&(Yr=Tn=null,Pn=0),(r.subtreeFlags&2064)===0&&(r.flags&2064)===0||Yk||(Yk=!0,Ij(cT,function(){return kg(),null})),s=(r.flags&15990)!==0,(r.subtreeFlags&15990)!==0||s){s=Hs.transition,Hs.transition=null;var i=Mt;Mt=1;var a=xt;xt|=4,Y$.current=null,uye(t,r),yj(r,t),Lxe(jD),fT=!!qD,jD=qD=null,t.current=r,cye(r,t,o),Wge(),xt=a,Mt=i,Hs.transition=s}else t.current=r;if(Yk&&(Yk=!1,Hc=t,ET=o),s=t.pendingLanes,s===0&&(Qc=null),Hge(r.stateNode,n),Bo(t,Br()),e!==null)for(n=t.onRecoverableError,r=0;r<e.length;r++)o=e[r],n(o.value,{componentStack:o.stack,digest:o.digest});if(IT)throw IT=!1,t=d$,d$=null,t;return(ET&1)!==0&&t.tag!==0&&kg(),s=t.pendingLanes,(s&1)!==0?t===m$?wb++:(wb=0,m$=t):wb=0,op(),null}function kg(){if(Hc!==null){var t=nq(ET),e=Hs.transition,r=Mt;try{if(Hs.transition=null,Mt=16>t?16:t,Hc===null)var n=!1;else{if(t=Hc,Hc=null,ET=0,(xt&6)!==0)throw Error(he(331));var o=xt;for(xt|=4,_e=t.current;_e!==null;){var s=_e,i=s.child;if((_e.flags&16)!==0){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var u=a[l];for(_e=u;_e!==null;){var c=_e;switch(c.tag){case 0:case 11:case 15:bb(8,c,s)}var p=c.child;if(p!==null)p.return=c,_e=p;else for(;_e!==null;){c=_e;var f=c.sibling,d=c.return;if(hj(c),c===u){_e=null;break}if(f!==null){f.return=d,_e=f;break}_e=d}}}var m=s.alternate;if(m!==null){var h=m.child;if(h!==null){m.child=null;do{var x=h.sibling;h.sibling=null,h=x}while(h!==null)}}_e=s}}if((s.subtreeFlags&2064)!==0&&i!==null)i.return=s,_e=i;else e:for(;_e!==null;){if(s=_e,(s.flags&2048)!==0)switch(s.tag){case 0:case 11:case 15:bb(9,s,s.return)}var g=s.sibling;if(g!==null){g.return=s.return,_e=g;break e}_e=s.return}}var y=t.current;for(_e=y;_e!==null;){i=_e;var b=i.child;if((i.subtreeFlags&2064)!==0&&b!==null)b.return=i,_e=b;else e:for(i=y;_e!==null;){if(a=_e,(a.flags&2048)!==0)try{switch(a.tag){case 0:case 11:case 15:zT(9,a)}}catch(C){Fr(a,a.return,C)}if(a===i){_e=null;break e}var v=a.sibling;if(v!==null){v.return=a.return,_e=v;break e}_e=a.return}}if(xt=o,op(),aa&&typeof aa.onPostCommitFiberRoot=="function")try{aa.onPostCommitFiberRoot(DT,t)}catch{}n=!0}return n}finally{Mt=r,Hs.transition=e}}return!1}function _9(t,e,r){e=Ag(r,e),e=oj(t,e,1),t=Yc(t,e,1),e=mo(),t!==null&&(zb(t,1,e),Bo(t,e))}function Fr(t,e,r){if(t.tag===3)_9(t,t,r);else for(;e!==null;){if(e.tag===3){_9(e,t,r);break}else if(e.tag===1){var n=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Qc===null||!Qc.has(n))){t=Ag(r,t),t=sj(e,t,1),e=Yc(e,t,1),t=mo(),e!==null&&(zb(e,1,t),Bo(e,t));break}}e=e.return}}function gye(t,e,r){var n=t.pingCache;n!==null&&n.delete(e),e=mo(),t.pingedLanes|=t.suspendedLanes&r,Tn===t&&(Pn&r)===r&&(fn===4||fn===3&&(Pn&130023424)===Pn&&500>Br()-Z$?jf(t,0):Q$|=r),Bo(t,e)}function Tj(t,e){e===0&&((t.mode&1)===0?e=1:(e=Pk,Pk<<=1,(Pk&130023424)===0&&(Pk=4194304)));var r=mo();t=Kl(t,e),t!==null&&(zb(t,e,r),Bo(t,r))}function xye(t){var e=t.memoizedState,r=0;e!==null&&(r=e.retryLane),Tj(t,r)}function yye(t,e){var r=0;switch(t.tag){case 13:var n=t.stateNode,o=t.memoizedState;o!==null&&(r=o.retryLane);break;case 19:n=t.stateNode;break;default:throw Error(he(314))}n!==null&&n.delete(e),Tj(t,r)}var Nj;Nj=function(t,e,r){if(t!==null)if(t.memoizedProps!==e.pendingProps||Mo.current)Lo=!0;else{if((t.lanes&r)===0&&(e.flags&128)===0)return Lo=!1,sye(t,e,r);Lo=(t.flags&131072)!==0}else Lo=!1,gr&&(e.flags&1048576)!==0&&_q(e,bT,e.index);switch(e.lanes=0,e.tag){case 2:var n=e.type;nT(t,e),t=e.pendingProps;var o=Ng(e,ro.current);Sg(e,r),o=H$(null,e,n,t,o,r);var s=q$();return e.flags|=1,typeof o=="object"&&o!==null&&typeof o.render=="function"&&o.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,zo(n)?(s=!0,xT(e)):s=!1,e.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,B$(e),o.updater=LT,e.stateNode=o,o._reactInternals=e,r$(e,n,t,r),e=s$(null,e,n,!0,s,r)):(e.tag=0,gr&&s&&R$(e),fo(null,e,o,r),e=e.child),e;case 16:n=e.elementType;e:{switch(nT(t,e),t=e.pendingProps,o=n._init,n=o(n._payload),e.type=n,o=e.tag=vye(n),t=wi(n,t),o){case 0:e=o$(null,e,n,t,r);break e;case 1:e=b9(null,e,n,t,r);break e;case 11:e=x9(null,e,n,t,r);break e;case 14:e=y9(null,e,n,wi(n.type,t),r);break e}throw Error(he(306,n,""))}return e;case 0:return n=e.type,o=e.pendingProps,o=e.elementType===n?o:wi(n,o),o$(t,e,n,o,r);case 1:return n=e.type,o=e.pendingProps,o=e.elementType===n?o:wi(n,o),b9(t,e,n,o,r);case 3:e:{if(uj(e),t===null)throw Error(he(387));n=e.pendingProps,s=e.memoizedState,o=s.element,Rq(t,e),CT(e,n,null,r);var i=e.memoizedState;if(n=i.element,s.isDehydrated)if(s={element:n,isDehydrated:!1,cache:i.cache,pendingSuspenseBoundaries:i.pendingSuspenseBoundaries,transitions:i.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){o=Ag(Error(he(423)),e),e=v9(t,e,n,r,o);break e}else if(n!==o){o=Ag(Error(he(424)),e),e=v9(t,e,n,r,o);break e}else for(ss=Xc(e.stateNode.containerInfo.firstChild),is=e,gr=!0,Si=null,r=Lq(e,null,n,r),e.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(Ig(),n===o){e=Xl(t,e,r);break e}fo(t,e,n,r)}e=e.child}return e;case 5:return Mq(e),t===null&&JD(e),n=e.type,o=e.pendingProps,s=t!==null?t.memoizedProps:null,i=o.children,KD(n,o)?i=null:s!==null&&KD(n,s)&&(e.flags|=32),lj(t,e),fo(t,e,i,r),e.child;case 6:return t===null&&JD(e),null;case 13:return cj(t,e,r);case 4:return V$(e,e.stateNode.containerInfo),n=e.pendingProps,t===null?e.child=Eg(e,null,n,r):fo(t,e,n,r),e.child;case 11:return n=e.type,o=e.pendingProps,o=e.elementType===n?o:wi(n,o),x9(t,e,n,o,r);case 7:return fo(t,e,e.pendingProps,r),e.child;case 8:return fo(t,e,e.pendingProps.children,r),e.child;case 12:return fo(t,e,e.pendingProps.children,r),e.child;case 10:e:{if(n=e.type._context,o=e.pendingProps,s=e.memoizedProps,i=o.value,nr(vT,n._currentValue),n._currentValue=i,s!==null)if(Ni(s.value,i)){if(s.children===o.children&&!Mo.current){e=Xl(t,e,r);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){i=s.child;for(var l=a.firstContext;l!==null;){if(l.context===n){if(s.tag===1){l=Hl(-1,r&-r),l.tag=2;var u=s.updateQueue;if(u!==null){u=u.shared;var c=u.pending;c===null?l.next=l:(l.next=c.next,c.next=l),u.pending=l}}s.lanes|=r,l=s.alternate,l!==null&&(l.lanes|=r),e$(s.return,r,e),a.lanes|=r;break}l=l.next}}else if(s.tag===10)i=s.type===e.type?null:s.child;else if(s.tag===18){if(i=s.return,i===null)throw Error(he(341));i.lanes|=r,a=i.alternate,a!==null&&(a.lanes|=r),e$(i,r,e),i=s.sibling}else i=s.child;if(i!==null)i.return=s;else for(i=s;i!==null;){if(i===e){i=null;break}if(s=i.sibling,s!==null){s.return=i.return,i=s;break}i=i.return}s=i}fo(t,e,o.children,r),e=e.child}return e;case 9:return o=e.type,n=e.pendingProps.children,Sg(e,r),o=qs(o),n=n(o),e.flags|=1,fo(t,e,n,r),e.child;case 14:return n=e.type,o=wi(n,e.pendingProps),o=wi(n.type,o),y9(t,e,n,o,r);case 15:return ij(t,e,e.type,e.pendingProps,r);case 17:return n=e.type,o=e.pendingProps,o=e.elementType===n?o:wi(n,o),nT(t,e),e.tag=1,zo(n)?(t=!0,xT(e)):t=!1,Sg(e,r),Fq(e,n,o),r$(e,n,o,r),s$(null,e,n,!0,t,r);case 19:return pj(t,e,r);case 22:return aj(t,e,r)}throw Error(he(156,e.tag))};function Ij(t,e){return J9(t,e)}function bye(t,e,r,n){this.tag=t,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Us(t,e,r,n){return new bye(t,e,r,n)}function rR(t){return t=t.prototype,!(!t||!t.isReactComponent)}function vye(t){if(typeof t=="function")return rR(t)?1:0;if(t!=null){if(t=t.$$typeof,t===w$)return 11;if(t===C$)return 14}return 2}function Jc(t,e){var r=t.alternate;return r===null?(r=Us(t.tag,e,t.key,t.mode),r.elementType=t.elementType,r.type=t.type,r.stateNode=t.stateNode,r.alternate=t,t.alternate=r):(r.pendingProps=e,r.type=t.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=t.flags&14680064,r.childLanes=t.childLanes,r.lanes=t.lanes,r.child=t.child,r.memoizedProps=t.memoizedProps,r.memoizedState=t.memoizedState,r.updateQueue=t.updateQueue,e=t.dependencies,r.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},r.sibling=t.sibling,r.index=t.index,r.ref=t.ref,r}function iT(t,e,r,n,o,s){var i=2;if(n=t,typeof t=="function")rR(t)&&(i=1);else if(typeof t=="string")i=5;else e:switch(t){case lg:return Kf(r.children,o,s,e);case v$:i=8,o|=8;break;case ND:return t=Us(12,r,e,o|2),t.elementType=ND,t.lanes=s,t;case ID:return t=Us(13,r,e,o),t.elementType=ID,t.lanes=s,t;case ED:return t=Us(19,r,e,o),t.elementType=ED,t.lanes=s,t;case P9:return VT(r,o,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case O9:i=10;break e;case F9:i=9;break e;case w$:i=11;break e;case C$:i=14;break e;case Bc:i=16,n=null;break e}throw Error(he(130,t==null?t:typeof t,""))}return e=Us(i,r,e,o),e.elementType=t,e.type=n,e.lanes=s,e}function Kf(t,e,r,n){return t=Us(7,t,n,e),t.lanes=r,t}function VT(t,e,r,n){return t=Us(22,t,n,e),t.elementType=P9,t.lanes=r,t.stateNode={isHidden:!1},t}function SD(t,e,r){return t=Us(6,t,null,e),t.lanes=r,t}function kD(t,e,r){return e=Us(4,t.children!==null?t.children:[],t.key,e),e.lanes=r,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function wye(t,e,r,n,o){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=aD(0),this.expirationTimes=aD(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=aD(0),this.identifierPrefix=n,this.onRecoverableError=o,this.mutableSourceEagerHydrationData=null}function nR(t,e,r,n,o,s,i,a,l){return t=new wye(t,e,r,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=Us(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:n,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},B$(s),t}function Cye(t,e,r){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ag,key:n==null?null:""+n,children:t,containerInfo:e,implementation:r}}function Ej(t){if(!t)return tp;t=t._reactInternals;e:{if(td(t)!==t||t.tag!==1)throw Error(he(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(zo(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(he(171))}if(t.tag===1){var r=t.type;if(zo(r))return Iq(t,r,e)}return e}function _j(t,e,r,n,o,s,i,a,l){return t=nR(r,n,!0,t,o,s,i,a,l),t.context=Ej(null),r=t.current,n=mo(),o=Zc(r),s=Hl(n,o),s.callback=e??null,Yc(r,s,o),t.current.lanes=o,zb(t,o,n),Bo(t,n),t}function WT(t,e,r,n){var o=e.current,s=mo(),i=Zc(o);return r=Ej(r),e.context===null?e.context=r:e.pendingContext=r,e=Hl(s,i),e.payload={element:t},n=n===void 0?null:n,n!==null&&(e.callback=n),t=Yc(o,e,i),t!==null&&(Ti(t,o,i,s),eT(t,o,i)),i}function AT(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function A9(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var r=t.retryLane;t.retryLane=r!==0&&r<e?r:e}}function oR(t,e){A9(t,e),(t=t.alternate)&&A9(t,e)}function Sye(){return null}var Aj=typeof reportError=="function"?reportError:function(t){console.error(t)};function sR(t){this._internalRoot=t}GT.prototype.render=sR.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(he(409));WT(t,e,null,null)};GT.prototype.unmount=sR.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Jf(function(){WT(null,t,null,null)}),e[jl]=null}};function GT(t){this._internalRoot=t}GT.prototype.unstable_scheduleHydration=function(t){if(t){var e=iq();t={blockedOn:null,target:t,priority:e};for(var r=0;r<Wc.length&&e!==0&&e<Wc[r].priority;r++);Wc.splice(r,0,t),r===0&&lq(t)}};function iR(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function UT(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function D9(){}function kye(t,e,r,n,o){if(o){if(typeof n=="function"){var s=n;n=function(){var u=AT(i);s.call(u)}}var i=_j(e,n,t,0,null,!1,!1,"",D9);return t._reactRootContainer=i,t[jl]=i.current,Ab(t.nodeType===8?t.parentNode:t),Jf(),i}for(;o=t.lastChild;)t.removeChild(o);if(typeof n=="function"){var a=n;n=function(){var u=AT(l);a.call(u)}}var l=nR(t,0,!1,null,null,!1,!1,"",D9);return t._reactRootContainer=l,t[jl]=l.current,Ab(t.nodeType===8?t.parentNode:t),Jf(function(){WT(e,l,r,n)}),l}function HT(t,e,r,n,o){var s=r._reactRootContainer;if(s){var i=s;if(typeof o=="function"){var a=o;o=function(){var l=AT(i);a.call(l)}}WT(e,i,t,o)}else i=kye(r,e,t,o,n);return AT(i)}oq=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var r=pb(e.pendingLanes);r!==0&&(T$(e,r|1),Bo(e,Br()),(xt&6)===0&&(Dg=Br()+500,op()))}break;case 13:Jf(function(){var n=Kl(t,1);if(n!==null){var o=mo();Ti(n,t,1,o)}}),oR(t,1)}};N$=function(t){if(t.tag===13){var e=Kl(t,134217728);if(e!==null){var r=mo();Ti(e,t,134217728,r)}oR(t,134217728)}};sq=function(t){if(t.tag===13){var e=Zc(t),r=Kl(t,e);if(r!==null){var n=mo();Ti(r,t,e,n)}oR(t,e)}};iq=function(){return Mt};aq=function(t,e){var r=Mt;try{return Mt=t,e()}finally{Mt=r}};MD=function(t,e,r){switch(e){case"input":if(DD(t,r),e=r.name,r.type==="radio"&&e!=null){for(r=t;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<r.length;e++){var n=r[e];if(n!==t&&n.form===t.form){var o=FT(n);if(!o)throw Error(he(90));M9(n),DD(n,o)}}}break;case"textarea":B9(t,r);break;case"select":e=r.value,e!=null&&bg(t,!!r.multiple,e,!1)}};j9=J$;K9=Jf;var Tye={usingClientEntryPoint:!1,Events:[Vb,fg,FT,H9,q9,J$]},ab={findFiberByHostInstance:Uf,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},Nye={bundleType:ab.bundleType,version:ab.version,rendererPackageName:ab.rendererPackageName,rendererConfig:ab.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Yl.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=Q9(t),t===null?null:t.stateNode},findFiberByHostInstance:ab.findFiberByHostInstance||Sye,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&(lb=__REACT_DEVTOOLS_GLOBAL_HOOK__,!lb.isDisabled&&lb.supportsFiber))try{DT=lb.inject(Nye),aa=lb}catch{}var lb;us.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Tye;us.createPortal=function(t,e){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!iR(e))throw Error(he(200));return Cye(t,e,null,r)};us.createRoot=function(t,e){if(!iR(t))throw Error(he(299));var r=!1,n="",o=Aj;return e!=null&&(e.unstable_strictMode===!0&&(r=!0),e.identifierPrefix!==void 0&&(n=e.identifierPrefix),e.onRecoverableError!==void 0&&(o=e.onRecoverableError)),e=nR(t,1,!1,null,null,r,!1,n,o),t[jl]=e.current,Ab(t.nodeType===8?t.parentNode:t),new sR(e)};us.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(he(188)):(t=Object.keys(t).join(","),Error(he(268,t)));return t=Q9(e),t=t===null?null:t.stateNode,t};us.flushSync=function(t){return Jf(t)};us.hydrate=function(t,e,r){if(!UT(e))throw Error(he(200));return HT(null,t,e,!0,r)};us.hydrateRoot=function(t,e,r){if(!iR(t))throw Error(he(405));var n=r!=null&&r.hydratedSources||null,o=!1,s="",i=Aj;if(r!=null&&(r.unstable_strictMode===!0&&(o=!0),r.identifierPrefix!==void 0&&(s=r.identifierPrefix),r.onRecoverableError!==void 0&&(i=r.onRecoverableError)),e=_j(e,null,t,1,r??null,o,!1,s,i),t[jl]=e.current,Ab(t),n)for(t=0;t<n.length;t++)r=n[t],o=r._getVersion,o=o(r._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[r,o]:e.mutableSourceEagerHydrationData.push(r,o);return new GT(e)};us.render=function(t,e,r){if(!UT(e))throw Error(he(200));return HT(null,t,e,!1,r)};us.unmountComponentAtNode=function(t){if(!UT(t))throw Error(he(40));return t._reactRootContainer?(Jf(function(){HT(null,null,t,!1,function(){t._reactRootContainer=null,t[jl]=null})}),!0):!1};us.unstable_batchedUpdates=J$;us.unstable_renderSubtreeIntoContainer=function(t,e,r,n){if(!UT(r))throw Error(he(200));if(t==null||t._reactInternals===void 0)throw Error(he(38));return HT(t,e,r,!1,n)};us.version="18.2.0-next-9e3b772b8-20220608"});var aR=Qe((Uqt,Rj)=>{"use strict";function $j(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE($j)}catch(t){console.error(t)}}$j(),Rj.exports=Dj()});var rK=Qe((MYt,tK)=>{var i0e=typeof Element<"u",a0e=typeof Map=="function",l0e=typeof Set=="function",u0e=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function ZT(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){if(t.constructor!==e.constructor)return!1;var r,n,o;if(Array.isArray(t)){if(r=t.length,r!=e.length)return!1;for(n=r;n--!==0;)if(!ZT(t[n],e[n]))return!1;return!0}var s;if(a0e&&t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(s=t.entries();!(n=s.next()).done;)if(!e.has(n.value[0]))return!1;for(s=t.entries();!(n=s.next()).done;)if(!ZT(n.value[1],e.get(n.value[0])))return!1;return!0}if(l0e&&t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(s=t.entries();!(n=s.next()).done;)if(!e.has(n.value[0]))return!1;return!0}if(u0e&&ArrayBuffer.isView(t)&&ArrayBuffer.isView(e)){if(r=t.length,r!=e.length)return!1;for(n=r;n--!==0;)if(t[n]!==e[n])return!1;return!0}if(t.constructor===RegExp)return t.source===e.source&&t.flags===e.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===e.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===e.toString();if(o=Object.keys(t),r=o.length,r!==Object.keys(e).length)return!1;for(n=r;n--!==0;)if(!Object.prototype.hasOwnProperty.call(e,o[n]))return!1;if(i0e&&t instanceof Element)return!1;for(n=r;n--!==0;)if(!((o[n]==="_owner"||o[n]==="__v"||o[n]==="__o")&&t.$$typeof)&&!ZT(t[o[n]],e[o[n]]))return!1;return!0}return t!==t&&e!==e}tK.exports=function(e,r){try{return ZT(e,r)}catch(n){if((n.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw n}}});var IO=Qe((pZt,JN)=>{(function(t){var e=/^\s+/,r=/\s+$/,n=0,o=t.round,s=t.min,i=t.max,a=t.random;function l(R,U){if(R=R||"",U=U||{},R instanceof l)return R;if(!(this instanceof l))return new l(R,U);var P=u(R);this._originalInput=R,this._r=P.r,this._g=P.g,this._b=P.b,this._a=P.a,this._roundA=o(100*this._a)/100,this._format=U.format||P.format,this._gradientType=U.gradientType,this._r<1&&(this._r=o(this._r)),this._g<1&&(this._g=o(this._g)),this._b<1&&(this._b=o(this._b)),this._ok=P.ok,this._tc_id=n++}l.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var R=this.toRgb();return(R.r*299+R.g*587+R.b*114)/1e3},getLuminance:function(){var R=this.toRgb(),U,P,se,pe,fe,Pe;return U=R.r/255,P=R.g/255,se=R.b/255,U<=.03928?pe=U/12.92:pe=t.pow((U+.055)/1.055,2.4),P<=.03928?fe=P/12.92:fe=t.pow((P+.055)/1.055,2.4),se<=.03928?Pe=se/12.92:Pe=t.pow((se+.055)/1.055,2.4),.2126*pe+.7152*fe+.0722*Pe},setAlpha:function(R){return this._a=Z(R),this._roundA=o(100*this._a)/100,this},toHsv:function(){var R=d(this._r,this._g,this._b);return{h:R.h*360,s:R.s,v:R.v,a:this._a}},toHsvString:function(){var R=d(this._r,this._g,this._b),U=o(R.h*360),P=o(R.s*100),se=o(R.v*100);return this._a==1?"hsv("+U+", "+P+"%, "+se+"%)":"hsva("+U+", "+P+"%, "+se+"%, "+this._roundA+")"},toHsl:function(){var R=p(this._r,this._g,this._b);return{h:R.h*360,s:R.s,l:R.l,a:this._a}},toHslString:function(){var R=p(this._r,this._g,this._b),U=o(R.h*360),P=o(R.s*100),se=o(R.l*100);return this._a==1?"hsl("+U+", "+P+"%, "+se+"%)":"hsla("+U+", "+P+"%, "+se+"%, "+this._roundA+")"},toHex:function(R){return h(this._r,this._g,this._b,R)},toHexString:function(R){return"#"+this.toHex(R)},toHex8:function(R){return x(this._r,this._g,this._b,this._a,R)},toHex8String:function(R){return"#"+this.toHex8(R)},toRgb:function(){return{r:o(this._r),g:o(this._g),b:o(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+o(this._r)+", "+o(this._g)+", "+o(this._b)+")":"rgba("+o(this._r)+", "+o(this._g)+", "+o(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:o(Q(this._r,255)*100)+"%",g:o(Q(this._g,255)*100)+"%",b:o(Q(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+o(Q(this._r,255)*100)+"%, "+o(Q(this._g,255)*100)+"%, "+o(Q(this._b,255)*100)+"%)":"rgba("+o(Q(this._r,255)*100)+"%, "+o(Q(this._g,255)*100)+"%, "+o(Q(this._b,255)*100)+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":this._a<1?!1:K[h(this._r,this._g,this._b,!0)]||!1},toFilter:function(R){var U="#"+g(this._r,this._g,this._b,this._a),P=U,se=this._gradientType?"GradientType = 1, ":"";if(R){var pe=l(R);P="#"+g(pe._r,pe._g,pe._b,pe._a)}return"progid:DXImageTransform.Microsoft.gradient("+se+"startColorstr="+U+",endColorstr="+P+")"},toString:function(R){var U=!!R;R=R||this._format;var P=!1,se=this._a<1&&this._a>=0,pe=!U&&se&&(R==="hex"||R==="hex6"||R==="hex3"||R==="hex4"||R==="hex8"||R==="name");return pe?R==="name"&&this._a===0?this.toName():this.toRgbString():(R==="rgb"&&(P=this.toRgbString()),R==="prgb"&&(P=this.toPercentageRgbString()),(R==="hex"||R==="hex6")&&(P=this.toHexString()),R==="hex3"&&(P=this.toHexString(!0)),R==="hex4"&&(P=this.toHex8String(!0)),R==="hex8"&&(P=this.toHex8String()),R==="name"&&(P=this.toName()),R==="hsl"&&(P=this.toHslString()),R==="hsv"&&(P=this.toHsvString()),P||this.toHexString())},clone:function(){return l(this.toString())},_applyModification:function(R,U){var P=R.apply(null,[this].concat([].slice.call(U)));return this._r=P._r,this._g=P._g,this._b=P._b,this.setAlpha(P._a),this},lighten:function(){return this._applyModification(C,arguments)},brighten:function(){return this._applyModification(S,arguments)},darken:function(){return this._applyModification(k,arguments)},desaturate:function(){return this._applyModification(y,arguments)},saturate:function(){return this._applyModification(b,arguments)},greyscale:function(){return this._applyModification(v,arguments)},spin:function(){return this._applyModification(I,arguments)},_applyCombination:function(R,U){return R.apply(null,[this].concat([].slice.call(U)))},analogous:function(){return this._applyCombination(H,arguments)},complement:function(){return this._applyCombination(A,arguments)},monochromatic:function(){return this._applyCombination(Y,arguments)},splitcomplement:function(){return this._applyCombination(j,arguments)},triad:function(){return this._applyCombination($,arguments)},tetrad:function(){return this._applyCombination(O,arguments)}},l.fromRatio=function(R,U){if(typeof R=="object"){var P={};for(var se in R)R.hasOwnProperty(se)&&(se==="a"?P[se]=R[se]:P[se]=ae(R[se]));R=P}return l(R,U)};function u(R){var U={r:0,g:0,b:0},P=1,se=null,pe=null,fe=null,Pe=!1,Be=!1;return typeof R=="string"&&(R=He(R)),typeof R=="object"&&(ke(R.r)&&ke(R.g)&&ke(R.b)?(U=c(R.r,R.g,R.b),Pe=!0,Be=String(R.r).substr(-1)==="%"?"prgb":"rgb"):ke(R.h)&&ke(R.s)&&ke(R.v)?(se=ae(R.s),pe=ae(R.v),U=m(R.h,se,pe),Pe=!0,Be="hsv"):ke(R.h)&&ke(R.s)&&ke(R.l)&&(se=ae(R.s),fe=ae(R.l),U=f(R.h,se,fe),Pe=!0,Be="hsl"),R.hasOwnProperty("a")&&(P=R.a)),P=Z(P),{ok:Pe,format:R.format||Be,r:s(255,i(U.r,0)),g:s(255,i(U.g,0)),b:s(255,i(U.b,0)),a:P}}function c(R,U,P){return{r:Q(R,255)*255,g:Q(U,255)*255,b:Q(P,255)*255}}function p(R,U,P){R=Q(R,255),U=Q(U,255),P=Q(P,255);var se=i(R,U,P),pe=s(R,U,P),fe,Pe,Be=(se+pe)/2;if(se==pe)fe=Pe=0;else{var Ge=se-pe;switch(Pe=Be>.5?Ge/(2-se-pe):Ge/(se+pe),se){case R:fe=(U-P)/Ge+(U<P?6:0);break;case U:fe=(P-R)/Ge+2;break;case P:fe=(R-U)/Ge+4;break}fe/=6}return{h:fe,s:Pe,l:Be}}function f(R,U,P){var se,pe,fe;R=Q(R,360),U=Q(U,100),P=Q(P,100);function Pe($t,hr,mt){return mt<0&&(mt+=1),mt>1&&(mt-=1),mt<1/6?$t+(hr-$t)*6*mt:mt<1/2?hr:mt<2/3?$t+(hr-$t)*(2/3-mt)*6:$t}if(U===0)se=pe=fe=P;else{var Be=P<.5?P*(1+U):P+U-P*U,Ge=2*P-Be;se=Pe(Ge,Be,R+1/3),pe=Pe(Ge,Be,R),fe=Pe(Ge,Be,R-1/3)}return{r:se*255,g:pe*255,b:fe*255}}function d(R,U,P){R=Q(R,255),U=Q(U,255),P=Q(P,255);var se=i(R,U,P),pe=s(R,U,P),fe,Pe,Be=se,Ge=se-pe;if(Pe=se===0?0:Ge/se,se==pe)fe=0;else{switch(se){case R:fe=(U-P)/Ge+(U<P?6:0);break;case U:fe=(P-R)/Ge+2;break;case P:fe=(R-U)/Ge+4;break}fe/=6}return{h:fe,s:Pe,v:Be}}function m(R,U,P){R=Q(R,360)*6,U=Q(U,100),P=Q(P,100);var se=t.floor(R),pe=R-se,fe=P*(1-U),Pe=P*(1-pe*U),Be=P*(1-(1-pe)*U),Ge=se%6,$t=[P,Pe,fe,fe,Be,P][Ge],hr=[Be,P,P,Pe,fe,fe][Ge],mt=[fe,fe,Be,P,P,Pe][Ge];return{r:$t*255,g:hr*255,b:mt*255}}function h(R,U,P,se){var pe=[le(o(R).toString(16)),le(o(U).toString(16)),le(o(P).toString(16))];return se&&pe[0].charAt(0)==pe[0].charAt(1)&&pe[1].charAt(0)==pe[1].charAt(1)&&pe[2].charAt(0)==pe[2].charAt(1)?pe[0].charAt(0)+pe[1].charAt(0)+pe[2].charAt(0):pe.join("")}function x(R,U,P,se,pe){var fe=[le(o(R).toString(16)),le(o(U).toString(16)),le(o(P).toString(16)),le(me(se))];return pe&&fe[0].charAt(0)==fe[0].charAt(1)&&fe[1].charAt(0)==fe[1].charAt(1)&&fe[2].charAt(0)==fe[2].charAt(1)&&fe[3].charAt(0)==fe[3].charAt(1)?fe[0].charAt(0)+fe[1].charAt(0)+fe[2].charAt(0)+fe[3].charAt(0):fe.join("")}function g(R,U,P,se){var pe=[le(me(se)),le(o(R).toString(16)),le(o(U).toString(16)),le(o(P).toString(16))];return pe.join("")}l.equals=function(R,U){return!R||!U?!1:l(R).toRgbString()==l(U).toRgbString()},l.random=function(){return l.fromRatio({r:a(),g:a(),b:a()})};function y(R,U){U=U===0?0:U||10;var P=l(R).toHsl();return P.s-=U/100,P.s=ie(P.s),l(P)}function b(R,U){U=U===0?0:U||10;var P=l(R).toHsl();return P.s+=U/100,P.s=ie(P.s),l(P)}function v(R){return l(R).desaturate(100)}function C(R,U){U=U===0?0:U||10;var P=l(R).toHsl();return P.l+=U/100,P.l=ie(P.l),l(P)}function S(R,U){U=U===0?0:U||10;var P=l(R).toRgb();return P.r=i(0,s(255,P.r-o(255*-(U/100)))),P.g=i(0,s(255,P.g-o(255*-(U/100)))),P.b=i(0,s(255,P.b-o(255*-(U/100)))),l(P)}function k(R,U){U=U===0?0:U||10;var P=l(R).toHsl();return P.l-=U/100,P.l=ie(P.l),l(P)}function I(R,U){var P=l(R).toHsl(),se=(P.h+U)%360;return P.h=se<0?360+se:se,l(P)}function A(R){var U=l(R).toHsl();return U.h=(U.h+180)%360,l(U)}function $(R){var U=l(R).toHsl(),P=U.h;return[l(R),l({h:(P+120)%360,s:U.s,l:U.l}),l({h:(P+240)%360,s:U.s,l:U.l})]}function O(R){var U=l(R).toHsl(),P=U.h;return[l(R),l({h:(P+90)%360,s:U.s,l:U.l}),l({h:(P+180)%360,s:U.s,l:U.l}),l({h:(P+270)%360,s:U.s,l:U.l})]}function j(R){var U=l(R).toHsl(),P=U.h;return[l(R),l({h:(P+72)%360,s:U.s,l:U.l}),l({h:(P+216)%360,s:U.s,l:U.l})]}function H(R,U,P){U=U||6,P=P||30;var se=l(R).toHsl(),pe=360/P,fe=[l(R)];for(se.h=(se.h-(pe*U>>1)+720)%360;--U;)se.h=(se.h+pe)%360,fe.push(l(se));return fe}function Y(R,U){U=U||6;for(var P=l(R).toHsv(),se=P.h,pe=P.s,fe=P.v,Pe=[],Be=1/U;U--;)Pe.push(l({h:se,s:pe,v:fe})),fe=(fe+Be)%1;return Pe}l.mix=function(R,U,P){P=P===0?0:P||50;var se=l(R).toRgb(),pe=l(U).toRgb(),fe=P/100,Pe={r:(pe.r-se.r)*fe+se.r,g:(pe.g-se.g)*fe+se.g,b:(pe.b-se.b)*fe+se.b,a:(pe.a-se.a)*fe+se.a};return l(Pe)},l.readability=function(R,U){var P=l(R),se=l(U);return(t.max(P.getLuminance(),se.getLuminance())+.05)/(t.min(P.getLuminance(),se.getLuminance())+.05)},l.isReadable=function(R,U,P){var se=l.readability(R,U),pe,fe;switch(fe=!1,pe=We(P),pe.level+pe.size){case"AAsmall":case"AAAlarge":fe=se>=4.5;break;case"AAlarge":fe=se>=3;break;case"AAAsmall":fe=se>=7;break}return fe},l.mostReadable=function(R,U,P){var se=null,pe=0,fe,Pe,Be,Ge;P=P||{},Pe=P.includeFallbackColors,Be=P.level,Ge=P.size;for(var $t=0;$t<U.length;$t++)fe=l.readability(R,U[$t]),fe>pe&&(pe=fe,se=l(U[$t]));return l.isReadable(R,se,{level:Be,size:Ge})||!Pe?se:(P.includeFallbackColors=!1,l.mostReadable(R,["#fff","#000"],P))};var B=l.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},K=l.hexNames=X(B);function X(R){var U={};for(var P in R)R.hasOwnProperty(P)&&(U[R[P]]=P);return U}function Z(R){return R=parseFloat(R),(isNaN(R)||R<0||R>1)&&(R=1),R}function Q(R,U){ue(R)&&(R="100%");var P=ne(R);return R=s(U,i(0,parseFloat(R))),P&&(R=parseInt(R*U,10)/100),t.abs(R-U)<1e-6?1:R%U/parseFloat(U)}function ie(R){return s(1,i(0,R))}function re(R){return parseInt(R,16)}function ue(R){return typeof R=="string"&&R.indexOf(".")!=-1&&parseFloat(R)===1}function ne(R){return typeof R=="string"&&R.indexOf("%")!=-1}function le(R){return R.length==1?"0"+R:""+R}function ae(R){return R<=1&&(R=R*100+"%"),R}function me(R){return t.round(parseFloat(R)*255).toString(16)}function be(R){return re(R)/255}var we=function(){var R="[-\\+]?\\d+%?",U="[-\\+]?\\d*\\.\\d+%?",P="(?:"+U+")|(?:"+R+")",se="[\\s|\\(]+("+P+")[,|\\s]+("+P+")[,|\\s]+("+P+")\\s*\\)?",pe="[\\s|\\(]+("+P+")[,|\\s]+("+P+")[,|\\s]+("+P+")[,|\\s]+("+P+")\\s*\\)?";return{CSS_UNIT:new RegExp(P),rgb:new RegExp("rgb"+se),rgba:new RegExp("rgba"+pe),hsl:new RegExp("hsl"+se),hsla:new RegExp("hsla"+pe),hsv:new RegExp("hsv"+se),hsva:new RegExp("hsva"+pe),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();function ke(R){return!!we.CSS_UNIT.exec(R)}function He(R){R=R.replace(e,"").replace(r,"").toLowerCase();var U=!1;if(B[R])R=B[R],U=!0;else if(R=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var P;return(P=we.rgb.exec(R))?{r:P[1],g:P[2],b:P[3]}:(P=we.rgba.exec(R))?{r:P[1],g:P[2],b:P[3],a:P[4]}:(P=we.hsl.exec(R))?{h:P[1],s:P[2],l:P[3]}:(P=we.hsla.exec(R))?{h:P[1],s:P[2],l:P[3],a:P[4]}:(P=we.hsv.exec(R))?{h:P[1],s:P[2],v:P[3]}:(P=we.hsva.exec(R))?{h:P[1],s:P[2],v:P[3],a:P[4]}:(P=we.hex8.exec(R))?{r:re(P[1]),g:re(P[2]),b:re(P[3]),a:be(P[4]),format:U?"name":"hex8"}:(P=we.hex6.exec(R))?{r:re(P[1]),g:re(P[2]),b:re(P[3]),format:U?"name":"hex"}:(P=we.hex4.exec(R))?{r:re(P[1]+""+P[1]),g:re(P[2]+""+P[2]),b:re(P[3]+""+P[3]),a:be(P[4]+""+P[4]),format:U?"name":"hex8"}:(P=we.hex3.exec(R))?{r:re(P[1]+""+P[1]),g:re(P[2]+""+P[2]),b:re(P[3]+""+P[3]),format:U?"name":"hex"}:!1}function We(R){var U,P;return R=R||{level:"AA",size:"small"},U=(R.level||"AA").toUpperCase(),P=(R.size||"small").toLowerCase(),U!=="AA"&&U!=="AAA"&&(U="AA"),P!=="small"&&P!=="large"&&(P="small"),{level:U,size:P}}typeof JN<"u"&&JN.exports?JN.exports=l:typeof define=="function"&&define.amd?define(function(){return l}):window.tinycolor=l})(Math)});var HY=Qe(vF=>{"use strict";var UY=aR();vF.createRoot=UY.createRoot,vF.hydrateRoot=UY.hydrateRoot;var yrr});var kp=class{constructor(e,r){this.backend=e,this.dataMover=r,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,r){this.dataIdsCount++,this.data.set(e,r)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}},ya=class{refCount(e){return wo("refCount")}incRef(e){return wo("incRef")}timerAvailable(){return!0}time(e){return wo("time")}read(e){return wo("read")}readSync(e){return wo("readSync")}readToGPU(e,r){return wo("readToGPU")}numDataIds(){return wo("numDataIds")}disposeData(e,r){return wo("disposeData")}write(e,r,n){return wo("write")}move(e,r,n,o,s){return wo("move")}createTensorFromTexture(e,r,n){return wo("createTensorFromTexture")}memory(){return wo("memory")}floatPrecision(){return wo("floatPrecision")}epsilon(){return this.floatPrecision()===32?1e-7:1e-4}dispose(){return wo("dispose")}};function wo(t){throw new Error(`'${t}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}function _F(t){let e=t.length,r=0;for(;e>0;)r=Math.random()*e|0,e--,Ov(t,e,r)}function bQ(t,e){if(t.length!==e.length)throw new Error(`Array sizes must match to be shuffled together First array length was ${t.length}Second array length was ${e.length}`);let r=t.length,n=0;for(;r>0;)n=Math.random()*r|0,r--,Ov(t,r,n),Ov(e,r,n)}function Ad(t,e,r){return Math.max(t,Math.min(e,r))}function vQ(t){return t%2===0?t:t+1}function Ov(t,e,r){let n=t[e];t[e]=t[r],t[r]=n}function wQ(t){let e=0;for(let r=0;r<t.length;r++)e+=t[r];return e}function CQ(t,e){let r=Math.random();return e*r+(1-r)*t}function SQ(t,e){let r=0;for(let n=0;n<t.length;n++){let o=Number(t[n])-Number(e[n]);r+=o*o}return r}function D(t,e){if(!t)throw new Error(typeof e=="string"?e:e())}function Fv(t,e,r=""){D(xu(t,e),()=>r+` Shapes ${t} and ${e} must match`)}function Np(t){D(t!=null,()=>"The input to the tensor constructor must be a non-null value.")}function gu(t,e=[],r=!1){if(e==null&&(e=[]),Array.isArray(t)||Co(t)&&!r)for(let n=0;n<t.length;++n)gu(t[n],e,r);else e.push(t);return e}function at(t){if(t.length===0)return 1;let e=t[0];for(let r=1;r<t.length;r++)e*=t[r];return e}function kQ(t){return t.length===0}function xu(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function ba(t){return t%1===0}function TQ(t){if(Math.tanh!=null)return Math.tanh(t);if(t===1/0)return 1;if(t===-1/0)return-1;{let e=Math.exp(2*t);return(e-1)/(e+1)}}function NQ(t){let e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]}function IQ(t){let e=new Uint32Array(t);for(let r=0;r<t;++r)e[r]=r;return _F(e),e}function Ip(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function EQ(t,e=o=>0,r,n){return new Promise((o,s)=>{let i=0,a=()=>{if(t()){o();return}i++;let l=e(i);if(r!=null&&i>=r){s();return}n!=null?n(a,l):setTimeout(a,l)};a()})}function _Q(t,e){let r=1,n=-1;for(let s=0;s<t.length;++s)if(t[s]>=0)r*=t[s];else if(t[s]===-1){if(n!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${n} and dim ${s}`);n=s}else if(t[s]<0)throw Error(`Shapes can not be < 0. Found ${t[s]} at dim ${s}`);if(n===-1){if(e>0&&e!==r)throw Error(`Size(${e}) must match the product of shape ${t}`);return t}if(r===0)throw Error(`Cannot infer the missing size in [${t}] when there are 0 elements`);if(e%r!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${r}`);let o=t.slice();return o[n]=e/r,o}function Dr(t,e){let r=e.length;return t=t==null?e.map((n,o)=>o):[].concat(t),D(t.every(n=>n>=-r&&n<r),()=>`All values in axis param must be in range [-${r}, ${r}) but got axis ${t}`),D(t.every(n=>ba(n)),()=>`All values in axis param must be integers but got axis ${t}`),t.map(n=>n<0?r+n:n)}function CI(t,e){let r=[],n=[],o=e!=null&&Array.isArray(e)&&e.length===0,s=e==null||o?null:Dr(e,t).sort(),i=0;for(let a=0;a<t.length;++a){if(s!=null){if(s[i]===a&&t[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${t[a]}' is not 1`);(s[i]==null||s[i]>a)&&t[a]===1&&(r.push(t[a]),n.push(a)),s[i]<=a&&i++}t[a]!==1&&(r.push(t[a]),n.push(a))}return{newShape:r,keptDims:n}}function AQ(t,e){let r=null;if(t==null||t==="float32")r=new Float32Array(e);else if(t==="int32")r=new Int32Array(e);else if(t==="bool")r=new Uint8Array(e);else throw new Error(`Unknown data type ${t}`);return r}function SI(t,e){let r=null;if(t==null||t==="float32")r=new Float32Array(e);else if(t==="int32")r=new Int32Array(e);else if(t==="bool")r=new Uint8Array(e);else if(t==="string")r=new Array(e);else throw new Error(`Unknown data type ${t}`);return r}function kI(t,e){for(let r=0;r<t.length;r++){let n=t[r];if(isNaN(n)||!isFinite(n))throw Error(`A tensor of type ${e} being uploaded contains ${n}.`)}}function TI(t){return t==="bool"||t==="complex64"||t==="float32"||t==="int32"||t==="string"}function DQ(t,e){return!(e==="complex64"||e==="float32"&&t!=="complex64"||e==="int32"&&t!=="float32"&&t!=="complex64"||e==="bool"&&t==="bool")}function Co(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray}function Pv(t){if(t==="float32"||t==="int32")return 4;if(t==="complex64")return 8;if(t==="bool")return 1;throw new Error(`Unknown dtype ${t}`)}function NI(t){if(t==null)return 0;let e=0;return t.forEach(r=>e+=r.length),e}function Dd(t){return typeof t=="string"||t instanceof String}function AF(t){return typeof t=="boolean"}function DF(t){return typeof t=="number"}function $d(t){return Array.isArray(t)?$d(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray?"int32":DF(t)?"float32":Dd(t)?"string":AF(t)?"bool":"float32"}function Rd(t){return!!(t&&t.constructor&&t.call&&t.apply)}function Od(t,e){for(let r=e;r<t;++r)if(t%r===0)return r;return t}function Ri(t){let e=t.length;if(e<2)return[];let r=new Array(e-1);r[e-2]=t[e-1];for(let n=e-3;n>=0;--n)r[n]=r[n+1]*t[n+1];return r}function $F(t,e,r,n=!1){let o=new Array;if(e.length===1){let s=e[0]*(n?2:1);for(let i=0;i<s;i++)o[i]=r[t+i]}else{let s=e[0],i=e.slice(1),a=i.reduce((l,u)=>l*u)*(n?2:1);for(let l=0;l<s;l++)o[l]=$F(t+l*a,i,r,n)}return o}function Tp(t,e,r=!1){if(t.length===0)return e[0];let n=t.reduce((o,s)=>o*s)*(r?2:1);if(n===0)return[];if(n!==e.length)throw new Error(`[${t}] does not match the input size ${e.length}${r?" for a complex tensor":""}.`);return $F(0,t,e,r)}function fx(t,e){let r=Fd(t,e);for(let n=0;n<r.length;n++)r[n]=1;return r}function Fd(t,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool")return new Uint8Array(t);throw new Error(`Unknown data type ${e}`)}function $Q(t,e){let r=t.reduce((n,o)=>n*o,1);if(e==null||e==="float32")return Tp(t,new Float32Array(r));if(e==="int32")return Tp(t,new Int32Array(r));if(e==="bool")return Tp(t,new Uint8Array(r));throw new Error(`Unknown data type ${e}`)}function tn(t){t.forEach(e=>{D(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${t}].`)})}function RQ(t,e,r){if(e===0)return 0;if(e===1)return t[0];let n=t[t.length-1];for(let o=0;o<t.length-1;++o)n+=r[o]*t[o];return n}function OQ(t,e,r){if(e===0)return[];if(e===1)return[t];let n=new Array(e);for(let o=0;o<n.length-1;++o)n[o]=Math.floor(t/r[o]),t-=n[o]*r[o];return n[n.length-1]=t,n}function dx(t){return t&&t.then&&typeof t.then=="function"}var RF="tfjsflags",mx=class{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=PQ,this.populateURLFlags()}setPlatform(e,r){this.platform!=null&&(W().getBool("IS_TEST")||W().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=r}registerFlag(e,r,n){if(this.flagRegistry[e]={evaluationFn:r,setHook:n},this.urlFlags[e]!=null){let o=this.urlFlags[e];W().getBool("IS_TEST")||W().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${o}.`),this.set(e,o)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];let r=this.evaluateFlag(e);if(dx(r))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=r,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,r){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=r,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(r)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;let e=this.getQueryParams(this.global.location.search);RF in e&&e[RF].split(",").forEach(n=>{let[o,s]=n.split(":");this.urlFlags[o]=MQ(o,s)})}};function PQ(t){let e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(r,...n)=>(LQ(e,n[0],n[1]),n.join("="))),e}function LQ(t,e,r){t[decodeURIComponent(e)]=decodeURIComponent(r||"")}function MQ(t,e){if(e=e.toLowerCase(),e==="true"||e==="false")return e==="true";if(`${+e}`===e)return+e;throw new Error(`Could not parse value flag value ${e} for flag ${t}.`)}function W(){return II}var II=null;function OF(t){II=t}var EI;function _I(){if(EI==null){let t;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else if(typeof self<"u")t=self;else throw new Error("Could not find a global object");EI=t}return EI}function zQ(){let t=_I();return t._tfGlobals==null&&(t._tfGlobals=new Map),t._tfGlobals}function hx(t,e){let r=zQ();if(r.has(t))return r.get(t);{let n=e();return r.set(t,n),r.get(t)}}var yu="Abs",va="Acos",wa="Acosh",ri="Add",Pd="AddN",Ld="All",Md="Any",bu="ArgMax",vu="ArgMin",Ca="Asin",Sa="Asinh",ka="Atan",Ta="Atanh",Na="Atan2",wu="AvgPool",zd="AvgPoolGrad",Cu="AvgPool3D",Bd="AvgPool3DGrad",Su="BatchMatMul",ku="BatchToSpaceND",Vd="Bincount",FF="BroadcastTo",Lv="BroadcastArgs",Oi="Cast",Ia="Ceil",Ea="ClipByValue",Wd="Complex",Tu="ComplexAbs",Nu="Concat",Iu="Conv2D",Gd="Conv2DBackpropFilter",Eu="Conv2DBackpropInput",_u="Conv3D",Ud="Conv3DBackpropFilterV2",Hd="Conv3DBackpropInputV2",_a="Cos",Aa="Cosh",qd="Cumprod",Au="Cumsum",jd="CropAndResize",Kd="DenseBincount",Xd="DepthToSpace",Du="DepthwiseConv2dNative",Yd="DepthwiseConv2dNativeBackpropFilter",Qd="DepthwiseConv2dNativeBackpropInput",Mv="Diag",$u="Dilation2D",gx="Dilation2DBackpropInput",xx="Dilation2DBackpropFilter",Da="RealDiv",Zd="Einsum",$a="Elu",Jd="EluGrad",Ra="Erf",Ep="Equal",Oa="Exp",Ru="ExpandDims",Fa="Expm1",em="FFT",tm="Fill",rm="FlipLeftRight",Pa="Floor",La="FloorDiv",Ou="FusedBatchNorm",Fu="GatherV2",zv="GatherNd",_p="Greater",Ma="GreaterEqual",Fi="Identity",nm="IFFT",om="Imag",za="IsFinite",Ba="IsInf",Va="IsNan",Pu="LeakyRelu",Ap="Less",Dp="LessEqual",Bv="LinSpace",Wa="Log",Ga="Log1p",$p="LogicalAnd",Rp="LogicalNot",Op="LogicalOr";var PF="LogSoftmax";var Lu="LRN",sm="LRNGrad",Mu="Max",Ua="Maximum",zu="MaxPool",im="MaxPoolGrad",Bu="MaxPool3D",am="MaxPool3DGrad",Vv="MaxPoolWithArgmax",Vu="Mean",Wu="Min",Ha="Minimum",Gu="MirrorPad",qa="Mod",Wv="Multinomial",ja="Multiply",Uu="Neg",Fp="NotEqual",lm="NonMaxSuppressionV3",um="NonMaxSuppressionV4",cm="NonMaxSuppressionV5",Hu="OnesLike",qu="OneHot",ju="Pack",Ku="PadV2";var Ka="Pow",Xu="Prelu",Yu="Prod",Gv="RaggedGather",Uv="RaggedRange",Hv="RaggedTensorToTensor",pm="Range",fm="Real",Xa="Reciprocal",Ya="Relu",Qu="Reshape",Zu="ResizeNearestNeighbor",dm="ResizeNearestNeighborGrad",Ju="ResizeBilinear",mm="ResizeBilinearGrad",Qa="Relu6",ec="Reverse",Za="Round",Ja="Rsqrt",qv="ScatterNd",jv="SearchSorted",tc="Select",el="Selu",rc="Slice",tl="Sin",rl="Sinh",nl="Sign",ol="Sigmoid",sl="Softplus",il="Sqrt",nc="Sum",oc="SpaceToBatchND",sc="SplitV",ic="Softmax",Kv="SparseFillEmptyRows",Xv="SparseReshape",Yv="SparseSegmentMean",Qv="SparseSegmentSum",Zv="SparseToDense",al="SquaredDifference",hm="Square",gm="StridedSlice",Jv="StringNGrams",e1="StringSplit",t1="StringToHashBucketFast",ll="Sub",ul="Tan",cl="Tanh",Pi="Tile",xm="TopK",ym="Transform",Li="Transpose",bm="Unique",ac="Unpack",lc="UnsortedSegmentSum";var uc="ZerosLike",pl="Step",yx="FromPixels",vm="RotateWithOffset",Pp="_FusedMatMul",Lp="FusedConv2D",Mp="FusedDepthwiseConv2D";function Mi(...t){W().getBool("IS_TEST")||W().getBool("PROD")||console.warn(...t)}function BQ(...t){W().getBool("IS_TEST")||W().getBool("PROD")||console.log(...t)}var r1=hx("kernelRegistry",()=>new Map),AI=hx("gradRegistry",()=>new Map);function bx(t,e){let r=zF(t,e);return r1.get(r)}function DI(t){return AI.get(t)}function $I(t){let e=r1.entries(),r=[];for(;;){let{done:n,value:o}=e.next();if(n)break;let[s,i]=o,[a]=s.split("_");a===t&&r.push(i)}return r}function n1(t){let{kernelName:e,backendName:r}=t,n=zF(e,r);r1.has(n)&&Mi(`The kernel '${e}' for backend '${r}' is already registered`),r1.set(n,t)}function MF(t){let{kernelName:e}=t;AI.has(e)&&W().getBool("DEBUG")&&Mi(`Overriding the gradient for '${e}'`),AI.set(e,t)}function zF(t,e){return`${e}_${t}`}var w={};qo(w,{arraysEqual:()=>xu,assert:()=>D,assertNonNegativeIntegerDimensions:()=>tn,assertNonNull:()=>Np,assertShapesMatch:()=>Fv,bytesFromStringArray:()=>NI,bytesPerElement:()=>Pv,checkConversionForErrors:()=>kI,clamp:()=>Ad,computeStrides:()=>Ri,createScalarValue:()=>jQ,createShuffledIndices:()=>IQ,decodeString:()=>Tm,distSquared:()=>SQ,encodeString:()=>km,fetch:()=>XQ,fingerPrint64:()=>qQ,flatten:()=>gu,getArrayFromDType:()=>SI,getTypedArrayFromDType:()=>AQ,hasEncodingLoss:()=>DQ,hexToLong:()=>vx,indexToLoc:()=>OQ,inferDtype:()=>$d,inferFromImplicitShape:()=>_Q,isBoolean:()=>AF,isFunction:()=>Rd,isInt:()=>ba,isNumber:()=>DF,isPromise:()=>dx,isScalarShape:()=>kQ,isString:()=>Dd,isTypedArray:()=>Co,isValidDtype:()=>TI,locToIndex:()=>RQ,makeOnesTypedArray:()=>fx,makeZerosNestedTypedArray:()=>$Q,makeZerosTypedArray:()=>Fd,nearestDivisor:()=>Od,nearestLargerEven:()=>vQ,now:()=>Gp,parseAxisParam:()=>Dr,randUniform:()=>CQ,repeatedTry:()=>EQ,rightPad:()=>Ip,shuffle:()=>_F,shuffleCombo:()=>bQ,sizeFromShape:()=>at,sizeToSquarishShape:()=>NQ,squeezeShape:()=>CI,sum:()=>wQ,swap:()=>Ov,tanh:()=>TQ,toNestedArray:()=>Tp,toTypedArray:()=>Sm});var PI=nt(YF());var Wp=PI.default||PI;function vx(t){return Wp.fromString(t,!0,16)}var ZF=vx("c3a5c85c97cb3127"),Vp=vx("b492b66fbe98f273"),Gn=vx("9ae16a3b2f90404f");function FI(t){return t.xor(t.shru(47))}function JF(t,e,r){let n=t.slice(e,e+r);return Wp.fromBytes(Array.from(n),!0,!0)}function jt(t,e){return JF(t,e,8)}function QF(t,e){return JF(t,e,4)}function rn(t,e){return e===0?t:t.shru(e).or(t.shl(64-e))}function cc(t,e,r=vx("9ddfea08eb382d69")){let n=t.xor(e).mul(r);n=n.xor(n.shru(47));let o=e.xor(n).mul(r);return o=o.xor(o.shru(47)),o=o.mul(r),o}function WQ(t,e,r,n,o,s){o=o.add(t),s=rn(s.add(o).add(n),21);let i=o;return o=o.add(e),o=o.add(r),s=s.add(rn(o,44)),[o.add(n),s.add(i)]}function s1(t,e,r,n){return WQ(jt(t,e),jt(t,e+8),jt(t,e+16),jt(t,e+24),r,n)}function GQ(t,e=t.length){if(e>=8){let r=Gn.add(e*2),n=jt(t,0).add(Gn),o=jt(t,e-8),s=rn(o,37).mul(r).add(n),i=rn(n,25).add(o).mul(r);return cc(s,i,r)}if(e>=4){let r=Gn.add(e*2),n=QF(t,0);return cc(n.shl(3).add(e),QF(t,e-4),r)}if(e>0){let r=t[0],n=t[e>>1],o=t[e-1],s=r+(n<<8),i=e+(o<<2);return FI(Gn.mul(s).xor(ZF.mul(i))).mul(Gn)}return Gn}function UQ(t,e=t.length){let r=Gn.add(e*2),n=jt(t,0).mul(Vp),o=jt(t,8),s=jt(t,e-8).mul(r),i=jt(t,e-16).mul(Gn);return cc(rn(n.add(o),43).add(rn(s,30)).add(i),n.add(rn(o.add(Gn),18)).add(s),r)}function HQ(t,e=t.length){let r=Gn.add(e*2),n=jt(t,0).mul(Gn),o=jt(t,8),s=jt(t,e-8).mul(r),i=jt(t,e-16).mul(Gn),a=rn(n.add(o),43).add(rn(s,30)).add(i),l=cc(a,n.add(rn(o.add(Gn),18)).add(s),r),u=jt(t,16).mul(r),c=jt(t,24),p=a.add(jt(t,e-32)).mul(r),f=l.add(jt(t,e-24)).mul(r);return cc(rn(u.add(c),43).add(rn(p,30)).add(f),u.add(rn(c.add(n),18)).add(p),r)}function qQ(t,e=t.length){let r=Wp.fromNumber(81,!0);if(e<=32)return e<=16?GQ(t,e):UQ(t,e);if(e<=64)return HQ(t,e);let n=r,o=r.mul(Vp).add(113),s=FI(o.mul(Gn).add(113)).mul(Gn),i=[Wp.UZERO,Wp.UZERO],a=[Wp.UZERO,Wp.UZERO];n=n.mul(Gn).add(jt(t,0));let l=0,u=(e-1>>6)*64,c=u+(e-1&63)-63;do n=rn(n.add(o).add(i[0]).add(jt(t,l+8)),37).mul(Vp),o=rn(o.add(i[1]).add(jt(t,l+48)),42).mul(Vp),n=n.xor(a[1]),o=o.add(i[0]).add(jt(t,l+40)),s=rn(s.add(a[0]),33).mul(Vp),i=s1(t,l,i[1].mul(Vp),n.add(a[0])),a=s1(t,l+32,s.add(a[1]),o.add(jt(t,l+16))),[s,n]=[n,s],l+=64;while(l!==u);let p=Vp.add(s.and(255).shl(1));return l=c,a[0]=a[0].add(e-1&63),i[0]=i[0].add(a[0]),a[0]=a[0].add(i[0]),n=rn(n.add(o).add(i[0]).add(jt(t,l+8)),37).mul(p),o=rn(o.add(i[1]).add(jt(t,l+48)),42).mul(p),n=n.xor(a[1].mul(9)),o=o.add(i[0].mul(9).add(jt(t,l+40))),s=rn(s.add(a[0]),33).mul(p),i=s1(t,l,i[1].mul(p),n.add(a[0])),a=s1(t,l+32,s.add(a[1]),o.add(jt(t,l+16))),[s,n]=[n,s],cc(cc(i[0],a[0],p).add(FI(o).mul(ZF)).add(s),cc(i[1],a[1],p).add(n),p)}function jQ(t,e){return e==="string"?km(t):Sm([t],e)}function KQ(t,e){return t instanceof Float32Array&&e==="float32"||t instanceof Int32Array&&e==="int32"||t instanceof Uint8Array&&e==="bool"}function Sm(t,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=gu(t)),W().getBool("DEBUG")&&kI(t,e),KQ(t,e))return t;if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool"){let r=new Uint8Array(t.length);for(let n=0;n<r.length;++n)Math.round(t[n])!==0&&(r[n]=1);return r}else throw new Error(`Unknown data type ${e}`)}function Gp(){return W().platform.now()}function XQ(t,e){return W().platform.fetch(t,e)}function km(t,e="utf-8"){return e=e||"utf-8",W().platform.encode(t,e)}function Tm(t,e="utf-8"){return e=e||"utf-8",W().platform.decode(t,e)}var i1=class{constructor(e,r){this.backendTimer=e,this.logger=r,r==null&&(this.logger=new LI)}profileKernel(e,r,n){let o,s=()=>{o=n()},i,a=Gp();if(this.backendTimer.timerAvailable())i=this.backendTimer.time(s);else{s();for(let u of o)u.dataSync();i=Promise.resolve({kernelMs:Gp()-a})}if(W().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let u=0;u<o.length;u++){let c=o[u];c.data().then(p=>{YQ(p,c.dtype,e)})}return{kernelName:e,outputs:o,inputs:r,timeMs:i.then(u=>u.kernelMs),extraInfo:i.then(u=>u.getExtraProfileInfo!=null?u.getExtraProfileInfo():"")}}logKernelProfile(e){let{kernelName:r,outputs:n,timeMs:o,inputs:s,extraInfo:i}=e;n.forEach(a=>{Promise.all([a.data(),o,i]).then(l=>{this.logger.logKernelProfile(r,a,l[0],l[1],s,l[2])})})}};function YQ(t,e,r){if(e!=="float32")return!1;for(let n=0;n<t.length;n++){let o=t[n];if(isNaN(o)||!isFinite(o))return console.warn(`Found ${o} in the result of '${r}'`),!0}return!1}var LI=class{logKernelProfile(e,r,n,o,s,i){let a=typeof o=="number"?Ip(`${o}ms`,9):o.error,l=Ip(e,25),u=r.rank,c=r.size,p=Ip(r.shape.toString(),14),f="";for(let d in s){let m=s[d];if(m!=null){let h=m.shape||r.shape,x=h.length;f+=`${d}: ${x}D ${x>0?h:""} `}}console.log(`%c${l}	%c${a}	%c${u}D ${p}	%c${c}	%c${f}	%c${i}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}};function eP(t,e,r){let n={},o={};for(let l=0;l<e.length;l++)n[e[l].id]=!0;for(let l=0;l<t.length;l++){let u=t[l],c=u.inputs;for(let p in c){let f=c[p],d=!1;for(let m=0;m<e.length;m++)if(n[f.id]){u.outputs.forEach(h=>n[h.id]=!0),d=!0,o[u.id]=!0;break}if(d)break}}let s={};s[r.id]=!0;let i={};for(let l=t.length-1;l>=0;l--){let u=t[l],c=u.inputs;for(let p=0;p<u.outputs.length;p++)if(s[u.outputs[p].id]){for(let f in c)s[c[f].id]=!0,i[u.id]=!0;break}}let a=[];for(let l=0;l<t.length;l++){let u=t[l];if(o[u.id]&&i[u.id]){let c={};for(let f in u.inputs){let d=u.inputs[f];n[d.id]&&(c[f]=d)}let p=Object.assign({},u);p.inputs=c,p.outputs=u.outputs,a.push(p)}}return a}function tP(t,e,r,n){for(let o=e.length-1;o>=0;o--){let s=e[o],i=[];if(s.outputs.forEach(l=>{let u=t[l.id];u!=null?i.push(u):i.push(null)}),s.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${s.kernelName}.`);let a=s.gradient(i);for(let l in s.inputs){if(!(l in a))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(a)}.`);let u=r(()=>a[l]());if(u.dtype!=="float32")throw new Error(`Error in gradient for op ${s.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${u.dtype}'`);let c=s.inputs[l];if(!xu(u.shape,c.shape))throw new Error(`Error in gradient for op ${s.kernelName}. The gradient of input '${l}' has shape '${u.shape}', which does not match the shape of the input '${c.shape}'`);if(t[c.id]==null)t[c.id]=u;else{let p=t[c.id];t[c.id]=n(p,u),p.dispose()}}}}var rP=20,wx=3,MI=7;function nP(t,e,r,n){let o=Ri(e),s=QQ(t,e,r,o),i=e.length,a=a1(t,e,r,o,s),l=["Tensor"];return n&&(l.push(`  dtype: ${r}`),l.push(`  rank: ${i}`),l.push(`  shape: [${e}]`),l.push("  values:")),l.push(a.map(u=>"    "+u).join(`
`)),l.join(`
`)}function QQ(t,e,r,n){let o=at(e),s=n[n.length-1],i=new Array(s).fill(0),a=e.length,l=r==="complex64"?Sx(t):t;if(a>1)for(let u=0;u<o/s;u++){let c=u*s;for(let p=0;p<s;p++)i[p]=Math.max(i[p],Cx(l[c+p],0,r).length)}return i}function Cx(t,e,r){let n;return Array.isArray(t)?n=`${parseFloat(t[0].toFixed(MI))} + ${parseFloat(t[1].toFixed(MI))}j`:Dd(t)?n=`'${t}'`:r==="bool"?n=oP(t):n=parseFloat(t.toFixed(MI)).toString(),Ip(n,e)}function oP(t){return t===0?"false":"true"}function a1(t,e,r,n,o,s=!0){let i=r==="complex64"?2:1,a=e[0],l=e.length;if(l===0){if(r==="complex64"){let h=Sx(t);return[Cx(h[0],0,r)]}return r==="bool"?[oP(t[0])]:[t[0].toString()]}if(l===1){if(a>rP){let x=wx*i,g=Array.from(t.slice(0,x)),y=Array.from(t.slice((a-wx)*i,a*i));return r==="complex64"&&(g=Sx(g),y=Sx(y)),["["+g.map((b,v)=>Cx(b,o[v],r)).join(", ")+", ..., "+y.map((b,v)=>Cx(b,o[a-wx+v],r)).join(", ")+"]"]}return["["+(r==="complex64"?Sx(t):Array.from(t)).map((x,g)=>Cx(x,o[g],r)).join(", ")+"]"]}let u=e.slice(1),c=n.slice(1),p=n[0]*i,f=[];if(a>rP){for(let h=0;h<wx;h++){let x=h*p,g=x+p;f.push(...a1(t.slice(x,g),u,r,c,o,!1))}f.push("...");for(let h=a-wx;h<a;h++){let x=h*p,g=x+p;f.push(...a1(t.slice(x,g),u,r,c,o,h===a-1))}}else for(let h=0;h<a;h++){let x=h*p,g=x+p;f.push(...a1(t.slice(x,g),u,r,c,o,h===a-1))}let d=l===2?",":"";f[0]="["+f[0]+d;for(let h=1;h<f.length-1;h++)f[h]=" "+f[h]+d;let m=`,
`;for(let h=2;h<l;h++)m+=`
`;return f[f.length-1]=" "+f[f.length-1]+"]"+(s?"":m),f}function Sx(t){let e=[];for(let r=0;r<t.length;r+=2)e.push([t[r],t[r+1]]);return e}var bt=class{constructor(e,r,n){if(this.dtype=r,this.shape=e.slice(),this.size=at(e),n!=null){let o=n.length;D(o===this.size,()=>`Length of values '${o}' does not match the size inferred by the shape '${this.size}'.`)}if(r==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||SI(r,this.size),this.strides=Ri(e)}set(e,...r){r.length===0&&(r=[0]),D(r.length===this.rank,()=>`The number of provided coordinates (${r.length}) must match the rank (${this.rank})`);let n=this.locToIndex(r);this.values[n]=e}get(...e){e.length===0&&(e=[0]);let r=0;for(let o of e){if(o<0||o>=this.shape[r]){let s=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(s)}r++}let n=e[e.length-1];for(let o=0;o<e.length-1;++o)n+=this.strides[o]*e[o];return this.values[n]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let r=e[e.length-1];for(let n=0;n<e.length-1;++n)r+=this.strides[n]*e[n];return r}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];let r=new Array(this.shape.length);for(let n=0;n<r.length-1;++n)r[n]=Math.floor(e/this.strides[n]),e-=r[n]*this.strides[n];return r[r.length-1]=e,r}get rank(){return this.shape.length}toTensor(){return oi().makeTensor(this.values,this.shape,this.dtype)}},oi=null,Nm=null,ZQ=null;function sP(t){oi=t}function iP(t){Nm=t}function aP(t){ZQ=t}var Je=class{constructor(e,r,n,o){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=r||"float32",this.size=at(e),this.strides=Ri(e),this.dataId=n,this.id=o,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){let e=await this.data();return Nm.buffer(this.shape,this.dtype,e)}bufferSync(){return Nm.buffer(this.shape,this.dtype,this.dataSync())}async array(){let e=await this.data();return Tp(this.shape,e,this.dtype==="complex64")}arraySync(){return Tp(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();let e=oi().read(this.dataId);if(this.dtype==="string"){let r=await e;try{return r.map(n=>Tm(n))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),oi().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();let e=oi().readSync(this.dataId);if(this.dtype==="string")try{return e.map(r=>Tm(r))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();let e=await oi().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(oi().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return Nm.print(this,e)}clone(){return this.throwIfDisposed(),Nm.clone(this)}toString(e=!1){let r=this.dataSync();return nP(r,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),Nm.cast(this,e)}variable(e=!0,r,n){return this.throwIfDisposed(),oi().makeVariable(this,e,r,n)}};Object.defineProperty(Je,Symbol.hasInstance,{value:t=>!!t&&t.data!=null&&t.dataSync!=null&&t.throwIfDisposed!=null});function F(){return hx("Tensor",()=>Je)}F();var fl=class extends Je{constructor(e,r,n,o){super(e.shape,e.dtype,e.dataId,o),this.trainable=r,this.name=n}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!xu(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);oi().disposeTensor(this),this.dataId=e.dataId,oi().incRef(this,null)}dispose(){oi().disposeVariable(this),this.isDisposedInternal=!0}};Object.defineProperty(fl,Symbol.hasInstance,{value:t=>t instanceof Je&&t.assign!=null&&t.assign instanceof Function});var xs={};qo(xs,{assertTypesMatch:()=>eZ,getTensorsInContainer:()=>kx,isTensorInList:()=>tZ,makeTypesMatch:()=>Ye});var zI;(function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"})(zI||(zI={}));var BI;(function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"})(BI||(BI={}));var VI;(function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"})(VI||(VI={}));var WI;(function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"})(WI||(WI={}));var GI;(function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"})(GI||(GI={}));var JQ={float32:WI,int32:BI,bool:VI,complex64:GI};function wr(t,e){if(t==="string"||e==="string"){if(t==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${t} with ${e}`)}return JQ[t][e]}function Up(t){return wr(t,"int32")}function Ye(t,e){if(t.dtype===e.dtype)return[t,e];let r=wr(t.dtype,e.dtype);return[t.cast(r),e.cast(r)]}function eZ(t,e){D(t.dtype===e.dtype,()=>`The dtypes of the first(${t.dtype}) and second(${e.dtype}) input must match`)}function tZ(t,e){return e.some(r=>r.id===t.id)}function kx(t){let e=[];return lP(t,e,new Set),e}function lP(t,e,r){if(t==null)return;if(t instanceof Je){e.push(t);return}if(!rZ(t))return;let n=t;for(let o in n){let s=n[o];r.has(s)||(r.add(s),lP(s,e,r))}}function rZ(t){return Array.isArray(t)||typeof t=="object"}function UI(t){return t.kernelName!=null}var l1=class{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(let e in this.registeredVariables)this.registeredVariables[e].dispose()}},pc=class{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new l1}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;let e=this.getSortedBackends();for(let r=0;r<e.length;r++){let n=e[r];if(await this.initializeBackend(n).success){await this.setBackend(n);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){let{name:e,asyncInit:r}=this.initializeBackendsAndReturnBest();if(r)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){let{asyncInit:r}=this.initializeBackend(e);if(r)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,r,n=1){return e in this.registryFactory?(Mi(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:r,priority:n},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;let{success:r,asyncInit:n}=this.initializeBackend(e);if(!(n?await r:r))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new i1(this.backendInstance),!0}setupRegisteredKernels(){$I(this.backendName).forEach(r=>{r.setupFunc!=null&&r.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){$I(e).forEach(n=>{n.disposeFunc!=null&&n.disposeFunc(this.registry[e])})}initializeBackend(e){let r=this.registryFactory[e];if(r==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{let n=r.factory();if(n&&!(n instanceof ya)&&typeof n.then=="function"){let o=++this.pendingBackendInitId,s=n.then(i=>o<this.pendingBackendInitId?!1:(this.registry[e]=i,this.pendingBackendInit=null,!0)).catch(i=>(o<this.pendingBackendInitId||(this.pendingBackendInit=null,Mi(`Initialization of backend ${e} failed`),Mi(i.stack||i.message)),!1));return this.pendingBackendInit=s,{success:s,asyncInit:!0}}else return this.registry[e]=n,{success:!0,asyncInit:!1}}catch(n){return Mi(`Initialization of backend ${e} failed`),Mi(n.stack||n.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,r)=>this.registryFactory[r].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){let e=this.getSortedBackends();for(let r=0;r<e.length;r++){let n=e[r],{success:o,asyncInit:s}=this.initializeBackend(n);if(s||o)return{name:n,asyncInit:s}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,r){let n=this.state.tensorInfo.get(r),o=n.backend,s=this.readSync(r),i=o.refCount(r);o.disposeData(r,!0),n.backend=e,e.move(r,s,n.shape,n.dtype,i),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,r){let n=null;if(r==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");r=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof r!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");n=e}let o;return this.scopedRun(()=>this.startScope(n),()=>this.endScope(o),()=>(o=r(),o instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),o))}scopedRun(e,r,n){e();try{let o=n();return r(),o}catch(o){throw r(),o}}nextTensorId(){return pc.nextTensorId++}nextVariableId(){return pc.nextVariableId++}clone(e){let r=E.runKernel(Fi,{x:e}),n={x:e},o=i=>({x:()=>{let a="float32",l={x:i},u={dtype:a};return E.runKernel(Oi,l,u)}}),s=[];return this.addTapeNode(this.state.activeScope.name,n,[r],o,s,{}),r}runKernel(e,r,n){if(this.backendName==null&&this.backend,!(bx(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:r,attrs:n})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,r,n){let o=this.backend.numDataIds(),s=0;n.forEach(l=>{s+=l.dtype==="complex64"?3:1});let i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=o-r-s-i;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${e}'`)}runKernelFunc(e){let r,n=[],o=this.isTapeOn(),s=this.state.numBytes,i=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let l,u=UI(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(UI(e)){let{kernelName:m,inputs:h,attrs:x}=e;this.backendName==null&&this.backend;let g=bx(m,this.backendName);D(g!=null,()=>`Cannot find registered kernel '${m}' for backend '${this.backendName}'`),a=()=>{let y=this.backend.numDataIds();l=g.kernelFunc({inputs:h,attrs:x,backend:this.backend});let b=Array.isArray(l)?l:[l];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(m,y,b);let v=b.map(C=>C.rank!=null?C:this.makeTensorFromTensorInfo(C));if(o){let C=this.getTensorsForGradient(m,h,v);n=this.saveTensorsForBackwardMode(C)}return v}}else{let{forwardFunc:m}=e,h=x=>{!o||(n=x.map(g=>this.keep(this.clone(g))))};a=()=>{let x=this.backend.numDataIds();l=this.tidy(()=>m(this.backend,h));let g=Array.isArray(l)?l:[l];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(u,x,g),g}}let{inputs:c,attrs:p}=e,f=UI(e)?null:e.backwardsFunc,d;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?r=a():(d=this.profiler.profileKernel(u,c,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(d),r=d.outputs)}),o&&this.addTapeNode(u,c,r,f,n,p),this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-s,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-i,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(c).map(m=>c[m]!=null?c[m].shape:null),outputShapes:r.map(m=>m.shape),kernelTimeMs:d.timeMs,extraInfo:d.extraInfo}),Array.isArray(l)?r:r[0]}saveTensorsForBackwardMode(e){return e.map(n=>this.keep(this.clone(n)))}getTensorsForGradient(e,r,n){let o=DI(e);if(o!=null){let s=o.inputsToSave||[],i=o.outputsToSave||[],a;o.saveAllInputs?(D(Array.isArray(r),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(r).map(u=>r[u])):a=s.map(u=>r[u]);let l=n.filter((u,c)=>i[c]);return a.concat(l)}return[]}makeTensor(e,r,n,o){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",o=o||this.backend;let s=e;n==="string"&&Dd(e[0])&&(s=e.map(l=>km(l)));let i=o.write(s,r,n),a=new Je(r,n,i,this.nextTensorId());if(this.trackTensor(a,o),n==="string"){let l=this.state.tensorInfo.get(i),u=NI(s);this.state.numBytes+=u-l.bytes,l.bytes=u}return a}makeTensorFromDataId(e,r,n,o){n=n||"float32";let s={dataId:e,shape:r,dtype:n};return this.makeTensorFromTensorInfo(s,o)}makeTensorFromTensorInfo(e,r){let{dataId:n,shape:o,dtype:s}=e,i=new Je(o,s,n,this.nextTensorId());return this.trackTensor(i,r),i}makeVariable(e,r=!0,n,o){n=n||this.nextVariableId().toString(),o!=null&&o!==e.dtype&&(e=e.cast(o));let s=new fl(e,r,n,this.nextTensorId());if(this.state.registeredVariables[s.name]!=null)throw new Error(`Variable with name ${s.name} was already registered`);return this.state.registeredVariables[s.name]=s,this.incRef(s,this.backend),s}trackTensor(e,r){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let n=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(n=e.size*Pv(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:r||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof fl||this.track(e)}incRef(e,r){this.trackTensor(e,r),this.backend.incRef(e.dataId)}removeDataId(e,r){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===r&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;let r=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=r.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){let n=e.size*Pv(e.dtype);this.state.numBytes-=n}r.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,r.backend)}disposeVariables(){for(let e in this.state.registeredVariables){let r=this.state.registeredVariables[e];this.disposeVariable(r)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){let e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;let r=this.state.numBytes,n=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(o=>o.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-r,this.state.activeProfile.newTensors=this.state.numTensors-n;for(let o of this.state.activeProfile.kernels)o.kernelTimeMs=await o.kernelTimeMs,o.extraInfo=await o.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,r,n,o,s,i){let a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:r,outputs:n,saved:s},l=DI(e);l!=null&&(o=l.gradFunc),o!=null&&(a.gradient=u=>(u=u.map((c,p)=>{if(c==null){let f=n[p],d=Fd(f.size,f.dtype);return this.makeTensor(d,f.shape,f.dtype)}return c}),o(u.length>1?u:u[0],s,i))),this.state.activeTape.push(a)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){let r={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(r.name=e),this.state.scopeStack.push(r),this.state.activeScope=r}endScope(e){let r=kx(e),n=new Set(r.map(s=>s.id));for(let s=0;s<this.state.activeScope.track.length;s++){let i=this.state.activeScope.track[s];!i.kept&&!n.has(i.id)&&i.dispose()}let o=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(s=>{!s.kept&&s.scopeId===o.id&&this.track(s)})}gradients(e,r,n,o=!1){if(D(r.length>0,()=>"gradients() received an empty list of xs."),n!=null&&n.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${n.dtype}'`);let s=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));D(s instanceof Je,()=>"The result y returned by f() must be a tensor.");let i=eP(this.state.activeTape,r,s);if(!o&&i.length===0&&r.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{let a={};a[s.id]=n??nZ(s.shape),tP(a,i,u=>this.tidy(u),oZ);let l=r.map(u=>a[u.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(u=>{for(let c of u.saved)c.dispose()}),this.state.activeTape=null),{value:s,grads:l}})}customGrad(e){return D(Rd(e),()=>"The f passed in customGrad(f) must be a function."),(...r)=>{D(r.every(a=>a instanceof Je),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let n,o={};r.forEach((a,l)=>{o[l]=a});let s=(a,l)=>(n=e(...r,l),D(n.value instanceof Je,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),D(Rd(n.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),n.value),i=(a,l)=>{let u=n.gradFunc(a,l),c=Array.isArray(u)?u:[u];D(c.length===r.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),D(c.every(f=>f instanceof Je),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");let p={};return c.forEach((f,d)=>{p[d]=()=>f}),p};return this.runKernelFunc({forwardFunc:s,backwardsFunc:i,inputs:o})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,r){return this.state.tensorInfo.get(e).backend.readToGPU(e,r)}async time(e){let r=Gp(),n=await this.backend.time(e);return n.wallMs=Gp()-r,n}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new l1;for(let e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}};pc.nextTensorId=0;pc.nextVariableId=0;function nZ(t){let e=fx(at(t),"float32");return E.makeTensor(e,t,"float32")}function HI(){let t=_I();if(t._tfengine==null){let e=new mx(t);t._tfengine=new pc(e)}return OF(t._tfengine.ENV),sP(()=>t._tfengine),t._tfengine}var E=HI();function oZ(t,e){let r={a:t,b:e};return E.runKernel(ri,r)}var fc={};qo(fc,{isBrowser:()=>jI,isMobile:()=>aZ,mockIsMobile:()=>iZ});function sZ(){return typeof navigator<"u"&&navigator!=null}var qI;function iZ(t){qI=t}function aZ(t){if(qI!==void 0)return qI;if(t||sZ()){if(t||(t=navigator),t.product==="ReactNative")return!0;let e=t.userAgent||t.vendor||(typeof window<"u"?window.opera:"");if(!e){let r=t;return r.userAgentData&&r.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function jI(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var jo=W();jo.registerFlag("DEBUG",()=>!1,t=>{t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});jo.registerFlag("IS_BROWSER",()=>jI());jo.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");jo.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));jo.registerFlag("PROD",()=>!1);jo.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>jo.getBool("DEBUG"));jo.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);jo.registerFlag("IS_TEST",()=>!1);jo.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>!0);jo.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);jo.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);jo.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);function dl(t,e){let r=t;if(Co(t))return e==="string"?[]:[t.length];if(typeof t=="object"&&"texture"in t){let o=t.channels||"RGBA";return[t.height,t.width*o.length]}if(!Array.isArray(t))return[];let n=[];for(;Array.isArray(r)||Co(r)&&e!=="string";)n.push(r.length),r=r[0];return Array.isArray(t)&&W().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&cP(t,n,[]),n}function cP(t,e,r){if(r=r||[],!Array.isArray(t)&&!Co(t)){D(e.length===0,()=>`Element arr[${r.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}D(e.length>0,()=>`Element arr[${r.join("][")}] should be a primitive, but is an array of ${t.length} elements`),D(t.length===e[0],()=>`Element arr[${r.join("][")}] should have ${e[0]} elements, but has ${t.length} elements`);let n=e.slice(1);for(let o=0;o<t.length;++o)cP(t[o],n,r.concat(o))}function uP(t,e,r,n){if(t!=="string_or_numeric"){if(t==null)throw new Error("Expected dtype cannot be null.");if(t!=="numeric"&&t!==e||t==="numeric"&&e==="string")throw new Error(`Argument '${r}' passed to '${n}' must be ${t} tensor, but got ${e} tensor`)}}function N(t,e,r,n="numeric"){if(t instanceof Je)return uP(n,t.dtype,e,r),t;let o=$d(t);if(o!=="string"&&["bool","int32","float32"].indexOf(n)>=0&&(o=n),uP(n,o,e,r),t==null||!Co(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string"){let l=t==null?"null":t.constructor.name;throw new Error(`Argument '${e}' passed to '${r}' must be a Tensor or TensorLike, but got '${l}'`)}let s=dl(t,o);!Co(t)&&!Array.isArray(t)&&(t=[t]);let a=o!=="string"?Sm(t,o):gu(t,[],!0);return E.makeTensor(a,s,o)}function u1(t,e,r,n="numeric"){if(!Array.isArray(t))throw new Error(`Argument ${e} passed to ${r} must be a \`Tensor[]\` or \`TensorLike[]\``);return t.map((s,i)=>N(s,`${e}[${i}]`,r,n))}var lZ="__op";function _(t){let e=Object.keys(t);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let r=e[0],n=t[r];r.endsWith("_")&&(r=r.substring(0,r.length-1)),r=r+lZ;let o=(...s)=>{E.startScope(r);try{let i=n(...s);return dx(i)&&console.error("Cannot return a Promise inside of tidy."),E.endScope(i),i}catch(i){throw E.endScope(null),i}};return Object.defineProperty(o,"name",{value:r,configurable:!0}),o}function uZ(t,e){let r=N(t,"real","complex"),n=N(e,"imag","complex");Fv(r.shape,n.shape,`real and imag shapes, ${r.shape} and ${n.shape}, must match in call to tf.complex().`);let o={real:r,imag:n};return E.runKernel(Wd,o)}var Ko=_({complex_:uZ});function zi(t,e,r,n){if(n==null&&(n=$d(t)),n==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(typeof t=="object"&&"texture"in t){if(n!=="float32"&&n!=="int32")throw new Error(`Creating tensor from texture only supports 'float32'|'int32' dtype, while the dtype is ${n}.`);return t.channels=t.channels||"RGBA",E.backend.createTensorFromTexture(t,e||r,n)}if(!Co(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){tn(e);let o=at(e),s=at(r);D(o===s,()=>`Based on the provided shape, [${e}], the tensor should have ${o} values but has ${s}`);for(let i=0;i<r.length;++i){let a=r[i],l=i===r.length-1?a!==at(e.slice(i)):!0;D(r[i]===e[i]||!l,()=>`Error creating a new Tensor. Inferred shape (${r}) does not match the provided shape (${e}). `)}}return!Co(t)&&!Array.isArray(t)&&(t=[t]),e=e||r,t=n!=="string"?Sm(t,n):gu(t,[],!0),E.makeTensor(t,e,n)}function Cr(t,e,r){let n=dl(t,r);return zi(t,e,n,r)}var Tx={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};var c1=4;async function fP(t,e){let r=[],n=[],o=Array.isArray(t)?t.map(i=>i.name):Object.keys(t);for(let i=0;i<o.length;++i){let a=o[i],l=Array.isArray(t)?t[i].tensor:t[a];if(l.dtype!=="float32"&&l.dtype!=="int32"&&l.dtype!=="bool"&&l.dtype!=="string"&&l.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${l.dtype}`);let u={name:a,shape:l.shape,dtype:l.dtype};if(l.dtype==="string"){let c=new Promise(async p=>{let f=await l.bytes(),d=f.reduce((x,g)=>x+g.length,0)+c1*f.length,m=new Uint8Array(d),h=0;for(let x=0;x<f.length;x++){let g=f[x],y=new Uint8Array(new Uint32Array([g.length]).buffer);m.set(y,h),h+=c1,m.set(g,h),h+=g.length}p(m)});n.push(c)}else n.push(l.data());e!=null&&(u.group=e),r.push(u)}let s=await Promise.all(n);return{data:cZ(s),specs:r}}function p1(t,e){let r={},n,o=0;for(let s of e){let i=s.name,a=s.dtype,l=s.shape,u=at(l),c;if("quantization"in s){let p=s.quantization;if(p.dtype==="uint8"||p.dtype==="uint16"){if(!("min"in p&&"scale"in p))throw new Error(`Weight ${s.name} with quantization ${p.dtype} doesn't have corresponding metadata min and scale.`)}else if(p.dtype==="float16"){if(a!=="float32")throw new Error(`Weight ${s.name} is quantized with ${p.dtype} which only supports weights of type float32 not ${a}.`)}else throw new Error(`Weight ${s.name} has unknown quantization dtype ${p.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);let f=Tx[p.dtype],d=t.slice(o,o+u*f),m=p.dtype==="uint8"?new Uint8Array(d):new Uint16Array(d);if(a==="float32")if(p.dtype==="uint8"||p.dtype==="uint16"){c=new Float32Array(m.length);for(let h=0;h<m.length;h++){let x=m[h];c[h]=x*p.scale+p.min}}else if(p.dtype==="float16")n===void 0&&(n=mZ()),c=n(m);else throw new Error(`Unsupported quantization type ${p.dtype} for weight type float32.`);else if(a==="int32"){if(p.dtype!=="uint8"&&p.dtype!=="uint16")throw new Error(`Unsupported quantization type ${p.dtype} for weight type int32.`);c=new Int32Array(m.length);for(let h=0;h<m.length;h++){let x=m[h];c[h]=Math.round(x*p.scale+p.min)}}else throw new Error(`Unsupported dtype in weight '${i}': ${a}`);o+=u*f}else if(a==="string"){let p=at(s.shape);c=[];for(let f=0;f<p;f++){let d=new Uint32Array(t.slice(o,o+c1))[0];o+=c1;let m=new Uint8Array(t.slice(o,o+d));c.push(m),o+=d}}else{let p=Tx[a],f=t.slice(o,o+u*p);if(a==="float32")c=new Float32Array(f);else if(a==="int32")c=new Int32Array(f);else if(a==="bool")c=new Uint8Array(f);else if(a==="complex64"){c=new Float32Array(f);let d=new Float32Array(c.length/2),m=new Float32Array(c.length/2);for(let g=0;g<d.length;g++)d[g]=c[g*2],m[g]=c[g*2+1];let h=Cr(d,l,"float32"),x=Cr(m,l,"float32");r[i]=Ko(h,x),h.dispose(),x.dispose()}else throw new Error(`Unsupported dtype in weight '${i}': ${a}`);o+=u*p}a!=="complex64"&&(r[i]=Cr(c,l,a))}return r}function cZ(t){if(t===null)throw new Error(`Invalid input value: ${JSON.stringify(t)}`);let e=0,r=[];t.forEach(s=>{if(e+=s.byteLength,r.push(s.byteLength===s.buffer.byteLength?s:new s.constructor(s)),!(s instanceof Float32Array||s instanceof Int32Array||s instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${s.constructor.name}`)});let n=new Uint8Array(e),o=0;return r.forEach(s=>{n.set(new Uint8Array(s.buffer),o),o+=s.byteLength}),n.buffer}var KI=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function pP(t){return KI?Buffer.byteLength(t):new Blob([t]).size}function dP(t){if(KI)return Buffer.from(t).toString("base64");let e=new Uint8Array(t),r="";for(let n=0,o=e.length;n<o;n++)r+=String.fromCharCode(e[n]);return btoa(r)}function mP(t){if(KI){let n=Buffer.from(t,"base64");return n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength)}let e=atob(t),r=new Uint8Array(e.length);for(let n=0;n<e.length;++n)r.set([e.charCodeAt(n)],n);return r.buffer}function Im(t){if(t.length===1)return t[0];let e=0;t.forEach(o=>{e+=o.byteLength});let r=new Uint8Array(e),n=0;return t.forEach(o=>{r.set(new Uint8Array(o),n),n+=o.byteLength}),r.buffer}function XI(t){let e="/";for(t=t.trim();t.endsWith(e);)t=t.slice(0,t.length-1);let r=t.split(e);return r[r.length-1]}function f1(t,e){let r={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:e};return t.signature!=null&&(r.signature=t.signature),t.userDefinedMetadata!=null&&(r.userDefinedMetadata=t.userDefinedMetadata),t.modelInitializer!=null&&(r.modelInitializer=t.modelInitializer),t.initializerSignature!=null&&(r.initializerSignature=t.initializerSignature),t.trainingConfig!=null&&(r.trainingConfig=t.trainingConfig),r}function YI(t,e,r){let n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy};if(t.trainingConfig!=null&&(n.trainingConfig=t.trainingConfig),t.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!r)throw new Error("modelJSON has weightsManifest but weightData is null");n.weightSpecs=e,n.weightData=r}return t.signature!=null&&(n.signature=t.signature),t.userDefinedMetadata!=null&&(n.userDefinedMetadata=t.userDefinedMetadata),t.modelInitializer!=null&&(n.modelInitializer=t.modelInitializer),t.initializerSignature!=null&&(n.initializerSignature=t.initializerSignature),n}async function Em(t,e){let r,n;return t.weightsManifest!=null&&([r,n]=await e(t.weightsManifest)),YI(t,r,n)}function Bi(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:t.modelTopology==null?0:pP(JSON.stringify(t.modelTopology)),weightSpecsBytes:t.weightSpecs==null?0:pP(JSON.stringify(t.weightSpecs)),weightDataBytes:t.weightData==null?0:t.weightData.byteLength}}function d1(t){let e=[];for(let r of t)e.push(...r.weights);return e}function pZ(){let t=r=>{let n=r<<13,o=0;for(;(n&8388608)===0;)o-=8388608,n<<=1;return n&=-8388609,o+=947912704,n|o},e=new Uint32Array(2048);e[0]=0;for(let r=1;r<1024;r++)e[r]=t(r);for(let r=1024;r<2048;r++)e[r]=939524096+(r-1024<<13);return e}function fZ(){let t=new Uint32Array(64);t[0]=0,t[31]=1199570944,t[32]=2147483648,t[63]=3347054592;for(let e=1;e<31;e++)t[e]=e<<23;for(let e=33;e<63;e++)t[e]=2147483648+(e-32<<23);return t}function dZ(){let t=new Uint32Array(64);for(let e=0;e<64;e++)t[e]=1024;return t[0]=t[32]=0,t}function mZ(){let t=pZ(),e=fZ(),r=dZ();return n=>{let o=new ArrayBuffer(4*n.length),s=new Uint32Array(o);for(let i=0;i<n.length;i++){let a=n[i],l=t[r[a>>10]+(a&1023)]+e[a>>10];s[i]=l}return new Float32Array(o)}}var Nt=class{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return Nt.instance==null&&(Nt.instance=new Nt),Nt.instance}static registerSaveRouter(e){Nt.getInstance().saveRouters.push(e)}static registerLoadRouter(e){Nt.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return Nt.getHandlers(e,"save")}static getLoadHandlers(e,r){return Nt.getHandlers(e,"load",r)}static getHandlers(e,r,n){let o=[];return(r==="load"?Nt.getInstance().loadRouters:Nt.getInstance().saveRouters).forEach(i=>{let a=i(e,n);a!==null&&o.push(a)}),o}},hP=t=>Nt.registerSaveRouter(t),gP=t=>Nt.registerLoadRouter(t),xP=t=>Nt.getSaveHandlers(t),yP=(t,e)=>Nt.getLoadHandlers(t,e);var QI="tensorflowjs",ZI=1,Hp="models_store",dc="model_info_store";function bP(){if(!W().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");let t=typeof window>"u"?self:window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function JI(t){let e=t.result;e.createObjectStore(Hp,{keyPath:"modelPath"}),e.createObjectStore(dc,{keyPath:"modelPath"})}var Vi=class{constructor(e){if(this.indexedDB=bP(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,r){return new Promise((n,o)=>{let s=this.indexedDB.open(QI,ZI);s.onupgradeneeded=()=>JI(s),s.onsuccess=()=>{let i=s.result;if(r==null){let a=i.transaction(Hp,"readonly"),u=a.objectStore(Hp).get(this.modelPath);u.onsuccess=()=>{if(u.result==null)return i.close(),o(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));n(u.result.modelArtifacts)},u.onerror=c=>(i.close(),o(u.error)),a.oncomplete=()=>i.close()}else{let a=Bi(r),l=i.transaction(dc,"readwrite"),u=l.objectStore(dc),c=u.put({modelPath:this.modelPath,modelArtifactsInfo:a}),p;c.onsuccess=()=>{p=i.transaction(Hp,"readwrite");let d=p.objectStore(Hp).put({modelPath:this.modelPath,modelArtifacts:r,modelArtifactsInfo:a});d.onsuccess=()=>n({modelArtifactsInfo:a}),d.onerror=m=>{u=l.objectStore(dc);let h=u.delete(this.modelPath);h.onsuccess=()=>(i.close(),o(d.error)),h.onerror=x=>(i.close(),o(d.error))}},c.onerror=f=>(i.close(),o(c.error)),l.oncomplete=()=>{p==null?i.close():p.oncomplete=()=>i.close()}}},s.onerror=i=>o(s.error)})}};Vi.URL_SCHEME="indexeddb://";var vP=t=>W().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Vi.URL_SCHEME)?hZ(t.slice(Vi.URL_SCHEME.length)):null;Nt.registerSaveRouter(vP);Nt.registerLoadRouter(vP);function hZ(t){return new Vi(t)}function gZ(t){return t.startsWith(Vi.URL_SCHEME)?t.slice(Vi.URL_SCHEME.length):t}var m1=class{constructor(){this.indexedDB=bP()}async listModels(){return new Promise((e,r)=>{let n=this.indexedDB.open(QI,ZI);n.onupgradeneeded=()=>JI(n),n.onsuccess=()=>{let o=n.result,s=o.transaction(dc,"readonly"),a=s.objectStore(dc).getAll();a.onsuccess=()=>{let l={};for(let u of a.result)l[u.modelPath]=u.modelArtifactsInfo;e(l)},a.onerror=l=>(o.close(),r(a.error)),s.oncomplete=()=>o.close()},n.onerror=o=>r(n.error)})}async removeModel(e){return e=gZ(e),new Promise((r,n)=>{let o=this.indexedDB.open(QI,ZI);o.onupgradeneeded=()=>JI(o),o.onsuccess=()=>{let s=o.result,i=s.transaction(dc,"readwrite"),a=i.objectStore(dc),l=a.get(e),u;l.onsuccess=()=>{if(l.result==null)return s.close(),n(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{let c=a.delete(e),p=()=>{u=s.transaction(Hp,"readwrite");let d=u.objectStore(Hp).delete(e);d.onsuccess=()=>r(l.result.modelArtifactsInfo),d.onerror=m=>n(l.error)};c.onsuccess=p,c.onerror=f=>(p(),s.close(),n(l.error))}},l.onerror=c=>(s.close(),n(l.error)),i.oncomplete=()=>{u==null?s.close():u.oncomplete=()=>s.close()}},o.onerror=s=>n(o.error)})}};var ml="/",_m="tensorflowjs_models",wP="info",xZ="model_topology",yZ="weight_specs",bZ="weight_data",vZ="model_metadata";function CP(t){return{info:[_m,t,wP].join(ml),topology:[_m,t,xZ].join(ml),weightSpecs:[_m,t,yZ].join(ml),weightData:[_m,t,bZ].join(ml),modelMetadata:[_m,t,vZ].join(ml)}}function SP(t){for(let e of Object.values(t))window.localStorage.removeItem(e)}function wZ(t){let e=t.split(ml);if(e.length<3)throw new Error(`Invalid key format: ${t}`);return e.slice(1,e.length-1).join(ml)}function CZ(t){return t.startsWith(Wi.URL_SCHEME)?t.slice(Wi.URL_SCHEME.length):t}var Wi=class{constructor(e){if(!W().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=CP(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{let r=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),o=Bi(e);try{this.LS.setItem(this.keys.info,JSON.stringify(o)),this.LS.setItem(this.keys.topology,r),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,dP(e.weightData));let s={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(s)),{modelArtifactsInfo:o}}catch{throw SP(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${o.modelTopologyBytes}, weightSpecsBytes=${o.weightSpecsBytes}, weightDataBytes=${o.weightDataBytes}.`)}}}async load(){let e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");let r={},n=JSON.parse(this.LS.getItem(this.keys.topology));if(n==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);r.modelTopology=n;let o=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(o==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);r.weightSpecs=o;let s=this.LS.getItem(this.keys.modelMetadata);if(s!=null){let a=JSON.parse(s);r.format=a.format,r.generatedBy=a.generatedBy,r.convertedBy=a.convertedBy,a.signature!=null&&(r.signature=a.signature),a.userDefinedMetadata!=null&&(r.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(r.modelInitializer=a.modelInitializer),a.initializerSignature!=null&&(r.initializerSignature=a.initializerSignature),a.trainingConfig!=null&&(r.trainingConfig=a.trainingConfig)}let i=this.LS.getItem(this.keys.weightData);if(i==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return r.weightData=mP(i),r}};Wi.URL_SCHEME="localstorage://";var kP=t=>W().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Wi.URL_SCHEME)?SZ(t.slice(Wi.URL_SCHEME.length)):null;Nt.registerSaveRouter(kP);Nt.registerLoadRouter(kP);function SZ(t){return new Wi(t)}var h1=class{constructor(){D(W().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),D(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){let e={},r=_m+ml,n=ml+wP;for(let o=0;o<this.LS.length;++o){let s=this.LS.key(o);if(s.startsWith(r)&&s.endsWith(n)){let i=wZ(s);e[i]=JSON.parse(this.LS.getItem(s))}}return e}async removeModel(e){e=CZ(e);let r=CP(e);if(this.LS.getItem(r.info)==null)throw new Error(`Cannot find model at path '${e}'`);let n=JSON.parse(this.LS.getItem(r.info));return SP(r),n}};var Am="://",nn=class{constructor(){this.managers={}}static getInstance(){return nn.instance==null&&(nn.instance=new nn),nn.instance}static registerManager(e,r){D(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(Am)&&(e=e.slice(0,e.indexOf(Am))),D(e.length>0,()=>"scheme must not be an empty string.");let n=nn.getInstance();D(n.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),n.managers[e]=r}static getManager(e){let r=nn.getInstance().managers[e];if(r==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return r}static getSchemes(){return Object.keys(nn.getInstance().managers)}};function g1(t){if(t.indexOf(Am)===-1)throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${nn.getSchemes().join(",")}`);return{scheme:t.split(Am)[0],path:t.split(Am)[1]}}async function TP(t,e,r=!1){D(t!==e,()=>`Old path and new path are the same: '${t}'`);let n=Nt.getLoadHandlers(t);D(n.length>0,()=>`Copying failed because no load handler is found for source URL ${t}.`),D(n.length<2,()=>`Copying failed because more than one (${n.length}) load handlers for source URL ${t}.`);let o=n[0],s=Nt.getSaveHandlers(e);D(s.length>0,()=>`Copying failed because no save handler is found for destination URL ${e}.`),D(s.length<2,()=>`Copying failed because more than one (${n.length}) save handlers for destination URL ${e}.`);let i=s[0],a=g1(t).scheme,l=g1(t).path,u=a===g1(t).scheme,c=await o.load();r&&u&&await nn.getManager(a).removeModel(l);let p=await i.save(c);return r&&!u&&await nn.getManager(a).removeModel(l),p.modelArtifactsInfo}async function NP(){let t=nn.getSchemes(),e={};for(let r of t){let n=await nn.getManager(r).listModels();for(let o in n){let s=r+Am+o;e[s]=n[o]}}return e}async function IP(t){let e=g1(t);return nn.getManager(e.scheme).removeModel(e.path)}async function EP(t,e){return TP(t,e,!1)}async function _P(t,e){return TP(t,e,!0)}var e2=class{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,r){return fetch(e,r)}now(){return performance.now()}encode(e,r){if(r!=="utf-8"&&r!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${r}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,r){return new TextDecoder(r).decode(e)}setTimeoutCustom(e,r){if(typeof window>"u"||!W().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,r);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},r),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",n=>{if(n.source===window&&n.data.name===this.messageName){n.stopPropagation();let o=this.functionRefs[n.data.index];o(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}};if(W().get("IS_BROWSER")){W().setPlatform("browser",new e2);try{nn.registerManager(Wi.URL_SCHEME,new h1)}catch{}try{nn.registerManager(Vi.URL_SCHEME,new m1)}catch{}}var kZ={importFetch:()=>AP()},t2;var r2=class{constructor(){this.util=DP(),this.textEncoder=new this.util.TextEncoder}fetch(e,r){return W().global.fetch!=null?W().global.fetch(e,r):(t2==null&&(t2=kZ.importFetch()),t2(e,r))}now(){let e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,r){if(r!=="utf-8"&&r!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${r}`);return this.textEncoder.encode(e)}decode(e,r){return e.length===0?"":new this.util.TextDecoder(r).decode(e)}};W().get("IS_NODE")&&!W().get("IS_BROWSER")&&W().setPlatform("node",new r2);function Ie(t,e="float32",r){return e=e||"float32",tn(t),new bt(t,e,r)}function TZ(t,e){let r=N(t,"x","cast");if(!TI(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&r.dtype!=="string"||e!=="string"&&r.dtype==="string")throw new Error("Only strings can be casted to strings");let n={x:r},o={dtype:e};return E.runKernel(Oi,n,o)}var oe=_({cast_:TZ});function NZ(t){let r={x:N(t,"x","clone","string_or_numeric")};return E.runKernel(Fi,r)}var To=_({clone_:NZ});function $P(t,e=!1){console.log(t.toString(e))}HI();var IZ={buffer:Ie,cast:oe,clone:To,print:$P};iP(IZ);var gl={};qo(gl,{browserFiles:()=>OP,browserHTTPRequest:()=>LP,concatenateArrayBuffers:()=>Im,copyModel:()=>EP,decodeWeights:()=>p1,encodeWeights:()=>fP,fromMemory:()=>MP,fromMemorySync:()=>l2,getLoadHandlers:()=>yP,getModelArtifactsForJSON:()=>Em,getModelArtifactsForJSONSync:()=>YI,getModelArtifactsInfoForJSON:()=>Bi,getSaveHandlers:()=>xP,getWeightSpecs:()=>d1,http:()=>y1,isHTTPScheme:()=>x1,listModels:()=>NP,loadWeights:()=>FP,moveModel:()=>_P,registerLoadRouter:()=>gP,registerSaveRouter:()=>hP,removeModel:()=>IP,weightsLoaderFactory:()=>i2,withSaveHandler:()=>zP,withSaveHandlerSync:()=>BP});var EZ="model",_Z=".json",AZ=".weights.bin";function RP(t){return new Promise(e=>setTimeout(e)).then(t)}var hl=class{constructor(e){if(!W().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(hl.URL_SCHEME)&&(e=e.slice(hl.URL_SCHEME.length)),(e==null||e.length===0)&&(e=EZ),this.modelJsonFileName=e+_Z,this.weightDataFileName=e+AZ}async save(e){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");let r=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{let n=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],o=f1(e,n),s=window.URL.createObjectURL(new Blob([JSON.stringify(o)],{type:"application/json"})),i=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor;if(i.download=this.modelJsonFileName,i.href=s,await RP(()=>i.dispatchEvent(new MouseEvent("click"))),e.weightData!=null){let a=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;a.download=this.weightDataFileName,a.href=r,await RP(()=>a.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:Bi(e)}}}};hl.URL_SCHEME="downloads://";var n2=class{constructor(e){if(e==null||e.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${e}`);this.jsonFile=e[0],this.weightsFiles=e.slice(1)}async load(){return new Promise((e,r)=>{let n=new FileReader;n.onload=o=>{let s=JSON.parse(o.target.result),i=s.modelTopology;if(i==null){r(new Error(`modelTopology field is missing from file ${this.jsonFile.name}`));return}if(s.weightsManifest==null){r(new Error(`weightManifest field is missing from file ${this.jsonFile.name}`));return}if(this.weightsFiles.length===0){e({modelTopology:i});return}let l=Em(s,u=>this.loadWeights(u));e(l)},n.onerror=o=>r(`Failed to read model topology and weights manifest JSON from file '${this.jsonFile.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),n.readAsText(this.jsonFile)})}loadWeights(e){let r=[],n=[];for(let i of e)r.push(...i.weights),n.push(...i.paths);let o=this.checkManifestAndWeightFiles(e),s=n.map(i=>this.loadWeightsFile(i,o[i]));return Promise.all(s).then(i=>[r,Im(i)])}loadWeightsFile(e,r){return new Promise((n,o)=>{let s=new FileReader;s.onload=i=>{let a=i.target.result;n(a)},s.onerror=i=>o(`Failed to weights data from file of path '${e}'.`),s.readAsArrayBuffer(r)})}checkManifestAndWeightFiles(e){let r=[],n=this.weightsFiles.map(s=>XI(s.name)),o={};for(let s of e)s.paths.forEach(i=>{let a=XI(i);if(r.indexOf(a)!==-1)throw new Error(`Duplicate file basename found in weights manifest: '${a}'`);if(r.push(a),n.indexOf(a)===-1)throw new Error(`Weight file with basename '${a}' is not provided.`);o[i]=this.weightsFiles[n.indexOf(a)]});if(r.length!==this.weightsFiles.length)throw new Error(`Mismatch in the number of files in weights manifest (${r.length}) and the number of weight files provided (${this.weightsFiles.length}).`);return o}},DZ=t=>W().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(hl.URL_SCHEME)?$Z(t.slice(hl.URL_SCHEME.length)):null;Nt.registerSaveRouter(DZ);function $Z(t="model"){return new hl(t)}function OP(t){return new n2(t)}function o2(t,e,r,n){i(t),r=r??0,n=n??1,a(r,n);let o=0,s=l=>(l.then(u=>{let c=r+ ++o/t.length*(n-r);return e(c),u}),l);function i(l){D(l!=null&&Array.isArray(l)&&l.length>0,()=>"promises must be a none empty array")}function a(l,u){D(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${l}`),D(u>=0&&u<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${u}`),D(u>=l,()=>`startFraction must be no more than endFraction, but got startFraction ${l} and endFraction ${u}`)}return Promise.all(t.map(s))}async function s2(t,e){e==null&&(e={});let r=e.fetchFunc==null?W().platform.fetch:e.fetchFunc,n=t.map(p=>r(p,e.requestInit,{isBinary:!0})),o=0,s=.5,a=(e.onProgress==null?await Promise.all(n):await o2(n,e.onProgress,o,s)).map(p=>p.arrayBuffer()),l=.5,u=1;return e.onProgress==null?await Promise.all(a):await o2(a,e.onProgress,l,u)}async function FP(t,e="",r,n){return i2(i=>s2(i,{requestInit:n}))(t,e,r)}function i2(t){return async(e,r="",n)=>{let o=e.map(()=>!1),s={},i=n!=null?n.map(()=>!1):[],a=[];if(e.forEach((d,m)=>{let h=0;d.weights.forEach(x=>{let g="quantization"in x?x.quantization.dtype:x.dtype,y=Tx[g]*at(x.shape),b=()=>{o[m]=!0,s[m]==null&&(s[m]=[]),s[m].push({manifestEntry:x,groupOffset:h,sizeBytes:y})};n!=null?n.forEach((v,C)=>{v===x.name&&(b(),i[C]=!0)}):b(),a.push(x.name),h+=y})}),!i.every(d=>d)){let d=n.filter((m,h)=>!i[h]);throw new Error(`Could not find weights in manifest with names: ${d.join(", ")}. 
Manifest JSON has weights with names: ${a.join(", ")}.`)}let l=o.reduce((d,m,h)=>(m&&d.push(h),d),[]),u=[];l.forEach(d=>{e[d].paths.forEach(m=>{let h=r+(r.endsWith("/")?"":"/")+m;u.push(h)})});let c=await t(u),p={},f=0;return l.forEach(d=>{let m=e[d].paths.length,h=0;for(let v=0;v<m;v++)h+=c[f+v].byteLength;let x=new ArrayBuffer(h),g=new Uint8Array(x),y=0;for(let v=0;v<m;v++){let C=new Uint8Array(c[f+v]);g.set(C,y),y+=C.byteLength}s[d].forEach(v=>{let C=x.slice(v.groupOffset,v.groupOffset+v.sizeBytes),S=p1(C,[v.manifestEntry]);for(let k in S)p[k]=S[k]}),f+=m}),p}}var RZ="application/octet-stream",OZ="application/json",Nx=class{constructor(e,r){if(this.DEFAULT_METHOD="POST",r==null&&(r={}),this.weightPathPrefix=r.weightPathPrefix,this.onProgress=r.onProgress,this.weightUrlConverter=r.weightUrlConverter,r.fetchFunc!=null?(D(typeof r.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=r.fetchFunc):this.fetch=W().platform.fetch,D(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&D(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,r.requestInit!=null&&r.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=r.requestInit||{}}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");let r=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);r.body=new FormData;let n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],o=f1(e,n);r.body.append("model.json",new Blob([JSON.stringify(o)],{type:OZ}),"model.json"),e.weightData!=null&&r.body.append("model.weights.bin",new Blob([e.weightData],{type:RZ}),"model.weights.bin");let s=await this.fetch(this.path,r);if(s.ok)return{modelArtifactsInfo:Bi(e),responses:[s]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${s.status}.`)}async load(){let e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let r;try{r=await e.json()}catch{let i=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?i+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":i+=" Please make sure the server is serving valid JSON for this request.",new Error(i)}let n=r.modelTopology,o=r.weightsManifest;if(n==null&&o==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return Em(r,s=>this.loadWeights(s))}async loadWeights(e){let r=Array.isArray(this.path)?this.path[1]:this.path,[n,o]=FZ(r),s=this.weightPathPrefix||n,i=d1(e),a=[],l=[];for(let c of e)for(let p of c.paths)this.weightUrlConverter!=null?l.push(this.weightUrlConverter(p)):a.push(s+p+o);this.weightUrlConverter&&a.push(...await Promise.all(l));let u=await s2(a,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});return[i,Im(u)]}};Nx.URL_SCHEME_REGEX=/^https?:\/\//;function FZ(t){let e=t.lastIndexOf("/"),r=t.lastIndexOf("?"),n=t.substring(0,e),o=r>e?t.substring(r):"";return[n+"/",o]}function x1(t){return t.match(Nx.URL_SCHEME_REGEX)!=null}var PP=(t,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let r=!0;if(Array.isArray(t)?r=t.every(n=>x1(n)):r=x1(t),r)return y1(t,e)}return null};Nt.registerSaveRouter(PP);Nt.registerLoadRouter(PP);function y1(t,e){return new Nx(t,e)}function LP(t,e){return y1(t,e)}var Ix=class{constructor(e){this.modelArtifacts=e}load(){return this.modelArtifacts}},b1=class{constructor(e){this.saveHandler=e}save(e){return this.saveHandler(e)}},a2=class{constructor(e){e.load&&(this.load=()=>Promise.resolve(e.load())),e.save&&(this.save=r=>Promise.resolve(e.save(r)))}};function MP(t,e,r,n){let o=arguments;return new a2(l2(...o))}function l2(t,e,r,n){return arguments.length===1?t.modelTopology!=null||t.weightSpecs!=null?new Ix(t):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Ix({modelTopology:t})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Ix({modelTopology:t,weightSpecs:e,weightData:r,trainingConfig:n}))}function zP(t){return new b1(t)}function BP(t){return new b1(t)}function PZ(t,e,r=!1,n=!1){let o=N(t,"a","matMul"),s=N(e,"b","matMul");[o,s]=Ye(o,s);let i={a:o,b:s},a={transposeA:r,transposeB:n};return E.runKernel(Su,i,a)}var ot=_({matMul_:PZ});function LZ(t,e,r=1,n=0,o="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);let i={indices:N(t,"indices","oneHot","int32")},a={dtype:o,depth:e,onValue:r,offValue:n};return E.runKernel(qu,i,a)}var Dm=_({oneHot_:LZ});function MZ(t){W().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(t+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}aP(MZ);function ys(){return E}function Ex(){return E.memory()}function G(t,e){return E.tidy(t,e)}function Me(t){kx(t).forEach(r=>r.dispose())}function Ur(t){return E.keep(t)}function v1(t,e,r=1){return E.registerBackend(t,e,r)}function VP(){return E.backend}function zZ(t){let r={input:N(t,"input","imag")};return E.runKernel(om,r)}var $m=_({imag_:zZ});function BZ(t){let r={x:N(t,"x","neg")};return E.runKernel(Uu,r)}var st=_({neg_:BZ});function VZ(t){let r={input:N(t,"input","real")};return E.runKernel(fm,r)}var qp=_({real_:VZ});function WZ(t,e,r){let n=N(t,"x","transpose");if(e==null&&(e=n.shape.map((i,a)=>a).reverse()),D(n.rank===e.length,()=>`Error in transpose: rank of input ${n.rank} must match length of perm ${e}.`),e.forEach(i=>{D(i>=0&&i<n.rank,()=>`All entries in 'perm' must be between 0 and ${n.rank-1} but got ${e}`)}),n.rank<=1)return n.clone();let o={x:n},s={perm:e};return n.dtype==="complex64"?G(()=>{let i=qp(n),a=$m(n);return i=E.runKernel(Li,{x:i},s),a=E.runKernel(Li,{x:a},s),r&&(a=st(a)),Ko(i,a)}):E.runKernel(Li,o,s)}var Ue=_({transpose_:WZ});var No={};qo(No,{assertAndGetBroadcastShape:()=>Ve,getBroadcastDims:()=>WP,getReductionAxes:()=>vt});function WP(t,e){let r=t.length,n=[];for(let o=0;o<r;o++){let s=r-1-o,i=t[s]||1;(e[e.length-1-o]||1)>1&&i===1&&n.unshift(s)}return n}function vt(t,e){let r=[];for(let n=0;n<e.length;n++){let o=t[t.length-n-1],s=e.length-n-1,i=e[s];(o==null||o===1&&i>1)&&r.unshift(s)}return r}function Ve(t,e){let r=[],n=Math.max(t.length,e.length);for(let o=0;o<n;o++){let s=t[t.length-o-1];s==null&&(s=1);let i=e[e.length-o-1];if(i==null&&(i=1),s===1)r.unshift(i);else if(i===1)r.unshift(s);else if(s!==i){let a=`Operands could not be broadcast together with shapes ${t} and ${e}.`;throw Error(a)}else r.unshift(s)}return r}var _x={};qo(_x,{fromPixels:()=>XZ,fromPixelsAsync:()=>jZ,toPixels:()=>KZ});function GP(t,e,r){if(Np(t),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");let n=dl(t,r);if(n.length!==3&&n.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return zi(t,e,n,r)}var jp;function UP(t,e=3){if(e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(t==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let r=!1,n=!1,o=!1,s=!1,i=!1,a=!1;if(t.data instanceof Uint8Array)r=!0;else if(typeof ImageData<"u"&&t instanceof ImageData)n=!0;else if(typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement)o=!0;else if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement)s=!0;else if(t.getContext!=null)i=!0;else if(typeof ImageBitmap<"u"&&t instanceof ImageBitmap)a=!0;else throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${t.constructor.name}`);if(bx(yx,E.backendName)!=null){let m={pixels:t},h={numChannels:e};return E.runKernel(yx,m,h)}let[u,c]=o?[t.videoWidth,t.videoHeight]:[t.width,t.height],p;if(i)p=t.getContext("2d").getImageData(0,0,u,c).data;else if(n||r)p=t.data;else if(s||o||a){if(jp==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")jp=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else jp=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});jp.canvas.width=u,jp.canvas.height=c,jp.drawImage(t,0,0,u,c),p=jp.getImageData(0,0,u,c).data}let f;if(e===4)f=new Int32Array(p);else{let m=u*c;f=new Int32Array(m*e);for(let h=0;h<m;h++)for(let x=0;x<e;++x)f[h*e+x]=p[h*4+x]}return GP(f,[c,u,e],"int32")}function GZ(t){return t!=null&&t.data instanceof Uint8Array}function UZ(){return typeof window<"u"&&typeof ImageBitmap<"u"&&window.hasOwnProperty("createImageBitmap")}function HZ(t){return t!=null&&t.width!==0&&t.height!==0}function qZ(t){return UZ()&&!(t instanceof ImageBitmap)&&HZ(t)&&!GZ(t)}async function jZ(t,e=3){let r=null;if(W().getBool("WRAP_TO_IMAGEBITMAP")&&qZ(t)){let n;try{n=await createImageBitmap(t,{premultiplyAlpha:"none"})}catch{n=null}n!=null&&n.width===t.width&&n.height===t.height?r=n:r=t}else r=t;return UP(r,e)}async function KZ(t,e){let r=N(t,"img","toPixels");if(!(t instanceof Je)){let u=r;r=oe(u,"int32"),u.dispose()}if(r.rank!==2&&r.rank!==3)throw new Error(`toPixels only supports rank 2 or 3 tensors, got rank ${r.rank}.`);let[n,o]=r.shape.slice(0,2),s=r.rank===2?1:r.shape[2];if(s>4||s===2)throw new Error(`toPixels only supports depth of size 1, 3 or 4 but got ${s}`);if(r.dtype!=="float32"&&r.dtype!=="int32")throw new Error(`Unsupported type for toPixels: ${r.dtype}. Please use float32 or int32 tensors.`);let i=await r.data(),a=r.dtype==="float32"?255:1,l=new Uint8ClampedArray(o*n*4);for(let u=0;u<n*o;++u){let c=[0,0,0,255];for(let f=0;f<s;f++){let d=i[u*s+f];if(r.dtype==="float32"){if(d<0||d>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${d}.`)}else if(r.dtype==="int32"&&(d<0||d>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${d}.`);s===1?(c[0]=d*a,c[1]=d*a,c[2]=d*a):c[f]=d*a}let p=u*4;l[p+0]=Math.round(c[0]),l[p+1]=Math.round(c[1]),l[p+2]=Math.round(c[2]),l[p+3]=Math.round(c[3])}if(e!=null){e.width=o,e.height=n;let u=e.getContext("2d"),c=new ImageData(l,o,n);u.putImageData(c,0,0)}return r!==t&&r.dispose(),l}var XZ=_({fromPixels_:UP});function YZ(t,e){let r=t.shape.length,n=e.shape.length;if(r<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${r}.`);if(n<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${n}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[n-1]>r)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[n-1]} vs. ${r}`);if(at(t.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${t.shape}.`);let o=e.shape,s=o[o.length-1],i=1;for(let p=0;p<o.length-1;++p)i*=o[p];let a=t.shape,l=o.slice();l.pop();let u=1;for(let p=s;p<r;++p)u*=a[p],l.push(a[p]);let c=[...Ri(t.shape).map(p=>p/u),1].slice(0,s);return[l,i,u,c]}function HP(t,e,r){let n=e.rank>1?e.shape[e.rank-1]:1,o=e.rank>1?e.rank-1:1,s=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${r.shape}, indices.shape: ${e.shape}, shape: ${t}, sliceDim: ${n}, and batchDim: ${o}.`;if(r.rank<o)throw new Error(s+` update.rank < ${o}. `);if(t.length<n+(r.rank-o))throw new Error(s+` Output shape length < ${n+(r.rank-o)}`);if(r.rank!==o+t.length-n)throw new Error(s+` update.rank != ${o+t.length-n}`);for(let i=0;i<o;++i)if(r.shape[i]!==e.shape[i])throw new Error(s+` updates.shape[${i}] (${r.shape[i]}) != indices.shape[${i}] (${e.shape[i]}).`);for(let i=0;i<r.rank-o;++i)if(r.shape[i+o]!==t[i+n])throw new Error(s+` updates.shape[${i+o}] (${r.shape[i+o]}) != shape[${i+o}] (${t[i+o]})`)}function QZ(t,e,r){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${t.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(r.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${r}`);if(r.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(t.size===0)throw new Error(`Updates specified for empty output. updates shape: ${t.shape}`)}HP(r,e,t)}function ZZ(t,e,r){let n=e.shape.length,o=n>1?e.shape[n-1]:1,s=r.length,i=1;for(let p=o;p<s;++p)i*=r[p];let a=o<1?1:o,l=at(e.shape)/a,u=[...Ri(r.slice(0,o)),1],c=at(r);return{sliceRank:o,numUpdates:l,sliceSize:i,strides:u,outputSize:c}}var Hr={};qo(Hr,{assertParamsValid:()=>eJ,computeFlatOffset:()=>sJ,computeOutShape:()=>rJ,getNormalizedAxes:()=>nJ,isSliceContinous:()=>oJ,maskToAxes:()=>tJ,parseSliceParams:()=>c2,sliceInfo:()=>iJ,startForAxis:()=>JP,startIndicesWithElidedDims:()=>YP,stopForAxis:()=>eL,stopIndicesWithElidedDims:()=>QP,stridesForAxis:()=>ZP,stridesWithElidedDims:()=>jP});var u2=-2,JZ=-1;function eJ(t,e,r){let n=t.shape.length;D(n===e.length,()=>`Error in slice${n}D: Length of begin ${e} must match the rank of the array (${n}).`),D(n===r.length,()=>`Error in slice${n}D: Length of size ${r} must match the rank of the array (${n}).`);for(let o=0;o<n;++o)D(e[o]+r[o]<=t.shape[o],()=>`Error in slice${n}D: begin[${o}] + size[${o}] (${e[o]+r[o]}) would overflow input.shape[${o}] (${t.shape[o]})`)}function tJ(t){let e=[],r=0;for(;t>0;)t&1&&e.push(r),t/=2,r++;return e}function rJ(t,e,r){let n=[];for(let o=0;o<t.length;o++)n[o]=Math.ceil((e[o]-t[o])/r[o]);return n}function jP(t,e,r,n){let o=[...t];for(let s=o.length;s<n.length;s++)o.push(1);for(let s=0;s<r;s++)s===0?o[e]=1:(o.splice(e,0,1),o.pop());return o}function KP(t,e,r){return r<=t?r:r-(e-1)}function XP(t,e){let r=[];for(let n=0;n<t;n++)r.push(e+n);return r}function nJ(t,e,r,n,o,s,i,a,l){let u=t.length,c=new Array(u),p=new Array(u),f=new Array(u);if(e.length&&r>0){let d=e[0],m=r+1;c=YP(i,d,m,n,t),p=QP(a,d,m,o,t),f=jP(s,d,m,t)}else for(let d=0;d<u;d++)c[d]=JP(i,n,s,t,d,l),p[d]=eL(a,o,s,t,d,l),f[d]=ZP(s,d,l);return{begin:c,end:p,strides:f}}function YP(t,e,r,n,o){let s=[...o],i=XP(r,e);for(let a=0;a<s.length;a++)if(i.indexOf(a)>-1)s[a]=0;else{let l=KP(e,r,a),u=n[l];t&1<<l&&(u=0),s[a]=u}return s}function QP(t,e,r,n,o){let s=[...o],i=XP(r,e);for(let a=0;a<s.length;a++)if(i.indexOf(a)>-1)s[a]=Number.MAX_SAFE_INTEGER;else{let l=KP(e,r,a),u=n[l];t&1<<l&&(u=Number.MAX_SAFE_INTEGER),s[a]=u}for(let a=0;a<s.length;a++){let l=o[a];s[a]<0&&(s[a]+=l),s[a]=Ad(0,s[a],o[a])}return s}function ZP(t,e,r){let n=t[e];return(r&1<<e||n==null)&&(n=1),n}function JP(t,e,r,n,o,s){let i=e[o],a=r[o]||1;(t&1<<o||s&1<<o||i==null)&&(a>0?i=Number.MIN_SAFE_INTEGER:i=Number.MAX_SAFE_INTEGER);let l=n[o];return i<0&&(i+=l),i=Ad(0,i,l-1),i}function eL(t,e,r,n,o,s){let i=e[o],a=r[o]||1;(t&1<<o||s&1<<o||i==null)&&(a>0?i=Number.MAX_SAFE_INTEGER:i=Number.MIN_SAFE_INTEGER);let l=n[o];return i<0&&(i+=l),a>0?i=Ad(0,i,l):i=Ad(-1,i,l-1),i}function oJ(t,e,r){let n=r.length;for(let o=0;o<r.length;o++)if(r[o]>1){n=o;break}for(let o=n+1;o<r.length;o++)if(e[o]>0||r[o]!==t[o])return!1;return!0}function sJ(t,e){let r=t.length>0?t[t.length-1]:1;for(let n=0;n<t.length-1;n++)r+=t[n]*e[n];return r}function c2(t,e,r){let n,o=t.shape.length;typeof e=="number"?n=[e,...new Array(o-1).fill(0)]:e.length<o?n=e.concat(new Array(o-e.length).fill(0)):n=e.slice(),n.forEach(i=>{D(i!==-1,()=>"slice() does not support negative begin indexing.")});let s;return r==null?s=new Array(o).fill(-1):typeof r=="number"?s=[r,...new Array(o-1).fill(-1)]:r.length<o?s=r.concat(new Array(o-r.length).fill(-1)):s=r,s=s.map((i,a)=>i>=0?i:(D(i===-1,()=>`Negative size values should be exactly -1 but got ${i} for the slice() size at index ${a}.`),t.shape[a]-n[a])),[n,s]}function iJ(t,e,r,n,o,s,i,a,l){let u;if(n==null?(u=new Array(e.length),u.fill(1)):u=n,i!=null&&(i&i-1)!==0)throw new Error("Multiple ellipses in slice is not allowed.");let c=!1,p={dims:u.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:r.slice(),strides:u.slice(),beginMask:o,endMask:s,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:l};for(let b=0;b<p.dims;b++)c&&(1<<b&a)!==0&&p.numAddAxisAfterEllipsis++,1<<b&i&&(c=!0);c||(p.ellipsisMask|=1<<p.dims,p.dims++);let f={dims:t.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};aJ(p,f);let d=!0,m=!0,h=!0,x=[],g=[];for(let b=0;b<t.length;++b){if(f.strides[b]===0)throw Error(`strides[${b}] must be non-zero`);let v=!!(f.shrinkAxisMask&1<<b),C=t[b];if(C===-1){x.push(v?1:-1);continue}let S=[f.beginMask&1<<b,f.endMask&1<<b],k=[f.strides[b]>0?0:-1,f.strides[b]>0?C:C-1];if(v&&f.strides[b]<=0)throw Error("only stride 1 allowed on non-range indexing.");h=h&&f.strides[b]===1;let I=!!(f.beginMask&1<<b&&f.endMask&1<<b);if(f.beginValid&&f.endValid){if(v){let j=f.begin[b]<0?C+f.begin[b]:f.begin[b];if(f.begin[b]=j,f.end[b]=f.begin[b]+1,j<0||j>=C)throw Error(`slice index ${f.begin[b]} of dimension ${b} out of bounds.`)}else f.begin[b]=qP(f.begin[b],0,f.strides[b],C,S,k),f.end[b]=qP(f.end[b],1,f.strides[b],C,S,k);let O=f.strides[b]===1&&f.begin[b]===0&&f.end[b]===C;d=d&&O,m=m&&(b===0&&f.strides[b]===1||O)}else d=d&&f.strides[b]===1&&I,m=m&&(b===0&&f.strides[b]===1||I);let A,$=!1;if(f.beginValid&&f.endValid?(A=f.end[b]-f.begin[b],$=!0):v?(A=1,$=!0):I&&C>=0&&(f.strides[b]<0?A=-C:A=C,$=!0),$){let O;A===0||A<0!=f.strides[b]<0?O=0:O=Math.trunc(A/f.strides[b])+(A%f.strides[b]!==0?1:0),x.push(O)}else x.push(-1)}for(let b=0;b<f.finalShapeGatherIndices.length;++b){let v=f.finalShapeGatherIndices[b];v>=0?g.push(x[v]):v===u2&&g.push(1)}return{finalShapeSparse:g.filter((b,v)=>f.finalShapeGatherIndices[v]!==u2),finalShape:g,isIdentity:d,sliceDim0:m,isSimpleSlice:h,begin:f.begin,end:f.end,strides:f.strides}}function aJ(t,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let r=0;e.beginValid=t.begin!=null,e.endValid=t.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let n=0;n<t.dims;n++)if(1<<n&t.ellipsisMask){let o=Math.min(e.dims-(t.dims-n)+1+t.numAddAxisAfterEllipsis,e.dims);for(;r<o;r++)e.begin[r]=0,e.end[r]=0,e.strides[r]=1,e.beginMask|=1<<r,e.endMask|=1<<r,e.finalShapeGatherIndices.push(r),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[r]=n}else if(1<<n&t.newAxisMask)e.finalShapeGatherIndices.push(u2),e.finalShapeGatherIndicesSparse.push(-1);else{if(r===e.begin.length)throw Error(`Index out of range using input dim ${r}; input has only ${e.dims} dims, ${e.begin.length}.`);t.begin!=null&&(e.begin[r]=t.begin[n]),t.end!=null&&(e.end[r]=t.end[n]),e.strides[r]=t.strides[n],t.beginMask&1<<n&&(e.beginMask|=1<<r),t.endMask&1<<n&&(e.endMask|=1<<r),t.shrinkAxisMask&1<<n?(e.finalShapeGatherIndices.push(JZ),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<r):(e.finalShapeGatherIndices.push(r),e.finalShapeGatherIndicesSparse.push(n)),e.inputShapeGatherIndicesSparse[r]=n,r++}}function qP(t,e,r,n,o,s){if(o[e])return r>0?s[e]:s[e+1&1];{let i=t<0?n+t:t;return i<s[0]?s[0]:i>s[1]?s[1]:i}}var J={};qo(J,{Serializable:()=>Ax,SerializationMap:()=>Gi,registerClass:()=>oo});var Ax=class{getClassName(){return this.constructor.className}static fromConfig(e,r){return new e(r)}},Gi=class{constructor(){this.classNameMap={}}static getMap(){return Gi.instance==null&&(Gi.instance=new Gi),Gi.instance}static register(e){Gi.getMap().classNameMap[e.className]=[e,e.fromConfig]}};function oo(t){D(t.className!=null,()=>"Class being registered does not have the static className property defined."),D(typeof t.className=="string",()=>"className is required to be a string, but got type "+typeof t.className),D(t.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),Gi.register(t)}function lJ(t,e){let r=N(t,"a","add"),n=N(e,"b","add");[r,n]=Ye(r,n);let o={a:r,b:n};return E.runKernel(ri,o)}var te=_({add_:lJ});function uJ(t,e){let r=N(t,"a","floorDiv"),n=N(e,"b","floorDiv");[r,n]=Ye(r,n);let o={a:r,b:n};return E.runKernel(La,o)}var w1=_({floorDiv_:uJ});function cJ(t,e){let r=N(t,"a","div"),n=N(e,"b","div");if([r,n]=Ye(r,n),r.dtype==="int32"&&n.dtype==="int32")return w1(r,n);let o={a:r,b:n},s={};return E.runKernel(Da,o,s)}var xe=_({div_:cJ});function pJ(t,e){let r=N(t,"a","mul"),n=N(e,"b","mul");[r,n]=Ye(r,n);let o={a:r,b:n};return E.runKernel(ja,o)}var L=_({mul_:pJ});function fJ(t){let e=N(t,"x","abs");if(e.dtype==="complex64"){let r={x:e};return E.runKernel(Tu,r)}else{let r={x:e};return E.runKernel(yu,r)}}var Sr=_({abs_:fJ});function dJ(t){let r={x:N(t,"x","acos")};return E.runKernel(va,r)}var p2=_({acos_:dJ});function mJ(t){let r={x:N(t,"x","acosh")};return E.runKernel(wa,r)}var f2=_({acosh_:mJ});function hJ(t,e=null,r=!1){let o={x:N(t,"x","all","bool")},s={axis:e,keepDims:r};return E.runKernel(Ld,o,s)}var Dx=_({all_:hJ});function gJ(t,e=null,r=!1){let o={x:N(t,"x","any","bool")},s={axis:e,keepDims:r};return E.runKernel(Md,o,s)}var Rm=_({any_:gJ});function xJ(t,e=0){let n={x:N(t,"x","argMax")},o={axis:e};return E.runKernel(bu,n,o)}var xl=_({argMax_:xJ});function yJ(t,e=0){let n={x:N(t,"x","argMin")},o={axis:e};return E.runKernel(vu,n,o)}var tL=_({argMin_:yJ});function bJ(t){let r={x:N(t,"x","asin")};return E.runKernel(Ca,r)}var d2=_({asin_:bJ});function vJ(t){let r={x:N(t,"x","asinh")};return E.runKernel(Sa,r)}var m2=_({asinh_:vJ});function wJ(t){let r={x:N(t,"x","atan")};return E.runKernel(ka,r)}var h2=_({atan_:wJ});function CJ(t,e){let r=N(t,"a","atan2"),n=N(e,"b","atan2");[r,n]=Ye(r,n);let o={a:r,b:n};return E.runKernel(Na,o)}var rL=_({atan2_:CJ});function SJ(t){let r={x:N(t,"x","atanh")};return E.runKernel(Ta,r)}var g2=_({atanh_:SJ});function kJ(t,e,r,n,o="NHWC",s){let i=t[3],a=[...e,i],l=oL(o);return Xp(t,a,r,s,n,null,null,l)}function y2(t,e,r,n,o,s,i="channelsLast"){let[a,l]=C1(e),u;if(i==="channelsLast")u=[a,l,t[3],t[3]];else if(i==="channelsFirst")u=[a,l,t[1],t[1]];else throw new Error(`Unknown dataFormat ${i}`);return Xp(t,u,r,n,o,s,!1,i)}function TJ(t,e,r,n,o,s,i="NDHWC"){let[a,l,u]=x2(e),c,p;if(i==="NDHWC")p="channelsLast",c=[a,l,u,t[4],t[4]];else if(i==="NCDHW")p="channelsFirst",c=[a,l,u,t[1],t[1]];else throw new Error(`Unknown dataFormat ${i}`);return nL(t,c,r,n,o,!1,p,s)}function Xp(t,e,r,n,o,s,i=!1,a="channelsLast"){let[l,u,c,p]=[-1,-1,-1,-1];if(a==="channelsLast")[l,u,c,p]=t;else if(a==="channelsFirst")[l,p,u,c]=t;else throw new Error(`Unknown dataFormat ${a}`);let[f,d,,m]=e,[h,x]=C1(r),[g,y]=C1(n),b=Om(f,g),v=Om(d,y),{padInfo:C,outHeight:S,outWidth:k}=EJ(o,u,c,h,x,b,v,s,a),I=i?m*p:m,A;return a==="channelsFirst"?A=[l,I,S,k]:a==="channelsLast"&&(A=[l,S,k,I]),{batchSize:l,dataFormat:a,inHeight:u,inWidth:c,inChannels:p,outHeight:S,outWidth:k,outChannels:I,padInfo:C,strideHeight:h,strideWidth:x,filterHeight:f,filterWidth:d,effectiveFilterHeight:b,effectiveFilterWidth:v,dilationHeight:g,dilationWidth:y,inShape:t,outShape:A,filterShape:e}}function nL(t,e,r,n,o,s=!1,i="channelsLast",a){let[l,u,c,p,f]=[-1,-1,-1,-1,-1];if(i==="channelsLast")[l,u,c,p,f]=t;else if(i==="channelsFirst")[l,f,u,c,p]=t;else throw new Error(`Unknown dataFormat ${i}`);let[d,m,h,,x]=e,[g,y,b]=x2(r),[v,C,S]=x2(n),k=Om(d,v),I=Om(m,C),A=Om(h,S),{padInfo:$,outDepth:O,outHeight:j,outWidth:H}=_J(o,u,c,p,g,y,b,k,I,A,a),Y=s?x*f:x,B;return i==="channelsFirst"?B=[l,Y,O,j,H]:i==="channelsLast"&&(B=[l,O,j,H,Y]),{batchSize:l,dataFormat:i,inDepth:u,inHeight:c,inWidth:p,inChannels:f,outDepth:O,outHeight:j,outWidth:H,outChannels:Y,padInfo:$,strideDepth:g,strideHeight:y,strideWidth:b,filterDepth:d,filterHeight:m,filterWidth:h,effectiveFilterDepth:k,effectiveFilterHeight:I,effectiveFilterWidth:A,dilationDepth:v,dilationHeight:C,dilationWidth:S,inShape:t,outShape:B,filterShape:e}}function NJ(t,e,r,n,o){n==null&&(n=b2(t,e,r));let s=t[0],i=t[1],a=Kp((s-e+2*n)/r+1,o),l=Kp((i-e+2*n)/r+1,o);return[a,l]}function IJ(t,e,r,n,o,s){o==null&&(o=b2(t,e,n));let i=t[0],a=t[1],l=t[2],u=Kp((i-e+2*o)/n+1,s),c=Kp((a-e+2*o)/n+1,s),p=Kp((l-e+2*o)/n+1,s);return[u,c,p,r]}function b2(t,e,r,n=1){let o=Om(e,n);return Math.floor((t[0]*(r-1)-r+o)/2)}function C1(t){return typeof t=="number"?[t,t,t]:t.length===2?[t[0],t[1],1]:t}function x2(t){return typeof t=="number"?[t,t,t]:t}function Om(t,e){return e<=1?t:t+(t-1)*(e-1)}function EJ(t,e,r,n,o,s,i,a,l){let u,c,p;if(typeof t=="number"){u={top:t,bottom:t,left:t,right:t,type:t===0?"VALID":"NUMBER"};let d=NJ([e,r],s,n,t,a);c=d[0],p=d[1]}else if(t==="same"){c=Math.ceil(e/n),p=Math.ceil(r/o);let f=Math.max(0,(c-1)*n+s-e),d=Math.max(0,(p-1)*o+i-r),m=Math.floor(f/2),h=f-m,x=Math.floor(d/2),g=d-x;u={top:m,bottom:h,left:x,right:g,type:"SAME"}}else if(t==="valid")u={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((e-s+1)/n),p=Math.ceil((r-i+1)/o);else if(typeof t=="object"){let f=l==="channelsLast"?t[1][0]:t[2][0],d=l==="channelsLast"?t[1][1]:t[2][1],m=l==="channelsLast"?t[2][0]:t[3][0],h=l==="channelsLast"?t[2][1]:t[3][1];u={top:f,bottom:d,left:m,right:h,type:f===0&&d===0&&m===0&&h===0?"VALID":"EXPLICIT"},c=Kp((e-s+f+d)/n+1,a),p=Kp((r-i+m+h)/o+1,a)}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:u,outHeight:c,outWidth:p}}function _J(t,e,r,n,o,s,i,a,l,u,c){let p,f,d,m;if(typeof t=="number"){p={top:t,bottom:t,left:t,right:t,front:t,back:t,type:t===0?"VALID":"NUMBER"};let x=IJ([e,r,n,1],a,1,o,t,c);f=x[0],d=x[1],m=x[2]}else if(t==="same"){f=Math.ceil(e/o),d=Math.ceil(r/s),m=Math.ceil(n/i);let h=(f-1)*o+a-e,x=(d-1)*s+l-r,g=(m-1)*i+u-n,y=Math.floor(h/2),b=h-y,v=Math.floor(x/2),C=x-v,S=Math.floor(g/2),k=g-S;p={top:v,bottom:C,left:S,right:k,front:y,back:b,type:"SAME"}}else if(t==="valid")p={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},f=Math.ceil((e-a+1)/o),d=Math.ceil((r-l+1)/s),m=Math.ceil((n-u+1)/i);else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:p,outDepth:f,outHeight:d,outWidth:m}}function Kp(t,e){if(!e)return Math.trunc(t);switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error(`Unknown roundingMode ${e}`)}}function Xo(t){let[e,r,n]=C1(t);return e===1&&r===1&&n===1}function on(t,e){return Xo(t)||Xo(e)}function oL(t){if(t==="NHWC")return"channelsLast";if(t==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${t}`)}function It(t,e,r){if(r!=null){if(typeof e=="string")throw Error(`Error in ${t}: pad must be an integer when using dimRoundingMode ${r} but got pad ${e}.`);if(typeof e=="number")D(ba(e),()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${r} but got pad ${e}.`);else if(typeof e=="object")e.forEach(n=>{n.forEach(o=>{D(ba(o),()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${r} but got pad ${o}.`)})});else throw Error(`Error in ${t}: Unknown padding parameter: ${e}`)}}function AJ(t,e){let n={x:N(t,"x","reshape","string_or_numeric")},o={shape:e};return E.runKernel(Qu,n,o)}var M=_({reshape_:AJ});function DJ(t,e,r,n,o){let s=N(t,"x","avgPool","float32"),i=1;D(on(r,i),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${r} and dilations '${i}'`);let a=s,l=!1;s.rank===3&&(l=!0,a=M(s,[1,s.shape[0],s.shape[1],s.shape[2]])),D(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),It("avgPool",n,o);let u={x:a},c={filterSize:e,strides:r,pad:n,dimRoundingMode:o},p=E.runKernel(wu,u,c);return p=oe(p,s.dtype),l?M(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var Yp=_({avgPool_:DJ});function $J(t,e,r,n,o,s="NDHWC"){let i=N(t,"x","avgPool3d","float32"),a=i,l=!1;i.rank===4&&(l=!0,a=M(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),D(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),D(s==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${s}`),It("avgPool3d",n,o);let u={x:a},c={filterSize:e,strides:r,pad:n,dimRoundingMode:o,dataFormat:s},p=E.runKernel(Cu,u,c);return p=oe(p,a.dtype),l?M(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}var v2=_({avgPool3d_:$J});function RJ(t,e=0){D(t.length>=1,()=>"Pass at least one tensor to concat");let r=u1(t,"tensors","concat","string_or_numeric");if(r[0].dtype==="complex64"&&r.forEach(s=>{if(s.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${s.dtype}. `)}),r.length===1)return To(r[0]);let n=r,o={axis:e};return E.runKernel(Nu,n,o)}var Ot=_({concat_:RJ});function OJ(t){let r={x:N(t,"x","sigmoid","float32")};return E.runKernel(ol,r)}var bs=_({sigmoid_:OJ});function FJ(t,e,r){let n=N(t,"x","slice","string_or_numeric");if(n.rank===0)throw new Error("Slicing scalar is not possible");let o={x:n},s={begin:e,size:r};return E.runKernel(rc,o,s)}var tt=_({slice_:FJ});function PJ(t){let r={x:N(t,"x","tanh","float32")};return E.runKernel(cl,r)}var Fm=_({tanh_:PJ});function LJ(t,e,r){let n=N(t,"x","batchToSpaceND"),o=e.reduce((a,l)=>a*l);D(n.rank>=1+e.length,()=>`input rank is ${n.rank} but should be > than blockShape.length ${e.length}`),D(r.length===e.length,()=>`crops.length is ${r.length} but should be equal to blockShape.length  ${e.length}`),D(n.shape[0]%o===0,()=>`input tensor batch is ${n.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${o}`);let s={x:n},i={blockShape:e,crops:r};return E.runKernel(ku,s,i)}var Pm=_({batchToSpaceND_:LJ});function sL(t){let e;return t.rank===0||t.rank===1?e=M(t,[1,1,1,t.size]):t.rank===2?e=M(t,[1,1,t.shape[0],t.shape[1]]):t.rank===3?e=M(t,[1,t.shape[0],t.shape[1],t.shape[2]]):e=t,e}function MJ(t,e,r,n,o,s){s==null&&(s=.001);let i=N(t,"x","batchNorm"),a=N(e,"mean","batchNorm"),l=N(r,"variance","batchNorm"),u;o!=null&&(u=N(o,"scale","batchNorm"));let c;n!=null&&(c=N(n,"offset","batchNorm")),D(a.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),D(c==null||a.rank===c.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),D(u==null||a.rank===u.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let f={x:sL(i),scale:u,offset:c,mean:a,variance:l},d={varianceEpsilon:s},m=E.runKernel(Ou,f,d);return M(m,i.shape)}var mc=_({batchNorm_:MJ});function zJ(t,e,r,n,o,s){let i=N(t,"x","batchNorm"),a=N(e,"mean","batchNorm"),l=N(r,"variance","batchNorm"),u;o!=null&&(u=N(o,"scale","batchNorm"));let c;return n!=null&&(c=N(n,"offset","batchNorm")),D(i.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${i.rank}.`),D(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),D(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),u!=null&&D(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${u.rank}.`),c!=null&&D(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${c.rank}.`),mc(i,a,l,c,u,s)}var w2=_({batchNorm2d_:zJ});function BJ(t,e,r,n,o,s){let i=N(t,"x","batchNorm"),a=N(e,"mean","batchNorm"),l=N(r,"variance","batchNorm"),u;o!=null&&(u=N(o,"scale","batchNorm"));let c;return n!=null&&(c=N(n,"offset","batchNorm")),D(i.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${i.rank}.`),D(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),D(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),u!=null&&D(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${u.rank}.`),c!=null&&D(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${c.rank}.`),mc(i,a,l,c,u,s)}var C2=_({batchNorm3d_:BJ});function VJ(t,e,r,n,o,s){let i=N(t,"x","batchNorm"),a=N(e,"mean","batchNorm"),l=N(r,"variance","batchNorm"),u;o!=null&&(u=N(o,"scale","batchNorm"));let c;return n!=null&&(c=N(n,"offset","batchNorm")),D(i.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${i.rank}.`),D(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),D(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),u!=null&&D(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${u.rank}.`),c!=null&&D(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${c.rank}.`),mc(i,a,l,c,u,s)}var S2=_({batchNorm4d_:VJ});function WJ(t,e,r){let n=N(t,"x","bincount"),o=N(e,"weights","bincount");D(n.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${n.dtype}`),D(r>=0,()=>`size must be non-negative, but got ${r}.`),D(o.size===n.size||o.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${n.shape}, weights shape: ${o.shape}.`);let s={x:n,weights:o},i={size:r};return E.runKernel(Vd,s,i)}var iL=_({bincount_:WJ});function GJ(t,e){let r=N(t,"broadcastTo","x"),n=r.shape;if(tn(e),e.length<r.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${r.rank}.`);if(e.length>r.rank){let u=r.shape.slice();for(;u.length<e.length;)u.unshift(1);r=M(r,u)}let o=r.shape,s=Array.from(e);for(let u=e.length-1;u>=0;u--)if(o[u]===e[u])s[u]=1;else if(r.shape[u]!==1)throw new Error(`broadcastTo(): [${n}] cannot be broadcast to [${e}].`);if(s.map((u,c)=>u>1?c:-1).filter(u=>u>=0).length===0)return To(r);let a={x:r},l={reps:s};return E.runKernel(Pi,a,l)}var yl=_({broadcastTo_:GJ});function UJ(t){let r={x:N(t,"x","ceil","float32")};return E.runKernel(Ia,r)}var k2=_({ceil_:UJ});function bl(t,e,r){tn(t);let n={shape:t,value:e,dtype:r};return E.runKernel(tm,{},n)}function HJ(t,e,r){let n=N(t,"x","clipByValue");if(D(e<=r,()=>`Error in clip: min (${e}) must be less than or equal to max (${r}).`),e===r)return bl(n.shape,e,n.dtype);let o={x:n},s={clipValueMin:e,clipValueMax:r};return E.runKernel(Ea,o,s)}var sn=_({clipByValue_:HJ});function qJ(t){return Ot(t,0)}var T2=_({concat1d_:qJ});function jJ(t,e){return Ot(t,e)}var N2=_({concat2d_:jJ});function KJ(t,e){return Ot(t,e)}var I2=_({concat3d_:KJ});function XJ(t,e){return Ot(t,e)}var E2=_({concat4d_:XJ});function YJ(t,e,r,n,o="NHWC",s=[1,1],i){let a=N(t,"x","conv2d","float32"),l=N(e,"filter","conv2d","float32"),u=a,c=!1;a.rank===3&&(c=!0,u=M(a,[1,a.shape[0],a.shape[1],a.shape[2]])),D(u.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${u.rank}.`),D(l.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),It("conv2d",n,i);let p=o==="NHWC"?u.shape[3]:u.shape[1];D(p===l.shape[2],()=>`Error in conv2d: depth of input (${p}) must match input depth for filter ${l.shape[2]}.`),D(on(r,s),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${r} and dilations '${s}'`);let f={x:u,filter:l},d={strides:r,pad:n,dataFormat:o,dilations:s,dimRoundingMode:i},m=E.runKernel(Iu,f,d);return c?M(m,[m.shape[1],m.shape[2],m.shape[3]]):m}var Io=_({conv2d_:YJ});function QJ(t,e,r,n,o="NWC",s=1,i){let a=N(t,"x","conv1d"),l=N(e,"filter","conv1d"),u=a,c=!1;a.rank===2&&(c=!0,u=M(a,[1,a.shape[0],a.shape[1]])),D(u.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${u.rank}.`),D(l.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),It("conv1d",n,i),D(u.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${u.shape[2]}) must match input depth for filter ${l.shape[1]}.`),D(on(r,s),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${r} and dilation '${s}'`),D(o==="NWC",()=>`Error in conv1d: got dataFormat of ${o} but only NWC is currently supported.`);let p=M(l,[1,l.shape[0],l.shape[1],l.shape[2]]),f=M(u,[u.shape[0],1,u.shape[1],u.shape[2]]),x=Io(f,p,[1,r],n,"NHWC",[1,s],i);return c?M(x,[x.shape[2],x.shape[3]]):M(x,[x.shape[0],x.shape[2],x.shape[3]])}var $x=_({conv1d_:QJ});function ZJ(t,e,r,n,o,s="NHWC",i){D(t.length===e.rank,()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`);let a=t,l=e,u=!1;e.rank===3&&(u=!0,l=M(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,t[0],t[1],t[2]]),D(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),D(l.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),D(r.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${r.rank}`);let c=s==="NHWC"?a[3]:a[1],p=s==="NHWC"?l.shape[3]:l.shape[1];D(c===r.shape[2],()=>`Error in conv2dDerInput: depth of input (${c}) must match input depth for filter ${r.shape[2]}.`),D(p===r.shape[3],()=>`Error in conv2dDerInput: depth of output (${p}) must match output depth for filter ${r.shape[3]}.`),It("conv2dDerInput",o,i);let f={dy:l,filter:r},d={strides:n,pad:o,dataFormat:s,dimRoundingMode:i,inputShape:a},m=E.runKernel(Eu,f,d);return u?M(m,[m.shape[1],m.shape[2],m.shape[3]]):m}var Lm=_({conv2DBackpropInput_:ZJ});function JJ(t,e,r,n,o,s){let i=N(t,"x","conv2dTranspose"),a=N(e,"filter","conv2dTranspose");return Lm(r,i,a,n,o,"NHWC",s)}var Rx=_({conv2dTranspose_:JJ});function eee(t,e,r,n,o="NDHWC",s=[1,1,1]){let i=N(t,"x","conv3d"),a=N(e,"filter","conv3d"),l=i,u=!1;i.rank===4&&(u=!0,l=M(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),D(l.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),D(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),D(l.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${a.shape[3]}.`),D(on(r,s),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${r} and dilations '${s}'`),D(o==="NDHWC",()=>`Error in conv3d: got dataFormat of ${o} but only NDHWC is currently supported.`);let c={x:l,filter:a},p={strides:r,pad:n,dataFormat:o,dilations:s},f=E.runKernel(_u,c,p);return u?M(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var _2=_({conv3d_:eee});function tee(t,e,r,n,o){D(t.length===e.rank,()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`);let s=t,i=e,a=!1;e.rank===4&&(a=!0,i=M(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),s=[1,t[0],t[1],t[2],t[3]]);let l=s[4],u=i.shape[4];D(s.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${s.length}.`),D(i.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${i.rank}`),D(r.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${r.rank}`),D(l===r.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${r.shape[3]}.`),D(u===r.shape[4],()=>`Error in conv3dDerInput: depth of output (${u}) must match output depth for filter ${r.shape[4]}.`);let c={dy:i,filter:r},p={pad:o,strides:n,inputShape:s},f=E.runKernel(Hd,c,p);return a?M(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var S1=_({conv3DBackpropInput_:tee});function ree(t,e,r,n,o){let s=N(t,"x","conv3dTranspose"),i=N(e,"filter","conv3dTranspose");return S1(r,s,i,n,o)}var A2=_({conv3dTranspose_:ree});function nee(t){let r={x:N(t,"x","cos","float32")};return E.runKernel(_a,r)}var Qp=_({cos_:nee});function oee(t){let r={x:N(t,"x","cosh","float32")};return E.runKernel(Aa,r)}var Ox=_({cosh_:oee});function see(t,e=0,r=!1,n=!1){let s={x:N(t,"x","cumprod")},i={axis:e,exclusive:r,reverse:n};return E.runKernel(qd,s,i)}var Fx=_({cumprod_:see});function iee(t,e=0,r=!1,n=!1){let s={x:N(t,"x","cumsum")},i={axis:e,exclusive:r,reverse:n};return E.runKernel(Au,s,i)}var k1=_({cumsum_:iee});function aee(t,e,r,n=!1){let o=N(t,"x","denseBincount"),s=N(e,"weights","denseBincount");D(o.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${o.dtype}`),D(o.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${o.rank}.`),D(r>=0,()=>`size must be non-negative, but got ${r}.`),D(s.size===o.size||s.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${o.shape}, weights shape: ${s.shape}.`);let i={x:o,weights:s},a={size:r,binaryOutput:n};return E.runKernel(Kd,i,a)}var T1=_({denseBincount_:aee});function lee(t,e,r="NHWC"){let n=N(t,"x","depthToSpace","float32"),o=r==="NHWC"?n.shape[1]:n.shape[2],s=r==="NHWC"?n.shape[2]:n.shape[3],i=r==="NHWC"?n.shape[3]:n.shape[1];D(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),D(o*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${o} and ${e}  for depthToSpace with input shape
    ${n.shape}`),D(s*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${s} and ${e} for depthToSpace with input shape
        ${n.shape}`),D(i%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${i} for depthToSpace with input shape ${n.shape}`);let a={x:n},l={blockSize:e,dataFormat:r};return E.runKernel(Xd,a,l)}var aL=_({depthToSpace_:lee});function uee(t,e,r,n,o="NHWC",s=[1,1],i){let a=N(t,"x","depthwiseConv2d","float32"),l=N(e,"filter","depthwiseConv2d","float32"),u=a,c=!1;a.rank===3&&(c=!0,u=M(a,[1,a.shape[0],a.shape[1],a.shape[2]])),D(u.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${u.rank}.`),D(l.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`);let p=o==="NHWC"?u.shape[3]:u.shape[1];D(p===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${p}) must match the inChannels dimension in filter ${l.shape[2]}.`),It("depthwiseConv2d",n,i);let f={x:u,filter:l},d={strides:r,pad:n,dataFormat:o,dilations:s,dimRoundingMode:i},m=E.runKernel(Du,f,d);return c?M(m,[m.shape[1],m.shape[2],m.shape[3]]):m}var vl=_({depthwiseConv2d_:uee});function cee(t,e,r,n,o=[1,1],s="NHWC"){let i=N(t,"x","dilation2d"),a=N(e,"filter","dilation2d");D(i.rank===3||i.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${i.rank}.`),D(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),D(s==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${s}`);let l=i,u=!1;i.rank===3&&(l=M(i,[1,i.shape[0],i.shape[1],i.shape[2]]),u=!0);let c={x:l,filter:a},p={strides:r,pad:n,dilations:o},f=E.runKernel($u,c,p);return u?M(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var lL=_({dilation2d_:cee});function pee(t,e){let r=N(t,"a","equal","string_or_numeric"),n=N(e,"b","equal","string_or_numeric");[r,n]=Ye(r,n),Ve(r.shape,n.shape);let o={a:r,b:n};return E.runKernel(Ep,o)}var Un=_({equal_:pee});function fee(t,e,r){let n=N(e,"a","where"),o=N(r,"b","where"),s=N(t,"condition","where","bool"),i=Ve(Ve(s.shape,n.shape),o.shape),a=yl(s,i),l=yl(n,i),u=yl(o,i),c={condition:a,t:l,e:u};return E.runKernel(tc,c)}var Vt=_({where_:fee});function dee(t){let r={x:N(t,"x","zerosLike")};return E.runKernel(uc,r)}var Ee=_({zerosLike_:dee});function mee(t,e){let r=N(t,"a","div"),n=N(e,"b","div");[r,n]=Ye(r,n);let o=xe(r,n),s=Ee(o),i=Un(n,s);return Vt(i,s,o)}var uL=_({divNoNan_:mee});function hee(t,e){let r=N(t,"t1","dot"),n=N(e,"t2","dot");D((r.rank===1||r.rank===2)&&(n.rank===1||n.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${r.rank} and ${n.rank}.`);let o=r.rank===1?r.size:r.shape[1],s=n.rank===1?n.size:n.shape[0];if(D(o===s,()=>`Error in dot: inner dimensions of inputs must match, but got ${o} and ${s}.`),r.rank===1&&n.rank===1){let i=M(r,[1,-1]),a=M(n,[-1,1]),l=ot(i,a);return M(l,[])}else if(r.rank===1&&n.rank===2){let i=M(r,[1,-1]),a=M(n,[n.shape[0],n.shape[1]]),l=ot(i,a);return M(l,[l.size])}else if(r.rank===2&&n.rank===1){let i=M(n,[-1,1]),a=ot(r,i);return M(a,[a.size])}else{let i=M(n,[n.shape[0],n.shape[1]]);return ot(r,i)}}var cL=_({dot_:hee});function gee(t,...e){let r=e.map((o,s)=>N(o,`tensors${s}`,"einsum")),n={equation:t};return E.runKernel(Zd,r,n)}var Px=_({einsum_:gee});function xee(t){let r={x:N(t,"x","elu","float32")};return E.runKernel($a,r)}var wl=_({elu_:xee});function yee(t){let e=N(t,"x","erf");D(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=oe(e,"float32"));let r={x:e};return E.runKernel(Ra,r)}var D2=_({erf_:yee});function $2(t,e){for(let r=0;r<t.length;++r)if(t[t.length-r-1]!==e-1-r)return!1;return!0}function pL(t,e,r){let n=t.length+e.length,o=[],s=0,i=0;for(let a=0;a<n;a++)r.indexOf(a)===-1?o.push(t[s++]):o.push(e[i++]);return o}function R2(t,e){let r=[],n=t.length;for(let s=0;s<n;s++)e.indexOf(s)===-1&&r.push(t[s]);let o=e.map(s=>t[s]);return[r,o]}function Ui(t,e){let r=e.map(n=>1);return pL(t,r,e)}function bee(t,e,r){D($2(e,r),()=>`${t} supports only inner-most axes for now. Got axes ${e} and rank-${r} input.`)}function O2(t,e){if($2(t,e))return null;let r=[];for(let n=0;n<e;++n)t.indexOf(n)===-1&&r.push(n);return t.forEach(n=>r.push(n)),r}function Lx(t){return t.map((e,r)=>[r,e]).sort((e,r)=>e[1]-r[1]).map(e=>e[0])}function vee(t,e){let r=[];for(let n=e-t;n<e;++n)r.push(n);return r}function wee(t,e=null,r=!1){let o={x:N(t,"x","max")},s={reductionIndices:e,keepDims:r};return E.runKernel(Mu,o,s)}var an=_({max_:wee});function Cee(t,e=null,r=!1){let o={x:N(t,"x","min")},s={axis:e,keepDims:r};return E.runKernel(Wu,o,s)}var hc=_({min_:Cee});function See(t,e){let r=N(t,"base","pow"),n=N(e,"exp","pow");[r,n]=Ye(r,n);let o={a:r,b:n};return E.runKernel(Ka,o)}var vs=_({pow_:See});function Oe(t,e){if((Co(t)&&e!=="string"||Array.isArray(t))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Co(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return zi(t,[],[],e)}function kee(t){let r={x:N(t,"x","sqrt","float32")};return E.runKernel(il,r)}var Ft=_({sqrt_:kee});function Tee(t){let e=N(t,"x","square"),r={};return E.runKernel("Square",{x:e},r)}var Ke=_({square_:Tee});function Nee(t,e=null,r=!1){let n=N(t,"x","sum");n.dtype==="bool"&&(n=oe(n,"int32"));let o={x:n},s={axis:e,keepDims:r};return E.runKernel(nc,o,s)}var ye=_({sum_:Nee});function Iee(t,e="euclidean",r=null,n=!1){t=N(t,"x","norm");let o=fL(t,e,r),s=o.shape;if(n){let i=Dr(r,t.shape);s=Ui(o.shape,i)}return M(o,s)}function fL(t,e,r=null){if(t.rank===0)return Sr(t);if(t.rank!==1&&r===null)return fL(M(t,[-1]),e,r);if(t.rank===1||typeof r=="number"||Array.isArray(r)&&r.length===1){if(e===1)return ye(Sr(t),r);if(e===1/0)return an(Sr(t),r);if(e===-1/0)return hc(Sr(t),r);if(e==="euclidean"||e===2)return Ft(ye(vs(Sr(t),Oe(2,"int32")),r));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(r)&&r.length===2){if(e===1)return an(ye(Sr(t),r[0]),r[1]-1);if(e===1/0)return an(ye(Sr(t),r[1]),r[0]);if(e===-1/0)return hc(ye(Sr(t),r[1]),r[0]);if(e==="fro"||e==="euclidean")return Ft(ye(Ke(t),r));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${r}`)}var gc=_({norm_:Iee});function Eee(t,e=null,r=!1){return gc(t,"euclidean",e,r)}var dL=_({euclideanNorm_:Eee});function _ee(t){let r={x:N(t,"x","exp")};return E.runKernel(Oa,r)}var gn=_({exp_:_ee});function Aee(t,e=0){let r=N(t,"x","expandDims","string_or_numeric");D(e<=r.rank,()=>"Axis must be <= rank of the tensor");let n={input:r},o={dim:e};return E.runKernel(Ru,n,o)}var $r=_({expandDims_:Aee});function Dee(t){let r={x:N(t,"x","expm1")};return E.runKernel(Fa,r)}var P2=_({expm1_:Dee});function $ee(t,e){let r=N(t,"x","tile","string_or_numeric");D(r.rank===e.length,()=>`Error in transpose: rank of input ${r.rank} must match length of reps ${e}.`);let n={x:r},o={reps:e};return E.runKernel(Pi,n,o)}var xn=_({tile_:$ee});function Ree(t,e,r,n="float32"){e==null&&(e=t);let o=Ie([t,e],n),s=t<=e?t:e;for(let a=0;a<s;++a)o.set(1,a,a);let i=M(o.toTensor(),[t,e]);if(r==null)return i;if(r.length===1)return xn($r(i,0),[r[0],1,1]);if(r.length===2)return xn($r($r(i,0),0),[r[0],r[1],1,1]);if(r.length===3)return xn($r($r($r(i,0),0),0),[r[0],r[1],r[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${r.length}D.`)}var Mm=_({eye_:Ree});function Oee(t){let r={x:N(t,"x","floor","float32")};return E.runKernel(Pa,r)}var Cl=_({floor_:Oee});function Fee(t,e,r=0,n=0){let o=N(t,"x","gather"),s=N(e,"indices","gather","int32"),i={x:o,indices:s},a={axis:r,batchDims:n};return E.runKernel(Fu,i,a)}var Zp=_({gather_:Fee});function Pee(t,e){let r=N(t,"a","greater","string_or_numeric"),n=N(e,"b","greater","string_or_numeric");[r,n]=Ye(r,n),Ve(r.shape,n.shape);let o={a:r,b:n};return E.runKernel(_p,o)}var tr=_({greater_:Pee});function Lee(t,e){let r=N(t,"a","greaterEqual","string_or_numeric"),n=N(e,"b","greaterEqual","string_or_numeric");[r,n]=Ye(r,n),Ve(r.shape,n.shape);let o={a:r,b:n};return E.runKernel(Ma,o)}var so=_({greaterEqual_:Lee});function Mee(t){let r={x:N(t,"x","isFinite")};return E.runKernel(za,r)}var L2=_({isFinite_:Mee});function zee(t){let r={x:N(t,"x","isInf")};return E.runKernel(Ba,r)}var M2=_({isInf_:zee});function Bee(t){let r={x:N(t,"x","isNaN")};return E.runKernel(Va,r)}var z2=_({isNaN_:Bee});function Vee(t,e=.2){let n={x:N(t,"x","leakyRelu")},o={alpha:e};return E.runKernel(Pu,n,o)}var Jp=_({leakyRelu_:Vee});function Wee(t,e){let r=N(t,"a","less","string_or_numeric"),n=N(e,"b","less","string_or_numeric");[r,n]=Ye(r,n),Ve(r.shape,n.shape);let o={a:r,b:n};return E.runKernel(Ap,o)}var N1=_({less_:Wee});function Gee(t,e){let r=N(t,"a","lessEqual","string_or_numeric"),n=N(e,"b","lessEqual","string_or_numeric");[r,n]=Ye(r,n),Ve(r.shape,n.shape);let o={a:r,b:n};return E.runKernel(Dp,o)}var ws=_({lessEqual_:Gee});function Uee(t,e=5,r=1,n=1,o=.5){let s=N(t,"x","localResponseNormalization");D(s.rank===4||s.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${s.rank}.`),D(ba(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let i=s,a=!1;s.rank===3&&(a=!0,i=M(s,[1,s.shape[0],s.shape[1],s.shape[2]]));let l={x:i},u={depthRadius:e,bias:r,alpha:n,beta:o},c=E.runKernel(Lu,l,u);return a?M(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var mL=_({localResponseNormalization_:Uee});function Hee(t){let r={x:N(t,"x","log","float32")};return E.runKernel(Wa,r)}var Hn=_({log_:Hee});function qee(t){let r={x:N(t,"x","log1p")};return E.runKernel(Ga,r)}var Mx=_({log1p_:qee});function B2(t,e){D(Rd(t),()=>"The f passed in variableGrads(f) must be a function"),D(e==null||Array.isArray(e)&&e.every(u=>u instanceof fl),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");let r=e!=null;if(!r){e=[];for(let u in E.registeredVariables)e.push(E.registeredVariables[u])}let n=r?e.filter(u=>!u.trainable):null,o=e.length;e=e.filter(u=>u.trainable),D(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${o} variables is trainable.`);let s=!0,{value:i,grads:a}=E.gradients(t,e,null,s);D(a.some(u=>u!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),D(i.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${i.rank} tensor`);let l={};return e.forEach((u,c)=>{a[c]!=null&&(l[u.name]=a[c])}),n?.forEach(u=>l[u.name]=null),{value:i,grads:l}}function Qo(t){return E.customGrad(t)}function jee(t){let r={x:N(t,"x","softplus")};return E.runKernel(sl,r)}var Hi=_({softplus_:jee});function Kee(t){let e=N(t,"x","logSigmoid");return Qo(n=>({value:st(Hi(st(n))),gradFunc:i=>L(i,bs(st(n)))}))(e)}var V2=_({logSigmoid_:Kee});function Xee(t,e){let r=N(t,"a","sub"),n=N(e,"b","sub");[r,n]=Ye(r,n);let o={a:r,b:n};return E.runKernel(ll,o)}var Se=_({sub_:Xee});function Yee(t,e=-1){let r=N(t,"logits","logSoftmax");if(e===-1&&(e=r.rank-1),e!==r.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${r.rank} and axis was ${e}`);return Qo((o,s)=>{let a=an(o,e,!0),l=Se(o,a),u=Se(oe(l,"float32"),Hn(ye(gn(l),e,!0)));return s([u]),{value:u,gradFunc:(p,f)=>{let[d]=f,m=!0,h=gn(d);return Se(p,L(ye(p,e,m),h))}}})(r)}var zx=_({logSoftmax_:Yee});function Qee(t,e=null,r=!1){let n=N(t,"x","logSumExp"),o=Dr(e,n.shape),s=an(n,o,!0),i=Se(n,s),a=gn(i),l=ye(a,o),u=Hn(l),c=te(M(s,u.shape),u);if(r){let p=Ui(c.shape,o);return M(c,p)}return c}var hL=_({logSumExp_:Qee});function Zee(t,e){let r=N(t,"a","logicalAnd","bool"),n=N(e,"b","logicalAnd","bool");Ve(r.shape,n.shape);let o={a:r,b:n};return E.runKernel($p,o)}var _n=_({logicalAnd_:Zee});function Jee(t){let r={x:N(t,"x","logicalNot","bool")};return E.runKernel(Rp,r)}var zm=_({logicalNot_:Jee});function ete(t,e){let r=N(t,"a","logicalOr","bool"),n=N(e,"b","logicalOr","bool");Ve(r.shape,n.shape);let o={a:r,b:n};return E.runKernel(Op,o)}var I1=_({logicalOr_:ete});function tte(t,e){let r=N(t,"a","logicalXor","bool"),n=N(e,"b","logicalXor","bool");return Ve(r.shape,n.shape),_n(I1(t,e),zm(_n(t,e)))}var gL=_({logicalXor_:tte});function rte(t,e,r,n,o){let s=N(t,"x","maxPool"),i=1,a=s,l=!1;s.rank===3&&(l=!0,a=M(s,[1,s.shape[0],s.shape[1],s.shape[2]])),D(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),D(on(r,i),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${r} and dilations '${i}'`),It("maxPool",n,o);let u={x:a},c={filterSize:e,strides:r,pad:n,dimRoundingMode:o},p=E.runKernel(zu,u,c);return l?M(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var ef=_({maxPool_:rte});function nte(t,e=[1,1,1],r,n,o,s="NDHWC"){let i=N(t,"x","maxPool3d"),a=i,l=!1;i.rank===4&&(l=!0,a=M(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),D(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),D(s==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${s}`),It("maxPool3d",n,o);let u={x:a},c={filterSize:e,strides:r,pad:n,dimRoundingMode:o,dataFormat:s},p=E.runKernel(Bu,u,c);return l?M(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}var W2=_({maxPool3d_:nte});function ote(t,e){let r=N(t,"a","maximum"),n=N(e,"b","maximum");[r,n]=Ye(r,n),r.dtype==="bool"&&(r=oe(r,"int32"),n=oe(n,"int32")),Ve(r.shape,n.shape);let o={a:r,b:n};return E.runKernel(Ua,o)}var Eo=_({maximum_:ote});function ste(t,e=null,r=!1){let o={x:N(t,"x","mean")},s={axis:e,keepDims:r};return E.runKernel(Vu,o,s)}var Wt=_({mean_:ste});function Pt(t,e="float32"){if(tn(t),e==="complex64"){let n=Pt(t,"float32"),o=Pt(t,"float32");return Ko(n,o)}let r=Fd(at(t),e);return E.makeTensor(r,t,e)}function _o(t,e="float32"){if(tn(t),e==="complex64"){let n=_o(t,"float32"),o=Pt(t,"float32");return Ko(n,o)}let r=fx(at(t),e);return E.makeTensor(r,t,e)}function ite(t,e){let r=N(t,"a","minimum"),n=N(e,"b","minimum");[r,n]=Ye(r,n),r.dtype==="bool"&&(r=oe(r,"int32"),n=oe(n,"int32")),Ve(r.shape,n.shape);let o={a:r,b:n};return E.runKernel(Ha,o)}var tf=_({minimum_:ite});function ate(t,e,r){D(r==="reflect"||r==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${r}.`);let n=N(t,"x","mirrorPad");if(n.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");D(e.length===n.rank,()=>`Padding doesn't match input. Must be ${n.rank}. Got ${e.length}.`);let o=r==="reflect"?1:0;for(let a=0;a<n.rank;a++)D(e[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),D(e[a][0]>=0&&e[a][0]<=n.shape[a]-o&&e[a][1]>=0&&e[a][1]<=n.shape[a]-o,()=>`Padding in dimension ${a} cannot be greater than or equal to ${n.shape[a]-o} or less than 0 for input of shape ${n.shape}`);let s={paddings:e,mode:r},i={x:n};return E.runKernel(Gu,i,s)}var xL=_({mirrorPad_:ate});function lte(t,e){let r=N(t,"a","mod"),n=N(e,"b","mod");[r,n]=Ye(r,n);let o={a:r,b:n};return E.runKernel(qa,o)}var yL=_({mod_:lte});function ute(t,e=null,r=!1){t=N(t,"x","moments");let n=Dr(e,t.shape),o=Wt(t,n,r),s=o.shape;r||(s=Ui(o.shape,n));let i=Ke(Se(oe(t,"float32"),M(o,s))),a=Wt(i,n,r);return{mean:o,variance:a}}var Bm=_({moments_:ute});function cte(t,e){let r=N(t,"a","notEqual","string_or_numeric"),n=N(e,"b","notEqual","string_or_numeric");[r,n]=Ye(r,n),Ve(r.shape,n.shape);let o={a:r,b:n};return E.runKernel(Fp,o)}var xc=_({notEqual_:cte});function pte(t){let r={x:N(t,"x","onesLike")};return E.runKernel(Hu,r)}var qr=_({onesLike_:pte});function fte(t,e,r=0){let n=N(t,"x","pad");if(n.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");let o={paddings:e,constantValue:r},s={x:n};return E.runKernel(Ku,s,o)}var rf=_({pad_:fte});function dte(t,e,r){let n=N(t,"x","spaceToBatchND");D(n.rank>=1+e.length,()=>`input rank ${n.rank} should be > than [blockShape] ${e.length}`),D(r.length===e.length,()=>`paddings.shape[0] ${r.length} must be equal to [blockShape] ${e.length}`),D(n.shape.reduce((i,a,l)=>l>0&&l<=e.length?i&&(a+r[l-1][0]+r[l-1][1])%e[l-1]===0:i,!0),()=>`input spatial dimensions ${n.shape.slice(1)} with paddings ${r.toString()} must be divisible by blockShapes ${e.toString()}`);let o={x:n},s={blockShape:e,paddings:r};return E.runKernel(oc,o,s)}var Vm=_({spaceToBatchND_:dte});function mte(t,e,r,n,o,s,i){o==null&&(o=[1,1]),s==null&&(s=1),n===0&&(n="valid");let a=N(t,"x","maxPool"),l=a,u=!1;a.rank===3&&(u=!0,l=M(a,[1,a.shape[0],a.shape[1],a.shape[2]])),D(on(s,o),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${s} and dilations '${o}'`);let c=y2(l.shape,e,s,o,n),p=[c.dilationHeight,c.dilationWidth],f;n==="same"?f=gte([c.filterHeight,c.filterWidth],p):f=[[0,0],[0,0]];let d=p[0]===1&&p[1]===1,[m,h]=hte([c.inHeight,c.inWidth],p,f),x=d?n:"valid",g=d?l:Vm(l,p,m),b=(r==="avg"?()=>Yp(g,e,s,x,i):()=>ef(g,e,s,x,i))(),v=d?b:Pm(b,p,h);return u?M(v,[v.shape[1],v.shape[2],v.shape[3]]):v}function hte(t,e,r){let n=r.map(c=>c[0]),o=r.map(c=>c[1]),s=t.concat(n,o),i=e.map((c,p)=>(c-s[p]%c)%c),a=o.map((c,p)=>c+i[p]),l=e.map((c,p)=>[n[p],a[p]]),u=e.map((c,p)=>[0,i[p]]);return[l,u]}function gte(t,e){let n=t.map((i,a)=>i+(i-1)*(e[a]-1)).map(i=>i-1),o=n.map(i=>Math.floor(i/2)),s=n.map((i,a)=>i-o[a]);return n.map((i,a)=>[o[a],s[a]])}var bL=_({pool_:mte});function xte(t,e){let r=N(t,"x","prelu"),n=N(e,"alpha","prelu"),o={x:r,alpha:n};return E.runKernel(Xu,o)}var nf=_({prelu_:xte});function yte(t,e=null,r=!1){let n=N(t,"x","prod");n.dtype==="bool"&&(n=oe(n,"int32"));let o={x:n},s={axis:e,keepDims:r};return E.runKernel(Yu,o,s)}var vL=_({prod_:yte});var X2=nt(Bx());var Wm=class{constructor(e,r,n,o,s){this.mean=e,this.stdDev=r,this.dtype=n,this.nextVal=NaN,this.truncated=o,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);let i=s||Math.random();this.random=X2.alea(i.toString())}nextValue(){if(!isNaN(this.nextVal)){let o=this.nextVal;return this.nextVal=NaN,o}let e,r,n=!1;for(;!n;){let o,s,i;do o=2*this.random()-1,s=2*this.random()-1,i=o*o+s*s;while(i>=1||i===0);let a=Math.sqrt(-2*Math.log(i)/i);e=this.mean+this.stdDev*o*a,r=this.mean+this.stdDev*s*a,(!this.truncated||this.isValidTruncated(e))&&(n=!0)}return(!this.truncated||this.isValidTruncated(r))&&(this.nextVal=this.convertValue(r)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}};var _1=class{constructor(e=0,r=1,n,o){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=r-e,this.dtype=n,o==null&&(o=Math.random()),typeof o=="number"&&(o=o.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${r} <= 1 and dtype is not float`);this.random=X2.alea(o)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}};function Tte(t,e=0,r=1,n,o){if(tn(t),n!=null&&n==="bool")throw new Error(`Unsupported data type ${n}`);let s=new Wm(e,r,n,!1,o),i=Ie(t,n);for(let a=0;a<i.values.length;a++)i.values[a]=s.nextValue();return i.toTensor()}var A1=_({randomNormal_:Tte});function Nte(t,e=0,r=1,n="float32",o){tn(t);let s=Ie(t,n),i=new _1(e,r,null,o);for(let a=0;a<s.values.length;a++)s.values[a]=i.nextValue();return s.toTensor()}var Sl=_({randomUniform_:Nte});function kl(t,e,r=1,n="float32"){if(r===0)throw new Error("Cannot have a step of zero");let o={start:t,stop:e,step:r,dtype:n};return E.runKernel(pm,{},o)}function Ite(t){let r={x:N(t,"x","reciprocal")};return E.runKernel(Xa,r)}var Y2=_({reciprocal_:Ite});function Ete(t){let r={x:N(t,"x","relu")};return E.runKernel(Ya,r)}var Ao=_({relu_:Ete});function _te(t){let r={x:N(t,"x","relu6")};return E.runKernel(Qa,r)}var D1=_({relu6_:_te});function Ate(t,e){let n={x:N(t,"x","reverse")},o={dims:e};return E.runKernel(ec,n,o)}var Zo=_({reverse_:Ate});function Dte(t){let r={x:N(t,"x","round")};return E.runKernel(Za,r)}var Vx=_({round_:Dte});function $te(t){let r={x:N(t,"x","rsqrt","float32")};return E.runKernel(Ja,r)}var Wx=_({rsqrt_:$te});function Rte(t){let r={x:N(t,"x","selu")};return E.runKernel(el,r)}var Gx=_({selu_:Rte});function Ote(t,e,r,n,o,s=[1,1],i="NHWC"){let a=N(t,"x","separableConv2d"),l=N(e,"depthwiseFilter","separableConv2d"),u=N(r,"pointwiseFilter","separableConv2d"),c=a,p=!1;if(a.rank===3&&(p=!0,c=M(a,[1,a.shape[0],a.shape[1],a.shape[2]])),i==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");D(c.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${c.rank}.`),D(l.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),D(u.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),D(u.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${u.shape[0]}.`),D(u.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${u.shape[1]}.`);let f=l.shape[2],d=l.shape[3];D(u.shape[2]===f*d,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${f*d}, but got ${u.shape[2]}.`);let m=vl(c,l,n,o,i,s),x=Io(m,u,1,"valid",i);return p?M(x,[x.shape[1],x.shape[2],x.shape[3]]):x}var Ux=_({separableConv2d_:Ote});function Fte(t){let r={x:N(t,"x","sign")};return E.runKernel(nl,r)}var Q2=_({sign_:Fte});function Pte(t){let r={x:N(t,"x","sin","float32")};return E.runKernel(tl,r)}var Hx=_({sin_:Pte});function Lte(t){let r={x:N(t,"x","sinh")};return E.runKernel(rl,r)}var qx=_({sinh_:Lte});function Mte(t,e,r){let n=N(t,"x","slice1d");return D(n.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${n.rank} tensor`),tt(n,[e],[r])}var jx=_({slice1d_:Mte});function zte(t,e,r){let n=N(t,"x","slice2d");return D(n.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${n.rank} tensor`),tt(n,e,r)}var $1=_({slice2d_:zte});function Bte(t,e,r){let n=N(t,"x","slice3d");return D(n.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${n.rank} tensor`),tt(n,e,r)}var Kx=_({slice3d_:Bte});function Vte(t,e,r){let n=N(t,"x","slice4d");return D(n.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${n.rank} tensor`),tt(n,e,r)}var Gm=_({slice4d_:Vte});function Wte(t,e=-1){let r=N(t,"logits","softmax","float32");if(e===-1&&(e=r.rank-1),e!==r.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${r.rank} and dim was ${e}`);let n={logits:r},o={dim:e};return E.runKernel(ic,n,o)}var sf=_({softmax_:Wte});function Gte(t){D(t.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${t.dtype}.`);let e={input:t};return E.runKernel(em,e)}var Xx=_({fft_:Gte});function Ute(t){D(t.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${t.dtype}.`);let e={input:t};return E.runKernel(nm,e)}var Um=_({ifft_:Ute});function Hte(t){let e=t.shape[t.shape.length-1],r=t.size/e,n;if(e<=2){let o=M(t,[r,e]);n=Um(o)}else{let o=[r,2*(e-1)],s=M(qp(t),[r,e]),i=M($m(t),[r,e]),a=Zo(tt(s,[0,1],[r,e-2]),1),l=L(Zo(tt(i,[0,1],[r,e-2]),1),Oe(-1)),u=Ot([s,a],1),c=Ot([i,l],1),p=M(Ko(u,c),[o[0],o[1]]);n=Um(p)}if(n=qp(n),t.rank===3&&t.shape[0]!==0){let o=n,s=t.shape[0];n=M(n,[s,n.shape[0]/s,n.shape[1]]),o.dispose()}return n}var Z2=_({irfft_:Hte});function qte(t,e,r=0){let o={x:N(t,"x","split")},s={numOrSizeSplits:e,axis:r};return E.runKernel(sc,o,s)}var Lr=_({split_:qte});function jte(t,e){D(t.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${t.dtype}`);let r=t.shape[t.shape.length-1],n=t.size/r,o;if(e!=null&&e<r){let m=t.shape.map(x=>0),h=t.shape.map(x=>x);h[t.shape.length-1]=e,o=tt(t,m,h),r=e}else if(e!=null&&e>r){let m=t.shape.map(h=>h);m[t.shape.length-1]=e-r,o=Ot([t,Pt(m)],t.shape.length-1),r=e}else o=t;let s=Ee(o),i=M(Ko(o,s),[n,r]),a=Xx(i),l=Math.floor(r/2)+1,u=qp(a),c=$m(a),p=Lr(u,[l,r-l],u.shape.length-1),f=Lr(c,[l,r-l],c.shape.length-1),d=o.shape.slice();return d[o.shape.length-1]=l,M(Ko(p[0],f[0]),d)}var J2=_({rfft_:jte});function Kte(t,e){let r=N(t,"a","squaredDifference"),n=N(e,"b","squaredDifference");[r,n]=Ye(r,n),Ve(r.shape,n.shape);let o={a:r,b:n},s={};return E.runKernel(al,o,s)}var LL=_({squaredDifference_:Kte});function Xte(t,e){let r=N(t,"x","squeeze","string_or_numeric");return M(r,CI(r.shape,e).newShape)}var si=_({squeeze_:Xte});function Yte(t,e=0){let r=u1(t,"tensors","stack","string_or_numeric");D(r.length>=1,()=>"Pass at least one tensor to tf.stack"),r.length>0&&D(e<=r[0].rank,()=>"Axis must be <= rank of the tensor");let n=r,o={axis:e};return E.runKernel(ju,n,o)}var Mr=_({stack_:Yte});function Qte(t,e=0){let n={x:N(t,"x","step")},o={alpha:e};return E.runKernel(pl,n,o)}var ii=_({step_:Qte});function Zte(t,e,r,n,o=0,s=0,i=0,a=0,l=0){let c={x:N(t,"x","stridedSlice","string_or_numeric")},p={begin:e,end:r,strides:n,beginMask:o,endMask:s,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:l};return E.runKernel(gm,c,p)}var eE=_({stridedSlice_:Zte});function Jte(t){let r={x:N(t,"x","tan","float32")};return E.runKernel(ul,r)}var tE=_({tan_:Jte});function Rr(t,e){Np(t);let r=dl(t,e);if(r.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return zi(t,null,r,e)}function Yx(t,e,r){if(Np(t),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");let n=dl(t,r);if(n.length!==2&&n.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return zi(t,e,n,r)}function ere(t,e=1,r=!0){let n=N(t,"x","topk");if(n.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");let o=n.shape[n.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>o)throw new Error(`'k' passed to topk() must be <= the last dimension (${o}) but got ${e}`);let s={x:n},i={k:e,sorted:r},[a,l]=E.runKernel(xm,s,i);return{values:a,indices:l}}var ML=_({topk_:ere});function tre(t,e=0,r=1,n,o){if(tn(t),n!=null&&n==="bool")throw new Error("Unsupported data type $ { dtype }");let s=new Wm(e,r,n,!0,o),i=Ie(t,n);for(let a=0;a<i.values.length;a++)i.values[a]=s.nextValue();return i.toTensor()}var Qx=_({truncatedNormal_:tre});function rre(t,e=0){let r=N(t,"x","unique","string_or_numeric");D(r.rank>0,()=>"The input tensor must be at least 1D");let n={x:r},o={axis:e},[s,i]=E.runKernel(bm,n,o);return{values:s,indices:i}}var zL=_({unique_:rre});function nre(t,e,r){let n=N(t,"x","unsortedSegmentSum"),o=N(e,"segmentIds","unsortedSegmentSum","int32");D(ba(r),()=>"numSegments must be of dtype int");let s={x:n,segmentIds:o},i={numSegments:r};return E.runKernel(lc,s,i)}var R1=_({unsortedSegmentSum_:nre});function ore(t,e=0){let r=N(t,"x","unstack","string_or_numeric");D(e>=-r.shape.length&&e<r.shape.length,()=>`Axis = ${e} is not in [-${r.shape.length}, ${r.shape.length})`);let n={value:r},o={axis:e};return E.runKernel(ac,n,o)}var An=_({unstack_:ore});function rE(t,e=!0,r,n){return E.makeVariable(t,e,r,n)}function BL(t,e){let r=[];for(let s=0;s<e.length;s++)e[s]&&r.push(s);let n=Ie(t,"int32"),o=Ie([r.length,t.length],"int32");for(let s=0;s<r.length;s++){let i=n.indexToLoc(r[s]),a=s*t.length;o.values.set(i,a)}return o.toTensor()}function VL(t,e){if(e==null)return t.shape.slice();if(xu(t.shape,e))return e;if(t.shape.length===e.length){let r=[];for(let n=0;n<t.shape.length;n++)e[n]==null&&t.shape[n]!=null?r.push(t.shape[n]):r.push(e[n]);return r}return e}function sre(t,e,r,n){let o=N(t,"x","dropout");if(D(o.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${o.dtype} tensor instead.`),D(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return t instanceof Je?o.clone():o;let s=VL(o,r),i=1-e,a=xe(Cl(te(Sl(s,0,1,"float32",n),i)),i);return L(o,a)}var WL=_({dropout_:sre});var pf={};qo(pf,{conv2d:()=>GL,depthwiseConv2d:()=>UL,matMul:()=>HL});function ire(t,e,r,n,o,s="NHWC",i){let a=t;t.rank===3&&(a=M(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=e;l.rank===3&&(l=M(e,[1,e.shape[0],e.shape[1],e.shape[2]])),D(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),D(l.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),D(r.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${r}.`);let u=s==="NHWC"?a.shape[3]:a.shape[1],c=s==="NHWC"?l.shape[3]:l.shape[1];D(u===r[2],()=>`Error in conv2dDerFilter: depth of input ${u}) must match input depth in filter (${r[2]}.`),D(c===r[3],()=>`Error in conv2dDerFilter: depth of dy (${c}) must match output depth for filter (${r[3]}).`),It("conv2dDerFilter",o,i);let p={x:a,dy:l},f={strides:n,pad:o,dataFormat:s,dimRoundingMode:i,filterShape:r};return E.runKernel(Gd,p,f)}var Hm=_({conv2DBackpropFilter_:ire});function af(t,e,r){if(r==null||r==="linear")return t;if(r==="relu")return L(t,ii(e));throw new Error(`Cannot compute gradient for fused activation ${r}.`)}function lf(t,e){let r=e,n=vt(t.shape,e.shape);return n.length>0&&(r=ye(r,n)),M(r,t.shape)}function uf(t,e,r,n){if(e==="linear")return t;if(e==="relu")return Ao(t);if(e==="elu")return wl(t);if(e==="relu6")return D1(t);if(e==="prelu")return nf(t,r);if(e==="leakyrelu")return Jp(t,n);if(e==="sigmoid")return bs(t);throw new Error(`Unknown fused activation ${e}.`)}var cf=(t,e)=>!(t>0)||e==="linear";function are({x:t,filter:e,strides:r,pad:n,dataFormat:o="NHWC",dilations:s=[1,1],dimRoundingMode:i,bias:a,activation:l="linear",preluActivationWeights:u,leakyreluAlpha:c}){if(l=l||"linear",cf(E.state.gradientDepth,l)===!1){D(o==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${o} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let S=Io(t,e,r,n,o,s,i);return a!=null&&(S=te(S,a)),uf(S,l,u,c)}let p=N(t,"x","conv2d","float32"),f=N(e,"filter","conv2d","float32"),d=p,m=!1;p.rank===3&&(m=!0,d=M(p,[1,p.shape[0],p.shape[1],p.shape[2]])),D(d.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${d.rank}.`),D(f.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${f.rank}.`),It("fused conv2d",n,i);let h=o==="NHWC"?d.shape[3]:d.shape[1];D(f.shape[2]===h,()=>`Error in conv2d: depth of input (${h}) must match input depth for filter ${f.shape[2]}.`),D(on(r,s),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${r} and dilations '${s}'`);let x=Xp(d.shape,f.shape,r,s,n,i),g;a!=null&&(g=N(a,"bias","fused conv2d"),[g]=Ye(g,p),o==="NHWC"?Ve(x.outShape,g.shape):(D(g.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${g.shape.length}.`),D(g.shape.length===0||g.shape[0]===x.outChannels||g.shape[0]===1,()=>`Error in fused conv2d: bias shape (${g.shape}) is not compatible with the number of output channels (${x.outChannels})`)));let y;if(u!=null){let S=u.shape;if(D(S.length<=1||S.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${S.length}.`),S.length===1)D(S[0]===1||S[0]===x.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${S}) is not compatible with the number of output channels (${x.outChannels}).`);else if(S.length===3)try{Ve(S,x.outShape)}catch{let I=`Error in fused conv2d: PReLU activation weights (${S}) is not compatible with the output shape of the conv2d (${x.outShape}).`;throw Error(I)}y=N(u,"prelu weights","fused conv2d")}let b=(S,k)=>{D(o==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${o} but only NHWC is currently supported.`);let[I,A,$,O]=k,j=af(S,$,l);D(Xo(s),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);let H=Lm(A.shape,j,I,r,n),Y=Hm(A,j,I.shape,r,n),B=[H,Y];if(O!=null){let K=lf(O,j);B.push(K)}return B},v={x:d,filter:f,bias:g,preluActivationWeights:y},C={strides:r,pad:n,dataFormat:o,dilations:s,dimRoundingMode:i,activation:l,leakyreluAlpha:c};return a==null?Qo((k,I,A)=>{let $=E.runKernel(Lp,v,C);return A([I,k,$]),m&&($=M($,[$.shape[1],$.shape[2],$.shape[3]])),{value:$,gradFunc:b}})(d,f):Qo((k,I,A,$)=>{let O=E.runKernel(Lp,v,C);return $([I,k,O,A]),m&&(O=M(O,[O.shape[1],O.shape[2],O.shape[3]])),{value:O,gradFunc:b}})(d,f,g)}var GL=_({fusedConv2d_:are});function lre(t,e,r,n,o,s=[1,1],i){let a=t;t.rank===3&&(a=M(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=e;l.rank===3&&(l=M(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let u={x:a,dy:l},c={strides:n,pad:o,dimRoundingMode:i,dilations:s,filterShape:r};return E.runKernel(Yd,u,c)}var O1=_({depthwiseConv2dNativeBackpropFilter_:lre});function ure(t,e,r,n,o,s=[1,1],i){let a=e,l=!1;e.rank===3&&(l=!0,a=M(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let u={dy:a,filter:r},c={strides:n,pad:o,dimRoundingMode:i,dilations:s,inputShape:t},p=E.runKernel(Qd,u,c);return l?M(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var F1=_({depthwiseConv2dNativeBackpropInput_:ure});function cre({x:t,filter:e,strides:r,pad:n,dataFormat:o="NHWC",dilations:s=[1,1],dimRoundingMode:i,bias:a,activation:l="linear",preluActivationWeights:u,leakyreluAlpha:c}){if(cf(E.state.gradientDepth,l)===!1){let C=vl(t,e,r,n,o,s,i);return a!=null&&(C=te(C,a)),uf(C,l,u,c)}let p=N(t,"x","depthwiseConv2d","float32"),f=N(e,"filter","depthwiseConv2d","float32"),d=p,m=!1;p.rank===3&&(m=!0,d=M(p,[1,p.shape[0],p.shape[1],p.shape[2]])),D(d.rank===4,()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${d.rank}.`),D(f.rank===4,()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${f.rank}.`),D(d.shape[3]===f.shape[2],()=>`Error in fused depthwiseConv2d: number of input channels (${d.shape[3]}) must match the inChannels dimension in filter ${f.shape[2]}.`),s==null&&(s=[1,1]),D(on(r,s),()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${r} and dilations '${s}'`),It("fused depthwiseConv2d",n,i);let h=Xp(d.shape,f.shape,r,s,n,i,!0),x;a!=null&&(x=N(a,"bias","fused conv2d"),[x]=Ye(x,p),Ve(h.outShape,x.shape));let g;u!=null&&(g=N(u,"prelu weights","fused depthwiseConv2d"));let y=(C,S)=>{D(Xo(s),()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${s}'`);let[k,I,A,$]=S,O=af(C,A,l),j=F1(I.shape,O,k,r,n,s,i),H=O1(I,O,k.shape,r,n,s,i);if($!=null){let Y=lf(x,O);return[j,H,Y]}return[j,H]},b={x:d,filter:f,bias:x,preluActivationWeights:g},v={strides:r,pad:n,dataFormat:o,dilations:s,dimRoundingMode:i,activation:l,leakyreluAlpha:c};return a==null?Qo((S,k,I)=>{let A=E.runKernel(Mp,b,v);return I([k,S,A]),m&&(A=M(A,[A.shape[1],A.shape[2],A.shape[3]])),{value:A,gradFunc:y}})(d,f):Qo((S,k,I,A)=>{let $=E.runKernel(Mp,b,v);return A([k,S,$,I]),m&&($=M($,[$.shape[1],$.shape[2],$.shape[3]])),{value:$,gradFunc:y}})(d,f,x)}var UL=_({fusedDepthwiseConv2d_:cre});function pre({a:t,b:e,transposeA:r=!1,transposeB:n=!1,bias:o,activation:s="linear",preluActivationWeights:i,leakyreluAlpha:a=.2}){if(cf(E.state.gradientDepth,s)===!1){let O=ot(t,e,r,n);return o!=null&&(O=te(O,o)),uf(O,s,i,a)}let l=N(t,"a","fused matMul"),u=N(e,"b","fused matMul");[l,u]=Ye(l,u);let c=r?l.shape[l.rank-2]:l.shape[l.rank-1],p=n?u.shape[u.rank-1]:u.shape[u.rank-2],f=r?l.shape[l.rank-1]:l.shape[l.rank-2],d=n?u.shape[u.rank-2]:u.shape[u.rank-1],m=l.shape.slice(0,-2),h=u.shape.slice(0,-2),x=at(m),g=at(h);D(c===p,()=>`Error in fused matMul: inner shapes (${c}) and (${p}) of Tensors with shapes ${l.shape} and ${u.shape} and transposeA=${r} and transposeB=${n} must match.`);let b=Ve(l.shape.slice(0,-2),u.shape.slice(0,-2)).concat([f,d]),v=r?M(l,[x,c,f]):M(l,[x,f,c]),C=n?M(u,[g,d,p]):M(u,[g,p,d]),S;o!=null&&(S=N(o,"bias","fused matMul"),[S]=Ye(S,l),Ve(b,S.shape));let k;i!=null&&(k=N(i,"prelu weights","fused matMul"));let I=(O,j)=>{let[H,Y,B,K]=j,X=af(M(O,B.shape),B,s),Z,Q;if(!r&&!n?(Z=ot(X,Y,!1,!0),Q=ot(H,X,!0,!1)):!r&&n?(Z=ot(X,Y,!1,!1),Q=ot(X,H,!0,!1)):r&&!n?(Z=ot(Y,X,!1,!0),Q=ot(H,X,!1,!1)):(Z=ot(Y,X,!0,!0),Q=ot(X,H,!0,!0)),o!=null){let ie=lf(K,X);return[Z,Q,ie]}else return[Z,Q]},A={a:v,b:C,bias:S,preluActivationWeights:k},$={transposeA:r,transposeB:n,activation:s,leakyreluAlpha:a};return o==null?Qo((j,H,Y)=>{let B=E.runKernel(Pp,A,$);return Y([j,H,B]),{value:M(B,b),gradFunc:I}})(v,C):Qo((j,H,Y,B)=>{let K=E.runKernel(Pp,A,$);return B([j,H,K,Y]),{value:M(K,b),gradFunc:I}})(v,C,S)}var HL=_({fusedMatMul_:pre});function fre(t,e,r,n,o="bilinear",s=0){let i=N(t,"image","cropAndResize"),a=N(e,"boxes","cropAndResize","float32"),l=N(r,"boxInd","cropAndResize","int32"),u=a.shape[0];D(i.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${i.rank}.`),D(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${u},4] but had shape ${a.shape}.`),D(l.rank===1&&l.shape[0]===u,()=>`Error in cropAndResize: boxInd must be have size [${u}] but had shape ${a.shape}.`),D(n.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${n.length}.`),D(n[0]>=1&&n[1]>=1,()=>`cropSize must be atleast [1,1], but was ${n}`),D(o==="bilinear"||o==="nearest",()=>`method must be bilinear or nearest, but was ${o}`);let c={image:i,boxes:a,boxInd:l},p={method:o,extrapolationValue:s,cropSize:n};return E.runKernel(jd,c,p)}var qL=_({cropAndResize_:fre});function dre(t){let e=N(t,"image","flipLeftRight","float32");D(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);let r={image:e};return E.runKernel(rm,r,{})}var jL=_({flipLeftRight_:dre});function mre(t){let e=N(t,"image","grayscaleToRGB"),r=e.rank-1,n=e.shape[r];D(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),D(n===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${n}.`);let o=new Array(e.rank);return o.fill(1,0,r),o[r]=3,xn(e,o)}var KL=_({grayscaleToRGB_:mre});function hre(t,e,r=0,n=.5){let o=N(t,"image","rotateWithOffset","float32");D(o.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${o.rank}.`);let s={image:o},i={radians:e,fillValue:r,center:n};return E.runKernel(vm,s,i)}var XL=_({rotateWithOffset_:hre});function Cs(t,e,r,n,o,s){n==null&&(n=.5),o==null&&(o=Number.NEGATIVE_INFINITY),s==null&&(s=0);let i=t.shape[0];return r=Math.min(r,i),D(0<=n&&n<=1,()=>`iouThreshold must be in [0, 1], but was '${n}'`),D(t.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${t.rank}'`),D(t.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${t.shape[1]}`),D(e.rank===1,()=>"scores must be a 1D tensor"),D(e.shape[0]===i,()=>`scores has incompatible shape with boxes. Expected ${i}, but was ${e.shape[0]}`),D(0<=s&&s<=1,()=>`softNmsSigma must be in [0, 1], but was '${s}'`),{maxOutputSize:r,iouThreshold:n,scoreThreshold:o,softNmsSigma:s}}function gre(t,e,r,n=.5,o=Number.NEGATIVE_INFINITY){let s=N(t,"boxes","nonMaxSuppression","float32"),i=N(e,"scores","nonMaxSuppression","float32"),a=Cs(s,i,r,n,o);r=a.maxOutputSize,n=a.iouThreshold,o=a.scoreThreshold;let l={maxOutputSize:r,iouThreshold:n,scoreThreshold:o};return E.runKernel(lm,{boxes:s,scores:i},l)}var YL=_({nonMaxSuppression_:gre});function QL(t,e,r){let n=xre(t,e,r),o=n<0?-(n+1):n;t.splice(o,0,e)}function xre(t,e,r){return bre(t,e,r||yre)}function yre(t,e){return t>e?1:t<e?-1:0}function bre(t,e,r){let n=0,o=t.length,s=0,i=!1;for(;n<o;){s=n+(o-n>>>1);let a=r(e,t[s]);a>0?n=s+1:(o=s,i=!a)}return i?n:-n-1}function P1(t,e,r,n,o){return nE(t,e,r,n,o,0)}function L1(t,e,r,n,o,s){return nE(t,e,r,n,o,0,!1,s,!0)}function M1(t,e,r,n,o,s){return nE(t,e,r,n,o,s,!0)}function nE(t,e,r,n,o,s,i=!1,a=!1,l=!1){let u=[];for(let x=0;x<e.length;x++)e[x]>o&&u.push({score:e[x],boxIndex:x,suppressBeginIndex:0});u.sort(ZL);let c=s>0?-.5/s:0,p=[],f=[];for(;p.length<r&&u.length>0;){let x=u.pop(),{score:g,boxIndex:y,suppressBeginIndex:b}=x;if(g<o)break;let v=!1;for(let C=p.length-1;C>=b;--C){let S=vre(t,y,p[C]);if(S>=n){v=!0;break}if(x.score=x.score*wre(n,c,S),x.score<=o)break}x.suppressBeginIndex=p.length,v||(x.score===g?(p.push(y),f.push(x.score)):x.score>o&&QL(u,x,ZL))}let d=p.length,m=r-d;a&&m>0&&(p.push(...new Array(m).fill(0)),f.push(...new Array(m).fill(0)));let h={selectedIndices:p};return i&&(h.selectedScores=f),l&&(h.validOutputs=d),h}function vre(t,e,r){let n=t.subarray(e*4,e*4+4),o=t.subarray(r*4,r*4+4),s=Math.min(n[0],n[2]),i=Math.min(n[1],n[3]),a=Math.max(n[0],n[2]),l=Math.max(n[1],n[3]),u=Math.min(o[0],o[2]),c=Math.min(o[1],o[3]),p=Math.max(o[0],o[2]),f=Math.max(o[1],o[3]),d=(a-s)*(l-i),m=(p-u)*(f-c);if(d<=0||m<=0)return 0;let h=Math.max(s,u),x=Math.max(i,c),g=Math.min(a,p),y=Math.min(l,f),b=Math.max(g-h,0)*Math.max(y-x,0);return b/(d+m-b)}function wre(t,e,r){let n=Math.exp(e*r*r);return r<=t?n:0}function ZL(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}async function Cre(t,e,r,n=.5,o=Number.NEGATIVE_INFINITY){let s=N(t,"boxes","nonMaxSuppressionAsync"),i=N(e,"scores","nonMaxSuppressionAsync"),a=Cs(s,i,r,n,o);r=a.maxOutputSize,n=a.iouThreshold,o=a.scoreThreshold;let l=await Promise.all([s.data(),i.data()]),u=l[0],c=l[1],{selectedIndices:p}=P1(u,c,r,n,o);return s!==t&&s.dispose(),i!==e&&i.dispose(),Rr(p,"int32")}var JL=Cre;function Sre(t,e,r,n=.5,o=Number.NEGATIVE_INFINITY,s=0){let i=N(t,"boxes","nonMaxSuppression"),a=N(e,"scores","nonMaxSuppression"),l=Cs(i,a,r,n,o,s);r=l.maxOutputSize,n=l.iouThreshold,o=l.scoreThreshold,s=l.softNmsSigma;let u={boxes:i,scores:a},c={maxOutputSize:r,iouThreshold:n,scoreThreshold:o,softNmsSigma:s},p=E.runKernel(cm,u,c);return{selectedIndices:p[0],selectedScores:p[1]}}var eM=_({nonMaxSuppressionWithScore_:Sre});async function kre(t,e,r,n=.5,o=Number.NEGATIVE_INFINITY,s=0){let i=N(t,"boxes","nonMaxSuppressionAsync"),a=N(e,"scores","nonMaxSuppressionAsync"),l=Cs(i,a,r,n,o,s);r=l.maxOutputSize,n=l.iouThreshold,o=l.scoreThreshold,s=l.softNmsSigma;let u=await Promise.all([i.data(),a.data()]),c=u[0],p=u[1],{selectedIndices:f,selectedScores:d}=M1(c,p,r,n,o,s);return i!==t&&i.dispose(),a!==e&&a.dispose(),{selectedIndices:Rr(f,"int32"),selectedScores:Rr(d)}}var tM=kre;function Tre(t,e,r,n=.5,o=Number.NEGATIVE_INFINITY,s=!1){let i=N(t,"boxes","nonMaxSuppression"),a=N(e,"scores","nonMaxSuppression"),l=Cs(i,a,r,n,o,null),u=l.maxOutputSize,c=l.iouThreshold,p=l.scoreThreshold,f={boxes:i,scores:a},d={maxOutputSize:u,iouThreshold:c,scoreThreshold:p,padToMaxOutputSize:s},m=E.runKernel(um,f,d);return{selectedIndices:m[0],validOutputs:m[1]}}var rM=_({nonMaxSuppressionPadded_:Tre});async function Nre(t,e,r,n=.5,o=Number.NEGATIVE_INFINITY,s=!1){let i=N(t,"boxes","nonMaxSuppressionAsync"),a=N(e,"scores","nonMaxSuppressionAsync"),l=Cs(i,a,r,n,o,null),u=l.maxOutputSize,c=l.iouThreshold,p=l.scoreThreshold,[f,d]=await Promise.all([i.data(),a.data()]),{selectedIndices:m,validOutputs:h}=L1(f,d,u,c,p,s);return i!==t&&i.dispose(),a!==e&&a.dispose(),{selectedIndices:Rr(m,"int32"),validOutputs:Oe(h,"int32")}}var nM=Nre;function Ire(t,e,r=!1,n=!1){let o=N(t,"images","resizeBilinear");D(o.rank===3||o.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${o.rank}.`),D(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),D(n===!1||r===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let s=o,i=!1;o.rank===3&&(i=!0,s=M(o,[1,o.shape[0],o.shape[1],o.shape[2]]));let[]=e,a={images:s},l={alignCorners:r,halfPixelCenters:n,size:e},u=E.runKernel(Ju,a,l);return i?M(u,[u.shape[1],u.shape[2],u.shape[3]]):u}var z1=_({resizeBilinear_:Ire});function Ere(t,e,r=!1,n=!1){let o=N(t,"images","resizeNearestNeighbor");D(o.rank===3||o.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${o.rank}.`),D(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),D(o.dtype==="float32"||o.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),D(n===!1||r===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let s=o,i=!1;o.rank===3&&(i=!0,s=M(o,[1,o.shape[0],o.shape[1],o.shape[2]]));let[]=e,a={images:s},l={alignCorners:r,halfPixelCenters:n,size:e},u=E.runKernel(Zu,a,l);return i?M(u,[u.shape[1],u.shape[2],u.shape[3]]):u}var B1=_({resizeNearestNeighbor_:Ere});function _re(t,e="binary",r=!1,n=.5){let o=N(t,"image","threshold"),s=.2989,i=.587,a=.114,l=o.shape[0]*o.shape[1],u=L(Rr([n]),255),c,p,f,d;if(D(o.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${o.rank}.`),D(o.shape[2]===3||o.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${o.shape[2]}.`),D(o.dtype==="int32"||o.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${o.dtype}.`),D(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),o.shape[2]===3){[c,p,f]=Lr(o,[1,1,1],-1);let x=L(c,s),g=L(p,i),y=L(f,a);d=te(te(x,g),y)}else d=t;if(e==="otsu"){let x=iL(oe(Vx(d),"int32"),Cr([]),256);u=Are(x,l)}let m=r?ws(d,u):tr(d,u);return oe(L(m,255),"int32")}function Are(t,e){let r=Rr([-1]),n=Rr([0]),o=Rr([0]),s,i,a,l,u,c;for(let p=0;p<t.size-1;p++){s=tt(t,0,p+1),i=tt(t,p+1),u=xe(ye(s),e),c=xe(ye(i),e);let f=ye(L(s,kl(0,s.size)));a=xe(f,ye(s));let d=bl(i.shape,s.size),m=te(kl(0,i.size),d),h=L(i,m);l=xe(ye(h),ye(i));let x=Se(a,l),g=Se(a,l),y=L(u,c);o=L(L(y,x),g);let b=tr(o,n);n=Vt(b,o,n),r=Vt(b,Rr([p]),r)}return r}var oM=_({threshold_:_re});function Dre(t,e,r="nearest",n="constant",o=0,s){let i=N(t,"image","transform","float32"),a=N(e,"transforms","transform","float32");D(i.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${i.rank}.`),D(a.rank===2&&(a.shape[0]===i.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),D(s==null||s.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${s}.`);let l={image:i,transforms:a},u={interpolation:r,fillMode:n,fillValue:o,outputShape:s};return E.runKernel(ym,l,u)}var sM=_({transform_:Dre});function $re(t,e,r){D(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),D(r%1===0,()=>`bandPart(): numUpper must be an integer, got ${r}.`);let n=N(t,"a","bandPart");D(n.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${n.rank}.`);let o=n.shape,[s,i]=n.shape.slice(-2);if(!(e<=s))throw new Error(`bandPart(): numLower (${e}) must not be greater than the number of rows (${s}).`);if(!(r<=i))throw new Error(`bandPart(): numUpper (${r}) must not be greater than the number of columns (${i}).`);e<0&&(e=s),r<0&&(r=i);let a=M(kl(0,s,1,"int32"),[-1,1]),l=kl(0,i,1,"int32"),u=Se(a,l),c=_n(ws(u,Oe(+e,"int32")),so(u,Oe(-r,"int32"))),p=Pt([s,i],n.dtype);return M(Mr(An(M(n,[-1,s,i])).map(f=>Vt(c,f,p))),o)}var iM=_({bandPart_:$re});function Rre(t){let e;if(Array.isArray(t)){e=!1,D(t!=null&&t.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");let o=t[0].shape[0];for(let s=1;s<t.length;++s)D(t[s].shape[0]===o,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${t[s].shape[0]} vs. ${o})`)}else e=!0,t=Lr(t,t.shape[0],0).map(o=>si(o,[0]));D(t.length<=t[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${t.length}) exceeds number of dimensions (${t[0].shape[0]}).`);let r=[],n=t;for(let o=0;o<t.length;++o)r.push(E.tidy(()=>{let s=n[o];if(o>0)for(let i=0;i<o;++i){let a=L(ye(L(r[i],s)),r[i]);s=Se(s,a)}return xe(s,gc(s,"euclidean"))}));return e?Mr(r,0):r}var aM=_({gramSchmidt_:Rre});function Ore(t,e=!1){if(D(t.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${t.rank}`),t.rank===2)return lM(t,e);{let r=t.shape.slice(0,t.shape.length-2).reduce((l,u)=>l*u),n=An(M(t,[r,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),o=[],s=[];n.forEach(l=>{let[u,c]=lM(l,e);o.push(u),s.push(c)});let i=M(Mr(o,0),t.shape),a=M(Mr(s,0),t.shape);return[i,a]}}function lM(t,e=!1){return E.tidy(()=>{D(t.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${t.shape.length}D Tensor.`);let r=t.shape[0],n=t.shape[1],o=Mm(r),s=To(t),i=Yx([[1]],[1,1]),a=To(i),l=r>=n?n:r;for(let u=0;u<l;++u){let c=s,p=a,f=o;[a,s,o]=E.tidy(()=>{let d=tt(s,[u,u],[r-u,1]),m=gc(d),h=tt(s,[u,u],[1,1]),x=Vt(tr(h,0),Yx([[-1]]),Yx([[1]])),g=Se(h,L(x,m)),y=xe(d,g);y.shape[0]===1?a=To(i):a=Ot([i,tt(y,[1,0],[y.shape[0]-1,y.shape[1]])],0);let b=st(xe(ot(x,g),m)),v=tt(s,[u,0],[r-u,n]),C=L(b,a),S=Ue(a);if(u===0)s=Se(v,ot(C,ot(S,v)));else{let A=Se(v,ot(C,ot(S,v)));s=Ot([tt(s,[0,0],[u,n]),A],0)}let k=Ue(C),I=tt(o,[0,u],[r,o.shape[1]-u]);if(u===0)o=Se(I,ot(ot(I,a),k));else{let A=Se(I,ot(ot(I,a),k));o=Ot([tt(o,[0,0],[r,u]),A],1)}return[a,s,o]}),Me([c,p,f])}return!e&&r>n&&(o=tt(o,[0,0],[r,n]),s=tt(s,[0,0],[n,n])),[o,s]})}var uM=_({qr_:Ore});var ai={flipLeftRight:jL,grayscaleToRGB:KL,resizeNearestNeighbor:B1,resizeBilinear:z1,rotateWithOffset:XL,cropAndResize:qL,nonMaxSuppression:YL,nonMaxSuppressionAsync:JL,nonMaxSuppressionWithScore:eM,nonMaxSuppressionWithScoreAsync:tM,nonMaxSuppressionPadded:rM,nonMaxSuppressionPaddedAsync:nM,threshold:oM,transform:sM},cM={bandPart:iM,gramSchmidt:aM,qr:uM};var yn=class extends Ax{minimize(e,r=!1,n){let{value:o,grads:s}=this.computeGradients(e,n);if(n!=null){let i=n.map(a=>({name:a.name,tensor:s[a.name]}));this.applyGradients(i)}else this.applyGradients(s);return Me(s),r?o:(o.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,r){return B2(e,r)}dispose(){this.iterations_!=null&&Me(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Oe(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}};Object.defineProperty(yn,Symbol.hasInstance,{value:t=>t.minimize!=null&&t.computeGradients!=null&&t.applyGradients!=null});var qm=class extends yn{constructor(e,r,n=null){super(),this.learningRate=e,this.rho=r,this.epsilon=n,this.accumulatedGrads=[],this.accumulatedUpdates=[],n==null&&(this.epsilon=E.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(n=>n.name):Object.keys(e)).forEach((n,o)=>{let s=E.registeredVariables[n],i=!1;this.accumulatedGrads[o]==null&&(this.accumulatedGrads[o]={originalName:`${n}/accum_grad`,variable:G(()=>Ee(s).variable(i))}),this.accumulatedUpdates[o]==null&&(this.accumulatedUpdates[o]={originalName:`${n}/accum_var`,variable:G(()=>Ee(s).variable(i))});let a=Array.isArray(e)?e[o].tensor:e[n];if(a==null)return;let l=this.accumulatedGrads[o].variable,u=this.accumulatedUpdates[o].variable;G(()=>{let c=te(L(l,this.rho),L(Ke(a),1-this.rho)),p=L(xe(Ft(te(u,this.epsilon)),Ft(te(l,this.epsilon))),a),f=te(L(u,this.rho),L(Ke(p),1-this.rho));l.assign(c),u.assign(f);let d=te(L(p,-this.learningRate),s);s.assign(d)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(Me(this.accumulatedGrads.map(e=>e.variable)),Me(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){let e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(r=>({name:r.originalName,tensor:r.variable})))}async setWeights(e){e=await this.extractIterations(e);let r=e.length/2,n=!1;this.accumulatedGrads=e.slice(0,r).map(o=>({originalName:o.name,variable:o.tensor.variable(n)})),this.accumulatedUpdates=e.slice(r,r*2).map(o=>({originalName:o.name,variable:o.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,r){return new e(r.learningRate,r.rho,r.epsilon)}};qm.className="Adadelta";oo(qm);var jm=class extends yn{constructor(e,r=.1){super(),this.learningRate=e,this.initialAccumulatorValue=r,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(n=>n.name):Object.keys(e)).forEach((n,o)=>{let s=E.registeredVariables[n];this.accumulatedGrads[o]==null&&(this.accumulatedGrads[o]={originalName:`${n}/accumulator`,variable:G(()=>bl(s.shape,this.initialAccumulatorValue).variable(!1))});let i=Array.isArray(e)?e[o].tensor:e[n];if(i==null)return;let a=this.accumulatedGrads[o].variable;G(()=>{let l=te(a,Ke(i));a.assign(l);let u=te(L(xe(i,Ft(te(l,E.backend.epsilon()))),-this.learningRate),s);s.assign(u)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&Me(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);let r=!1;this.accumulatedGrads=e.map(n=>({originalName:n.name,variable:n.tensor.variable(r)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,r){return new e(r.learningRate,r.initialAccumulatorValue)}};jm.className="Adagrad";oo(jm);var Km=class extends yn{constructor(e,r,n,o=null){super(),this.learningRate=e,this.beta1=r,this.beta2=n,this.epsilon=o,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],G(()=>{this.accBeta1=Oe(r).variable(),this.accBeta2=Oe(n).variable()}),o==null&&(this.epsilon=E.backend.epsilon())}applyGradients(e){let r=Array.isArray(e)?e.map(n=>n.name):Object.keys(e);G(()=>{let n=Se(1,this.accBeta1),o=Se(1,this.accBeta2);r.forEach((s,i)=>{let a=E.registeredVariables[s],l=!1;this.accumulatedFirstMoment[i]==null&&(this.accumulatedFirstMoment[i]={originalName:`${s}/m`,variable:G(()=>Ee(a).variable(l))}),this.accumulatedSecondMoment[i]==null&&(this.accumulatedSecondMoment[i]={originalName:`${s}/v`,variable:G(()=>Ee(a).variable(l))});let u=Array.isArray(e)?e[i].tensor:e[s];if(u==null)return;let c=this.accumulatedFirstMoment[i].variable,p=this.accumulatedSecondMoment[i].variable,f=te(L(c,this.beta1),L(u,1-this.beta1)),d=te(L(p,this.beta2),L(Ke(u),1-this.beta2)),m=xe(f,n),h=xe(d,o);c.assign(f),p.assign(d);let x=te(L(xe(m,te(Ft(h),this.epsilon)),-this.learningRate),a);a.assign(x)}),this.accBeta1.assign(L(this.accBeta1,this.beta1)),this.accBeta2.assign(L(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Me(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&Me(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){let e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(r=>({name:r.originalName,tensor:r.variable})))}async setWeights(e){e=await this.extractIterations(e),G(()=>{this.accBeta1.assign(vs(this.beta1,this.iterations_+1)),this.accBeta2.assign(vs(this.beta2,this.iterations_+1))});let r=e.length/2,n=!1;this.accumulatedFirstMoment=e.slice(0,r).map(o=>({originalName:o.name,variable:o.tensor.variable(n)})),this.accumulatedSecondMoment=e.slice(r,r*2).map(o=>({originalName:o.name,variable:o.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,r){return new e(r.learningRate,r.beta1,r.beta2,r.epsilon)}};Km.className="Adam";oo(Km);var Xm=class extends yn{constructor(e,r,n,o=null,s=0){super(),this.learningRate=e,this.beta1=r,this.beta2=n,this.epsilon=o,this.decay=s,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],G(()=>{this.iteration=Oe(0).variable(),this.accBeta1=Oe(r).variable()}),o==null&&(this.epsilon=E.backend.epsilon())}applyGradients(e){let r=Array.isArray(e)?e.map(n=>n.name):Object.keys(e);G(()=>{let n=Se(1,this.accBeta1),o=xe(-this.learningRate,te(L(this.iteration,this.decay),1));r.forEach((s,i)=>{let a=E.registeredVariables[s],l=!1;this.accumulatedFirstMoment[i]==null&&(this.accumulatedFirstMoment[i]={originalName:`${s}/m`,variable:Ee(a).variable(l)}),this.accumulatedWeightedInfNorm[i]==null&&(this.accumulatedWeightedInfNorm[i]={originalName:`${s}/v`,variable:Ee(a).variable(l)});let u=Array.isArray(e)?e[i].tensor:e[s];if(u==null)return;let c=this.accumulatedFirstMoment[i].variable,p=this.accumulatedWeightedInfNorm[i].variable,f=te(L(c,this.beta1),L(u,1-this.beta1)),d=L(p,this.beta2),m=Sr(u),h=Eo(d,m);c.assign(f),p.assign(h);let x=te(L(xe(o,n),xe(f,te(h,this.epsilon))),a);a.assign(x)}),this.iteration.assign(te(this.iteration,1)),this.accBeta1.assign(L(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Me(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&Me(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,r){return new e(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)}};Xm.className="Adamax";oo(Xm);var yc=class extends yn{constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(n=>n.name):Object.keys(e)).forEach((n,o)=>{let s=Array.isArray(e)?e[o].tensor:e[n];if(s==null)return;let i=E.registeredVariables[n];G(()=>{let a=te(L(this.c,s),i);i.assign(a)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=Ur(Oe(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,r){return new e(r.learningRate)}};yc.className="SGD";oo(yc);var Ym=class extends yc{constructor(e,r,n=!1){super(e),this.learningRate=e,this.momentum=r,this.useNesterov=n,this.accumulations=[],this.m=Oe(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(n=>n.name):Object.keys(e)).forEach((n,o)=>{let s=E.registeredVariables[n];this.accumulations[o]==null&&(this.accumulations[o]={originalName:`${n}/momentum`,variable:G(()=>Ee(s).variable(!1))});let i=this.accumulations[o].variable,a=Array.isArray(e)?e[o].tensor:e[n];a!=null&&G(()=>{let l,u=te(L(this.m,i),a);this.useNesterov?l=te(L(this.c,te(a,L(u,this.m))),s):l=te(L(this.c,u),s),i.assign(u),s.assign(l)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&Me(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);let r=!1;this.accumulations=e.map(n=>({originalName:n.name,variable:n.tensor.variable(r)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,r){return new e(r.learningRate,r.momentum,r.useNesterov)}};Ym.className="Momentum";oo(Ym);var Qm=class extends yn{constructor(e,r=.9,n=0,o=null,s=!1){if(super(),this.learningRate=e,this.decay=r,this.momentum=n,this.epsilon=o,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=s,o==null&&(this.epsilon=E.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(n=>n.name):Object.keys(e)).forEach((n,o)=>{let s=E.registeredVariables[n],i=!1;this.accumulatedMeanSquares[o]==null&&(this.accumulatedMeanSquares[o]={originalName:`${n}/rms`,variable:G(()=>Ee(s).variable(i))}),this.accumulatedMoments[o]==null&&(this.accumulatedMoments[o]={originalName:`${n}/momentum`,variable:G(()=>Ee(s).variable(i))}),this.accumulatedMeanGrads[o]==null&&this.centered&&(this.accumulatedMeanGrads[o]={originalName:`${n}/mg`,variable:G(()=>Ee(s).variable(i))});let a=Array.isArray(e)?e[o].tensor:e[n];if(a==null)return;let l=this.accumulatedMeanSquares[o].variable,u=this.accumulatedMoments[o].variable;G(()=>{let c=te(L(l,this.decay),L(Ke(a),1-this.decay));if(this.centered){let p=this.accumulatedMeanGrads[o].variable,f=te(L(p,this.decay),L(a,1-this.decay)),d=xe(L(a,this.learningRate),Ft(Se(c,te(Ke(f),this.epsilon)))),m=te(L(u,this.momentum),d);l.assign(c),p.assign(f),u.assign(m);let h=Se(s,m);s.assign(h)}else{let p=te(L(l,this.decay),L(Ke(a),1-this.decay)),f=te(L(u,this.momentum),xe(L(a,this.learningRate),Ft(te(p,this.epsilon))));l.assign(p),u.assign(f);let d=Se(s,f);s.assign(d)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&Me(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&Me(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&Me(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){let e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(r=>({name:r.originalName,tensor:r.variable})))}async setWeights(e){e=await this.extractIterations(e);let r=this.centered?e.length/3:e.length/2,n=!1;this.accumulatedMeanSquares=e.slice(0,r).map(o=>({originalName:o.name,variable:o.tensor.variable(n)})),this.accumulatedMoments=e.slice(r,r*2).map(o=>({originalName:o.name,variable:o.tensor.variable(n)})),this.centered&&(this.accumulatedMeanGrads=e.slice(r*2,r*3).map(o=>({originalName:o.name,variable:o.tensor.variable(n)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,r){return new e(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)}};Qm.className="RMSProp";oo(Qm);var qi=class{static sgd(e){return new yc(e)}static momentum(e,r,n=!1){return new Ym(e,r,n)}static rmsprop(e,r=.9,n=0,o=null,s=!1){return new Qm(e,r,n,o,s)}static adam(e=.001,r=.9,n=.999,o=null){return new Km(e,r,n,o)}static adadelta(e=.001,r=.95,n=null){return new qm(e,r,n)}static adamax(e=.002,r=.9,n=.999,o=null,s=0){return new Xm(e,r,n,o,s)}static adagrad(e,r=.1){return new jm(e,r)}};var ff={sgd:qi.sgd,momentum:qi.momentum,adadelta:qi.adadelta,adagrad:qi.adagrad,rmsprop:qi.rmsprop,adamax:qi.adamax,adam:qi.adam};var Fre=(()=>typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:t=>t())();function Zx(){return new Promise(t=>Fre(()=>t()))}var T={};qo(T,{ERF_A1:()=>Yre,ERF_A2:()=>Qre,ERF_A3:()=>Zre,ERF_A4:()=>Jre,ERF_A5:()=>ene,ERF_P:()=>Xre,PARALLELIZE_THRESHOLD:()=>V1,RowPartitionType:()=>ji,SELU_SCALE:()=>sE,SELU_SCALEALPHA:()=>oE,applyActivation:()=>uf,assertAndGetBroadcastShape:()=>Ve,assertAxesAreInnerMostDims:()=>bee,assertParamsConsistent:()=>Pre,assignToTypedArray:()=>ine,axesAreInnerMostDims:()=>$2,calculateShapes:()=>ZZ,checkEinsumDimSizes:()=>fne,checkPadOnDimRoundingMode:()=>It,combineLocations:()=>pL,combineRaggedTensorToTensorShapes:()=>Mre,complexWithEvenIndex:()=>nne,complexWithOddIndex:()=>one,computeConv2DInfo:()=>Xp,computeConv3DInfo:()=>nL,computeDefaultPad:()=>b2,computeDilation2DInfo:()=>kJ,computeOptimalWindowSize:()=>Wre,computeOutAndReduceShapes:()=>R2,computeOutShape:()=>Lre,computePool2DInfo:()=>y2,computePool3DInfo:()=>TJ,convertConv2DDataFormat:()=>oL,decodeEinsumEquation:()=>cne,eitherStridesOrDilationsAreOne:()=>on,expandShapeToKeepDim:()=>Ui,exponent:()=>lne,exponents:()=>ane,fromStringArrayToUint8:()=>Rne,fromUint8ToStringArray:()=>$ne,getAxesPermutation:()=>O2,getBroadcastDims:()=>WP,getComplexWithIndex:()=>sne,getEinsumComputePath:()=>dne,getEinsumPermutation:()=>pne,getFusedBiasGradient:()=>lf,getFusedDyActivation:()=>af,getImageCenter:()=>Gre,getInnerMostAxes:()=>vee,getPermuted:()=>Hre,getRaggedRank:()=>Bre,getReductionAxes:()=>vt,getReshaped:()=>Ure,getReshapedPermuted:()=>qre,getRowPartitionTypesHelper:()=>zre,getSliceBeginCoords:()=>jre,getSliceSize:()=>Kre,getSparseFillEmptyRowsIndicesDenseShapeMismatch:()=>xne,getSparseFillEmptyRowsNegativeIndexErrorMessage:()=>yne,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:()=>bne,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:()=>Cne,getSparseReshapeInputOutputMismatchErrorMessage:()=>kne,getSparseReshapeInputOutputMultipleErrorMessage:()=>Sne,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:()=>vne,getSparseReshapeNegativeOutputDimErrorMessage:()=>wne,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:()=>Ene,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:()=>Tne,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:()=>Nne,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:()=>Ine,getUndoAxesPermutation:()=>Lx,isIdentityPermutation:()=>mne,log:()=>BQ,mergeRealAndImagArrays:()=>tne,prepareAndValidate:()=>YZ,prepareSplitSize:()=>gne,segment_util:()=>aE,shouldFuse:()=>cf,slice_util:()=>Hr,splitRealAndImagArrays:()=>rne,tupleValuesAreOne:()=>Xo,upcastType:()=>wr,validateDefaultValueShape:()=>Vre,validateInput:()=>QZ,validateUpdateShape:()=>HP,warn:()=>Mi});function Pre(t,e){let r=t[0].length;t.forEach((o,s)=>{D(o.length===r,()=>`Error in concat${r}D: rank of tensors[${s}] must be the same as the rank of the rest (${r})`)}),D(e>=0&&e<r,()=>`Error in concat${r}D: axis must be between 0 and ${r-1}.`);let n=t[0];t.forEach((o,s)=>{for(let i=0;i<r;i++)D(i===e||o[i]===n[i],()=>`Error in concat${r}D: Shape of tensors[${s}] (${o}) does not match the shape of the rest (${n}) along the non-concatenated axis ${s}.`)})}function Lre(t,e){let r=t[0].slice();for(let n=1;n<t.length;n++)r[e]+=t[n][e];return r}var ji;(function(t){t[t.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",t[t.VALUE_ROWIDS=1]="VALUE_ROWIDS",t[t.ROW_LENGTHS=2]="ROW_LENGTHS",t[t.ROW_SPLITS=3]="ROW_SPLITS",t[t.ROW_LIMITS=4]="ROW_LIMITS",t[t.ROW_STARTS=5]="ROW_STARTS"})(ji||(ji={}));function Mre(t,e,r){let n=new Array;if(r==null&&e==null)return n;if(e==null)for(;n.length<t+r.length;)n.push(-1);else n=e.slice();if(r==null)return n;if(t+r.length!==n.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${t+r.length}, but shape.rank = ${n.length}`);for(let o=1;o<r.length;++o){let s=r[o],i=n[n.length-r.length+o],a=n[i];if(s>=0)if(a>=0){if(a!==s)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${o+t}] = ${s} but shape[${o+t}] = ${a}`)}else n[i]=s}return n}function zre(t){let e={FIRST_DIM_SIZE:ji.FIRST_DIM_SIZE,VALUE_ROWIDS:ji.VALUE_ROWIDS,ROW_LENGTHS:ji.ROW_LENGTHS,ROW_SPLITS:ji.ROW_SPLITS,ROW_LIMITS:ji.ROW_LIMITS,ROW_STARTS:ji.ROW_STARTS},r=[];for(let n of t)if(n in e)r.push(e[n]);else break;return r}function Bre(t){return t.length===0?0:t[0]===ji.FIRST_DIM_SIZE?t.length-1:t.length}function Vre(t,e){if(t==null||e==null)return;let r=t.length,n=e.length;if(r>=n)throw new Error(`defaultValue.shape=${t} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${r} must be less than ragged tensor input flatValues.rank = ${n})`);for(let o=0;o<Math.min(r,n-1);++o){let s=t[o],i=e[o+1];if(s>=0&&i>=0&&s!==1&&s!==i)throw new Error(`defaultValue.shape=${t}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${o-t.length}] = ${s} but ragged tensor input.flatValues.shape[${o-t.length}] = ${i}`)}}var V1=30;function Wre(t){return t<=V1?t:Od(t,Math.floor(Math.sqrt(t)))}function Gre(t,e,r){let n=r*(typeof t=="number"?t:t[0]),o=e*(typeof t=="number"?t:t[1]);return[n,o]}function Ure(t,e,r,n=!0){let o=[];if(n)o=o.concat(e.slice(0)),o.push(t[0]/r),o=o.concat(t.slice(1));else{o=o.concat(t[0]);let s=e.length;for(let i=0;i<s;++i)o=o.concat([t[i+1]/e[i],e[i]]);o=o.concat(t.slice(s+1))}return o}function Hre(t,e,r=!0){let n=[];if(r){n.push(e);for(let o=e+1;o<t;++o)o<=2*e?(n.push(o),n.push(o-(e+1))):n.push(o)}else{let o=[],s=[];for(let i=1;i<t;++i)i>=e*2+1||i%2===1?s.push(i):o.push(i);n.push(...o),n.push(0),n.push(...s)}return n}function qre(t,e,r,n=!0){let o=[];n?o.push(t[0]/r):o.push(t[0]*r);for(let s=1;s<t.length;++s)s<=e.length?n?o.push(e[s-1]*t[s]):o.push(t[s]/e[s-1]):o.push(t[s]);return o}function jre(t,e){let r=[0];for(let n=0;n<e;++n)r.push(t[n][0]);return r}function Kre(t,e,r){let n=t.slice(0,1);for(let o=0;o<r;++o)n.push(t[o+1]-e[o][0]-e[o][1]);return n}var oE=1.7580993408473768,sE=1.0507009873554805;var Xre=.3275911,Yre=.254829592,Qre=-.284496736,Zre=1.421413741,Jre=-1.453152027,ene=1.061405429;function tne(t,e){if(t.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${t.length}, imag: ${e.length}.`);let r=new Float32Array(t.length*2);for(let n=0;n<r.length;n+=2)r[n]=t[n/2],r[n+1]=e[n/2];return r}function rne(t){let e=new Float32Array(t.length/2),r=new Float32Array(t.length/2);for(let n=0;n<t.length;n+=2)e[n/2]=t[n],r[n/2]=t[n+1];return{real:e,imag:r}}function nne(t){let e=Math.ceil(t.length/4),r=new Float32Array(e),n=new Float32Array(e);for(let o=0;o<t.length;o+=4)r[Math.floor(o/4)]=t[o],n[Math.floor(o/4)]=t[o+1];return{real:r,imag:n}}function one(t){let e=Math.floor(t.length/4),r=new Float32Array(e),n=new Float32Array(e);for(let o=2;o<t.length;o+=4)r[Math.floor(o/4)]=t[o],n[Math.floor(o/4)]=t[o+1];return{real:r,imag:n}}function sne(t,e){let r=t[e*2],n=t[e*2+1];return{real:r,imag:n}}function ine(t,e,r,n){t[n*2]=e,t[n*2+1]=r}function ane(t,e){let r=new Float32Array(t/2),n=new Float32Array(t/2);for(let o=0;o<Math.ceil(t/2);o++){let s=(e?2:-2)*Math.PI*(o/t);r[o]=Math.cos(s),n[o]=Math.sin(s)}return{real:r,imag:n}}function lne(t,e,r){let n=(r?2:-2)*Math.PI*(t/e),o=Math.cos(n),s=Math.sin(n);return{real:o,imag:s}}var iE="->",une=/->/g,pM=",",fM="...";function cne(t,e){t=t.replace(/\s/g,"");let r=(t.length-t.replace(une,"").length)/iE.length;if(r<1)throw new Error("Equations without an arrow are not supported.");if(r>1)throw new Error(`Equation must contain exactly one arrow ("${iE}").`);let[n,o]=t.split(iE);D(n.indexOf(fM)===-1,()=>`The ellipsis notation ("${fM}") is not supported yet.`);let s=n.split(pM),i=s.length;if(e!==i)throw new Error(`Expected ${i} input tensors, received ${e}`);if(i>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");let a=[];for(let f=0;f<o.length;++f){let d=o[f];if(!s.some(m=>m.indexOf(d)!==-1))throw new Error(`Output subscripts contain the label ${d} not present in the input subscripts.`);a.indexOf(d)===-1&&a.push(d)}for(let f=0;f<n.length;++f){let d=n[f];a.indexOf(d)===-1&&d!==pM&&a.push(d)}let l=new Array(s.length);for(let f=0;f<i;++f){if(new Set(s[f].split("")).size!==s[f].length)throw new Error(`Found duplicate axes in input component ${s[f]}. Support for duplicate axes in input is not implemented yet.`);l[f]=[];for(let d=0;d<s[f].length;++d)l[f].push(a.indexOf(s[f][d]))}let u=a.length,c=o.length,p=[];for(let f=c;f<u;++f)p.push(f);return{allDims:a,summedDims:p,idDims:l}}function pne(t,e){let r=new Array(t);r.fill(-1);for(let o=0;o<e.length;++o)r[e[o]]=o;let n=[];for(let o=0;o<t;++o)r[o]===-1&&n.push(o);return r=r.filter(o=>o!==-1),{permutationIndices:r,expandDims:n}}function fne(t,e,r){let n=new Array(t);for(let o=0;o<r.length;++o){let s=r[o].shape;for(let i=0;i<e[o].length;++i)n[e[o][i]]===void 0?n[e[o][i]]=s[i]:D(n[e[o][i]]===s[i],()=>`Expected dimension ${n[e[o][i]]} at axis ${i} of input shaped ${JSON.stringify(s)}, but got dimension ${s[i]}`)}}function dne(t,e){let r=t,n=[],o=0;t.length===0&&r.push(-1),o=t.length+1;for(let i=0;i<o;++i)n.push([]);let s=[];for(let i=0;i<r.length;++i){let a=r[i],l=hne(e,a);for(let u of l)s.indexOf(u)===-1&&(n[i].push(u),s.push(u))}return{path:r,steps:n}}function mne(t){return t.every((e,r)=>e===r)}function hne(t,e){let r=[];for(let n=0;n<t.length;++n)(t[n].length===0||t[n].indexOf(e)!==-1||e===-1)&&r.push(n);return r}function gne(t,e,r=0){let n=[];if(typeof e=="number")D(t.shape[r]%e===0,()=>"Number of splits must evenly divide the axis."),n=new Array(e).fill(t.shape[r]/e);else{let o=e.reduce((i,a)=>(a===-1&&(i+=1),i),0);D(o<=1,()=>"There should be only one negative value in split array.");let s=e.indexOf(-1);if(s!==-1){let i=e.reduce((a,l)=>l>0?a+l:a);e[s]=t.shape[r]-i}D(t.shape[r]===e.reduce((i,a)=>i+a),()=>"The sum of sizes must match the size of the axis dimension."),n=e}return n}function xne(t){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${t}`}function yne(t,e){return`indices(${t}, 0) is invalid: ${e} < 0`}function bne(t,e,r){return`indices(${t}, 0) is invalid: ${e} >= ${r}`}function vne(t,e){return`only one output dimension may be -1, not both ${t} and ${e}`}function wne(t,e){return`size ${t} must be non-negative, not ${e}`}function Cne(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function Sne(t,e){let r=at(t),n=at(e);return`Input to reshape is a SparseTensor with ${r}
  dense values, but the requested shape requires a multiple of ${n}. inputShape=${t} outputShape= ${e}`}function kne(t,e){let r=at(t),n=at(e);return`Input to reshape is a tensor with ${r} dense values, but the requested shape has ${n}. inputShape=${t} outputShape=${e}`}function Tne(){return"segment ids must be >= 0"}function Nne(){return"segment ids are not increasing"}function Ine(t,e){return`Segment id ${t} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function Ene(t,e,r){return`Bad: indices[${t}] == ${e} out of range [0, ${r})`}var aE={};qo(aE,{collectGatherOpShapeInfo:()=>Dne,computeOutShape:()=>Ane,segOpComputeOptimalWindowSize:()=>_ne});function _ne(t,e){let r=!1,n;for(t<=V1?(n=t,r=!0):n=Od(t,Math.floor(Math.sqrt(t)));!r;)n>e||n===t?r=!0:n=Od(t,n+1);return n}function Ane(t,e,r){let n=[],o=t.length;for(let s=0;s<o;s++)s!==e?n.push(t[s]):n.push(r);return n}function Dne(t,e,r,n){let o=e.shape.length,s=t.shape.length;if(n!==0&&(n<-o||n>o))throw new Error(`Expect batchDims in the range of [-${o}, ${o}], but got ${n}`);if(n<0&&(n+=o),n>s)throw new Error(`batchDims (${n}) must be less than rank(x) (
    ${s}).`);if(r<n)throw new Error(`batchDims (${n}) must be less than or equal to axis (${r}).`);for(let p=0;p<n;++p)if(t.shape[p]!==e.shape[p])throw new Error(`x.shape[${p}]: ${t.shape[p]} should be equal to indices.shape[${p}]: ${e.shape[p]}.`);let i=t.shape[r],a=[],l=1,u=1,c=1;for(let p=0;p<n;++p)a.push(t.shape[p]),l*=t.shape[p];for(let p=n;p<r;p++)a.push(t.shape[p]),u*=t.shape[p];for(let p=n;p<o;p++)a.push(e.shape[p]);for(let p=r+1;p<s;p++)a.push(t.shape[p]),c*=t.shape[p];return{batchSize:l,sliceSize:c,outerSize:u,dimSize:i,outputShape:a}}function $ne(t){try{return t.map(e=>Tm(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function Rne(t){return t.map(e=>km(e))}var bn={};qo(bn,{nonMaxSuppressionV3Impl:()=>P1,nonMaxSuppressionV4Impl:()=>L1,nonMaxSuppressionV5Impl:()=>M1,whereImpl:()=>BL});var W1={kernelName:yu,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>L(t,ii(oe(r,"float32"),-1))}}};var dM={kernelName:va,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>{let n=Ke(oe(r,"float32")),o=Ft(Se(Oe(1),n));return st(xe(t,o))}}}};var mM={kernelName:wa,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>{let n=Ft(Se(Ke(oe(r,"float32")),1));return xe(t,n)}}}};var hM={kernelName:ri,inputsToSave:["a","b"],gradFunc:(t,e)=>{let[r,n]=e,o=Ve(r.shape,n.shape);return{a:()=>{let a=t,l=vt(r.shape,o);return l.length>0&&(a=ye(a,l)),M(a,r.shape)},b:()=>{let a=t,l=vt(n.shape,o);return l.length>0&&(a=ye(a,l)),M(a,n.shape)}}}};var gM={kernelName:Pd,saveAllInputs:!0,gradFunc:(t,e)=>{let r={};return e.forEach((n,o)=>{r[o]=()=>t.clone()}),r}};var xM={kernelName:bu,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>Ee(r)}}};var yM={kernelName:vu,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>Ee(r)}}};var bM={kernelName:Ca,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>xe(t,Ft(Se(Oe(1),Ke(oe(r,"float32")))))}}};var vM={kernelName:Sa,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>{let n=Ft(te(Oe(1),Ke(oe(r,"float32"))));return xe(t,n)}}}};var wM={kernelName:Na,inputsToSave:["a","b"],gradFunc:(t,e)=>{let[r,n]=e,o=Ve(r.shape,n.shape);return{a:()=>{let a=te(Ke(r),Ke(n)),l=L(t,xe(n,a)),u=vt(r.shape,o);return u.length>0&&(l=ye(l,u)),M(l,r.shape)},b:()=>{let a=te(Ke(r),Ke(n)),l=st(L(t,xe(r,a))),u=vt(n.shape,o);return u.length>0&&(l=ye(l,u)),M(l,n.shape)}}}};var CM={kernelName:ka,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>xe(t,te(Ke(oe(r,"float32")),1))}}};var SM={kernelName:Ta,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>xe(t,Se(Oe(1),Ke(oe(r,"float32"))))}}};function One(t,e,r,n,o,s){let i=N(t,"dy","avgPool3dGrad"),a=N(e,"input","avgPool3dGrad"),l=i,u=a,c=!1;a.rank===4&&(c=!0,l=M(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]]),u=M(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),D(l.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),D(u.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${u.rank}.`),It("avgPool3dGrad",o,s);let p={dy:l,input:u},f={filterSize:r,strides:n,pad:o,dimRoundingMode:s},d=E.runKernel(Bd,p,f);return c?M(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}var kM=_({avgPool3dGrad_:One});var TM={kernelName:Cu,inputsToSave:["x"],gradFunc:(t,e,r)=>{let[n]=e,{filterSize:o,strides:s,pad:i,dimRoundingMode:a}=r;return{x:()=>kM(t,n,o,s,i,a)}}};function Fne(t,e,r,n,o){let s=N(t,"dy","avgPoolGrad"),i=N(e,"input","avgPoolGrad");D(i.rank===s.rank,()=>`Rank of input (${i.rank}) does not match rank of dy (${s.rank})`);let a=i,l=s,u=!1;i.rank===3&&(u=!0,a=M(i,[1,i.shape[0],i.shape[1],i.shape[2]]),l=M(s,[1,s.shape[0],s.shape[1],s.shape[2]])),D(l.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),D(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);let c={dy:l,input:a},p={filterSize:r,strides:n,pad:o},f=E.runKernel(zd,c,p);return u?M(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var NM=_({avgPoolGrad_:Fne});var IM={kernelName:wu,inputsToSave:["x"],gradFunc:(t,e,r)=>{let[n]=e,{filterSize:o,strides:s,pad:i}=r;return{x:()=>NM(t,n,o,s,i)}}};var EM={kernelName:Su,inputsToSave:["a","b"],gradFunc:(t,e,r)=>{let[n,o]=e,{transposeA:s,transposeB:i}=r;return!s&&!i?{a:()=>ot(t,o,!1,!0),b:()=>ot(n,t,!0,!1)}:!s&&i?{a:()=>ot(t,o,!1,!1),b:()=>ot(t,n,!0,!1)}:s&&!i?{a:()=>ot(o,t,!1,!0),b:()=>ot(n,t,!1,!1)}:{a:()=>ot(o,t,!0,!0),b:()=>ot(t,n,!0,!0)}}};var _M={kernelName:ku,gradFunc:(t,e,r)=>{let{blockShape:n,crops:o}=r;return{x:()=>Vm(t,n,o)}}};var AM={kernelName:FF,gradFunc:(t,e,r)=>{let n=r,o=n.inputShape,s=n.shape,i=Array.from(s);for(let l=o.length-1;l>=0;l--)if(o[l]===s[l])i[l]=1;else if(o[l]!==1)throw new Error(`broadcastTo(): [${o}] cannot be broadcast to [${s}].`);let a=[];for(let l=0;l<i.length;l++)i[l]>1&&a.push(l);return{x:()=>ye(t,a,!0)}}};var DM={kernelName:Oi,gradFunc:t=>({x:()=>t.clone()})};var $M={kernelName:Ia,gradFunc:t=>({x:()=>Ee(t)})};var RM={kernelName:Ea,inputsToSave:["x"],gradFunc:(t,e,r)=>{let[n]=e,{clipValueMin:o,clipValueMax:s}=r;return{x:()=>Vt(_n(so(n,o),ws(n,s)),t,Ee(t))}}};var OM={kernelName:Tu,inputsToSave:["x"],gradFunc:W1.gradFunc};var FM={kernelName:Nu,saveAllInputs:!0,gradFunc:(t,e,r)=>{let n=e.map(l=>l.shape),{axis:o}=r,s=Dr(o,e[0].shape)[0],i=n.map(l=>l[s]);return Lr(t,i,s).map(l=>()=>l)}};var PM={kernelName:Iu,inputsToSave:["x","filter"],gradFunc:(t,e,r)=>{let[n,o]=e,{dilations:s,strides:i,pad:a,dataFormat:l}=r;return D(Xo(s),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`),{x:()=>Lm(n.shape,t,o,i,a,l),filter:()=>Hm(n,t,o.shape,i,a,l)}}};var LM={kernelName:Eu,inputsToSave:["dy","filter"],gradFunc:(t,e,r)=>{let[n,o]=e,{strides:s,pad:i,dataFormat:a,dimRoundingMode:l}=r;return{dy:()=>Io(t,o,s,i,a,1,l),filter:()=>Hm(t,n,o.shape,s,i,a,l)}}};function Pne(t,e,r,n,o){let s=t;t.rank===4&&(s=M(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]));let i=e;i.rank===4&&(i=M(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),D(s.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${s.shape}.`),D(i.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${i.shape}.`),D(r.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${r}.`),D(s.shape[4]===r[3],()=>`Error in conv3dDerFilter: depth of input ${s.shape[4]}) must match input depth in filter (${r[3]}.`),D(i.shape[4]===r[4],()=>`Error in conv3dDerFilter: depth of dy (${i.shape[4]}) must match output depth for filter (${r[4]}).`);let a={x:s,dy:i},l={strides:n,pad:o,filterShape:r};return E.runKernel(Ud,a,l)}var MM=_({conv3DBackpropFilter_:Pne});var zM={kernelName:_u,inputsToSave:["x","filter"],gradFunc:(t,e,r)=>{let{dilations:n,strides:o,pad:s}=r;D(Xo(n),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${n}'`);let[i,a]=e;return{x:()=>S1(i.shape,t,a,o,s),filter:()=>MM(i,t,a.shape,o,s)}}};var BM={kernelName:_a,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>L(st(Hx(oe(r,"float32"))),t)}}};var VM={kernelName:Aa,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>L(qx(oe(r,"float32")),t)}}};var WM={kernelName:Au,inputsToSave:["x"],gradFunc:(t,e,r)=>{let[n]=e,{axis:o,exclusive:s,reverse:i}=r;return{x:()=>{let a=O2([o],n.rank),l=k1(t,o,s,!i);return a!=null&&(l=Ue(l,a)),l}}}};var GM={kernelName:Du,inputsToSave:["x","filter"],gradFunc:(t,e,r)=>{let{dilations:n,strides:o,pad:s,dimRoundingMode:i}=r,a=n??[1,1];D(Xo(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);let[l,u]=e;return D(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),D(u.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${u.rank}.`),D(l.shape[3]===u.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${u.shape[2]}.`),D(on(o,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${o} and dilations '${a}'.`),It("depthwiseConv2d",s,i),{x:()=>F1(l.shape,t,u,o,s,a,i),filter:()=>O1(l,t,u.shape,o,s,a,i)}}};var UM={kernelName:$u,inputsToSave:["x","filter"],gradFunc:(t,e,r)=>{let[n,o]=e,s={x:n,filter:o,dy:t},i={x:n,filter:o,dy:t};return{x:()=>E.runKernel(gx,s,r),filter:()=>E.runKernel(xx,i,r)}}};var HM={kernelName:$a,outputsToSave:[!0],gradFunc:(t,e)=>{let[r]=e,n={dy:t,y:r};return{x:()=>E.runKernel(Jd,n)}}};var qM={kernelName:Ra,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e,n=L(gn(st(Ke(r))),2/Math.sqrt(Math.PI));return{x:()=>L(t,n)}}};var jM={kernelName:Oa,outputsToSave:[!0],gradFunc:(t,e)=>{let[r]=e;return{x:()=>L(t,r)}}};var KM={kernelName:Ru,inputsToSave:["input"],gradFunc:(t,e)=>{let[r]=e;return{input:()=>M(t,r.shape)}}};var XM={kernelName:Fa,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>L(t,gn(r))}}};var YM={kernelName:Pa,gradFunc:t=>({x:()=>Ee(t)})};var QM={kernelName:La,inputsToSave:["a","b"],gradFunc:(t,e)=>{let[r,n]=e,o=Ve(r.shape,n.shape);return{a:()=>{let a=xe(t,oe(n,"float32")),l=vt(r.shape,o);return l.length>0?M(ye(a,l),r.shape):a},b:()=>{let a=L(t,oe(r,"float32")),l=vt(n.shape,o);l.length>0&&(a=M(ye(a,l),n.shape));let u=Ke(n);return st(xe(a,oe(u,"float32")))}}}};var ZM={kernelName:Ou,inputsToSave:["x","mean","variance","scale"],gradFunc:(t,e,r)=>{let{varianceEpsilon:n}=r,[o,s,i,a]=e,l=a??Oe(1),u=vt(s.shape,o.shape),c=[];if(s.rank===1){for(let v=0;v<o.shape.length-1;++v)c.push(o.shape[v]);c.push(1)}let p=Se(o,s),f=L(t,l),d=Wx(te(i,Oe(n))),m=L(L(L(d,d),d),Oe(-.5));return{x:()=>s.rank===1?M(L(L(t,xn(M(d,[1,1,1,s.shape[0]]),c)),l),o.shape):M(L(L(t,d),l),o.shape),mean:()=>{let v=L(L(d,Oe(-1)),f);return s.rank===1&&(v=ye(v,u)),M(v,s.shape)},variance:()=>{let v=L(L(m,p),f);return s.rank===1&&(v=ye(v,u)),M(v,s.shape)},scale:()=>{let v=L(p,d),C=L(t,v);return s.rank===1&&(C=ye(C,u)),M(C,s.shape)},offset:()=>{let v=t;return s.rank===1&&(v=ye(v,u)),M(v,s.shape)}}}};var t3={kernelName:Fu,inputsToSave:["x","indices"],gradFunc:(t,e,r)=>{let[n,o]=e,{axis:s}=r,i=Dr(s,n.shape)[0];return{x:()=>{let l=n.shape,u=o.size,c=l.slice(0,i),p=c.length,f=l.slice(s,l.length).slice(1),d=f.length,m=JM(0,p),h=JM(p+1,p+1+d),x=e3([c,[u],f]),g=M(t,x),y=M(o,[u]),b=e3([[p],m,h]),v=Ue(g,b),C=R1(v,y,n.shape[i]),S=Lx(b);return C=Ue(C,S),C},indices:()=>o}}};function JM(t,e){let r=[];for(let n=t;n<e;++n)r.push(n);return r}function e3(t){let e=[];for(let r=0;r<t.length;++r)for(let n=0;n<t[r].length;++n)e.push(t[r][n]);return e}var r3={kernelName:Ma,inputsToSave:["a","b"],gradFunc:(t,e)=>{let[r,n]=e;return{a:()=>Ee(r),b:()=>Ee(n)}}};var n3={kernelName:Fi,gradFunc:t=>({x:()=>oe(t,"float32")})};var o3={kernelName:za,gradFunc:t=>({x:()=>Ee(t)})};var s3={kernelName:Ba,gradFunc:t=>({x:()=>Ee(t)})};var i3={kernelName:Va,gradFunc:t=>({x:()=>Ee(t)})};var a3={kernelName:Pu,inputsToSave:["x"],gradFunc:(t,e,r)=>{let[n]=e,{alpha:o}=r,s=tr(n,0);return{x:()=>Vt(s,t,L(t,o))}}};var l3={kernelName:Ga,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>xe(t,te(r,1))}}};var u3={kernelName:Wa,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>xe(t,oe(r,"float32"))}}};var c3={kernelName:PF,inputsToSave:[],outputsToSave:[!0],gradFunc:(t,e,r)=>{let[n]=e,{axis:o}=r;return{logits:()=>{let i=gn(n);return Se(t,L(ye(t,o,!0),i))}}}};function Lne(t,e,r,n=5,o=1,s=1,i=.5){let a={x:t,y:e,dy:r},l={depthRadius:n,bias:o,alpha:s,beta:i};return E.runKernel(sm,a,l)}var p3=_({localResponseNormalizationBackprop_:Lne});var f3={kernelName:Lu,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,r)=>{let[n,o]=e,{depthRadius:s,bias:i,alpha:a,beta:l}=r;return{x:()=>p3(n,o,t,s,i,a,l)}}};function G1(t,e,r,n){return e.rank<r.rank&&(e=M(e,Ui(e.shape,n))),t.rank<r.rank&&(t=M(t,Ui(t.shape,n))),{x:()=>L(t,oe(Un(r,e),t.dtype))}}var lE={kernelName:Mu,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,r)=>{let n=r,{reductionIndices:o}=n,s=e[0],i=e[1],a=Dr(o,s.shape),l=G1(t,i,s,a);return{x:()=>l.x()}}};var d3={kernelName:Ua,inputsToSave:["a","b"],gradFunc:(t,e)=>{let[r,n]=e;return{a:()=>L(t,oe(so(r,n),"float32")),b:()=>L(t,oe(N1(r,n),"float32"))}}};function Mne(t,e,r,n,o,s,i){let a=N(t,"dy","maxPool3dGrad"),l=N(e,"input","maxPool3dGrad"),u=N(r,"output","maxPool3dGrad"),c=a,p=l,f=u,d=!1;l.rank===4&&(d=!0,c=M(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),p=M(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),f=M(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]])),D(c.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${c.rank}.`),D(p.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${p.rank}.`),D(f.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${f.rank}.`),It("maxPool3dGrad",s,i);let m={dy:c,input:p,output:f},h={filterSize:n,strides:o,pad:s,dimRoundingMode:i},x=E.runKernel(am,m,h);return d?M(x,[x.shape[1],x.shape[2],x.shape[3],x.shape[4]]):x}var m3=_({maxPool3dGrad_:Mne});var h3={kernelName:Bu,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,r)=>{let[n,o]=e,{filterSize:s,strides:i,pad:a,dimRoundingMode:l}=r;return{x:()=>m3(t,n,o,s,i,a,l)}}};function zne(t,e,r,n,o,s,i){let a=N(t,"dy","maxPoolGrad"),l=N(e,"input","maxPoolGrad"),u=N(r,"output","maxPoolGrad");D(l.rank===a.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${a.rank})`),D(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),D(l.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`),It("maxPoolGrad",s,i);let c={dy:a,input:l,output:u},p={filterSize:n,strides:o,pad:s,dimRoundingMode:i};return E.runKernel(im,c,p)}var g3=_({maxPoolGrad_:zne});var x3={kernelName:zu,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,r)=>{let[n,o]=e,{filterSize:s,strides:i,pad:a}=r;return{x:()=>g3(t,n,o,s,i,a)}}};var y3={kernelName:Vu,inputsToSave:["x"],gradFunc:(t,e,r)=>{let[n]=e,{axis:o}=r,s=Dr(o,n.shape),a=R2(n.shape,s)[1],l=at(a);return{x:()=>{let c=n.shape.slice();s.forEach(d=>{c[d]=1});let p=M(t,c);return xe(L(p,_o(n.shape,"float32")),l)}}}};var b3={kernelName:Wu,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,r)=>{let n=r,{axis:o}=n,[s,i]=e,a=Dr(o,s.shape),l=G1(t,i,s,a);return{x:()=>l.x()}}};var v3={kernelName:Ha,inputsToSave:["a","b"],gradFunc:(t,e)=>{let[r,n]=e;return{a:()=>L(t,oe(ws(r,n),"float32")),b:()=>L(t,oe(tr(r,n),"float32"))}}};var w3={kernelName:Gu,inputsToSave:["x"],gradFunc:(t,e,r)=>{let n=e[0],{paddings:o}=r,s=o.map(i=>i[0]);return{x:()=>tt(t,s,n.shape)}}};var C3={kernelName:qa,inputsToSave:["a","b"],gradFunc:(t,e)=>{let[r,n]=e,o=Ve(r.shape,n.shape);return{a:()=>{let a=vt(r.shape,o);return a.length>0?M(ye(t,a),r.shape):t},b:()=>{let a=L(t,st(Cl(xe(r,n)))),l=vt(n.shape,o);return l.length>0?M(ye(a,l),n.shape):a}}}};var S3={kernelName:ja,inputsToSave:["a","b"],gradFunc:(t,e)=>{let[r,n]=e,o=Ve(r.shape,n.shape);return{a:()=>{let a=L(t,oe(n,"float32")),l=vt(r.shape,o);return l.length>0?M(ye(a,l),r.shape):a},b:()=>{let a=L(t,oe(r,"float32")),l=vt(n.shape,o);return l.length>0?M(ye(a,l),n.shape):a}}}};var k3={kernelName:Uu,gradFunc:t=>({x:()=>st(t)})};var T3={kernelName:qu,inputsToSave:["indices"],gradFunc:(t,e)=>{let r=e[0];return{indices:()=>Pt(r.shape,"float32")}}};var N3={kernelName:Hu,gradFunc:t=>({x:()=>Ee(t)})};var I3={kernelName:ju,saveAllInputs:!0,gradFunc:(t,e,r)=>{let{axis:n}=r;return An(t,n).map(s=>()=>s)}};var uE={kernelName:Ku,inputsToSave:["x"],gradFunc:(t,e,r)=>{let n=e[0],{paddings:o}=r,s=o.map(i=>i[0]);return{x:()=>tt(t,s,n.shape)}}};var E3={kernelName:Ka,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(t,e)=>{let[r,n,o]=e,s=r,i=n,a=Ve(s.shape,i.shape);return{a:()=>{let c=oe(i,"float32"),p=L(t,L(c,vs(s,Se(c,Oe(1))))),f=vt(s.shape,a);return f.length>0&&(p=ye(p,f)),M(p,s.shape)},b:()=>{let c=tr(s,0),p=Vt(c,Hn(s),Ee(s)),f=L(t,L(o,p)),d=vt(i.shape,a);return d.length>0&&(f=ye(f,d)),M(f,i.shape)}}}};var _3={kernelName:Xu,inputsToSave:["x","alpha"],gradFunc:(t,e)=>{let[r,n]=e,o=tr(r,0);return{x:()=>Vt(o,t,L(t,n)),alpha:()=>{let s=Vt(o,Ee(t),L(t,r)),i=vt(n.shape,t.shape);return i.length>0&&(s=ye(s,i)),M(s,n.shape)}}}};function Bne(t,e,r){let n=t.shape.slice();n[r]=1;let o=M(e,n),s=Fx(t,r,!0,!1),i=Fx(t,r,!0,!0),a=L(s,i);return L(o,a)}function Vne(t,e,r){let n=t.shape.length,o=n-r.length,s=T.getAxesPermutation(r,n),i=t;s!=null&&(i=Ue(t,s));let a=i.shape.slice(),u=a.splice(n-r.length,r.length).reduce((f,d)=>f*d,1);a.push(u);let c=i.reshape(a),p=Bne(c,e,o);if(p=p.reshape(i.shape),s!=null){let f=T.getUndoAxesPermutation(s);p=Ue(p,f)}return p}var A3={kernelName:Yu,inputsToSave:["x"],gradFunc:(t,e,r)=>{let[n]=e,{axis:o}=r,s=[];return o==null?s=n.shape.map((i,a)=>a):typeof o=="number"?s=[o]:s=o,{x:()=>Vne(n,t,s)}}};var D3={kernelName:Da,inputsToSave:["a","b"],gradFunc:(t,e)=>{let[r,n]=e,o=Ve(r.shape,n.shape);return{a:()=>{let a=xe(t,oe(n,"float32")),l=vt(r.shape,o);return l.length>0?M(ye(a,l),r.shape):a},b:()=>{let a=L(t,oe(r,"float32")),l=vt(n.shape,o);l.length>0&&(a=M(ye(a,l),n.shape));let u=Ke(n);return st(xe(a,oe(u,"float32")))}}}};var $3={kernelName:Xa,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>xe(t,st(Ke(r)))}}};var R3={kernelName:Qa,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e,n=L(ws(r,6),ii(r));return{x:()=>L(t,oe(n,"float32"))}}};var O3={kernelName:Ya,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>L(t,oe(ii(r),"float32"))}}};var F3={kernelName:Qu,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>M(t,r.shape)}}};var P3={kernelName:Ju,inputsToSave:["images"],gradFunc:(t,e,r)=>{let[n]=e,o={dy:t,images:n};return{images:()=>E.runKernel(mm,o,r)}}};var L3={kernelName:Zu,inputsToSave:["images"],gradFunc:(t,e,r)=>{let[n]=e,o={dy:t,images:n};return{images:()=>E.runKernel(dm,o,r)}}};var M3={kernelName:ec,gradFunc:(t,e,r)=>{let{dims:n}=r,o=Dr(n,t.shape);return{x:()=>Zo(t,o)}}};var z3={kernelName:Za,gradFunc:t=>({x:()=>Ee(t)})};var B3={kernelName:Ja,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>st(xe(t,L(vs(r,1.5),2)))}}};var V3={kernelName:tc,inputsToSave:["condition"],gradFunc:(t,e)=>{let[r]=e;return{condition:()=>oe(Ee(r),"float32"),t:()=>L(t,oe(r,t.dtype)),e:()=>L(t,oe(zm(r),t.dtype))}}};var W3={kernelName:el,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>{let n=tr(r,Oe(0)),o=Oe(oE),s=Oe(sE),i=L(t,s),a=L(L(t,o),gn(oe(r,"float32")));return Vt(n,i,a)}}}};var G3={kernelName:ol,outputsToSave:[!0],gradFunc:(t,e)=>{let[r]=e;return{x:()=>L(t,L(r,Se(Oe(1),r)))}}};var U3={kernelName:nl,gradFunc:t=>({x:()=>Ee(t)})};var H3={kernelName:tl,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>L(Qp(oe(r,"float32")),t)}}};var q3={kernelName:rl,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>L(Ox(oe(r,"float32")),t)}}};var j3={kernelName:rc,inputsToSave:["x"],gradFunc:(t,e,r)=>{let[n]=e,{begin:o,size:s}=r,i=n.shape,[a,l]=c2(n,o,s),u=[];for(let c=0;c<t.rank;c++)u.push([a[c],i[c]-a[c]-l[c]]);return{x:()=>rf(t,u)}}};var K3={kernelName:ic,outputsToSave:[!0],gradFunc:(t,e,r)=>{let[n]=e,{dim:o}=r,s=!0,i=L(t,n);return{logits:()=>Se(i,L(ye(i,[o],s),n))}}};var X3={kernelName:sl,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>L(t,bs(r))}}};var cE={kernelName:oc,gradFunc:(t,e,r)=>{let{blockShape:n,paddings:o}=r;return{x:()=>Pm(t,n,o)}}};var pE={kernelName:sc,gradFunc:(t,e,r)=>{let{axis:n}=r;return{x:()=>Ot(t,n)}}};var Y3={kernelName:il,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>xe(t,L(Ft(oe(r,"float32")),2))}}};var Q3={kernelName:hm,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>L(t,L(oe(r,"float32"),2))}}};var Z3={kernelName:al,inputsToSave:["a","b"],gradFunc:(t,e)=>{let[r,n]=e,o=Oe(2);return{a:()=>L(t,L(o,Se(r,n))),b:()=>L(t,L(o,Se(n,r)))}}};var J3={kernelName:pl,gradFunc:t=>({x:()=>Ee(t)})};var ez={kernelName:ll,inputsToSave:["a","b"],gradFunc:(t,e)=>{let[r,n]=e,o=Ve(r.shape,n.shape);return{a:()=>{let a=t,l=vt(r.shape,o);return l.length>0&&(a=ye(a,l)),M(a,r.shape)},b:()=>{let a=t,l=vt(n.shape,o);return l.length>0&&(a=ye(a,l)),M(st(a),n.shape)}}}};var tz={kernelName:nc,inputsToSave:["x"],gradFunc:(t,e,r)=>{let[n]=e,o=n.shape.slice(),{axis:s}=r;Dr(s,n.shape).forEach(u=>{o[u]=1});let a=M(t,o),l=L(a,_o(n.shape,"float32"));return{x:()=>l}}};var rz={kernelName:ul,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>xe(t,Ke(Qp(r)))}}};var nz={kernelName:cl,outputsToSave:[!0],gradFunc:(t,e)=>{let[r]=e;return{x:()=>L(Se(Oe(1),Ke(r)),t)}}};var oz={kernelName:Pi,inputsToSave:["x"],gradFunc:(t,e,r)=>{let[n]=e,{reps:o}=r;return{x:()=>{let i=Ee(n);if(n.rank===1)for(let a=0;a<o[0];++a)i=te(i,tt(t,[a*n.shape[0]],[n.shape[0]]));else if(n.rank===2)for(let a=0;a<o[0];++a)for(let l=0;l<o[1];++l)i=te(i,tt(t,[a*n.shape[0],l*n.shape[1]],[n.shape[0],n.shape[1]]));else if(n.rank===3)for(let a=0;a<o[0];++a)for(let l=0;l<o[1];++l)for(let u=0;u<o[2];++u)i=te(i,tt(t,[a*n.shape[0],l*n.shape[1],u*n.shape[2]],[n.shape[0],n.shape[1],n.shape[2]]));else if(n.rank===4)for(let a=0;a<o[0];++a)for(let l=0;l<o[1];++l)for(let u=0;u<o[2];++u)for(let c=0;c<o[3];++c)i=te(i,tt(t,[a*n.shape[0],l*n.shape[1],u*n.shape[2],c*n.shape[3]],[n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${n.rank} tensors yet.`);return i}}}};var sz={kernelName:Li,gradFunc:(t,e,r)=>{let n=r,{perm:o}=n,s=Lx(o);return{x:()=>Ue(t,s)}}};var iz={kernelName:ac,gradFunc:(t,e,r)=>{let n=r,{axis:o}=n;return{value:()=>Mr(t,o)}}};var az={kernelName:lc,inputsToSave:["segmentIds"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>Wne(t,r)}}};function Wne(t,e){let r=Eo(e,Ee(e)),n=Zp(t,r),o=so(e,Oe(0,"int32")),s=n.rank-o.rank;for(let a=0;a<s;++a)o=$r(o,a+1);o=_n(o,_o(n.shape,"bool"));let i=Ee(n);return Vt(o,n,i)}var lz={kernelName:uc,gradFunc:t=>({x:()=>Ee(t)})};var Gne=[W1,dM,mM,hM,gM,xM,yM,bM,vM,wM,CM,SM,TM,IM,EM,_M,AM,DM,$M,RM,OM,FM,LM,PM,zM,BM,VM,WM,GM,UM,D3,HM,qM,jM,KM,XM,QM,YM,ZM,t3,r3,n3,o3,s3,i3,a3,l3,u3,c3,f3,lE,lE,d3,h3,x3,y3,b3,v3,w3,C3,S3,k3,T3,N3,I3,uE,uE,E3,_3,A3,$3,R3,O3,F3,P3,L3,M3,z3,B3,V3,W3,G3,U3,H3,q3,j3,K3,X3,cE,cE,pE,pE,Y3,Z3,Q3,J3,ez,tz,rz,nz,oz,sz,iz,az,lz];for(let t of Gne)MF(t);F().prototype.abs=function(){return this.throwIfDisposed(),Sr(this)};F().prototype.acos=function(){return this.throwIfDisposed(),p2(this)};F().prototype.acosh=function(){return this.throwIfDisposed(),f2(this)};F().prototype.add=function(t){return this.throwIfDisposed(),te(this,t)};F().prototype.all=function(t,e){return this.throwIfDisposed(),Dx(this,t,e)};F().prototype.any=function(t,e){return this.throwIfDisposed(),Rm(this,t,e)};F().prototype.argMax=function(t){return this.throwIfDisposed(),xl(this,t)};F().prototype.argMin=function(t){return this.throwIfDisposed(),tL(this,t)};F().prototype.asScalar=function(){return this.throwIfDisposed(),D(this.size===1,()=>"The array must have only 1 element."),M(this,[])};F().prototype.asType=function(t){return this.throwIfDisposed(),oe(this,t)};F().prototype.as1D=function(){return this.throwIfDisposed(),M(this,[this.size])};F().prototype.as2D=function(t,e){return this.throwIfDisposed(),M(this,[t,e])};F().prototype.as3D=function(t,e,r){return this.throwIfDisposed(),M(this,[t,e,r])};F().prototype.as4D=function(t,e,r,n){return this.throwIfDisposed(),M(this,[t,e,r,n])};F().prototype.as5D=function(t,e,r,n,o){return this.throwIfDisposed(),M(this,[t,e,r,n,o])};F().prototype.asin=function(){return this.throwIfDisposed(),d2(this)};F().prototype.asinh=function(){return this.throwIfDisposed(),m2(this)};F().prototype.atan=function(){return this.throwIfDisposed(),h2(this)};F().prototype.atan2=function(t){return this.throwIfDisposed(),rL(this,t)};F().prototype.atanh=function(){return this.throwIfDisposed(),g2(this)};F().prototype.avgPool=function(t,e,r,n){return this.throwIfDisposed(),Yp(this,t,e,r,n)};F().prototype.batchToSpaceND=function(t,e){return this.throwIfDisposed(),Pm(this,t,e)};F().prototype.batchNorm=function(t,e,r,n,o){return this.throwIfDisposed(),mc(this,t,e,r,n,o)};F().prototype.broadcastTo=function(t){return this.throwIfDisposed(),yl(this,t)};F().prototype.cast=function(t){return this.throwIfDisposed(),oe(this,t)};F().prototype.ceil=function(){return this.throwIfDisposed(),k2(this)};F().prototype.clipByValue=function(t,e){return this.throwIfDisposed(),sn(this,t,e)};F().prototype.concat=function(t,e){return this.throwIfDisposed(),t instanceof Je&&(t=[t]),Ot([this,...t],e)};F().prototype.conv1d=function(t,e,r,n,o,s){return this.throwIfDisposed(),$x(this,t,e,r,n,o,s)};F().prototype.conv2dTranspose=function(t,e,r,n,o){return this.throwIfDisposed(),Rx(this,t,e,r,n,o)};F().prototype.conv2d=function(t,e,r,n,o,s){return this.throwIfDisposed(),Io(this,t,e,r,n,o,s)};F().prototype.cos=function(){return this.throwIfDisposed(),Qp(this)};F().prototype.cosh=function(){return this.throwIfDisposed(),Ox(this)};F().prototype.cumprod=function(t,e,r){return this.throwIfDisposed(),Fx(this,t,e,r)};F().prototype.cumsum=function(t,e,r){return this.throwIfDisposed(),k1(this,t,e,r)};F().prototype.depthToSpace=function(t,e){return this.throwIfDisposed(),aL(this,t,e)};F().prototype.depthwiseConv2d=function(t,e,r,n,o,s){return this.throwIfDisposed(),vl(this,t,e,r,n,o,s)};F().prototype.dilation2d=function(t,e,r,n,o){return this.throwIfDisposed(),lL(this,t,e,r,n,o)};F().prototype.divNoNan=function(t){return this.throwIfDisposed(),uL(this,t)};F().prototype.div=function(t){return this.throwIfDisposed(),xe(this,t)};F().prototype.dot=function(t){return this.throwIfDisposed(),cL(this,t)};F().prototype.elu=function(){return this.throwIfDisposed(),wl(this)};F().prototype.equal=function(t){return this.throwIfDisposed(),Un(this,t)};F().prototype.erf=function(){return this.throwIfDisposed(),D2(this)};F().prototype.euclideanNorm=function(t,e){return this.throwIfDisposed(),dL(this,t,e)};F().prototype.exp=function(){return this.throwIfDisposed(),gn(this)};F().prototype.expandDims=function(t){return this.throwIfDisposed(),$r(this,t)};F().prototype.expm1=function(){return this.throwIfDisposed(),P2(this)};F().prototype.fft=function(){return this.throwIfDisposed(),Xx(this)};F().prototype.flatten=function(){return this.throwIfDisposed(),M(this,[this.size])};F().prototype.floor=function(){return this.throwIfDisposed(),Cl(this)};F().prototype.floorDiv=function(t){return this.throwIfDisposed(),w1(this,t)};F().prototype.gather=function(t,e){return this.throwIfDisposed(),Zp(this,t,e)};F().prototype.greaterEqual=function(t){return this.throwIfDisposed(),so(this,t)};F().prototype.greater=function(t){return this.throwIfDisposed(),tr(this,t)};F().prototype.ifft=function(){return this.throwIfDisposed(),Um(this)};F().prototype.irfft=function(){return this.throwIfDisposed(),Z2(this)};F().prototype.isFinite=function(){return this.throwIfDisposed(),L2(this)};F().prototype.isInf=function(){return this.throwIfDisposed(),M2(this)};F().prototype.isNaN=function(){return this.throwIfDisposed(),z2(this)};F().prototype.leakyRelu=function(t){return this.throwIfDisposed(),Jp(this,t)};F().prototype.lessEqual=function(t){return this.throwIfDisposed(),ws(this,t)};F().prototype.less=function(t){return this.throwIfDisposed(),N1(this,t)};F().prototype.localResponseNormalization=function(t,e,r,n){return this.throwIfDisposed(),mL(this,t,e,r,n)};F().prototype.logSigmoid=function(){return this.throwIfDisposed(),V2(this)};F().prototype.logSoftmax=function(t){return this.throwIfDisposed(),zx(this,t)};F().prototype.logSumExp=function(t,e){return this.throwIfDisposed(),hL(this,t,e)};F().prototype.log=function(){return this.throwIfDisposed(),Hn(this)};F().prototype.log1p=function(){return this.throwIfDisposed(),Mx(this)};F().prototype.logicalAnd=function(t){return this.throwIfDisposed(),_n(this,t)};F().prototype.logicalNot=function(){return this.throwIfDisposed(),zm(this)};F().prototype.logicalOr=function(t){return this.throwIfDisposed(),I1(this,t)};F().prototype.logicalXor=function(t){return this.throwIfDisposed(),gL(this,t)};F().prototype.matMul=function(t,e,r){return this.throwIfDisposed(),ot(this,t,e,r)};F().prototype.maxPool=function(t,e,r,n){return this.throwIfDisposed(),ef(this,t,e,r,n)};F().prototype.max=function(t,e){return this.throwIfDisposed(),an(this,t,e)};F().prototype.maximum=function(t){return this.throwIfDisposed(),Eo(this,t)};F().prototype.mean=function(t,e){return this.throwIfDisposed(),Wt(this,t,e)};F().prototype.min=function(t,e){return this.throwIfDisposed(),hc(this,t,e)};F().prototype.minimum=function(t){return this.throwIfDisposed(),tf(this,t)};F().prototype.mirrorPad=function(t,e){return this.throwIfDisposed(),xL(this,t,e)};F().prototype.mod=function(t){return this.throwIfDisposed(),yL(this,t)};F().prototype.mul=function(t){return this.throwIfDisposed(),L(this,t)};F().prototype.neg=function(){return this.throwIfDisposed(),st(this)};F().prototype.norm=function(t,e,r){return this.throwIfDisposed(),gc(this,t,e,r)};F().prototype.notEqual=function(t){return this.throwIfDisposed(),xc(this,t)};F().prototype.oneHot=function(t,e=1,r=0){return this.throwIfDisposed(),Dm(this,t,e,r)};F().prototype.onesLike=function(){return this.throwIfDisposed(),qr(this)};F().prototype.pad=function(t,e){return this.throwIfDisposed(),rf(this,t,e)};F().prototype.pool=function(t,e,r,n,o,s){return this.throwIfDisposed(),bL(this,t,e,r,n,o,s)};F().prototype.pow=function(t){return this.throwIfDisposed(),vs(this,t)};F().prototype.prelu=function(t){return this.throwIfDisposed(),nf(this,t)};F().prototype.prod=function(t,e){return this.throwIfDisposed(),vL(this,t,e)};F().prototype.reciprocal=function(){return this.throwIfDisposed(),Y2(this)};F().prototype.relu=function(){return this.throwIfDisposed(),Ao(this)};F().prototype.relu6=function(){return this.throwIfDisposed(),D1(this)};F().prototype.reshapeAs=function(t){return this.throwIfDisposed(),M(this,t.shape)};F().prototype.reshape=function(t){return this.throwIfDisposed(),M(this,t)};F().prototype.resizeBilinear=function(t,e,r){return this.throwIfDisposed(),z1(this,t,e,r)};F().prototype.resizeNearestNeighbor=function(t,e,r){return this.throwIfDisposed(),B1(this,t,e,r)};F().prototype.reverse=function(t){return this.throwIfDisposed(),Zo(this,t)};F().prototype.rfft=function(){return this.throwIfDisposed(),J2(this)};F().prototype.round=function(){return this.throwIfDisposed(),Vx(this)};F().prototype.rsqrt=function(){return this.throwIfDisposed(),Wx(this)};F().prototype.selu=function(){return this.throwIfDisposed(),Gx(this)};F().prototype.separableConv2d=function(t,e,r,n,o,s){return this.throwIfDisposed(),Ux(this,t,e,r,n,o,s)};F().prototype.sigmoid=function(){return this.throwIfDisposed(),bs(this)};F().prototype.sign=function(){return this.throwIfDisposed(),Q2(this)};F().prototype.sin=function(){return this.throwIfDisposed(),Hx(this)};F().prototype.sinh=function(){return this.throwIfDisposed(),qx(this)};F().prototype.slice=function(t,e){return this.throwIfDisposed(),tt(this,t,e)};F().prototype.softmax=function(t){return this.throwIfDisposed(),sf(this,t)};F().prototype.softplus=function(){return this.throwIfDisposed(),Hi(this)};F().prototype.spaceToBatchND=function(t,e){return this.throwIfDisposed(),Vm(this,t,e)};F().prototype.split=function(t,e){return this.throwIfDisposed(),Lr(this,t,e)};F().prototype.sqrt=function(){return this.throwIfDisposed(),Ft(this)};F().prototype.square=function(){return this.throwIfDisposed(),Ke(this)};F().prototype.squaredDifference=function(t){return this.throwIfDisposed(),LL(this,t)};F().prototype.squeeze=function(t){return this.throwIfDisposed(),si(this,t)};F().prototype.stack=function(t,e){this.throwIfDisposed();let r=t instanceof Je?[this,t]:[this,...t];return Mr(r,e)};F().prototype.step=function(t){return this.throwIfDisposed(),ii(this,t)};F().prototype.stridedSlice=function(t,e,r,n,o,s,i,a){return this.throwIfDisposed(),eE(this,t,e,r,n,o,s,i,a)};F().prototype.sub=function(t){return this.throwIfDisposed(),Se(this,t)};F().prototype.sum=function(t,e){return this.throwIfDisposed(),ye(this,t,e)};F().prototype.tan=function(){return this.throwIfDisposed(),tE(this)};F().prototype.tanh=function(){return this.throwIfDisposed(),Fm(this)};F().prototype.tile=function(t){return this.throwIfDisposed(),xn(this,t)};F().prototype.toBool=function(){return this.throwIfDisposed(),oe(this,"bool")};F().prototype.toFloat=function(){return this.throwIfDisposed(),oe(this,"float32")};F().prototype.toInt=function(){return this.throwIfDisposed(),oe(this,"int32")};F().prototype.topk=function(t,e){return this.throwIfDisposed(),ML(this,t,e)};F().prototype.transpose=function(t){return this.throwIfDisposed(),Ue(this,t)};F().prototype.unique=function(t){return this.throwIfDisposed(),zL(this,t)};F().prototype.unsortedSegmentSum=function(t,e){return this.throwIfDisposed(),R1(this,t,e)};F().prototype.unstack=function(t){return this.throwIfDisposed(),An(this,t)};F().prototype.where=function(t,e){return this.throwIfDisposed(),Vt(t,this,e)};F().prototype.zerosLike=function(){return this.throwIfDisposed(),Ee(this)};var io=class extends Error{constructor(e){super(e),Object.setPrototypeOf(this,io.prototype)}},vn=class extends Error{constructor(e){super(e),Object.setPrototypeOf(this,vn.prototype)}},z=class extends Error{constructor(e){super(e),Object.setPrototypeOf(this,z.prototype)}},De=class extends Error{constructor(e){super(e),Object.setPrototypeOf(this,De.prototype)}},Zm=class extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Zm.prototype)}};var Jx=class{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let r;return this.cache.has(e)&&(r=this.cache.get(e),this.cache.delete(e),this.cache.set(e,r)),r}put(e,r){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){let n=this.cache.keys().next().value;this.cache.delete(n)}this.cache.set(e,r)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let r=0;r<this.maxEntries-e;r++){let n=this.cache.keys().next().value;this.cache.delete(n)}this.maxEntries=e}};function ks(t,e){if(Array.isArray(t)){let r=[];for(let n=0;n<e;n++)r=r.concat(t);return r}else{let r=new Array(e);return r.fill(t),r}}function Jo(t,e){if(!t)throw new Zm(e)}function dE(t,e){let r=0;for(let n of t)n===e&&r++;return r}function jr(t){return t.length===1?t[0]:t}function wt(t){return Array.isArray(t)?t:[t]}function Ts(t){let r=t.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return r[0]!=="_"?r:"private"+r}function Tl(t){return t.length<=1||t.indexOf("_")===-1?t:t.replace(/[_]+(\w|$)/g,(e,r)=>r.toUpperCase())}var Ss={};function Jm(t){if(t==null)return null;let e={};return e.className=t.getClassName(),e.config=t.getConfig(),e}function fE(t){if(!(t==null||typeof t!="object"))if(Array.isArray(t))t.forEach(e=>fE(e));else{let e=Object.keys(t);for(let r of e){let n=t[r];n!=null&&typeof n=="object"&&(!Array.isArray(n)&&n.type==="ndarray"&&typeof n.value=="number"?t[r]=n.value:fE(n))}}}function Ki(t,e={},r={},n="object",o=!1){if(typeof t=="string"){let s=t,i;if(s in r)i=r[s];else if(s in Ss)i=Ss[s];else if(i=e[s],i==null)throw new z(`Unknown ${n}: ${t}. This may be due to one of the following reasons:
1. The ${n} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${n} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return i}else{let s=t;if(s.className==null||s.config==null)throw new z(`${n}: Improper config format: ${JSON.stringify(s)}.
'className' and 'config' must set.`);let i=s.className,a,l;if(i in r?[a,l]=r[i]:i in Ss?[a,l]=Ss.className:i in e&&([a,l]=e[i]),a==null)throw new z(`Unknown ${n}: ${i}. This may be due to one of the following reasons:
1. The ${n} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${n} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(l!=null){let u={};for(let d of Object.keys(Ss))u[d]=Ss[d];for(let d of Object.keys(r))u[d]=r[d];let c=s.config;c.customObjects=u;let p=Object.assign({},Ss);for(let d of Object.keys(r))Ss[d]=r[d];fE(s.config);let f=l(a,s.config,r,o);return Ss=Object.assign({},p),f}else{let u=Object.assign({},Ss);for(let p of Object.keys(r))Ss[p]=r[p];let c=new a(s.config);return Ss=Object.assign({},u),c}}}function Une(t,e){return t<e?-1:t>e?1:0}function ey(t,e){return-1*Une(t,e)}function Ns(t){if(t==null)return t;let e=[];for(let r of t)e.indexOf(r)===-1&&e.push(r);return e}function uz(t){if(t==null)throw new z(`Invalid value in obj: ${JSON.stringify(t)}`);for(let e in t)if(t.hasOwnProperty(e))return!1;return!0}function Xi(t,e,r){if(r!=null&&t.indexOf(r)<0)throw new z(`${r} is not a valid ${e}.  Valid values are ${t} or null/undefined.`)}function U1(t,e,r=0,n=1/0){return Jo(r>=0),Jo(n>=r),Array.isArray(t)&&t.length>=r&&t.length<=n&&t.every(o=>typeof o===e)}function ar(t,e){Array.isArray(t)?(w.assert(t.length>0,()=>`${e} is unexpectedly an empty array.`),t.forEach((r,n)=>ar(r,`element ${n+1} of ${e}`))):w.assert(Number.isInteger(t)&&t>0,()=>`Expected ${e} to be a positive integer, but got ${cz(t)}.`)}function cz(t){return t===null?"null":Array.isArray(t)?"["+t.map(e=>cz(e)).join(",")+"]":typeof t=="string"?`"${t}"`:`${t}`}function pz(t,e,r){let n=r!=null?r():w.now(),o;return(...i)=>{let a=r!=null?r():w.now();return a-n<e||(n=a,o=t(...i)),o}}function H1(t){return t==="relu"?"relu":t==="linear"?"linear":t==="elu"?"elu":null}var Hne=0;function j1(){return Hne++}var q1={};function bc(t=""){return t in q1||(q1[t]=0),q1[t]+=1,t+q1[t].toString()}var fz=["channelsFirst","channelsLast"],dz=["nearest","bilinear"],mz=["valid","same","causal"],hz=["max","avg"],gz=["sum","mul","concat","ave"];var eh=new Map;function Gt(t){Xi(fz,"DataFormat",t)}function yz(t){Xi(dz,"InterpolationFormat",t)}function qn(t){Xi(mz,"PaddingMode",t)}function mE(t){Xi(hz,"PoolMode",t)}var ty=[],xz="/";function ui(t,e){ty.push(t);try{let r=e();return ty.pop(),r}catch(r){throw ty.pop(),r}}function qne(){return ty.length===0?"":ty.join(xz)+xz}function K1(t){if(!bz(t))throw new Error("Not a valid tensor name: '"+t+"'");return qne()+t}function X1(t){if(!bz(t))throw new Error("Not a valid tensor name: '"+t+"'");eh.has(t)||eh.set(t,0);let e=eh.get(t);if(eh.set(t,eh.get(t)+1),e>0){let r=`${t}_${e}`;return eh.set(r,1),r}else return t}var jne=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function bz(t){return!!t.match(jne)}function vz(t){return t===parseInt(t.toString(),10)}function Is(t,e,r){e==null&&(e=0),r==null&&(r=t.length);let n=1;for(let o=e;o<r;++o)n*=t[o];return n}function df(t){if(t.length===0)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let r=0;r<t.length;r++){let n=t[r];n<e&&(e=n)}return e}function ci(t){if(t.length===0)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let r=0;r<t.length;r++){let n=t[r];n>e&&(e=n)}return e}function jn(t,e){if(e<t)throw new z(`end (${e}) < begin (${t}) is forbidden.`);let r=[];for(let n=t;n<e;++n)r.push(n);return r}var hE;function kr(){return hE==null&&(hE=VP().epsilon()),hE}function Kn(){return"channelsLast"}function Dn(t,e){return oe(t,e)}function Il(t,e=-1){let r=t.shape.slice();return e<0&&(e=r.length+e+1),r.splice(e,0,1),M(t,r)}function wz(t,e){return G(()=>{if(t.shape.length!==2)throw new z(`repeat() expects a rank-2 tensor, but received a rank-${t.shape.length} tensor.`);let r=Il(t,1);return Q1(r,[1,e,1])})}function Cz(t){let e=[Is(t.shape)];return M(t,e)}function Sz(t){if(t.rank<=1)throw new z(`batchFlatten requires a minimum rank of 2. Got rank: ${t.rank}.`);let e=[t.shape[0],Is(t.shape,1)];return M(t,e)}function Nl(t,e,r){return G(()=>{switch(t.rank){case 1:return jx(t,e,r);case 2:return $1(t,[e,0],[r,t.shape[1]]);case 3:return Kx(t,[e,0,0],[r,t.shape[1],t.shape[2]]);case 4:return Gm(t,[e,0,0,0],[r,t.shape[1],t.shape[2],t.shape[3]]);case 5:return tt(t,[e,0,0,0,0],[r,t.shape[1],t.shape[2],t.shape[3],t.shape[4]]);case 6:return tt(t,[e,0,0,0,0,0],[r,t.shape[1],t.shape[2],t.shape[3],t.shape[4],t.shape[5]]);default:throw new z(`sliceAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}})}function gE(t,e,r){return G(()=>{switch(t.rank){case 1:return jx(t,e,r);case 2:return $1(t,[0,e],[t.shape[0],r]);case 3:return Kx(t,[0,0,e],[t.shape[0],t.shape[1],r]);case 4:return Gm(t,[0,0,0,e],[t.shape[0],t.shape[1],t.shape[2],r]);default:throw new z(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}})}function ry(t,e,r,n){return G(()=>{switch(t.rank){case 1:return jx(t,e,r);case 2:switch(n){case 1:return Nl(t,e,r);case 2:return gE(t,e,r);default:throw new z(`The axis is not within the rank of the tensor ${n}`)}case 3:switch(n){case 1:return Nl(t,e,r);case 2:return Kx(t,[0,e,0],[t.shape[0],r,t.shape[2]]);case 3:return gE(t,e,r);default:throw new z(`The axis is not within the rank of the tensor ${n}`)}case 4:switch(n){case 1:return Nl(t,e,r);case 2:return Gm(t,[0,e,0,0],[t.shape[0],r,t.shape[2],t.shape[3]]);case 3:return Gm(t,[0,0,e,0],[t.shape[0],t.shape[1],r,t.shape[3]]);case 4:return gE(t,e,r);default:throw new z(`The axis is not within the rank of the tensor ${n}`)}default:throw new z(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}})}function th(t,e=-1){let r;return e<0&&(r=t[0].rank,r!==0?e=r:e=0),e===t[0].rank&&(e=-1),Ot(t,e)}function yE(t,e){switch(t.rank){case 1:return T2([t,e]);case 2:return N2([t,e],0);case 3:return I2([t,e],0);case 4:return E2([t,e],0);default:throw new z(`concatAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}}function Q1(t,e){if(Array.isArray(e)||(e=[e]),t.rank!==e.length)throw new z(`The length of input n (${e.length}) does not match the number of dimensions in input x (${t.rank})`);return xn(t,e)}function rh(t,e=0,r=1,n,o){return A1(t,e,r,n,o)}function Es(t,e,r,n){if(t.rank<2||e.rank<2)throw new De(`dot requires both inputs to be rank >= 2 but got x shape = ${t.shape} and y shape = ${e.shape}`);if(e.rank>=3){let o=t.shape.slice(-1)[0],s=e.shape.slice(-2)[0];if(o!==s)throw new De(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${t.shape} and  y shape = ${e.shape}`)}if(t.rank===2&&e.rank===2)return pf.matMul({a:t,b:e,transposeA:!1,transposeB:!1,bias:n?xE(t.rank,n,Kn()):null,activation:r});{let o=t.shape.slice(),s=o.pop();t=M(t,[-1,s]);let i=e.shape.slice(),a=i.pop(),l=i.pop(),u=[...i,a],c=Array.from({length:e.rank},(m,h)=>h===0?e.rank-2:h<=e.rank-2?h-1:h);e=M(Ue(e,c),[l,-1]);let p=[...o,...u],f=!1,d=!1;return M(pf.matMul({a:t,b:e,transposeA:f,transposeB:d,bias:n?xE(t.rank,n,Kn()):null,activation:r}),p)}}function Z1(t,e,r){return G(()=>(Array.isArray(e)?e=Rr(e,"int32"):e=oe(e,"int32"),Zp(t,e,r)))}function mf(t){return L(t,t)}function xE(t,e,r){let n=e.shape;if(e.rank!==1&&e.rank!==t)throw new z(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${t}`);if(t===5){if(r==="channelsFirst")return n.length===1?M(e,[1,n[0],1,1,1]):M(e,[1,n[3],n[0],n[1],n[2]]);if(r==="channelsLast")return n.length===1?M(e,[1,1,1,1,n[0]]):M(e,[1].concat(n))}else if(t===4){if(r==="channelsFirst")return n.length===1?M(e,[1,n[0],1,1]):M(e,[1,n[2],n[0],n[1]]);if(r==="channelsLast")return n.length===1?M(e,[1,1,1,n[0]]):M(e,[1].concat(n))}else if(t===3){if(r==="channelsFirst")return n.length===1?M(e,[1,n[0],1]):M(e,[1,n[1],n[0]]);if(r==="channelsLast")return n.length===1?M(e,[1,1,n[0]]):M(e,[1].concat(n))}else if(t<3)return e;throw new z(`Unsupported input rank by biasAdd: ${e.rank}`)}function Xn(t,e,r){return G(()=>(r==null&&(r=Kn()),Gt(r),te(t,xE(t.rank,e,r))))}function kz(t,e=1){if(e!==1)throw new De(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return wl(t)}function Tz(t){return G(()=>xe(t,te(Sr(t),1)))}function J1(t,e,r,n){return G(()=>WL(t,e,r,n))}function Nz(t){return G(()=>{let e=te(.5,L(.2,t));return sn(e,0,1)})}function vc(t,e,r=!1){return r?t():e()}var Iz=["fanIn","fanOut","fanAvg"],Ez=["normal","uniform","truncatedNormal"];function Kne(t){Xi(Iz,"FanMode",t)}function Xne(t){Xi(Ez,"Distribution",t)}var Yn=class extends J.Serializable{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}},ny=class extends Yn{apply(e,r){return Pt(e,r)}};ny.className="Zeros";J.registerClass(ny);var hf=class extends Yn{apply(e,r){return _o(e,r)}};hf.className="Ones";J.registerClass(hf);var oy=class extends Yn{constructor(e){if(super(),typeof e!="object")throw new z(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new z(`config must have value set but got ${e}`);this.value=e.value}apply(e,r){return G(()=>L(Oe(this.value),_o(e,r)))}getConfig(){return{value:this.value}}};oy.className="Constant";J.registerClass(oy);var sy=class extends Yn{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,r){return Sl(e,this.minval,this.maxval,r)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}};sy.className="RandomUniform";J.registerClass(sy);var iy=class extends Yn{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,r){if(r=r||"float32",r!=="float32"&&r!=="int32")throw new De(`randomNormal does not support dType ${r}.`);return rh(e,this.mean,this.stddev,r,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}};iy.className="RandomNormal";J.registerClass(iy);var ay=class extends Yn{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,r){if(r=r||"float32",r!=="float32"&&r!=="int32")throw new De(`truncatedNormal does not support dType ${r}.`);return Qx(e,this.mean,this.stddev,r,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}};ay.className="TruncatedNormal";J.registerClass(ay);var ly=class extends Yn{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,r){return G(()=>{if(e.length!==2||e[0]!==e[1])throw new z("Identity matrix initializer can only be used for 2D square matrices.");return L(this.gain,Mm(e[0]))})}getConfig(){return{gain:this.gain}}};ly.className="Identity";J.registerClass(ly);function Yne(t,e="channelsLast"){let r,n;if(Gt(e),t.length===2)r=t[0],n=t[1];else if([3,4,5].indexOf(t.length)!==-1){if(e==="channelsFirst"){let o=Is(t,2);r=t[1]*o,n=t[0]*o}else if(e==="channelsLast"){let o=Is(t,0,t.length-2);r=t[t.length-2]*o,n=t[t.length-1]*o}}else{let o=Is(t);r=Math.sqrt(o),n=Math.sqrt(o)}return[r,n]}var $n=class extends Yn{constructor(e){if(super(),e.scale<0)throw new z(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,Kne(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,Xne(this.distribution),this.seed=e.seed}apply(e,r){let n=Yne(e),o=n[0],s=n[1],i=this.scale;if(this.mode==="fanIn"?i/=Math.max(1,o):this.mode==="fanOut"?i/=Math.max(1,s):i/=Math.max(1,(o+s)/2),this.distribution==="normal"){let a=Math.sqrt(i);if(r=r||"float32",r!=="float32"&&r!=="int32")throw new De(`${this.getClassName()} does not support dType ${r}.`);return Qx(e,0,a,r,this.seed)}else{let a=Math.sqrt(3*i);return Sl(e,-a,a,r)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}};$n.className="VarianceScaling";J.registerClass($n);var nh=class extends $n{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return $n.className}};nh.className="GlorotUniform";J.registerClass(nh);var oh=class extends $n{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return $n.className}};oh.className="GlorotNormal";J.registerClass(oh);var sh=class extends $n{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return $n.className}};sh.className="HeNormal";J.registerClass(sh);var ih=class extends $n{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return $n.className}};ih.className="HeUniform";J.registerClass(ih);var ah=class extends $n{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return $n.className}};ah.className="LeCunNormal";J.registerClass(ah);var lh=class extends $n{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return $n.className}};lh.className="LeCunNormal";J.registerClass(lh);var uy=class extends Yn{constructor(e){if(super(),this.DEFAULT_GAIN=1,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed,this.seed!=null)throw new De("Random seed is not implemented for Orthogonal Initializer yet.")}apply(e,r){return G(()=>{if(e.length<2)throw new De("Shape must be at least 2D.");e[0]*e[1]>2e3&&console.warn(`Orthogonal initializer is being called on a matrix with more than 2000 (${e[0]*e[1]}) elements: Slowness may result.`);let n=e[0]>e[1]?[e[1],e[0]]:e,o=rh(n,0,1,"float32"),s=cM.gramSchmidt(o);return e[0]>e[1]&&(s=Ue(s)),L(this.gain,s)})}getConfig(){return{gain:this.gain,seed:this.seed}}};uy.className="Orthogonal";J.registerClass(uy);var _z={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function Az(t,e={}){return Ki(t,J.SerializationMap.getMap().classNameMap,e,"initializer")}function Et(t){return Jm(t)}function gt(t){if(typeof t=="string"){let e=t in _z?_z[t]:t;if(e==="GlorotNormal")return new oh;if(e==="GlorotUniform")return new nh;if(e==="HeNormal")return new sh;if(e==="HeUniform")return new ih;if(e==="LeCunNormal")return new ah;if(e==="LeCunUniform")return new lh;{let r={};return r.className=e,r.config={},Az(r)}}else return t instanceof Yn?t:Az(t)}function ew(t){return Array.isArray(t)&&Array.isArray(t[0])}function uh(t){return t.length===0?[]:Array.isArray(t[0])?t:[t]}function $e(t){let e;if(Array.isArray(t)){if(t.length!==1)throw new z(`Expected Tensor length to be 1; got ${t.length}`);e=t[0]}else e=t;return e}function qe(t){if(Array.isArray(t)&&Array.isArray(t[0])){if(t.length===1)return t=t,t[0];throw new z(`Expected exactly 1 Shape; got ${t.length}`)}else return t}function ch(t){let e=0;for(let r of t)r.shape.length===0?e+=1:e+=r.shape.reduce((n,o)=>n*o);return e}var $z="Variable",cy=class{constructor(e,r="float32",n=$z,o=!0,s=null){this.dtype=r??"float32",this.shape=e.shape,this.id=j1(),n=n??$z,this.originalName=K1(n),this.name=X1(this.originalName),this.trainable_=o,this.constraint=s,this.val=rE(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),Zne(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}};function Zne(t,e){if(t.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(t.shape)+" vs. "+JSON.stringify(e.shape))}function py(t){return t.map(e=>e.read())}function ph(t){t.forEach(e=>{e[0].write(e[1])})}var Ct=class{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}},Rn=class{constructor(e,r,n,o,s,i,a){this.dtype=e,this.shape=r,this.sourceLayer=n,this.inputs=o,this.callArgs=s,this.outputTensorIndex=a,this.id=j1(),i!=null&&(this.originalName=K1(i),this.name=X1(this.originalName)),this.rank=r.length}},Jne=0,El=class{constructor(e,r){this.callArgs=r,this.id=Jne++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(let n of e.inboundLayers)n?.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){let e=[];for(let r of this.inboundLayers)r!=null?e.push(r.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}},eoe=0,ze=class extends J.Serializable{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=eoe++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let r=e.name;if(!r){let n=this.getClassName();r=Ts(n)+"_"+bc(n)}if(this.name=r,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let n;if(e.batchInputShape!=null)n=e.batchInputShape;else if(e.inputShape!=null){let s=null;e.batchSize!=null&&(s=e.batchSize),n=[s].concat(e.inputShape)}this.batchInputShape=n;let o=e.dtype;o==null&&(o=e.inputDType),o==null&&(o="float32"),this.dtype=o}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,r){return e.name+"_ib-"+r.toString()}getNodeAtIndex(e,r){if(this.inboundNodes.length===0)throw new vn(`The layer has never been called and thus has no defined ${r}.`);if(this.inboundNodes.length<=e)throw new z(`Asked to get ${r} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return jr(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return jr(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new io(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new io(`Layer ${this.name} is not connected, no input to return.`);return jr(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new io(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new io(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return jr(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(r=>r.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){if(e=wt(e),this.inputSpec==null||this.inputSpec.length===0)return;let r=wt(this.inputSpec);if(e.length!==r.length)throw new z(`Layer ${this.name} expects ${r.length} inputs, but it received ${e.length} input tensors. Input received: ${e}`);for(let n=0;n<e.length;n++){let o=e[n],s=r[n];if(s==null)continue;let i=o.rank;if(s.ndim!=null&&i!==s.ndim)throw new z(`Input ${n} is incompatible with layer ${this.name}: expected ndim=${s.ndim}, found ndim=${i}`);if(s.maxNDim!=null&&i>s.maxNDim)throw new z(`Input ${n} is incompatible with layer ${this.name}: expected max_ndim=${s.maxNDim}, found ndim=${i}`);if(s.minNDim!=null&&i<s.minNDim)throw new z(`Input ${n} is incompatible with layer ${this.name}: expected min_ndim=${s.minNDim}, found ndim=${i}.`);if(s.dtype!=null&&o.dtype!==s.dtype)throw new z(`Input ${n} is incompatible with layer ${this.name} : expected dtype=${s.dtype}, found dtype=${o.dtype}.`);if(s.axes){let a=o.shape;for(let l in s.axes){let u=Number(l),c=s.axes[l],p=u>=0?a[u]:a[a.length+u];if(c!=null&&[c,null].indexOf(p)===-1)throw new z(`Input ${n} is incompatible with layer ${this.name}: expected axis ${u} of input shape to have value ${c} but got shape ${a}.`)}}if(s.shape!=null)for(let a=0;a<s.shape.length;++a){let l=s.shape[a],u=o.shape[a];if(l!=null&&u!=null&&l!==u)throw new z(`Input ${n} is incompatible with layer ${this.name}: expected shape=${s.shape}, found shape=${o.shape}.`)}}}call(e,r){return e}invokeCallHook(e,r){this._callHook!=null&&this._callHook(e,r)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,r){r=r||{},this.assertNotDisposed();let n=wt(e),o=!0;for(let i of n)if(!(i instanceof Rn)){o=!1;break}let s=!0;for(let i of n)if(i instanceof Rn){s=!1;break}if(o===s)throw new z("Arguments to apply() must be all SymbolicTensors or all Tensors");return ui(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);let i=[];for(let a of wt(e))i.push(a.shape);this.build(jr(i)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&s&&(this._refCount=1)}if(this.assertInputCompatibility(e),s){let i=this.call(e,r),a=wt(i),l=[];for(let u of a)n.indexOf(u)!==-1&&(u=u.clone()),l.push(u);if(i=jr(l),this.activityRegularizer!=null)throw new De("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return i}else{let i=toe(e),a=this.computeOutputShape(i),l,u=roe(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?i[0]:i),a!=null&&a.length>0&&Array.isArray(a[0])?l=a.map((c,p)=>new Rn(u,c,this,wt(e),r,this.name,p)):l=new Rn(u,a,this,wt(e),r,this.name),this.addInboundNode(e,l,null,null,i,a,r),this._refCount++,this.activityRegularizer!=null)throw new De("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let r=!1;this.batchInputShape.forEach((n,o)=>{n!=null&&e[o]!=null&&e[o]!==n&&(r=!0)}),r&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new io(`The layer ${this.name} has never been called and thus has no defined output shape.`);let e=[];for(let r of this.inboundNodes){let n=JSON.stringify(r.outputShapes);e.indexOf(n)===-1&&e.push(n)}if(e.length===1){let r=this.inboundNodes[0].outputShapes;return Array.isArray(r)&&Array.isArray(r[0])&&r.length===1?r[0]:r}else throw new io(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new vn(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return ch(this.weights)}build(e){this.built=!0}getWeights(e=!1){return py(e?this.trainableWeights:this.weights)}setWeights(e){G(()=>{let r=this.weights;if(r.length!==e.length)throw new z(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${r.length} weights. Provided weights: ${e}...`);if(r.length===0)return;let n=[],o=py(r);for(let s=0;s<o.length;++s){let i=o[s],a=r[s],l=e[s];if(!w.arraysEqual(i.shape,l.shape))throw new z(`Layer weight shape ${i.shape} not compatible with provided weight shape ${l.shape}`);n.push([a,l])}ph(n)})}addWeight(e,r,n,o,s,i,a,l){if(this._addedWeightNames.indexOf(e)!==-1)throw new z(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),n==null&&(n="float32"),this.fastWeightInitDuringBuild&&(o=l!=null?l():gt("zeros"));let u=o.apply(r,n),c=new cy(u,n,e,i,a);return u.dispose(),s!=null&&this.addLoss(()=>s.apply(c.read())),i==null&&(i=!0),i?this._trainableWeights.push(c):this._nonTrainableWeights.push(c),c}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=wt(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,r){if(!this.supportsMasking){if(r!=null)if(Array.isArray(r))r.forEach(n=>{if(n!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return r}addInboundNode(e,r,n,o,s,i,a=null){let l=wt(e);r=wt(r),n=wt(n),o=wt(o),s=uh(s),i=uh(i);let u=[],c=[],p=[];for(let f of l)u.push(f.sourceLayer),c.push(f.nodeIndex),p.push(f.tensorIndex);new El({outboundLayer:this,inboundLayers:u,nodeIndices:c,tensorIndices:p,inputTensors:l,outputTensors:r,inputMasks:n,outputMasks:o,inputShapes:s,outputShapes:i},a);for(let f=0;f<r.length;f++)r[f].sourceLayer=this,r[f].nodeIndex=this.inboundNodes.length-1,r[f].tensorIndex=f}getConfig(){let e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}};function toe(t){t=wt(t);let e=[];for(let r of t)e.push(r.shape);return jr(e)}function roe(t){return"float32"}function bE(t,e,r){if((e==null||r!=null&&r>0)&&(e=t.sourceLayer,r=t.nodeIndex),e.inboundNodes.length===0)return[t];{let n=e.inboundNodes[r];if(n.inboundLayers.length===0)return n.inputTensors;{let o=[];for(let s=0;s<n.inboundLayers.length;s++){let i=n.inputTensors[s],a=n.inboundLayers[s],l=n.nodeIndices[s],u=bE(i,a,l);for(let c of u)o.indexOf(c)===-1&&o.push(c)}return o}}}var Yi=class extends ze{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:bc("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new z("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let r=e.batchInputShape;if(r==null){if(e.inputShape==null)throw new z("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");r=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new z("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");let n=e.dtype||"float32";this.batchInputShape=r,this.dtype=n,this.inputSpec=[{shape:r}];let o=new Rn(this.dtype,this.batchInputShape,this,[],{},this.name);o.nodeIndex=0,o.tensorIndex=0,new El({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[o],outputTensors:[o],inputMasks:[null],outputMasks:[null],inputShapes:[r],outputShapes:[r]})}apply(e,r){throw new z(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}};Yi.className="InputLayer";J.registerClass(Yi);function vE(t){if(t.batchShape==null&&t.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(t.batchShape!=null&&t.shape!=null)throw new z("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=t.batchShape;t.shape!=null&&e==null&&(e=[null].concat(t.shape));let r=t.dtype;return r==null&&(r="float32"),new Yi({batchInputShape:e,name:t.name,dtype:r,sparse:t.sparse}).inboundNodes[0].outputTensors[0]}function noe(t,e){if(t.dtype==null||t.dtype===e.dtype)return e;try{return oe(e,t.dtype)}catch{throw new z(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${t.name}' (${t.dtype}).`)}}var _s=class{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof _s)for(let r in e.id2Value)this.id2Value[r]=e.id2Value[r],r in e.id2Mask&&(this.id2Mask[r]=e.id2Mask[r]);else{if(e==null)return;for(let r of e)this.add(r.key,r.value)}}add(e,r,n){if(this.id2Value[e.id]==null)this.id2Value[e.id]=noe(e,r),this.name2Id[e.name]=e.id,n!=null&&(this.id2Mask[e.id]=n);else throw new z(`Duplicate key: name=${e.name}, id=${e.id}`);return this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return this.id2Value[e.id]!=null}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof Rn){if(this.id2Value[e.id]==null)throw new z(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}else{let r=this.name2Id[e];if(r==null)throw new z(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[r]}}getMask(e){if(e instanceof Rn){if(this.id2Value[e.id]==null)throw new z(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}else{let r=this.name2Id[e];if(r==null)throw new z(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[r]}}disposeMasks(){this.id2Mask!=null&&Me(this.id2Mask)}},tw=new Jx,rw=new Jx;function Oz(t){tw?.setMaxEntries(t),rw?.setMaxEntries(t)}function gf(t,e,r,n){let o=r==null?!1:r.training,s=Array.isArray(t),i=s?t:[t],a=i.map(m=>m.name),l=[],u=e.names();for(let m of a)u.indexOf(m)!==-1?l.push(e.getValue(m)):l.push(null);n!=null&&(n.maxNumTensors=-1/0,n.minNumTensors=1/0);let c=a.join(",")+"|"+e.names().sort().join(","),p=tw.get(c),f;if(p==null){let m=ooe(i,e);p=m.sorted,f=m.recipientCounts,tw.put(c,p),rw.put(c,f)}f={},o||Object.assign(f,rw.get(c));let d=new _s(e);for(let m=0;m<p.length;++m){if(n!=null){let A=Ex().numTensors;A>n.maxNumTensors&&(n.maxNumTensors=A),A<n.minNumTensors&&(n.minNumTensors=A)}let h=p[m],x=h.sourceLayer;if(x instanceof Yi)continue;let g=[],y=[],b=[],v=!1;for(let A of h.inputs){let $=d.getValue(A),O=d.getMask(A);g.push($),y.push(O),O!=null&&(v=!0),o||(f[A.name]--,f[A.name]===0&&!e.hasKey(A)&&a.indexOf(A.name)===-1&&!$.isDisposed&&A.sourceLayer.stateful!==!0&&b.push($))}v&&(r=r||{},r.mask=y[0]);let C=wt(x.apply(g,r)),S=null;x.supportsMasking&&(S=x.computeMask(g,y));let k=ioe(h),I=Array.isArray(k)?k:[k];for(let A=0;A<I.length;++A){d.hasKey(I[A])||d.add(I[A],C[A],Array.isArray(S)?S[0]:S);let $=a.indexOf(I[A].name);$!==-1&&(l[$]=C[A])}o||Me(b)}return d.disposeMasks(),s?l:l[0]}function ooe(t,e){w.assert(t!=null&&t.length>0,()=>"Expected at least one fetch, got none");let r=[],n={};if(t.length===1){let o=Rz(t[0],e);r=o.sorted,n=o.recipientMap}else{let o=new Set;for(let s of t){let{sorted:i,recipientMap:a}=Rz(s,e);for(let l of i)o.has(l.name)||(r.push(l),o.add(l.name));for(let l in a)n[l]==null&&(n[l]=new Set),a[l].forEach(u=>n[l].add(u))}}return{sorted:r,recipientCounts:soe(n)}}function soe(t){let e={};for(let r in t)e[r]=t[r].size;return e}function Rz(t,e){let r=new Set,n=[],o={};for(let a of e.names())r.add(a);let s=[],i=[];for(s.push(t);s.length>0;){let a=s[s.length-1];if(r.has(a.name)){s.pop();continue}let l=i[i.length-1]===s.length-1;if(a.inputs.length===0||l)s.pop(),n.push(a),r.add(a.name),l&&i.pop();else{i.push(s.length-1);for(let u of a.inputs)o[u.name]==null&&(o[u.name]=new Set),o[u.name].add(a.name),!r.has(u.name)&&s.push(u)}}return{sorted:n,recipientMap:o}}function ioe(t){let e;if(t.sourceLayer.inboundNodes.length===1)e=t.sourceLayer.output;else{let r=null;for(let n=0;n<t.sourceLayer.inboundNodes.length;++n)for(let o of t.sourceLayer.inboundNodes[n].outputTensors)if(o.id===t.id){r=n;break}e=t.sourceLayer.getOutputAt(r)}return e}var aoe=W();aoe.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,Oz);function wE(t,e){return G(()=>Ft(ye(L(t,t),e,!0)))}var xf=class extends J.Serializable{getConfig(){return{}}},fy=class extends xf{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return G(()=>{let r=wE(e,this.axis),n=sn(r,0,this.maxValue);return L(e,xe(n,te(kr(),r)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}};fy.className="MaxNorm";J.registerClass(fy);var dy=class extends xf{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return G(()=>xe(e,te(kr(),wE(e,this.axis))))}getConfig(){return{axis:this.axis}}};dy.className="UnitNorm";J.registerClass(dy);var my=class extends xf{apply(e){return Ao(e)}};my.className="NonNeg";J.registerClass(my);var hy=class extends xf{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return G(()=>{let r=wE(e,this.axis),n=te(L(this.rate,sn(r,this.minValue,this.maxValue)),L(1-this.rate,r));return L(e,xe(n,te(kr(),r)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}};hy.className="MinMaxNorm";J.registerClass(hy);var Fz={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Kt(t){return Jm(t)}function Pz(t,e={}){return Ki(t,J.SerializationMap.getMap().classNameMap,e,"constraint")}function Xt(t){if(t==null)return null;if(typeof t=="string"){let r={className:t in Fz?Fz[t]:t,config:{}};return Pz(r)}else return t instanceof xf?t:Pz(t)}async function _l(t){if(t==null)return;let e=[],r=[],n=[];for(let o in t){let s=t[o];if(typeof s!="number"){let i=s;e.push(i.data()),r.push(o),n.push(i)}}if(e.length>0){let o=await Promise.all(e);for(let s=0;s<o.length;++s)t[r[s]]=o[s][0];Me(n)}}function nw(t){if(t!=null)for(let e in t){let r=t[e];typeof r!="number"&&r.dispose()}}var Lz;(function(t){t[t.SILENT=0]="SILENT",t[t.VERBOSE=1]="VERBOSE"})(Lz||(Lz={}));var coe=125,wc=class{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,r){}async onEpochEnd(e,r){}async onBatchBegin(e,r){}async onBatchEnd(e,r){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}},ow=class{constructor(e,r=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=r}append(e){this.callbacks.push(e)}setParams(e){for(let r of this.callbacks)r.setParams(e)}setModel(e){for(let r of this.callbacks)r.setModel(e)}async onEpochBegin(e,r){r==null&&(r={});for(let n of this.callbacks)await n.onEpochBegin(e,r)}async onEpochEnd(e,r){r==null&&(r={});for(let n of this.callbacks)await n.onEpochEnd(e,r)}async onBatchBegin(e,r){r==null&&(r={});for(let n of this.callbacks)await n.onBatchBegin(e,r)}async onBatchEnd(e,r){r==null&&(r={});for(let n of this.callbacks)await n.onBatchEnd(e,r)}async onTrainBegin(e){e==null&&(e={});for(let r of this.callbacks)await r.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(let r of this.callbacks)await r.onTrainEnd(e)}},CE=class extends wc{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,r){r==null&&(r={});let n=r.size==null?0:r.size;this.seen+=n;for(let o in r){let s=r[o];if(typeof s=="number")this.totals.hasOwnProperty(o)||(this.totals[o]=0),this.totals[o]=this.totals[o]+s*n;else{let i;o in this.totals?i=this.totals[o]:this.totals[o]=0;let a=G(()=>te(this.totals[o],L(s,n)));this.totals[o]=a,i?.dispose()}}}async onEpochEnd(e,r){if(r!=null)for(let n of this.params.metrics)this.totals[n]!=null&&(typeof this.totals[n]=="number"?r[n]=this.totals[n]/this.seen:G(()=>{let o=L(xe(1,this.seen),this.totals[n]);r[n]=o,this.totals[n].dispose(),Ur(r[n])}))}},sw=class extends wc{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,r){r==null&&(r={}),this.epoch.push(e);for(let n in r)this.history[n]==null&&(this.history[n]=[]),this.history[n].push(r[n])}async syncData(){let e=[],r=[],n=[];for(let s in this.history){let i=this.history[s];for(let a=0;a<i.length;++a)if(typeof i[a]!="number"){let l=i[a];e.push(l.data()),r.push(s),n.push(a)}}let o=await Promise.all(e);for(let s=0;s<o.length;++s)this.history[r[s]][n[s]].dispose(),this.history[r[s]][n[s]]=o[s][0]}},iw=class extends wc{constructor(e,r){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||Zx,this.yieldEvery=r||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=coe),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");w.isNumber(this.yieldEvery)&&(this.maybeWait=pz(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,r,n){let o=[];this.yield!=null&&(await _l(n),o.push(this.yield(e,r,n))),o.push(this.nextFrameFunc()),await Promise.all(o)}async onEpochBegin(e,r){this.currentEpoch=e,this.epochBegin!=null&&(await _l(r),await this.epochBegin(e,r))}async onEpochEnd(e,r){let n=[];this.epochEnd!=null&&(await _l(r),n.push(this.epochEnd(e,r))),this.yieldEvery==="epoch"&&n.push(this.nextFrameFunc()),await Promise.all(n)}async onBatchBegin(e,r){this.batchBegin!=null&&(await _l(r),await this.batchBegin(e,r))}async onBatchEnd(e,r){let n=[];this.batchEnd!=null&&(await _l(r),n.push(this.batchEnd(e,r))),this.yieldEvery==="batch"?n.push(this.nextFrameFunc()):w.isNumber(this.yieldEvery)&&n.push(this.maybeWait(this.currentEpoch,e,r)),await Promise.all(n)}async onTrainBegin(e){this.trainBegin!=null&&(await _l(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await _l(e),await this.trainEnd(e))}};function aw(t,e){return t==null&&(t={}),t instanceof wc?[t]:Array.isArray(t)&&t[0]instanceof wc?t:wt(t).map(n=>new iw(n,e))}var ao=class{constructor(){}static registerCallbackConstructor(e,r){w.assert(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),ao.checkForDuplicate(r),ao.constructors[e]==null&&(ao.constructors[e]=[]),ao.constructors[e].push(r)}static checkForDuplicate(e){for(let r in ao.constructors)ao.constructors[+r].forEach(o=>{if(o===e)throw new z("Duplicate callback constructor.")})}static clear(){ao.constructors={}}static createCallbacks(e){let r=[];for(let n in ao.constructors){let o=+n;e>=o&&r.push(...ao.constructors[o])}return r.map(n=>new n)}};ao.constructors={};function lw(t,e,r,n,o,s,i,a,l){let u=new sw,c=[new CE,...ao.createCallbacks(e)];t!=null&&c.push(...t),c.push(u);let p=new ow(c);return p.setParams({epochs:r,initialEpoch:n,samples:o,steps:s,batchSize:i,verbose:e,doValidation:a,metrics:l}),{callbackList:p,history:u}}function Do(t,e={},r=!1){return Ki(t,J.SerializationMap.getMap().classNameMap,e,"layer",r)}function gy(t,e){return G(()=>{t.dtype!=="float32"&&(t=oe(t,"float32"));let r=ye(mf(t),e,!0),n=bl(r.shape,kr()),o=Ft(Eo(r,n));return xe(t,o)})}function yf(t,e){return G(()=>Wt(mf(Se(e,t)),-1))}function yy(t,e){return G(()=>Wt(Sr(Se(e,t)),-1))}function by(t,e){return G(()=>{let r=Se(t,e),n=sn(Sr(t),kr(),Number.MAX_VALUE),o=Sr(xe(r,n));return L(100,Wt(o,-1))})}function poe(t,e){return G(()=>{let r=sn(e,kr(),Number.MAX_VALUE),n=Hn(te(1,r)),o=sn(t,kr(),Number.MAX_VALUE),s=Hn(te(1,o));return Wt(mf(Se(n,s)),-1)})}function foe(t,e){return G(()=>{let r=Eo(0,Se(1,L(t,e)));return Wt(mf(r),-1)})}function doe(t,e){return G(()=>{let r=Eo(0,Se(1,L(t,e)));return Wt(r,-1)})}function moe(t,e){return G(()=>{let r=ye(L(t,e),-1),n=an(L(Se(1,t),e),-1);return Eo(0,te(1,Se(n,r)))})}function hoe(t,e){return G(()=>{let r=Math.log(2),n=Se(e,t),o=Se(te(n,Hi(L(-2,n))),r);return Wt(o,-1)})}function bf(t,e,r=!1){return G(()=>{if(r)e=sf(e);else{let n=ye(e,e.shape.length-1,!0);e=xe(e,n)}return e=sn(e,kr(),1-kr()),st(ye(L(oe(t,"float32"),Hn(e)),e.shape.length-1))})}function fh(t,e,r=!1){return G(()=>{let n=oe(Cl(Cz(t)),"int32");e=sn(e,kr(),1-kr());let o=e.shape,s=M(Dm(n,o[o.length-1]),o);return bf(s,e,r)})}function goe(t,e){if(!w.arraysEqual(t.shape,e.shape))throw new z(`logits and labels must have the same shape, but got shapes ${JSON.stringify(t.shape)} and ${JSON.stringify(e.shape)}`);return G(()=>{let r=Ao(e),n=st(Sr(e));return te(Se(r,L(e,t)),Mx(gn(n)))})}function dh(t,e){return G(()=>{let r;return r=sn(e,kr(),1-kr()),r=Hn(xe(r,Se(1,r))),Wt(goe(t,r),-1)})}function xoe(t,e){return G(()=>{let r=sn(t,kr(),1),n=sn(e,kr(),1);return ye(L(t,Hn(xe(r,n))),-1)})}function yoe(t,e){return G(()=>{let r=Hn(te(kr(),e));return Wt(Se(e,L(t,r)),-1)})}function uw(t,e){return G(()=>{let r=gy(t,-1),n=gy(e,-1),o=L(r,n);return st(ye(o,-1))})}var xy={meanSquaredError:yf,meanAbsoluteError:yy,meanAbsolutePercentageError:by,meanSquaredLogarithmicError:poe,squaredHinge:foe,hinge:doe,categoricalHinge:moe,logcosh:hoe,categoricalCrossentropy:bf,sparseCategoricalCrossentropy:fh,binaryCrossentropy:dh,kullbackLeiblerDivergence:xoe,poisson:yoe,cosineProximity:uw};function cw(t){if(typeof t=="string"){if(t in xy)return xy[t];let e=`Unknown loss ${t}`;throw t.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${t}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new z(e)}else return t}function fw(t,e){return G(()=>{let r=L(.5,qr(e)),n=Dn(tr(e,r),t.dtype);return Wt(Un(t,n),-1)})}function dw(t,e){return G(()=>Dn(Un(xl(t,-1),xl(e,-1)),"float32"))}function boe(t,e){return G(()=>oe(ye(_n(Un(t,1),Un(e,1))),"float32"))}function voe(t,e){return G(()=>oe(ye(_n(Un(t,0),Un(e,1))),"float32"))}function zz(t,e){return G(()=>{let r=boe(t,e),n=voe(t,e),o=te(r,n);return oe(Vt(tr(o,0),xe(r,o),0),"float32")})}function SE(t,e){return dh(t,e)}function kE(t,e){return t.rank===e.rank&&(t=si(t,[t.rank-1])),e=xl(e,-1),e.dtype!==t.dtype&&(e=oe(e,t.dtype)),oe(Un(t,e),"float32")}var woe=yf,Coe=yf,Soe=yy,koe=yy,Toe=by,Noe=by,mw=bf,Ioe=uw,TE=fh,pw={binaryAccuracy:fw,categoricalAccuracy:dw,precision:zz,categoricalCrossentropy:mw,sparseCategoricalCrossentropy:TE,mse:woe,MSE:Coe,mae:Soe,MAE:koe,mape:Toe,MAPE:Noe,cosine:Ioe};function Bz(t){if(typeof t=="string"&&t in pw)return pw[t];if(typeof t!="string"&&t!=null)return t;throw new z(`Unknown metric ${t}`)}function vy(t){if(Jo(t!==null,`Unknown LossOrMetricFn ${t}`),typeof t=="string")return t;{let e;for(let r of Object.keys(xy))if(xy[r]===t){e=r;break}if(e!==void 0)return e;for(let r of Object.keys(pw))if(pw[r]===t){e=r;break}return e!==void 0?e:t.name}}function Wz(t){let e={Adagrad:()=>ff.adagrad(.01),Adadelta:()=>ff.adadelta(1,.95,kr()),Adam:()=>ff.adam(.001,.9,.999,kr()),Adamax:()=>ff.adamax(.002,.9,.999,kr(),0),RMSProp:()=>ff.rmsprop(.001,.9,0,kr()),SGD:()=>ff.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,t in e)return e[t]();throw new z(`Unknown Optimizer ${t}`)}function IE(t,e,r=!1){if(t==null||typeof t!="object"||Object.getPrototypeOf(t)!==Object.prototype||!NE(t))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(r){let n=JSON.stringify(t);n.length>1048576&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${n.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${1048576}.`)}}function NE(t){if(t===null)return!0;if(typeof t=="object")if(Object.getPrototypeOf(t)===Object.prototype){let e=Object.keys(t);for(let r of e)if(typeof r!="string"||!NE(t[r]))return!1;return!0}else if(Array.isArray(t)){for(let e of t)if(!NE(e))return!1;return!0}else return!1;else{let e=typeof t;return e==="string"||e==="number"||e==="boolean"}}function Gz(t,e,r,n=console.log){let o=Aoe(t),s=["Layer (type)","Input Shape","Output shape","Param #"];o?(e=e||90,r=r||[.32,.61,.89,1]):(e=e||115,r=r||[.24,.48,.7,.8,1]),r[r.length-1]<=1&&(r=r.map(c=>Math.floor(e*c)));let i;if(!o){s.push("Receives inputs"),i=[];for(let c in t.nodesByDepth)i.push(...t.nodesByDepth[c])}n("_".repeat(e)),hw(s,r,n),n("=".repeat(e));let a=t.layers;for(let c=0;c<a.length;++c)o?Doe(a[c],r,n):$oe(a[c],r,i,n),n((c===a.length-1?"=":"_").repeat(e));t.checkTrainableWeightsConsistency();let l=_oe(t),u=ch(t.nonTrainableWeights);n(`Total params: ${l+u}`),n(`Trainable params: ${l}`),n(`Non-trainable params: ${u}`),n("_".repeat(e))}function _oe(t){let e;return t.collectedTrainableWeights!=null?e=ch(t.collectedTrainableWeights):e=ch(t.trainableWeights),e}function Aoe(t){let e=!0,r=[],n=[];for(let o in t.nodesByDepth)r.push(t.nodesByDepth[o]);for(let o of r){if(o.length>1||o.length===1&&o[0].inboundLayers.length>1){e=!1;break}n.push(...o)}if(e)for(let o of t.layers){let s=!1;for(let i of o.inboundNodes)if(n.indexOf(i)!==-1)if(s){e=!1;break}else s=!0;if(!e)break}return e}function hw(t,e,r=console.log){let n="";for(let o=0;o<t.length;++o)o>0&&(n=n.slice(0,n.length-1)+" "),n+=t[o],n=n.slice(0,e[o]),n+=" ".repeat(e[o]-n.length);r(n)}function Doe(t,e,r){let n,o;try{o=t.inboundNodes.map(l=>JSON.stringify(l.inputShapes)).join(",")}catch{o="multiple"}try{n=JSON.stringify(t.outputShape)}catch{n="multiple"}let s=t.name,i=t.getClassName(),a=[`${s} (${i})`,o,n,t.countParams().toString()];hw(a,e,r)}function $oe(t,e,r,n){let o,s;try{s=t.inboundNodes.map(p=>JSON.stringify(p.inputShapes)).join(",")}catch{s="multiple"}try{o=JSON.stringify(t.outputShape)}catch{o="multiple"}let i=[];for(let p of t.inboundNodes)if(!(r!=null&&r.length>0&&r.indexOf(p)===-1))for(let f=0;f<p.inboundLayers.length;++f){let d=p.inboundLayers[f].name,m=p.nodeIndices[f],h=p.tensorIndices[f];i.push(`${d}[${m}][${h}]`)}let a=t.name,l=t.getClassName(),u=i.length===0?"":i[0],c=[`${a} (${l})`,s,o,t.countParams().toString(),u];hw(c,e,n);for(let p=1;p<i.length;++p)hw(["","","","",i[p]],e,n)}function Uz(t,e,r){return(t==="inboundNodes"||t==="outputLayers"||t==="inputLayers")&&e===0&&typeof r=="string"}function wy(t,e){if(t===null)return null;if(typeof t=="string")return Tl(t);if(typeof t=="number"||typeof t=="boolean")return t;if(t instanceof Array){let r=[],n=t.length;for(let o=0;o<n;++o){let s=t[o];Uz(e,o,s)?r.push(s):r.push(wy(s,e))}return r}else{let r={};for(let n of Object.keys(t)){let o=t[n];if(n==="name"&&typeof o=="string")r[n]=o;else{let s=Tl(n);r[s]=wy(o,s)}}return r}}function gw(t,e){if(t==null)return null;if(typeof t=="string")return Ts(t);if(typeof t=="number"||typeof t=="boolean")return t;if(t instanceof Array){let r=[],n=t.length;for(let o=0;o<n;++o){let s=t[o];Uz(e,o,s)?r.push(s):r.push(gw(s,e))}return r}else{let r={};for(let n of Object.keys(t)){let o=t[n],s=Ts(n);(n==="name"||n==="className")&&typeof o=="string"?r[s]=o:r[s]=gw(o,n)}return r}}var mh="4.1.0";var $o=class extends ze{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,this.name==null){let y=this.getClassName().toLowerCase();this.name=bc(y)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],Ns(this.inputs).length!==this.inputs.length)throw new z(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(y=>y.name)}`);Ns(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(y=>y.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(let y of this.outputs){let b=y.sourceLayer,v=y.nodeIndex,C=y.tensorIndex;this.outputLayers.push(b),this.outputLayersNodeIndices.push(v),this.outputLayersTensorIndices.push(C)}for(let y of this.inputs){let b=y.sourceLayer,v=y.nodeIndex,C=y.tensorIndex;Jo(v===0,"input layer has >1 nodes"),Jo(C===0,"input layer has >1 tensors"),this.inputLayers.push(b),this.inputLayersNodeIndices.push(v),this.inputLayersTensorIndices.push(C)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let y=0;y<this.inputLayers.length;y++){let b=this.inputLayers[y];if(!(b instanceof Yi))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${y} (0-based) originates from layer type ${b.getClassName()}.`);this.inputNames.push(b.name),this.feedInputShapes.push(b.batchInputShape),this.feedInputNames.push(b.name)}for(let y of this.outputLayers)this.outputNames.push(y.name);this.internalInputShapes=this.inputs.map(y=>y.shape),this.internalOutputShapes=this.outputs.map(y=>y.shape);let r={},n={},o={},s={},i={},a=[],l=(y,b,v,C,S,k)=>{(C==null||S==null||k==null)&&(C=y.sourceLayer,S=y.nodeIndex,k=y.tensorIndex);let I=C.inboundNodes[S];if(v.indexOf(I)!==-1)throw new vn(`The tensor ${y.name} at layer "${C.name}" is part of a cycle.`);if(b.indexOf(I)!==-1)return;this.containerNodes.add($o.nodeKey(C,S)),C.id in i||(i[C.id]=Object.keys(i).length),v.indexOf(I)===-1&&v.push(I);let A=I.inboundLayers.length;for(let $=0;$<A;$++){let O=I.inputTensors[$],j=I.inboundLayers[$],H=I.nodeIndices[$],Y=I.tensorIndices[$];l(O,b,v,j,H,Y)}for(b.push(I);v.indexOf(I)>=0;)v.splice(v.indexOf(I),1);a.push(I)},u=[],c=[];for(let y of this.outputs)l(y,u,c);let p=a.slice().reverse();for(let y of p){n[y.id]=y,y.id in r||(r[y.id]=0);let b=r[y.id],v=o[y.outboundLayer.id]==null?0:o[y.outboundLayer.id];b=Math.max(b,v),o[y.outboundLayer.id]=b,s[y.outboundLayer.id]=y.outboundLayer,r[y.id]=b;for(let C=0;C<y.inboundLayers.length;C++){let S=y.inboundLayers[C],k=y.nodeIndices[C],I=S.inboundNodes[k],A=r[I.id]==null?0:r[I.id];r[I.id]=Math.max(b+1,A),n[I.id]=I}}let f={};for(let y in r){let b=r[y];b in f||(f[b]=[]),f[b].push(n[y])}let d={};for(let y in o){let b=o[y];b in d||(d[b]=[]),d[b].push(s[y])}let m=Object.keys(d).map(y=>parseInt(y,10)).sort(ey);this.layers=[];for(let y of m){let b=d[y];b.sort((v,C)=>{let S=i[v.id],k=i[C.id];return S<k?-1:S>k?1:0});for(let v of b)v instanceof $o&&this.internalContainerRefs.push(v),this.layers.push(v)}this.layersByDepth=d,m=Object.keys(f).map(y=>parseInt(y,10)).sort(ey);let h=this.inputs.slice(),x=[];for(let y of m)for(let b of f[y]){let v=b.outboundLayer;if(v!=null){for(let C of b.inputTensors)if(h.indexOf(C)===-1)throw new vn(`Graph disconnected: cannot obtain value for tensor ${C} at layer "${v.name}". The following previous layers were accessed without issue: ${x}`);for(let C of b.outputTensors)h.push(C);x.push(v.name)}}this.nodesByDepth=f;let g=this.layers.map(y=>y.name);for(let y of g){let b=g.filter(v=>v===y).length;if(b!==1)throw new vn(`The name "${y}" is used ${b} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(g))}this.outboundNodes=[],this.inboundNodes=[],new El({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(y=>null),outputMasks:this.outputs.map(y=>null),inputShapes:this.inputs.map(y=>y.shape),outputShapes:this.outputs.map(y=>y.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();let e={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(let r of this.layers)e.numDisposedVariables+=r.dispose().numDisposedVariables;for(let r of this.internalContainerRefs)e.numDisposedVariables+=r.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(r=>{r._trainableWeights.forEach(n=>n.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new z("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(let r of this.layers)e=e.concat(r.trainableWeights);return e}get nonTrainableWeights(){let e=[];for(let r of this.layers)e.push(...r.nonTrainableWeights);if(!this.trainable){let r=[];for(let n of this.layers)r.push(...n.trainableWeights);return r.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,r=!0){let n={},o=0;for(let i of this.layers)for(let a of i.weights){if(n[a.originalName]!=null)throw new z(`Duplicate weight name: ${a.originalName}`);n[a.originalName]=a,o++}let s=[];for(let i in e){let a=i;if(n[i]==null){let l=i.split("/");a=l.slice(0,-2).concat([l[l.length-1]]).join("/")}if(n[a]!=null)s.push([n[a],e[i]]);else if(r)throw new z(`Provided weight data has no target variable: ${i}`);delete n[a]}if(r){let i=[];for(let a in n)i.push(a);if(i.length>0)throw new z(`${i.length} of ${o} weights are not set: ${i}`)}ph(s)}updatedConfig(){let e=this.getConfig(),r={};return r.className=this.getClassName(),r.config=e,r.kerasVersion=`tfjs-layers ${mh}`,r.backend="TensorFlow.js",r}toJSON(e,r=!0){let n=gw(this.updatedConfig());return r?JSON.stringify(n):n}call(e,r){return G(()=>{e=wt(e);let n=new _s;for(let o=0;o<this.inputs.length;++o)n.add(this.inputs[o],e[o]);return gf(this.outputs,n,r)})}computeMask(e,r){return G(()=>{e=wt(e);let n;return r==null?n=ks(null,e.length):n=wt(r),this.runInternalGraph(e,n)[1]})}computeOutputShape(e){let r=uh(e);if(r.length!==this.inputLayers.length)throw new z(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);let n={};for(let a=0;a<r.length;a++){let l=this.inputLayers[a],u=r[a],c=l.name+"_0_0";n[c]=u}let o=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(ey);if(o.length>1)for(let a of o){let l=this.nodesByDepth[a];for(let u of l){let c=u.outboundLayer;if(this.inputLayers.map(h=>h.id).indexOf(c.id)!==-1)continue;let p=[];for(let h=0;h<u.inboundLayers.length;h++){let x=u.inboundLayers[h],g=u.nodeIndices[h],y=u.tensorIndices[h],b=`${x.name}_${g}_${y}`,v=n[b];p.push(v)}let f=c.computeOutputShape(jr(p)),d=uh(f),m=c.inboundNodes.indexOf(u);for(let h=0;h<d.length;h++){let x=`${c.name}_${m}_${h}`;n[x]=d[h]}}}let s=[],i=[];for(let a=0;a<this.outputLayers.length;a++){let l=this.outputLayers[a],u=this.outputLayersNodeIndices[a],c=this.outputLayersTensorIndices[a],p=`${l.name}_${u}_${c}`;i.push(p)}for(let a=0;a<i.length;a++){let l=i[a];Jo(l in n),s.push(n[l])}return jr(s)}runInternalGraph(e,r){r==null&&(r=ks(null,e.length));let n={};for(let l=0;l<this.inputs.length;++l){let u=this.inputs[l],c=e[l],p=r[l];n[u.id]=[c,p]}let o=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(ey);for(let l of o){let u=this.nodesByDepth[l];for(let c of u){let p=c.outboundLayer,f=c.inputTensors,d=c.outputTensors,m=new Array;for(let h of f)h.id in n&&m.push(n[h.id]);if(m.length===f.length){let h={},x,g,y,b;if(c.callArgs!=null&&(h=c.callArgs),m.length===1){let[v,C]=m[0];h.mask==null&&(h.mask=C),y=wt(p.call(v,h)),b=wt(p.computeMask(v,C)),x=[v],g=[C]}else x=m.map(v=>v[0]),g=m.map(v=>v[1]),h.mask==null&&(h.mask=g),y=wt(p.call(x,h)),b=wt(p.computeMask(x,g));if(p.activityRegularizer)throw new De("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let v=0;v<d.length;++v){let C=d[v],S=y[v],k=b[v];n[C.id]=[S,k]}}}}let s=[],i=[],a=[];for(let l of this.outputs){Jo(l.id in n,`Could not compute output ${l.name} : ${l.id}`);let[u,c]=n[l.id];a.push(u.shape),s.push(u),i.push(c)}return[s,i,a]}buildNodeConversionMap(e){let r={},n;for(let o of this.layers){n=o instanceof $o?1:0;for(let s=0;s<o.inboundNodes.length;s++){let i=$o.nodeKey(o,s);this.containerNodes.has(i)&&(r[i]=n,n+=1)}}return r}getLayer(e,r){if(r!=null){if(this.layers.length<=r)throw new z(`Was asked to retrieve layer at index ${r}, but model only has ${this.layers.length} layer(s).`);return this.layers[r]}else if(e==null)throw new z("Provide either a layer name or layer index");for(let n of this.layers)if(n.name===e)return n;throw new z(`No such layer: ${e}`)}calculateLosses(){return G(()=>{let e=[];for(let r of this.layers)for(let n=0;n<r.inboundNodes.length;++n){let o=$o.nodeKey(r,n);this.containerNodes.has(o)&&e.push(...r.calculateLosses())}return e})}getConfig(){let e={name:this.name},r=this.buildNodeConversionMap(this.layers),n=[];for(let i of this.layers){let a=i.getClassName(),l=i.getConfig(),u=[];for(let p=0;p<i.inboundNodes.length;p++){let f=i.inboundNodes[p],d=$o.nodeKey(i,p),m={};if(this.containerNodes.has(d)){if(f.callArgs)try{JSON.stringify(f.callArgs),m=f.callArgs}catch{console.warn(`Layer ${i.name} was passed non-serializable keyword arguments: ${f.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),m={}}if(f.inboundLayers.length>0){let h=[];for(let x=0;x<f.inboundLayers.length;x++){let g=f.inboundLayers[x],y=f.nodeIndices[x],b=f.tensorIndices[x],v=$o.nodeKey(g,y),C=r[v];C==null&&(C=0),h.push([g.name,C,b,m])}u.push(h)}}}let c={};c.name=i.name,c.className=a,c.config=l,c.inboundNodes=u,n.push(c)}e.layers=n;let o=[];for(let i=0;i<this.inputLayers.length;i++){let a=this.inputLayers[i],l=this.inputLayersNodeIndices[i],u=$o.nodeKey(a,l);if(!this.containerNodes.has(u))continue;let c=r[u];c==null&&(c=0);let p=this.inputLayersTensorIndices[i];o.push([a.name,c,p])}e.inputLayers=o;let s=[];for(let i=0;i<this.outputLayers.length;i++){let a=this.outputLayers[i],l=this.outputLayersNodeIndices[i],u=$o.nodeKey(a,l);if(!this.containerNodes.has(u))continue;let c=r[u];c==null&&(c=0);let p=this.outputLayersTensorIndices[i];s.push([a.name,c,p])}return e.outputLayers=s,e}static fromConfig(e,r,n={},o=!1){let s={},i={};function a(x,g){x.name in i?i[x.name].push(g):i[x.name]=[g]}function l(x,g){let y=[],b;for(let v of g){let C=v[0],S=v[1],k=v[2];if(b=v[3]==null?{}:v[3],!(C in s)){a(x,g);return}let I=s[C];if(I.inboundNodes.length<=S){a(x,g);return}let A=I.inboundNodes[S];y.push(A.outputTensors[k])}y.length>0&&x.apply(jr(y),b)}function u(x){let g=x.name,y=Do(x,r.customObjects!=null?r.customObjects:{});y.setFastWeightInitDuringBuild(o),s[g]=y,x.inboundNodes.forEach(v=>{if(!(v instanceof Array))throw new z(`Corrupted configuration, expected array for nodeData: ${v}`);a(y,v)})}let c=r.name,p=r.layers;for(let x of p)u(x);for(;!uz(i);)for(let x of p){let g=s[x.name];if(g.name in i){let y=i[g.name];delete i[g.name];for(let b of y)l(g,b)}}let f=[],d=[],m=r.inputLayers;for(let x of m){let g=x[0],y=x[1],b=x[2];Jo(g in s);let C=s[g].inboundNodes[y].outputTensors;f.push(C[b])}let h=r.outputLayers;for(let x of h){let g=x[0],y=x[1],b=x[2];Jo(g in s);let C=s[g].inboundNodes[y].outputTensors;d.push(C[b])}return new e({inputs:f,outputs:d,name:c})}get stateful(){if(this._stateful)throw new z("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(let e of this.layers)if(e.stateful)return!0;return!1}resetStates(){G(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}};function Roe(t,e,r){let n=e.length;if(t==null||Array.isArray(t)&&t.length===0)return e.map(o=>null);if(n===1)return Array.isArray(t)&&t.length===1?t:typeof t=="object"&&e[0]in t?[t[e[0]]]:[t];if(Array.isArray(t)){if(t.length!==n)throw new Error(`Provided ${r} is an array of ${t.length} element(s), but the model has ${n} outputs. Make sure a set of weights is provided for each model output.`);return t}else if(typeof t=="object"&&Object.keys(t).length>0&&typeof t[Object.keys(t)[0]]=="object"){let o=[];return e.forEach(s=>{s in t?o.push(t[s]):o.push(null)}),o}else throw new Error(`The model has multiple (${n}) outputs, so ${r} must be either an array with ${n} elements or an object with ${e} keys. Provided ${r} not understood: ${JSON.stringify(t)}`)}function xw(t,e){return Roe(t,e,"classWeight")}async function yw(t,e,r,n){if(e!=null||n!=null)throw new Error("Support sampleWeight is not implemented yet");if(r!=null){let o=G(()=>{if(t.shape.length===1)return To(t);if(t.shape.length===2){if(t.shape[1]>1)return xl(t,1);if(t.shape[1]===1)return M(t,[t.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${t.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${t.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),s=Array.from(await o.data());Me(o);let i=[];return s.forEach(a=>{if(r[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);i.push(r[a])}),Rr(i,"float32")}else return null}function Hz(t,e){return L(t,e)}var Ooe=32;function Kz(t,e){let r,n,o=e;r=o.xs,n=o.ys,w.assert(r!=null&&n!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`);let s=qz("input",t.inputNames,r),i=qz("output",t.outputNames,n),a=s[0].shape[0];w.assert(s.length===t.inputs.length,()=>`LayersModel has ${t.inputs.length} inputs, but the dataset provides ${s.length} inputs.  (Expected input keys: ${JSON.stringify(t.inputNames)})`),w.assert(i.length===t.outputs.length,()=>`LayersModel has ${t.outputs.length} outputs, but the dataset provides ${i.length} outputs.  (Expected output keys: ${JSON.stringify(t.outputNames)})`);for(let l=0;l<s.length;l++)w.assert(s[l].shape[0]===a,()=>`Batch size mismatch: input ${t.inputNames[l]} has ${s[l].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`);for(let l=0;l<i.length;l++)w.assert(i[l].shape[0]===a,()=>`Batch size mismatch: output ${t.outputNames[l]} has ${i[l].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`);return{xs:s,ys:i}}function qz(t,e,r){if(r instanceof Je)return[r];if(Array.isArray(r))return w.assert(r.length===e.length,()=>`Received an array of ${r.length} Tensors, but expected ${e.length} to match the ${t} keys ${e}.`),r;{let n=[];for(let o of e){if(r[o]==null)throw new z(`The feature data generated by the dataset lacks the required ${t} key '${o}'.`);n.push(r[o])}return n}}function Foe(t){if(t.length===3)throw new De("Validation with sample weights is not implemented yet.");return{xs:t[0],ys:t[1]}}async function Xz(t,e,r){let n=r.batchesPerEpoch!=null;if(w.assert(t.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),w.assert(r!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),w.assert(r.epochs!=null&&r.epochs>0&&Number.isInteger(r.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${r.epochs}`),w.assert(!n||r.batchesPerEpoch>0&&Number.isInteger(r.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${r.batchesPerEpoch}`),w.assert(r.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");t.isTraining=!0;try{let o=r.validationData!=null,s,i;if(o)if(jz(r.validationData))w.assert(r.validationBatches==null||r.validationBatches>0&&Number.isInteger(r.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${r.validationBatches}`);else{let x=Foe(r.validationData);s=x.xs,i=x.ys}let a=t.makeTrainFunction(),l=t.getDedupedMetricsNames(),u;o?u=l.slice().concat(l.map(x=>"val_"+x)):u=l.slice();let c=aw(r.callbacks,r.yieldEvery),p=r.verbose==null?1:r.verbose,{callbackList:f,history:d}=lw(c,p,r.epochs,null,null,Poe(e,r),null,o,u);f.setModel(t),t.history=d,await f.onTrainBegin(),t.stopTraining_=!1;let m=r.initialEpoch==null?0:r.initialEpoch,h=await e.iterator();for(;m<r.epochs;){let x={};await f.onEpochBegin(m);let g=0,y=0;for(n||(h=await e.iterator());!n||g<r.batchesPerEpoch;){let b=await h.next();if(n&&b.done){console.warn(`You provided \`batchesPerEpoch\` as ${r.batchesPerEpoch}, but your dataset iterator ran out of data after ${g} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${r.batchesPerEpoch*r.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(b.value!=null){let{xs:v,ys:C}=Kz(t,b.value),S={};S.batch=y,S.size=v[0].shape[0],await f.onBatchBegin(y,S);let k=[];if(r.classWeight!=null){let $=xw(r.classWeight,t.outputNames);for(let O=0;O<$.length;++O)k.push(await yw(C[O],null,$[O]))}let I=v.concat(C).concat(k),A=a(I);Me(I);for(let $=0;$<l.length;++$){let O=l[$],j=A[$];S[O]=j,Ur(j)}await f.onBatchEnd(y,S),nw(S),y++,g++}if(n?g>=r.batchesPerEpoch:b.done){if(o){let v;jz(r.validationData)?v=wt(await t.evaluateDataset(r.validationData,{batches:r.validationBatches})):v=wt(t.evaluate(s,i,{batchSize:r.validationBatchSize==null?Ooe:r.validationBatchSize,verbose:0}));for(let C=0;C<t.metricsNames.length;++C)x[`val_${t.metricsNames[C]}`]=v[C]}break}if(t.stopTraining_)break}if(await f.onEpochEnd(m,x),m++,t.stopTraining_)break}return await f.onTrainEnd(),await t.history.syncData(),t.history}finally{t.isTraining=!1}}function Poe(t,e){let r=null;return e.batchesPerEpoch!=null?r=e.batchesPerEpoch:Number.isFinite(t.size)&&(r=t.size),r}function jz(t){return typeof t.iterator=="function"}function Loe(t){return typeof t.next=="function"}async function Yz(t,e,r){r=r||{};let n=r.batches!=null,o=t.testFunction,s=[];if(r.verbose>0)throw new De("Verbose mode is not implemented yet.");w.assert(!n||r.batches>0&&Number.isInteger(r.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(r.batches)}`);let i=Loe(e)?e:await e.iterator(),a=0,l=0;for(;!n||l<r.batches;){let u=await i.next();if(s=G(()=>{if(u.value){let{xs:c,ys:p}=Kz(t,u.value),f=c.concat(p),d=G(()=>o(f));if(Me(f),l===0)for(let h=0;h<d.length;++h)s.push(Oe(0));let m=f[0].shape[0];for(let h=0;h<d.length;++h){let x=d[h],g=s[h];s[h]=G(()=>te(s[h],L(m,x))),l>0&&Me(g)}Me(d),a+=m,++l}return s}),u.done){n&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${r.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let u=0;u<s.length;++u){let c=s[u];s[u]=xe(s[u],a),Me(c)}return jr(s)}function bw(t){w.assert(t>0&&Number.isInteger(t),()=>`batchSize is required to be a positive integer, but got ${t}`)}function hh(t,e,r){return t==null?[null]:Array.isArray(t)?t.map(n=>Nl(n,e,r-e)):Nl(t,e,r-e)}function vw(t,e){return G(()=>t==null?null:Array.isArray(t)?t.map(r=>vw(r,e)):Z1(t,e.dtype==="int32"?e:oe(e,"int32")))}function ww(t,e){let r=[],n=0,o=null;for(;n<t;)o=n+e,o>=t&&(o=t),r.push([n,o]),n=o;return r}function EE(t){let e=[];t instanceof Je&&(t=[t]);for(let r=0;r<t.length;++r){let n=t[r];if(n.rank===1)e.push(Il(n,1));else{if(n.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(n)}}return e}function As(t,e){if(t==null)return;let r=[];if(e instanceof Je)r.push(e.id);else if(Array.isArray(e))e.forEach(o=>r.push(o.id));else if(e!=null)for(let o in e){let s=e[o];r.push(s.id)}let n=[];if(t instanceof Je)r.indexOf(t.id)===-1&&n.push(t);else if(Array.isArray(t))t.forEach(o=>{r.indexOf(o.id)===-1&&n.push(o)});else if(t!=null)for(let o in t){let s=t[o];r.indexOf(s.id)===-1&&n.push(s)}n.forEach(o=>{o.isDisposed||o.dispose()})}function Moe(t){return t instanceof Je}function _E(t){return Array.isArray(t)}function Qz(t){return!Moe(t)&&!_E(t)}function Zz(t,e,r,n=!0,o=""){if(e==null||e.length===0){if(t!=null){let i=!1;if(_E(t)&&t.length>0)i=!0;else if(Qz(t)){for(let a in t)if(t.hasOwnProperty(a)){i=!0;break}}else i=!0;if(i)throw new z(`Error when checking model ${o} expected no data, but got ${t}`)}return[]}if(t==null)return e.map(i=>null);let s;if(Qz(t)){t=t,s=[];for(let i of e){if(t[i]==null)throw new z(`No data provided for "${i}". Need data for each key in: ${e}`);s.push(t[i])}}else if(_E(t)){if(t=t,t.length!==e.length)throw new z(`Error when checking model ${o}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${t}`);s=t}else{if(t=t,e.length>1)throw new z(`The model ${o} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${t.shape}`);s=[t]}if(s=EE(s),r!=null)for(let i=0;i<e.length;++i){if(r[i]==null)continue;let a=s[i];if(a.shape.length!==r[i].length)throw new z(`Error when checking ${o}: expected ${e[i]} to have ${r[i].length} dimension(s). but got array with shape ${a.shape}`);for(let l=0;l<r[i].length;++l){if(l===0&&!n)continue;let u=a.shape[l],c=r[i][l];if(c!=null&&c>=0&&u!==c)throw new z(`${o} expected a batch of elements where each example has shape [${r[i].slice(1,r[i].length)}] (i.e.,tensor shape [*,${r[i].slice(1,r[i].length)}]) but the ${o} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return s}function zoe(t,e,r){let n=Ns(t.map(s=>s.shape[0]));n.sort();let o=Ns(e.map(s=>s.shape[0]));if(o.sort(),n.length>1)throw new z(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map(s=>s.shape))}`);if(o.length>1)throw new z(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(s=>s.shape))}`);if(n.length>0&&o.length>0&&!w.arraysEqual(n,o))throw new z(`Input Tensors should have the same number of samples as target Tensors. Found ${n[0]} input sample(s) and ${o[0]} target sample(s).`)}function Boe(t,e,r){let n=[yf,dh,bf];for(let o=0;o<t.length;++o){let s=t[o],i=e[o],a=r[o];if(i!=null){if(i===bf&&s.shape[s.shape.length-1]===1)throw new z(`You are passing a target array of shape ${s.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(n.indexOf(i)!==-1){let l=s.shape.slice(1),u=a.slice(1);for(let c=0;c<l.length;++c){let p=l[c],f=u[c];if(f!=null&&p!==f)throw new z(`A target Tensor with shape ${s.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function Jz(t,e,r,n=!0,o=""){let s;if(Array.isArray(t)){if(t.length!==e.length)throw new z(`Error when checking model ${o}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${t.length} Tensors(s).`);s=t}else{if(e.length>1)throw new z(`The model expects ${e.length} ${o} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(t.shape)}.`);s=[t]}if(r!=null)for(let i=0;i<e.length;++i){if(r[i]==null)continue;let a=s[i];if(a.shape.length!==r[i].length)throw new z(`Error when checking ${o}: expected ${e[i]} to have ${r[i].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let l=0;l<r[i].length;++l){if(l===0&&!n)continue;let u=a.shape[l],c=r[i][l];if(c!=null&&c!==u)throw new z(`Error when checking ${o}: expected ${e[i]} to have shape ${JSON.stringify(r[i])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function Voe(t,e){if(t==null||Array.isArray(t)&&t.length===0)return e.map(n=>[]);let r;if(typeof t=="string"||typeof t=="function")r=[t];else if(Array.isArray(t)||typeof t=="object")r=t;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${t}`);if(Array.isArray(r))return e.map(n=>r);{let n=[];for(let o of e){let s=r.hasOwnProperty(o)?r[o]:[];Array.isArray(s)||(s=[s]),n.push(s)}return n}}var Woe="layers-model",Ds=class extends $o{constructor(e){super(e),this.isTraining=!1}summary(e,r,n=console.log){if(!this.built)throw new z("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");Gz(this,e,r,n)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=Wz(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof yn))throw new z("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let r=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(let i in e.loss)if(this.outputNames.indexOf(i)===-1)throw new z(`Unknown entry in loss dictionary: "${i}". Only expected the following keys: ${this.outputNames}`);for(let i of this.outputNames)e.loss[i]==null&&console.warn(`Output "${i}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${i} during training`),r.push(cw(e.loss[i]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new z(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);r=e.loss.map(a=>cw(a))}else{let i=cw(e.loss);this.outputs.forEach(a=>{r.push(i)})}this.lossFunctions=r,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let i=0;i<this.outputs.length;++i){let a=this.internalOutputShapes[i],l=this.outputNames[i];this.feedOutputNames.push(l),this.feedOutputShapes.push(a),this.feedLossFns.push(this.lossFunctions[i])}let n=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],ui("loss",()=>{for(let i=0;i<this.outputs.length;++i){if(n.indexOf(i)!==-1)continue;let a=this.lossFunctions[i];this.outputs.length>1&&(this.metricsTensors.push([a,i]),this.metricsNames.push(this.outputNames[i]+"_loss"))}});let o=Voe(e.metrics,this.outputNames),s=(i,a,l)=>{this.outputNames.length>1&&(a=this.outputNames[i]+"_"+a),this.metricsNames.push(a),this.metricsTensors.push([l,i])};ui("metric",()=>{for(let i=0;i<this.outputs.length;++i){if(n.indexOf(i)!==-1)continue;let a=o[i];(u=>{let c="",p,f,d;for(let m of u){if(typeof m=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(m)!==-1){let x=this.internalOutputShapes[i];x[x.length-1]===1||this.lossFunctions[i]===dh?["accuracy","acc"].indexOf(m)!==-1?f=fw:["crossentropy","ce"].indexOf(m)!==-1&&(f=SE):this.lossFunctions[i]===fh?["accuracy","acc"].indexOf(m)!==-1?f=kE:["crossentropy","ce"].indexOf(m)!==-1&&(f=TE):["accuracy","acc"].indexOf(m)!==-1?f=dw:["crossentropy","ce"].indexOf(m)!==-1&&(f=mw);let g;["accuracy","acc"].indexOf(m)!==-1?g="acc":["crossentropy","ce"].indexOf(m)!==-1&&(g="ce"),d=f,p=c+g}else d=Bz(m),p=c+vy(m);let h;ui(p,()=>{h=d}),s(i,p,h)}})(a)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,r,n={}){let o=n.batchSize==null?32:n.batchSize;bw(o);let s=!0,i=this.standardizeUserDataXY(e,r,s,o);try{let a=i[0].concat(i[1]);this.makeTestFunction();let l=this.testFunction,u=this.testLoop(l,a,o,n.verbose,n.steps);return jr(u)}finally{As(i[0],e),As(i[1],r)}}async evaluateDataset(e,r){return this.makeTestFunction(),Yz(this,e,r)}checkNumSamples(e,r,n,o="steps"){let s;if(n!=null){if(s=null,r!=null)throw new z(`If ${o} is set, batchSize must be null or undefined.Got batchSize = ${r}`)}else if(e!=null)Array.isArray(e)?s=e[0].shape[0]:s=e.shape[0];else throw new z(`Either the input data should have a defined shape, or ${o} shoud be specified.`);return s}execute(e,r){if(Array.isArray(r)&&r.length===0)throw new z("`outputs` is an empty Array, which is not allowed.");let n=Array.isArray(r),o=n?r:[r],s=this.retrieveSymbolicTensors(o),i=new _s;if(e instanceof Je&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new z(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let l=0;l<this.inputs.length;++l)i.add(this.inputs[l],e[l])}else for(let l of this.inputs){let u=e[l.name];if(u==null)throw new z(`No value is provided for the model's input ${l.name}`);i.add(l,u)}let a=gf(s,i);return n?a:a[0]}retrieveSymbolicTensors(e){let r=ks(null,e.length),n=e.length;for(let o of this.layers){let s=Array.isArray(o.output)?o.output:[o.output],i=s.map(a=>a.name);for(let a=0;a<e.length;++a){let l=i.indexOf(e[a]);if(l!==-1&&(r[a]=s[l],n--),n===0)break}if(n===0)break}if(n>0){let o=[];throw r.forEach((s,i)=>{s==null&&o.push(e[i])}),new z(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(o)}`)}return r}predictLoop(e,r=32,n=!1){return G(()=>{let o=this.checkNumSamples(e);if(n)throw new De("Verbose predictLoop() is not implemented yet.");let s=ww(o,r),i=this.outputs.map(a=>[]);for(let a=0;a<s.length;++a)G(()=>{let u=s[a][0],c=s[a][1],p=hh(e,u,c),f=[];if(Array.isArray(p))for(let m=0;m<p.length;++m)f.push({key:this.inputs[m],value:p[m]});else f.push({key:this.inputs[0],value:p});let d=new _s(f);return gf(this.outputs,d)}).forEach((u,c)=>i[c].push(u));return jr(i.map(a=>Ot(a,0)))})}predict(e,r={}){let n=EE(e);Jz(n,this.inputNames,this.feedInputShapes,!1);try{let o=r.batchSize==null?32:r.batchSize;return bw(o),this.predictLoop(n,o)}finally{As(n,e)}}predictOnBatch(e){Jz(e,this.inputNames,this.feedInputShapes,!0);let r=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,r)}standardizeUserDataXY(e,r,n=!0,o){if(this.optimizer_==null)throw new vn("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");let s=[];for(let i=0;i<this.feedOutputShapes.length;++i){let a=this.feedOutputShapes[i];this.feedLossFns[i]===fh?s.push(a.slice(0,a.length-1).concat([1])):s.push(a)}if(e=Zz(e,this.feedInputNames,this.feedInputShapes,!1,"input"),r=Zz(r,this.feedOutputNames,s,!1,"target"),zoe(e,r,null),Boe(r,this.feedLossFns,this.feedOutputShapes),this.stateful&&o!=null&&o>0&&e[0].shape[0]%o!==0)throw new z(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${o}. Found: ${e[0].shape[0]} sample(s).`);return[e,r]}async standardizeUserData(e,r,n,o,s=!0,i){let[a,l]=this.standardizeUserDataXY(e,r,s,i);if(n!=null)throw new Error("sample weight is not supported yet.");let u=null;if(o!=null){let c=xw(o,this.outputNames);u=[];for(let p=0;p<c.length;++p)u.push(await yw(l[p],null,c[p]))}return[a,l,u]}testLoop(e,r,n,o=0,s){return G(()=>{let i=this.checkNumSamples(r,n,s,"steps"),a=[];if(o>0)throw new De("Verbose mode is not implemented yet.");if(s!=null)throw new De("steps mode in testLoop() is not implemented yet");{let l=ww(i,n),u=Rr(jn(0,i));for(let c=0;c<l.length;++c){let p=l[c][0],f=l[c][1],d=Nl(u,p,f-p),m=vw(r,d),h=e(m);if(c===0)for(let x=0;x<h.length;++x)a.push(Oe(0));for(let x=0;x<h.length;++x){let g=h[x];a[x]=te(a[x],L(f-p,g))}}for(let c=0;c<a.length;++c)a[c]=xe(a[c],i)}return a})}getDedupedMetricsNames(){let e=this.metricsNames,r=[];for(let n=0;n<e.length;++n){let o=e[n],s=o;if(dE(e,o)>1){let i=dE(e.slice(0,n),o);s+=`_${i}`}r.push(s)}return r}makeTrainFunction(){return e=>{let r=[],n=e.slice(0,this.inputs.length),o=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),s=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),i=[],a=()=>{let p=[];for(let h=0;h<this.inputs.length;++h)p.push({key:this.inputs[h],value:n[h]});let f=new _s(p),d=gf(this.outputs,f,{training:!0}),m;for(let h=0;h<this.lossFunctions.length;++h){let x=this.lossFunctions[h],g=x(o[h],d[h]);s[h]!=null&&(g=Hz(g,s[h]));let y=Wt(g);r.push(y),h===0?m=g:m=te(m,g)}for(let h=0;h<this.metricsTensors.length;++h){let x;if(this.outputs.length>1&&h<this.outputs.length)x=r[h];else{let g=this.metricsTensors[h][0],y=this.metricsTensors[h][1];x=Wt(g(o[y],d[y]))}Ur(x),i.push(x)}return m=Wt(m),this.calculateLosses().forEach(h=>{m=te(m,h)}),m},l=this.collectedTrainableWeights.map(p=>p.read()),u=!0;return[this.optimizer_.minimize(a,u,l)].concat(i)}}makeTestFunction(){this.testFunction=e=>G(()=>{let r=[],n,o=e.slice(0,this.inputs.length),s=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=[];for(let u=0;u<this.inputs.length;++u)i.push({key:this.inputs[u],value:o[u]});let a=new _s(i),l=gf(this.outputs,a);for(let u=0;u<this.lossFunctions.length;++u){let c=this.lossFunctions[u],p=Wt(c(s[u],l[u]));u===0?n=p:n=te(n,p),r.push(n)}for(let u=0;u<this.metricsTensors.length;++u){let c=this.metricsTensors[u][0],p=this.metricsTensors[u][1],f=Wt(c(s[p],l[p]));r.push(f)}return r})}async fit(e,r,n={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let o,s,i,a,l,u,c,p,f;try{let d=n.batchSize==null?32:n.batchSize;bw(d);let m=!1,h=await this.standardizeUserData(e,r,n.sampleWeight,n.classWeight,m,d);o=h[0],s=h[1],f=h[2];let x=!1,g;if(n.validationData!=null&&n.validationData.length>0){if(x=!0,n.validationData.length===2)l=n.validationData[0],u=n.validationData[1];else throw n.validationData.length===3?new De("validationData including sample weights is not supported yet."):new z(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${n.validationData} is invalid.`);let A=!0,$=await this.standardizeUserData(l,u,null,null,A,d);c=$[0],p=$[1],g=c.concat(p)}else if(n.validationSplit!=null&&n.validationSplit>0&&n.validationSplit<1){x=!0;let A=Math.floor(o[0].shape[0]*(1-n.validationSplit)),$=o[0].shape[0];c=hh(o,A,$),i=o,o=hh(o,0,A),p=hh(s,A,$),a=s,s=hh(s,0,A),g=c.concat(p)}else n.validationSteps!=null&&(x=!0);let y=o.concat(s).concat(f);this.checkTrainableWeightsConsistency();let b=this.makeTrainFunction(),v=this.getDedupedMetricsNames(),C,S;x?(this.makeTestFunction(),C=this.testFunction,S=v.slice().concat(v.map(A=>"val_"+A))):(C=null,g=[],S=v.slice());let k=aw(n.callbacks,n.yieldEvery);return await this.fitLoop(b,y,v,d,n.epochs,n.verbose,k,C,g,n.shuffle,S,n.initialEpoch,null,null)}finally{this.isTraining=!1,As(o,e),As(s,r),As(i,e),As(a,r),As(c,l),As(p,u),f!=null&&Me(f)}}async fitLoop(e,r,n,o,s,i,a,l,u,c,p,f,d,m){o==null&&(o=32),s==null&&(s=1),c==null&&(c=!0),f==null&&(f=0);let h=!1;if(l!=null&&u!=null&&(h=!0),m!=null&&(h=!0,d==null))throw new z("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");let x=this.checkNumSamples(r,o,d,"steps_per_epoch"),g;x!=null&&(g=jn(0,x)),i==null&&(i=1);let{callbackList:y,history:b}=lw(a,i,s,f,x,d,o,h,p);y.setModel(this),this.history=b,await y.onTrainBegin(),this.stopTraining_=!1;for(let v=f;v<s;++v){await y.onEpochBegin(v);let C={};if(d!=null)throw new De("stepsPerEpoch mode is not implemented yet.");{if(c==="batch")throw new De("batch shuffling is not implemneted yet");c&&w.shuffle(g);let S=Rr(g),k=ww(x,o);for(let I=0;I<k.length;++I){let A={};if(await y.onBatchBegin(I,A),G(()=>{let $=k[I][0],O=k[I][1],j=Nl(S,$,O-$);A.batch=I,A.size=O-$;let H=vw(r,j),Y=e(H);for(let B=0;B<n.length;++B){let K=n[B],X=Y[B];A[K]=X,Ur(X)}if(I===k.length-1&&h){let B=this.testLoop(l,u,o);for(let K=0;K<n.length;++K){let X=n[K],Z=B[K];Ur(Z),C["val_"+X]=Z}}}),await y.onBatchEnd(I,A),nw(A),this.stopTraining_)break}S.dispose()}if(await y.onEpochEnd(v,C),this.stopTraining_)break}return await y.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,r){return Xz(this,e,r)}async trainOnBatch(e,r){let n=await this.standardizeUserData(e,r),o=n[0],s=n[1],a=this.makeTrainFunction()(o.concat(s)),l=[];for(let u of a){let c=await u.data();l.push(c[0])}return Me(a),As(n[0],e),As(n[1],r),jr(l)}getNamedWeights(e){let r=[],n=e!=null&&e.trainableOnly,o=n?this.trainableWeights:this.weights,s=this.getWeights(n);for(let i=0;i<o.length;++i)n&&!o[i].trainable||r.push({name:o[i].originalName,tensor:s[i]});return r}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){let e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){let r=Ex().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=r-Ex().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=Ts(this.loss);else if(Array.isArray(this.loss)){for(let r of this.loss)if(typeof r!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(r=>Ts(r))}else{let r=Object.keys(this.loss);e={};let n=this.loss;for(let o of r)if(typeof n[o]=="string")e[o]=Ts(n[o]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[Ts(vy(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>Ts(vy(e)));{let e={};for(let r in this.metrics)e[r]=Ts(vy(this.metrics[r]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");let r=wy(e.optimizer_config),n=Do(r),o;if(typeof e.loss=="string")o=Tl(e.loss);else if(Array.isArray(e.loss))o=e.loss.map(i=>Tl(i));else if(e.loss!=null){o={};for(let i in e.loss)o[i]=Tl(e.loss[i])}let s;if(Array.isArray(e.metrics))s=e.metrics.map(i=>Tl(i));else if(e.metrics!=null){s={};for(let i in e.metrics)s[i]=Tl(e.metrics[i])}this.compile({loss:o,metrics:s,optimizer:n})}async save(e,r){if(typeof e=="string"){let u=gl.getSaveHandlers(e);if(u.length===0)throw new z(`Cannot find any save handlers for URL '${e}'`);if(u.length>1)throw new z(`Found more than one (${u.length}) save handlers for URL '${e}'`);e=u[0]}if(e.save==null)throw new z("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");let n=await gl.encodeWeights(this.getNamedWeights(r)),o=!1,s=null,a={modelTopology:this.toJSON(s,o),format:Woe,generatedBy:`TensorFlow.js tfjs-layers v${mh}`,convertedBy:null};if((r==null?!1:r.includeOptimizer)&&this.optimizer!=null){a.trainingConfig=this.getTrainingConfig();let u="optimizer",{data:c,specs:p}=await gl.encodeWeights(await this.optimizer.getWeights(),u);n.specs.push(...p),n.data=gl.concatenateArrayBuffers([n.data,c])}return this.userDefinedMetadata!=null&&(IE(this.userDefinedMetadata,this.name,!0),a.userDefinedMetadata=this.userDefinedMetadata),a.weightData=n.data,a.weightSpecs=n.specs,e.save(a)}setUserDefinedMetadata(e){IE(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}};Ds.className="Model";J.registerClass(Ds);var Cw=class extends Ds{};Cw.className="Functional";J.registerClass(Cw);var Al=class extends Ds{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:bc("sequential_"),e.layers!=null)for(let r of e.layers)this.add(r)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(n=>n<0))throw new z(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){let r=e instanceof Al||e instanceof Ds,n;if(r){if(n=e,n.outputs.length!==1)throw new z("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(n.inputs.length!==1)throw new z("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new z("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");let o=vE({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(o)}if(r)this.outputs=n.outputs,this.inputs=n.inputs;else{if(e.inboundNodes.length!==1)throw new z(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new z("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=bE(this.outputs[0])}this.inboundNodes=[],new El({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:ks(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(o=>o.shape),outputShapes:this.outputs[0].shape})}else{let o=e.apply(this.outputs[0]);if(Array.isArray(o))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[o],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{let e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,r){return this.model==null&&this.build(),this.model.call(e,r)}build(e){if(qe(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new Ds({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,r,n=console.log){this.built||this.build(),super.summary(e,r,n)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,r,n={}){if(!this.built)throw new vn("The model needs to be compiled before being used.");return this.model.evaluate(e,r,n)}async evaluateDataset(e,r){if(!this.built)throw new vn("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,r)}predict(e,r={}){return this.model==null&&this.build(),this.model.predict(e,r)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,r,n={}){if(!this.built)throw new vn("The model needs to be compiled before being used.");return this.model.fit(e,r,n)}async fitDataset(e,r){if(!this.built)throw new vn("The model needs to be compiled before being used.");return this.model.fitDataset(e,r)}async trainOnBatch(e,r){return this.model.trainOnBatch(e,r)}static fromConfig(e,r,n={},o=!1){let s,i={};if(r instanceof Array){if(r[0].className==null||r[0].className==="Merge")throw new z("Legacy serialization format not supported yet.");s=r}else w.assert(r.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),s=r.layers,delete r.layers,i=r;let a=new e(i);if(!(a instanceof Al))throw new De(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(let l of s){let c=Do(l,void 0,o);o&&c.setFastWeightInitDuringBuild(!0),a.add(c)}return a}set stopTraining(e){if(this.model==null)throw new z("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new z("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){let e=[];for(let r of this.layers){let n={};n.className=r.getClassName(),n.config=r.getConfig(),e.push(n)}return{name:this.name,layers:e}}};Al.className="Sequential";J.registerClass(Al);var On=class extends J.Serializable{getConfig(){return{}}},Sw=class extends On{apply(e,r=1){return kz(e,r)}};Sw.className="elu";J.registerClass(Sw);var kw=class extends On{apply(e){return Gx(e)}};kw.className="selu";J.registerClass(kw);var Tw=class extends On{apply(e){return Ao(e)}};Tw.className="relu";J.registerClass(Tw);var Nw=class extends On{apply(e){return G(()=>tf(6,Ao(e)))}};Nw.className="relu6";J.registerClass(Nw);var Iw=class extends On{apply(e){return e}};Iw.className="linear";J.registerClass(Iw);var Ew=class extends On{apply(e){return bs(e)}};Ew.className="sigmoid";J.registerClass(Ew);var _w=class extends On{apply(e){return Nz(e)}};_w.className="hardSigmoid";J.registerClass(_w);var Aw=class extends On{apply(e){return Hi(e)}};Aw.className="softplus";J.registerClass(Aw);var Dw=class extends On{apply(e){return Tz(e)}};Dw.className="softsign";J.registerClass(Dw);var $w=class extends On{apply(e){return Fm(e)}};$w.className="tanh";J.registerClass($w);var gh=class extends On{apply(e,r=-1){return sf(e,r)}};gh.className="softmax";J.registerClass(gh);var Rw=class extends On{apply(e,r=-1){return zx(e,r)}};Rw.className="logSoftmax";J.registerClass(Rw);var Ow=class extends On{apply(e,r=1){return G(()=>L(bs(L(e,r)),e))}};Ow.className="swish";J.registerClass(Ow);var Fw=class extends On{apply(e){return G(()=>L(e,Fm(Hi(e))))}};Fw.className="mish";J.registerClass(Fw);function pi(t){return t.getClassName()}function AE(t,e={}){return Ki(t,J.SerializationMap.getMap().classNameMap,e,"activation")}function fi(t){if(t==null){let e={};return e.className="linear",e.config={},AE(e)}if(typeof t=="string"){let e={};return e.className=t,e.config={},AE(e)}else return t instanceof On?t:AE(t)}function Uoe(t){if(t!=null&&typeof t!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${t}`)}var Pw=class extends J.Serializable{},Cy=class extends Pw{constructor(e){super(),Uoe(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return G(()=>{let r=Pt([1]);return this.hasL1&&(r=te(r,ye(L(this.l1,Sr(e))))),this.hasL2&&(r=te(r,ye(L(this.l2,mf(e))))),M(r,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,r){return new e({l1:r.l1,l2:r.l2})}};Cy.className="L1L2";J.registerClass(Cy);var eB={l1l2:"L1L2"};function ft(t){return Jm(t)}function tB(t,e={}){return Ki(t,J.SerializationMap.getMap().classNameMap,e,"regularizer")}function St(t){if(t==null)return null;if(typeof t=="string"){let r={className:t in eB?eB[t]:t,config:{}};return tB(r)}else return t instanceof Pw?t:tB(t)}var Sy=class extends ze{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,r){e=$e(e);let n=Ao(e);return this.maxValue!=null&&(n=sn(n,0,this.maxValue)),n}computeOutputShape(e){return e}getConfig(){let e={maxValue:this.maxValue},r=super.getConfig();return Object.assign(e,r),e}};Sy.className="ReLU";J.registerClass(Sy);var ky=class extends ze{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,r){let n=$e(e);return Jp(n,this.alpha)}computeOutputShape(e){return e}getConfig(){let e={alpha:this.alpha},r=super.getConfig();return Object.assign(e,r),e}};ky.className="LeakyReLU";J.registerClass(ky);var Ty=class extends ze{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=gt(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=St(e.alphaRegularizer),this.alphaConstraint=Xt(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new z(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=qe(e);let r=e.slice(1);if(this.sharedAxes!=null)for(let o of this.sharedAxes)r[o-1]=1;this.alpha=this.addWeight("alpha",r,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);let n={};if(this.sharedAxes!=null)for(let o=1;o<e.length;++o)n[o]=e[o];this.inputSpec=[new Ct({ndim:e.length,axes:n})],this.built=!0}call(e,r){return e=$e(e),nf(e,this.alpha.read())}getConfig(){let e={alphaInitializer:Et(this.alphaInitializer),alphaRegularizer:ft(this.alphaRegularizer),alphaConstraint:Kt(this.alphaConstraint),sharedAxes:this.sharedAxes},r=super.getConfig();return Object.assign(e,r),e}};Ty.className="PReLU";J.registerClass(Ty);var Ny=class extends ze{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new De(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,r){let n=$e(e);return wl(n)}computeOutputShape(e){return e}getConfig(){let e={alpha:this.alpha},r=super.getConfig();return Object.assign(e,r),e}};Ny.className="ELU";J.registerClass(Ny);var Iy=class extends ze{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,r){let n=$e(e);return L(n,oe(tr(n,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){let e={theta:this.theta},r=super.getConfig();return Object.assign(e,r),e}};Iy.className="ThresholdedReLU";J.registerClass(Iy);var Ey=class extends ze{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new gh().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,r){let n=$e(e);return this.softmax(n,this.axis)}computeOutputShape(e){return e}getConfig(){let e={axis:this.axis},r=super.getConfig();return Object.assign(e,r),e}};Ey.className="Softmax";J.registerClass(Ey);function Cc(t,e,r){if(typeof t=="number")return ks(t,e);if(t.length!==e)throw new z(`The ${r} argument must be an integer or tuple of ${e} integers. Received: ${t.length} elements.`);for(let n=0;n<e;++n){let o=t[n];if(!vz(o))throw new z(`The ${r} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(t)} including a non-integer number ${o}`)}return t}function lo(t,e,r,n,o=1){if(t==null)return t;let s=e+(e-1)*(o-1),i;return r==="same"?i=t:i=t-s+1,Math.floor((i+n-1)/n)}function di(t,e,r,n){if(t==null)return null;if(n==="valid")t=t*e+ci([r-e,0]);else if(n==="same")t=t*e;else throw new z(`Unsupport padding mode: ${n}.`);return t}function Oy(t,e){return G(()=>(Gt(e),e==="channelsFirst"?Ue(t,[0,2,3,1]):t))}function DE(t,e){return G(()=>(Gt(e),e==="channelsFirst"?Ue(t,[0,2,3,4,1]):t))}function qoe(t,e,r,n=1,o="valid",s,i=1){return G(()=>{if(s==null&&(s=Kn()),Gt(s),t.shape.length!==3)throw new z(`The input of a conv1dWithBias operation should be 3, but is ${t.shape.length} instead.`);if(e.shape.length!==3)throw new z(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(r!=null&&r.shape.length!==1)throw new z(`The bias for a conv1dWithBias operation should be 1, but is ${e.shape.length} instead`);if(s==="channelsFirst"&&(t=Ue(t,[0,2,1])),o==="causal")throw new De("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=$x(t,e,n,o==="same"?"same":"valid","NWC",i);return r!=null&&(a=Xn(a,r)),a})}function rB(t,e,r,n=[1,1],o="valid",s,i,a=null){return G(()=>{if(s==null&&(s=Kn()),Gt(s),t.rank!==3&&t.rank!==4)throw new z(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${t.rank}.`);if(e.rank!==3&&e.rank!==4)throw new z(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${t.rank}.`);let l=Oy(t,s);if(o==="causal")throw new De("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=pf.conv2d({x:l,filter:e,strides:n,pad:o==="same"?"same":"valid",dilations:i,dataFormat:"NHWC",bias:r,activation:a}),s==="channelsFirst"&&(l=Ue(l,[0,3,1,2])),l})}function joe(t,e,r,n=[1,1,1],o="valid",s,i){return G(()=>{if(s==null&&(s=Kn()),Gt(s),t.rank!==4&&t.rank!==5)throw new z(`conv3dWithBias expects input to be of rank 4 or 5, but received ${t.rank}.`);if(e.rank!==4&&e.rank!==5)throw new z(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${t.rank}.`);let a=DE(t,s);if(o==="causal")throw new De("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=_2(a,e,n,o==="same"?"same":"valid","NDHWC",i),r!=null&&(a=Xn(a,r)),s==="channelsFirst"&&(a=Ue(a,[0,4,1,2,3])),a})}var vf=class extends ze{constructor(e,r){if(super(r),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",vf.verifyArgs(r),this.rank=e,ar(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new De(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=Cc(r.kernelSize,e,"kernelSize"),this.strides=Cc(r.strides==null?1:r.strides,e,"strides"),this.padding=r.padding==null?"valid":r.padding,qn(this.padding),this.dataFormat=r.dataFormat==null?"channelsLast":r.dataFormat,Gt(this.dataFormat),this.activation=fi(r.activation),this.useBias=r.useBias==null?!0:r.useBias,this.biasInitializer=gt(r.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=Xt(r.biasConstraint),this.biasRegularizer=St(r.biasRegularizer),this.activityRegularizer=St(r.activityRegularizer),this.dilationRate=Cc(r.dilationRate==null?1:r.dilationRate,e,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new z(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new z(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new z(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(e){if(Jo("kernelSize"in e,"required key 'kernelSize' not in config"),typeof e.kernelSize!="number"&&!U1(e.kernelSize,"number",1,3))throw new z(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){let e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:pi(this.activation),useBias:this.useBias,biasInitializer:Et(this.biasInitializer),biasRegularizer:ft(this.biasRegularizer),activityRegularizer:ft(this.activityRegularizer),biasConstraint:Kt(this.biasConstraint)},r=super.getConfig();return Object.assign(e,r),e}},Sc=class extends vf{constructor(e,r){super(e,r),this.kernel=null,Sc.verifyArgs(r),this.filters=r.filters,ar(this.filters,"filters"),this.kernelInitializer=gt(r.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=Xt(r.kernelConstraint),this.kernelRegularizer=St(r.kernelRegularizer)}build(e){e=qe(e);let r=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[r]==null)throw new z(`The channel dimension of the input should be defined. Found ${e[r]}`);let n=e[r],o=this.kernelSize.concat([n,this.filters]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[r]:n}}],this.built=!0}call(e,r){return G(()=>{e=$e(e);let n,o=this.bias==null?null:this.bias.read(),s=H1(this.activation.getClassName());if(s!=null&&this.rank===2)n=rB(e,this.kernel.read(),o,this.strides,this.padding,this.dataFormat,this.dilationRate,s);else{if(this.rank===1)n=qoe(e,this.kernel.read(),o,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)n=rB(e,this.kernel.read(),o,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)n=joe(e,this.kernel.read(),o,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new De("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(n=this.activation.apply(n))}return n})}computeOutputShape(e){e=qe(e);let r=[],n=this.dataFormat==="channelsLast"?e.slice(1,e.length-1):e.slice(2);for(let s=0;s<n.length;++s){let i=lo(n[s],this.kernelSize[s],this.padding,this.strides[s],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[s]);r.push(i)}let o=[e[0]];return this.dataFormat==="channelsLast"?(o=o.concat(r),o.push(this.filters)):(o.push(this.filters),o=o.concat(r)),o}getConfig(){let e={filters:this.filters,kernelInitializer:Et(this.kernelInitializer),kernelRegularizer:ft(this.kernelRegularizer),kernelConstraint:Kt(this.kernelConstraint)},r=super.getConfig();return Object.assign(e,r),e}static verifyArgs(e){if(!("filters"in e)||typeof e.filters!="number"||e.filters<1)throw new z(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}},kc=class extends Sc{constructor(e){super(2,e),kc.verifyArgs(e)}getConfig(){let e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!U1(e.kernelSize,"number",1,2))throw new z(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}};kc.className="Conv2D";J.registerClass(kc);var Tc=class extends Sc{constructor(e){super(3,e),Tc.verifyArgs(e)}getConfig(){let e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new z(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}};Tc.className="Conv3D";J.registerClass(Tc);var _y=class extends kc{constructor(e){if(super(e),this.inputSpec=[new Ct({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new z(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=qe(e),e.length!==4)throw new z("Input should have rank 4; Received input shape: "+JSON.stringify(e));let r=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[r]==null)throw new z("The channel dimension of the inputs should be defined. Found `None`.");let n=e[r],o=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",o,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Ct({ndim:4,axes:{[r]:n}})],this.built=!0}call(e,r){return G(()=>{let n=$e(e);if(n.shape.length!==4)throw new z(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${n.shape.length}`);let o=n.shape,s=o[0],i,a;this.dataFormat==="channelsFirst"?(i=2,a=3):(i=1,a=2);let l=o[i],u=o[a],c=this.kernelSize[0],p=this.kernelSize[1],f=this.strides[0],d=this.strides[1],m=di(l,f,c,this.padding),h=di(u,d,p,this.padding),x=[s,m,h,this.filters];this.dataFormat!=="channelsLast"&&(n=Ue(n,[0,2,3,1]));let g=Rx(n,this.kernel.read(),x,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(g=Ue(g,[0,3,1,2])),this.bias!=null&&(g=Xn(g,this.bias.read(),this.dataFormat)),this.activation!=null&&(g=this.activation.apply(g)),g})}computeOutputShape(e){e=qe(e);let r=e.slice(),n,o,s;this.dataFormat==="channelsFirst"?(n=1,o=2,s=3):(n=3,o=1,s=2);let i=this.kernelSize[0],a=this.kernelSize[1],l=this.strides[0],u=this.strides[1];return r[n]=this.filters,r[o]=di(r[o],l,i,this.padding),r[s]=di(r[s],u,a,this.padding),r}getConfig(){let e=super.getConfig();return delete e.dilationRate,e}};_y.className="Conv2DTranspose";J.registerClass(_y);var Ay=class extends Tc{constructor(e){if(super(e),this.inputSpec=[new Ct({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new z(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=qe(e),e.length!==5)throw new z("Input should have rank 5; Received input shape: "+JSON.stringify(e));let r=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[r]==null)throw new z("The channel dimension of the inputs should be defined. Found `None`.");let n=e[r],o=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",o,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Ct({ndim:5,axes:{[r]:n}})],this.built=!0}call(e,r){return G(()=>{let n=$e(e);if(n.shape.length!==5)throw new z(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${n.shape.length}`);let o=n.shape,s=o[0],i,a,l;this.dataFormat==="channelsFirst"?(l=2,i=3,a=4):(l=1,i=2,a=3);let u=o[l],c=o[i],p=o[a],f=this.kernelSize[0],d=this.kernelSize[1],m=this.kernelSize[2],h=this.strides[0],x=this.strides[1],g=this.strides[2],y=di(u,h,f,this.padding),b=di(c,x,d,this.padding),v=di(p,g,m,this.padding),C=[s,y,b,v,this.filters];this.dataFormat!=="channelsLast"&&(n=Ue(n,[0,2,3,4,1]));let S=A2(n,this.kernel.read(),C,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(S=Ue(S,[0,4,1,2,3])),this.bias!==null&&(S=Xn(S,this.bias.read(),this.dataFormat)),this.activation!==null&&(S=this.activation.apply(S)),S})}computeOutputShape(e){e=qe(e);let r=e.slice(),n,o,s,i;this.dataFormat==="channelsFirst"?(n=1,o=2,s=3,i=4):(n=4,o=1,s=2,i=3);let a=this.kernelSize[0],l=this.kernelSize[1],u=this.kernelSize[2],c=this.strides[0],p=this.strides[1],f=this.strides[2];return r[n]=this.filters,r[o]=di(r[o],c,a,this.padding),r[s]=di(r[s],p,l,this.padding),r[i]=di(r[i],f,u,this.padding),r}getConfig(){let e=super.getConfig();return delete e.dilationRate,e}};Ay.className="Conv3DTranspose";J.registerClass(Ay);var Lw=class extends Sc{constructor(e,r){if(super(e,r),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,r.filters==null)throw new z("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(r.kernelInitializer!=null||r.kernelRegularizer!=null||r.kernelConstraint!=null)throw new z("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(r.padding!=null&&r.padding!=="same"&&r.padding!=="valid")throw new z(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(r.padding)}`);this.depthMultiplier=r.depthMultiplier==null?1:r.depthMultiplier,this.depthwiseInitializer=gt(r.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=St(r.depthwiseRegularizer),this.depthwiseConstraint=Xt(r.depthwiseConstraint),this.pointwiseInitializer=gt(r.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=St(r.pointwiseRegularizer),this.pointwiseConstraint=Xt(r.pointwiseConstraint)}build(e){if(e=qe(e),e.length<this.rank+2)throw new z(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);let r=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[r]==null||e[r]<0)throw new z(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[r])}`);let n=e[r],o=this.kernelSize.concat([n,this.depthMultiplier]),s=[];for(let a=0;a<this.rank;++a)s.push(1);s.push(n*this.depthMultiplier,this.filters);let i=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",o,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,i,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",s,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,i,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,i,this.biasConstraint):this.bias=null,this.inputSpec=[new Ct({ndim:this.rank+2,axes:{[r]:n}})],this.built=!0}call(e,r){return G(()=>{e=$e(e);let n;if(this.rank===1)throw new De("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=Ue(e,[0,2,3,1])),n=Ux(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(n=Xn(n,this.bias.read(),this.dataFormat)),this.activation!=null&&(n=this.activation.apply(n)),this.dataFormat==="channelsFirst"&&(n=Ue(n,[0,3,1,2])),n})}getConfig(){let e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=Et(this.depthwiseInitializer),e.pointwiseInitializer=Et(this.pointwiseInitializer),e.depthwiseRegularizer=ft(this.depthwiseRegularizer),e.pointwiseRegularizer=ft(this.pointwiseRegularizer),e.depthwiseConstraint=Kt(this.depthwiseConstraint),e.pointwiseConstraint=Kt(this.pointwiseConstraint),e}};Lw.className="SeparableConv";var Dy=class extends Lw{constructor(e){super(2,e)}};Dy.className="SeparableConv2D";J.registerClass(Dy);var wf=class extends Sc{constructor(e){super(1,e),wf.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){let e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!U1(e.kernelSize,"number",1,1))throw new z(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}};wf.className="Conv1D";J.registerClass(wf);var $y=class extends ze{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,r){return G(()=>{if(e=$e(e),this.dataFormat==="channelsLast"){let n=ry(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return ry(n,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{let n=ry(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return ry(n,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){let e={cropping:this.cropping,dataFormat:this.dataFormat},r=super.getConfig();return Object.assign(e,r),e}};$y.className="Cropping2D";J.registerClass($y);var Ry=class extends ze{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Gt(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,yz(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){let r=e[2]==null?null:this.size[0]*e[2],n=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],r,n]}else{let r=e[1]==null?null:this.size[0]*e[1],n=e[2]==null?null:this.size[1]*e[2];return[e[0],r,n,e[3]]}}call(e,r){return G(()=>{let n=$e(e),o=n.shape;if(this.dataFormat==="channelsFirst"){n=Ue(n,[0,2,3,1]);let s=this.size[0]*o[2],i=this.size[1]*o[3],a=this.interpolation==="nearest"?ai.resizeNearestNeighbor(n,[s,i]):ai.resizeBilinear(n,[s,i]);return Ue(a,[0,3,1,2])}else{let s=this.size[0]*o[1],i=this.size[1]*o[2];return this.interpolation==="nearest"?ai.resizeNearestNeighbor(n,[s,i]):ai.resizeBilinear(n,[s,i])}})}getConfig(){let e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},r=super.getConfig();return Object.assign(e,r),e}};Ry.className="UpSampling2D";J.registerClass(Ry);function Koe(t,e,r=[1,1],n="valid",o,s){return G(()=>{o==null&&(o=Kn()),Gt(o);let i=Oy(t,o);if(t.rank!==4)throw new z(`Input for depthwiseConv2d is required to be 4-D, but is instead ${t.rank}-D`);if(e.rank!==4)throw new z(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return i=vl(i,e,r,n==="same"?"same":"valid","NHWC",s),o==="channelsFirst"&&(i=Ue(i,[0,3,1,2])),i})}var Fy=class extends vf{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=gt(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=Xt(e.depthwiseConstraint),this.depthwiseRegularizer=St(e.depthwiseRegularizer)}build(e){if(e=qe(e),e.length<4)throw new z(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);let r=this.dataFormat==="channelsFirst"?1:3;if(e[r]==null||e[r]<0)throw new z(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[r]}).`);let n=e[r],o=[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",o,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,r){return G(()=>{e=$e(e);let n=Koe(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(n=Xn(n,this.bias.read(),this.dataFormat)),this.activation!=null&&(n=this.activation.apply(n)),n})}computeOutputShape(e){e=qe(e);let r=this.dataFormat==="channelsFirst"?e[2]:e[1],n=this.dataFormat==="channelsFirst"?e[3]:e[2],o=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,s=lo(r,this.kernelSize[0],this.padding,this.strides[0]),i=lo(n,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],o,s,i]:[e[0],s,i,o]}getConfig(){let e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=Et(this.depthwiseInitializer),e.depthwiseRegularizer=ft(this.depthwiseRegularizer),e.depthwiseConstraint=Kt(this.depthwiseRegularizer),e}};Fy.className="DepthwiseConv2D";J.registerClass(Fy);function $E(t,e,r,n){if(Array.isArray(t)){if(e!=null||r!=null)throw new z("When inputs is an array, neither initialState or constants should be provided");n!=null&&(r=t.slice(t.length-n,t.length),t=t.slice(0,t.length-n)),t.length>1&&(e=t.slice(1,t.length)),t=t[0]}function o(s){return s==null||Array.isArray(s)?s:[s]}return e=o(e),r=o(r),{inputs:t,initialState:e,constants:r}}function RE(t,e,r,n=!1,o,s,i=!1,a=!1){return G(()=>{let l=e.shape.length;if(l<3)throw new z(`Input should be at least 3D, but is ${l}D.`);let u=[1,0].concat(jn(2,l));if(e=Ue(e,u),s!=null)throw new De("The rnn() functoin of the deeplearn.js backend does not support constants yet.");i&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),o!=null&&(o=oe(oe(o,"bool"),"float32"),o.rank===l-1&&(o=$r(o,-1)),o=Ue(o,u)),n&&(e=Zo(e,0),o!=null&&(o=Zo(o,0)));let c=[],p,f=r,d=e.shape[0],m=An(e),h;o!=null&&(h=An(o));for(let g=0;g<d;++g){let y=m[g],b=G(()=>t(y,f));if(o==null)p=b[0],f=b[1];else{let v=G(()=>{let C=h[g],S=Se(qr(C),C),k=te(L(b[0],C),L(f[0],S)),I=f.map((A,$)=>te(L(b[1][$],C),L(A,S)));return{output:k,newStates:I}});p=v.output,f=v.newStates}a&&c.push(p)}let x;return a&&(x=Mr(c,1)),[p,x,f]})}var es=class extends ze{constructor(e){super(e);let r;if(e.cell==null)throw new z("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?r=new bh({cells:e.cell}):r=e.cell,r.stateSize==null)throw new z("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=r,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new Ct({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){let e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return jn(0,e).map(r=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){ew(e)&&(e=e[0]),e=e;let r=this.cell.stateSize;Array.isArray(r)||(r=[r]);let n=r[0],o;if(this.returnSequences?o=[e[0],e[1],n]:o=[e[0],n],this.returnState){let s=[];for(let i of r)s.push([e[0],i]);return[o].concat(s)}else return o}computeMask(e,r){return G(()=>{Array.isArray(r)&&(r=r[0]);let n=this.returnSequences?r:null;if(this.returnState){let o=this.states.map(s=>null);return[n].concat(o)}else return n})}get states(){if(this.states_==null){let e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,r=[];for(let n=0;n<e;++n)r.push(null);return r}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new De("Constants support is not implemented in RNN yet.");ew(e)&&(e=e[0]),e=e;let n=this.stateful?e[0]:null,o=e.slice(2);this.inputSpec[0]=new Ct({shape:[n,null,...o]});let s=[e[0]].concat(e.slice(2));this.cell.build(s);let i;if(Array.isArray(this.cell.stateSize)?i=this.cell.stateSize:i=[this.cell.stateSize],this.stateSpec!=null){if(!w.arraysEqual(this.stateSpec.map(a=>a.shape[a.shape.length-1]),i))throw new z(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=i.map(a=>new Ct({shape:[null,a]}));this.stateful&&this.resetStates()}resetStates(e,r=!1){G(()=>{if(!this.stateful)throw new io("Cannot call resetStates() on an RNN Layer that is not stateful.");let n=this.inputSpec[0].shape[0];if(n==null)throw new z("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(o=>Pt([n,o])):this.states_=[Pt([n,this.cell.stateSize])];else if(e==null)Me(this.states_),this.keptStates!=null&&(Me(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(o=>Pt([n,o])):this.states_[0]=Pt([n,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new z(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);r===!0?this.keptStates.push(this.states_.slice()):Me(this.states_);for(let o=0;o<this.states_.length;++o){let s=e[o],i=Array.isArray(this.cell.stateSize)?this.cell.stateSize[o]:this.cell.stateSize,a=[n,i];if(!w.arraysEqual(s.shape,a))throw new z(`State ${o} is incompatible with layer ${this.name}: expected shape=${a}, received shape=${s.shape}`);this.states_[o]=s}}this.states_=this.states_.map(o=>Ur(o.clone()))})}apply(e,r){let n=r==null?null:r.initialState,o=r==null?null:r.constants;r==null&&(r={});let s=$E(e,n,o,this.numConstants);e=s.inputs,n=s.initialState,o=s.constants;let i=[],a=[];if(n!=null){r.initialState=n,i=i.concat(n),this.stateSpec=[];for(let u of n)this.stateSpec.push(new Ct({shape:u.shape}));a=a.concat(this.stateSpec)}if(o!=null&&(r.constants=o,i=i.concat(o),this.numConstants=o.length),i[0]instanceof Rn){let u=[e].concat(i),c=this.inputSpec.concat(a),p=this.inputSpec;this.inputSpec=c;let f=super.apply(u,r);return this.inputSpec=p,f}else return super.apply(e,r)}call(e,r){return G(()=>{let n=r==null?null:r.mask,o=r==null?null:r.training,s=r==null?null:r.initialState;e=$e(e),s==null&&(this.stateful?s=this.states_:s=this.getInitialState(e));let i=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(s.length!==i)throw new z(`RNN Layer has ${i} state(s) but was passed ${s.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");let a={training:o},u=RE((m,h)=>{let x=this.cell.call([m].concat(h),a);return[x[0],x.slice(1)]},e,s,this.goBackwards,n,null,this.unroll,this.returnSequences),c=u[0],p=u[1],f=u[2];this.stateful&&this.resetStates(f,o);let d=this.returnSequences?p:c;return this.returnState?[d].concat(f):d})}getInitialState(e){return G(()=>{let r=Pt(e.shape);return r=ye(r,[1,2]),r=Il(r),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(n=>n>1?Q1(r,[1,n]):r):this.cell.stateSize>1?[Q1(r,[1,this.cell.stateSize])]:[r]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){let e=super.getConfig(),r={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(r.numConstants=this.numConstants);let n=this.cell.getConfig();return this.getClassName()===es.className&&(r.cell={className:this.cell.getClassName(),config:n}),Object.assign(Object.assign(Object.assign({},n),e),r)}static fromConfig(e,r,n={}){let o=r.cell,s=Do(o,n);return new e(Object.assign(r,{cell:s}))}};es.className="RNN";J.registerClass(es);var Nc=class extends ze{},xh=class extends Nc{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,ar(this.units,"units"),this.activation=fi(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=gt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=gt(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=gt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=St(e.kernelRegularizer),this.recurrentRegularizer=St(e.recurrentRegularizer),this.biasRegularizer=St(e.biasRegularizer),this.kernelConstraint=Xt(e.kernelConstraint),this.recurrentConstraint=Xt(e.recurrentConstraint),this.biasConstraint=Xt(e.biasConstraint),this.dropout=df([1,ci([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=df([1,ci([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=qe(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,r){return G(()=>{if(e=e,e.length!==2)throw new z(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let n=e[1];e=e[0];let o=r.training==null?!1:r.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Dl({ones:()=>qr(e),rate:this.dropout,training:o,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Dl({ones:()=>qr(n),rate:this.recurrentDropout,training:o,dropoutFunc:this.dropoutFunc}));let s,i=this.dropoutMask,a=this.recurrentDropoutMask;i!=null?s=Es(L(e,i),this.kernel.read()):s=Es(e,this.kernel.read()),this.bias!=null&&(s=Xn(s,this.bias.read())),a!=null&&(n=L(n,a));let l=te(s,Es(n,this.recurrentKernel.read()));return this.activation!=null&&(l=this.activation.apply(l)),[l,l]})}getConfig(){let e=super.getConfig(),r={units:this.units,activation:pi(this.activation),useBias:this.useBias,kernelInitializer:Et(this.kernelInitializer),recurrentInitializer:Et(this.recurrentInitializer),biasInitializer:Et(this.biasInitializer),kernelRegularizer:ft(this.kernelRegularizer),recurrentRegularizer:ft(this.recurrentRegularizer),biasRegularizer:ft(this.biasRegularizer),activityRegularizer:ft(this.activityRegularizer),kernelConstraint:Kt(this.kernelConstraint),recurrentConstraint:Kt(this.recurrentConstraint),biasConstraint:Kt(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),r)}};xh.className="SimpleRNNCell";J.registerClass(xh);var Py=class extends es{constructor(e){e.cell=new xh(e),super(e)}call(e,r){return G(()=>{this.cell.dropoutMask!=null&&(Me(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Me(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);let n=r==null?null:r.mask,o=r==null?null:r.training,s=r==null?null:r.initialState;return super.call(e,{mask:n,training:o,initialState:s})})}static fromConfig(e,r){return new e(r)}};Py.className="SimpleRNN";J.registerClass(Py);var yh=class extends Nc{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new z("GRUCell does not support reset_after parameter set to true.");this.units=e.units,ar(this.units,"units"),this.activation=fi(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=fi(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=gt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=gt(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=gt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=St(e.kernelRegularizer),this.recurrentRegularizer=St(e.recurrentRegularizer),this.biasRegularizer=St(e.biasRegularizer),this.kernelConstraint=Xt(e.kernelConstraint),this.recurrentConstraint=Xt(e.recurrentConstraint),this.biasConstraint=Xt(e.biasConstraint),this.dropout=df([1,ci([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=df([1,ci([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=qe(e);let r=e[e.length-1];this.kernel=this.addWeight("kernel",[r,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,r){return G(()=>{if(e=e,e.length!==2)throw new z(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);let n=r.training==null?!1:r.training,o=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Dl({ones:()=>qr(e),rate:this.dropout,training:n,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Dl({ones:()=>qr(o),rate:this.recurrentDropout,training:n,count:3,dropoutFunc:this.dropoutFunc}));let s=this.dropoutMask,i=this.recurrentDropoutMask,a,l,u;0<this.dropout&&this.dropout<1&&(e=L(e,s[0]));let c=Es(e,this.kernel.read());this.useBias&&(c=Xn(c,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(o=L(o,i[0]));let p=this.recurrentKernel.read(),[f,d]=Lr(p,[2*this.units,this.units],p.rank-1),m=Es(o,f),[h,x,g]=Lr(c,3,c.rank-1),[y,b]=Lr(m,2,m.rank-1);a=this.recurrentActivation.apply(te(h,y)),l=this.recurrentActivation.apply(te(x,b));let v=Es(L(l,o),d);u=this.activation.apply(te(g,v));let C=te(L(a,o),L(te(1,st(a)),u));return[C,C]})}getConfig(){let e=super.getConfig(),r={units:this.units,activation:pi(this.activation),recurrentActivation:pi(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Et(this.kernelInitializer),recurrentInitializer:Et(this.recurrentInitializer),biasInitializer:Et(this.biasInitializer),kernelRegularizer:ft(this.kernelRegularizer),recurrentRegularizer:ft(this.recurrentRegularizer),biasRegularizer:ft(this.biasRegularizer),activityRegularizer:ft(this.activityRegularizer),kernelConstraint:Kt(this.kernelConstraint),recurrentConstraint:Kt(this.recurrentConstraint),biasConstraint:Kt(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),r)}};yh.className="GRUCell";J.registerClass(yh);var Ly=class extends es{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new yh(e),super(e)}call(e,r){return G(()=>{this.cell.dropoutMask!=null&&(Me(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Me(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);let n=r==null?null:r.mask,o=r==null?null:r.training,s=r==null?null:r.initialState;return super.call(e,{mask:n,training:o,initialState:s})})}static fromConfig(e,r){return r.implmentation===0&&(r.implementation=1),new e(r)}};Ly.className="GRU";J.registerClass(Ly);var Ic=class extends Nc{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,ar(this.units,"units"),this.activation=fi(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=fi(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=gt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=gt(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=gt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=St(e.kernelRegularizer),this.recurrentRegularizer=St(e.recurrentRegularizer),this.biasRegularizer=St(e.biasRegularizer),this.kernelConstraint=Xt(e.kernelConstraint),this.recurrentConstraint=Xt(e.recurrentConstraint),this.biasConstraint=Xt(e.biasConstraint),this.dropout=df([1,ci([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=df([1,ci([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var r;e=qe(e);let n=e[e.length-1];this.kernel=this.addWeight("kernel",[n,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let o;if(this.useBias){if(this.unitForgetBias){let s=this.biasInitializer,i=this.units;o=new(r=class extends Yn{apply(l,u){let c=s.apply([i]),p=new hf().apply([i]),f=s.apply([i*2]);return yE(yE(c,p),f)}},r.className="CustomInit",r)}else o=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,o,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,r){return G(()=>{let n=r.training==null?!1:r.training;if(e=e,e.length!==3)throw new z(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let o=e[1],s=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Dl({ones:()=>qr(e),rate:this.dropout,training:n,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Dl({ones:()=>qr(o),rate:this.recurrentDropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));let i=this.dropoutMask,a=this.recurrentDropoutMask,l,u,c,p;0<this.dropout&&this.dropout<1&&(e=L(e,i[0]));let f=Es(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(o=L(o,a[0])),f=te(f,Es(o,this.recurrentKernel.read())),this.useBias&&(f=Xn(f,this.bias.read()));let[d,m,h,x]=Lr(f,4,f.rank-1);l=this.recurrentActivation.apply(d),u=this.recurrentActivation.apply(m),c=te(L(u,s),L(l,this.activation.apply(h))),p=this.recurrentActivation.apply(x);let g=L(p,this.activation.apply(c));return[g,g,c]})}getConfig(){let e=super.getConfig(),r={units:this.units,activation:pi(this.activation),recurrentActivation:pi(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Et(this.kernelInitializer),recurrentInitializer:Et(this.recurrentInitializer),biasInitializer:Et(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:ft(this.kernelRegularizer),recurrentRegularizer:ft(this.recurrentRegularizer),biasRegularizer:ft(this.biasRegularizer),activityRegularizer:ft(this.activityRegularizer),kernelConstraint:Kt(this.kernelConstraint),recurrentConstraint:Kt(this.recurrentConstraint),biasConstraint:Kt(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),r)}};Ic.className="LSTMCell";J.registerClass(Ic);var My=class extends es{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Ic(e),super(e)}call(e,r){return G(()=>{this.cell.dropoutMask!=null&&(Me(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Me(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);let n=r==null?null:r.mask,o=r==null?null:r.training,s=r==null?null:r.initialState;return super.call(e,{mask:n,training:o,initialState:s})})}static fromConfig(e,r){return r.implmentation===0&&(r.implementation=1),new e(r)}};My.className="LSTM";J.registerClass(My);var bh=class extends Nc{constructor(e){super(e),this.cells=e.cells}get stateSize(){let e=[];for(let r of this.cells.slice().reverse())Array.isArray(r.stateSize)?e.push(...r.stateSize):e.push(r.stateSize);return e}call(e,r){return G(()=>{e=e;let n=e.slice(1),o=[];for(let a of this.cells.slice().reverse())Array.isArray(a.stateSize)?o.push(n.splice(0,a.stateSize.length)):o.push(n.splice(0,1));o.reverse();let s=[],i;for(let a=0;a<this.cells.length;++a){let l=this.cells[a];n=o[a],a===0?i=[e[0]].concat(n):i=[i[0]].concat(n),i=l.call(i,r),s.push(i.slice(1))}n=[];for(let a of s.slice().reverse())n.push(...a);return[i[0]].concat(n)})}build(e){ew(e)&&(e=e[0]),e=e;let r;this.cells.forEach((n,o)=>{ui(`RNNCell_${o}`,()=>{n.build(e),Array.isArray(n.stateSize)?r=n.stateSize[0]:r=n.stateSize,e=[e[0],r]})}),this.built=!0}getConfig(){let e=super.getConfig(),r=s=>({className:s.getClassName(),config:s.getConfig()}),o={cells:this.cells.map(r)};return Object.assign(Object.assign({},e),o)}static fromConfig(e,r,n={}){let o=[];for(let s of r.cells)o.push(Do(s,n));return new e({cells:o})}get trainableWeights(){if(!this.trainable)return[];let e=[];for(let r of this.cells)e.push(...r.trainableWeights);return e}get nonTrainableWeights(){let e=[];for(let r of this.cells)e.push(...r.nonTrainableWeights);if(!this.trainable){let r=[];for(let n of this.cells)r.push(...n.trainableWeights);return r.concat(e)}return e}getWeights(){let e=[];for(let r of this.cells)e.push(...r.weights);return py(e)}setWeights(e){let r=[];for(let n of this.cells){let o=n.weights.length,s=e.splice(o);for(let i=0;i<n.weights.length;++i)r.push([n.weights[i],s[i]])}ph(r)}};bh.className="StackedRNNCells";J.registerClass(bh);function Dl(t){let{ones:e,rate:r,training:n=!1,count:o=1,dropoutFunc:s}=t,i=()=>s!=null?s(e(),r):J1(e(),r),a=()=>vc(i,e,n);return!o||o<=1?Ur(a().clone()):Array(o).fill(void 0).map(a).map(u=>Ur(u.clone()))}var Xoe=function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(r[n[o]]=t[n[o]]);return r};var Mw=class extends es{constructor(e){if(e.unroll)throw new De("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new De("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new Ct({ndim:5})]}call(e,r){return G(()=>{if(this.cell.dropoutMask!=null&&(Me(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Me(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),r&&r.constants)throw new z("ConvRNN2D cell does not support constants");let n=r==null?null:r.mask,o=r==null?null:r.training,s=r==null?null:r.initialState;return super.call(e,{mask:n,training:o,initialState:s})})}computeOutputShape(e){let r=this.computeSingleOutputShape(e);return this.returnSequences||(r=[r[0],...r.slice(2)]),this.returnState&&(r=[r,...Array(2).fill([e[0],...r.slice(-3)])]),r}getInitialState(e){return G(()=>{let{stateSize:r}=this.cell,n=e.shape,o=this.computeSingleOutputShape(n),s=[o[0],...o.slice(2)],i=Pt(s);return Array.isArray(r)?Array(r.length).fill(i):[i]})}resetStates(e,r=!1){G(()=>{if(!this.stateful)throw new io("Cannot call resetStates() on an RNN Layer that is not stateful.");let n=this.inputSpec[0].shape,o=this.computeSingleOutputShape(n),s=[o[0],...o.slice(2)];if(n[0]==null)throw new z("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Pt(s)):this.states_=[Pt(s)];else if(e==null)Me(this.states_),this.keptStates!=null&&(Me(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Pt(s)):this.states_[0]=Pt(s);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new z(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);r?this.keptStates.push(this.states_.slice()):Me(this.states_);for(let a=0;a<this.states_.length;++a){let l=e[a],u=s;if(!w.arraysEqual(l.shape,u))throw new z(`State ${a} is incompatible with layer ${this.name}: expected shape=${u}, received shape=${l.shape}`);this.states_[a]=l}}this.states_=this.states_.map(a=>Ur(a.clone()))})}computeSingleOutputShape(e){let{dataFormat:r,filters:n,kernelSize:o,padding:s,strides:i,dilationRate:a}=this.cell,l=r==="channelsFirst",u=e[l?3:2],c=e[l?4:3],p=lo(u,o[0],s,i[0],a[0]),f=lo(c,o[1],s,i[1],a[1]);return[...e.slice(0,2),...l?[n,p,f]:[p,f,n]]}};Mw.className="ConvRNN2D";var vh=class extends Ic{constructor(e){let{filters:r,kernelSize:n,strides:o,padding:s,dataFormat:i,dilationRate:a}=e;super(Object.assign(Object.assign({},e),{units:r})),this.filters=r,ar(this.filters,"filters"),this.kernelSize=Cc(n,2,"kernelSize"),this.kernelSize.forEach(l=>ar(l,"kernelSize")),this.strides=Cc(o||1,2,"strides"),this.strides.forEach(l=>ar(l,"strides")),this.padding=s||"valid",qn(this.padding),this.dataFormat=i||"channelsLast",Gt(this.dataFormat),this.dilationRate=Cc(a||1,2,"dilationRate"),this.dilationRate.forEach(l=>ar(l,"dilationRate"))}build(e){var r;e=qe(e);let n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new z(`The channel dimension of the input should be defined. Found ${e[n]}`);let o=e[n],s=4,i=this.kernelSize.concat([o,this.filters*s]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);let a=this.kernelSize.concat([this.filters,this.filters*s]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let l;if(this.unitForgetBias){let u=this.biasInitializer,c=this.filters;l=new(r=class extends Yn{apply(f,d){let m=u.apply([c]),h=_o([c]),x=u.apply([c*2]);return th([m,h,x])}},r.className="CustomInit",r)}else l=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*s],null,l,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,r){return G(()=>{if(e.length!==3)throw new z(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let n=r.training||!1,o=e[0],s=e[1],i=e[2],a=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Dl({ones:()=>qr(o),rate:this.dropout,training:n,count:a,dropoutFunc:this.dropoutFunc}));let l=this.dropoutMask,u=(ie,re,ue)=>!re||!re[ue]?ie:L(re[ue],ie),c=u(o,l,0),p=u(o,l,1),f=u(o,l,2),d=u(o,l,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Dl({ones:()=>qr(s),rate:this.recurrentDropout,training:n,count:a,dropoutFunc:this.dropoutFunc}));let m=this.recurrentDropoutMask,h=u(s,m,0),x=u(s,m,1),g=u(s,m,2),y=u(s,m,3),b=3,[v,C,S,k]=Lr(this.kernel.read(),a,b),[I,A,$,O]=this.useBias?Lr(this.bias.read(),a):[null,null,null,null];c=this.inputConv(c,v,I,this.padding),p=this.inputConv(p,C,A,this.padding),f=this.inputConv(f,S,$,this.padding),d=this.inputConv(d,k,O,this.padding);let[j,H,Y,B]=Lr(this.recurrentKernel.read(),a,b);h=this.recurrentConv(h,j),x=this.recurrentConv(x,H),g=this.recurrentConv(g,Y),y=this.recurrentConv(y,B);let K=this.recurrentActivation.apply(te(c,h)),X=this.recurrentActivation.apply(te(p,x)),Z=te(L(X,i),L(K,this.activation.apply(te(f,g)))),Q=L(this.recurrentActivation.apply(te(d,y)),this.activation.apply(Z));return[Q,Q,Z]})}getConfig(){let e=super.getConfig(),{units:r}=e,n=Xoe(e,["units"]),o={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},n),o)}inputConv(e,r,n,o){let s=Io(e,r,this.strides,o||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return n?Xn(s,n,this.dataFormat):s}recurrentConv(e,r){return Io(e,r,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}};vh.className="ConvLSTM2DCell";J.registerClass(vh);var zy=class extends Mw{constructor(e){let r=new vh(e);super(Object.assign(Object.assign({},e),{cell:r}))}static fromConfig(e,r){return new e(r)}};zy.className="ConvLSTM2D";J.registerClass(zy);var wh=class extends ze{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;let r=e.shape,n=[];for(let o=0;o<this.noiseShape.length;++o)n.push(this.noiseShape[o]==null?r[o]:this.noiseShape[o]);return n}call(e,r){return G(()=>{this.invokeCallHook(e,r);let n=$e(e);if(0<this.rate&&this.rate<1){let o=r.training==null?!1:r.training,s=this.getNoiseShape(n);return vc(()=>J1(n,this.rate,s,this.seed),()=>n,o)}return e})}getConfig(){let e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},r=super.getConfig();return Object.assign(e,r),e}dispose(){return super.dispose()}};wh.className="Dropout";J.registerClass(wh);var By=class extends wh{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){let r=e.shape;return[r[0],1,r[2]]}};By.className="SpatialDropout1D";J.registerClass(By);var Vy=class extends ze{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let r=null;e.batchSize!=null&&(r=e.batchSize),this.batchInputShape=[r,e.inputDim]}this.units=e.units,ar(this.units,"units"),this.activation=fi(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=gt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=gt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=Xt(e.kernelConstraint),this.biasConstraint=Xt(e.biasConstraint),this.kernelRegularizer=St(e.kernelRegularizer),this.biasRegularizer=St(e.biasRegularizer),this.activityRegularizer=St(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=qe(e);let r=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[r,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:r}}],this.built=!0}computeOutputShape(e){e=qe(e);let r=e.slice();return r[r.length-1]=this.units,r}call(e,r){return G(()=>{this.invokeCallHook(e,r);let n=$e(e),o=H1(this.activation.getClassName()),s;return o!=null?s=Es(n,this.kernel.read(),o,this.bias?this.bias.read():null):(s=Es(n,this.kernel.read()),this.bias!=null&&(s=Xn(s,this.bias.read())),this.activation!=null&&(s=this.activation.apply(s))),s})}getConfig(){let e={units:this.units,activation:pi(this.activation),useBias:this.useBias,kernelInitializer:Et(this.kernelInitializer),biasInitializer:Et(this.biasInitializer),kernelRegularizer:ft(this.kernelRegularizer),biasRegularizer:ft(this.biasRegularizer),activityRegularizer:ft(this.activityRegularizer),kernelConstraint:Kt(this.kernelConstraint),biasConstraint:Kt(this.biasConstraint)},r=super.getConfig();return Object.assign(e,r),e}};Vy.className="Dense";J.registerClass(Vy);var Wy=class extends ze{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=qe(e);for(let r of e.slice(1))if(r==null)throw new z(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],Is(e,1)]}call(e,r){return G(()=>{this.invokeCallHook(e,r);let n=$e(e);if(this.dataFormat==="channelsFirst"&&n.rank>1){let o=[0];for(let s=2;s<n.rank;++s)o.push(s);o.push(1),n=Ue(n,o)}return Sz(n)})}getConfig(){let e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);let r=super.getConfig();return Object.assign(e,r),e}};Wy.className="Flatten";J.registerClass(Wy);var Gy=class extends ze{constructor(e){super(e),this.supportsMasking=!0,this.activation=fi(e.activation)}call(e,r){return G(()=>{this.invokeCallHook(e,r);let n=$e(e);return this.activation.apply(n)})}getConfig(){let e={activation:pi(this.activation)},r=super.getConfig();return Object.assign(e,r),e}};Gy.className="Activation";J.registerClass(Gy);var Uy=class extends ze{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,r){return G(()=>(e=$e(e),wz(e,this.n)))}getConfig(){let e={n:this.n},r=super.getConfig();return Object.assign(e,r),e}};Uy.className="RepeatVector";J.registerClass(Uy);var Hy=class extends ze{constructor(e){super(e),this.targetShape=e.targetShape;for(let r=0;r<this.targetShape.length;++r)this.isUnknown(this.targetShape[r])&&(this.targetShape[r]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,r){let n="Total size of new array must be unchanged.",o=r.slice(),s=1,i=null;for(let l=0;l<o.length;++l){let u=o[l];if(this.isUnknown(u))if(i===null)i=l;else throw new z("Can only specifiy one unknown dimension.");else s*=u}let a=Is(e);if(i!==null){if(s===0||a%s!==0)throw new z(n);o[i]=a/s}else if(a!==s)throw new z(n);return o}computeOutputShape(e){let r=!1;for(let n=0;n<e.length;++n)if(this.isUnknown(e[n])){r=!0;break}return r?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,r){return G(()=>{this.invokeCallHook(e,r);let n=$e(e),o=n.shape,s=o.slice(0,1).concat(this.fixUnknownDimension(o.slice(1),this.targetShape));return M(n,s)})}getConfig(){let e={targetShape:this.targetShape},r=super.getConfig();return Object.assign(e,r),e}};Hy.className="Reshape";J.registerClass(Hy);var qy=class extends ze{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);let r=jn(1,e.dims.length+1);if(!w.arraysEqual(e.dims.slice().sort(),r))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new Ct({ndim:this.dims.length+1})]}computeOutputShape(e){e=qe(e);let r=e.slice();return this.dims.forEach((n,o)=>{r[o+1]=e[n]}),r}call(e,r){return Ue($e(e),this.dimsIncludingBatch)}getConfig(){let e={dims:this.dims},r=super.getConfig();return Object.assign(e,r),e}};qy.className="Permute";J.registerClass(qy);var jy=class extends ze{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),r={maskValue:this.maskValue};return Object.assign(r,e),r}computeMask(e,r){let n=$e(e),o=-1;return Rm(xc(n,this.maskValue),o)}call(e,r){return G(()=>{this.invokeCallHook(e,r);let n=$e(e),o=-1,s=!0,i=Rm(xc(n,this.maskValue),o,s);return L(n,oe(i,n.dtype))})}};jy.className="Masking";J.registerClass(jy);var Ky=class extends ze{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let r=null;e.batchSize!=null&&(r=e.batchSize),e.inputLength==null?this.batchInputShape=[r,null]:this.batchInputShape=[r].concat(wt(e.inputLength))}this.inputDim=e.inputDim,ar(this.inputDim,"inputDim"),this.outputDim=e.outputDim,ar(this.outputDim,"outputDim"),this.embeddingsInitializer=gt(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=St(e.embeddingsRegularizer),this.activityRegularizer=St(e.activityRegularizer),this.embeddingsConstraint=Xt(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,r){return G(()=>this.maskZero?(e=$e(e),xc(e,Ee(e))):null)}computeOutputShape(e){if(e=qe(e),this.inputLength==null)return[...e,this.outputDim];let r=wt(this.inputLength);if(r.length!==e.length-1)throw new z(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let n=0;for(let o=0;o<r.length;++o){let s=r[o],i=e[o+1];if(s!=null&&i!=null&&s!==i)throw new z(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);s==null&&(r[n]=i),n++}}return[e[0],...r,this.outputDim]}call(e,r){return G(()=>{this.invokeCallHook(e,r);let n=$e(e);n.dtype!=="int32"&&(n=Dn(n,"int32"));let o=Z1(this.embeddings.read(),M(n,[n.size]));return M(o,qe(this.computeOutputShape(n.shape)))})}getConfig(){let e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Et(this.embeddingsInitializer),embeddingsRegularizer:ft(this.embeddingsRegularizer),activityRegularizer:ft(this.activityRegularizer),embeddingsConstraint:Kt(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},r=super.getConfig();return Object.assign(e,r),e}};Ky.className="Embedding";J.registerClass(Ky);var $l=class extends ze{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new De}computeElementwiseOpOutputShape(e,r){if(e==null||r==null)return null;if(e.length<r.length)return this.computeElementwiseOpOutputShape(r,e);if(r.length===0)return e;let n=e.slice(0,e.length-r.length);for(let o=0;o<r.length;++o){let s=e[e.length-r.length+o],i=r[o];if(s==null||i==null||s<0||i<0)n.push(null);else if(s===1)n.push(i);else if(i===1)n.push(s);else{if(s!==i)throw new z("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(r));n.push(s)}}return n}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[qe(e)]),e=e,e.length<2)throw new z(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let r=[];for(let s of e)s!=null&&s[0]!==null&&r.push(s[0]);if(r=Ns(r),r.length>1)throw new z(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let n=e[0]==null?null:e[0].slice(1);for(let s=1;s<e.length;++s){let i=e[s]==null?null:e[s].slice(1);n=this.computeElementwiseOpOutputShape(n,i)}let o=e.map(s=>s.length);e.indexOf(null)===-1&&Ns(o).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,r){return G(()=>{if(e=e,this.reshapeRequired){let n=[],o=e.map(s=>s.rank);if(o.indexOf(null)===-1){let s=ci(o);for(let i of e){let a=i.rank;for(let l=0;l<s-a;++l)i=Il(i,1);n.push(i)}return this.mergeFunction(n)}else{let s=!1;for(let l of e){let u=l.rank;if(u==null){let c=l.shape,p=c[0],f=c.slice(1).concat([p]),d=M(l,[p].concat(Is(c.slice(1))));d=Ue(d,[1,0]),d=M(d,f),n.push(d),s=!0}else if(u>1){let c=jn(1,u).concat([0]);n.push(Ue(l,c)),s=!0}else n.push(l)}let i=this.mergeFunction(n),a=i.rank;if(s){if(a==null){let l=i.shape,u=l.length,c=l[u-1],p=[c].concat(l.slice(0,l.length-1));i=M(Ue(M(i,[-1,c]),[1,0]),p)}else if(a>1){let l=[a-1].concat(jn(0,a-1));i=Ue(i,l)}}return i}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let r;e[0]==null?r=null:r=e[0].slice(1);for(let o=1;o<e.length;++o){let s=e[o]==null?null:e[o].slice(1);r=this.computeElementwiseOpOutputShape(r,s)}let n=[];for(let o of e)o!=null&&o[0]!==null&&n.push(o[0]);return n=Ns(n),n.length===1?r=n.concat(r):r=[null].concat(r),r}computeMask(e,r){return G(()=>{if(r==null)return null;if(!Array.isArray(r))throw new z("`mask` should be an Array");if(!Array.isArray(e))throw new z("`inputs` should be an Array");if(r.length!==e.length)throw new z(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${r.length})`);if(r.every(o=>o==null))return null;r=r.map(o=>o==null?o:$r(o,0));let n=r[0];for(let o=1;o<r.length-1;++o)n=_n(n,r[o]);return n})}},Yy=class extends $l{constructor(e){super(e)}mergeFunction(e){return G(()=>{let r=e[0].clone();for(let n=1;n<e.length;++n)r=te(r,e[n]);return r})}};Yy.className="Add";J.registerClass(Yy);var Qy=class extends $l{constructor(e){super(e)}mergeFunction(e){return G(()=>{let r=e[0].clone();for(let n=1;n<e.length;++n)r=L(r,e[n]);return r})}};Qy.className="Multiply";J.registerClass(Qy);var Zy=class extends $l{constructor(e){super(e)}mergeFunction(e){return G(()=>{let r=e[0].clone();for(let n=1;n<e.length;++n)r=te(r,e[n]);return L(1/e.length,r)})}};Zy.className="Average";J.registerClass(Zy);var Jy=class extends $l{constructor(e){super(e)}mergeFunction(e){return G(()=>{let r=e[0];for(let n=1;n<e.length;++n)r=Eo(r,e[n]);return r})}};Jy.className="Maximum";J.registerClass(Jy);var e0=class extends $l{constructor(e){super(e)}mergeFunction(e){return G(()=>{let r=e[0];for(let n=1;n<e.length;++n)r=tf(r,e[n]);return r})}};e0.className="Minimum";J.registerClass(e0);var t0=class extends $l{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new z("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let r=!0;for(let o of e)if(o!=null){r=!1;break}if(r)return;let n=[];for(let o=0;o<e.length;++o){let s=e[o].slice();s.splice(this.axis,1);let i=!1;for(let a of n)if(w.arraysEqual(a,s)){i=!0;break}i||n.push(s)}if(n.length>1)throw new z("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return G(()=>th(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new z("A `Concatenate` layer should be called on a list of inputs.");let r=e,n=r[0].slice(),o=this.axis<0?n.length+this.axis:this.axis;for(let s of r.slice(1)){if(n[o]==null||s[o]==null){n[o]=null;break}n[o]+=s[o]}return n}computeMask(e,r){if(r==null)return null;if(!Array.isArray(r))throw new z("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new z("`inputs` should be an array for Concatenate");if(r.length!==e.length)throw new z(`Mismatch in the length of mask (${r.length}) and the legnth of inputs (${e.length})`);return G(()=>{let n=!0;if(r.forEach(i=>{if(i!=null){n=!1;return}}),n)return null;let o=[];for(let i=0;i<e.length;++i)r[i]==null?o.push(oe(qr(e[i]),"bool")):r[i].rank<e[i].rank?o.push($r(r[i],-1)):o.push(r[i]);let s=Ot(o,this.axis);return Dx(s,-1,!1)})}getConfig(){let e={axis:this.axis},r=super.getConfig();return Object.assign(e,r),e}};t0.className="Concatenate";J.registerClass(t0);function Xy(t,e){for(;t<0;)t+=e;return t}function Yoe(t,e,r){if(t.shape.length>3||e.shape.length>3)throw new De("batchDot is not implemented for tensors of 4D or higher rank yet");if(w.assert(t.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${t.shape.length}`),w.assert(t.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`),typeof r=="number"&&(r=[r,r]),t.dtype==="complex64"||e.dtype==="complex64")throw new De("batchDot is not implemented for complex64-type Tensors yet.");let n=t.shape.length,o=e.shape.length;r==null&&(r=[n-1,o-2]);let s=r;return G(()=>{let i;if(n>o){i=n-o;let l=[];for(let u=0;u<i;++u)l.push(1);e=M(e,e.shape.concat(l))}else if(o>n){i=o-n;let l=[];for(let u=0;u<i;++u)l.push(1);t=M(t,t.shape.concat(l))}else i=0;let a;if(t.shape.length===2&&e.shape.length===2)s[0]===s[1]?a=ye(L(t,e),s[0]):a=ye(L(Ue(t,[1,0]),e),s[1]);else{let l=s[0]!==t.shape.length-1,u=s[1]===e.shape.length-1;a=ot(t,e,l,u)}if(i>0){let l;n>o?l=n+o-3:l=n-1;let u=[];for(let c=l;c<l+i;++c)u.push(c);a=si(a,u)}return a.shape.length===1&&(a=$r(a,1)),a})}var r0=class extends $l{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){w.assert(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");let r=e[0],n=e[1];if(r.length>3||n.length>3)throw new De("Dot layer does not support tensors of 4D or higher rank yet.");let o=this.interpretAxes(r,n);if(r[o[0]]!==n[o[1]])throw new z(`Dimension incompatibility: ${r[o[0]]} !== ${n[o[1]]}`)}mergeFunction(e){if(e.length!==2)throw new z(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let r=e[0],n=e[1],o;return Array.isArray(this.axes)?o=this.axes.map((s,i)=>Xy(s,e[i].shape.length)):o=[Xy(this.axes,r.shape.length),Xy(this.axes,n.shape.length)],this.normalize&&(r=gy(r,o[0]),n=gy(n,o[1])),Yoe(r,n,o)}interpretAxes(e,r){let n;return Array.isArray(this.axes)?n=this.axes:n=[Xy(this.axes,e.length),Xy(this.axes,r.length)],n}computeOutputShape(e){w.assert(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");let r=e[0].slice(),n=e[1].slice();if(r.length>3||n.length>3)throw new De("Dot layer does not support tensors of 4D or higher rank yet.");let o=this.interpretAxes(r,n);r.splice(o[0],1),n.splice(o[1],1),n.splice(0,1);let s=r.concat(n);return s.length===1&&s.push(1),s}computeMask(e,r){return null}getConfig(){let e={axes:this.axes,normalize:this.normalize},r=super.getConfig();return Object.assign(e,r),e}};r0.className="Dot";J.registerClass(r0);var n0=class extends ze{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),r={stddev:this.stddev};return Object.assign(r,e),r}call(e,r){return G(()=>{this.invokeCallHook(e,r);let n=$e(e);return vc(()=>te(rh(n.shape,0,this.stddev),n),()=>n,r.training||!1)})}};n0.className="GaussianNoise";J.registerClass(n0);var o0=class extends ze{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),r={rate:this.rate};return Object.assign(r,e),r}call(e,r){return G(()=>{this.invokeCallHook(e,r);let n=$e(e);return this.rate>0&&this.rate<1?vc(()=>{let s=Math.sqrt(this.rate/(1-this.rate));return L(n,rh(n.shape,1,s))},()=>n,r.training||!1):n})}};o0.className="GaussianDropout";J.registerClass(o0);var s0=class extends ze{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||$e(e).shape}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),r={rate:this.rate};return Object.assign(r,e),r}call(e,r){return G(()=>{if(this.rate<1&&this.rate>0){let n=this._getNoiseShape(e);return vc(()=>{let s=$e(e),i=1.6732632423543772,a=1.0507009873554805,l=-i*a,u=so(Sl(n),this.rate);u=Dn(u,"float32");let c=((1-this.rate)*(1+this.rate*l**2))**-.5,p=-c*l*this.rate,f=te(L(s,u),L(te(u,-1),l));return te(L(f,c),p)},()=>$e(e),r.training||!1)}return e})}};s0.className="AlphaDropout";J.registerClass(s0);function i0(t,e,r,n,o,s=.001){let i;if(t.rank===2)i=w2(t,e,r,n,o,s);else if(t.rank===3)i=C2(t,e,r,n,o,s);else if(t.rank===4)i=S2(t,e,r,n,o,s);else throw new De(`batchNormalization is not implemented for array of rank ${t.rank} yet`);return i}function Qoe(t,e,r,n,o=.001){return G(()=>{let s=Bm(t,n),i=s.mean,a=s.variance;return[i0(t,i,a,r,e,o),i,a]})}function Zoe(t,e,r,n,o=.001){return G(()=>{let s=Bm(t,n),i=s.mean,a=s.variance,l=[];for(let m of jn(0,t.rank))n.indexOf(m)!==-1?l.push(1):l.push(t.shape[m]);let u=M(i,l),c=M(a,l),p=e==null?null:M(e,l),f=r==null?null:M(r,l);return[i0(t,u,c,f,p,o),i,a]})}function Joe(t,e,r,n,o=.001){return w.arraysEqual(n.slice().sort(),jn(0,t.rank-1))?Qoe(t,e,r,n,o):Zoe(t,e,r,n,o)}var a0=class extends ze{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=gt(e.betaInitializer||"zeros"),this.gammaInitializer=gt(e.gammaInitializer||"ones"),this.movingMeanInitializer=gt(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=gt(e.movingVarianceInitializer||"ones"),this.betaConstraint=Xt(e.betaConstraint),this.gammaConstraint=Xt(e.gammaConstraint),this.betaRegularizer=St(e.betaRegularizer),this.gammaRegularizer=St(e.gammaRegularizer)}build(e){e=qe(e);let r=this.axis>=0?this.axis:this.axis+e.length,n=e[r];if(n==null)throw new z(`Axis ${r} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new Ct({ndim:e.length,axes:{[r]:n}})];let o=[n];this.scale&&(this.gamma=this.addWeight("gamma",o,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",o,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",o,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",o,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,r){return G(()=>{let n=r.training==null?!1:r.training,o=$e(e),s=o.shape,i=s.length,a=jn(0,i),l=this.axis>=0?this.axis:this.axis+i;a.splice(l,1);let u=ks(1,i);u[l]=s[l];let c=a.slice();c.sort();let p=!w.arraysEqual(c,jn(0,i).slice(0,i-1)),f=()=>{if(p){let y=M(this.movingMean.read(),u),b=M(this.movingVariance.read(),u),v=this.center?M(this.beta.read(),u):null,C=this.scale?M(this.gamma.read(),u):null;return i0(o,y,b,v,C,this.epsilon)}else return i0(o,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!n)return f();let[d,m,h]=Joe(o,this.gamma.read(),this.beta.read(),a,this.epsilon),x=(y,b,v)=>{G(()=>{let C=1-v,S=y.read(),k=L(Se(S,b),C);y.write(Se(S,k))})};return(()=>{x(this.movingMean,m,this.momentum),x(this.movingVariance,h,this.momentum)})(),d})}getConfig(){let e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Et(this.betaInitializer),gammaInitializer:Et(this.gammaInitializer),movingMeanInitializer:Et(this.movingMeanInitializer),movingVarianceInitializer:Et(this.movingVarianceInitializer),betaRegularizer:ft(this.betaRegularizer),gammaRegularizer:ft(this.gammaRegularizer),betaConstraint:Kt(this.betaConstraint),gammaConstraint:Kt(this.gammaConstraint)},r=super.getConfig();return Object.assign(e,r),e}};a0.className="BatchNormalization";J.registerClass(a0);var l0=class extends ze{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(let r of this.axis)if(!Number.isInteger(r))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=gt(e.betaInitializer||"zeros"),this.gammaInitializer=gt(e.gammaInitializer||"ones"),this.betaRegularizer=St(e.betaRegularizer),this.gammaRegularizer=St(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=qe(e);let r=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let s=0;s<this.axis.length;++s)this.axis[s]<0&&(this.axis[s]+=r);for(let s of this.axis)if(s<0||s>=r)throw new Error(`Invalid axis: ${s}`);if(this.axis.length!==Ns(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);let n=this.axis.map(s=>e[s]),o=!0;this.scale?this.gamma=this.addWeight("gamma",n,"float32",this.gammaInitializer,this.gammaRegularizer,o):this.gamma=null,this.center?this.beta=this.addWeight("beta",n,"float32",this.betaInitializer,this.betaRegularizer,o):this.beta=null,this.built=!0}call(e,r){let n=$e(e),o=n.shape,s=o.length;return G(()=>{let{mean:a,variance:l}=Bm(n,this.axis,!0),u=ks(1,s);for(let h of this.axis)u[h]=o[h];let c=h=>h!=null&&h.shape.length!==s?M(h,u):h,p=this.scale?c(this.gamma.read()):null,f=this.center?c(this.beta.read()):null,d=[],m=[];for(let h=0;h<s;++h)this.axis.indexOf(h)!==-1?(d.push(o[h]),m.push(1)):(d.push(1),m.push(o[h]));return a=xn(a,d),l=xn(l,d),p!=null&&(p=xn(p,m)),f!=null&&(f=xn(f,m)),i0(n,a,l,f,p,this.epsilon)})}getConfig(){let e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Et(this.betaInitializer),gammaInitializer:Et(this.gammaInitializer),betaRegularizer:ft(this.betaRegularizer),gammaRegularizer:ft(this.gammaRegularizer)},r=super.getConfig();return Object.assign(e,r),e}};l0.className="LayerNormalization";J.registerClass(l0);function ese(t,e,r){return G(()=>{if(t.rank!==4)throw new z(`temporalPadding expects input tensor to be 4-D, but received a ${t.rank}-D tensor.`);if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new z("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(r==null&&(r=Kn()),r!=="channelsLast"&&r!=="channelsFirst")throw new z(`Unknown data format: ${r}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let n;return r==="channelsFirst"?n=[[0,0],[0,0],e[0],e[1]]:n=[[0,0],e[0],e[1],[0,0]],rf(t,n)})}var u0=class extends ze{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?Kn():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new z(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let r,n;if(typeof e.padding[0]=="number")r=[e.padding[0],e.padding[0]],n=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new z(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(r=e.padding[0],e.padding[1].length!==2)throw new z(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);n=e.padding[1]}this.padding=[r,n]}this.inputSpec=[new Ct({ndim:4})]}computeOutputShape(e){e=qe(e);let r,n;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?r=e[2]+this.padding[0][0]+this.padding[0][1]:r=null,e[3]!=null&&e[3]>=0?n=e[3]+this.padding[1][0]+this.padding[1][1]:n=null,[e[0],e[1],r,n]):(e[1]!=null&&e[1]>=0?r=e[1]+this.padding[0][0]+this.padding[0][1]:r=null,e[2]!=null&&e[2]>=0?n=e[2]+this.padding[1][0]+this.padding[1][1]:n=null,[e[0],r,n,e[3]])}call(e,r){return G(()=>ese($e(e),this.padding,this.dataFormat))}getConfig(){let e={padding:this.padding,dataFormat:this.dataFormat},r=super.getConfig();return Object.assign(e,r),e}};u0.className="ZeroPadding2D";J.registerClass(u0);function Uw(t,e,r,n,o,s){return G(()=>{Gt(o),mE(s),qn(n),r==null&&(r=[1,1]),n==null&&(n="valid"),o==null&&(o=Kn()),s==null&&(s="max"),t=Oy(t,o);let i,a=n==="same"?"same":"valid";return s==="max"?i=ef(t,e,r,a):i=Yp(t,e,r,a),o==="channelsFirst"&&(i=Ue(i,[0,3,1,2])),i})}function nB(t,e,r,n,o,s){return G(()=>{Gt(o),mE(s),qn(n),r==null&&(r=[1,1,1]),n==null&&(n="valid"),o==null&&(o=Kn()),s==null&&(s="max"),t=DE(t,o);let i,a=n==="same"?"same":"valid";return s==="max"?i=W2(t,e,r,a):i=v2(t,e,r,a),o==="channelsFirst"&&(i=Ue(i,[0,4,1,2,3])),i})}var zw=class extends ze{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new z(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(ar(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new z(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);ar(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,qn(this.padding),this.inputSpec=[new Ct({ndim:3})]}computeOutputShape(e){e=qe(e);let r=lo(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],r,e[2]]}call(e,r){return G(()=>{this.invokeCallHook(e,r),e=Il($e(e),2);let n=this.poolingFunction($e(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return si(n,[2])})}getConfig(){let e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},r=super.getConfig();return Object.assign(e,r),e}},c0=class extends zw{constructor(e){super(e)}poolingFunction(e,r,n,o,s){return Gt(s),qn(o),Uw(e,r,n,o,s,"max")}};c0.className="MaxPooling1D";J.registerClass(c0);var p0=class extends zw{constructor(e){super(e)}poolingFunction(e,r,n,o,s){return Gt(s),qn(o),Uw(e,r,n,o,s,"avg")}};p0.className="AveragePooling1D";J.registerClass(p0);var Bw=class extends ze{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new z(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];ar(this.poolSize,"poolSize"),ar(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Gt(this.dataFormat),qn(this.padding),this.inputSpec=[new Ct({ndim:4})]}computeOutputShape(e){e=qe(e);let r=this.dataFormat==="channelsFirst"?e[2]:e[1],n=this.dataFormat==="channelsFirst"?e[3]:e[2];return r=lo(r,this.poolSize[0],this.padding,this.strides[0]),n=lo(n,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],r,n]:[e[0],r,n,e[3]]}call(e,r){return G(()=>(this.invokeCallHook(e,r),this.poolingFunction($e(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){let e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},r=super.getConfig();return Object.assign(e,r),e}},f0=class extends Bw{constructor(e){super(e)}poolingFunction(e,r,n,o,s){return Gt(s),qn(o),Uw(e,r,n,o,s,"max")}};f0.className="MaxPooling2D";J.registerClass(f0);var d0=class extends Bw{constructor(e){super(e)}poolingFunction(e,r,n,o,s){return Gt(s),qn(o),Uw(e,r,n,o,s,"avg")}};d0.className="AveragePooling2D";J.registerClass(d0);var Vw=class extends ze{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new z(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];ar(this.poolSize,"poolSize"),ar(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Gt(this.dataFormat),qn(this.padding),this.inputSpec=[new Ct({ndim:5})]}computeOutputShape(e){e=qe(e);let r=this.dataFormat==="channelsFirst"?e[2]:e[1],n=this.dataFormat==="channelsFirst"?e[3]:e[2],o=this.dataFormat==="channelsFirst"?e[4]:e[3];return r=lo(r,this.poolSize[0],this.padding,this.strides[0]),n=lo(n,this.poolSize[1],this.padding,this.strides[1]),o=lo(o,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],r,n,o]:[e[0],r,n,o,e[4]]}call(e,r){return G(()=>(this.invokeCallHook(e,r),this.poolingFunction($e(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){let e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},r=super.getConfig();return Object.assign(e,r),e}},m0=class extends Vw{constructor(e){super(e)}poolingFunction(e,r,n,o,s){return Gt(s),qn(o),nB(e,r,n,o,s,"max")}};m0.className="MaxPooling3D";J.registerClass(m0);var h0=class extends Vw{constructor(e){super(e)}poolingFunction(e,r,n,o,s){return Gt(s),qn(o),nB(e,r,n,o,s,"avg")}};h0.className="AveragePooling3D";J.registerClass(h0);var Ww=class extends ze{constructor(e){super(e),this.inputSpec=[new Ct({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,r){throw new De}},g0=class extends Ww{constructor(e){super(e||{})}call(e,r){return G(()=>{let n=$e(e);return Wt(n,1)})}};g0.className="GlobalAveragePooling1D";J.registerClass(g0);var x0=class extends Ww{constructor(e){super(e||{})}call(e,r){return G(()=>{let n=$e(e);return an(n,1)})}};x0.className="GlobalMaxPooling1D";J.registerClass(x0);var Gw=class extends ze{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Gt(this.dataFormat),this.inputSpec=[new Ct({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,r){throw new De}getConfig(){let e={dataFormat:this.dataFormat},r=super.getConfig();return Object.assign(e,r),e}},y0=class extends Gw{call(e,r){return G(()=>{let n=$e(e);return this.dataFormat==="channelsLast"?Wt(n,[1,2]):Wt(n,[2,3])})}};y0.className="GlobalAveragePooling2D";J.registerClass(y0);var b0=class extends Gw{call(e,r){return G(()=>{let n=$e(e);return this.dataFormat==="channelsLast"?an(n,[1,2]):an(n,[2,3])})}};b0.className="GlobalMaxPooling2D";J.registerClass(b0);var Hw=class extends ze{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){let e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},r=super.getConfig();return Object.assign(e,r),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,r,n={}){let o=r.layer,s=Do(o,n);delete r.layer;let i={layer:s};return Object.assign(i,r),new e(i)}},v0=class extends Hw{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=qe(e),e.length<3)throw new z(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];let r=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(r),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=qe(e);let r=[e[0]].concat(e.slice(2)),n=this.layer.computeOutputShape(r),o=e[1];return[n[0],o].concat(n.slice(1))}call(e,r){return G(()=>(e=$e(e),RE((i,a)=>[$e(this.layer.call(i,r)),[]],e,[],!1,null,null,!1,!0)[1]))}};v0.className="TimeDistributed";J.registerClass(v0);function tse(t){Xi(gz,"BidirectionalMergeMode",t)}var rse="concat",w0=class extends Hw{constructor(e){super(e);let r=e.layer.getConfig(),n={};n.className=e.layer.getClassName(),n.config=r,this.forwardLayer=Do(n),r.goBackwards=r.goBackwards!==!0;let o={};if(o.className=e.layer.getClassName(),o.config=r,this.backwardLayer=Do(o),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?rse:e.mergeMode,tse(this.mergeMode),e.weights)throw new De("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){let r=e.length,n=Math.floor(r/2);this.forwardLayer.setWeights(e.slice(0,n)),this.backwardLayer.setWeights(e.slice(n))}computeOutputShape(e){let r=this.forwardLayer.computeOutputShape(e);Array.isArray(r)&&Array.isArray(r[0])||(r=[r]),r=r;let n,o,s;return this.returnState&&(s=r.slice(1)),n=r[0],n=n,this.mergeMode==="concat"?(n[n.length-1]*=2,o=[n]):this.mergeMode==null?o=[n,n.slice()]:o=[n],this.returnState?this.mergeMode==null?o.concat(s).concat(s.slice()):[n].concat(s).concat(s.slice()):jr(o)}apply(e,r){let n=r==null?null:r.initialState,o=r==null?null:r.constants;r==null&&(r={});let s=$E(e,n,o,this.numConstants);if(e=s.inputs,n=s.initialState,o=s.constants,Array.isArray(e)&&(n=e.slice(1),e=e[0]),(n==null||n.length===0)&&o==null)return super.apply(e,r);let i=[],a=[];if(n!=null){let u=n.length;if(u%2>0)throw new z("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");r.initialState=n,i.push(...n);let c=n.map(p=>new Ct({shape:p.shape}));this.forwardLayer.stateSpec=c.slice(0,u/2),this.backwardLayer.stateSpec=c.slice(u/2),a.push(...c)}if(o!=null)throw new De("Support for constants in Bidirectional layers is not implemented yet.");let l=i[0]instanceof Rn;for(let u of i)if(u instanceof Rn!==l)throw new z("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(l){let u=[e].concat(i),c=this.inputSpec.concat(a),p=this.inputSpec;this.inputSpec=c;let f=super.apply(u,r);return this.inputSpec=p,f}else return super.apply(e,r)}call(e,r){return G(()=>{let n=r.initialState,o,s;if(n==null)o=this.forwardLayer.call(e,r),s=this.backwardLayer.call(e,r);else{let l=n.slice(0,n.length/2),u=n.slice(n.length/2);o=this.forwardLayer.call(e,Object.assign(r,{initialState:l})),s=this.backwardLayer.call(e,Object.assign(r,{initialState:u}))}let i;this.returnState&&(Array.isArray(o)&&(i=o.slice(1).concat(s.slice(1))),o=o[0],s=s[0]),this.returnSequences&&(s=Zo(s,1));let a;return this.mergeMode==="concat"?a=th([o,s]):this.mergeMode==="sum"?a=te(o,s):this.mergeMode==="ave"?a=L(.5,te(o,s)):this.mergeMode==="mul"?a=L(o,s):this.mergeMode==null&&(a=[o,s]),this.returnState?this.mergeMode==null?a.concat(i):[a].concat(i):a})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){ui(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),ui(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,r){Array.isArray(r)&&(r=r[0]);let n;if(this.returnSequences?this.mergeMode==null?n=[r,r]:n=r:this.mergeMode==null?n=[null,null]:n=null,this.returnState){let s=this.forwardLayer.states.map(i=>null);return Array.isArray(n)?n.concat(s).concat(s):[n].concat(s).concat(s)}else return n}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){let e={mergeMode:this.mergeMode},r=super.getConfig();return Object.assign(e,r),e}static fromConfig(e,r){let n=Do(r.layer);if(delete r.layer,r.numConstants!=null)throw new De("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");let o=r;return o.layer=n,new e(o)}};w0.className="Bidirectional";J.registerClass(w0);var C0=class extends ze{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){let e={scale:this.scale,offset:this.offset},r=super.getConfig();return Object.assign(e,r),e}call(e,r){return G(()=>(e=$e(e),e.dtype!=="float32"&&(e=Dn(e,"float32")),te(L(e,this.scale),this.offset)))}};C0.className="Rescaling";J.registerClass(C0);var{resizeBilinear:nse,cropAndResize:ose}=ai,S0=class extends ze{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,r,n,o,s,i,a,l){return G(()=>{let u,c=!1,p=r/i,f=n/a,d=(o+r)/i,m=(s+n)/a,h=[p,f,d,m],x=[];e.rank===3?(c=!0,u=Mr([e])):u=e;for(let C=0;C<u.shape[0];C++)x.push(h);let g=Cr(x,[x.length,4]),y=kl(0,x.length,1,"int32"),v=ose(u,g,y,[o,s],"nearest");return c?Dn($e(An(v)),l):Dn(v,l)})}upsize(e,r,n,o){return G(()=>{let s=nse(e,[r,n]);return Dn(s,o)})}call(e,r){return G(()=>{let n=$e(e),o=n.dtype,s=n.shape,i=s[s.length-3],a=s[s.length-2],l=0;i!==this.height&&(l=Math.floor((i-this.height)/2));let u=0;return a!==this.width&&(u=Math.floor((a-this.width)/2),u===0&&(u=1)),l>=0&&u>=0?this.centerCrop(n,l,u,this.height,this.width,i,a,o):this.upsize(e,this.height,this.width,o)})}getConfig(){let e={height:this.height,width:this.width},r=super.getConfig();return Object.assign(e,r),e}computeOutputShape(e){e=qe(e);let r=e.length-3,n=e.length-2;return e[r]=this.height,e[n]=this.width,e}};S0.className="CenterCrop";J.registerClass(S0);function oB(t,e,r,n){let o=$e(t);if(o.dtype!=="int32"&&(o=Dn(o,"int32")),e==="int")return o;let s=o.shape;if(o.rank===0&&(o=$r(o,-1)),e==="oneHot"&&o.shape[o.shape.length-1]!==1&&(o=$r(o,-1)),o.rank>2)throw new z(`When outputMode is not int, maximum output rank is 2 Received outputMode ${e} and input shape ${s} which would result in output rank ${o.rank}.`);let i=["multiHot","oneHot"].includes(e),a=o,l;if(typeof n<"u"&&e==="count"?l=T1(a,n,r,i):l=T1(a,[],r,i),e!=="tfIdf")return l;if(n)return L(l,n);throw new z("When outputMode is 'tfIdf', weights must be provided.")}var k0=class extends ze{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){let e={numTokens:this.numTokens,outputMode:this.outputMode},r=super.getConfig();return Object.assign(e,r),e}computeOutputShape(e){return e=qe(e),e==null?[this.numTokens]:this.outputMode==="oneHot"&&e[e.length-1]!==1?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,r){return G(()=>{e=$e(e),e.dtype!=="int32"&&(e=Dn(e,"int32"));let n;if(typeof r.countWeights<"u"){if(this.outputMode!=="count")throw new z(`countWeights is not used when outputMode !== count.
              Received countWeights=${r.countWeights}`);n=$e(r.countWeights)}let o=an(e),s=hc(e),i=tr(this.numTokens,o).bufferSync().get(0),a=so(s,0).bufferSync().get(0);if(!(i&&a))throw new z(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return oB(e,this.outputMode,this.numTokens,n)})}};k0.className="CategoryEncoding";J.registerClass(k0);var ise=["bilinear","nearest"],sB=new Set(ise),T0=class extends ze{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation)if(sB.has(e.interpolation))this.interpolation=e.interpolation;else throw new z(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=Boolean(e.cropToAspectRatio)}computeOutputShape(e){e=qe(e);let r=e[2];return[this.height,this.width,r]}getConfig(){let e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},r=super.getConfig();return Object.assign(e,r),e}call(e,r){return G(()=>{let n=[this.height,this.width];if(this.interpolation==="bilinear")return ai.resizeBilinear(e,n,!this.cropToAspectRatio);if(this.interpolation==="nearest")return ai.resizeNearestNeighbor(e,n,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...sB]} are supported`)})}};T0.className="Resizing";J.registerClass(T0);var fse=W();fse.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,t=>{t&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});var OE;(function(t){t[t.DT_INVALID=0]="DT_INVALID",t[t.DT_FLOAT=1]="DT_FLOAT",t[t.DT_DOUBLE=2]="DT_DOUBLE",t[t.DT_INT32=3]="DT_INT32",t[t.DT_UINT8=4]="DT_UINT8",t[t.DT_INT16=5]="DT_INT16",t[t.DT_INT8=6]="DT_INT8",t[t.DT_STRING=7]="DT_STRING",t[t.DT_COMPLEX64=8]="DT_COMPLEX64",t[t.DT_INT64=9]="DT_INT64",t[t.DT_BOOL=10]="DT_BOOL",t[t.DT_QINT8=11]="DT_QINT8",t[t.DT_QUINT8=12]="DT_QUINT8",t[t.DT_QINT32=13]="DT_QINT32",t[t.DT_BFLOAT16=14]="DT_BFLOAT16",t[t.DT_QINT16=15]="DT_QINT16",t[t.DT_QUINT16=16]="DT_QUINT16",t[t.DT_UINT16=17]="DT_UINT16",t[t.DT_COMPLEX128=18]="DT_COMPLEX128",t[t.DT_HALF=19]="DT_HALF",t[t.DT_RESOURCE=20]="DT_RESOURCE",t[t.DT_VARIANT=21]="DT_VARIANT",t[t.DT_UINT32=22]="DT_UINT32",t[t.DT_UINT64=23]="DT_UINT64",t[t.DT_FLOAT_REF=101]="DT_FLOAT_REF",t[t.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",t[t.DT_INT32_REF=103]="DT_INT32_REF",t[t.DT_UINT8_REF=104]="DT_UINT8_REF",t[t.DT_INT16_REF=105]="DT_INT16_REF",t[t.DT_INT8_REF=106]="DT_INT8_REF",t[t.DT_STRING_REF=107]="DT_STRING_REF",t[t.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",t[t.DT_INT64_REF=109]="DT_INT64_REF",t[t.DT_BOOL_REF=110]="DT_BOOL_REF",t[t.DT_QINT8_REF=111]="DT_QINT8_REF",t[t.DT_QUINT8_REF=112]="DT_QUINT8_REF",t[t.DT_QINT32_REF=113]="DT_QINT32_REF",t[t.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",t[t.DT_QINT16_REF=115]="DT_QINT16_REF",t[t.DT_QUINT16_REF=116]="DT_QUINT16_REF",t[t.DT_UINT16_REF=117]="DT_UINT16_REF",t[t.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",t[t.DT_HALF_REF=119]="DT_HALF_REF",t[t.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",t[t.DT_VARIANT_REF=121]="DT_VARIANT_REF",t[t.DT_UINT32_REF=122]="DT_UINT32_REF",t[t.DT_UINT64_REF=123]="DT_UINT64_REF"})(OE||(OE={}));var iB;(function(t){let e;(function(r){r[r.LEGACY=0]="LEGACY",r[r.V1=1]="V1",r[r.V2=2]="V2"})(e=t.CheckpointFormatVersion||(t.CheckpointFormatVersion={}))})(iB||(iB={}));var xB=nt(Bx());var mB=nt(Bx());function lB(t,e){return uB(t,e)}function uB(t,e,r=new Map,n=new Set){if(t==null)return null;if(typeof Blob=="function"&&t instanceof Blob)return t.slice();if(n.has(t))throw new Error("Circular references are not supported.");if(r.has(t))return r.get(t);let o=e(t);if(o.recurse&&o.value!==null)throw new Error("A deep map function may not return both a value and recurse=true.");if(o.recurse)if(Ch(t)){let s=Array.isArray(t)?[]:{};n.add(t);for(let i in t){let a=t[i],l=uB(a,e,r,n);s[i]=l}return n.delete(t),t.__proto__&&(s.__proto__=t.__proto__),s}else throw new Error(`Can't recurse into non-iterable type: ${t}`);else return r.set(t,o.value),o.value}function cB(t,e=FE){return pB(t,e)}function pB(t,e,r=new Set){let n=t[0];if(r.has(n))throw new Error("Circular references are not supported.");let o=e(t);if(o.recurse&&o.value!==null)throw new Error("A deep zip function may not return both a value and recurse=true.");if(o.recurse)if(Ch(n)){let s=Array.isArray(n)?[]:{};r.add(n);for(let i in n){let a=t.map(u=>u[i]),l=pB(a,e,r);s[i]=l}return r.delete(n),s}else throw new Error(`Can't recurse into non-iterable type: ${n}`);else return o.value}function FE(t){return t===null?null:Ch(t[0])?{value:null,recurse:!0}:{value:t,recurse:!1}}function Ch(t){let e=!1;if(W().get("IS_BROWSER"))e=t instanceof TextDecoder;else{let{StringDecoder:r}=aB();e=t instanceof r}return t!=null&&!ArrayBuffer.isView(t)&&(Array.isArray(t)||typeof t=="object"&&!(t instanceof Je)&&!(t instanceof Promise)&&!e)}function fB(t){return t==null||sie(t)||Array.isArray(t)||typeof t=="object"&&t instanceof Je||w.isTypedArray(t)}function sie(t){return t===null||typeof t!="object"&&typeof t!="function"}function dB(t){return lB(t,iie)}function iie(t){return t instanceof Je?{value:t.clone(),recurse:!1}:Ch(t)?{value:null,recurse:!0}:{value:t,recurse:!1}}var Sh=class{constructor(e){if(this.capacity=e,this.begin=0,this.end=0,e==null)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(e<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(e),this.doubledCapacity=2*e}wrap(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity}get(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]}set(e,r){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=r}length(){let e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e}isFull(){return this.length()===this.capacity}isEmpty(){return this.length()===0}push(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)}pushAll(e){for(let r of e)this.push(r)}pop(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);let e=this.get(this.end);return this.set(this.end,void 0),e}unshift(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)}shift(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");let e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e}shuffleExcise(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");let r=this.wrap(this.begin+e),n=this.get(r);return this.set(r,this.pop()),n}};var Cf=class extends Sh{constructor(){super(Cf.INITIAL_CAPACITY)}isFull(){return!1}push(e){super.isFull()&&this.expand(),super.push(e)}unshift(e){super.isFull()&&this.expand(),super.unshift(e)}expand(){let e=this.capacity*2,r=new Array(e),n=this.length();for(let o=0;o<n;o++)r[o]=this.get(this.wrap(this.begin+o));this.data=r,this.capacity=e,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=n}};Cf.INITIAL_CAPACITY=32;function hB(t){return new PE(t)}function KE(t){return new LE(t)}function gB(t,e){return new Kw(t,e)}var ln=class{async toArray(){let e=[],r=await this.next();for(;!r.done;)e.push(r.value),r=await this.next();return e}async toArrayForTest(){let e=this.prefetch(100),r=[],n=await e.next();for(;!n.done;)r.push(n.value),n=await e.next();return r}async resolveFully(){let e=await this.next();for(;!e.done;)e=await this.next()}async resolveWhile(e){let r=await this.next(),n=e(r.value);for(;!r.done&&n;)r=await this.next(),n=e(r.value)}handleErrors(e){return new UE(this,e)}filter(e){return new WE(this,e)}map(e){return new GE(this,e)}mapAsync(e){return new jw(this,e)}serialMapAsync(e){return new jw(this,e).serial()}flatmap(e){return new HE(this,e)}async forEachAsync(e){return this.map(e).resolveFully()}async serialForEach(e){return this.serialMapAsync(e).resolveWhile(r=>r===!0)}rowMajorBatch(e,r=!0){return new VE(this,e,r)}columnMajorBatch(e,r=!0,n=FE){return this.rowMajorBatch(e,r).map(s=>cB(s,n))}concatenate(e,r){return new Kw(hB([this,e]),r)}take(e){return e<0||e==null?this:new BE(this,e)}skip(e){return e<0||e==null?this:new zE(this,e)}prefetch(e){return new Xw(this,e)}shuffle(e,r){return new jE(this,e,r)}serial(){return new ME(this)}},PE=class extends ln{constructor(e){super(),this.items=e,this.trav=0}summary(){return`Array of ${this.items.length} items`}async next(){if(this.trav>=this.items.length)return{value:null,done:!0};let e=this.items[this.trav];return this.trav++,{value:dB(e),done:!1}}},LE=class extends ln{constructor(e){super(),this.nextFn=e}summary(){return"Function call"}async next(){try{return this.nextFn()}catch(e){throw e.message=`Error thrown while iterating through a dataset: ${e.message}`,e}}},ME=class extends ln{constructor(e){super(),this.upstream=e,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Serial`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){return this.upstream.next()}},zE=class extends ln{constructor(e,r){super(),this.upstream=e,this.maxCount=r,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Skip`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;this.count++<this.maxCount;){let e=await this.upstream.next();if(e.done)return e;Me(e.value)}return this.upstream.next()}},BE=class extends ln{constructor(e,r){super(),this.upstream=e,this.maxCount=r,this.count=0}summary(){return`${this.upstream.summary()} -> Take`}async next(){return this.count++>=this.maxCount?{value:null,done:!0}:this.upstream.next()}},VE=class extends ln{constructor(e,r,n=!0){super(),this.upstream=e,this.batchSize=r,this.enableSmallLastBatch=n,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> RowMajorBatch`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){let e=[];for(;e.length<this.batchSize;){let r=await this.upstream.next();if(r.done)return this.enableSmallLastBatch&&e.length>0?{value:e,done:!1}:{value:null,done:!0};e.push(r.value)}return{value:e,done:!1}}},WE=class extends ln{constructor(e,r){super(),this.upstream=e,this.predicate=r,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Filter`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;;){let e=await this.upstream.next();if(e.done||this.predicate(e.value))return e;Me(e.value)}}},GE=class extends ln{constructor(e,r){super(),this.upstream=e,this.transform=r}summary(){return`${this.upstream.summary()} -> Map`}async next(){let e=await this.upstream.next();if(e.done)return{value:null,done:!0};let r=xs.getTensorsInContainer(e.value),n=this.transform(e.value),o=xs.getTensorsInContainer(n);for(let s of r)xs.isTensorInList(s,o)||s.dispose();return{value:n,done:!1}}},UE=class extends ln{constructor(e,r){super(),this.upstream=e,this.handler=r,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> handleErrors`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;;)try{return await this.upstream.next()}catch(e){if(!this.handler(e))return{value:null,done:!0}}}},jw=class extends ln{constructor(e,r){super(),this.upstream=e,this.transform=r}summary(){return`${this.upstream.summary()} -> AsyncMap`}async next(){let e=await this.upstream.next();if(e.done)return{value:null,done:!0};let r=xs.getTensorsInContainer(e.value),n=await this.transform(e.value),o=xs.getTensorsInContainer(n);for(let s of r)xs.isTensorInList(s,o)||s.dispose();return{value:n,done:!1}}},N0=class extends ln{constructor(){super(),this.outputQueue=new Cf,this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;this.outputQueue.length()===0;)if(!await this.pump())return{value:null,done:!0};return{value:this.outputQueue.shift(),done:!1}}},HE=class extends N0{constructor(e,r){super(),this.upstream=e,this.transform=r}summary(){return`${this.upstream.summary()} -> Flatmap`}async pump(){let e=await this.upstream.next();if(e.done)return!1;let r=xs.getTensorsInContainer(e.value),n=this.transform(e.value),o=xs.getTensorsInContainer(n);this.outputQueue.pushAll(n);for(let s of r)xs.isTensorInList(s,o)||s.dispose();return!0}},Kw=class extends ln{constructor(e,r){super(),this.baseErrorHandler=r,this.lastRead=null,this.iterator=null,this.moreIterators=e}summary(){return"TODO: fill in upstream of chained summaries -> Chained"}async next(){return this.lastRead=this.readFromChain(this.lastRead),this.lastRead}async readFromChain(e){if(await e,this.iterator==null){let n=await this.moreIterators.next();if(n.done)return{value:null,done:!0};this.iterator=n.value,this.baseErrorHandler!=null&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler))}let r=await this.iterator.next();return r.done?(this.iterator=null,this.readFromChain(e)):r}},qE;(function(t){t[t.FAIL=0]="FAIL",t[t.SHORTEST=1]="SHORTEST",t[t.LONGEST=2]="LONGEST"})(qE||(qE={}));var Xw=class extends ln{constructor(e,r){super(),this.upstream=e,this.bufferSize=r,this.buffer=new Sh(r)}summary(){return`${this.upstream.summary()} -> Prefetch`}refill(){for(;!this.buffer.isFull();){let e=this.upstream.next();this.buffer.push(e)}}next(){return this.refill(),this.buffer.shift()}},jE=class extends Xw{constructor(e,r,n){super(e,r),this.upstream=e,this.windowSize=r,this.upstreamExhausted=!1,this.random=mB.alea(n||w.now().toString()),this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}randomInt(e){return Math.floor(this.random()*e)}chooseIndex(){return this.randomInt(this.buffer.length())}async serialNext(){for(this.upstreamExhausted||this.refill();!this.buffer.isEmpty();){let e=this.chooseIndex(),r=await this.buffer.shuffleExcise(e);if(r.done)this.upstreamExhausted=!0;else return this.refill(),r}return{value:null,done:!0}}};var Sf=class{constructor(){this.size=null}batch(e,r=!0){let n=this;w.assert(e>0,()=>`batchSize needs to be positive, but it is
      ${e}`);let o;return this.size===1/0||this.size==null?o=this.size:r?o=Math.ceil(this.size/e):o=Math.floor(this.size/e),mi(async()=>(await n.iterator()).columnMajorBatch(e,r,lie),o)}concatenate(e){let r=this,n;return this.size===1/0||e.size===1/0?n=1/0:this.size!=null&&e.size!=null?n=this.size+e.size:n=null,mi(async()=>(await r.iterator()).concatenate(await e.iterator()),n)}filter(e){let r=this,n;return this.size===1/0?n=1/0:n=null,mi(async()=>(await r.iterator()).filter(o=>G(()=>e(o))),n)}async forEachAsync(e){return(await this.iterator()).forEachAsync(e)}map(e){let r=this;return mi(async()=>(await r.iterator()).map(n=>G(()=>e(n))),this.size)}mapAsync(e){let r=this;return mi(async()=>(await r.iterator()).mapAsync(e),this.size)}prefetch(e){if(e==null)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");let r=this;return mi(async()=>(await r.iterator()).prefetch(e),this.size)}repeat(e){let r=this,n;return this.size!=null&&e>0?n=this.size*e:e===0?n=0:this.size!=null&&(e===void 0||e<0)?n=1/0:n=null,mi(async()=>{let o=KE(async()=>({value:await r.iterator(),done:!1}));return gB(o.take(e))},n)}skip(e){let r=this,n;return this.size!=null&&e>=0&&this.size>=e?n=this.size-e:this.size!=null&&(this.size<e||e===void 0||e<0)?n=0:n=null,mi(async()=>(await r.iterator()).skip(e),n)}shuffle(e,r,n=!0){if(e==null||e<0)throw this.size==null?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError(`\`Dataset.shuffle()\` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for \`tf.Tensor\`s), consider setting bufferSize to the dataset size (${this.size} elements)`);let o=this,s=xB.alea(r||w.now().toString());return mi(async()=>{let i=s.int32();return n&&(i+=s.int32()),(await o.iterator()).shuffle(e,i.toString())},this.size)}take(e){let r=this,n;return this.size!=null&&this.size>e?n=e:this.size!=null&&this.size<=e?n=this.size:n=null,mi(async()=>(await r.iterator()).take(e),n)}async toArray(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArray()}async toArrayForTest(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArrayForTest()}};Sf.MAX_BUFFER_SIZE=1e4;function mi(t,e=null){return new class extends Sf{constructor(){super(...arguments),this.size=e}async iterator(){return t()}}}function lie(t){if(t===null)return null;let e=t[0];return fB(e)?{value:uie(t),recurse:!1}:{value:null,recurse:!0}}function uie(t){if(t.length===0)throw new Error("Can't make a batch of zero elements.");return t[0]instanceof Je?Mr(t):Cr(t)}var uxt=Symbol("out"),cxt=Symbol("field"),pxt=Symbol("quote"),fxt=Symbol("quoteafterquote"),dxt=Symbol("quoteinquote");function ee(t,e){Array.isArray(t)||(t=[t]),t.forEach(r=>{r!=null&&w.assert(r.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the CPU backend.`)})}var bie=bn.whereImpl,kf=class extends ya{constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new kp(this,ys())}nextDataId(){return kf.nextDataId++}write(e,r,n){this.firstUse&&(this.firstUse=!1,W().get("IS_NODE")&&T.warn(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));let o={id:this.nextDataId()};return this.data.set(o,{values:e,dtype:n,refCount:1}),o}makeTensorInfo(e,r,n){let o;if(r==="string"&&n!=null&&n.length>0&&w.isString(n[0])){let s=n.map(i=>w.encodeString(i));o=this.write(s,e,r)}else o=this.write(n,e,r);return{dataId:o,shape:e,dtype:r}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){let r=this.data.get(e);r.refCount++}decRef(e){if(this.data.has(e)){let r=this.data.get(e);r.refCount--}}move(e,r,n,o,s){this.data.set(e,{values:r,dtype:o,refCount:s})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){let{dtype:r,complexTensorInfos:n}=this.data.get(e);if(r==="complex64"){let o=this.readSync(n.real.dataId),s=this.readSync(n.imag.dataId);return T.mergeRealAndImagArrays(o,s)}return this.data.get(e).values}bufferSync(e){let r=this.readSync(e.dataId);if(e.dtype==="string")try{let n=r.map(o=>w.decodeString(o));return Ie(e.shape,e.dtype,n)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Ie(e.shape,e.dtype,r)}makeOutput(e,r,n){return ys().makeTensorFromTensorInfo(this.makeTensorInfo(r,n,e),this)}disposeData(e,r=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!r&&this.data.get(e).refCount>0)return!1;let{complexTensorInfos:n}=this.data.get(e);n!=null&&(this.disposeData(n.real.dataId,!0),this.disposeData(n.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){let r=w.now();return e(),{kernelMs:w.now()-r}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){ee([e],"where");let r=this.readSync(e.dataId);return bie(e.shape,r)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}};kf.nextDataId=0;var w_={};qo(w_,{addImpl:()=>QE,bincountImpl:()=>Nh,bincountReduceImpl:()=>Yw,castImpl:()=>YE,ceilImpl:()=>ZE,concatImpl:()=>Qw,equalImpl:()=>JE,expImpl:()=>t_,expm1Impl:()=>n_,floorImpl:()=>o_,gatherNdImpl:()=>Zw,gatherV2Impl:()=>Jw,greaterEqualImpl:()=>i_,greaterImpl:()=>s_,lessEqualImpl:()=>l_,lessImpl:()=>a_,linSpaceImpl:()=>eC,logImpl:()=>u_,maxImpl:()=>tC,maximumImpl:()=>c_,minimumImpl:()=>p_,multiplyImpl:()=>I0,negImpl:()=>f_,notEqualImpl:()=>d_,prodImpl:()=>m_,raggedGatherImpl:()=>rC,raggedRangeImpl:()=>nC,raggedTensorToTensorImpl:()=>oC,rangeImpl:()=>sC,rsqrtImpl:()=>h_,scatterImpl:()=>Rl,sigmoidImpl:()=>qB,simpleAbsImpl:()=>XE,sliceImpl:()=>x_,sparseFillEmptyRowsImpl:()=>iC,sparseReshapeImpl:()=>aC,sparseSegmentReductionImpl:()=>_h,sqrtImpl:()=>XB,squaredDifferenceImpl:()=>y_,stridedSliceImpl:()=>lC,stringNGramsImpl:()=>uC,stringSplitImpl:()=>cC,stringToHashBucketFastImpl:()=>pC,subImpl:()=>v_,tileImpl:()=>fC,topKImpl:()=>dC,transposeImpl:()=>Ih,uniqueImpl:()=>mC});function XE(t){let e=new Float32Array(t.length);for(let r=0;r<t.length;++r)e[r]=Math.abs(t[r]);return e}var vie=t=>{let{x:e}=t.inputs,r=t.backend;ee(e,"abs");let n=new Float32Array(w.sizeFromShape(e.shape)),o=r.data.get(e.dataId).values;return n=XE(o),r.makeOutput(n,e.shape,e.dtype)},yB={kernelName:yu,backendName:"cpu",kernelFunc:vie};function rt(t){return(e,r,n,o,s)=>{let i=T.assertAndGetBroadcastShape(e,r),a=i.length,l=w.computeStrides(i),u=w.sizeFromShape(i),c=w.getTypedArrayFromDType(s,u),p=e.length,f=r.length,d=w.computeStrides(e),m=w.computeStrides(r),h=T.getBroadcastDims(e,i),x=T.getBroadcastDims(r,i);if(h.length+x.length===0)for(let g=0;g<c.length;++g)c[g]=t(n[g%n.length],o[g%o.length]);else for(let g=0;g<c.length;++g){let y=w.indexToLoc(g,a,l),b=y.slice(-p);h.forEach(k=>b[k]=0);let v=w.locToIndex(b,p,d),C=y.slice(-f);x.forEach(k=>C[k]=0);let S=w.locToIndex(C,f,m);c[g]=t(n[v],o[S])}return[c,i]}}function zr(t){let{inputs:e,backend:r}=t,{real:n,imag:o}=e,s=r.data.get(n.dataId).values,i=r.data.get(o.dataId).values,a=r.makeTensorInfo(n.shape,"complex64"),l=r.data.get(a.dataId);return l.complexTensorInfos={real:r.makeTensorInfo(n.shape,"float32",s),imag:r.makeTensorInfo(o.shape,"float32",i)},a}var bB={kernelName:Wd,backendName:"cpu",kernelFunc:zr};function kh(t,e,r="float32"){if(r==="complex64"){let o=kh(t,e,"float32"),s=kh(t,e,"float32");return zr({inputs:{real:o,imag:s},backend:t})}let n=w.makeZerosTypedArray(w.sizeFromShape(e),r);return t.makeTensorInfo(e,r,n)}function wn(t){let{inputs:e,backend:r}=t,{x:n}=e;return r.incRef(n.dataId),{dataId:n.dataId,shape:n.shape,dtype:n.dtype}}var vB={kernelName:Fi,backendName:"cpu",kernelFunc:wn};function $s(t){let{inputs:e,backend:r}=t,{input:n}=e,o=r.data.get(n.dataId).complexTensorInfos.real,s=r.data.get(o.dataId).values;return r.makeTensorInfo(o.shape,o.dtype,s)}var wB={kernelName:fm,backendName:"cpu",kernelFunc:$s};function YE(t,e,r,n){if(n==="int32"){let o=Int32Array.from(t);return[e,"int32",o]}if(n==="bool"){let o=w.toTypedArray([0],r),[s,i]=rt((a,l)=>a!==l?1:0)(e,[],t,o,"bool");return[i,"bool",s]}throw new Error(`Error in Cast: failed to cast ${r} to ${n}`)}function Rs(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{dtype:s}=n;if(s==="complex64"){if(o.dtype==="complex64")return wn({inputs:{x:o},backend:r});let c=kh(r,o.shape,o.dtype),p=Rs({inputs:{x:o},backend:r,attrs:{dtype:"float32"}}),f=zr({inputs:{real:p,imag:c},backend:r});return r.disposeIntermediateTensorInfo(c),r.disposeIntermediateTensorInfo(p),f}if(o.dtype==="complex64"){let c=$s({inputs:{input:o},backend:r}),p=Rs({inputs:{x:c},backend:r,attrs:{dtype:s}});return r.disposeIntermediateTensorInfo(c),p}if(!w.hasEncodingLoss(o.dtype,s)){let c=wn({inputs:{x:o},backend:r});return{dataId:c.dataId,shape:c.shape,dtype:s}}let i=r.data.get(o.dataId).values,[a,l,u]=YE(i,o.shape,o.dtype,s);return r.makeTensorInfo(a,l,u)}var CB={kernelName:Oi,backendName:"cpu",kernelFunc:Rs};function it(t,e,r,n){return r==null?({inputs:o,backend:s})=>{let{a:i,b:a}=o,l=s;ee([i,a],t);let u=l.data.get(i.dataId).values,c=l.data.get(a.dataId).values,p=i.dtype==="string"?T.fromUint8ToStringArray(u):u,f=i.dtype==="string"?T.fromUint8ToStringArray(c):c,d=n||i.dtype,[m,h]=e(i.shape,a.shape,p,f,d);return l.makeTensorInfo(h,d,m)}:({inputs:o,backend:s})=>{let{a:i,b:a}=o,l=s;if(i.dtype==="complex64"||a.dtype==="complex64"){let u=Rs({inputs:{x:i},backend:l,attrs:{dtype:"complex64"}}),c=l.data.get(u.dataId),p=c.complexTensorInfos.real,f=c.complexTensorInfos.imag,d=l.data.get(p.dataId).values,m=l.data.get(f.dataId).values,h=Rs({inputs:{x:a},backend:l,attrs:{dtype:"complex64"}}),x=l.data.get(h.dataId),g=x.complexTensorInfos.real,y=x.complexTensorInfos.imag,b=l.data.get(g.dataId).values,v=l.data.get(y.dataId).values,[C,S,k]=r(i.shape,a.shape,d,m,b,v),I=l.makeTensorInfo(k,"float32",C),A=l.makeTensorInfo(k,"float32",S),$=zr({inputs:{real:I,imag:A},backend:l});return l.disposeIntermediateTensorInfo(u),l.disposeIntermediateTensorInfo(h),l.disposeIntermediateTensorInfo(I),l.disposeIntermediateTensorInfo(A),$}else{let u=l.data.get(i.dataId).values,c=l.data.get(a.dataId).values,p=n||i.dtype,[f,d]=e(i.shape,a.shape,u,c,p);return l.makeTensorInfo(d,p,f)}}}function Th(t){return(e,r,n,o,s,i)=>{let a=T.assertAndGetBroadcastShape(e,r),l=w.sizeFromShape(a),u=a.length,c=w.computeStrides(a),p=w.getTypedArrayFromDType("float32",l),f=w.getTypedArrayFromDType("float32",l),d=T.getBroadcastDims(e,a),m=T.getBroadcastDims(r,a),h=T.mergeRealAndImagArrays(n,o),x=T.mergeRealAndImagArrays(s,i),g=e.length,y=w.computeStrides(e),b=r.length,v=w.computeStrides(r);if(d.length+m.length===0)for(let C=0;C<p.length;C++){let S=C%h.length,k=C%x.length,I=t(h[S*2],h[S*2+1],x[k*2],x[k*2+1]);p[C]=I.real,f[C]=I.imag}else for(let C=0;C<p.length;C++){let S=w.indexToLoc(C,u,c),k=S.slice(-g);d.forEach(j=>k[j]=0);let I=w.locToIndex(k,g,y),A=S.slice(-b);m.forEach(j=>A[j]=0);let $=w.locToIndex(A,b,v),O=t(h[I*2],h[I*2+1],x[$*2],x[$*2+1]);p[C]=O.real,f[C]=O.imag}return[p,f,a]}}var QE=rt((t,e)=>t+e),wie=Th((t,e,r,n)=>({real:t+r,imag:e+n})),Qi=it(ri,QE,wie),SB={kernelName:ri,backendName:"cpu",kernelFunc:Qi};function Nh(t,e,r,n,o){let s=w.sizeFromShape(n),i=w.makeZerosTypedArray(o,r);for(let a=0;a<t.length;a++){let l=t[a];if(l<0)throw new Error("Input x must be non-negative!");l>=o||(s>0?i[l]+=e[a]:i[l]+=1)}return i}function Yw(t,e,r,n=!1){let o=t.shape[0],s=t.shape[1],i=Ie([o,r],e.dtype);for(let a=0;a<o;a++)for(let l=0;l<s;l++){let u=t.get(a,l);if(u<0)throw new Error("Input x must be non-negative!");u>=r||(n?i.set(1,a,u):e.size>0?i.set(i.get(a,u)+e.get(a,l),a,u):i.set(i.get(a,u)+1,a,u))}return i}function Qn(t){return(e,r,n)=>{let o=w.getTypedArrayFromDType(r,e.length);for(let s=0;s<e.length;++s)o[s]=t(e[s],n);return o}}function Le(t,e,r){return({inputs:n,attrs:o,backend:s})=>{let{x:i}=n;if(ee(i,t),i.dtype==="string"||r==="string")throw new Error("unaryKernelFunc does not support string input/output");let a=s,l=a.data.get(i.dataId).values,u=w.sizeFromShape(i.shape),c=r||i.dtype,p=w.getArrayFromDType(c,u);for(let f=0;f<u;++f)p[f]=e(l[f],o);return a.makeTensorInfo(i.shape,c,p)}}function Os(t,e,r){return({inputs:n,attrs:o,backend:s})=>{let{x:i}=n;if(ee(i,t),i.dtype==="string"||r==="string")throw new Error("unaryKernelFunc does not support string input/output");let a=s,l=a.data.get(i.dataId).values,u=r||i.dtype,c=e(l,u,o);return a.makeTensorInfo(i.shape,u,c)}}var ZE=Qn(t=>Math.ceil(t)),Cie=Os(Ia,ZE),kB={kernelName:Ia,backendName:"cpu",kernelFunc:Cie};function Qw(t,e,r,n){let o=w.getArrayFromDType(r,w.sizeFromShape(e));if(n&&r!=="string"){let s=0;t.forEach(i=>{let a=w.sizeFromShape(i.shape);o.set(i.vals,s),s+=a})}else{let s=0;t.forEach(i=>{let a=r==="string"?T.fromUint8ToStringArray(i.vals):i.vals,l=0;for(let u=0;u<i.shape[0];++u){let c=u*e[1]+s;for(let p=0;p<i.shape[1];++p)o[c+p]=a[l++]}s+=i.shape[1]})}return o}var JE=rt((t,e)=>t===e?1:0),e_=it(Ep,JE,null,"bool"),TB={kernelName:Ep,backendName:"cpu",kernelFunc:e_};var t_=Qn(t=>Math.exp(t)),r_=Os(Oa,t_,"float32"),NB={kernelName:Oa,backendName:"cpu",kernelFunc:r_};var n_=Qn(t=>Math.expm1(t)),Sie=Os(Fa,n_),IB={kernelName:Fa,backendName:"cpu",kernelFunc:Sie};var o_=Qn(t=>Math.floor(t)),kie=Os(Pa,o_),EB={kernelName:Pa,backendName:"cpu",kernelFunc:kie};function Zw(t,e,r,n,o,s,i,a,l){let u=Ie([n,s],r);for(let c=0;c<n;c++){let p=[],f=0;for(let d=0;d<o;d++){let m=t[c*o+d];f+=m*i[d],p.push(m)}if(f<0||f>=l/s)throw new Error(`Invalid indices: ${p} does not index into ${a}`);for(let d=0;d<s;d++)u.values[c*s+d]=e.get(...e.indexToLoc(f*s+d))}return u}function Jw(t,e,r){let n=Ie(r,t.dtype);for(let o=0;o<n.size;++o){let i=n.indexToLoc(o).slice(),a=i[0],l=i[2],u=e.locToIndex([a,l]);i[2]=e.values[u];let c=t.locToIndex(i);0<=c&&c<t.values.length&&(n.values[o]=t.values[c])}return n}var s_=rt((t,e)=>t>e?1:0),Tie=it(_p,s_,null,"bool"),_B={kernelName:_p,backendName:"cpu",kernelFunc:Tie};var i_=rt((t,e)=>t>=e?1:0),Nie=it(Ma,i_,null,"bool"),AB={kernelName:Ma,backendName:"cpu",kernelFunc:Nie};var a_=rt((t,e)=>t<e?1:0),Iie=it(Ap,a_,null,"bool"),DB={kernelName:Ap,backendName:"cpu",kernelFunc:Iie};var l_=rt((t,e)=>t<=e?1:0),Eie=it(Dp,l_,null,"bool"),$B={kernelName:Dp,backendName:"cpu",kernelFunc:Eie};function eC(t,e,r){let n=(e-t)/(r-1),o=w.makeZerosTypedArray(r,"float32");o[0]=t;for(let s=1;s<o.length;s++)o[s]=o[s-1]+n;return o}var u_=Qn(t=>Math.log(t)),_ie=Os(Wa,u_),RB={kernelName:Wa,backendName:"cpu",kernelFunc:_ie};function tC(t,e,r,n){let o=w.getTypedArrayFromDType(n,w.sizeFromShape(r));for(let s=0;s<o.length;++s){let i=s*e,a=t[i];for(let l=0;l<e;++l){let u=t[i+l];(Number.isNaN(u)||u>a)&&(a=u)}o[s]=a}return o}var c_=rt((t,e)=>Math.max(t,e)),Aie=it(Ua,c_),OB={kernelName:Ua,backendName:"cpu",kernelFunc:Aie};var p_=rt((t,e)=>Math.min(t,e)),Die=it(Ha,p_),FB={kernelName:Ha,backendName:"cpu",kernelFunc:Die};var I0=rt((t,e)=>t*e),$ie=Th((t,e,r,n)=>({real:t*r-e*n,imag:t*n+e*r})),Tf=it(ja,I0,$ie),PB={kernelName:ja,backendName:"cpu",kernelFunc:Tf};function f_(t,e,r){let n=w.createScalarValue(-1,r);return I0([],e,n,t,r)}function Rie(t){let{inputs:e,backend:r}=t,{x:n}=e;ee(n,"neg");let o=r.data.get(n.dataId).values,[s,i]=f_(o,n.shape,n.dtype);return r.makeTensorInfo(i,n.dtype,s)}var LB={kernelName:Uu,backendName:"cpu",kernelFunc:Rie};var d_=rt((t,e)=>t!==e?1:0),Oie=it(Fp,d_,null,"bool"),MB={kernelName:Fp,backendName:"cpu",kernelFunc:Oie};function Ih(t,e,r,n,o){let s=e.length,i=w.sizeFromShape(e),a=w.computeStrides(e),l=w.computeStrides(o),u=w.getTypedArrayFromDType(r,w.sizeFromShape(o));for(let c=0;c<i;++c){let p=w.indexToLoc(c,s,a),f=new Array(p.length);for(let m=0;m<f.length;m++)f[m]=p[n[m]];let d=w.locToIndex(f,s,l);u[d]=t[c]}return u}function Yt(t){let{inputs:e,attrs:r,backend:n}=t,{x:o}=e,{perm:s}=r;ee(o,"transpose");let i=o.shape.length,a=new Array(i);for(let p=0;p<a.length;p++)a[p]=o.shape[s[p]];let l=n.data.get(o.dataId).values,u=Ih(l,o.shape,o.dtype,s,a);return{dataId:n.write(u,a,o.dtype),shape:a,dtype:o.dtype}}var zB={kernelName:Li,backendName:"cpu",kernelFunc:Yt};function m_(t,e,r,n){let[o,s]=T.computeOutAndReduceShapes(t,n),i=wr(e,"int32"),a=w.makeZerosTypedArray(w.sizeFromShape(o),i),l=w.sizeFromShape(s);for(let u=0;u<a.length;++u){let c=u*l,p=1;for(let f=0;f<l;++f)p*=r[c+f];a[u]=p}return{outVals:a,outShape:o,outDtype:i}}function Fie(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{axis:s,keepDims:i}=n;ee(o,"prod");let a=o.shape.length,l=w.parseAxisParam(s,o.shape),u=T.getAxesPermutation(l,a),c=l,p=o,f=[];u!=null&&(p=Yt({inputs:{x:o},backend:r,attrs:{perm:u}}),f.push(p),c=T.getInnerMostAxes(c.length,a));let d=r.data.get(p.dataId).values,{outVals:m,outShape:h,outDtype:x}=m_(p.shape,p.dtype,d,c),g=h;return i&&(g=T.expandShapeToKeepDim(h,l)),f.forEach(y=>r.disposeIntermediateTensorInfo(y)),r.makeTensorInfo(g,x,m)}var BB={kernelName:Yu,backendName:"cpu",kernelFunc:Fie};function Pie(t,e,r){t.forEach((n,o)=>{if(n<0||n>=r){let s=w.indexToLoc(o,e.length,w.computeStrides(e)).join(",");throw new Error(`indices[${s}] = ${n} is not in [0, ${r})`)}})}function Lie(t,e){for(let r=0;r<t.length;++r){let n=t[r],o=r===t.length-1?e:t[r+1].length;if(n.length===0)throw new Error("Ragged splits may not be empty");if(n[0]<0)throw new Error("Ragged splits must be non-negative");if(n[n.length-1]>o)throw new Error("Ragged splits must not point past values");for(let s=1;s<n.length;++s)if(n[s-1]>n[s])throw new Error("Ragged splits must be sorted in ascending order")}}function Mie(t,e,r,n){let o=[],s=0,i=e.length-1+r.length,a=new Array(i).fill(null).map(()=>[0]);Lie(r,n);let l=1;for(let u=0;u<e.length-1;++u){l*=e[u];let c=e[u+1];for(let p=1;p<l+1;++p)a[u].push(p*c)}for(let u=0;u<t.length;++u){let c=t[u],p=t[u]+1;for(let f=0;f<r.length;++f){let d=r[f],m=f+e.length-1;if(m>=0){let h=a[m],x=h[h.length-1]-d[c];for(let g=c;g<p;++g)a[m].push(d[g+1]+x)}c=d[c],p=d[p]}p!==c&&(o.push([c,p]),s+=p-c)}return{outSplits:a,valueSlices:o,numValues:s}}function zie(t){let e=[];for(let r=0;r<t.length;++r){let n=t[r].length,o=w.getArrayFromDType("int32",n);e.push(o),t[r].forEach((s,i)=>o[i]=s)}return e}function VB(t,e){let r=t.slice(0,e);for(;r.length<e;)r.push(1);for(let n=e;n<t.length;n++)r[e-1]*=t[n];return r}function Bie(t,e,r,n,o,s){let i=VB(e,2)[1],a=VB(s,2)[1],l=0;for(let u of r)for(let c=u[0];c<u[1];++c){for(let p=0;p<n;++p)o[l*a+p]=t[c*i+p];++l}}function Vie(t,e,r,n,o){let s=e.slice();s[0]=o;let i=w.getArrayFromDType(r,w.sizeFromShape(s)),a=t.length,l=a===0?0:a/e[0];return Bie(t,e,n,l,i,s),[i,s]}function rC(t,e,r,n,o,s,i,a){if(t.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");let l=e[0][0]-1;if(Pie(s,i,l),n.length===0)throw new Error("params.rank must be nonzero");let u=n[0],{outSplits:c,valueSlices:p,numValues:f}=Mie(s,i,t,u),d=zie(c),m=Vie(r,n,o,p,f);return[d,m[0],m[1]]}var WB=2147483647;function nC(t,e,r,n,o,s,i){if(e.length>1)throw new Error("starts must be a scalar or vector");if(o.length>1)throw new Error("limits must be a scalar or vector");if(i.length>1)throw new Error("deltas must be a scalar or vector");let a=e.length===0,l=o.length===0,u=i.length===0,c=[];a||c.push(e[0]),l||c.push(o[0]),u||c.push(i[0]);for(let x=1;x<c.length;++x)if(c[x]!==c[x-1])throw new Error("starts, limits, and deltas must have the same shape");let p=c.length===0?1:c[0],f=w.getArrayFromDType("int32",p+1);f[0]=0;for(let x=0;x<p;++x){let g=a?t[0]:t[x],y=l?n[0]:n[x],b=u?s[0]:s[x];if(b===0)throw new Error("Requires delta != 0");let v;if(b>0&&y<g||b<0&&y>g)v=0;else if(v=Math.ceil(Math.abs((y-g)/b)),v>WB)throw new Error(`Requires ((limit - start) / delta) <= ${WB}`);f[x+1]=f[x]+v}let d=f[p],m=w.getArrayFromDType(r,d),h=0;for(let x=0;x<p;++x){let g=f[x+1]-f[x],y=a?t[0]:t[x],b=u?s[0]:s[x];for(let v=0;v<g;++v)m[h++]=y,y+=b}return[f,m]}var Fs=T.RowPartitionType,Eh=class{constructor(e,r,n,o,s,i,a,l,u,c){this.shape=e,this.shapeShape=r,this.values=n,this.valuesShape=o,this.valuesDType=s,this.defaultValue=i,this.defaultValueShape=a,this.rowPartitionValues=l,this.rowPartitionValuesShapes=u,this.rowPartitionTypes=T.getRowPartitionTypesHelper(c),this.raggedRank=T.getRaggedRank(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===Fs.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===Fs.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){let r=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case Fs.VALUE_ROWIDS:return Eh.getMaxWidthValueRowID(r);case Fs.ROW_SPLITS:return Eh.getMaxWidthRowSplit(r);default:throw new Error(`Cannot handle partition type ${Fs[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){let r=e.length;if(r===0||r===1)return 0;let n=0;for(let o=0;o<r-1;++o){let s=e[o+1]-e[o];s>n&&(n=s)}return n}static getMaxWidthValueRowID(e){let r=e.length;if(r===0)return 0;let n=0,o=e[0],s=0;for(let i=1;i<r;++i){let a=e[i];a!==o&&(o=a,s=Math.max(i-n,s),n=i)}return Math.max(r-n,s)}tensorShapeFromTensor(e,r,n=!0){if(r.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return UB(e,n)}calculateOutputSize(e){let r=this.valuesShape,n=this.defaultValueShape;T.validateDefaultValueShape(n,r);let o=this.tensorShapeFromTensor(this.shape,this.shapeShape),i=T.combineRaggedTensorToTensorShapes(this.raggedRank,o,r);i[0]<0&&(i[0]=e);for(let a=1;a<=this.raggedRank;++a)i[a]<0&&(i[a]=this.getMaxWidth(a));return i}calculateFirstParentOutputIndex(e,r,n){let o=Math.min(e,n),s=[],i=0;for(let a=0;a<o;++a,i+=r)s.push(i);for(let a=o;a<e;++a)s.push(-1);return w.assert(s.length===e,()=>"Final length of result must be equal to firstDimension."),s}calculateOutputIndexRowSplit(e,r,n,o){let s=e.length,i=[];for(let a=0;a<s-1;++a){let l=e[a+1]-e[a],u=Math.min(o,l),c=r[a];c===-1&&(u=0);for(let p=0;p<u;++p)i.push(c),c+=n;for(let p=0;p<l-u;++p)i.push(-1)}if(s>0&&i.length!==e[s-1])throw new Error("Invalid row split size.");return i}calculateOutputIndexValueRowID(e,r,n,o){let s=e.length,i=[];if(s===0)return[];let a=0,l=e[0];if(l>=r.length)throw new Error(`Got currentValueRowId=${l}, which is not less than ${r.length}`);let u=r[l];i.push(u);for(let c=1;c<s;++c){let p=e[c];if(p===l)u>=0&&(++a,a<o?u+=n:u=-1);else{if(a=0,l=p,p>=r.length)throw new Error(`Got nextValueRowId=${p} which is not less than ${r.length}`);u=r[p]}i.push(u)}if(i.length!==e.length)throw new Error("Invalid row ids.");return i}calculateOutputIndex(e,r,n,o){let s=this.getRowPartitionTensor(e),i=this.getRowPartitionTypeByDimension(e);switch(i){case Fs.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(s,r,n,o);case Fs.ROW_SPLITS:if(s.length-1>r.length)throw new Error(`Row partition size is greater than output size: ${s.length-1} > ${r.length}`);return this.calculateOutputIndexRowSplit(s,r,n,o);default:throw new Error(`Unsupported partition type: ${Fs[i]}`)}}getFirstDimensionSize(){let e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");let r=this.rowPartitionTypes[0];switch(r){case Fs.FIRST_DIM_SIZE:return e[0];case Fs.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case Fs.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${Fs[r]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");let r=this.getFirstDimensionSize(),n=this.calculateOutputSize(r),o=new Array(this.raggedRank+1);o[o.length-1]=1;for(let l=o.length-2;l>=0;--l)o[l]=o[l+1]*n[l+1];let s=UB(n,!1),i=w.getArrayFromDType(this.valuesDType,w.sizeFromShape(s));if(o[0]*n[0]>0){let l=this.calculateFirstParentOutputIndex(r,o[0],n[0]);for(let u=1;u<=this.raggedRank;++u)l=this.calculateOutputIndex(u-1,l,o[u],n[u]);this.setOutput(this.raggedRank,l,i,s)}return[s,i]}setOutput(e,r,n,o){if(n.length===0)return;let s=this.values,i=n,a=o.slice();a=a.slice(e+1);let l=w.sizeFromShape(a),u=r.length,c=this.defaultValue;if(c.length!==l&&c.length!==1){let m=this.defaultValueShape;G(()=>{let h=M(c,m);c=yl(h,a).dataSync()})}let p=0,f=0,d=0;for(let m=0;m<=u;++m){let h=m<u?r[m]:-1;if(h===d){++d;continue}if(f<d){let x=s.subarray(p*l),g=i.subarray(f*l),y=(d-f)*l;GB(g,x,y)}if(m>=u){let x=n.length;h=Math.floor(x/l)}if(h>d)if(this.defaultValue.length===1)i.subarray(d*l,h*l).fill(this.defaultValue[0]),d=h;else for(;h>d;){let x=i.slice(d*l);GB(x,c,l),++d}h<0?(p=m+1,f=d):(p=m,f=d,d=f+1)}}};function GB(t,e,r){for(let n=0;n<r;n++)t[n]=e[n]}function UB(t,e){let r=[];for(let n of t){if(n<0){if(!e)throw new Error(`Dimension ${n} must be >= 0`);if(n<-1)throw new Error(`Dimension ${n} must be >= -1`);n=-1}r.push(n)}return r}function oC(t,e,r,n,o,s,i,a,l,u){return new Eh(t,e,r,n,o,s,i,a,l,u).compute()}function sC(t,e,r,n){let o=t===e,s=t<e&&r<0,i=e<t&&r>1;if(o||s||i)return w.makeZerosTypedArray(0,n);let a=Math.abs(Math.ceil((e-t)/r)),l=w.makeZerosTypedArray(a,n);e<t&&r===1&&(r=-1),l[0]=t;for(let u=1;u<l.length;u++)l[u]=l[u-1]+r;return l}var h_=Qn(t=>1/Math.sqrt(t)),Wie=Os(Ja,h_),HB={kernelName:Ja,backendName:"cpu",kernelFunc:Wie};function Rl(t,e,r,n,o,s,i,a,l,u){let c=[n/o,o],p=t.values,f=e.values;if(n===0)return Ie(r,e.dtype);let d=Ie(c,e.dtype);typeof l=="string"||typeof l=="number"?d.values.fill(l):typeof l=="boolean"&&d.values.fill(+l);for(let m=0;m<s;m++){let h=[],x=0;for(let g=0;g<i;g++){let y=p[m*i+g];h.push(y),x+=y*a[g]}if(x<0||x>=n/o)throw new Error(`Invalid indices: ${h} does not index into ${r}`);for(let g=0;g<o;g++)u?d.values[x*o+g]+=f[m*o+g]:d.values[x*o+g]=e.rank===0?f[0]:f[m*o+g]}return d}var qB=Qn(t=>1/(1+Math.exp(-t))),g_=Le(ol,t=>1/(1+Math.exp(-t))),jB={kernelName:ol,backendName:"cpu",kernelFunc:g_};function x_(t,e,r,n,o){let s=Hr.isSliceContinous(n,e,r),i=w.sizeFromShape(r),a=w.computeStrides(n);if(s){let p=Hr.computeFlatOffset(e,a);return o==="string"?t.slice(p,p+i):t.subarray(p,p+i)}let l=o==="string"?T.fromUint8ToStringArray(t):t,u=Ie(n,o,l),c=Ie(r,o);for(let p=0;p<c.size;++p){let f=c.indexToLoc(p),d=f.map((m,h)=>m+e[h]);c.set(u.get(...d),...f)}return o==="string"?T.fromStringArrayToUint8(c.values):c.values}function Ps(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{begin:s,size:i}=n;ee(o,"slice");let[a,l]=Hr.parseSliceParams(o,s,i);Hr.assertParamsValid(o,a,l);let u=r.data.get(o.dataId).values,c=x_(u,a,l,o.shape,o.dtype);return r.makeTensorInfo(l,o.dtype,c)}var KB={kernelName:rc,backendName:"cpu",kernelFunc:Ps};function iC(t,e,r,n,o,s,i){let a=e[0],l=s[0],u=new Array(l),c=new Array(a),p=e[1];if(l===0){if(a!==0)throw new Error(T.getSparseFillEmptyRowsIndicesDenseShapeMismatch(a));let x=w.getArrayFromDType(r,0),g=w.getArrayFromDType(o,0);return[x,[0,p],g,u,c]}let f=!0,d=0,m=new Array(l).fill(0);for(let x=0;x<a;++x){let g=t[x*p];if(g<0)throw new Error(T.getSparseFillEmptyRowsNegativeIndexErrorMessage(x,g));if(g>=l)throw new Error(T.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(x,g,l));++m[g],f=f&&g>=d,d=g}let h=!0;for(let x=0;x<l;++x){let g=m[x]===0;u[x]=g,h=h&&!g,m[x]=Math.max(m[x],1),x>0&&(m[x]+=m[x-1])}if(h&&f){let x=t,g=n;for(let y=0;y<a;++y)c[y]=y;return[x,[a,p],g,u,c]}else{let x=m[l-1],g=w.getArrayFromDType(r,x*p),y=w.getArrayFromDType(o,x),b=new Array(l).fill(0);for(let v=0;v<a;++v){let C=t[v*p],S=b[C],k=(C===0?0:m[C-1])+S;b[C]++;for(let I=0;I<p;++I)g[k*p+I]=t[v*p+I];y[k]=n[v],c[v]=k}for(let v=0;v<l;++v)if(b[v]===0){let S=v===0?0:m[v-1];g[S*p+0]=v;for(let k=1;k<p;++k)g[S*p+k]=0;y[S]=i}return[g,[x,p],y,u,c]}}function aC(t,e,r,n,o){let s=w.sizeFromShape(n),i=e[0],a=o.length,l=[],u=1,c=-1;for(let x=0;x<a;++x){let g=o[x];if(g===-1){if(c!==-1)throw new Error(T.getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(c,x));c=x,l.push(1)}else{if(g<0)throw new Error(T.getSparseReshapeNegativeOutputDimErrorMessage(x,g));u*=g,l.push(g)}}if(c!==-1){if(u<=0)throw new Error(T.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage());let x=Math.trunc(s/u);if(u*x!==s)throw new Error(T.getSparseReshapeInputOutputMultipleErrorMessage(n,l));l[c]=x}if(w.sizeFromShape(l)!==s)throw new Error(T.getSparseReshapeInputOutputMismatchErrorMessage(n,l));let f=n.length,d=[];if(f>0){d[f-1]=1;for(let x=f-2;x>=0;--x)d[x]=d[x+1]*n[x+1]}let m=[];if(a>0){m[a-1]=1;for(let x=a-2;x>=0;--x)m[x]=m[x+1]*l[x+1]}let h=w.getArrayFromDType(r,i*a);for(let x=0;x<i;++x){let g=0;for(let y=0;y<f;++y)g+=t[x*f+y]*d[y];for(let y=0;y<a;++y)h[x*a+y]=Math.trunc(g/m[y]),g%=m[y]}return[h,[i,a],l]}function _h(t,e,r,n,o,s=!1,i=0){let a=n.length,l=[e[0],t.length/e[0]],u=l[1],p=a>0?o[a-1]+1:0;if(p<0)throw new Error(T.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());let f=e.slice();f[0]=p;let d=f.reduce((b,v)=>b*v,1),m=w.getArrayFromDType(r,d);if(a===0)return p>0&&m.fill(i),[m,f];if(p<=0)throw new Error(T.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());let h=0,x=1,g=0,y=o[h];for(;;){let b=0;if(x<a){if(b=o[x],y===b){++x;continue}if(y>=b)throw new Error(T.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage())}if(y<0||y>=p)throw new Error(T.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(y,p));y>g&&m.fill(i,g*u,y*u);for(let v=h;v<x;++v){let C=n[v];if(C<0||C>=l[0])throw new Error(T.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(v,n[v],l[0]));for(let S=0;S<u;S++)m[y*u+S]+=t[C*u+S]}if(s)for(let v=0;v<u;v++)m[y*u+v]/=x-h;if(h=x,++x,g=y+1,y=b,x>a)break}return g<p&&m.fill(i,g*u,p*u),[m,f]}var XB=Qn(t=>Math.sqrt(t)),Gie=Le(il,t=>Math.sqrt(t)),YB={kernelName:il,backendName:"cpu",kernelFunc:Gie};var y_=rt((t,e)=>{let r=t-e;return r*r}),Uie=it(al,y_),QB={kernelName:al,backendName:"cpu",kernelFunc:Uie};function lC(t,e,r,n){let o=Ie(t,e.dtype);for(let s=0;s<o.size;s++){let i=o.indexToLoc(s),a=new Array(i.length);for(let l=0;l<a.length;l++)a[l]=i[l]*r[l]+n[l];o.set(e.get(...a),...i)}return o}var b_=class{constructor(e,r,n,o,s,i){this.separator=w.encodeString(e),this.nGramWidths=r,this.leftPad=w.encodeString(n),this.rightPad=w.encodeString(o),this.padWidth=s,this.preserveShort=i}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,r){let n=this.getPadWidth(r);return Math.max(0,e+2*n-r+1)}createNGrams(e,r,n,o,s,i){for(let a=0;a<s;++a){let l=this.getPadWidth(i),u=Math.max(0,l-a),c=Math.max(0,l-(s-(a+1))),p=i-(u+c),f=r+(u>0?0:a-l),d=0;d+=u*this.leftPad.length;for(let y=0;y<p;++y)d+=e[f+y].length;d+=c*this.rightPad.length;let m=u+c+p-1;d+=m*this.separator.length,n[o+a]=new Uint8Array(d);let h=n[o+a],x=0,g=y=>y.forEach(b=>h[x++]=b);for(let y=0;y<u;++y)g(this.leftPad),g(this.separator);for(let y=0;y<p-1;++y)g(e[f+y]),g(this.separator);if(p>0){g(e[f+p-1]);for(let y=0;y<c;++y)g(this.separator),g(this.rightPad)}else{for(let y=0;y<c-1;++y)g(this.rightPad),g(this.separator);g(this.rightPad)}}}compute(e,r){let n=e.length,o=r.length;if(o>0){let l=r[0];if(l!==0)throw new Error(`First split value must be 0, got ${l}`);for(let u=1;u<o;++u){let c=r[u]>=l;if(c=c&&r[u]<=n,!c)throw new Error(`Invalid split value ${r[u]}, must be in [${l}, ${n}]`);l=r[u]}if(l!==n)throw new Error(`Last split value must be data size. Expected ${n}, got ${l}`)}let s=o-1,i=w.getArrayFromDType("int32",o);if(n===0||o===0){let l=new Array(n);for(let u=0;u<=s;++u)i[u]=0;return[l,i]}i[0]=0;for(let l=1;l<=s;++l){let u=r[l]-r[l-1],c=0;this.nGramWidths.forEach(p=>{c+=this.getNumNGrams(u,p)}),this.preserveShort&&u>0&&c===0&&(c=1),i[l]=i[l-1]+c}let a=new Array(i[s]);for(let l=0;l<s;++l){let u=r[l],c=i[l];if(this.nGramWidths.forEach(p=>{let f=r[l+1]-r[l],d=this.getNumNGrams(f,p);this.createNGrams(e,u,a,c,d,p),c+=d}),this.preserveShort&&c===i[l]){let p=r[l+1]-r[l];if(p===0)continue;let f=p+2*this.padWidth,d=1;this.createNGrams(e,u,a,c,d,f)}}return[a,i]}};function uC(t,e,r,n,o,s,i,a){return new b_(r,n,o,s,i,a).compute(t,e)}function Hie(t,e,r,n){if(!t.length)return;if(e.length===0){for(let s=0;s<t.length;++s)n.push(t.subarray(s,s+1));return}if(e.length===1){let s=e[0],i=t.indexOf(s);for(;i!==-1;){let a=t.subarray(0,i);(!r||a.length!==0)&&n.push(a),t=t.subarray(i+1),i=t.indexOf(s)}(!r||t.length!==0)&&n.push(t);return}let o=0;for(let s=0;s<t.length+1;s++)if(s===t.length||e.indexOf(t[s])!==-1){let i=t.subarray(o,s);(!r||i.length!==0)&&n.push(i),o=s+1}}function cC(t,e,r){let n=t.length,o=[],s=0,i=0,a=new Array(n);for(let f=0;f<n;++f){let d=o.length;Hie(t[f],e,r,o);let m=o.length-d;a[f]=m,s+=m,i=Math.max(i,m)}let l=w.getArrayFromDType("int32",s*2),u=new Array(s),c=[n,i],p=0;for(let f=0;f<n;++f)for(let d=0;d<a[f];++d)l[p*2]=f,l[p*2+1]=d,u[p]=o[p],++p;return[l,u,c]}function pC(t,e){let r=w.getArrayFromDType("int32",t.length);for(let n=0;n<t.length;++n)r[n]=w.fingerPrint64(t[n]).modulo(e).getLowBitsUnsigned();return r}var v_=rt((t,e)=>t-e),qie=Th((t,e,r,n)=>({real:t-r,imag:e-n})),E0=it(ll,v_,qie),ZB={kernelName:ll,backendName:"cpu",kernelFunc:E0};function fC(t,e){let r=new Array(t.rank);for(let o=0;o<r.length;o++)r[o]=t.shape[o]*e[o];let n=Ie(r,t.dtype);for(let o=0;o<n.values.length;++o){let s=n.indexToLoc(o),i=new Array(t.rank);for(let l=0;l<i.length;l++)i[l]=s[l]%t.shape[l];let a=t.locToIndex(i);n.values[o]=t.values[a]}return n}var _0=(t,e)=>{let r=e.value-t.value;return r===0?t.index-e.index:r};function JB(t,e,r=0,n=t.length-1){for(;n>r;){if(n-r>600){let a=n-r+1,l=e-r+1,u=Math.log(a),c=.5*Math.exp(2*u/3),p=.5*Math.sqrt(u*c*(a-c)/a)*Math.sign(l-a/2),f=Math.max(r,Math.floor(e-l*c/a+p)),d=Math.min(n,Math.floor(e+(a-l)*c/a+p));JB(t,e,f,d)}let o=t[e],s=r,i=n;for(w.swap(t,r,e),_0(t[n],o)>0&&w.swap(t,r,n);s<i;){for(w.swap(t,s,i),s++,i--;_0(t[s],o)<0;)s=s+1;for(;_0(t[i],o)>0;)i=i-1}_0(t[r],o)===0?w.swap(t,r,i):(i=i+1,w.swap(t,i,n)),i<=e&&(r=i+1),e<=i&&(n=i-1)}}function dC(t,e,r,n,o){let s=e[e.length-1],[i,a]=[t.length/s,s],l=w.getTypedArrayFromDType(r,i*n),u=w.getTypedArrayFromDType("int32",i*n);for(let p=0;p<i;p++){let f=p*a,d=t.subarray(f,f+a),m=new Array(d.length);d.forEach((y,b)=>m[b]={value:y,index:b}),n<m.length&&(JB(m,n),m=m.slice(0,n)),o&&m.sort(_0);let h=p*n,x=l.subarray(h,h+n),g=u.subarray(h,h+n);for(let y=0;y<n;y++)x[y]=m[y].value,g[y]=m[y].index}let c=e.slice();return c[c.length-1]=n,[Ie(c,r,l),Ie(c,"int32",u)]}function mC(t,e,r,n){let o=w.parseAxisParam(e,r)[0],s=[1,r[0],1];for(let m=0;m<o;m++)s[0]*=r[m];s[1]=r[o];for(let m=o+1;m<r.length;m++)s[2]*=r[m];let i={},a=new Int32Array(r[o]),l=new bt(s,n,t),u=[],c=s[0]===1&&s[2]===1;for(let m=0;m<r[o];m++){let h;if(c)h=t[m].toString();else{let x=[];for(let g=0;g<s[0];g++)for(let y=0;y<s[2];y++)x.push(l.get(g,m,y));h=x.join(",")}if(i[h]!==void 0)a[m]=i[h];else{let x=Object.keys(i).length;i[h]=x,a[m]=x,u.push(m)}}let p=s.slice();p[1]=Object.keys(i).length;let f=new bt(p,n);u.forEach((m,h)=>{for(let x=0;x<s[0];x++)for(let g=0;g<s[2];g++)f.set(l.get(x,m,g),x,h,g)});let d=r.slice();return d[o]=p[1],{outputValues:f.values,outputShape:d,indices:a}}v1("cpu",()=>new kf,1);var C_=Le($a,t=>t>=0?t:Math.exp(t)-1),e4={kernelName:$a,backendName:"cpu",kernelFunc:C_};function S_(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{alpha:s}=n;ee([o],"leakyRelu");let i=w.sizeFromShape(o.shape),a=r.data.get(o.dataId).values,l=w.getTypedArrayFromDType("float32",i);for(let u=0;u<a.length;u++)l[u]=a[u]<0?s*a[u]:a[u];return r.makeTensorInfo(o.shape,"float32",l)}var t4={kernelName:Pu,backendName:"cpu",kernelFunc:S_};var jie=rt((t,e)=>t<0?e*t:t);function k_(t){let{inputs:e,backend:r}=t,{x:n,alpha:o}=e;ee([n,o],"prelu");let s=r.data.get(n.dataId).values,i=r.data.get(o.dataId).values,[a,l]=jie(n.shape,o.shape,s,i,"float32");return r.makeTensorInfo(l,"float32",a)}var r4={kernelName:Xu,backendName:"cpu",kernelFunc:k_};var T_=Le(Ya,t=>Math.max(0,t)),n4={kernelName:Ya,backendName:"cpu",kernelFunc:T_};var N_=Le(Qa,t=>Math.min(Math.max(0,t),6)),o4={kernelName:Qa,backendName:"cpu",kernelFunc:N_};function Nf(t,e,r,n,o){if(r==="linear")return wn({inputs:{x:e},backend:t});if(r==="relu")return T_({inputs:{x:e},backend:t});if(r==="elu")return C_({inputs:{x:e},backend:t});if(r==="relu6")return N_({inputs:{x:e},backend:t});if(r==="prelu")return k_({inputs:{x:e,alpha:n},backend:t});if(r==="leakyrelu")return S_({inputs:{x:e},backend:t,attrs:{alpha:o}});if(r==="sigmoid")return g_({inputs:{x:e},backend:t});throw new Error(`Activation ${r} has not been implemented for the CPU backend.`)}function et(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{shape:s}=n,i=w.sizeFromShape(o.shape),a=w.inferFromImplicitShape(s,i),l=w.sizeFromShape(a);w.assert(i===l,()=>`The new shape (${a}) has ${l} elements and the old shape (${o.shape}) has ${i} elements. The new shape and old shape must have the same number of elements.`),r.incRef(o.dataId);let u=r.data.get(o.dataId);if(u.complexTensorInfos!=null){let c=u.complexTensorInfos.real,p=u.complexTensorInfos.imag;c.shape=a,p.shape=a}return{dataId:o.dataId,shape:a,dtype:o.dtype}}var s4={kernelName:Qu,backendName:"cpu",kernelFunc:et};function I_(t){let{inputs:e,backend:r,attrs:n}=t,{a:o,b:s}=e,{transposeA:i,transposeB:a}=n;ee([o,s],"matMul");let l=o.shape.length,u=s.shape.length,c=i?o.shape[l-2]:o.shape[l-1],p=a?s.shape[u-1]:s.shape[u-2],f=i?o.shape[l-1]:o.shape[l-2],d=a?s.shape[u-2]:s.shape[u-1],m=o.shape.slice(0,-2),h=s.shape.slice(0,-2),x=w.sizeFromShape(m),g=w.sizeFromShape(h),b=No.assertAndGetBroadcastShape(o.shape.slice(0,-2),s.shape.slice(0,-2)).concat([f,d]);w.assert(c===p,()=>`Error in matMul: inner shapes (${c}) and (${p}) of Tensors with shapes ${o.shape} and ${s.shape} and transposeA=${i} and transposeB=${a} must match.`);let v=i?[x,c,f]:[x,f,c],C=a?[g,d,p]:[g,p,d],S=et({inputs:{x:o},backend:r,attrs:{shape:v}}),k=et({inputs:{x:s},backend:r,attrs:{shape:C}}),I=i?S.shape[1]:S.shape[2],A=i?S.shape[2]:S.shape[1],$=a?k.shape[1]:k.shape[2],O=Math.max(x,g),j=r.data.get(S.dataId).values,H=r.data.get(k.dataId).values,Y=w.computeStrides(S.shape),B=w.computeStrides(k.shape),[K,X,Z]=i?[Y[0],1,Y[1]]:[Y[0],Y[1],1],[Q,ie,re]=a?[1,B[1],B[0]]:[B[1],1,B[0]],ue=A*$,ne=Ie([O,A,$],S.dtype),le=ne.values,ae=r.blockSize;for(let me=0;me<O;me++)for(let be=0;be<A;be+=ae)for(let we=0;we<$;we+=ae)for(let ke=0;ke<I;ke+=ae){let He=Math.min(be+ae,A),We=Math.min(we+ae,$),R=Math.min(ke+ae,I);for(let U=be;U<He;U++)for(let P=we;P<We;P++){let se=0;for(let pe=ke;pe<R;pe++){let fe=Math.min(me,x-1)*K,Pe=Math.min(me,g-1)*re,Be=j[fe+U*X+pe*Z],Ge=H[pe*Q+P*ie+Pe];se+=Be*Ge}le[me*ue+(U*$+P)]+=se}}return r.disposeIntermediateTensorInfo(S),r.disposeIntermediateTensorInfo(k),r.makeTensorInfo(b,ne.dtype,ne.values)}var i4={kernelName:Su,backendName:"cpu",kernelFunc:I_};function Kie(t){let{inputs:e,backend:r,attrs:n}=t,{a:o,b:s,bias:i,preluActivationWeights:a}=e,{transposeA:l,transposeB:u,activation:c,leakyreluAlpha:p}=n,f,d,m,h=[];f=I_({inputs:{a:o,b:s},attrs:{transposeA:l,transposeB:u},backend:r}),i&&(d=Qi({inputs:{a:f,b:i},backend:r}),h.push(f),f=d),c&&(m=Nf(r,f,c,a,p),h.push(f),f=m);for(let g of h)r.disposeIntermediateTensorInfo(g);return f}var a4={kernelName:Pp,backendName:"cpu",kernelFunc:Kie};var Xie=Le(va,t=>Math.acos(t)),l4={kernelName:va,backendName:"cpu",kernelFunc:Xie};var Yie=Le(wa,t=>Math.acosh(t)),u4={kernelName:wa,backendName:"cpu",kernelFunc:Yie};function Qie(t){let{inputs:e,backend:r}=t,n=e;ee(e,"addN");let o=n.map(a=>r.data.get(a.dataId).values),s=Ie(n[0].shape,n[0].dtype),i=s.values;for(let a=0;a<n.length;a++){let l=o[a];for(let u=0;u<i.length;u++)i[u]+=l[u]}return r.makeTensorInfo(s.shape,s.dtype,s.values)}var c4={kernelName:Pd,backendName:"cpu",kernelFunc:Qie};function Zie(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{axis:s,keepDims:i}=n;ee(o,"all");let a=w.parseAxisParam(s,o.shape),l=a,u=T.getAxesPermutation(l,o.shape.length),c=o;u!=null&&(c=Yt({inputs:{x:o},backend:r,attrs:{perm:u}}),l=T.getInnerMostAxes(l.length,o.shape.length)),T.assertAxesAreInnerMostDims("all",l,c.shape.length);let[p,f]=T.computeOutAndReduceShapes(c.shape,l),d=w.sizeFromShape(f),m=w.makeZerosTypedArray(w.sizeFromShape(p),c.dtype),h=r.data.get(c.dataId).values;for(let g=0;g<m.length;++g){let y=g*d,b=h[y];for(let v=0;v<d;++v){let C=h[y+v];b=b&&C}m[g]=b}u!=null&&r.disposeIntermediateTensorInfo(c);let x=r.makeTensorInfo(p,c.dtype,m);if(i){let g=T.expandShapeToKeepDim(p,a),y=et({inputs:{x},backend:r,attrs:{shape:g}});return r.disposeIntermediateTensorInfo(x),y}return x}var p4={kernelName:Ld,backendName:"cpu",kernelFunc:Zie};function Jie(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{axis:s,keepDims:i}=n;ee(o,"any");let a=w.parseAxisParam(s,o.shape),l=a,u=T.getAxesPermutation(l,o.shape.length),c=o;u!=null&&(c=Yt({inputs:{x:o},backend:r,attrs:{perm:u}}),l=T.getInnerMostAxes(l.length,o.shape.length)),T.assertAxesAreInnerMostDims("any",l,c.shape.length);let[p,f]=T.computeOutAndReduceShapes(c.shape,l),d=w.sizeFromShape(f),m=w.makeZerosTypedArray(w.sizeFromShape(p),c.dtype),h=r.data.get(c.dataId).values;for(let g=0;g<m.length;++g){let y=g*d,b=h[y];for(let v=0;v<d;++v){let C=h[y+v];b=b||C}m[g]=b}u!=null&&r.disposeIntermediateTensorInfo(c);let x=r.makeTensorInfo(p,c.dtype,m);if(i){let g=T.expandShapeToKeepDim(p,a),y=et({inputs:{x},backend:r,attrs:{shape:g}});return r.disposeIntermediateTensorInfo(x),y}return x}var f4={kernelName:Md,backendName:"cpu",kernelFunc:Jie};function eae(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{axis:s}=n;ee(o,"argMax");let i=w.parseAxisParam(s,o.shape),a=T.getAxesPermutation(i,o.shape.length),l=o,u=[];a!=null&&(l=Yt({inputs:{x:o},backend:r,attrs:{perm:a}}),u.push(l),i=T.getInnerMostAxes(i.length,l.shape.length)),i=[i[0]],T.assertAxesAreInnerMostDims("argMax",i,l.shape.length);let[c,p]=T.computeOutAndReduceShapes(l.shape,i),f=w.sizeFromShape(c),d=w.makeZerosTypedArray(f,"int32"),m=w.sizeFromShape(p),h=r.data.get(l.dataId).values;for(let x=0;x<d.length;++x){let g=x*m,y=h[g],b=0;for(let v=0;v<m;++v){let C=h[g+v];C>y&&(y=C,b=v)}d[x]=b}return u.forEach(x=>r.disposeIntermediateTensorInfo(x)),r.makeTensorInfo(c,"int32",d)}var d4={kernelName:bu,backendName:"cpu",kernelFunc:eae};function tae(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{axis:s}=n;ee(o,"argMin");let i=w.parseAxisParam(s,o.shape),a=T.getAxesPermutation(i,o.shape.length),l=o,u=[];a!=null&&(l=Yt({inputs:{x:o},backend:r,attrs:{perm:a}}),u.push(l),i=T.getInnerMostAxes(i.length,l.shape.length)),i=[i[0]],T.assertAxesAreInnerMostDims("argMin",i,l.shape.length);let[c,p]=T.computeOutAndReduceShapes(l.shape,i),f=w.sizeFromShape(c),d=w.makeZerosTypedArray(f,"int32"),m=w.sizeFromShape(p),h=r.data.get(l.dataId).values;for(let x=0;x<d.length;++x){let g=x*m,y=h[g],b=0;for(let v=0;v<m;++v){let C=h[g+v];C<y&&(y=C,b=v)}d[x]=b}return u.forEach(x=>r.disposeIntermediateTensorInfo(x)),r.makeTensorInfo(c,"int32",d)}var m4={kernelName:vu,backendName:"cpu",kernelFunc:tae};var rae=Le(Ca,t=>Math.asin(t)),h4={kernelName:Ca,backendName:"cpu",kernelFunc:rae};var nae=Le(Sa,t=>Math.asinh(t)),g4={kernelName:Sa,backendName:"cpu",kernelFunc:nae};var oae=Le(ka,t=>Math.atan(t)),x4={kernelName:ka,backendName:"cpu",kernelFunc:oae};var sae=rt((t,e)=>Math.atan2(t,e)),iae=it(Na,sae),y4={kernelName:Na,backendName:"cpu",kernelFunc:iae};var aae=Le(Ta,t=>Math.atanh(t)),b4={kernelName:Ta,backendName:"cpu",kernelFunc:aae};function Ah(t,e,r,n,o,s){let i=o.strideHeight,a=o.strideWidth,l=o.dilationHeight,u=o.dilationWidth,c=o.effectiveFilterHeight,p=o.effectiveFilterWidth,f=o.padInfo.top,d=o.padInfo.left,m=s==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,h=Ie(o.outShape,r),x=h.values,g=o.outShape[1]*o.outShape[2]*o.outShape[3],y=o.outShape[2]*o.outShape[3],b=o.outShape[3];for(let v=0;v<o.batchSize;++v){let C=v*g,S=v*n[0];for(let k=0;k<o.inChannels;++k)for(let I=0;I<o.outHeight;++I){let A=I*i-f,$=Math.max(0,A),O=Math.min(o.inHeight,c+A),j=C+I*y;for(let H=0;H<o.outWidth;++H){let Y=H*a-d,B=Math.max(0,Y),K=Math.min(o.inWidth,p+Y),X=m,Z=0,Q=0;for(let re=$;re<O;re+=l){let ue=S+re*n[1];for(let ne=B;ne<K;ne+=u){let le=ue+ne*n[2],ae=t[le+k];s==="max"&&ae>X?X=ae:s==="avg"&&(Z+=ae,Q++)}if(isNaN(X))break}let ie=j+H*b+k;x[ie]=s==="avg"?Z/Q:X}}}return h}function hC(t,e,r,n,o=!1,s=!1){let i=Ie(n.outShape,"int32"),a=n.strideHeight,l=n.strideWidth,u=n.dilationHeight,c=n.dilationWidth,p=n.effectiveFilterHeight,f=n.effectiveFilterWidth,d=n.padInfo.top,m=n.padInfo.left,h=Ie(e,r,t);for(let x=0;x<n.batchSize;++x)for(let g=0;g<n.inChannels;++g)for(let y=0;y<n.outHeight;++y){let b=y*a-d,v=b;for(;v<0;)v+=u;let C=Math.min(n.inHeight,p+b);for(let S=0;S<n.outWidth;++S){let k=S*l-m,I=k;for(;I<0;)I+=c;let A=Math.min(n.inWidth,f+k),$=Number.NEGATIVE_INFINITY,O=-1;for(let j=v;j<C;j+=u){let H=j-b;for(let Y=I;Y<A;Y+=c){let B=Y-k,K=h.get(x,j,Y,g);K>$&&($=K,o?O=s?((x*n.inHeight+j)*n.inWidth+Y)*n.inChannels+g:(j*n.inWidth+Y)*n.inChannels+g:O=H*f+B)}}i.set(O,x,y,S,g)}}return i}function gC(t,e,r,n,o,s){let i=o.strideDepth,a=o.strideHeight,l=o.strideWidth,u=o.dilationDepth,c=o.dilationHeight,p=o.dilationWidth,f=o.effectiveFilterDepth,d=o.effectiveFilterHeight,m=o.effectiveFilterWidth,h=o.padInfo.front,x=o.padInfo.top,g=o.padInfo.left,y=s==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,b=Ie(o.outShape,r),v=b.values,C=o.outShape[1]*o.outShape[2]*o.outShape[3]*o.outShape[4],S=o.outShape[2]*o.outShape[3]*o.outShape[4],k=o.outShape[3]*o.outShape[4],I=o.outShape[4];for(let A=0;A<o.batchSize;++A){let $=A*C,O=A*n[0];for(let j=0;j<o.inChannels;++j)for(let H=0;H<o.outDepth;++H){let Y=H*i-h,B=Y;for(;B<0;)B+=u;let K=Math.min(o.inDepth,f+Y),X=$+H*S;for(let Z=0;Z<o.outHeight;++Z){let Q=Z*a-x,ie=Q;for(;ie<0;)ie+=c;let re=Math.min(o.inHeight,d+Q),ue=X+Z*k;for(let ne=0;ne<o.outWidth;++ne){let le=ne*l-g,ae=le;for(;ae<0;)ae+=p;let me=Math.min(o.inWidth,m+le),be=ue+ne*I,we=y,ke=0,He=0;for(let R=B;R<K;R+=u){let U=O+R*n[1];for(let P=ie;P<re;P+=c){let se=U+P*n[2];for(let pe=ae;pe<me;pe+=p){let fe=se+pe*n[3],Pe=t[fe+j];if(s==="max"&&Pe>we?we=Pe:s==="avg"&&(ke+=Pe,He++),isNaN(we))break}if(isNaN(we))break}if(isNaN(we))break}let We=be+j;v[We]=s==="avg"?ke/He:we}}}}return b}function v4(t,e){let r=Ie(e.outShape,"int32"),n=e.strideDepth,o=e.strideHeight,s=e.strideWidth,i=e.dilationDepth,a=e.dilationHeight,l=e.dilationWidth,u=e.effectiveFilterDepth,c=e.effectiveFilterHeight,p=e.effectiveFilterWidth,f=e.padInfo.front,d=e.padInfo.top,m=e.padInfo.left;for(let h=0;h<e.batchSize;++h)for(let x=0;x<e.inChannels;++x)for(let g=0;g<e.outDepth;++g){let y=g*n-f,b=y;for(;b<0;)b+=i;let v=Math.min(e.inDepth,u+y);for(let C=0;C<e.outHeight;++C){let S=C*o-d,k=S;for(;k<0;)k+=a;let I=Math.min(e.inHeight,c+S);for(let A=0;A<e.outWidth;++A){let $=A*s-m,O=$;for(;O<0;)O+=l;let j=Math.min(e.inWidth,p+$),H=Number.NEGATIVE_INFINITY,Y=-1;for(let B=b;B<v;B+=i){let K=B-y;for(let X=k;X<I;X+=a){let Z=X-S;for(let Q=O;Q<j;Q+=l){let ie=Q-$,re=t.get(h,B,X,Q,x);re>=H&&(H=re,Y=K*c*p+Z*c+ie)}}}r.set(Y,h,g,C,A,x)}}}return r}function lae(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e;ee(o,"avgPool");let{filterSize:s,strides:i,pad:a,dimRoundingMode:l}=n,u=1;w.assert(T.eitherStridesOrDilationsAreOne(i,u),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);let c=T.computePool2DInfo(o.shape,s,i,u,a,l),p;if(c.filterWidth===1&&c.filterHeight===1&&w.arraysEqual(c.inShape,c.outShape))p=wn({inputs:{x:o},backend:r});else{let f=r.data.get(o.dataId).values,d=w.computeStrides(o.shape),m=Ah(f,o.shape,o.dtype,d,c,"avg");p=r.makeTensorInfo(c.outShape,o.dtype,m.values)}return p}var w4={kernelName:wu,backendName:"cpu",kernelFunc:lae};function uae(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{filterSize:s,strides:i,pad:a,dimRoundingMode:l,dataFormat:u}=n;ee(o,"avgPool3d");let c=T.computePool3DInfo(o.shape,s,i,1,a,l,u),p=r.data.get(o.dataId).values,f=gC(p,o.shape,o.dtype,w.computeStrides(o.shape),c,"avg");return r.makeTensorInfo(f.shape,"float32",f.values)}var C4={kernelName:Cu,backendName:"cpu",kernelFunc:uae};function cae(t){let{inputs:e,backend:r,attrs:n}=t,{dy:o,input:s}=e,{filterSize:i,strides:a,pad:l,dimRoundingMode:u}=n;ee([o,s],"avgPool3DGrad");let c=T.computePool3DInfo(s.shape,i,a,1,l,u),p=c.strideDepth,f=c.strideHeight,d=c.strideWidth,m=c.filterDepth,h=c.filterHeight,x=c.filterWidth,g=c.dilationDepth,y=c.dilationHeight,b=c.dilationWidth,v=c.effectiveFilterDepth,C=c.effectiveFilterHeight,S=c.effectiveFilterWidth,k=v-1-c.padInfo.front,I=S-1-c.padInfo.left,A=C-1-c.padInfo.top,$=Ie(s.shape,"float32"),O=1/(m*h*x),j=r.bufferSync(o);for(let H=0;H<c.batchSize;++H)for(let Y=0;Y<c.inChannels;++Y)for(let B=0;B<c.inDepth;++B)for(let K=0;K<c.inHeight;++K)for(let X=0;X<c.inWidth;++X){let Z=B-k,Q=K-A,ie=X-I,re=0;for(let ue=0;ue<v;ue+=g){let ne=(Z+ue)/p;if(!(ne<0||ne>=c.outDepth||Math.floor(ne)!==ne))for(let le=0;le<C;le+=y){let ae=(Q+le)/f;if(!(ae<0||ae>=c.outHeight||Math.floor(ae)!==ae))for(let me=0;me<S;me+=b){let be=(ie+me)/d;if(be<0||be>=c.outWidth||Math.floor(be)!==be)continue;let we=j.get(H,ne,ae,be,Y);re+=we}}}$.set(re*O,H,B,K,X,Y)}return r.makeTensorInfo($.shape,$.dtype,$.values)}var S4={kernelName:Bd,backendName:"cpu",kernelFunc:cae};function pae(t){let{inputs:e,backend:r,attrs:n}=t,{dy:o,input:s}=e,i=s;ee([o,s],"avgPoolGrad");let{filterSize:a,strides:l,pad:u}=n,c=T.computePool2DInfo(i.shape,a,l,1,u),p=c.strideHeight,f=c.strideWidth,d=c.filterHeight,m=c.filterWidth,h=c.dilationHeight,x=c.dilationWidth,g=c.effectiveFilterHeight,y=c.effectiveFilterWidth,b=y-1-c.padInfo.left,v=g-1-c.padInfo.top,C=Ie(i.shape,"float32"),S=1/(d*m),k=r.data.get(o.dataId).values,I=Ie(o.shape,"float32",k);for(let A=0;A<c.batchSize;++A)for(let $=0;$<c.inChannels;++$)for(let O=0;O<c.inHeight;++O)for(let j=0;j<c.inWidth;++j){let H=O-v,Y=j-b,B=0;for(let K=0;K<g;K+=h){let X=(H+K)/p;if(!(X<0||X>=c.outHeight||Math.floor(X)!==X))for(let Z=0;Z<y;Z+=x){let Q=(Y+Z)/f;if(Q<0||Q>=c.outWidth||Math.floor(Q)!==Q)continue;let ie=I.get(A,X,Q,$);B+=ie}}C.set(B*S,A,O,j,$)}return r.makeTensorInfo(C.shape,C.dtype,C.values)}var k4={kernelName:zd,backendName:"cpu",kernelFunc:pae};function fae(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,scale:s,offset:i,mean:a,variance:l}=e;w.assert(a.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),w.assert(i==null||a.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),w.assert(s==null||a.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),ee([o,a,l,s,i],"batchNorm");let{varianceEpsilon:u}=n;u==null&&(u=.001);let c=r.data.get(o.dataId).values,p=r.data.get(a.dataId).values,f=r.data.get(l.dataId).values,d=s?r.data.get(s.dataId).values:new Float32Array([1]),m=i?r.data.get(i.dataId).values:new Float32Array([0]),h=new Float32Array(c.length),x=m.length,g=d.length,y=f.length,b=p.length,v=0,C=0,S=0,k=0;for(let I=0;I<c.length;++I)h[I]=m[v++]+(c[I]-p[C++])*d[S++]/Math.sqrt(f[k++]+u),v>=x&&(v=0),C>=b&&(C=0),S>=g&&(S=0),k>=y&&(k=0);return r.makeTensorInfo(o.shape,o.dtype,h)}var T4={kernelName:Ou,backendName:"cpu",kernelFunc:fae};function dae(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{blockShape:s,crops:i}=n;ee([o],"batchToSpaceND");let a=s.reduce((g,y)=>g*y),l=T.getReshaped(o.shape,s,a),u=T.getPermuted(l.length,s.length),c=T.getReshapedPermuted(o.shape,s,a),p=T.getSliceBeginCoords(i,s.length),f=T.getSliceSize(c,i,s.length),d=et({inputs:{x:o},backend:r,attrs:{shape:l}}),m=Yt({inputs:{x:d},backend:r,attrs:{perm:u}}),h=et({inputs:{x:m},backend:r,attrs:{shape:c}}),x=Ps({inputs:{x:h},backend:r,attrs:{begin:p,size:f}});return r.disposeIntermediateTensorInfo(d),r.disposeIntermediateTensorInfo(m),r.disposeIntermediateTensorInfo(h),x}var N4={kernelName:ku,backendName:"cpu",kernelFunc:dae};function mae(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,weights:s}=e,{size:i}=n,a=r.data.get(o.dataId).values,l=r.data.get(s.dataId).values,u=Nh(a,l,s.dtype,s.shape,i);return r.makeTensorInfo([i],s.dtype,u)}var I4={kernelName:Vd,backendName:"cpu",kernelFunc:mae};function hae(t){let{inputs:e,backend:r}=t,{s0:n,s1:o}=e,s=r.data.get(n.dataId).values,i=r.data.get(o.dataId).values,a=T.assertAndGetBroadcastShape(Array.from(s),Array.from(i));return r.makeTensorInfo([a.length],"int32",Int32Array.from(a))}var E4={kernelName:Lv,backendName:"cpu",kernelFunc:hae};var gae=Le(Ea,(t,e)=>{let r=e;return t>r.clipValueMax?r.clipValueMax:t<r.clipValueMin?r.clipValueMin:t}),_4={kernelName:Ea,backendName:"cpu",kernelFunc:gae};var xae=t=>{let{x:e}=t.inputs,r=t.backend,n=new Float32Array(w.sizeFromShape(e.shape)),o=r.data.get(e.dataId),s=o.complexTensorInfos.real,i=o.complexTensorInfos.imag,a=r.data.get(s.dataId).values,l=r.data.get(i.dataId).values;for(let u=0;u<a.length;u++){let c=a[u],p=l[u];n[u]=Math.hypot(c,p)}return r.makeOutput(n,e.shape,"float32")},A4={kernelName:Tu,backendName:"cpu",kernelFunc:xae};function Zi(t){let{inputs:e,backend:r}=t,{input:n}=e,o=r.data.get(n.dataId).complexTensorInfos.imag,s=r.data.get(o.dataId).values;return r.makeTensorInfo(o.shape,o.dtype,s)}var D4={kernelName:om,backendName:"cpu",kernelFunc:Zi};function Ec(t){let{inputs:e,backend:r,attrs:n}=t,{axis:o}=n,s=w.parseAxisParam(o,e[0].shape)[0],i=e.map(h=>h.shape);T.assertParamsConsistent(i,s);let a=T.computeOutShape(e.map(h=>h.shape),s);if(w.sizeFromShape(a)===0)return r.makeTensorInfo(a,e[0].dtype,[]);let l=e.filter(h=>w.sizeFromShape(h.shape)>0);if(l.length===1)return wn({inputs:{x:l[0]},backend:r});if(l[0].dtype==="complex64"){let h=l.map(v=>$s({inputs:{input:v},backend:r})),x=l.map(v=>Zi({inputs:{input:v},backend:r})),g=Ec({inputs:h,backend:r,attrs:{axis:s}}),y=Ec({inputs:x,backend:r,attrs:{axis:s}}),b=zr({inputs:{real:g,imag:y},backend:r});return h.forEach(v=>r.disposeIntermediateTensorInfo(v)),x.forEach(v=>r.disposeIntermediateTensorInfo(v)),r.disposeIntermediateTensorInfo(g),r.disposeIntermediateTensorInfo(y),b}let u=l.map(h=>{let g=[-1,w.sizeFromShape(h.shape.slice(s))];return et({inputs:{x:h},backend:r,attrs:{shape:g}})}),c=u.map(h=>({vals:r.data.get(h.dataId).values,shape:h.shape}));a=T.computeOutShape(u.map(h=>h.shape),1);let p=u[0].shape[0]===1,f=Qw(c,a,e[0].dtype,p),d=T.computeOutShape(l.map(h=>h.shape),s),m=r.makeTensorInfo(d,e[0].dtype,f);return u.forEach(h=>r.disposeIntermediateTensorInfo(h)),m}var $4={kernelName:Nu,backendName:"cpu",kernelFunc:Ec};function E_(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,filter:s}=e,{strides:i,pad:a,dataFormat:l,dilations:u,dimRoundingMode:c}=n;ee([o,s],"conv2d");let p=T.convertConv2DDataFormat(l),f=T.computeConv2DInfo(o.shape,s.shape,i,u,a,c,!1,p),d=f.filterHeight,m=f.filterWidth,h=f.dilationHeight,x=f.dilationWidth,g=f.padInfo.left,y=f.padInfo.top,b=f.dataFormat==="channelsLast",v=new bt(f.outShape,o.dtype),C=w.computeStrides(o.shape),S=w.computeStrides(s.shape),k=C[0],I=b?C[1]:C[2],A=b?C[2]:1,$=b?1:C[1],O=v.strides[0],j=b?v.strides[1]:v.strides[2],H=b?v.strides[2]:1,Y=b?1:v.strides[1],B=r.data.get(o.dataId).values,K=r.data.get(s.dataId).values,X=v.values;for(let Z=0;Z<f.batchSize;++Z){let Q=Z*k,ie=Z*O;for(let re=0;re<f.outHeight;++re){let ue=ie+re*j,ne=re*f.strideHeight-y;for(let le=0;le<d;++le){let ae=ne+le*h;if(ae<0||ae>=f.inHeight)continue;let me=le*S[0],be=Q+ae*I;for(let we=0;we<f.outWidth;++we){let ke=ue+we*H,He=we*f.strideWidth-g;for(let We=0;We<m;++We){let R=He+We*x;if(R<0||R>=f.inWidth)continue;let U=me+We*S[1],P=be+R*A,se=U;for(let pe=0;pe<f.inChannels;++pe){let fe=B[P+pe*$];for(let Pe=0;Pe<f.outChannels;++Pe)X[ke+Pe*Y]+=fe*K[se+Pe];se+=f.outChannels}}}}}}return r.makeTensorInfo(v.shape,v.dtype,X)}var R4={kernelName:Iu,backendName:"cpu",kernelFunc:E_};function yae(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,dy:s}=e,{strides:i,pad:a,dataFormat:l,dimRoundingMode:u,filterShape:c}=n;ee([o,s],"conv2dBackpropFilter");let p=T.convertConv2DDataFormat(l),f=T.computeConv2DInfo(o.shape,c,i,1,a,u,!1,p),{strideHeight:d,strideWidth:m,filterHeight:h,filterWidth:x}=f,g=f.dataFormat==="channelsLast",y=new bt(f.filterShape,"float32"),b=f.padInfo.left,v=f.padInfo.top,C=r.data.get(o.dataId).values,S=r.data.get(s.dataId).values,k=new bt(o.shape,o.dtype,C),I=new bt(s.shape,s.dtype,S);for(let A=0;A<h;++A){let $=Math.max(0,Math.ceil((v-A)/d)),O=Math.min(f.outHeight,(f.inHeight+v-A)/d);for(let j=0;j<x;++j){let H=Math.max(0,Math.ceil((b-j)/m)),Y=Math.min(f.outWidth,(f.inWidth+b-j)/m);for(let B=0;B<f.inChannels;++B)for(let K=0;K<f.outChannels;++K){let X=0;for(let Z=0;Z<f.batchSize;++Z)for(let Q=$;Q<O;++Q){let ie=A+Q*d-v;for(let re=H;re<Y;++re){let ue=j+re*m-b;g?X+=k.get(Z,ie,ue,B)*I.get(Z,Q,re,K):X+=k.get(Z,B,ie,ue)*I.get(Z,K,Q,re)}}y.set(X,A,j,B,K)}}}return r.makeTensorInfo(y.shape,y.dtype,y.values)}var O4={kernelName:Gd,backendName:"cpu",kernelFunc:yae};function bae(t){let{inputs:e,backend:r,attrs:n}=t,{dy:o,filter:s}=e,{inputShape:i,strides:a,pad:l,dataFormat:u,dimRoundingMode:c}=n;ee([o,s],"conv2dBackpropInput");let p=w.computeStrides(s.shape),f=w.computeStrides(o.shape),d=T.convertConv2DDataFormat(u),m=T.computeConv2DInfo(i,s.shape,a,1,l,c,!1,d),h=new bt(m.inShape,"float32"),x=h.values,g=r.data.get(o.dataId).values,y=r.data.get(s.dataId).values,[b,v,C]=p,{batchSize:S,filterHeight:k,filterWidth:I,inChannels:A,inHeight:$,inWidth:O,outChannels:j,outHeight:H,outWidth:Y,strideHeight:B,strideWidth:K}=m;d=m.dataFormat;let X=k-1-m.padInfo.top,Z=I-1-m.padInfo.left,Q=d==="channelsLast",ie=h.strides[0],re=Q?h.strides[1]:h.strides[2],ue=Q?h.strides[2]:1,ne=Q?1:h.strides[1],le=f[0],ae=Q?f[1]:f[2],me=Q?f[2]:1,be=Q?1:f[1];for(let we=0;we<S;++we)for(let ke=0;ke<A;++ke)for(let He=0;He<$;++He){let We=He-X,R=Math.max(0,Math.ceil(We/B)),U=Math.min(H,(k+We)/B);for(let P=0;P<O;++P){let se=P-Z,pe=Math.max(0,Math.ceil(se/K)),fe=Math.min(Y,(I+se)/K),Pe=0;for(let Ge=R;Ge<U;++Ge){let $t=Ge*B-We;for(let hr=pe;hr<fe;++hr){let mt=hr*K-se,ge=le*we+ae*Ge+me*hr,pt=b*(k-1-$t)+v*(I-1-mt)+C*ke;for(let ht=0;ht<j;++ht){let bo=g[ge+be*ht],_r=y[pt+ht];Pe+=bo*_r}}}let Be=ie*we+re*He+ue*P+ne*ke;x[Be]=Pe}}return r.makeTensorInfo(h.shape,h.dtype,h.values)}var F4={kernelName:Eu,backendName:"cpu",kernelFunc:bae};function vae(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,filter:s}=e,{strides:i,pad:a,dilations:l}=n;ee([o,s],"conv3d");let u=T.computeConv3DInfo(o.shape,s.shape,i,l,a),{filterDepth:c,filterHeight:p,filterWidth:f,dilationDepth:d,dilationHeight:m,dilationWidth:h,padInfo:x}=u,g=x.front,y=x.left,b=x.top,v=new bt(u.outShape,o.dtype),C=r.data.get(o.dataId).values,S=r.data.get(s.dataId).values,k=v.values,I=w.computeStrides(o.shape),A=w.computeStrides(s.shape);for(let $=0;$<u.batchSize;++$){let O=$*I[0],j=$*v.strides[0];for(let H=0;H<u.outDepth;++H){let Y=j+H*v.strides[1],B=H*u.strideDepth-g;for(let K=0;K<c;++K){let X=B+K*d;if(X<0||X>=u.inDepth)continue;let Z=K*A[0],Q=O+X*I[1];for(let ie=0;ie<u.outHeight;++ie){let re=Y+ie*v.strides[2],ue=ie*u.strideHeight-b;for(let ne=0;ne<p;++ne){let le=ue+ne*m;if(le<0||le>=u.inHeight)continue;let ae=Z+ne*A[1],me=Q+le*I[2];for(let be=0;be<u.outWidth;++be){let we=re+be*u.outChannels,ke=be*u.strideWidth-y;for(let He=0;He<f;++He){let We=ke+He*h;if(We<0||We>=u.inWidth)continue;let R=ae+He*A[2],U=me+We*u.inChannels,P=R;for(let se=0;se<u.inChannels;++se){let pe=C[U+se];for(let fe=0;fe<u.outChannels;++fe)k[we+fe]+=pe*S[P+fe];P+=u.outChannels}}}}}}}}return r.makeTensorInfo(v.shape,v.dtype,v.values)}var P4={kernelName:_u,backendName:"cpu",kernelFunc:vae};function wae(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,dy:s}=e,{strides:i,pad:a,filterShape:l}=n;ee([o,s],"conv3dBackpropFilterV2");let u=w.computeStrides(o.shape),c=w.computeStrides(s.shape),p=T.computeConv3DInfo(o.shape,l,i,1,a),f=p.strideDepth,d=p.strideHeight,m=p.strideWidth,h=p.filterDepth,x=p.filterHeight,g=p.filterWidth,y=new bt(p.filterShape,"float32"),b=y.values,[v,C,S,k]=y.strides,I=r.data.get(s.dataId).values,[A,$,O,j]=c,H=r.data.get(o.dataId).values,[Y,B,K,X]=u,Z=p.padInfo.front,Q=p.padInfo.left,ie=p.padInfo.top;for(let re=0;re<h;++re){let ue=Math.max(0,Math.ceil((Z-re)/f)),ne=Math.min(p.outDepth,(p.inDepth+Z-re)/f),le=re*v;for(let ae=0;ae<x;++ae){let me=Math.max(0,Math.ceil((ie-ae)/d)),be=Math.min(p.outHeight,(p.inHeight+ie-ae)/d),we=ae*C+le;for(let ke=0;ke<g;++ke){let He=Math.max(0,Math.ceil((Q-ke)/m)),We=Math.min(p.outWidth,(p.inWidth+Q-ke)/m),R=ke*S+we;for(let U=0;U<p.inChannels;++U){let P=U*k+R;for(let se=0;se<p.outChannels;++se){let pe=0;for(let fe=0;fe<p.batchSize;++fe){let Pe=fe*Y,Be=fe*A;for(let Ge=ue;Ge<ne;++Ge){let hr=(re+Ge*f-Z)*B+Pe,mt=Ge*$+Be;for(let ge=me;ge<be;++ge){let ht=(ae+ge*d-ie)*K+hr,bo=ge*O+mt;for(let _r=He;_r<We;++_r){let Cp=(ke+_r*m-Q)*X+ht,ti=_r*j+bo;pe+=H[Cp+U]*I[ti+se]}}}}b[P+se]=pe}}}}}return r.makeTensorInfo(y.shape,y.dtype,y.values)}var L4={kernelName:Ud,backendName:"cpu",kernelFunc:wae};function Cae(t){let{inputs:e,backend:r,attrs:n}=t,{dy:o,filter:s}=e,{pad:i,strides:a,inputShape:l}=n;ee([o],"conv3dBackpropInputV2");let u=w.computeStrides(o.shape),c=w.computeStrides(s.shape),p=T.computeConv3DInfo(l,s.shape,a,1,i),f=new bt(p.inShape,"float32"),d=f.values,[m,h,x,g]=f.strides,y=r.data.get(o.dataId).values,[b,v,C,S]=u,k=r.data.get(s.dataId).values,[I,A,$,O]=c,{batchSize:j,filterDepth:H,filterHeight:Y,filterWidth:B,inChannels:K,inDepth:X,inHeight:Z,inWidth:Q,outChannels:ie,outDepth:re,outHeight:ue,outWidth:ne,strideDepth:le,strideHeight:ae,strideWidth:me}=p,be=H-1-p.padInfo.front,we=Y-1-p.padInfo.top,ke=B-1-p.padInfo.left;for(let He=0;He<j;++He)for(let We=0;We<K;++We)for(let R=0;R<X;++R){let U=R-be,P=Math.max(0,Math.ceil(U/le)),se=Math.min(re,(H+U)/le);for(let pe=0;pe<Z;++pe){let fe=pe-we,Pe=Math.max(0,Math.ceil(fe/ae)),Be=Math.min(ue,(Y+fe)/ae);for(let Ge=0;Ge<Q;++Ge){let $t=Ge-ke,hr=Math.max(0,Math.ceil($t/me)),mt=Math.min(ne,(B+$t)/me),ge=0;for(let pt=P;pt<se;++pt){let ht=pt*le-U;for(let bo=Pe;bo<Be;++bo){let _r=bo*ae-fe;for(let ds=hr;ds<mt;++ds){let Cp=ds*me-$t,ti=b*He+v*pt+C*bo+S*ds,yI=I*(H-1-ht)+A*(Y-1-_r)+$*(B-1-Cp)+O*We;for(let Nd=0;Nd<ie;++Nd){let $v=y[ti+Nd],Id=k[yI+Nd];ge+=$v*Id}}}}d[m*He+h*R+x*pe+g*Ge+We]=ge}}}return r.makeTensorInfo(f.shape,f.dtype,f.values)}var M4={kernelName:Hd,backendName:"cpu",kernelFunc:Cae};var Sae=Le(_a,t=>Math.cos(t)),z4={kernelName:_a,backendName:"cpu",kernelFunc:Sae};var kae=Le(Aa,t=>Math.cosh(t)),B4={kernelName:Aa,backendName:"cpu",kernelFunc:kae};function Tae(t){let{inputs:e,backend:r,attrs:n}=t,{image:o,boxes:s,boxInd:i}=e,{cropSize:a,method:l,extrapolationValue:u}=n,[c,p,f,d]=o.shape,m=s.shape[0],[h,x]=a,g=Ie([m,h,x,d],"float32"),y=r.data.get(s.dataId).values,b=r.data.get(i.dataId).values,v=r.data.get(o.dataId).values,C=w.computeStrides(o.shape),S=w.computeStrides(g.shape);for(let k=0;k<m;k++){let I=k*4,A=y[I],$=y[I+1],O=y[I+2],j=y[I+3],H=b[k];if(H>=c)continue;let Y=h>1?(O-A)*(p-1)/(h-1):0,B=x>1?(j-$)*(f-1)/(x-1):0;for(let K=0;K<h;K++){let X=h>1?A*(p-1)+K*Y:.5*(A+O)*(p-1);if(X<0||X>p-1){for(let Z=0;Z<x;Z++)for(let Q=0;Q<d;Q++){let ie=Q+Z*S[2]+K*S[1]+k*S[0];g.values[ie]=u}continue}if(l==="bilinear"){let Z=Math.floor(X),Q=Math.ceil(X),ie=X-Z;for(let re=0;re<x;re++){let ue=x>1?$*(f-1)+re*B:.5*($+j)*(f-1);if(ue<0||ue>f-1){for(let me=0;me<d;me++){let be=me+re*S[2]+K*S[1]+k*S[0];g.values[be]=u}continue}let ne=Math.floor(ue),le=Math.ceil(ue),ae=ue-ne;for(let me=0;me<d;me++){let be=me+ne*C[2]+Z*C[1]+H*C[0],we=v[be];be=me+le*C[2]+Z*C[1]+H*C[0];let ke=v[be];be=me+ne*C[2]+Q*C[1]+H*C[0];let He=v[be];be=me+le*C[2]+Q*C[1]+H*C[0];let We=v[be],R=we+(ke-we)*ae,U=He+(We-He)*ae;be=me+re*S[2]+K*S[1]+k*S[0],g.values[be]=R+(U-R)*ie}}}else for(let Z=0;Z<x;++Z){let Q=x>1?$*(f-1)+Z*B:.5*($+j)*(f-1);if(Q<0||Q>f-1){for(let ue=0;ue<d;ue++){let ne=ue+Z*S[2]+K*S[1]+k*S[0];g.values[ne]=u}continue}let ie=Math.round(Q),re=Math.round(X);for(let ue=0;ue<d;ue++){let ne=ue+ie*C[2]+re*C[1]+H*C[0],le=ue+Z*S[2]+K*S[1]+k*S[0];g.values[le]=v[ne]}}}}return r.makeTensorInfo(g.shape,g.dtype,g.values)}var V4={kernelName:jd,backendName:"cpu",kernelFunc:Tae};function Nae(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{axis:s,exclusive:i,reverse:a}=n;ee(o,"cumprod");let l=T.getAxesPermutation([s],o.shape.length),u=o;l!=null&&(u=Yt({inputs:{x:o},backend:r,attrs:{perm:l}}));let c=T.getInnerMostAxes(1,o.shape.length)[0];if(c!==u.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${c}`);let p=wr(u.dtype,"int32"),f=w.makeOnesTypedArray(w.sizeFromShape(u.shape),p),d=r.data.get(u.dataId).values,m=u.shape[u.shape.length-1],h=a?(g,y)=>g+m-y-1:(g,y)=>g+y;for(let g=0;g<d.length;g+=m)for(let y=0;y<m;y++){let b=h(g,y);if(y===0)f[b]=i?1:d[b];else{let v=h(g,y-1);f[b]=i?d[v]*f[v]:d[b]*f[v]}}let x=r.makeTensorInfo(u.shape,p,f);if(l!=null){let g=T.getUndoAxesPermutation(l),y=Yt({inputs:{x},backend:r,attrs:{perm:g}});return r.disposeIntermediateTensorInfo(x),r.disposeIntermediateTensorInfo(u),y}return x}var W4={kernelName:qd,backendName:"cpu",kernelFunc:Nae};function Iae(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{axis:s,exclusive:i,reverse:a}=n;ee(o,"cumsum");let l=T.getAxesPermutation([s],o.shape.length),u=o;l!=null&&(u=Yt({inputs:{x:o},backend:r,attrs:{perm:l}}));let c=T.getInnerMostAxes(1,o.shape.length)[0];if(c!==u.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${c}`);let p=wr(u.dtype,"int32"),f=w.makeZerosTypedArray(w.sizeFromShape(u.shape),p),d=r.data.get(u.dataId).values,m=u.shape[u.shape.length-1],h=a?(g,y)=>g+m-y-1:(g,y)=>g+y;for(let g=0;g<d.length;g+=m)for(let y=0;y<m;y++){let b=h(g,y);if(y===0)f[b]=i?0:d[b];else{let v=h(g,y-1);f[b]=i?d[v]+f[v]:d[b]+f[v]}}let x=r.makeTensorInfo(u.shape,p,f);if(l!=null){let g=T.getUndoAxesPermutation(l),y=Yt({inputs:{x},backend:r,attrs:{perm:g}});return r.disposeIntermediateTensorInfo(x),r.disposeIntermediateTensorInfo(u),y}return x}var G4={kernelName:Au,backendName:"cpu",kernelFunc:Iae};function Eae(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,weights:s}=e,{size:i,binaryOutput:a}=n;if(o.shape.length===1){let l=r.data.get(o.dataId).values,u=r.data.get(s.dataId).values,c=Nh(l,u,s.dtype,s.shape,i);return r.makeTensorInfo([i],s.dtype,c)}else if(o.shape.length===2){let l=r.bufferSync(o),u=r.bufferSync(s),c=Yw(l,u,i,a);return r.makeTensorInfo(c.shape,s.dtype,c.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${o.shape.length}.`)}var U4={kernelName:Kd,backendName:"cpu",kernelFunc:Eae};function _ae(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{blockSize:s,dataFormat:i}=n;w.assert(i==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${i}`);let a=o.shape[0],l=o.shape[1],u=o.shape[2],c=o.shape[3],p=l*s,f=u*s,d=c/(s*s),m=r.data.get(o.dataId).values,h=new Float32Array(a*p*f*d),x=0;for(let g=0;g<a;++g)for(let y=0;y<p;++y){let b=Math.floor(y/s),v=y%s;for(let C=0;C<f;++C){let S=Math.floor(C/s),k=C%s,I=(v*s+k)*d;for(let A=0;A<d;++A){let O=A+I+c*(S+u*(b+l*g));h[x++]=m[O]}}}return r.makeTensorInfo([a,p,f,d],o.dtype,h)}var H4={kernelName:Xd,backendName:"cpu",kernelFunc:_ae};function __(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,filter:s}=e,{strides:i,pad:a,dilations:l,dimRoundingMode:u}=n;ee([o,s],"depthwiseConv2DNative");let c=w.computeStrides(o.shape),p=w.computeStrides(s.shape),f=l;f==null&&(f=[1,1]),w.assert(T.eitherStridesOrDilationsAreOne(i,f),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${f}'`);let d=T.computeConv2DInfo(o.shape,s.shape,i,f,a,u,!0),{filterHeight:m,filterWidth:h,dilationHeight:x,dilationWidth:g,padInfo:y}=d,b=y.left,v=y.top,C=d.outChannels/d.inChannels,S=new bt(d.outShape,o.dtype),k=r.data.get(o.dataId).values,I=r.data.get(s.dataId).values,A=S.values;for(let $=0;$<d.batchSize;++$){let O=$*c[0],j=$*S.strides[0];for(let H=0;H<d.outHeight;++H){let Y=j+H*S.strides[1],B=H*d.strideHeight-v;for(let K=0;K<m;++K){let X=B+K*x;if(X<0||X>=d.inHeight)continue;let Z=K*p[0],Q=O+X*c[1];for(let ie=0;ie<d.outWidth;++ie){let re=Y+ie*S.strides[2],ue=ie*d.strideWidth-b;for(let ne=0;ne<h;++ne){let le=ue+ne*g;if(le<0||le>=d.inWidth)continue;let ae=Z+ne*p[1],me=Q+le*d.inChannels,be=re,we=ae;for(let ke=0;ke<d.inChannels;++ke){let He=k[me+ke];for(let We=0;We<C;++We)A[be+We]+=He*I[we+We];be+=C,we+=C}}}}}}return r.makeTensorInfo(S.shape,S.dtype,S.values)}var q4={kernelName:Du,backendName:"cpu",kernelFunc:__};function Aae(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,dy:s}=e,{strides:i,dilations:a,pad:l,dimRoundingMode:u,filterShape:c}=n;ee([o,s],"depthwiseConv2dNativeBackpropFilter");let p=T.computeConv2DInfo(o.shape,c,i,a,l,u,!0),{strideHeight:f,strideWidth:d,filterHeight:m,filterWidth:h}=p,x=new bt(p.filterShape,"float32"),g=p.padInfo.left,y=p.padInfo.top,b=p.outChannels/p.inChannels,v=r.data.get(o.dataId).values,C=new bt(o.shape,o.dtype,v),S=r.data.get(s.dataId).values,k=new bt(s.shape,s.dtype,S);for(let I=0;I<m;++I){let A=Math.max(0,Math.ceil((y-I)/f)),$=Math.min(p.outHeight,(p.inHeight+y-I)/f);for(let O=0;O<h;++O){let j=Math.max(0,Math.ceil((g-O)/d)),H=Math.min(p.outWidth,(p.inWidth+g-O)/d);for(let Y=0;Y<p.outChannels;++Y){let B=Math.trunc(Y/b),K=Y%b,X=0;for(let Z=0;Z<p.batchSize;++Z)for(let Q=A;Q<$;++Q){let ie=I+Q*f-y;for(let re=j;re<H;++re){let ue=O+re*d-g;X+=C.get(Z,ie,ue,B)*k.get(Z,Q,re,Y)}}x.set(X,I,O,B,K)}}}return r.makeTensorInfo(x.shape,x.dtype,x.values)}var j4={kernelName:Yd,backendName:"cpu",kernelFunc:Aae};function Dae(t){let{inputs:e,backend:r,attrs:n}=t,{dy:o,filter:s}=e,{strides:i,dilations:a,pad:l,dimRoundingMode:u,inputShape:c}=n;ee([o,s],"depthwiseConv2DNativeBackpropInput");let p=w.computeStrides(o.shape),f=w.computeStrides(s.shape),d=T.computeConv2DInfo(c,s.shape,i,a,l,u,!0),m=new bt(d.inShape,"float32"),h=m.values,[x,g,y]=m.strides,b=r.data.get(o.dataId).values,[v,C,S]=p,k=r.data.get(s.dataId).values,[I,A,$]=f,{batchSize:O,filterHeight:j,filterWidth:H,inChannels:Y,inHeight:B,inWidth:K,outChannels:X,outHeight:Z,outWidth:Q,strideHeight:ie,strideWidth:re}=d,ue=j-1-d.padInfo.top,ne=H-1-d.padInfo.left,le=X/Y;for(let ae=0;ae<O;++ae)for(let me=0;me<Y;++me)for(let be=0;be<B;++be){let we=be-ue,ke=Math.max(0,Math.ceil(we/ie)),He=Math.min(Z,(j+we)/ie);for(let We=0;We<K;++We){let R=We-ne,U=Math.max(0,Math.ceil(R/re)),P=Math.min(Q,(H+R)/re),se=0;for(let pe=ke;pe<He;++pe){let fe=pe*ie-we;for(let Pe=U;Pe<P;++Pe){let Be=Pe*re-R,Ge=v*ae+C*pe+S*Pe,$t=I*(j-1-fe)+A*(H-1-Be)+$*me;for(let hr=0;hr<le;++hr){let mt=me*le+hr,ge=b[Ge+mt],pt=k[$t+hr];se+=ge*pt}}}h[x*ae+g*be+y*We+me]=se}}return r.makeTensorInfo(m.shape,m.dtype,m.values)}var K4={kernelName:Qd,backendName:"cpu",kernelFunc:Dae};function $ae(t){let{inputs:e,backend:r}=t,{x:n}=e,o=w.sizeFromShape(n.shape),s=r.data.get(n.dataId).values,i=Ie([o,o],n.dtype),a=i.values;for(let u=0;u<s.length;u++)a[u*o+u]=s[u];let l=[...n.shape,...n.shape];return r.makeTensorInfo(l,i.dtype,i.values)}var X4={kernelName:Mv,backendName:"cpu",kernelFunc:$ae};var Y4={kernelName:$u,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:r})=>{let{x:n,filter:o}=t,{strides:s,pad:i,dilations:a}=r,l=e,u=l.data.get(n.dataId).values,c=n.shape.length,p=l.data.get(o.dataId).values,f=o.shape.length,{batchSize:d,inHeight:m,inWidth:h,inChannels:x,outHeight:g,outWidth:y,padInfo:b,strideHeight:v,strideWidth:C,filterHeight:S,filterWidth:k,dilationHeight:I,dilationWidth:A,outShape:$}=T.computeDilation2DInfo(n.shape,o.shape,s,i,"NHWC",a),O=w.sizeFromShape($),j=$.length,H=w.getArrayFromDType(n.dtype,O);for(let B=0;B<d;++B)for(let K=0;K<g;++K){let X=K*v-b.top;for(let Z=0;Z<y;++Z){let Q=Z*C-b.left;for(let ie=0;ie<x;++ie){let re=Number.MIN_SAFE_INTEGER;for(let ne=0;ne<S;++ne){let le=X+ne*I;if(le>=0&&le<m)for(let ae=0;ae<k;++ae){let me=Q+ae*A;if(me>=0&&me<h){let be=w.locToIndex([B,le,me,ie],c,w.computeStrides(n.shape)),we=w.locToIndex([ne,ae,ie],f,w.computeStrides(o.shape)),ke=u[be]+p[we];ke>re&&(re=ke)}}}let ue=w.locToIndex([B,K,Z,ie],j,w.computeStrides($));H[ue]=re}}}return{dataId:l.write(w.toTypedArray(H,n.dtype),$,n.dtype),shape:$,dtype:n.dtype}}};var Q4={kernelName:xx,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:r})=>{let{x:n,filter:o,dy:s}=t,{strides:i,pad:a,dilations:l}=r,u=e,c=w.toNestedArray(n.shape,u.data.get(n.dataId).values),p=w.toNestedArray(o.shape,u.data.get(o.dataId).values),{batchSize:f,inHeight:d,inWidth:m,inChannels:h,outHeight:x,outWidth:g,padInfo:y,strideHeight:b,strideWidth:v,filterHeight:C,filterWidth:S,dilationHeight:k,dilationWidth:I,outShape:A}=T.computeDilation2DInfo(n.shape,o.shape,i,a,"NHWC",l);w.assert(s.rank===A.length,()=>`Error in ${xx}, dy must have the same rank as output ${A.length}, but got ${s.rank}`);let $=w.toNestedArray(A,u.data.get(s.dataId).values),O=w.makeZerosNestedTypedArray(o.shape,o.dtype);for(let H=0;H<f;++H)for(let Y=0;Y<x;++Y){let B=Y*b-y.top;for(let K=0;K<g;++K){let X=K*v-y.left;for(let Z=0;Z<h;++Z){let Q=Number.MIN_SAFE_INTEGER,ie=0,re=0;for(let ue=0;ue<C;++ue){let ne=B+ue*k;if(ne>=0&&ne<d)for(let le=0;le<S;++le){let ae=X+le*I;if(ae>=0&&ae<m){let me=c[H][ne][ae][Z]+p[ue][le][Z];me>Q&&(Q=me,ie=ue,re=le)}}}O[ie][re][Z]+=$[H][Y][K][Z]}}}return{dataId:u.write(w.toTypedArray(O,n.dtype),o.shape,o.dtype),shape:o.shape,dtype:o.dtype}}};var Z4={kernelName:gx,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:r})=>{let{x:n,filter:o,dy:s}=t,{strides:i,pad:a,dilations:l}=r,u=e,c=w.toNestedArray(n.shape,u.data.get(n.dataId).values),p=w.toNestedArray(o.shape,u.data.get(o.dataId).values),{batchSize:f,inHeight:d,inWidth:m,inChannels:h,outHeight:x,outWidth:g,padInfo:y,strideHeight:b,strideWidth:v,filterHeight:C,filterWidth:S,dilationHeight:k,dilationWidth:I,outShape:A}=T.computeDilation2DInfo(n.shape,o.shape,i,a,"NHWC",l);w.assert(s.rank===A.length,()=>`Error in ${gx}, dy must have the same rank as output ${A.length}, but got ${s.rank}`);let $=w.toNestedArray(A,u.data.get(s.dataId).values),O=w.makeZerosNestedTypedArray(n.shape,n.dtype);for(let H=0;H<f;++H)for(let Y=0;Y<x;++Y){let B=Y*b-y.top;for(let K=0;K<g;++K){let X=K*v-y.left;for(let Z=0;Z<h;++Z){let Q=Number.MIN_SAFE_INTEGER,ie=B<0?0:B,re=X<0?0:X;for(let ue=0;ue<C;++ue){let ne=B+ue*k;if(ne>=0&&ne<d)for(let le=0;le<S;++le){let ae=X+le*I;if(ae>=0&&ae<m){let me=c[H][ne][ae][Z]+p[ue][le][Z];me>Q&&(Q=me,ie=ne,re=ae)}}}O[H][ie][re][Z]+=$[H][Y][K][Z]}}}return{dataId:u.write(w.toTypedArray(O,n.dtype),n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}};function Ol(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{axis:s,keepDims:i}=n;ee(o,"sum");let a;o.dtype==="bool"?a=Rs({inputs:{x:o},backend:r,attrs:{dtype:"int32"}}):a=wn({inputs:{x:o},backend:r});let l=a.shape.length,u=w.parseAxisParam(s,a.shape),c=T.getAxesPermutation(u,l),p=u,f=a;c!=null&&(f=Yt({inputs:{x:a},backend:r,attrs:{perm:c}}),p=T.getInnerMostAxes(p.length,l)),T.assertAxesAreInnerMostDims("sum",p,f.shape.length);let[d,m]=T.computeOutAndReduceShapes(f.shape,p),h=T.upcastType(f.dtype,"int32"),x=kh(r,d,h),g=w.sizeFromShape(m),y=r.data.get(x.dataId).values,b=r.data.get(f.dataId).values;for(let v=0;v<y.length;++v){let C=v*g,S=0;for(let k=0;k<g;++k)S+=b[C+k];y[v]=S}if(i){let v=T.expandShapeToKeepDim(x.shape,u),C=x;x=et({inputs:{x},backend:r,attrs:{shape:v}}),r.disposeIntermediateTensorInfo(C)}return r.disposeIntermediateTensorInfo(a),c!=null&&r.disposeIntermediateTensorInfo(f),x}var J4={kernelName:nc,backendName:"cpu",kernelFunc:Ol};function Rae(t){let{inputs:e,backend:r,attrs:n}=t,{equation:o}=n,s=e,{allDims:i,summedDims:a,idDims:l}=T.decodeEinsumEquation(o,s.length);T.checkEinsumDimSizes(i.length,l,s);let{path:u,steps:c}=T.getEinsumComputePath(a,l),p=c.length,f=null,d=i.length,m=[];for(let h=0;h<p;++h){for(let x of c[h]){let{permutationIndices:g,expandDims:y}=T.getEinsumPermutation(d,l[x]),b;T.isIdentityPermutation(g)?b=s[x]:(b=Yt({inputs:{x:s[x]},backend:r,attrs:{perm:g}}),m.push(b));let v=b.shape.slice();for(let C=0;C<y.length;++C)v.splice(y[C],0,1);w.arraysEqual(b.shape,v)||(b=et({inputs:{x:b},backend:r,attrs:{shape:v}}),m.push(b)),f===null?f=b:(f=Tf({inputs:{a:b,b:f},backend:r}),m.push(f))}h<p-1&&(u[h]>=0&&(f=Ol({inputs:{x:f},backend:r,attrs:{axis:u[h]-(i.length-d),keepDims:!1}}),m.push(f)),d--)}for(let h of m)h!==f&&r.disposeIntermediateTensorInfo(h);return f}var eV={kernelName:Zd,backendName:"cpu",kernelFunc:Rae};function Oae(t){let{inputs:e,backend:r}=t,{dy:n,y:o}=e;ee([n,o],"eluGrad");let s=new Float32Array(w.sizeFromShape(o.shape)),i=r.data.get(o.dataId).values,a=r.data.get(n.dataId).values;for(let l=0;l<i.length;++l){let u=i[l];u>=1?s[l]=a[l]:s[l]=a[l]*(u+1)}return r.makeTensorInfo(o.shape,"float32",s)}var tV={kernelName:Jd,backendName:"cpu",kernelFunc:Oae};var Fae=T.ERF_P,Pae=T.ERF_A1,Lae=T.ERF_A2,Mae=T.ERF_A3,zae=T.ERF_A4,Bae=T.ERF_A5,Vae=Le(Ra,t=>{let e=Math.sign(t),r=Math.abs(t),n=1/(1+Fae*r);return e*(1-((((Bae*n+zae)*n+Mae)*n+Lae)*n+Pae)*n*Math.exp(-r*r))}),rV={kernelName:Ra,backendName:"cpu",kernelFunc:Vae};function Dh(t){let{inputs:e,backend:r,attrs:n}=t,{input:o}=e,{dim:s}=n,i=o.shape.length,a=o.shape.slice(),l=s;return s<0&&(w.assert(-(i+1)<=s,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),l=i+s+1),a.splice(l,0,1),et({inputs:{x:o},backend:r,attrs:{shape:a}})}var nV={kernelName:Ru,backendName:"cpu",kernelFunc:Dh};var Wae=rt((t,e)=>t/e),A0=it(Da,Wae),D0={kernelName:Da,backendName:"cpu",kernelFunc:A0};function xC(t,e,r){let n=t.shape,o=n[0],s=n[1],i=r.data.get(t.dataId),a=i.complexTensorInfos.real,l=i.complexTensorInfos.imag,u=[o,s],c=w.sizeFromShape(u),p=w.getTypedArrayFromDType("float32",c),f=w.getTypedArrayFromDType("float32",c);for(let x=0;x<o;x++){let g=Ps({inputs:{x:a},backend:r,attrs:{begin:[x,0],size:[1,s]}}),y=Ps({inputs:{x:l},backend:r,attrs:{begin:[x,0],size:[1,s]}}),b=zr({inputs:{real:g,imag:y},backend:r}),{real:v,imag:C}=Gae(b,e,r),S=T.mergeRealAndImagArrays(v,C);for(let k=0;k<s;k++){let I=T.getComplexWithIndex(S,k);p[x*s+k]=I.real,f[x*s+k]=I.imag}r.disposeIntermediateTensorInfo(g),r.disposeIntermediateTensorInfo(y),r.disposeIntermediateTensorInfo(b)}let d=r.makeTensorInfo(u,"float32",p),m=r.makeTensorInfo(u,"float32",f),h=zr({inputs:{real:d,imag:m},backend:r});return r.disposeIntermediateTensorInfo(d),r.disposeIntermediateTensorInfo(m),h}function Gae(t,e,r){let n=w.sizeFromShape(t.shape),o=r.data.get(t.dataId),s=r.data.get(o.complexTensorInfos.real.dataId).values,i=r.data.get(o.complexTensorInfos.imag.dataId).values;if(Uae(n)){let a=A_(s,i,n,e,r),l=[t.shape[0],t.shape[1]];if(e){let u=r.makeTensorInfo(l,"float32",a.real),c=r.makeTensorInfo(l,"float32",a.imag),p=r.makeTensorInfo([],"float32",w.createScalarValue(n,"float32")),f=wn({inputs:{x:p},backend:r}),d=D0.kernelFunc({inputs:{a:u,b:p},backend:r}),m=D0.kernelFunc({inputs:{a:c,b:f},backend:r}),h=r.data.get(d.dataId).values,x=r.data.get(m.dataId).values;return r.disposeIntermediateTensorInfo(u),r.disposeIntermediateTensorInfo(c),r.disposeIntermediateTensorInfo(p),r.disposeIntermediateTensorInfo(f),r.disposeIntermediateTensorInfo(d),r.disposeIntermediateTensorInfo(m),{real:h,imag:x}}return a}else{let a=T.mergeRealAndImagArrays(s,i),l=Hae(a,n,e);return T.splitRealAndImagArrays(l)}}function Uae(t){return(t&t-1)===0}function A_(t,e,r,n,o){if(r===1)return{real:t,imag:e};let s=T.mergeRealAndImagArrays(t,e),i=r/2,a=T.complexWithEvenIndex(s),l=a.real,u=a.imag,c=[l.length],p=o.makeTensorInfo(c,"float32",l),f=o.makeTensorInfo(c,"float32",u),d=zr({inputs:{real:p,imag:f},backend:o}),m=T.complexWithOddIndex(s),h=m.real,x=m.imag,g=[h.length],y=o.makeTensorInfo(g,"float32",h),b=o.makeTensorInfo(g,"float32",x),v=zr({inputs:{real:y,imag:b},backend:o}),C=A_(l,u,i,n,o),S=C.real,k=C.imag,I=[S.length],A=o.makeTensorInfo(I,"float32",S),$=o.makeTensorInfo(I,"float32",k),O=zr({inputs:{real:A,imag:$},backend:o}),j=A_(h,x,i,n,o),H=j.real,Y=j.imag,B=[H.length],K=o.makeTensorInfo(B,"float32",H),X=o.makeTensorInfo(B,"float32",Y),Z=zr({inputs:{real:K,imag:X},backend:o}),Q=T.exponents(r,n),ie=[Q.real.length],re=o.makeTensorInfo(ie,"float32",Q.real),ue=o.makeTensorInfo(ie,"float32",Q.imag),ne=zr({inputs:{real:re,imag:ue},backend:o}),le=Tf({inputs:{a:ne,b:Z},backend:o}),ae=Qi({inputs:{a:O,b:le},backend:o}),me=E0({inputs:{a:O,b:le},backend:o}),be=$s({inputs:{input:ae},backend:o}),we=$s({inputs:{input:me},backend:o}),ke=Zi({inputs:{input:ae},backend:o}),He=Zi({inputs:{input:me},backend:o}),We=Ec({inputs:[be,we],backend:o,attrs:{axis:0}}),R=Ec({inputs:[ke,He],backend:o,attrs:{axis:0}}),U=o.data.get(We.dataId).values,P=o.data.get(R.dataId).values;return o.disposeIntermediateTensorInfo(p),o.disposeIntermediateTensorInfo(f),o.disposeIntermediateTensorInfo(d),o.disposeIntermediateTensorInfo(y),o.disposeIntermediateTensorInfo(b),o.disposeIntermediateTensorInfo(v),o.disposeIntermediateTensorInfo(A),o.disposeIntermediateTensorInfo($),o.disposeIntermediateTensorInfo(O),o.disposeIntermediateTensorInfo(K),o.disposeIntermediateTensorInfo(X),o.disposeIntermediateTensorInfo(Z),o.disposeIntermediateTensorInfo(re),o.disposeIntermediateTensorInfo(ue),o.disposeIntermediateTensorInfo(ne),o.disposeIntermediateTensorInfo(le),o.disposeIntermediateTensorInfo(ae),o.disposeIntermediateTensorInfo(me),o.disposeIntermediateTensorInfo(be),o.disposeIntermediateTensorInfo(ke),o.disposeIntermediateTensorInfo(we),o.disposeIntermediateTensorInfo(He),o.disposeIntermediateTensorInfo(We),o.disposeIntermediateTensorInfo(R),{real:U,imag:P}}function Hae(t,e,r){let n=new Float32Array(e*2);for(let o=0;o<e;o++){let s=0,i=0;for(let a=0;a<e;a++){let l=T.exponent(o*a,e,r),u=T.getComplexWithIndex(t,a);s+=u.real*l.real-u.imag*l.imag,i+=u.real*l.imag+u.imag*l.real}r&&(s/=e,i/=e),T.assignToTypedArray(n,s,i,o)}return n}function qae(t){let{inputs:e,backend:r}=t,{input:n}=e,o=w.sizeFromShape(n.shape),s=n.shape[n.shape.length-1],i=o/s,a=et({inputs:{x:n},backend:r,attrs:{shape:[i,s]}}),l=xC(a,!1,r),u=et({inputs:{x:l},backend:r,attrs:{shape:n.shape}});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(l),u}var oV={kernelName:em,backendName:"cpu",kernelFunc:qae};function $0(t){let{backend:e,attrs:r}=t,{shape:n,value:o,dtype:s}=r,i=s||w.inferDtype(o),a=w.getArrayFromDType(i,w.sizeFromShape(n));return jae(a,o,i),e.makeTensorInfo(n,i,a)}var sV={kernelName:tm,backendName:"cpu",kernelFunc:$0};function jae(t,e,r){t.fill(e)}var iV={kernelName:rm,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:r})=>{let{image:n}=t,o=r,s=w.getTypedArrayFromDType(n.dtype,w.sizeFromShape(n.shape)),[i,a,l,u]=n.shape,c=o.data.get(n.dataId).values;for(let f=0;f<i;f++){let d=f*l*a*u;for(let m=0;m<a;m++){let h=m*(l*u);for(let x=0;x<l;x++){let g=x*u;for(let y=0;y<u;y++){let b=Math.round(l-x-1),v=d+h+g+y,C=c[v];if(b>=0&&b<l){let S=b*u,k=d+h+S+y;C=c[k]}s[v]=C}}}}return{dataId:o.write(s,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}};var Kae=rt((t,e)=>Math.floor(t/e)),Xae=it(La,Kae,null,"int32"),aV={kernelName:La,backendName:"cpu",kernelFunc:Xae};function Yae(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,filter:s,bias:i,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:c,dilations:p,dimRoundingMode:f,activation:d,leakyreluAlpha:m}=n,h=E_({inputs:{x:o,filter:s},backend:r,attrs:{strides:l,pad:u,dataFormat:c,dilations:p,dimRoundingMode:f}});if(i){let x=h;if(c==="NCHW"&&i.shape.length===1&&i.shape[0]!==1){let g=et({inputs:{x:i},backend:r,attrs:{shape:[i.shape[0],1,1]}});h=Qi({inputs:{a:h,b:g},backend:r}),r.disposeIntermediateTensorInfo(g)}else h=Qi({inputs:{a:h,b:i},backend:r});r.disposeIntermediateTensorInfo(x)}if(d){let x=h;if(c==="NCHW"&&d==="prelu"&&a.shape.length===1&&a.shape[0]!==1){let g=et({inputs:{x:a},backend:r,attrs:{shape:[a.shape[0],1,1]}});h=Nf(r,h,d,g,m),r.disposeIntermediateTensorInfo(g)}else h=Nf(r,h,d,a,m);r.disposeIntermediateTensorInfo(x)}return h}var lV={kernelName:Lp,backendName:"cpu",kernelFunc:Yae};function Qae(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,filter:s,bias:i,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:c,dilations:p,dimRoundingMode:f,activation:d,leakyreluAlpha:m}=n,h=__({inputs:{x:o,filter:s},backend:r,attrs:{strides:l,pad:u,dataFormat:c,dilations:p,dimRoundingMode:f}});if(i){let x=h;h=Qi({inputs:{a:h,b:i},backend:r}),r.disposeIntermediateTensorInfo(x)}if(d){let x=h;h=Nf(r,h,d,a,m),r.disposeIntermediateTensorInfo(x)}return h}var uV={kernelName:Mp,backendName:"cpu",kernelFunc:Qae};function Zae(t){let{inputs:e,backend:r}=t,{params:n,indices:o}=e,s=w.sizeFromShape(n.shape),i=o.shape,a=i[i.length-1],[l,u,c,p]=T.prepareAndValidate(n,o);if(u===0)return r.makeTensorInfo(l,n.dtype,[]);let f=r.data.get(o.dataId).values,d=r.bufferSync(n),m=Zw(f,d,n.dtype,u,a,c,p,n.shape,s);return r.makeTensorInfo(l,n.dtype,m.values)}var cV={kernelName:zv,backendName:"cpu",kernelFunc:Zae};function Jae(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,indices:s}=e,{axis:i,batchDims:a}=n;ee([o,s],"gatherV2");let l=w.parseAxisParam(i,o.shape)[0],u=r.data.get(s.dataId).values,c=o.shape[l];for(let v=0;v<u.length;++v){let C=u[v];w.assert(C<=c-1&&C>=0,()=>`GatherV2: the index value ${C} is not in [0, ${c-1}]`)}let p=a;a==null&&(p=0);let f=w.sizeFromShape(s.shape),d=T.segment_util.collectGatherOpShapeInfo(o,s,l,p),m=et({inputs:{x:o},backend:r,attrs:{shape:[d.batchSize,d.outerSize,d.dimSize,d.sliceSize]}}),h=et({inputs:{x:s},backend:r,attrs:{shape:[d.batchSize,f/d.batchSize]}}),x=[d.batchSize,d.outerSize,f/d.batchSize,d.sliceSize],g=r.bufferSync(h),y=r.bufferSync(m),b=Jw(y,g,x);return r.disposeIntermediateTensorInfo(m),r.disposeIntermediateTensorInfo(h),r.makeTensorInfo(d.outputShape,b.dtype,b.values)}var pV={kernelName:Fu,backendName:"cpu",kernelFunc:Jae};function ele(t){let{inputs:e,backend:r}=t,{input:n}=e,o=w.sizeFromShape(n.shape),s=n.shape[n.shape.length-1],i=o/s,a=et({inputs:{x:n},backend:r,attrs:{shape:[i,s]}}),l=xC(a,!0,r),u=et({inputs:{x:l},backend:r,attrs:{shape:n.shape}});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(l),u}var fV={kernelName:nm,backendName:"cpu",kernelFunc:ele};var tle=Le(za,t=>Number.isFinite(t)?1:0,"bool"),dV={kernelName:za,backendName:"cpu",kernelFunc:tle};var rle=Le(Ba,t=>Math.abs(t)===1/0?1:0,"bool"),mV={kernelName:Ba,backendName:"cpu",kernelFunc:rle};var nle=Le(Va,t=>Number.isNaN(t)?1:0,"bool"),hV={kernelName:Va,backendName:"cpu",kernelFunc:nle};function ole(t){let{backend:e,attrs:r}=t,{start:n,stop:o,num:s}=r,i=eC(n,o,s);return e.makeTensorInfo([i.length],"float32",i)}var gV={kernelName:Bv,backendName:"cpu",kernelFunc:ole};var sle=Le(Ga,t=>Math.log1p(t)),xV={kernelName:Ga,backendName:"cpu",kernelFunc:sle};var ile=rt((t,e)=>t&&e),ale=it($p,ile,null,"bool"),yV={kernelName:$p,backendName:"cpu",kernelFunc:ale};var lle=Le(Rp,t=>t?0:1,"bool"),bV={kernelName:Rp,backendName:"cpu",kernelFunc:lle};var ule=rt((t,e)=>t||e),cle=it(Op,ule,null,"bool"),vV={kernelName:Op,backendName:"cpu",kernelFunc:cle};function ple(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{depthRadius:s,bias:i,alpha:a,beta:l}=n;ee(o,"LRN");let u=o.shape[3],c=u-1,p=r.data.get(o.dataId).values,f=w.sizeFromShape(o.shape),d=new Float32Array(f);function m(h){let x=h%u,g=h-x+Math.max(0,x-s),y=h-x+Math.min(x+s,c),b=0;for(;g<=y;g++){let v=p[g];b+=v*v}return b}for(let h=0;h<f;h++){let x=m(h),g=p[h]*Math.pow(i+a*x,-l);d[h]=g}return r.makeTensorInfo(o.shape,o.dtype,d)}var wV={kernelName:Lu,backendName:"cpu",kernelFunc:ple};function fle(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,y:s,dy:i}=e,{depthRadius:a,bias:l,alpha:u,beta:c}=n;ee(i,"LRNGrad");let p=w.sizeFromShape(i.shape),f=i.shape[3],d=r.data.get(i.dataId).values,m=r.data.get(o.dataId).values,h=r.data.get(s.dataId).values,x=new Float32Array(p),g=p;for(let y=0;y<g;y++){let b=y%f,v=y-b+Math.max(0,b-a),C=y-b+Math.min(f,b+a+1),S=0;for(let k=v;k<C;k++)S+=Math.pow(m[k],2);S=u*S+l;for(let k=v;k<C;k++){let I=-2*u*c*m[k]*h[y]/S;y===k&&(I+=Math.pow(S,-c)),I*=d[y],x[k]+=I}}return r.makeTensorInfo(i.shape,o.dtype,x)}var CV={kernelName:sm,backendName:"cpu",kernelFunc:fle};function D_(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{reductionIndices:s,keepDims:i}=n,a=r,l=o.shape,u=l.length,c=w.parseAxisParam(s,l),p=c,f=T.getAxesPermutation(p,u),d=a.data.get(o.dataId).values;if(f!=null){let v=new Array(u);for(let C=0;C<v.length;C++)v[C]=l[f[C]];d=Ih(d,l,o.dtype,f,v),p=T.getInnerMostAxes(p.length,u),l=v}ee(o,"max"),T.assertAxesAreInnerMostDims("max",p,u);let[m,h]=T.computeOutAndReduceShapes(l,p),x=w.sizeFromShape(h),g=tC(d,x,m,o.dtype),y=a.write(g,m,o.dtype),b=m;return i&&(b=T.expandShapeToKeepDim(m,c)),{dataId:y,shape:b,dtype:o.dtype}}var SV={kernelName:Mu,backendName:"cpu",kernelFunc:D_};function dle(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e;ee(o,"maxPool");let{filterSize:s,strides:i,pad:a,dimRoundingMode:l}=n,u=1;w.assert(T.eitherStridesOrDilationsAreOne(i,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);let c=T.computePool2DInfo(o.shape,s,i,u,a,l),p;if(c.filterWidth===1&&c.filterHeight===1&&w.arraysEqual(c.inShape,c.outShape))p=wn({inputs:{x:o},backend:r});else{let f=r.data.get(o.dataId).values,d=w.computeStrides(o.shape),m=Ah(f,o.shape,o.dtype,d,c,"max");p=r.makeTensorInfo(c.outShape,o.dtype,m.values)}return p}var kV={kernelName:zu,backendName:"cpu",kernelFunc:dle};function mle(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{filterSize:s,strides:i,pad:a,dimRoundingMode:l,dataFormat:u}=n;ee(o,"maxPool3d");let c=T.computePool3DInfo(o.shape,s,i,1,a,l,u),p=r.data.get(o.dataId).values,f=gC(p,o.shape,o.dtype,w.computeStrides(o.shape),c,"max");return r.makeTensorInfo(f.shape,"float32",f.values)}var TV={kernelName:Bu,backendName:"cpu",kernelFunc:mle};function hle(t){let{inputs:e,backend:r,attrs:n}=t,{dy:o,input:s}=e,{filterSize:i,strides:a,pad:l,dimRoundingMode:u}=n;ee([o,s],"maxPool3DGrad");let c=T.computePool3DInfo(s.shape,i,a,1,l,u),p=r.bufferSync(s),f=v4(p,c),d=c.strideDepth,m=c.strideHeight,h=c.strideWidth,x=c.dilationDepth,g=c.dilationHeight,y=c.dilationWidth,b=c.effectiveFilterDepth,v=c.effectiveFilterHeight,C=c.effectiveFilterWidth,S=b-1-c.padInfo.front,k=C-1-c.padInfo.left,I=v-1-c.padInfo.top,A=Ie(s.shape,"float32"),$=r.bufferSync(o);for(let O=0;O<c.batchSize;++O)for(let j=0;j<c.inChannels;++j)for(let H=0;H<c.inDepth;++H)for(let Y=0;Y<c.inHeight;++Y)for(let B=0;B<c.inWidth;++B){let K=H-S,X=Y-I,Z=B-k,Q=0;for(let ie=0;ie<b;ie+=x){let re=(K+ie)/d;if(!(re<0||re>=c.outDepth||Math.floor(re)!==re))for(let ue=0;ue<v;ue+=g){let ne=(X+ue)/m;if(!(ne<0||ne>=c.outHeight||Math.floor(ne)!==ne))for(let le=0;le<C;le+=y){let ae=(Z+le)/h;if(ae<0||ae>=c.outWidth||Math.floor(ae)!==ae)continue;let me=b*v*C-1-f.get(O,re,ne,ae,j),be=ie*v*C+ue*C+le,we=me===be?1:0;if(we===0)continue;let ke=$.get(O,re,ne,ae,j);Q+=ke*we}}}A.set(Q,O,H,Y,B,j)}return r.makeTensorInfo(A.shape,A.dtype,A.values)}var NV={kernelName:am,backendName:"cpu",kernelFunc:hle};function gle(t){let{inputs:e,backend:r,attrs:n}=t,{dy:o,input:s,output:i}=e,a=s;ee([s,i],"maxPoolGrad");let{filterSize:l,strides:u,pad:c,dimRoundingMode:p}=n,f=T.computePool2DInfo(a.shape,l,u,1,c,p),d=r.data.get(a.dataId).values,m=Ie(f.outShape,a.dtype,hC(d,a.shape,a.dtype,f).values),h=f.strideHeight,x=f.strideWidth,g=f.dilationHeight,y=f.dilationWidth,b=f.effectiveFilterHeight,v=f.effectiveFilterWidth,C=v-1-f.padInfo.left,S=b-1-f.padInfo.top,k=Ie(a.shape,"float32"),I=r.data.get(o.dataId).values,A=Ie(o.shape,"float32",I);for(let $=0;$<f.batchSize;++$)for(let O=0;O<f.inChannels;++O)for(let j=0;j<f.inHeight;++j)for(let H=0;H<f.inWidth;++H){let Y=j-S,B=H-C,K=0;for(let X=0;X<b;X+=g){let Z=(Y+X)/h;if(!(Z<0||Z>=f.outHeight||Math.floor(Z)!==Z))for(let Q=0;Q<v;Q+=y){let ie=(B+Q)/x;if(ie<0||ie>=f.outWidth||Math.floor(ie)!==ie)continue;let re=b*v-1-m.get($,Z,ie,O),ue=X*v+Q,ne=re===ue?1:0;if(ne===0)continue;let le=A.get($,Z,ie,O);K+=le*ne}}k.set(K,$,j,H,O)}return r.makeTensorInfo(k.shape,k.dtype,k.values)}var IV={kernelName:im,backendName:"cpu",kernelFunc:gle};function EV(t,e,r,n,o){let s=w.computeStrides(e),i=Ah(t,e,r,s,o,"max"),a=hC(t,e,r,o,!0,n);return[i.values,a.values]}var _V={kernelName:Vv,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:r})=>{let{x:n}=t,{filterSize:o,strides:s,pad:i,includeBatchInIndex:a}=e,l=r;ee(n,"MaxPoolWithArgmax");let u=l.data.get(n.dataId).values,c=T.computePool2DInfo(n.shape,o,s,[1,1],i),[p,f]=EV(u,n.shape,n.dtype,a,c),d=l.write(p,c.outShape,n.dtype),m=l.write(f,c.outShape,n.dtype);return[{dataId:d,shape:c.outShape,dtype:n.dtype},{dataId:m,shape:c.outShape,dtype:"int32"}]}};function xle(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{axis:s,keepDims:i}=n,a=w.parseAxisParam(s,o.shape),u=T.computeOutAndReduceShapes(o.shape,a)[1],c=w.sizeFromShape(u),p=[],f=r.makeTensorInfo([],"float32",new Float32Array([c]));p.push(f);let d=Rs({inputs:{x:o},backend:r,attrs:{dtype:"float32"}});p.push(d);let m=A0({inputs:{a:d,b:f},backend:r});p.push(m);let h=Ol({inputs:{x:m},backend:r,attrs:{axis:s,keepDims:i}});return p.forEach(x=>r.disposeIntermediateTensorInfo(x)),h}var AV={kernelName:Vu,backendName:"cpu",kernelFunc:xle};function yle(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{axis:s,keepDims:i}=n;ee(o,"min");let a=w.parseAxisParam(s,o.shape),l=a,u=T.getAxesPermutation(l,o.shape.length),c=o;u!=null&&(c=Yt({inputs:{x:o},backend:r,attrs:{perm:u}}),l=T.getInnerMostAxes(l.length,o.shape.length)),T.assertAxesAreInnerMostDims("min",l,c.shape.length);let[p,f]=T.computeOutAndReduceShapes(c.shape,l),d=w.sizeFromShape(f),m=w.makeZerosTypedArray(w.sizeFromShape(p),c.dtype),h=r.data.get(c.dataId).values;for(let g=0;g<m.length;++g){let y=g*d,b=h[y];for(let v=0;v<d;++v){let C=h[y+v];(Number.isNaN(C)||C<b)&&(b=C)}m[g]=b}u!=null&&r.disposeIntermediateTensorInfo(c);let x=r.makeTensorInfo(p,c.dtype,m);if(i){let g=T.expandShapeToKeepDim(p,a),y=et({inputs:{x},backend:r,attrs:{shape:g}});return r.disposeIntermediateTensorInfo(x),y}return x}var DV={kernelName:Wu,backendName:"cpu",kernelFunc:yle};function ble(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{paddings:s,mode:i}=n;ee(o,"mirrorPad");let a=s.map((b,v)=>b[0]+o.shape[v]+b[1]),l=s.map(b=>b[0]),u=s.map((b,v)=>b[0]+o.shape[v]),c=i==="reflect"?0:1,p=r.data.get(o.dataId).values,f=o.shape.length,d=w.computeStrides(o.shape),m=w.sizeFromShape(a),h=a.length,x=w.computeStrides(a),g=w.getTypedArrayFromDType(o.dtype,m);for(let b=0;b<m;b++){let v=w.indexToLoc(b,h,x);for(let S=0;S<h;S++)v[S]<l[S]?v[S]=l[S]*2-v[S]-c:v[S]>=u[S]&&(v[S]=(u[S]-1)*2-v[S]+c);v=v.map((S,k)=>S-l[k]);let C=w.locToIndex(v,f,d);g[b]=p[C]}return{dataId:r.write(g,a,o.dtype),shape:a,dtype:o.dtype}}var $V={kernelName:Gu,backendName:"cpu",kernelFunc:ble};var vle=rt((t,e)=>{let r=t%e;return t<0&&e<0||t>=0&&e>=0?r:(r+e)%e}),wle=it(qa,vle),RV={kernelName:qa,backendName:"cpu",kernelFunc:wle};var FV=nt(Bx());function $_(t){let{inputs:e,backend:r,attrs:n}=t,{logits:o}=e,{dim:s}=n,i=o.shape.length,a=s;if(a===-1&&(a=i-1),a!==i-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${i} and dim was ${a}`);let l=w.parseAxisParam([a],o.shape),u=D_({inputs:{x:o},backend:r,attrs:{reductionIndices:l,keepDims:!1}}),c=T.expandShapeToKeepDim(u.shape,l),p=et({inputs:{x:u},backend:r,attrs:{shape:c}}),f=E0({inputs:{a:o,b:p},backend:r}),d=r_({inputs:{x:f},backend:r}),m=Ol({inputs:{x:d},backend:r,attrs:{axis:l,keepDims:!1}}),h=et({inputs:{x:m},backend:r,attrs:{shape:c}}),x=A0({inputs:{a:d,b:h},backend:r});return r.disposeIntermediateTensorInfo(u),r.disposeIntermediateTensorInfo(p),r.disposeIntermediateTensorInfo(f),r.disposeIntermediateTensorInfo(d),r.disposeIntermediateTensorInfo(m),r.disposeIntermediateTensorInfo(h),x}var OV={kernelName:ic,backendName:"cpu",kernelFunc:$_};function Cle(t){let{inputs:e,backend:r,attrs:n}=t,{logits:o}=e,{numSamples:s,seed:i,normalized:a}=n;ee(o,"multinomial");let l=a?o:$_({inputs:{logits:o},backend:r,attrs:{dim:-1}}),u=l.shape[0],c=l.shape[1],p=r.data.get(l.dataId).values,f=[u,s],d=w.makeZerosTypedArray(w.sizeFromShape(f),"int32");for(let m=0;m<u;++m){let h=m*c,x=new Float32Array(c-1);x[0]=p[h];for(let b=1;b<x.length;++b)x[b]=x[b-1]+p[h+b];let g=FV.alea(i.toString()),y=m*s;for(let b=0;b<s;++b){let v=g();d[y+b]=x.length;for(let C=0;C<x.length;C++)if(v<x[C]){d[y+b]=C;break}}}return a||r.disposeIntermediateTensorInfo(l),r.makeTensorInfo(f,"int32",d)}var PV={kernelName:Wv,backendName:"cpu",kernelFunc:Cle};var Sle=bn.nonMaxSuppressionV3Impl;function kle(t){let{inputs:e,backend:r,attrs:n}=t,{boxes:o,scores:s}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l}=n;ee(o,"NonMaxSuppression");let u=r.data.get(o.dataId).values,c=r.data.get(s.dataId).values,{selectedIndices:p}=Sle(u,c,i,a,l);return r.makeTensorInfo([p.length],"int32",new Int32Array(p))}var LV={kernelName:lm,backendName:"cpu",kernelFunc:kle};var Tle=bn.nonMaxSuppressionV4Impl;function Nle(t){let{inputs:e,backend:r,attrs:n}=t,{boxes:o,scores:s}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:u}=n;ee(o,"NonMaxSuppressionPadded");let c=r.data.get(o.dataId).values,p=r.data.get(s.dataId).values,{selectedIndices:f,validOutputs:d}=Tle(c,p,i,a,l,u);return[r.makeTensorInfo([f.length],"int32",new Int32Array(f)),r.makeTensorInfo([],"int32",new Int32Array([d]))]}var MV={kernelName:um,backendName:"cpu",kernelFunc:Nle};var Ile=bn.nonMaxSuppressionV5Impl;function Ele(t){let{inputs:e,backend:r,attrs:n}=t,{boxes:o,scores:s}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,softNmsSigma:u}=n;ee(o,"NonMaxSuppressionWithScore");let c=r.data.get(o.dataId).values,p=r.data.get(s.dataId).values,f=i,d=a,m=l,h=u,{selectedIndices:x,selectedScores:g}=Ile(c,p,f,d,m,h);return[r.makeTensorInfo([x.length],"int32",new Int32Array(x)),r.makeTensorInfo([g.length],"float32",new Float32Array(g))]}var zV={kernelName:cm,backendName:"cpu",kernelFunc:Ele};function _le(t){let{inputs:e,backend:r,attrs:n}=t,{indices:o}=e,{dtype:s,depth:i,onValue:a,offValue:l}=n;ee(o,"oneHot");let u=w.sizeFromShape(o.shape),c=new Float32Array(u*i);c.fill(l);let p=r.data.get(o.dataId).values;for(let f=0;f<u;++f)p[f]>=0&&p[f]<i&&(c[f*i+p[f]]=a);return r.makeTensorInfo([...o.shape,i],s,c)}var BV={kernelName:qu,backendName:"cpu",kernelFunc:_le};function R0(t){let{inputs:e,backend:r}=t,{x:n}=e;if(n.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(n.dtype==="complex64"){let o=$s({inputs:{input:n},backend:r}),s=R0({inputs:{x:o},backend:r}),i=Zi({inputs:{input:n},backend:r}),a=R0({inputs:{x:i},backend:r}),l=zr({inputs:{real:s,imag:a},backend:r});return r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(a),l}else return $0({backend:r,attrs:{shape:n.shape,value:0,dtype:n.dtype}})}var VV={kernelName:uc,backendName:"cpu",kernelFunc:R0};function WV(t){let{inputs:e,backend:r}=t,{x:n}=e;if(n.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(n.dtype==="complex64"){let o=$s({inputs:{input:n},backend:r}),s=WV({inputs:{x:o},backend:r}),i=Zi({inputs:{input:n},backend:r}),a=R0({inputs:{x:i},backend:r}),l=zr({inputs:{real:s,imag:a},backend:r});return r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(a),l}else return $0({backend:r,attrs:{shape:n.shape,value:1,dtype:n.dtype}})}var GV={kernelName:Hu,backendName:"cpu",kernelFunc:WV};function R_(t){let{inputs:e,backend:r,attrs:n}=t,{axis:o}=n;if(e.length===1)return Dh({inputs:{input:e[0]},backend:r,attrs:{dim:o}});let s=e[0].shape,i=e[0].dtype;e.forEach(c=>{w.assertShapesMatch(s,c.shape,"All tensors passed to stack must have matching shapes"),w.assert(i===c.dtype,()=>"All tensors passed to stack must have matching dtypes")});let a=[],l=e.map(c=>{let p=Dh({inputs:{input:c},backend:r,attrs:{dim:o}});return a.push(p),p}),u=Ec({inputs:l,backend:r,attrs:{axis:o}});return a.forEach(c=>r.disposeIntermediateTensorInfo(c)),u}var UV={kernelName:ju,backendName:"cpu",kernelFunc:R_};function Ale(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{paddings:s,constantValue:i}=n;ee(o,"pad");let a=s.map((y,b)=>y[0]+o.shape[b]+y[1]),l=s.map(y=>y[0]),u=r.data.get(o.dataId).values,c=w.sizeFromShape(o.shape),p=o.shape.length,f=w.computeStrides(o.shape),d=w.sizeFromShape(a),m=a.length,h=w.computeStrides(a),x=w.getTypedArrayFromDType(o.dtype,d);i!==0&&x.fill(i);for(let y=0;y<c;y++){let v=w.indexToLoc(y,p,f).map((S,k)=>S+l[k]),C=w.locToIndex(v,m,h);x[C]=u[y]}return{dataId:r.write(x,a,o.dtype),shape:a,dtype:o.dtype}}var yC={kernelName:Ku,backendName:"cpu",kernelFunc:Ale};var Dle=rt((t,e)=>Math.pow(t,e)),$le=it(Ka,Dle),HV={kernelName:Ka,backendName:"cpu",kernelFunc:$le};function Rle(t){let{inputs:e,backend:r,attrs:n}=t,{paramsNestedSplits:o,paramsDenseValues:s,indices:i}=e,{outputRaggedRank:a}=n,l=o.map(g=>r.data.get(g.dataId).values),u=o.map(g=>g.shape),c=r.data.get(s.dataId).values,p=r.data.get(i.dataId).values,[f,d,m]=rC(l,u,c,s.shape,s.dtype,p,i.shape,a),h=f.map(g=>r.makeTensorInfo([g.length],"int32",g)),x=r.makeTensorInfo(m,s.dtype,d);return h.concat([x])}var qV={kernelName:Gv,backendName:"cpu",kernelFunc:Rle};function Ole(t){let{inputs:e,backend:r}=t,{starts:n,limits:o,deltas:s}=e,i=r.data.get(n.dataId).values,a=r.data.get(o.dataId).values,l=r.data.get(s.dataId).values,[u,c]=nC(i,n.shape,n.dtype,a,o.shape,l,s.shape),p=r.makeTensorInfo([u.length],"int32",u),f=r.makeTensorInfo([c.length],n.dtype,c);return[p,f]}var jV={kernelName:Uv,backendName:"cpu",kernelFunc:Ole};function Fle(t){let{inputs:e,backend:r,attrs:n}=t,{shape:o,values:s,defaultValue:i,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=n,u=r.data.get(o.dataId).values,c=r.data.get(s.dataId).values,p=r.data.get(i.dataId).values,f=a.map(x=>r.data.get(x.dataId).values),d=a.map(x=>x.shape),[m,h]=oC(u,o.shape,c,s.shape,s.dtype,p,i.shape,f,d,l);return r.makeTensorInfo(m,s.dtype,h)}var KV={kernelName:Hv,backendName:"cpu",kernelFunc:Fle};function Ple(t){let{backend:e,attrs:r}=t,{start:n,stop:o,dtype:s,step:i}=r,a=sC(n,o,i,s);return e.makeTensorInfo([a.length],s,a)}var XV={kernelName:pm,backendName:"cpu",kernelFunc:Ple};var Lle=Le(Xa,t=>1/t),YV={kernelName:Xa,backendName:"cpu",kernelFunc:Lle};function Mle(t){let{inputs:e,backend:r,attrs:n}=t,{images:o}=e,{alignCorners:s,halfPixelCenters:i,size:a}=n;ee(o,"resizeBilinear");let l=w.computeStrides(o.shape),[u,c]=a,[p,f,d,m]=o.shape,h=r.data.get(o.dataId).values,x=new Float32Array(w.sizeFromShape([p,u,c,m])),g=[s&&u>1?f-1:f,s&&c>1?d-1:d],y=[s&&u>1?u-1:u,s&&c>1?c-1:c],b=0,v=g[0]/y[0],C=g[1]/y[1];for(let S=0;S<p;S++)for(let k=0;k<u;k++){let I;i?I=v*(k+.5)-.5:I=v*k;let A=Math.max(0,Math.floor(I)),$=I-A,O=Math.min(f-1,Math.ceil(I)),j=S*l[0]+A*l[1],H=S*l[0]+O*l[1];for(let Y=0;Y<c;Y++){let B;i?B=C*(Y+.5)-.5:B=C*Y;let K=Math.max(0,Math.floor(B)),X=B-K,Z=Math.min(d-1,Math.ceil(B)),Q=j+K*l[2],ie=H+K*l[2],re=j+Z*l[2],ue=H+Z*l[2];for(let ne=0;ne<m;ne++){let le=h[Q+ne],ae=h[ie+ne],me=h[re+ne],be=h[ue+ne],we=le+(me-le)*X,ke=ae+(be-ae)*X,He=we+(ke-we)*$;x[b++]=He}}}return r.makeTensorInfo([p,u,c,m],"float32",x)}var QV={kernelName:Ju,backendName:"cpu",kernelFunc:Mle};function zle(t){let{inputs:e,backend:r,attrs:n}=t,{images:o,dy:s}=e,{alignCorners:i}=n;ee([s,o],"resizeBilinearGrad");let a=w.computeStrides(o.shape),[l,u,c,p]=o.shape,[,f,d]=s.shape,m=new Float32Array(l*u*c*p),h=[i&&f>1?u-1:u,i&&d>1?c-1:c],x=[i&&f>1?f-1:f,i&&d>1?d-1:d],g=h[0]/x[0],y=h[1]/x[1],b=r.data.get(s.dataId).values,v=0;for(let C=0;C<l;C++){let S=C*a[0];for(let k=0;k<f;k++){let I=k*g,A=Math.floor(I),$=Math.min(Math.ceil(I),u-1),O=S+A*a[1],j=S+$*a[1],H=I-A,Y=1-H;for(let B=0;B<d;B++){let K=B*y,X=Math.floor(K),Z=Math.min(Math.ceil(K),c-1),Q=K-X,ie=1-Q,re=O+X*a[2],ue=O+Z*a[2],ne=j+X*a[2],le=j+Z*a[2],ae=Y*ie,me=Y*Q,be=H*ie,we=H*Q;for(let ke=0;ke<p;ke++){let He=b[v++];m[re+ke]+=He*ae,m[ue+ke]+=He*me,m[ne+ke]+=He*be,m[le+ke]+=He*we}}}}return r.makeTensorInfo([l,c,u,p],"float32",m)}var ZV={kernelName:mm,backendName:"cpu",kernelFunc:zle};function Ble(t){let{inputs:e,backend:r,attrs:n}=t,{images:o}=e,{alignCorners:s,halfPixelCenters:i,size:a}=n;ee(o,"resizeNearestNeighbor");let l=w.computeStrides(o.shape),[u,c]=a,[p,f,d,m]=o.shape,h=r.data.get(o.dataId).values,x=new Float32Array(p*u*c*m),g=[s&&u>1?f-1:f,s&&c>1?d-1:d],y=[s&&u>1?u-1:u,s&&c>1?c-1:c],b=g[0]/y[0],v=g[1]/y[1],C=0;for(let S=0;S<p;S++){let k=S*l[0];for(let I=0;I<u;I++){let A=i?b*(I+.5):b*I,$=Math.min(f-1,s?Math.round(A):Math.floor(A));i&&($=Math.max(0,$));let O=k+$*l[1];for(let j=0;j<c;j++){let H=i?v*(j+.5):v*j,Y=Math.min(d-1,s?Math.round(H):Math.floor(H));i&&(Y=Math.max(0,Y));let B=O+Y*l[2];for(let K=0;K<m;K++){let X=h[B+K];x[C++]=X}}}}return r.makeTensorInfo([p,u,c,m],o.dtype,x)}var JV={kernelName:Zu,backendName:"cpu",kernelFunc:Ble};function Vle(t){let{inputs:e,backend:r,attrs:n}=t,{images:o,dy:s}=e,{alignCorners:i}=n;ee([s,o],"resizeNearestNeighborGrad");let a=w.computeStrides(o.shape),l=w.computeStrides(s.shape),[u,c,p,f]=o.shape,[,d,m]=s.shape,h=new Float32Array(u*c*p*f),x=r.data.get(s.dataId).values,g=[i&&d>1?c-1:c,i&&m>1?p-1:p],y=[i&&d>1?d-1:d,i&&m>1?m-1:m],b=g[0]/y[0],v=g[1]/y[1],C=1/b,S=1/v,k=Math.ceil(C)*2+2,I=Math.ceil(S)*2+2;for(let A=0;A<u;A++){let $=A*a[0];for(let O=0;O<c;O++){let j=$+O*a[1],H=Math.floor(O*C),Y=Math.floor(H-k/2);for(let B=0;B<p;B++){let K=j+B*a[2],X=Math.floor(B*S),Z=Math.floor(X-I/2);for(let Q=0;Q<f;Q++){let ie=0;for(let re=0;re<k;re++){let ue=re+Y;if(ue<0||ue>=d)continue;let ne=$+ue*l[1],le=ue*b,ae=Math.min(c-1,i?Math.round(le):Math.floor(le));if(O===ae)for(let me=0;me<I;me++){let be=me+Z;if(be<0||be>=m)continue;let we=ne+be*l[2],ke=be*v,He=Math.min(p-1,i?Math.round(ke):Math.floor(ke));B===He&&(ie+=x[we+Q])}}h[K+Q]=ie}}}}return r.makeTensorInfo(o.shape,o.dtype,h)}var e5={kernelName:dm,backendName:"cpu",kernelFunc:Vle};function Wle(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{dims:s}=n;ee(o,"reverse");let i=o.shape.length,a=w.parseAxisParam(s,o.shape);if(i===0)return wn({inputs:{x:o},backend:r});let l=new bt(o.shape,o.dtype),u=r.bufferSync(o);for(let c=0;c<l.size;c++){let p=l.indexToLoc(c),f=p.slice();a.forEach(d=>f[d]=o.shape[d]-1-f[d]),l.set(u.get(...f),...p)}return r.makeTensorInfo(l.shape,l.dtype,l.values)}var t5={kernelName:ec,backendName:"cpu",kernelFunc:Wle};var r5={kernelName:vm,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:r})=>{let{image:n}=t,{radians:o,fillValue:s,center:i}=e,a=r,l=w.getTypedArrayFromDType(n.dtype,w.sizeFromShape(n.shape)),[u,c,p,f]=n.shape,[d,m]=T.getImageCenter(i,c,p),h=255,x=Math.sin(o),g=Math.cos(o),y=a.data.get(n.dataId).values;for(let v=0;v<u;v++){let C=v*p*c*f;for(let S=0;S<c;S++){let k=S*(p*f);for(let I=0;I<p;I++){let A=I*f;for(let $=0;$<f;$++){let O=[u,S,I,$],j=O[2],H=O[1],Y=(j-d)*g-(H-m)*x,B=(j-d)*x+(H-m)*g;Y=Math.round(Y+d),B=Math.round(B+m);let K=s;if(typeof s!="number"&&($===3?K=h:K=s[$]),Y>=0&&Y<p&&B>=0&&B<c){let Z=B*(p*f),Q=Y*f,ie=C+Z+Q+$;K=y[ie]}let X=C+k+A+$;l[X]=K}}}}return{dataId:a.write(l,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}};var Gle=Le(Za,t=>{let e=Math.floor(t);return t-e<.5?Math.floor(t):t-e>.5?Math.ceil(t):e%2===0?e:e+1}),n5={kernelName:Za,backendName:"cpu",kernelFunc:Gle};function Ule(t){let{inputs:e,backend:r,attrs:n}=t,{indices:o,updates:s}=e,{shape:i}=n,{sliceRank:a,numUpdates:l,sliceSize:u,strides:c,outputSize:p}=T.calculateShapes(s,o,i),f=!0,d=r.bufferSync(o),m=r.bufferSync(s),h=Rl(d,m,i,p,u,l,a,c,0,f);return r.makeTensorInfo(i,h.dtype,h.values)}var o5={kernelName:qv,backendName:"cpu",kernelFunc:Ule};function Hle(t,e){let r=0,n=t.length,o=0;for(;r<n;)o=Math.floor((r+n)/2),t[o]<e?r=o+1:n=o;return n}function qle(t,e){let r=0,n=t.length,o=0;for(;r<n;)o=Math.floor((r+n)/2),t[o]<=e?r=o+1:n=o;return n}function s5(t,e,r,n,o,s){let i=w.getArrayFromDType("int32",r*o);for(let a=0;a<r;++a){let l=t.slice(a*n,(a+1)*n),u=a*o;for(let c=0;c<o;++c)i[u+c]=s==="left"?Hle(l,e[c+u]):qle(l,e[c+u])}return i}function jle(t){let{inputs:e,backend:r,attrs:n}=t,{sortedSequence:o,values:s}=e,{side:i}=n,a=r.data.get(o.dataId).values,l=r.data.get(s.dataId).values,u=s5(a,l,o.shape[0],o.shape[1],s.shape[1],i);return r.makeTensorInfo(s.shape,"int32",u)}var i5={kernelName:jv,backendName:"cpu",kernelFunc:jle};function Kle(t){let{inputs:e,backend:r}=t,{condition:n,t:o,e:s}=e;ee([n,o,s],"select");let i=n.shape.length,a=r.data.get(n.dataId).values,l=r.data.get(o.dataId).values,u=r.data.get(s.dataId).values,c=wr(o.dtype,s.dtype),p=w.makeZerosTypedArray(w.sizeFromShape(o.shape),c),f=0,d=i===0||i>1||o.shape.length===1?1:w.sizeFromShape(o.shape.slice(1));for(let m=0;m<a.length;m++)for(let h=0;h<d;h++)a[m]===1?p[f++]=l[m]:p[f++]=u[m];return r.makeTensorInfo(o.shape,c,p)}var a5={kernelName:tc,backendName:"cpu",kernelFunc:Kle};var Xle=T.SELU_SCALEALPHA,Yle=T.SELU_SCALE,Qle=Le(el,t=>t>=0?Yle*t:Xle*(Math.exp(t)-1)),l5={kernelName:el,backendName:"cpu",kernelFunc:Qle};var Zle=Le(nl,t=>t<0?-1:t>0?1:0),u5={kernelName:nl,backendName:"cpu",kernelFunc:Zle};var Jle=Le(tl,t=>Math.sin(t)),c5={kernelName:tl,backendName:"cpu",kernelFunc:Jle};var eue=Le(rl,t=>Math.sinh(t)),p5={kernelName:rl,backendName:"cpu",kernelFunc:eue};var tue=11920928955078125e-23,f5=Math.log(tue)+2,rue=Le(sl,t=>{let e=t>-f5,r=t<f5,n=Math.exp(t),o;return r?o=n:e?o=t:o=Math.log(1+n),o}),d5={kernelName:sl,backendName:"cpu",kernelFunc:rue};function nue(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{blockShape:s,paddings:i}=n;ee([o],"spaceToBatchND");let a=w.sizeFromShape(s),l=[[0,0]];l.push(...i);for(let S=1+s.length;S<o.shape.length;++S)l.push([0,0]);let u=yC.kernelFunc({inputs:{x:o},backend:r,attrs:{paddings:l,constantValue:0}}),c=T.getReshaped(u.shape,s,a,!1),p=T.getPermuted(c.length,s.length,!1),f=T.getReshapedPermuted(u.shape,s,a,!1),h=et({inputs:{x:u},backend:r,attrs:{shape:c}}),y=Yt({inputs:{x:h},backend:r,attrs:{perm:p}}),C=et({inputs:{x:y},backend:r,attrs:{shape:f}});return r.disposeIntermediateTensorInfo(u),r.disposeIntermediateTensorInfo(h),r.disposeIntermediateTensorInfo(y),C}var m5={kernelName:oc,backendName:"cpu",kernelFunc:nue};function oue(t){let{inputs:e,backend:r}=t,{indices:n,values:o,denseShape:s,defaultValue:i}=e;if(s.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${s.shape}`);if(n.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${n.shape}`);if(o.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${o.shape}`);if(i.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${i.shape}`);let a=r.data.get(n.dataId).values,l=r.data.get(o.dataId).values,u=r.data.get(s.dataId).values,c=r.data.get(i.dataId).values[0],[p,f,d,m,h]=iC(a,n.shape,n.dtype,l,o.dtype,u,c);return[r.makeTensorInfo(f,n.dtype,p),r.makeTensorInfo([f[0]],o.dtype,d),r.makeTensorInfo([m.length],"bool",new Uint8Array(m.map(x=>Number(x)))),r.makeTensorInfo([h.length],n.dtype,new Int32Array(h))]}var h5={kernelName:Kv,backendName:"cpu",kernelFunc:oue};function sue(t){let{inputs:e,backend:r}=t,{inputIndices:n,inputShape:o,newShape:s}=e;if(n.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${n.shape}`);if(o.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${o.shape}`);if(s.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${s.shape}`);let i=Array.from(r.data.get(o.dataId).values),a=r.data.get(n.dataId).values,l=Array.from(r.data.get(s.dataId).values),[u,c,p]=aC(a,n.shape,n.dtype,i,l);return[r.makeTensorInfo(c,n.dtype,u),r.makeTensorInfo([p.length],s.dtype,new Int32Array(p))]}var g5={kernelName:Xv,backendName:"cpu",kernelFunc:sue};function iue(t){let{inputs:e,backend:r}=t,{data:n,indices:o,segmentIds:s}=e;if(n.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${o.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${s.shape}`);if(o.shape[0]!==s.shape[0])throw new Error("segmentIds and indices should have same size.");let i=r.data.get(n.dataId).values,a=r.data.get(o.dataId).values,l=r.data.get(s.dataId).values,[u,c]=_h(i,n.shape,n.dtype,a,l,!0);return r.makeTensorInfo(c,n.dtype,u)}var x5={kernelName:Yv,backendName:"cpu",kernelFunc:iue};function aue(t){let{inputs:e,backend:r}=t,{data:n,indices:o,segmentIds:s}=e;if(n.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${o.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${s.shape}`);if(o.shape[0]!==s.shape[0])throw new Error("segmentIds and indices should have same size.");let i=r.data.get(n.dataId).values,a=r.data.get(o.dataId).values,l=r.data.get(s.dataId).values,[u,c]=_h(i,n.shape,n.dtype,a,l);return r.makeTensorInfo(c,n.dtype,u)}var y5={kernelName:Qv,backendName:"cpu",kernelFunc:aue};function lue(t){let{inputs:e,backend:r,attrs:n}=t,{sparseIndices:o,sparseValues:s,defaultValue:i}=e,{outputShape:a}=n,{sliceRank:l,numUpdates:u,sliceSize:c,strides:p,outputSize:f}=T.calculateShapes(s,o,a),d=!1,m=r.bufferSync(o),h;switch(s.dtype){case"bool":{let x=r.bufferSync(s),g=Boolean(r.data.get(i.dataId).values[0]);h=Rl(m,x,a,f,c,u,l,p,g,d);break}case"float32":{let x=r.bufferSync(s),g=r.data.get(i.dataId).values[0];h=Rl(m,x,a,f,c,u,l,p,g,d);break}case"int32":{let x=r.bufferSync(s),g=r.data.get(i.dataId).values[0];h=Rl(m,x,a,f,c,u,l,p,g,d);break}case"string":{let x=r.bufferSync(s),g=w.decodeString(r.data.get(i.dataId).values[0]);h=Rl(m,x,a,f,c,u,l,p,g,d);break}default:throw new Error(`Unsupported type ${s.dtype}`)}return r.makeTensorInfo(a,h.dtype,h.values)}var b5={kernelName:Zv,backendName:"cpu",kernelFunc:lue};function uue(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{numOrSizeSplits:s,axis:i}=n,a=w.parseAxisParam(i,o.shape)[0],l=T.prepareSplitSize(o,s,a),u=new Array(o.shape.length).fill(0),c=o.shape.slice();return l.map(p=>{let f=[...c];f[a]=p;let d=Ps({inputs:{x:o},backend:r,attrs:{begin:u,size:f}});return u[a]+=p,d})}var v5={kernelName:sc,backendName:"cpu",kernelFunc:uue};var w5={kernelName:hm,backendName:"cpu",kernelFunc:({inputs:t,backend:e})=>{let{x:r}=t,n=e;ee(r,"square");let o=n.data.get(r.dataId).values,s=new Float32Array(o.length);for(let a=0;a<o.length;++a){let l=o[a];s[a]=l*l}return{dataId:n.write(s,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};var cue=Le(pl,(t,e)=>{let r=e;return isNaN(t)?NaN:t>0?1:r.alpha}),C5={kernelName:pl,backendName:"cpu",kernelFunc:cue};function pue(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{begin:s,end:i,strides:a,beginMask:l,endMask:u,ellipsisMask:c,newAxisMask:p,shrinkAxisMask:f}=n;ee(o,"stridedSlice");let{finalShapeSparse:d,finalShape:m,isIdentity:h,sliceDim0:x,isSimpleSlice:g,begin:y,end:b,strides:v}=Hr.sliceInfo(o.shape,s,i,a,l,u,c,p,f),C;if(h)C=et({inputs:{x:o},backend:r,attrs:{shape:m}});else if(x||g){w.assert(o.shape.length>=1,()=>`Input must have rank at least 1, got: ${o.shape.length}`);let S=Hr.computeOutShape(y,b,v),k=Ps({inputs:{x:o},backend:r,attrs:{begin:y,size:S}});C=et({inputs:{x:k},backend:r,attrs:{shape:m}}),r.disposeIntermediateTensorInfo(k)}else{let S=r.bufferSync(o),k=lC(d,S,v,y);C=r.makeTensorInfo(m,k.dtype,k.values)}return C}var S5={kernelName:gm,backendName:"cpu",kernelFunc:pue};function fue(t){let{inputs:e,backend:r,attrs:n}=t,{separator:o,nGramWidths:s,leftPad:i,rightPad:a,padWidth:l,preserveShortSequences:u}=n,{data:c,dataSplits:p}=e,f=r.data.get(c.dataId).values,d=r.data.get(p.dataId).values,[m,h]=uC(f,d,o,s,i,a,l,u);return[r.makeTensorInfo([m.length],"string",m),r.makeTensorInfo(p.shape,"int32",h)]}var k5={kernelName:Jv,backendName:"cpu",kernelFunc:fue};function due(t){let{inputs:e,backend:r,attrs:n}=t,{skipEmpty:o}=n,{input:s,delimiter:i}=e;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(s.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${s.shape}`);if(i.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${i.shape}`);let a=r.data.get(s.dataId).values,l=r.data.get(i.dataId).values[0],[u,c,p]=cC(a,l,o),f=c.length;return[r.makeTensorInfo([f,2],"int32",u),r.makeTensorInfo([f],"string",c),r.makeTensorInfo([2],"int32",new Int32Array(p))]}var T5={kernelName:e1,backendName:"cpu",kernelFunc:due};function mue(t){let{inputs:e,backend:r,attrs:n}=t,{numBuckets:o}=n,{input:s}=e;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(o<=0)throw new Error("Number of buckets must be at least 1");let i=r.data.get(s.dataId).values,a=pC(i,o);return r.makeTensorInfo(s.shape,"int32",a)}var N5={kernelName:t1,backendName:"cpu",kernelFunc:mue};var hue=Le(ul,t=>Math.tan(t)),I5={kernelName:ul,backendName:"cpu",kernelFunc:hue};var gue=Le(cl,t=>Math.tanh(t)),E5={kernelName:cl,backendName:"cpu",kernelFunc:gue};function xue(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{reps:s}=n;ee(o,"tile");let i=fC(r.bufferSync(o),s);return r.makeTensorInfo(i.shape,i.dtype,i.values)}var _5={kernelName:Pi,backendName:"cpu",kernelFunc:xue};function yue(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{k:s,sorted:i}=n;ee(o,"topk");let a=r.data.get(o.dataId).values,[l,u]=dC(a,o.shape,o.dtype,s,i);return[r.makeTensorInfo(l.shape,l.dtype,l.values),r.makeTensorInfo(u.shape,u.dtype,u.values)]}var A5={kernelName:xm,backendName:"cpu",kernelFunc:yue};function bue(t){let{inputs:e,attrs:r,backend:n}=t,{image:o,transforms:s}=e,{interpolation:i,fillMode:a,fillValue:l,outputShape:u}=r,[c,p,f,d]=o.shape,[m,h]=u??[p,f],x=[c,m,h,d],g=w.computeStrides(o.shape),y=g[0],b=g[1],v=g[2],C=w.computeStrides(x),S=C[0],k=C[1],I=C[2],A=w.getTypedArrayFromDType(o.dtype,w.sizeFromShape(x));A.fill(l);let $=n.data.get(o.dataId).values,O=n.data.get(s.dataId).values;for(let H=0;H<c;++H){let Y=s.shape[0]===1?O:O.subarray(H*8,H*8+8);for(let B=0;B<m;++B)for(let K=0;K<h;++K)for(let X=0;X<d;++X){let Z,Q=Y[6]*K+Y[7]*B+1;if(Q===0)continue;let ie=(Y[0]*K+Y[1]*B+Y[2])/Q,re=(Y[3]*K+Y[4]*B+Y[5])/Q,ue=D5(ie,f,a),ne=D5(re,p,a);switch(i){case"nearest":Z=kue($,p,f,y,b,v,H,ne,ue,X,l);break;case"bilinear":Z=Tue($,p,f,y,b,v,H,ne,ue,X,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${i}`)}let le=H*S+B*k+K*I+X;A[le]=Z}return n.makeTensorInfo(x,o.dtype,A)}return{dataId:n.write(A,x,o.dtype),shape:o.shape,dtype:o.dtype}}var $5={kernelName:ym,backendName:"cpu",kernelFunc:bue};function D5(t,e,r){switch(r){case"reflect":return vue(t,e);case"wrap":return wue(t,e);case"nearest":return Sue(t,e);case"constant":default:return Cue(t,e)}}function vue(t,e){let r=t;if(r<0)if(e<=1)r=0;else{let n=2*e;r<n&&(r=n*Math.trunc(-r/n)+r),r=r<-e?r+n:-r-1}else if(r>e-1)if(e<=1)r=0;else{let n=2*e;r-=n*Math.trunc(r/n),r>=e&&(r=n-r-1)}return w.clamp(0,r,e-1)}function wue(t,e){let r=t;if(r<0)if(e<=1)r=0;else{let n=e-1;r+=e*(Math.trunc(-r/n)+1)}else if(r>e-1)if(e<=1)r=0;else{let n=e-1;r-=e*Math.trunc(r/n)}return w.clamp(0,r,e-1)}function Cue(t,e){return t}function Sue(t,e){return w.clamp(0,t,e-1)}function O0(t,e,r,n,o,s,i,a,l,u,c){let p=i*n+a*o+l*s+u;return 0<=a&&a<e&&0<=l&&l<r?t[p]:c}function kue(t,e,r,n,o,s,i,a,l,u,c){let p=Math.round(a),f=Math.round(l);return O0(t,e,r,n,o,s,i,p,f,u,c)}function Tue(t,e,r,n,o,s,i,a,l,u,c){let p=Math.floor(a),f=Math.floor(l),d=p+1,m=f+1,h=(m-l)*O0(t,e,r,n,o,s,i,p,f,u,c)+(l-f)*O0(t,e,r,n,o,s,i,p,m,u,c),x=(m-l)*O0(t,e,r,n,o,s,i,d,f,u,c)+(l-f)*O0(t,e,r,n,o,s,i,d,m,u,c);return(d-a)*h+(a-p)*x}function Nue(t){let{inputs:e,attrs:r,backend:n}=t,{axis:o}=r,{x:s}=e;ee(s,"unique");let i=n.data.get(s.dataId).values,{outputValues:a,outputShape:l,indices:u}=mC(i,o,s.shape,s.dtype);return[n.makeTensorInfo(l,s.dtype,a),n.makeTensorInfo([u.length],"int32",u)]}var R5={kernelName:bm,backendName:"cpu",kernelFunc:Nue};function Iue(t){let{inputs:e,backend:r,attrs:n}=t,{value:o}=e,{axis:s}=n;s<0&&(s+=o.shape.length);let i=o.shape.length,a=o.shape[s],l=new Array(i-1),u=0;for(let d=0;d<i;d++)d!==s&&(l[u++]=o.shape[d]);let c=new Array(i).fill(0),p=o.shape.slice();p[s]=1;let f=new Array(a);for(let d=0;d<f.length;d++){c[s]=d;let m=Ps({inputs:{x:o},backend:r,attrs:{begin:c,size:p}});f[d]=et({inputs:{x:m},backend:r,attrs:{shape:l}}),r.disposeIntermediateTensorInfo(m)}return f}var O5={kernelName:ac,backendName:"cpu",kernelFunc:Iue};function Eue(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,segmentIds:s}=e,{numSegments:i}=n;ee(o,"unsortedSegmentSum");let a=o.shape.length,l=s.shape.length,u=[],c=[],p=a-l,f=s;for(let m=0;m<p;++m){let h=Dh({inputs:{input:f},backend:r,attrs:{dim:m+1}});f=h,c.push(h)}for(let m=0;m<i;++m){let h=w.createScalarValue(m,"int32"),x=r.makeTensorInfo([],"int32",h),g=e_({inputs:{a:x,b:f},backend:r}),y=Rs({inputs:{x:g},backend:r,attrs:{dtype:"float32"}}),b=Tf({inputs:{a:y,b:o},backend:r}),v=Ol({inputs:{x:b},backend:r,attrs:{axis:0,keepDims:!1}});u.push(v),c.push(x),c.push(g),c.push(y),c.push(b),c.push(v)}let d=R_({inputs:u,backend:r,attrs:{axis:0}});return c.forEach(m=>r.disposeIntermediateTensorInfo(m)),d}var F5={kernelName:lc,backendName:"cpu",kernelFunc:Eue};var _ue=[a4,yB,l4,u4,SB,c4,p4,f4,d4,m4,h4,g4,x4,y4,b4,w4,C4,S4,k4,i4,T4,N4,I4,E4,CB,kB,_4,bB,A4,$4,R4,O4,F4,P4,L4,M4,z4,B4,V4,W4,G4,U4,H4,q4,j4,K4,X4,Y4,Q4,Z4,eV,e4,tV,TB,rV,NB,nV,IB,oV,sV,iV,EB,aV,lV,uV,cV,pV,_B,AB,vB,fV,D4,dV,mV,hV,t4,DB,$B,gV,RB,xV,yV,bV,vV,wV,CV,SV,OB,kV,TV,NV,IV,_V,AV,DV,FB,$V,RV,PV,PB,LB,LV,MV,zV,MB,BV,GV,UV,yC,HV,r4,BB,qV,jV,KV,XV,wB,D0,YV,n4,o4,s4,QV,ZV,JV,e5,t5,r5,n5,HB,o5,i5,a5,l5,jB,u5,c5,p5,KB,OV,d5,m5,h5,g5,x5,y5,b5,v5,YB,w5,QB,C5,S5,k5,T5,N5,ZB,J4,I5,E5,_5,A5,$5,zB,R5,O5,F5,VV];for(let t of _ue)n1(t);var If={},bC={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function P5(t,e){If[t]=e}function Ro(t,e){if(!(t in If)||e!=null){let n=Due(t,e);if(n!==null)If[t]=n;else return console.log("Could not get context for WebGL version",t),null}let r=If[t];return r==null||r.isContextLost()?(delete If[t],Ro(t)):(r.disable(r.DEPTH_TEST),r.disable(r.STENCIL_TEST),r.disable(r.BLEND),r.disable(r.DITHER),r.disable(r.POLYGON_OFFSET_FILL),r.disable(r.SAMPLE_COVERAGE),r.enable(r.SCISSOR_TEST),r.enable(r.CULL_FACE),r.cullFace(r.BACK),If[t])}function Aue(t){if(typeof OffscreenCanvas<"u"&&t===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function Due(t,e){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");let r=e??Aue(t);return r.addEventListener("webglcontextlost",n=>{n.preventDefault(),delete If[t]},!1),W().getBool("SOFTWARE_WEBGL_ENABLED")&&(bC.failIfMajorPerformanceCaveat=!1),t===1?r.getContext("webgl",bC)||r.getContext("experimental-webgl",bC):r.getContext("webgl2",bC)}var _c;(function(t){t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH"})(_c||(_c={}));var Cn;(function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"})(Cn||(Cn={}));var un;(function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(un||(un={}));function Ef(t,e){return[e,t]}function L5(t,e){return t*e}function F0(t){let e=w.sizeFromShape(t),r=Math.ceil(e/4);return w.sizeToSquarishShape(r)}function Ji(t,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(t/2))]}function M5(t,e){let[r,n]=Ji(t,e);return r*n*4}function P0(t,e){let r=t,n,o,s,i,a,l,u,c,p,f;return W().getNumber("WEBGL_VERSION")===2?(n=r.R32F,o=r.R16F,s=r.RGBA16F,i=r.RGBA32F,a=r.RED,u=4,c=1,p=r.HALF_FLOAT,f=r.FLOAT,l=r.RGBA8):(n=t.RGBA,o=t.RGBA,s=t.RGBA,i=r.RGBA,a=t.RGBA,u=4,c=4,p=e!=null?e.HALF_FLOAT_OES:null,f=t.FLOAT,l=t.RGBA),{internalFormatFloat:n,internalFormatHalfFloat:o,internalFormatPackedHalfFloat:s,internalFormatPackedFloat:i,textureFormatFloat:a,downloadTextureFormat:l,downloadUnpackNumChannels:u,defaultNumChannels:c,textureTypeHalfFloat:p,textureTypeFloat:f}}function Ce(t,e){let r=e();return W().getBool("DEBUG")&&$ue(t),r}function $ue(t){let e=t.getError();if(e!==t.NO_ERROR)throw new Error("WebGL Error: "+Fue(t,e))}var Rue=596e-10,Oue=65504;function z5(t){return!!(W().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||t===0||Rue<Math.abs(t)&&Math.abs(t)<Oue)}function Fue(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function L0(t,e){return Fl(t,()=>t.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function B5(t,e){let r=Fl(t,()=>t.createShader(t.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(Ce(t,()=>t.shaderSource(r,e)),Ce(t,()=>t.compileShader(r)),t.getShaderParameter(r,t.COMPILE_STATUS)===!1)throw console.log(t.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function V5(t,e){let r=Fl(t,()=>t.createShader(t.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(Ce(t,()=>t.shaderSource(r,e)),Ce(t,()=>t.compileShader(r)),W().get("ENGINE_COMPILE_ONLY"))return r;if(t.getShaderParameter(r,t.COMPILE_STATUS)===!1)throw M_(e,t.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var Pue=/ERROR: [0-9]+:([0-9]+):/g;function M_(t,e){let r=Pue.exec(e);if(r==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(t);return}let n=+r[1],o=t.split(`
`),s=o.length.toString().length+2,i=o.map((p,f)=>w.rightPad((f+1).toString(),s)+p),a=0;for(let p=0;p<i.length;p++)a=Math.max(i[p].length,a);let l=i.slice(0,n-1),u=i.slice(n-1,n),c=i.slice(n);console.log(l.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${w.rightPad(u[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(c.join(`
`))}function W5(t){return Fl(t,()=>t.createProgram(),"Unable to create WebGLProgram.")}function G5(t,e){if(Ce(t,()=>t.linkProgram(e)),!W().get("ENGINE_COMPILE_ONLY")&&t.getProgramParameter(e,t.LINK_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function wC(t,e){if(Ce(t,()=>t.validateProgram(e)),t.getProgramParameter(e,t.VALIDATE_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function U5(t,e){let r=Fl(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return Ce(t,()=>t.bindBuffer(t.ARRAY_BUFFER,r)),Ce(t,()=>t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW)),r}function H5(t,e){let r=Fl(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return Ce(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r)),Ce(t,()=>t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW)),r}function q5(t){return Fl(t,()=>t.createTexture(),"Unable to create WebGLTexture.")}function j5(t,e){let r=W().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||e<=0){let n=`[${t}x${e}]`;throw new Error("Requested texture size "+n+" is invalid.")}if(t>r||e>r){let n=`[${t}x${e}]`,o=`[${r}x${r}]`;throw new Error("Requested texture size "+n+" greater than WebGL maximum on this browser / GPU "+o+".")}}function K5(t){return Fl(t,()=>t.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function z_(t,e,r,n,o,s,i){let a=t.getAttribLocation(e,r);return a===-1?!1:(Ce(t,()=>t.bindBuffer(t.ARRAY_BUFFER,n)),Ce(t,()=>t.vertexAttribPointer(a,o,t.FLOAT,!1,s,i)),Ce(t,()=>t.enableVertexAttribArray(a)),!0)}function Lue(t,e,r){zue(t,r),Ce(t,()=>t.activeTexture(t.TEXTURE0+r)),Ce(t,()=>t.bindTexture(t.TEXTURE_2D,e))}function X5(t,e,r){return Fl(t,()=>t.getUniformLocation(e,r),'uniform "'+r+'" not present in program.')}function Y5(t,e,r){return t.getUniformLocation(e,r)}function Q5(t,e,r,n){Ce(t,()=>Lue(t,e,n)),Ce(t,()=>t.uniform1i(r,n))}function CC(t,e,r){Ce(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,r)),Ce(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0))}function B_(t,e){Ce(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,e)),Ce(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0))}function M0(t){let e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+Mue(t,e))}function Mue(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function Fl(t,e,r){let n=Ce(t,()=>e());if(n==null)throw new Error(r);return n}function zue(t,e){let r=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,n=e+t.TEXTURE0;if(n<t.TEXTURE0||n>r){let o=`[gl.TEXTURE0, gl.TEXTURE${r}]`;throw new Error(`textureUnit must be in ${o}.`)}}function Ac(t,e=2){return w.sizeFromShape(t.slice(0,t.length-e))}function Dc(t){if(t.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function z0(t){let e=[1,1,1];return t.length===0||t.length===1&&t[0]===1||(e=[Ac(t),...Dc(t)]),e}function Z5(t,e=!1){let r=W().getNumber("WEBGL_MAX_TEXTURE_SIZE"),n=W().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");n===1/0&&W().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(n=r/2),e&&(r=r*2,n=n*2,t=t.map((a,l)=>l>=t.length-2?w.nearestLargerEven(t[l]):t[l]),t.length===1&&(t=[2,t[0]])),t.length!==2&&(t=w.squeezeShape(t).newShape);let o=w.sizeFromShape(t),s=null;t.length<=1&&o<=r?s=[1,o]:t.length===2&&t[0]<=r&&t[1]<=r?s=t:t.length===3&&t[0]*t[1]<=r&&t[2]<=r?s=[t[0]*t[1],t[2]]:t.length===3&&t[0]<=r&&t[1]*t[2]<=r?s=[t[0],t[1]*t[2]]:t.length===4&&t[0]*t[1]*t[2]<=r&&t[3]<=r?s=[t[0]*t[1]*t[2],t[3]]:t.length===4&&t[0]<=r&&t[1]*t[2]*t[3]<=r&&(s=[t[0],t[1]*t[2]*t[3]]);let i=s!=null&&Math.max(...s)>n&&Math.min(...s)<=(e?2:1)&&Math.min(...s)>0;if(s==null||i)if(e){let a=Ac(t),l=2,u=2;t.length&&([l,u]=Dc(t)),o=a*(l/2)*(u/2),s=w.sizeToSquarishShape(o).map(c=>c*2)}else s=w.sizeToSquarishShape(o);return s}function vC(t){return t%2===0}function _f(t,e){if(t=t.slice(-2),e=e.slice(-2),w.arraysEqual(t,e)||!t.length||!e.length||t[0]===0||t[1]===0||e[0]===0||e[1]===0)return!0;if(t.length!==e.length){let r=t.slice(-1)[0],n=e.slice(-1)[0];if(r===n||vC(r)&&vC(n)&&(t[0]===1||e[0]===1))return!0}return t[1]===e[1]&&vC(t[0])&&vC(e[0])}var F_,P_;function J5(t){if(F_==null){let e=Ro(t);F_=e.getParameter(e.MAX_TEXTURE_SIZE)}return F_}function eW(t){if(P_==null){let e=Ro(t);P_=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,P_)}function tW(t){if(t===0)return 0;let e,r=Ro(t);return ts(r,"EXT_disjoint_timer_query_webgl2")&&t===2?e=2:ts(r,"EXT_disjoint_timer_query")?e=1:e=0,e}function ts(t,e){return t.getExtension(e)!=null}function V_(t){try{if(Ro(t)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function rW(t){if(t===0)return!1;let e=Ro(t);if(t===1){if(!ts(e,"OES_texture_float"))return!1}else if(!ts(e,"EXT_color_buffer_float"))return!1;return L_(e)}function nW(t){if(t===0)return!1;let e=Ro(t);if(t===1){if(!ts(e,"OES_texture_float")||!ts(e,"WEBGL_color_buffer_float"))return!1}else{if(ts(e,"EXT_color_buffer_float"))return L_(e);let n="EXT_color_buffer_half_float";if(ts(e,n)){let o=e.getExtension(n);return Bue(e,o)}return!1}return L_(e)}function L_(t){let e=P0(t),r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r);let n=1,o=1;t.texImage2D(t.TEXTURE_2D,0,e.internalFormatFloat,n,o,0,e.textureFormatFloat,e.textureTypeFloat,null);let s=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,s),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0);let i=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(r),t.deleteFramebuffer(s),i}function Bue(t,e){let r=P0(t,e),n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n);let o=1,s=1;t.texImage2D(t.TEXTURE_2D,0,r.internalFormatHalfFloat,o,s,0,r.textureFormatFloat,r.textureTypeHalfFloat,null);let i=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);let a=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(n),t.deleteFramebuffer(i),a}function oW(t){return t!==2?!1:Ro(t).fenceSync!=null}function ea(t,e){Array.isArray(t)||(t=[t]),t.forEach(r=>{r!=null&&w.assert(r.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}var Fe=W();Fe.registerFlag("HAS_WEBGL",()=>Fe.getNumber("WEBGL_VERSION")>0);Fe.registerFlag("WEBGL_VERSION",()=>V_(2)?2:V_(1)?1:0);Fe.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);Fe.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>Fe.get("WEBGL_VERSION")===2);Fe.registerFlag("WEBGL_CPU_FORWARD",()=>!0);Fe.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);Fe.registerFlag("WEBGL_PACK",()=>Fe.getBool("HAS_WEBGL"));Fe.registerFlag("WEBGL_PACK_NORMALIZATION",()=>Fe.getBool("WEBGL_PACK"));Fe.registerFlag("WEBGL_PACK_CLIP",()=>Fe.getBool("WEBGL_PACK"));Fe.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>Fe.getBool("WEBGL_PACK"));Fe.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>Fe.getBool("WEBGL_PACK"));Fe.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>Fe.getBool("WEBGL_PACK"));Fe.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>Fe.getBool("WEBGL_PACK"));Fe.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>Fe.getBool("WEBGL_PACK"));Fe.registerFlag("WEBGL_PACK_REDUCE",()=>Fe.getBool("WEBGL_PACK"));Fe.registerFlag("WEBGL_LAZILY_UNPACK",()=>Fe.getBool("WEBGL_PACK"));Fe.registerFlag("WEBGL_CONV_IM2COL",()=>Fe.getBool("WEBGL_PACK"));Fe.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>J5(Fe.getNumber("WEBGL_VERSION")));Fe.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>eW(Fe.getNumber("WEBGL_VERSION")));Fe.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{let t=Fe.getNumber("WEBGL_VERSION");return t===0?0:tW(t)});Fe.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>Fe.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!fc.isMobile());Fe.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>rW(Fe.getNumber("WEBGL_VERSION")));Fe.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>Fe.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:Fe.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));Fe.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>nW(Fe.getNumber("WEBGL_VERSION")));Fe.registerFlag("WEBGL_FENCE_API_ENABLED",()=>oW(Fe.getNumber("WEBGL_VERSION")));Fe.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>Fe.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);Fe.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,t=>{if(t<0&&t!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${t}.`)});Fe.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>fc.isMobile()?1:-1,t=>{if(t<0&&t!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${t}.`)});Fe.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);Fe.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);Fe.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);Fe.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);Fe.registerFlag("WEBGL_EXP_CONV",()=>!1);Fe.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>Fe.getBool("IS_TEST"));Fe.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);Fe.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);Fe.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);Fe.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);function Qt(){let t,e,r,n,o,s,i,a,l,u;return W().getNumber("WEBGL_VERSION")===2?(t="#version 300 es",e="in",r="out",n="in",o="texture",s="outputColor",i="out vec4 outputColor;",a=W().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",l="",u=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(t="",e="attribute",r="varying",n="varying",o="texture2D",s="gl_FragColor",i="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,u=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:t,attribute:e,varyingVs:r,varyingFs:n,texture2D:o,output:s,defineOutput:i,defineSpecialNaN:a,defineSpecialInf:l,defineRound:u}}function hi(t,e,r="index"){let n=w.computeStrides(e);return n.map((o,s)=>{let i=`int ${t[s]} = ${r} / ${o}`,a=s===n.length-1?`int ${t[s+1]} = ${r} - ${t[s]} * ${o}`:`index -= ${t[s]} * ${o}`;return`${i}; ${a};`}).join("")}function Af(t,e,r="index"){let n=w.computeStrides(e);return n.map((o,s)=>{let i=`int ${t[s]} = ${r} / outShapeStrides[${s}]`,a=s===n.length-1?`int ${t[s+1]} = ${r} - ${t[s]} * outShapeStrides[${s}]`:`index -= ${t[s]} * outShapeStrides[${s}]`;return`${i}; ${a};`}).join("")}function Vue(t,e){let r=t.length,n=t.map(s=>`${e}[${s}]`),o=new Array(r-1);o[r-2]=n[r-1];for(let s=r-3;s>=0;--s)o[s]=`(${o[s+1]} * ${n[s+1]})`;return o}function sW(t,e,r="index"){let n=t.map((s,i)=>i),o=Vue(n,e);return o.map((s,i)=>{let a=`int ${t[i]} = ${r} / ${o[i]}`,l=i===o.length-1?`int ${t[i+1]} = ${r} - ${t[i]} * ${o[i]}`:`index -= ${t[i]} * ${o[i]}`;return`${a}; ${l};`}).join("")}function $h(t){let e=w.computeStrides(t).map(r=>r.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function Rh(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}var kC=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;var{getBroadcastDims:iW}=T;function aW(t,e,r){let n=[];if(t.forEach(d=>{let m=w.sizeFromShape(d.shapeInfo.logicalShape);if(d.shapeInfo.isUniform?n.push(`uniform float ${d.name}${m>1?`[${m}]`:""};`):(n.push(`uniform sampler2D ${d.name};`),n.push(`uniform int offset${d.name};`)),r.enableShapeUniforms){let{uniformShape:h}=TC(r.packedInputs,d.shapeInfo.logicalShape,d.shapeInfo.texShape);switch(h.length){case 1:n.push(`uniform int ${d.name}Shape;`);break;case 2:n.push(`uniform ivec2 ${d.name}Shape;`);break;case 3:n.push(`uniform ivec3 ${d.name}Shape;`);break;case 4:n.push(`uniform ivec4 ${d.name}Shape;`);break;default:break}n.push(`uniform ivec2 ${d.name}TexShape;`)}}),r.enableShapeUniforms){switch(e.logicalShape.length){case 1:n.push("uniform int outShape;");break;case 2:n.push("uniform ivec2 outShape;"),n.push("uniform int outShapeStrides;");break;case 3:n.push("uniform ivec3 outShape;"),n.push("uniform ivec2 outShapeStrides;");break;case 4:n.push("uniform ivec4 outShape;"),n.push("uniform ivec3 outShapeStrides;");break;default:break}n.push("uniform ivec2 outTexShape;")}r.customUniforms&&r.customUniforms.forEach(d=>{n.push(`uniform ${d.type} ${d.name}${d.arrayIndex?`[${d.arrayIndex}]`:""};`)});let o=n.join(`
`),s=t.map(d=>Wue(d,e,r.packedInputs,r.enableShapeUniforms)).join(`
`),i=e.texShape,a=Qt(),l=Hue(a),u,c,p=Kue(a);return e.isPacked?(u=Gue(e.logicalShape,i,r.enableShapeUniforms),c=jue(a)):(u=Uue(e.logicalShape,i,r.enableShapeUniforms),c=que(a)),r.packedInputs&&(p+=Zue),[p,l,c,o,u,s,r.userCode].join(`
`)}function Fh(t,e=!1){let r=t.shapeInfo.logicalShape;switch(r.length){case 0:return cce(t,e);case 1:return fce(t,e);case 2:return mce(t,e);case 3:return gce(t,e);case 4:return yce(t,e);case 5:return bce(t);case 6:return vce(t);default:throw new Error(`${r.length}-D input sampling is not yet supported`)}}function lW(t,e){switch(t.shapeInfo.logicalShape.length){case 0:return uce(t);case 1:return pce(t,e);case 2:return dce(t,e);case 3:return hce(t,e);default:return xce(t,e)}}function Wue(t,e,r=!1,n){let o="";r?o+=lW(t,n):o+=Fh(t,n);let s=t.shapeInfo.logicalShape,i=e.logicalShape;return s.length<=i.length&&(r?o+=wce(t,e):o+=Cce(t,e)),o}function Gue(t,e,r){switch(t.length){case 0:return uW();case 1:return Jue(t,e,r);case 2:return ace(t,e,r);case 3:return tce(t,e,r);default:return nce(t,e,r)}}function Uue(t,e,r){switch(t.length){case 0:return uW();case 1:return ece(t,e,r);case 2:return lce(t,e,r);case 3:return rce(t,e,r);case 4:return oce(t,e,r);case 5:return sce(t,e);case 6:return ice(t,e);default:throw new Error(`${t.length}-D output sampling is not yet supported`)}}function Hue(t){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${t.texture2D}(textureSampler, uv).r;
    }
  `}function que(t){return`
    void setOutput(float val) {
      ${t.output} = vec4(val, 0, 0, 0);
    }
  `}function jue(t){return`
    void setOutput(vec4 val) {
      ${t.output} = val;
    }
  `}function Kue(t){return`${t.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${t.varyingFs} vec2 resultUV;
    ${t.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${t.defineSpecialNaN}
    ${t.defineSpecialInf}
    ${t.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${Xue}
    ${Yue}
    ${Que}
  `}var Xue=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Yue=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Que=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Zue=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function uW(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function Jue(t,e,r){let n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return n[0]===1?r?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${n[1]}.0);
      }
    `:n[1]===1?r?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${n[0]}.0);
      }
    `:r?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${n[0]}, ${n[1]}));
      return 2 * (resTexRC.x * ${n[1]} + resTexRC.y);
    }
  `}function ece(t,e,r){return e[0]===1?r?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?r?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:r?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function tce(t,e,r){if(r)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;let n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],o=Math.ceil(t[2]/2),s=o*Math.ceil(t[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${n[0]}, ${n[1]}));
      int index = resTexRC.x * ${n[1]} + resTexRC.y;

      int b = index / ${s};
      index -= b * ${s};

      int r = 2 * (index / ${o});
      int c = imod(index, ${o}) * 2;

      return ivec3(b, r, c);
    }
  `}function rce(t,e,r){if(r)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${Af(["r","c","d"],t)}
    return ivec3(r, c, d);
  }
`;let n=hi(["r","c","d"],t);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${n}
      return ivec3(r, c, d);
    }
  `}function nce(t,e,r){if(r)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;let n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],o=Math.ceil(t[t.length-1]/2),s=o*Math.ceil(t[t.length-2]/2),i=s,a="",l="b, r, c";for(let u=2;u<t.length-1;u++)i*=t[t.length-u-1],a=`
      int b${u} = index / ${i};
      index -= b${u} * ${i};
    `+a,l=`b${u}, `+l;return`
    ivec${t.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${n[0]}, ${n[1]}));
      int index = resTexRC.x * ${n[1]} + resTexRC.y;

      ${a}

      int b = index / ${s};
      index -= b * ${s};

      int r = 2 * (index / ${o});
      int c = imod(index, ${o}) * 2;

      return ivec${t.length}(${l});
    }
  `}function oce(t,e,r){if(r)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${Af(["r","c","d","d2"],t)}
      return ivec4(r, c, d, d2);
    }
  `;let n=hi(["r","c","d","d2"],t);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${n}
      return ivec4(r, c, d, d2);
    }
  `}function sce(t,e){let r=hi(["r","c","d","d2","d3"],t);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${r}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function ice(t,e){let r=hi(["r","c","d","d2","d3","d4"],t);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${r}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function ace(t,e,r){let n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(w.arraysEqual(t,e))return r?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${n[0]}, ${n[1]}));
      }
    `;let o=Math.ceil(t[1]/2);return r?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${n[0]}, ${n[1]}));

      int index = resTexRC.x * ${n[1]} + resTexRC.y;
      int r = 2 * (index / ${o});
      int c = imod(index, ${o}) * 2;

      return ivec2(r, c);
    }
  `}function lce(t,e,r){return w.arraysEqual(t,e)?r?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:t[1]===1?r?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:t[0]===1?r?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:r?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${t[1]};
      int c = index - r * ${t[1]};
      return ivec2(r, c);
    }
  `}function Df(t){return`offset${t}`}function uce(t){let e=t.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),n=Qt();return`
    vec4 ${r}() {
      return ${n.texture2D}(${e}, halfCR);
    }
  `}function cce(t,e){let r=t.name,n="get"+r.charAt(0).toUpperCase()+r.slice(1);if(t.shapeInfo.isUniform)return`float ${n}() {return ${r};}`;let[o,s]=t.shapeInfo.texShape;if(o===1&&s===1)return`
      float ${n}() {
        return sampleTexture(${r}, halfCR);
      }
    `;let i=Df(r);if(e)return`
    float ${n}() {
      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], ${i});
      return sampleTexture(${r}, uv);
    }
  `;let[a,l]=t.shapeInfo.texShape;return`
    float ${n}() {
      vec2 uv = uvFromFlat(${a}, ${l}, ${i});
      return sampleTexture(${r}, uv);
    }
  `}function pce(t,e){let r=t.name,n="get"+r.charAt(0).toUpperCase()+r.slice(1),o=t.shapeInfo.texShape,s=Qt();if(e)return`
    vec4 ${n}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${s.texture2D}(${r}, uv);
    }
  `;let i=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];return`
    vec4 ${n}(int index) {
      vec2 uv = packedUVfrom1D(
        ${i[0]}, ${i[1]}, index);
      return ${s.texture2D}(${r}, uv);
    }
  `}function fce(t,e){let r=t.name,n="get"+r.charAt(0).toUpperCase()+r.slice(1);if(t.shapeInfo.isUniform)return`
      float ${n}(int index) {
        ${Ph(t)}
      }
    `;let o=t.shapeInfo.texShape,s=o[0],i=o[1];if(i===1&&s===1)return`
      float ${n}(int index) {
        return sampleTexture(${r}, halfCR);
      }
    `;let a=Df(r);return i===1?e?`
      float ${n}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${r}TexShape[0]));
        return sampleTexture(${r}, uv);
      }
    `:`
      float ${n}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${s}.0);
        return sampleTexture(${r}, uv);
      }
    `:s===1?e?`
      float ${n}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${r}TexShape[1]), 0.5);
        return sampleTexture(${r}, uv);
      }
    `:`
      float ${n}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${i}.0, 0.5);
        return sampleTexture(${r}, uv);
      }
    `:e?`
    float ${n}(int index) {
      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index + ${a});
      return sampleTexture(${r}, uv);
    }
  `:`
    float ${n}(int index) {
      vec2 uv = uvFromFlat(${s}, ${i}, index + ${a});
      return sampleTexture(${r}, uv);
    }
  `}function dce(t,e){let r=t.shapeInfo.logicalShape,n=t.name,o="get"+n.charAt(0).toUpperCase()+n.slice(1),s=t.shapeInfo.texShape,i=s[0],a=s[1],l=Qt();if(s!=null&&w.arraysEqual(r,s))return e?`
      vec4 ${o}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${n}TexShape[1], ${n}TexShape[0]);

        return ${l.texture2D}(${n}, uv);
      }
    `:`
      vec4 ${o}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${i}.0);

        return ${l.texture2D}(${n}, uv);
      }
    `;if(e)return`
    vec4 ${o}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${n}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${l.texture2D}(${n}, uv);
    }
  `;let u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],c=Math.ceil(r[1]/2);return`
    vec4 ${o}(int row, int col) {
      vec2 uv = packedUVfrom2D(${c}, ${u[0]}, ${u[1]}, row, col);
      return ${l.texture2D}(${n}, uv);
    }
  `}function mce(t,e){let r=t.shapeInfo.logicalShape,n=t.name,o="get"+n.charAt(0).toUpperCase()+n.slice(1),s=t.shapeInfo.texShape;if(s!=null&&w.arraysEqual(r,s)){if(e)return`
      float ${o}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${n}TexShape[1], ${n}TexShape[0]);
        return sampleTexture(${n}, uv);
      }
    `;let f=s[0],d=s[1];return`
    float ${o}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${d}.0, ${f}.0);
      return sampleTexture(${n}, uv);
    }
  `}let{newShape:i,keptDims:a}=w.squeezeShape(r),l=i;if(l.length<r.length){let f=Lh(t,l),d=["row","col"];return`
      ${Fh(f,e)}
      float ${o}(int row, int col) {
        return ${o}(${Mh(d,a)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${o}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${r[1]}, 1)));
        ${Ph(t)}
      }
    `;let u=s[0],c=s[1],p=Df(n);return c===1?e?`
      float ${o}(int row, int col) {
        float index = dot(vec3(row, col, ${p}), vec3(${n}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${n}TexShape[0]));
        return sampleTexture(${n}, uv);
      }
    `:`
    float ${o}(int row, int col) {
      float index = dot(vec3(row, col, ${p}), vec3(${r[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${u}.0);
      return sampleTexture(${n}, uv);
    }
  `:u===1?e?`
      float ${o}(int row, int col) {
        float index = dot(vec3(row, col, ${p}), vec3(${n}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${n}TexShape[1]), 0.5);
        return sampleTexture(${n}, uv);
      }
    `:`
    float ${o}(int row, int col) {
      float index = dot(vec3(row, col, ${p}), vec3(${r[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${c}.0, 0.5);
      return sampleTexture(${n}, uv);
    }
  `:e?`
      float ${o}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${n}Shape[1] + col + ${p};
        vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index);
        return sampleTexture(${n}, uv);
      }
    `:`
  float ${o}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${r[1]} + col + ${p};
    vec2 uv = uvFromFlat(${u}, ${c}, index);
    return sampleTexture(${n}, uv);
  }
`}function hce(t,e){let r=t.shapeInfo.logicalShape,n=t.name,o="get"+n.charAt(0).toUpperCase()+n.slice(1),s=t.shapeInfo.texShape,i=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)];if(r[0]===1){let f=r.slice(1),d=[1,2],m=Lh(t,f),h=["b","row","col"];return`
        ${lW(m,e)}
        vec4 ${o}(int b, int row, int col) {
          return ${o}(${Mh(h,d)});
        }
      `}let a=Qt();if(e)return`
    vec4 ${o}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${n}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${n}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${n}, uv);
    }
  `;let l=i[0],u=i[1],c=Math.ceil(r[2]/2),p=c*Math.ceil(r[1]/2);return`
    vec4 ${o}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${l}, ${u}, ${p}, ${c}, b, row, col);
      return ${a.texture2D}(${n}, uv);
    }
  `}function gce(t,e){let r=t.shapeInfo.logicalShape,n=t.name,o="get"+n.charAt(0).toUpperCase()+n.slice(1),s=r[1]*r[2],i=r[2],{newShape:a,keptDims:l}=w.squeezeShape(r),u=a;if(u.length<r.length){let h=Lh(t,u),x=["row","col","depth"];return`
        ${Fh(h,e)}
        float ${o}(int row, int col, int depth) {
          return ${o}(${Mh(x,l)});
        }
      `}if(t.shapeInfo.isUniform)return`
      float ${o}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${s}, ${i}, 1)));
        ${Ph(t)}
      }
    `;let c=t.shapeInfo.texShape,p=c[0],f=c[1],d=t.shapeInfo.flatOffset;if(f===s&&d==null)return e?`
      float ${o}(int row, int col, int depth) {
        int stride1 = ${n}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${n}TexShape[1], ${n}TexShape[0]);
        return sampleTexture(${n}, uv);
      }
    `:`
        float ${o}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${i}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${f}.0, ${p}.0);
          return sampleTexture(${n}, uv);
        }
      `;if(f===i&&d==null)return e?`
      float ${o}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${n}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${n}TexShape[1], ${n}TexShape[0]);
        return sampleTexture(${n}, uv);
      }
    `:`
    float ${o}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${r[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${f}.0, ${p}.0);
      return sampleTexture(${n}, uv);
    }
  `;let m=Df(n);return e?`
    float ${o}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${n}Shape[1] * ${n}Shape[2];
      int stride1 = ${n}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${m};
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index);
      return sampleTexture(${n}, uv);
    }
    `:`
      float ${o}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s} + col * ${i} + depth + ${m};
        vec2 uv = uvFromFlat(${p}, ${f}, index);
        return sampleTexture(${n}, uv);
      }
  `}function xce(t,e){let r=t.name,n="get"+r.charAt(0).toUpperCase()+r.slice(1),o=Qt();if(e)return`
    vec4 ${n}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${r}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${r}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${r}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${o.texture2D}(${r}, uv);
    }
  `;let s=t.shapeInfo.logicalShape,i=s.length,a=t.shapeInfo.texShape,l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],u=l[0],c=l[1],p=Math.ceil(s[i-1]/2),f=p*Math.ceil(s[i-2]/2),d="int b, int row, int col",m=`b * ${f} + (row / 2) * ${p} + (col / 2)`;for(let h=2;h<i-1;h++)d=`int b${h}, `+d,f*=s[i-h-1],m=`b${h} * ${f} + `+m;return`
    vec4 ${n}(${d}) {
      int index = ${m};
      int texR = index / ${c};
      int texC = index - texR * ${c};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${c}, ${u});
      return ${o.texture2D}(${r}, uv);
    }
  `}function yce(t,e){let r=t.shapeInfo.logicalShape,n=t.name,o="get"+n.charAt(0).toUpperCase()+n.slice(1),s=r[3],i=r[2]*s,a=r[1]*i,{newShape:l,keptDims:u}=w.squeezeShape(r);if(l.length<r.length){let y=Lh(t,l),b=["row","col","depth","depth2"];return`
      ${Fh(y,e)}
      float ${o}(int row, int col, int depth, int depth2) {
        return ${o}(${Mh(b,u)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${o}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${i}, ${s}, 1)));
        ${Ph(t)}
      }
    `;let c=t.shapeInfo.flatOffset,p=t.shapeInfo.texShape,f=p[0],d=p[1],m=`int stride2 = ${n}Shape[3];`,h=`int stride1 = ${n}Shape[2] * stride2;`,x=`int stride0 = ${n}Shape[1] * stride1;`;if(d===a&&c==null)return e?`
      float ${o}(int row, int col, int depth, int depth2) {
        ${m}
        ${h}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${n}TexShape[1], ${n}TexShape[0]);
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${o}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${i}, ${s}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${d}.0, ${f}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(d===s&&c==null)return e?`
      float ${o}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${n}Shape[1] * ${n}Shape[2], ${n}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${n}TexShape[1], ${n}TexShape[0]);
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${o}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${r[1]*r[2]}, ${r[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${d}.0, ${f}.0);
        return sampleTexture(${n}, uv);
      }
    `;let g=Df(n);return e?`
    float ${o}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${m}
      ${h}
      ${x}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index + ${g});
      return sampleTexture(${n}, uv);
    }
  `:`
    float ${o}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${i} +
          depth * ${s} + depth2;
      vec2 uv = uvFromFlat(${f}, ${d}, index + ${g});
      return sampleTexture(${n}, uv);
    }
  `}function bce(t){let e=t.shapeInfo.logicalShape,r=t.name,n="get"+r.charAt(0).toUpperCase()+r.slice(1),o=e[4],s=e[3]*o,i=e[2]*s,a=e[1]*i,{newShape:l,keptDims:u}=w.squeezeShape(e);if(l.length<e.length){let h=Lh(t,l),x=["row","col","depth","depth2","depth3"];return`
      ${Fh(h)}
      float ${n}(int row, int col, int depth, int depth2, int depth3) {
        return ${n}(${Mh(x,u)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${n}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${i}, ${s}, ${o})) +
          depth3;
        ${Ph(t)}
      }
    `;let c=t.shapeInfo.flatOffset,p=t.shapeInfo.texShape,f=p[0],d=p[1];if(d===a&&c==null)return`
      float ${n}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${i}, ${s}, ${o}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${d}.0, ${f}.0);
        return sampleTexture(${r}, uv);
      }
    `;if(d===o&&c==null)return`
      float ${n}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${d}.0, ${f}.0);
        return sampleTexture(${r}, uv);
      }
    `;let m=Df(r);return`
    float ${n}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${i} + depth * ${s} +
          depth2 * ${o} + depth3 + ${m};
      vec2 uv = uvFromFlat(${f}, ${d}, index);
      return sampleTexture(${r}, uv);
    }
  `}function vce(t){let e=t.shapeInfo.logicalShape,r=t.name,n="get"+r.charAt(0).toUpperCase()+r.slice(1),{newShape:o,keptDims:s}=w.squeezeShape(e);if(o.length<e.length){let x=Lh(t,o),g=["row","col","depth","depth2","depth3","depth4"];return`
      ${Fh(x)}
      float ${n}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${n}(${Mh(g,s)});
      }
    `}let i=e[5],a=e[4]*i,l=e[3]*a,u=e[2]*l,c=e[1]*u;if(t.shapeInfo.isUniform)return`
      float ${n}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${c}, ${u}, ${l}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${i}, 1)));
        ${Ph(t)}
      }
    `;let p=t.shapeInfo.flatOffset,f=t.shapeInfo.texShape,d=f[0],m=f[1];if(m===c&&p==null)return`
      float ${n}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${u}, ${l}, ${a}, ${i})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${m}.0, ${d}.0);
        return sampleTexture(${r}, uv);
      }
    `;if(m===i&&p==null)return`
      float ${n}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${m}.0, ${d}.0);
        return sampleTexture(${r}, uv);
      }
    `;let h=Df(r);return`
    float ${n}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${c} + col * ${u} + depth * ${l} +
          depth2 * ${a} + depth3 * ${i} + depth4 + ${h};
      vec2 uv = uvFromFlat(${d}, ${m}, index);
      return sampleTexture(${r}, uv);
    }
  `}function Ph(t){let e=t.name,r=w.sizeFromShape(t.shapeInfo.logicalShape);return r<2?`return ${e};`:`
    for (int i = 0; i < ${r}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function wce(t,e){let r=t.name,n=r.charAt(0).toUpperCase()+r.slice(1),o="get"+n+"AtOutCoords",s=t.shapeInfo.logicalShape.length,i=e.logicalShape.length,a=iW(t.shapeInfo.logicalShape,e.logicalShape),l=je(i),u=i-s,c,p=["x","y","z","w","u","v"];s===0?c="":i<2&&a.length>=1?c="coords = 0;":c=a.map(y=>`coords.${p[y+u]} = 0;`).join(`
`);let f="";i<2&&s>0?f="coords":f=t.shapeInfo.logicalShape.map((y,b)=>`coords.${p[b+u]}`).join(", ");let d="return outputValue;",h=w.sizeFromShape(t.shapeInfo.logicalShape)===1,g=w.sizeFromShape(e.logicalShape)===1;if(s===1&&!h&&!g)d=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(h&&!g)i===1?d=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:d=`
        return vec4(outputValue.x);
      `;else if(a.length){let y=s-2,b=s-1;a.indexOf(y)>-1&&a.indexOf(b)>-1?d="return vec4(outputValue.x);":a.indexOf(y)>-1?d="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(b)>-1&&(d="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${o}() {
      ${l} coords = getOutputCoords();
      ${c}
      vec4 outputValue = get${n}(${f});
      ${d}
    }
  `}function Cce(t,e){let r=t.name,n=r.charAt(0).toUpperCase()+r.slice(1),o="get"+n+"AtOutCoords",s=e.texShape,i=t.shapeInfo.texShape,a=t.shapeInfo.logicalShape.length,l=e.logicalShape.length;if(!t.shapeInfo.isUniform&&a===l&&t.shapeInfo.flatOffset==null&&w.arraysEqual(i,s))return`
      float ${o}() {
        return sampleTexture(${r}, resultUV);
      }
    `;let u=je(l),c=iW(t.shapeInfo.logicalShape,e.logicalShape),p=l-a,f,d=["x","y","z","w","u","v"];a===0?f="":l<2&&c.length>=1?f="coords = 0;":f=c.map(h=>`coords.${d[h+p]} = 0;`).join(`
`);let m="";return l<2&&a>0?m="coords":m=t.shapeInfo.logicalShape.map((h,x)=>`coords.${d[x+p]}`).join(", "),`
    float ${o}() {
      ${u} coords = getOutputCoords();
      ${f}
      return get${n}(${m});
    }
  `}function je(t){if(t<=1)return"int";if(t===2)return"ivec2";if(t===3)return"ivec3";if(t===4)return"ivec4";if(t===5)return"ivec5";if(t===6)return"ivec6";throw Error(`GPU for rank ${t} is not yet supported`)}function TC(t,e,r){let{newShape:n,keptDims:o}=w.squeezeShape(e),s=e.length,i=t&&s===3&&e[0]===1,a=i?e.slice(1):n,l=!t&&s>1&&!w.arraysEqual(e,r)&&n.length<s||i;return{useSqueezeShape:l,uniformShape:l?a:e,keptDims:o}}function Lh(t,e){let r=JSON.parse(JSON.stringify(t));return r.shapeInfo.logicalShape=e,r}function Mh(t,e){return e.map(r=>t[r]).join(", ")}function pW(t,e,r,n){let o=r.map((c,p)=>{let f={logicalShape:c.shape,texShape:c.isUniform?null:c.texData.texShape,isUniform:c.isUniform,isPacked:c.isUniform?!1:c.texData.isPacked,flatOffset:null};return c.texData!=null&&c.texData.slice!=null&&c.texData.slice.flatOffset>0&&(f.flatOffset=c.texData.slice.flatOffset),{name:e.variableNames[p],shapeInfo:f}}),s=o.map(c=>c.shapeInfo),i={logicalShape:n.shape,texShape:n.texData.texShape,isUniform:!1,isPacked:n.texData.isPacked,flatOffset:null},a=aW(o,i,e),l=V5(t.gl,a),u=t.createProgram(l);return W().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:l,source:a,webGLProgram:u,inShapeInfos:s,outShapeInfo:i,uniformLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,inShapesLocations:null,inTexShapesLocations:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:Object.assign({program:e,fragmentShader:l,source:a,webGLProgram:u,inShapeInfos:s,outShapeInfo:i},W_(t,e,u))}function W_(t,e,r){let n={},o={},s={},i=[],a,l,u,c=null,p=null;p=t.getUniformLocation(r,"NAN",!1),W().getNumber("WEBGL_VERSION")===1&&(c=t.getUniformLocation(r,"INFINITY",!1));let f=!1;for(let d=0;d<e.variableNames.length;d++){let m=e.variableNames[d];n[m]=t.getUniformLocation(r,m,f),n[`offset${m}`]=t.getUniformLocation(r,`offset${m}`,f),e.enableShapeUniforms&&(o[`${m}Shape`]=t.getUniformLocation(r,`${m}Shape`,f),s[`${m}TexShape`]=t.getUniformLocation(r,`${m}TexShape`,f))}return e.enableShapeUniforms&&(a=t.getUniformLocation(r,"outShape",f),u=t.getUniformLocation(r,"outShapeStrides",f),l=t.getUniformLocation(r,"outTexShape",f)),e.customUniforms&&e.customUniforms.forEach((d,m)=>{i[m]=t.getUniformLocation(r,d.name,f)}),{uniformLocations:n,customUniformLocations:i,infLoc:c,nanLoc:p,inShapesLocations:o,inTexShapesLocations:s,outShapeLocation:a,outShapeStridesLocation:u,outTexShapeLocation:l}}function cW(t,e){if(t.length!==e.length)throw Error(`Binary was compiled with ${t.length} inputs, but was executed with ${e.length} inputs`);t.forEach((r,n)=>{let o=r.logicalShape,s=e[n],i=s.shape;if(!w.arraysEqual(o,i))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${o} and ${i} must match`);if(r.isUniform&&s.isUniform)return;let a=r.texShape,l=s.isUniform?null:s.texData.texShape;if(!w.arraysEqual(a,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${l} must match`)})}function fW(t,e,r,n,o){e.program.enableShapeUniforms||(cW(e.inShapeInfos,r),cW([e.outShapeInfo],[n]));let s=n.texData.texture,i=n.texData.texShape;n.texData.isPacked?t.setOutputPackedMatrixTexture(s.texture,i[0],i[1]):t.setOutputMatrixTexture(s.texture,i[0],i[1]),t.setProgram(e.webGLProgram),W().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&t.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&t.gl.uniform1f(e.nanLoc,NaN),r.forEach((l,u)=>{let c=e.program.variableNames[u],p=e.uniformLocations[c],f=e.uniformLocations[`offset${c}`],d=e.inShapesLocations[`${c}Shape`],m=e.inTexShapesLocations[`${c}TexShape`];if(d){let{uniformShape:h}=TC(e.program.packedInputs,l.shape,l.texData.texShape);switch(h.length){case 1:t.gl.uniform1iv(d,new Int32Array(h));break;case 2:t.gl.uniform2iv(d,new Int32Array(h));break;case 3:t.gl.uniform3iv(d,new Int32Array(h));break;case 4:t.gl.uniform4iv(d,new Int32Array(h));break;default:break}}if(m&&t.gl.uniform2i(m,l.texData.texShape[0],l.texData.texShape[1]),p!=null){if(l.isUniform){if(w.sizeFromShape(l.shape)<2)t.gl.uniform1f(p,l.uniformValues[0]);else{let h=l.uniformValues;h instanceof Float32Array||(h=new Float32Array(h)),t.gl.uniform1fv(p,h)}return}l.texData.slice!=null&&f!=null&&t.gl.uniform1i(f,l.texData.slice.flatOffset),t.setInputMatrixTexture(l.texData.texture.texture,p,u)}});let a=e.outShapeLocation;if(a)switch(n.shape.length){case 1:t.gl.uniform1iv(a,new Int32Array(n.shape));break;case 2:t.gl.uniform2iv(a,new Int32Array(n.shape));break;case 3:t.gl.uniform3iv(a,new Int32Array(n.shape));break;case 4:t.gl.uniform4iv(a,new Int32Array(n.shape));break;default:break}if(e.outShapeStridesLocation){let l=w.computeStrides(n.shape);switch(n.shape.length){case 2:t.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(l));break;case 3:t.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(l));break;case 4:t.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(l));break;default:break}}e.outTexShapeLocation&&t.gl.uniform2i(e.outTexShapeLocation,n.texData.texShape[0],n.texData.texShape[1]),e.program.customUniforms&&o&&e.program.customUniforms.forEach((l,u)=>{let c=e.customUniformLocations[u],p=o[u];if(l.type==="float")t.gl.uniform1fv(c,p);else if(l.type==="vec2")t.gl.uniform2fv(c,p);else if(l.type==="vec3")t.gl.uniform3fv(c,p);else if(l.type==="vec4")t.gl.uniform4fv(c,p);else if(l.type==="int")t.gl.uniform1iv(c,p);else if(l.type==="ivec2")t.gl.uniform2iv(c,p);else if(l.type==="ivec3")t.gl.uniform3iv(c,p);else if(l.type==="ivec4")t.gl.uniform4iv(c,p);else throw Error(`uniform type ${l.type} is not supported yet.`)}),t.executeProgram()}function dW(t,e,r){let n="";e.concat(r).forEach(i=>{let a=i.texData!=null&&i.texData.slice!=null&&i.texData.slice.flatOffset>0;if(t.enableShapeUniforms&&!i.isUniform){let l=i.texData.texShape,{useSqueezeShape:u,uniformShape:c,keptDims:p}=TC(t.packedInputs,i.shape,l),f="",d="",m="";if(c.length===1&&t.packedInputs){let C=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)];f=`${C[0]>1}_${C[1]>1}`}else if(c.length===2&&!t.packedInputs)d=`${c[0]>1}_${c[1]>1}`;else if(c.length>2&&!t.packedInputs){let C=w.computeStrides(c);m=`${C[0]===l[1]}_${C[C.length-1]===l[1]}`}let h=i.shape.length,x=c.length===2&&w.arraysEqual(i.shape,l),g=w.sizeFromShape(i.shape)===1,y=T.getBroadcastDims(i.shape,r.shape),b=!t.packedInputs&&h===r.shape.length&&w.arraysEqual(l,r.texData.texShape),v=t.packedInputs||c.length>2?"":`${l[0]>1}_${l[1]>1}`;n+=`${h}_${b}_${u?p:""}_${c.length}_${g}_${y}_${x}_${f}_${d}_${m}_${v}_${a}`}else{let l=i.isUniform?"uniform":i.texData.texShape;n+=`${i.shape}_${l}_${a}`}});let o=t.userCode,s=t.constructor.name;return s+="_"+n+"_"+o+`${W().getNumber("WEBGL_VERSION")}`,s}function kt(t){return W().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&t<=4}var NC=class{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=_c.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];let r=Qt();this.outputShape=e,this.enableShapeUniforms=kt(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Af(["r","c","d"],e):hi(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${r.output} = result;
      }
    `}};var IC=class{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=_c.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];let r=Qt();this.outputShape=e,this.enableShapeUniforms=kt(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Af(["r","c","d"],e):hi(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${r.output} = result;
      }
    `}};var EC=class{constructor(e){this.variableNames=["A"],this.outTexUsage=Cn.DOWNLOAD;let r=Qt();this.outputShape=e,this.userCode=`
      ${kC}

      void main() {
        float x = getAAtOutCoords();
        ${r.output} = encode_float(x);
      }
    `}};var _C=class{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Cn.DOWNLOAD;let r=Qt();this.outputShape=e,this.userCode=`
      ${kC}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${r.output} = encode_float(x);
      }
    `}};var Tce={R:0,G:1,B:2,A:3},B0=class{constructor(e,r=!1,n="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];let o=Qt();this.outputShape=e,this.enableShapeUniforms=kt(this.outputShape.length);let s="result";r&&(s="floor(result * 255. + 0.5)");let i="";for(let a=0;a<n.length;a++){let l=n[a];i+=`
          if(offset == ${a}) {
            result = values[${Tce[l]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?Rh():$h(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${n.length});

        flatIndex = idiv(flatIndex, ${n.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${o.texture2D}(A, uv);
          ${i}
        }
        ${o.output} = vec4(${s}, 0., 0., 0.);
      }
    `}};var AC=class{constructor(e,r=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];let n=Qt();this.outputShape=e,this.enableShapeUniforms=kt(this.outputShape.length);let o="",s="result";r&&(s="floor(result * 255. + 0.5)");for(let i=0;i<=1;i++)for(let a=0;a<=1;a++){let l=i*2+a;o+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${i} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${i};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${n.texture2D}(A, uv);

            if (offset == 0) {
              result[${l}] = values[0];
            } else if (offset == 1) {
              result[${l}] = values[1];
            } else if (offset == 2) {
              result[${l}] = values[2];
            } else {
              result[${l}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?Rh():$h(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${o}

          ${n.output} = ${s};
        }
    `}};function mW(t){let e=Qt(),r=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return B5(t,r)}function hW(t){let e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return U5(t,e)}function gW(t){let e=new Uint16Array([0,1,2,2,1,3]);return H5(t,e)}function V0(t,e,r,n,o,s){j5(e,r);let i=q5(t),a=t.TEXTURE_2D;return Ce(t,()=>t.bindTexture(a,i)),Ce(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)),Ce(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),Ce(t,()=>t.texParameteri(a,t.TEXTURE_MIN_FILTER,t.NEAREST)),Ce(t,()=>t.texParameteri(a,t.TEXTURE_MAG_FILTER,t.NEAREST)),W().getNumber("WEBGL_VERSION")===1?Ce(t,()=>t.texImage2D(a,0,n,e,r,0,o,s,null)):Ce(t,()=>t.texStorage2D(a,1,n,e,r)),Ce(t,()=>t.bindTexture(t.TEXTURE_2D,null)),{texture:i,texShape:[r,e]}}function G_(t){return t.internalFormatFloat}function xW(t,e,r,n){let[o,s]=Ef(e,r);return V0(t,o,s,G_(n),n.textureFormatFloat,t.FLOAT)}function U_(t){return t.internalFormatHalfFloat}function yW(t,e,r,n){let[o,s]=Ef(e,r);return V0(t,o,s,U_(n),n.textureFormatFloat,n.textureTypeHalfFloat)}function H_(t){return t.downloadTextureFormat}function bW(t,e,r,n){let[o,s]=Ef(e,r);return V0(t,o,s,H_(n),t.RGBA,t.UNSIGNED_BYTE)}function q_(t){return t.internalFormatPackedFloat}function vW(t,e,r,n){let[o,s]=Ji(e,r);return V0(t,o,s,q_(n),t.RGBA,t.FLOAT)}function j_(t){return t.internalFormatPackedHalfFloat}function wW(t,e,r,n){let[o,s]=Ji(e,r);return V0(t,o,s,j_(n),t.RGBA,n.textureTypeHalfFloat)}function CW(t,e,r){return Ce(t,()=>t.bindBuffer(t.ARRAY_BUFFER,r)),z_(t,e,"clipSpacePos",r,3,20,0)&&z_(t,e,"uv",r,2,20,12)}function SW(t,e,r,n,o,s){Ce(t,()=>t.bindTexture(t.TEXTURE_2D,e));let i,a,l;o instanceof Uint8Array?(i=new Uint8Array(r*n*4),a=t.UNSIGNED_BYTE,l=t.RGBA):(i=new Float32Array(r*n*4),a=t.FLOAT,l=s.internalFormatPackedFloat),i.set(o),W().getNumber("WEBGL_VERSION")===2?Ce(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,r,n,t.RGBA,a,i)):Ce(t,()=>t.texImage2D(t.TEXTURE_2D,0,l,r,n,0,t.RGBA,a,i)),Ce(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function kW(t,e,r){Ce(t,()=>t.bindTexture(t.TEXTURE_2D,e)),r.data instanceof Uint8Array?W().getNumber("WEBGL_VERSION")===2?Ce(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,r.width,r.height,t.RGBA,t.UNSIGNED_BYTE,r.data)):Ce(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,r.width,r.height,0,t.RGBA,t.UNSIGNED_BYTE,r.data)):W().getNumber("WEBGL_VERSION")===2?Ce(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,r)):Ce(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r)),Ce(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function TW(t,e,r,n){let o=t.createBuffer();Ce(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,o));let a=4*4*e*r;return Ce(t,()=>t.bufferData(t.PIXEL_PACK_BUFFER,a,t.STREAM_READ)),Ce(t,()=>t.readPixels(0,0,r,e,t.RGBA,t.FLOAT,0)),Ce(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,null)),o}function NW(t,e,r){let n=t,o=new Float32Array(r);return n.bindBuffer(n.PIXEL_PACK_BUFFER,e),n.getBufferSubData(n.PIXEL_PACK_BUFFER,0,o),n.bindBuffer(n.PIXEL_PACK_BUFFER,null),o}function IW(t,e,r,n){let[o,s]=Ef(e,r),i=4,a=new Uint8Array(L5(e*r,i));return Ce(t,()=>t.readPixels(0,0,o,s,n.downloadTextureFormat,t.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function EW(t,e,r,n,o,s,i,a){let l=t,u=new Float32Array(M5(s,i));return l.bindBuffer(l.PIXEL_PACK_BUFFER,e),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,u),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),u}function _W(t,e,r){let n=new Float32Array(e*r*4);return Ce(t,()=>t.readPixels(0,0,r,e,t.RGBA,t.FLOAT,n)),n}var zh=class{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];let r=W().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,P5(r,e)):this.gl=Ro(r),e=this.gl,W().getNumber("WEBGL_VERSION")===2){let s=e;this.createVertexArray=()=>Ce(s,()=>s.createVertexArray()),this.bindVertexArray=i=>Ce(s,()=>s.bindVertexArray(i)),this.deleteVertexArray=i=>Ce(s,()=>s.deleteVertexArray(i)),this.getVertexArray=()=>Ce(s,()=>s.getParameter(s.VERTEX_ARRAY_BINDING))}else if(e!=null){let s=e.getExtension("OES_vertex_array_object");if(s==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>Ce(e,()=>s.createVertexArrayOES()),this.bindVertexArray=i=>Ce(e,()=>s.bindVertexArrayOES(i)),this.deleteVertexArray=i=>Ce(e,()=>s.deleteVertexArrayOES(i)),this.getVertexArray=()=>Ce(e,()=>e.getParameter(s.VERTEX_ARRAY_BINDING_OES))}let n="WEBGL_color_buffer_float",o="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),W().getNumber("WEBGL_VERSION")===1){let s="OES_texture_float",i="OES_texture_half_float";if(this.textureFloatExtension=L0(this.gl,s),ts(this.gl,i))this.textureHalfFloatExtension=L0(this.gl,i);else if(W().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),ts(this.gl,o))this.colorBufferHalfFloatExtension=L0(this.gl,o);else if(W().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",ts(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else if(ts(this.gl,o))this.colorBufferHalfFloatExtension=this.gl.getExtension(o);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=hW(this.gl),this.indexBuffer=gW(this.gl),this.framebuffer=K5(this.gl),this.textureConfig=P0(this.gl,this.textureHalfFloatExtension)}get debug(){return W().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");let e=this.gl;Ce(e,()=>e.finish()),Ce(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),Ce(e,()=>e.deleteFramebuffer(this.framebuffer)),Ce(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),Ce(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),Ce(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,r){return this.throwIfDisposed(),xW(this.gl,e,r,this.textureConfig)}createFloat16MatrixTexture(e,r){return this.throwIfDisposed(),yW(this.gl,e,r,this.textureConfig)}createUnsignedBytesMatrixTexture(e,r){return this.throwIfDisposed(),bW(this.gl,e,r,this.textureConfig)}uploadPixelDataToTexture(e,r){this.throwIfDisposed(),kW(this.gl,e,r)}uploadDenseMatrixToTexture(e,r,n,o){this.throwIfDisposed(),SW(this.gl,e,r,n,o,this.textureConfig)}createFloat16PackedMatrixTexture(e,r){return this.throwIfDisposed(),wW(this.gl,e,r,this.textureConfig)}createPackedMatrixTexture(e,r){return this.throwIfDisposed(),vW(this.gl,e,r,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(B_(this.gl,this.framebuffer),this.outputTexture=null),Ce(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,r,n){return this.downloadMatrixDriver(e,()=>IW(this.gl,r,n,this.textureConfig))}downloadPackedMatrixFromBuffer(e,r,n,o,s,i){return EW(this.gl,e,r,n,o,s,i,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,r){return NW(this.gl,e,r)}createBufferFromTexture(e,r,n){this.bindTextureToFrameBuffer(e);let o=TW(this.gl,r,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),o}createAndWaitForFence(){let e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let r,n;if(W().getBool("WEBGL_FENCE_API_ENABLED")){let o=e,s=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=()=>{let i=o.clientWaitSync(s,0,0);return i===o.ALREADY_SIGNALED||i===o.CONDITION_SATISFIED},r=s}else W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(r=this.beginQuery(),this.endQuery(),n=()=>this.isQueryAvailable(r,W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):n=()=>!0;return{query:r,isFencePassed:n}}downloadMatrixFromPackedTexture(e,r,n){return this.downloadMatrixDriver(e,()=>_W(this.gl,r,n))}createProgram(e){this.throwIfDisposed();let r=this.gl;this.vertexShader==null&&(this.vertexShader=mW(r));let n=W5(r);Ce(r,()=>r.attachShader(n,this.vertexShader)),Ce(r,()=>r.attachShader(n,e)),G5(r,n);let o;return o=Object.assign(n,{vao:this.createVertexArray()}),this.bindVertexArray(o.vao),Ce(r,()=>r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),console.assert(CW(r,o,this.vertexBuffer),"gpgpu_util.bindVertexProgramAttributeStreams not fully successful."),this.debug&&wC(r,o),this.setProgram(o),o}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(Ce(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&(this.bindVertexArray(this.program.vao),this.debug&&wC(this.gl,this.program)),Ce(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,r,n=!0){return this.throwIfDisposed(),n?X5(this.gl,e,r):Y5(this.gl,e,r)}getAttributeLocation(e,r){return this.throwIfDisposed(),Ce(this.gl,()=>this.gl.getAttribLocation(e,r))}getUniformLocationNoThrow(e,r){return this.throwIfDisposed(),this.gl.getUniformLocation(e,r)}setInputMatrixTexture(e,r,n){this.throwIfDisposed(),this.throwIfNoProgram(),Q5(this.gl,e,r,n)}setOutputMatrixTexture(e,r,n){this.setOutputMatrixTextureDriver(e,n,r)}setOutputPackedMatrixTexture(e,r,n){this.throwIfDisposed();let[o,s]=Ji(r,n);this.setOutputMatrixTextureDriver(e,o,s)}setOutputMatrixWriteRegion(e,r,n,o){this.setOutputMatrixWriteRegionDriver(n,e,o,r)}setOutputPackedMatrixWriteRegion(e,r,n,o){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&wC(this.gl,this.program),M0(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();let e=this.gl;if(this.debug){let r=this.getVertexArray();console.assert(r===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}Ce(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),Ce(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=L0(this.gl,W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){let n=this.gl,o=this.getQueryTimerExtensionWebGL2(),s=n.createQuery();return n.beginQuery(o.TIME_ELAPSED_EXT,s),s}let e=this.getQueryTimerExtensionWebGL1(),r=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,r),r}endQuery(){if(W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){let r=this.gl,n=this.getQueryTimerExtensionWebGL2();r.endQuery(n.TIME_ELAPSED_EXT);return}let e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await w.repeatedTry(()=>this.disposed||this.isQueryAvailable(e,W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,r){if(r===0)return null;if(r===2){let n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}else{let n=this.getQueryTimerExtensionWebGL1();return n.getQueryObjectEXT(e,n.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,r){if(r===0)return!0;if(r===2){let n=this.gl,o=this.getQueryTimerExtensionWebGL2(),s=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),s&&!this.disjoint}else{let n=this.getQueryTimerExtensionWebGL1(),o=n.getQueryObjectEXT(e,n.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(n.GPU_DISJOINT_EXT)),o&&!this.disjoint}}pollFence(e){return new Promise(r=>{this.addItemToPoll(()=>e.isFencePassed(),()=>r())})}pollItems(){let e=Ice(this.itemsToPoll.map(r=>r.isDoneFn));for(let r=0;r<=e;++r){let{resolveFn:n}=this.itemsToPoll[r];n()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,r){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:r}),this.itemsToPoll.length>1)return;let n;"setTimeoutCustom"in W().platform&&(n=W().platform.setTimeoutCustom.bind(W().platform)),w.repeatedTry(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,n)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),CC(this.gl,e,this.framebuffer),this.debug&&M0(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(CC(this.gl,this.outputTexture,this.framebuffer),this.debug&&M0(this.gl)):B_(this.gl,this.framebuffer)}downloadMatrixDriver(e,r){this.bindTextureToFrameBuffer(e);let n=r();return this.unbindTextureToFrameBuffer(),n}setOutputMatrixTextureDriver(e,r,n){this.throwIfDisposed();let o=this.gl;CC(o,e,this.framebuffer),this.debug&&M0(o),this.outputTexture=e,Ce(o,()=>o.viewport(0,0,r,n)),Ce(o,()=>o.scissor(0,0,r,n))}setOutputMatrixWriteRegionDriver(e,r,n,o){this.throwIfDisposed(),Ce(this.gl,()=>this.gl.scissor(e,r,n,o))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}};function Ice(t){let e=0;for(;e<t.length&&t[e]();++e);return e-1}var{addImpl:AW,bincountImpl:DC,bincountReduceImpl:DW,castImpl:$W,ceilImpl:RW,concatImpl:OW,equalImpl:FW,expImpl:PW,expm1Impl:LW,floorImpl:MW,gatherNdImpl:zW,gatherV2Impl:BW,greaterImpl:VW,greaterEqualImpl:WW,lessImpl:GW,lessEqualImpl:UW,linSpaceImpl:HW,logImpl:qW,maxImpl:jW,maximumImpl:KW,minimumImpl:XW,multiplyImpl:YW,negImpl:QW,notEqualImpl:ZW,prodImpl:JW,raggedGatherImpl:eG,raggedRangeImpl:tG,raggedTensorToTensorImpl:rG,rangeImpl:nG,rsqrtImpl:oG,scatterImpl:sG,sigmoidImpl:iG,simpleAbsImpl:$C,sliceImpl:aG,sparseFillEmptyRowsImpl:lG,sparseReshapeImpl:uG,sparseSegmentReductionImpl:RC,sqrtImpl:cG,stridedSliceImpl:pG,stringNGramsImpl:fG,stringSplitImpl:dG,stringToHashBucketFastImpl:mG,subImpl:hG,tileImpl:gG,topKImpl:xG,transposeImpl:$f,uniqueImpl:yG}=w_;function K_(t,e){return["x","y","z","w","u","v"].slice(0,e).map(r=>`${t}.${r}`)}function lr(t,e){return e===1?[t]:K_(t,e)}function bG(t,e){if(t===1)return"rc";let r="";for(let n=0;n<t;n++)r+=e[n],n<t-1&&(r+=",");return r}var OC=class{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=kt(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{let r=lr("rc",this.rank),n=je(this.rank),o=this.getOutOfBoundsCondition(r),s=this.getSetup(r),i=this.getOutput(r);this.userCode=`
        void main() {
          ${n} rc = getOutputCoords();

          if(${o}) {
            setOutput(vec4(0));
          } else {
            ${s}

            setOutput(vec4(${i}));
          }
        }
      `}}getSourceCoordsArr(e){let r=[];for(let n=0;n<=1;n++)for(let o=0;o<=1;o++){let s=`${n===0?"r":"rp1"}, ${o===0?"c":"cp1"}`;for(let i=2;i<this.rank;i++)s=`${e[e.length-1-i]},`+s;r.push(s)}return r}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let r="";for(let n=this.rank-2;n<this.rank;n++)r+=`${e[n]} >= ${this.enableShapeUniforms?`outShape[${n}]`:this.outputShape[n]}`,n<this.rank-1&&(r+="||");return r}getSetup(e){if(this.rank===1)return"";let r=e.slice(-2),n=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],o=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${r[0]};
      int c = ${r[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${n};
      bool rEdge = rp1 >= ${o};
    `}getOutput(e){let r=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${r[0]}),
            cEdge ? 0. : getA(${r[1]}),
            rEdge ? 0. : getA(${r[2]}),
            rEdge || cEdge ? 0. : getA(${r[3]})`}};var Bh=class{constructor(e,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=kt(this.outputShape.length);let n="";for(let o=0;o<4;o++){let s="thisRC = rc;";o%2===1&&(s+="thisRC.z += 1;"),o>1&&(s+="thisRC.y += 1;"),n+=`
        ${s}
        ${o>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${o}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${o>0?"}":""}
      `}this.userCode=`
      ${Ece(r,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?Rh():$h(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${n}

        setOutput(result);
      }
    `}};function Ece(t,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?sW(["r","c","d"],"inputShape"):hi(["r","c","d"],t)}
      return ivec3(r, c, d);
    }
  `}var FC=class{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}acquireTexture(e,r,n){let o=wG(r,n),s=CG(e,o,n);s in this.freeTextures||(this.freeTextures[s]=[]),s in this.usedTextures||(this.usedTextures[s]=[]);let i=vG(e,o,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[s].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=i,this.log();let l=this.freeTextures[s].shift();return this.usedTextures[s].push(l),l}let a;return o===un.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):o===un.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):o===un.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):o===un.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):o===un.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[s].push(a),this.numUsedTextures++,this._numBytesAllocated+=i,this.log(),a}releaseTexture(e,r,n,o){if(this.freeTextures==null)return;let s=wG(n,o),i=CG(r,s,o);i in this.freeTextures||(this.freeTextures[i]=[]);let a=vG(r,s,this.gpgpu.gl,this.gpgpu.textureConfig,o),l=W().get("WEBGL_DELETE_TEXTURE_THRESHOLD");l!==-1&&this._numBytesAllocated>l?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=a):(this.freeTextures[i].push(e),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;let u=this.usedTextures[i],c=u.indexOf(e);if(c<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u.splice(c,1),this.log()}log(){if(!this.logEnabled)return;let e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);let r=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*r)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(let e in this.freeTextures)this.freeTextures[e].forEach(r=>{this.gpgpu.deleteMatrixTexture(r.texture)});for(let e in this.usedTextures)this.usedTextures[e].forEach(r=>{this.gpgpu.deleteMatrixTexture(r.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}};function _ce(t,e){let r=t;if(e===r.R32F)return 4;if(e===r.R16F)return 2;if(e===r.RGBA32F)return 16;if(e===t.RGBA)return 16;if(e===r.RGBA16F)return 8;if(e===r.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function vG(t,e,r,n,o){let s=Ace(e,n),i;if(o){let[l,u]=Ji(t[0],t[1]);i=l*u}else{let[l,u]=Ef(t[0],t[1]);i=l*u}let a=_ce(r,s);return i*a}function Ace(t,e){switch(t){case un.PACKED_2X2_FLOAT32:return q_(e);case un.PACKED_2X2_FLOAT16:return j_(e);case un.UNPACKED_FLOAT32:return G_(e);case un.UNPACKED_FLOAT16:return U_(e);case un.PACKED_4X1_UNSIGNED_BYTE:return H_(e);default:throw new Error(`Unknown physical texture type ${t}`)}}function Dce(t){return W().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?un.PACKED_2X2_FLOAT32:un.UNPACKED_FLOAT32:t?un.PACKED_2X2_FLOAT16:un.UNPACKED_FLOAT16}function wG(t,e){if(t===Cn.UPLOAD)return un.PACKED_2X2_FLOAT32;if(t===Cn.RENDER||t==null)return Dce(e);if(t===Cn.DOWNLOAD||t===Cn.PIXELS)return un.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${t}`)}function CG(t,e,r){return`${t[0]}_${t[1]}_${e}_${r}`}var cn=class{constructor(e,r){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=kt(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${r}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}},Or="if (isnan(x)) return x;",SG="return x;",X_="return abs(x);";var kG="return (x >= 0.0) ? x : (exp(x) - 1.0);",TG=Or+`
  return (x < 0.0) ? 0.0 : x;
`,NG=Or+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,ta="return x;",IG="return 1.0 / (1.0 + exp(-1.0 * x));";var _G="return x;",AG=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,DG=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,$G=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,RG="return 1.0 / (1.0 + exp(-1.0 * x));",uo=class{constructor(e,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=kt(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${r}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}};var PC=class{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=kt(this.outputShape.length);let r=e.length,n=lr("rc",r),o=je(r),s=bG(r,n),i=n.slice(-2),a=r<=1?"rc":`vec2(${i.join(",")})`;this.userCode=`
      void main() {
        ${o} rc = getOutputCoords();
        vec4 packedInput = getA(${s});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}};var Rce=bn.whereImpl,Oce=1e-7,Fce=1e-4,LC={};function Pce(t){return t in LC||(LC[t]={}),LC[t]}var Lce=W().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),Mce=600;function zce(){return W().global.screen==null?1024:W().global.screen.height*W().global.screen.width*window.devicePixelRatio*Mce/1024/1024}var Rf=class extends ya{constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!W().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let r;if(e!=null){if(e instanceof zh)r=e;else{let n=Ro(W().getNumber("WEBGL_VERSION"),e);r=new zh(n)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{let n=Ro(W().getNumber("WEBGL_VERSION"));r=new zh(n),this.binaryCache=Pce(W().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=r,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new FC(this.gpgpu),this.numMBBeforeWarning=zce(),this.texData=new kp(this,ys())}nextDataId(){return Rf.nextDataId++}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,r,n,o,s,i){let a=this.makeTensorInfo(r,n),l=this.texData.get(a.dataId);l.isPacked=!1,l.texture={texture:e,texShape:[o,s]},l.texShape=[o,s];let u=z0(r),c=new B0(u,!1,i),p=this.runWebGLProgram(c,[a],n,[[o,s]]);return p.shape=r,l.texture=null,this.disposeIntermediateTensorInfo(a),p.dataId}write(e,r,n){if((W().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||W().getBool("DEBUG"))&&this.checkNumericalProblems(e),n==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");let o={id:this.nextDataId()};return this.texData.set(o,{shape:r,dtype:n,values:e,usage:Cn.UPLOAD,refCount:1}),o}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){let r=this.texData.get(e);r.refCount++}decRef(e){if(this.texData.has(e)){let r=this.texData.get(e);r.refCount--}}move(e,r,n,o,s){if(W().getBool("DEBUG")&&this.checkNumericalProblems(r),o==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:o,values:r,usage:Cn.UPLOAD,refCount:s})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){let r=this.texData.get(e),{values:n,dtype:o,complexTensorInfos:s,slice:i,shape:a,isPacked:l}=r;if(i!=null){let f;l?f=new uo(a,ta):f=new cn(a,ta);let d=this.runWebGLProgram(f,[{dataId:e,shape:a,dtype:o}],o),m=this.readSync(d.dataId);return this.disposeIntermediateTensorInfo(d),m}if(n!=null)return this.convertAndCacheOnCPU(e);if(o==="string")return n;let u=this.activeTimers!=null,c;u&&(c=w.now());let p;if(o==="complex64"){let f=this.readSync(s.real.dataId),d=this.readSync(s.imag.dataId);p=T.mergeRealAndImagArrays(f,d)}else p=this.getValuesFromTexture(e);return u&&(this.downloadWaitMs+=w.now()-c),this.convertAndCacheOnCPU(e,p)}async read(e){if(this.pendingRead.has(e)){let m=this.pendingRead.get(e);return new Promise(h=>m.push(h))}let r=this.texData.get(e),{values:n,shape:o,slice:s,dtype:i,complexTensorInfos:a,isPacked:l}=r;if(s!=null){let m;l?m=new uo(o,ta):m=new cn(o,ta);let h=this.runWebGLProgram(m,[{dataId:e,shape:o,dtype:i}],i),x=this.read(h.dataId);return this.disposeIntermediateTensorInfo(h),x}if(n!=null)return this.convertAndCacheOnCPU(e);if(W().getBool("DEBUG")&&!W().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&W().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let u=null,c;if(i!=="complex64"&&W().get("WEBGL_BUFFER_SUPPORTED")){c=this.decode(e);let m=this.texData.get(c.dataId);u=this.gpgpu.createBufferFromTexture(m.texture.texture,...F0(o))}this.pendingRead.set(e,[]),i!=="complex64"&&await this.gpgpu.createAndWaitForFence();let p;if(i==="complex64"){let m=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),h=m[0],x=m[1];p=T.mergeRealAndImagArrays(h,x)}else if(u==null)p=this.getValuesFromTexture(e);else{let m=w.sizeFromShape(o);p=this.gpgpu.downloadFloat32MatrixFromBuffer(u,m)}if(c!=null&&this.disposeIntermediateTensorInfo(c),u!=null){let m=this.gpgpu.gl;Ce(m,()=>m.deleteBuffer(u))}let f=this.convertAndCacheOnCPU(e,p),d=this.pendingRead.get(e);return this.pendingRead.delete(e),d.forEach(m=>m(f)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&ys().removeDataId(e,this),this.pendingDeletes--),f}readToGPU(e,r={}){let n=this.texData.get(e),{values:o,shape:s,slice:i,dtype:a,isPacked:l,texture:u}=n;if(a==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(i!=null){let d;l?d=new uo(s,ta):d=new cn(s,ta);let m=this.runWebGLProgram(d,[{dataId:e,shape:s,dtype:a}],a),h=this.readToGPU(m,r);return this.disposeIntermediateTensorInfo(m),h}if(u==null)throw o!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");let c=this.decode(e,r.customTexShape),p=ys().makeTensorFromTensorInfo(c),f=this.texData.get(c.dataId);return Object.assign({tensorRef:p},f.texture)}bufferSync(e){let r=this.readSync(e.dataId);if(e.dtype==="string")try{let n=r.map(o=>w.decodeString(o));return Ie(e.shape,e.dtype,n)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Ie(e.shape,e.dtype,r)}checkNumericalProblems(e){if(e!=null)for(let r=0;r<e.length;r++){let n=e[r];if(!z5(n))throw W().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${n} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${n} cannot be represented on this device.`)}}getValuesFromTexture(e){let{shape:r,dtype:n,isPacked:o}=this.texData.get(e),s=w.sizeFromShape(r);if(W().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){let f=this.decode(e),d=this.texData.get(f.dataId),m=this.gpgpu.downloadMatrixFromPackedTexture(d.texture.texture,...F0(r)).subarray(0,s);return this.disposeIntermediateTensorInfo(f),m}let i=W().getBool("WEBGL_PACK")&&o===!0,a=i?z0(r):r,l=i?new _C(a):new EC(a),u=this.runWebGLProgram(l,[{shape:a,dtype:n,dataId:e}],"float32"),c=this.texData.get(u.dataId),p=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(c.texture.texture,c.texShape[0],c.texShape[1]).subarray(0,s);return this.disposeIntermediateTensorInfo(u),p}timerAvailable(){return W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){let r=this.activeTimers,n=[],o=!1;this.programTimersStack==null?(this.programTimersStack=n,o=!0):this.activeTimers.push(n),this.activeTimers=n,e();let s=w.flatten(this.activeTimers.map(l=>l.query)).filter(l=>l!=null),i=w.flatten(this.activeTimers.map(l=>l.name)).filter(l=>l!=null);this.activeTimers=r,o&&(this.programTimersStack=null);let a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){let l=await Promise.all(s);a.kernelMs=w.sum(l),a.getExtraProfileInfo=()=>l.map((u,c)=>({name:i[c],ms:u})).map(u=>`${u.name}: ${u.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:w.now(),endMs:null}}endTimer(e){return W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=w.now(),e)}async getQueryTime(e){if(W().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);let r=e;return r.endMs-r.startMs}disposeData(e,r=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(r?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!r&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);let{complexTensorInfos:n}=this.texData.get(e);return n!=null&&(this.disposeData(n.real.dataId,r),this.disposeData(n.imag.dataId,r)),this.texData.delete(e),!0}releaseGPUData(e){let{texture:r,dtype:n,texShape:o,usage:s,isPacked:i,slice:a}=this.texData.get(e),l=a&&a.origDataId||e,u=this.dataRefCount.get(l);u>1?this.dataRefCount.set(l,u-1):(this.dataRefCount.delete(l),r!=null&&(this.numBytesInGPU-=this.computeBytes(o,n),this.textureManager.releaseTexture(r,o,s,i)));let c=this.texData.get(e);c.texture=null,c.texShape=null,c.isPacked=!1,c.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,r=Lce){return W().getBool("WEBGL_CPU_FORWARD")&&e.every(n=>this.texData.get(n.dataId).texture==null&&w.sizeFromShape(n.shape)<r)}getGPGPUContext(){return this.gpgpu}where(e){T.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");let r=e.dataSync();return Rce(e.shape,r)}packedUnaryOp(e,r,n){let o=new uo(e.shape,r),s=this.compileAndRun(o,[e],n);return ys().makeTensorFromTensorInfo(s)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){let o=$C(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,o)}if(W().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,X_,e.dtype);let r=new cn(e.shape,X_),n=this.compileAndRun(r,[e]);return ys().makeTensorFromTensorInfo(n)}makeTensorInfo(e,r,n){let o;if(r==="string"&&n!=null&&n.length>0&&w.isString(n[0])){let s=n.map(i=>w.encodeString(i));o=this.write(s,e,r)}else o=this.write(n,e,r);return this.texData.get(o).usage=null,{dataId:o,shape:e,dtype:r}}makeOutput(e,r,n){return ys().makeTensorFromTensorInfo(this.makeTensorInfo(e,r,n),this)}unpackTensor(e){let r=new PC(e.shape);return this.runWebGLProgram(r,[e],e.dtype)}packTensor(e){let r=new OC(e.shape),n=!0;return this.runWebGLProgram(r,[e],e.dtype,null,n)}packedReshape(e,r){let n=[Ac(e.shape),...Dc(e.shape)],o={dtype:e.dtype,shape:n,dataId:e.dataId},s=[Ac(r),...Dc(r)],i=new Bh(s,n),a=!0,l=[n],u=this.runWebGLProgram(i,[o],e.dtype,l,a);return{dataId:u.dataId,shape:r,dtype:u.dtype}}decode(e,r){let n=this.texData.get(e),{isPacked:o,shape:s,dtype:i}=n;if(r!=null){let f=w.sizeFromShape(s),d=r[0]*r[1]*4;w.assert(f<=d,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}let a=z0(s),l;o?l=new IC(a):l=new NC(a);let u=!0,c=[r??F0(a)],p=this.runWebGLProgram(l,[{shape:a,dtype:i,dataId:e}],i,c,u,r);return{dtype:i,shape:s,dataId:p.dataId}}runWebGLProgram(e,r,n,o,s=!1,i){let a=this.makeTensorInfo(e.outputShape,n),l=this.texData.get(a.dataId);if(e.packedOutput&&(l.isPacked=!0),e.outPackingScheme===_c.DENSE){let g=i??F0(e.outputShape);l.texShape=g.map(y=>y*2)}if(e.outTexUsage!=null&&(l.usage=e.outTexUsage),w.sizeFromShape(a.shape)===0)return l.values=w.getTypedArrayFromDType(a.dtype,0),a;let u=[],c=r.map(g=>{if(g.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let y=this.texData.get(g.dataId);if(y.texture==null){if(!e.packedInputs&&w.sizeFromShape(g.shape)<=W().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:g.shape,texData:null,isUniform:!0,uniformValues:y.values};e.packedInputs&&(y.isPacked=!0,y.shape=g.shape)}if(this.uploadToGPU(g.dataId),!!y.isPacked!=!!e.packedInputs)g=y.isPacked?this.unpackTensor(g):this.packTensor(g),u.push(g),y=this.texData.get(g.dataId);else if(y.isPacked&&!_f(y.shape,g.shape)){let b=g,v=g.shape;g.shape=y.shape,g=this.packedReshape(g,v),u.push(g),y=this.texData.get(g.dataId),b.shape=v}return{shape:g.shape,texData:y,isUniform:!1}});this.uploadToGPU(a.dataId);let p={shape:a.shape,texData:l,isUniform:!1},f=dW(e,c,p),d=this.getAndSaveBinary(f,()=>pW(this.gpgpu,e,c,p)),m=this.activeTimers!=null,h;m&&(h=this.startTimer()),W().get("ENGINE_COMPILE_ONLY")||fW(this.gpgpu,d,c,p,o),u.forEach(g=>this.disposeIntermediateTensorInfo(g)),m&&(h=this.endTimer(h),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(h)}));let x=W().get("WEBGL_FLUSH_THRESHOLD");if(x>0){let g=w.now();g-this.lastGlFlushTime>x&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=g)}if(!W().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&s===!1){let g=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),g}return a}compileAndRun(e,r,n,o,s=!1){return n=n||r[0].dtype,this.runWebGLProgram(e,r,n,o,s)}getAndSaveBinary(e,r){return e in this.binaryCache||(this.binaryCache[e]=r()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(W().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(r=>{this.gpgpu.deleteProgram(this.binaryCache[r].webGLProgram),delete this.binaryCache[r]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=G(()=>{if(!W().get("WEBGL_RENDER_FLOAT32_ENABLED")){let e=W().getBool("DEBUG");W().set("DEBUG",!1);let r=this.abs(Oe(1e-8)).dataSync()[0];if(W().set("DEBUG",e),r>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?Oce:Fce}uploadToGPU(e){let r=this.texData.get(e),{shape:n,dtype:o,values:s,texture:i,usage:a,isPacked:l}=r;if(i!=null)return;let u=this.activeTimers!=null,c;u&&(c=w.now());let p=r.texShape;if(p==null&&(p=Z5(n,l),r.texShape=p),s!=null){let f=z0(n),d,m=p[1],h=p[0],x=s instanceof Uint8Array||s instanceof Uint8ClampedArray;(l||!x)&&([m,h]=Ji(p[0],p[1])),l?d=new AC(f,x):d=new B0(f,x);let g=x?[h,m]:p,y=this.makeTensorInfo(g,o),b=this.texData.get(y.dataId);x?b.usage=Cn.PIXELS:b.usage=Cn.UPLOAD,b.texShape=g,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(y.dataId),m,h,s);let v=[[h,m]],C=!0,S=this.runWebGLProgram(d,[y],o,v,C),k=this.texData.get(S.dataId);r.texShape=k.texShape,r.isPacked=k.isPacked,r.usage=k.usage,W().get("ENGINE_COMPILE_ONLY")?this.disposeData(S.dataId):(r.texture=k.texture,r.values=null,this.texData.delete(S.dataId)),this.disposeIntermediateTensorInfo(y),u&&(this.uploadWaitMs+=w.now()-c)}else{let f=this.acquireTexture(p,a,o,l);r.texture=f}}convertAndCacheOnCPU(e,r){let n=this.texData.get(e),{dtype:o}=n;return r!=null&&(n.values=Bce(r,o)),n.values}acquireTexture(e,r,n,o){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){let s=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${s} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,r,o)}computeBytes(e,r){return e[0]*e[1]*w.bytesPerElement(r)}checkCompileCompletion(){for(let[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){let e=[];if(this.gpgpu.parallelCompilationExtension){for(let[,r]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(r));return Promise.all(e)}else{for(let[,r]of Object.entries(this.binaryCache)){let n=new Promise(o=>{try{this.checkCompletion_(r),o(!0)}catch(s){throw s}});e.push(n)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await Zx(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(M_(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(let[,e]of Object.entries(this.binaryCache)){let{uniformLocations:r,customUniformLocations:n,infLoc:o,nanLoc:s,inShapesLocations:i,inTexShapesLocations:a,outShapeLocation:l,outShapeStridesLocation:u,outTexShapeLocation:c}=W_(this.gpgpu,e.program,e.webGLProgram);e.uniformLocations=r,e.customUniformLocations=n,e.infLoc=o,e.nanLoc=s,e.inShapesLocations=i,e.inTexShapesLocations=a,e.outShapeLocation=l,e.outShapeStridesLocation=u,e.outTexShapeLocation=c}}createTensorFromTexture(e,r,n){let{texture:o,height:s,width:i,channels:a}=e,l=ys().backend;if(!l.gpgpu.gl.isTexture(o))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");let u=l.writeTexture(o,r,n,s,i,a);return ys().makeTensorFromDataId(u,r,n,l)}};Rf.nextDataId=0;function Bce(t,e){if(e==="float32"||e==="complex64")return t;if(e==="int32"||e==="bool"){let r=e==="int32"?new Int32Array(t.length):new Uint8Array(t.length);for(let n=0;n<r.length;++n)r[n]=Math.round(t[n]);return r}else throw new Error(`Unknown dtype ${e}`)}fc.isBrowser()&&v1("webgl",()=>new Rf,2);var Vh=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;var rs=class{constructor(e,r,n){this.variableNames=["A","B"],this.outputShape=T.assertAndGetBroadcastShape(r,n),this.enableShapeUniforms=kt(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}};var ra=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;var Ls=class{constructor(e,r,n,o=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=T.assertAndGetBroadcastShape(r,n);let s=this.outputShape.length;this.enableShapeUniforms=kt(s);let i="";if(o)if(s===0||w.sizeFromShape(this.outputShape)===1)i=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(i=`
          ${je(s)} coords = getOutputCoords();
        `,s===1)this.enableShapeUniforms?i+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:i+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{let l=lr("coords",s);this.enableShapeUniforms?i+=`
            bool nextRowOutOfBounds =
              (${l[s-2]} + 1) >= outShape[${s} - 2];
            bool nextColOutOfBounds =
              (${l[s-1]} + 1) >= outShape[${s} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:i+=`
            bool nextRowOutOfBounds =
              (${l[s-2]} + 1) >= ${this.outputShape[s-2]};
            bool nextColOutOfBounds =
              (${l[s-1]} + 1) >= ${this.outputShape[s-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${i}

        setOutput(result);
      }
    `}};function ur(t){let{inputs:e,backend:r}=t,{x:n}=e;return r.incRef(n.dataId),{dataId:n.dataId,shape:n.shape,dtype:n.dtype}}var OG={kernelName:Fi,backendName:"webgl",kernelFunc:ur};function co(t){let{inputs:e,backend:r}=t,{real:n,imag:o}=e,s=r.makeTensorInfo(n.shape,"complex64"),i=r.texData.get(s.dataId),a=ur({inputs:{x:n},backend:r}),l=ur({inputs:{x:o},backend:r});return i.complexTensorInfos={real:a,imag:l},s}var FG={kernelName:Wd,backendName:"webgl",kernelFunc:co};var Y_="return (a < 0.) ? b * a : a;",Q_=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Vce(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{alpha:s}=n,i=r.makeTensorInfo([],"float32",w.createScalarValue(s,"float32")),a=W().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ls(Q_,o.shape,i.shape):new rs(Y_,o.shape,i.shape),l=r.runWebGLProgram(a,[o,i],"float32");return r.disposeIntermediateTensorInfo(i),l}var PG={kernelName:Pu,backendName:"webgl",kernelFunc:Vce};var Z_="return (a < 0.) ? b * a : a;",J_=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Wce(t){let{inputs:e,backend:r}=t,{x:n,alpha:o}=e,s=W().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ls(J_,n.shape,o.shape):new rs(Z_,n.shape,o.shape);return r.runWebGLProgram(s,[n,o],"float32")}var LG={kernelName:Xu,backendName:"webgl",kernelFunc:Wce};var Ms="if (isnan(x)) return x;";function Te({opSnippet:t,packedOpSnippet:e,cpuKernelImpl:r,dtype:n}){return({inputs:o,backend:s})=>{let{x:i}=o,a=s,l=n||i.dtype;if(a.shouldExecuteOnCPU([i])&&r!=null){let p=a.texData.get(i.dataId),f=r(p.values,l);return a.makeTensorInfo(i.shape,l,f)}let u=W().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null,c;return u?c=new uo(i.shape,e):c=new cn(i.shape,t),a.runWebGLProgram(c,[i],l)}}function lt({opSnippet:t,packedOpSnippet:e,checkOutOfBounds:r=!1,supportsComplex:n=!1,cpuKernelImpl:o,dtype:s}){return({inputs:i,backend:a})=>{let{a:l,b:u}=i,c=a;if(n&&l.dtype==="complex64"){let m=c.texData.get(l.dataId),h=c.texData.get(u.dataId),[x,g]=[[m.complexTensorInfos.real,h.complexTensorInfos.real],[m.complexTensorInfos.imag,h.complexTensorInfos.imag]].map(b=>{let[v,C]=b,S={dataId:v.dataId,dtype:v.dtype,shape:l.shape},k={dataId:C.dataId,dtype:C.dtype,shape:u.shape},I=new rs(t,l.shape,u.shape);return c.runWebGLProgram(I,[S,k],wr(v.dtype,C.dtype))}),y=co({inputs:{real:x,imag:g},backend:c});return c.disposeIntermediateTensorInfo(x),c.disposeIntermediateTensorInfo(g),y}let p=s||wr(l.dtype,u.dtype);if((l.dtype==="string"||u.dtype==="string"||c.shouldExecuteOnCPU([l,u]))&&o!=null){let m=c.texData.get(l.dataId).values,h=c.texData.get(u.dataId).values,x=l.dtype==="string"?T.fromUint8ToStringArray(m):m,g=l.dtype==="string"?T.fromUint8ToStringArray(h):h,[y,b]=o(l.shape,u.shape,x,g,p),v=c.makeTensorInfo(b,p),C=c.texData.get(v.dataId);return C.values=y,v}let f=W().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null,d;return f?d=new Ls(e,l.shape,u.shape,r):d=new rs(t,l.shape,u.shape),c.runWebGLProgram(d,[l,u],p)}}function Pl(t,e=!1){if(t==="linear")return e?_G:SG;if(t==="relu")return e?DG:TG;if(t==="elu")return e?AG:kG;if(t==="relu6")return e?$G:NG;if(t==="prelu")return e?J_:Z_;if(t==="leakyrelu")return e?Q_:Y_;if(t==="sigmoid")return e?RG:IG;throw new Error(`Activation ${t} has not been implemented for the WebGL backend.`)}var Wh=class{constructor(e,r,n,o=!1,s=!1,i=!1,a=null,l=!1,u=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.enableShapeUniforms=kt(this.outputShape.length);let c=o?e[1]:e[2],p=Math.ceil(c/2),f=o?"i * 2, rc.y":"rc.y, i * 2",d=s?"rc.z, i * 2":"i * 2, rc.z",m=o?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],h=s?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],x="",g="";a&&(l?x=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:u?x=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:x=`vec4 activation(vec4 x) {
          ${a}
        }`,g="result = activation(result);");let y=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),u&&this.variableNames.push("leakyreluAlpha");let b="rc.x",v="rc.x";e[0]<r[0]?b=`int(min(float(rc.x), ${e[0]-1}.))`:r[0]<e[0]&&(v=`int(min(float(rc.x), ${r[0]-1}.))`),this.userCode=`
      ${x}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${p}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < ${p}; i++) {
          int batchA = ${b};
          int batchB = ${v};
          vec4 a = getMatrixA(batchA, ${f});
          vec4 b = getMatrixB(batchB, ${d});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${m[0]} * ${h[0]});
          result += (${m[1]} * ${h[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${y}

        ${g}

        setOutput(result);
      }
    `}};var eA={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"},W0=class{constructor(e,r,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=T.assertAndGetBroadcastShape(r,n),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}};var MG="return a * b;";function G0(t){let{inputs:e,backend:r}=t,{a:n,b:o}=e,s=T.upcastType(n.dtype,o.dtype);if(n.dtype==="complex64"){let a=r.texData.get(n.dataId),l=r.texData.get(o.dataId),u=new W0(eA.REAL,n.shape,o.shape),c=new W0(eA.IMAG,n.shape,o.shape),p=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:n.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:n.shape},{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:o.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:o.shape}],f=r.runWebGLProgram(u,p,"float32"),d=r.runWebGLProgram(c,p,"float32"),m=co({inputs:{real:f,imag:d},backend:r});return r.disposeIntermediateTensorInfo(f),r.disposeIntermediateTensorInfo(d),m}if(r.shouldExecuteOnCPU([n,o])){let a=r.texData.get(n.dataId),l=r.texData.get(o.dataId),[u,c]=YW(n.shape,o.shape,a.values,l.values,s),p=r.makeTensorInfo(c,s),f=r.texData.get(p.dataId);return f.values=u,p}let i;return W().getBool("WEBGL_PACK_BINARY_OPERATIONS")?i=new Ls(MG,n.shape,o.shape):i=new rs(MG,n.shape,o.shape),r.runWebGLProgram(i,[n,o],s)}var zG={kernelName:ja,backendName:"webgl",kernelFunc:G0};function BG(t,e,r){let n=[Ac(t.shape),...Dc(t.shape)],o={dtype:t.dtype,shape:n,dataId:t.dataId},s=[Ac(e),...Dc(e)],i=new Bh(s,n),a=!0,l=[n],u=r.runWebGLProgram(i,[o],t.dtype,l,a);return{dataId:u.dataId,shape:e,dtype:u.dtype}}function ce(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{shape:s}=n,i=r,a=w.sizeFromShape(o.shape),l=w.inferFromImplicitShape(s,a),u=w.sizeFromShape(l);w.assert(a===u,()=>`The new shape (${l}) has ${u} elements and the old shape (${o.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);let c=i.texData.get(o.dataId);return c.isPacked&&!_f(o.shape,l)&&!(c.texture!==null&&_f(c.shape,l))?BG(o,l,i):(i.incRef(o.dataId),{dataId:o.dataId,shape:l,dtype:o.dtype})}var VG={kernelName:Qu,backendName:"webgl",kernelFunc:ce};var U0=class{constructor(e,r){this.variableNames=["x"];let{windowSize:n,batchSize:o,inSize:s,outSize:i}=e;this.outputShape=[o,i];let a=Math.floor(n/4)*4,l=n%4,u="sumValue += dot(values, ones);";if(r!=null){let p=1/r;u=`sumValue += dot(values * ${w.isInt(p)?p.toPrecision(2):p}, ones);`}let c="";s%n>0&&(c=`
        if (inIdx < 0 || inIdx >= ${s}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${c}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${n};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${u}
        }

        int inIdx = inOffset + ${a};
        if (${l===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${u}
        } else if (${l===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${u}
        } else if (${l===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${u}
        }
        setOutput(sumValue);
      }
    `}};var MC=class{constructor(e,r){this.variableNames=["x"];let{windowSize:n,batchSize:o,inSize:s,outSize:i}=e;this.outputShape=[o,i];let a="0.0",l="";r==="prod"?a="1.0":r==="min"?(a="1.0 / 1e-20",l="min"):r==="max"&&(a="-1.0 / 1e-20",l="max");let u=`${r}(${r}(${r}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;r==="sum"?u="sumValue":r==="prod"?u="prodValue":r==="all"?u="allValue":r==="any"&&(u="anyValue");let c=Math.floor(n/4)*4,p=n%4,f=`
      if (${r==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${r==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${l}(values, minMaxValue);
        if (${r==="min"} || ${r==="max"}) {
          minMaxValue = ${l}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,d="vec4";r==="all"?(a="1.0",f=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,d="bvec4"):r==="any"&&(a="0.0",f=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,d="bvec4");let m="";s%n>0&&(m=`
        if (inIdx < 0 || inIdx >= ${s}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${m}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${n};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${c}; i += 4) {
          int inIdx = inOffset + i;
          ${d} values = ${d}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${f}
        }

        int inIdx = inOffset + ${c};
        if (${p===1}) {
          ${d} values = ${d}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${f}
        } else if (${p===2}) {
          ${d} values = ${d}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${f}
        } else if (${p===3}) {
          ${d} values = ${d}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${f}
        }
        setOutput(${u});
      }
    `}};function Uce(t){let e=[];for(;e.length===0||e[e.length-1].outSize!==1;){let r=e.length?e[e.length-1].outSize:t[1],n=T.computeOptimalWindowSize(r);e.push({inSize:r,windowSize:n,outSize:Math.ceil(r/n)})}return e}function Oo(t,e,r,n){let o=Uce(t.shape),s=t;for(let i=0;i<o.length;i++){let{inSize:a,windowSize:l,outSize:u}=o[i],c,p;r==="mean"?c=i===0?new U0({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:u},a):new U0({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:u}):c=new MC({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:u},r),p=s,s=n.runWebGLProgram(c,[s],e),p.dataId!==t.dataId&&n.disposeIntermediateTensorInfo(p)}return s}var zC=class{constructor(e,r){this.variableNames=["A"];let n=new Array(e.length);for(let i=0;i<n.length;i++)n[i]=e[r[i]];this.outputShape=n,this.rank=n.length;let o=je(this.rank),s=Hce(r);this.userCode=`
    void main() {
      ${o} resRC = getOutputCoords();
      setOutput(getA(${s}));
    }
    `}};function Hce(t){let e=t.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);let r=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],n=new Array(e);for(let o=0;o<t.length;o++)n[t[o]]=r[o];return n.join()}var BC=class{constructor(e,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;let n=new Array(e.length);for(let c=0;c<n.length;c++)n[c]=e[r[c]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);let o=je(this.rank),s=K_("rc",this.rank),i=new Array(this.rank);for(let c=0;c<r.length;c++)i[r[c]]=s[c];let a=`vec2(${i.slice(-2).join()})`,l=`++${s[this.rank-1]} < ${n[this.rank-1]}`,u=`getChannel(getA(${i.join()}), ${a})`;this.userCode=`
    void main() {
      ${o} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${u};
      if(${l}) {
        result[1] = ${u};
      }
      --${s[this.rank-1]};
      if(++${s[this.rank-2]} < ${n[this.rank-2]}) {
        result[2] = ${u};
        if(${l}) {
          result[3] = ${u};
        }
      }
      setOutput(result);
    }
    `}};function $c(t,e,r){let n=W().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new BC(t.shape,e):new zC(t.shape,e);return r.runWebGLProgram(n,[t],t.dtype)}function WG(t,e,r,n){let o=e,s=t.shape.length,i=w.parseAxisParam(o,t.shape),a=i,l=T.getAxesPermutation(a,s),u=l!=null,c=t;u&&(c=$c(t,l,n),a=T.getInnerMostAxes(a.length,s)),T.assertAxesAreInnerMostDims("sum",a,s);let[p,f]=T.computeOutAndReduceShapes(c.shape,a),d=p;r&&(d=T.expandShapeToKeepDim(p,i));let m=w.sizeFromShape(f),x=w.sizeFromShape(t.shape)/m,g=ce({inputs:{x:c},attrs:{shape:[x,m]},backend:n}),y=Up(t.dtype),b=Oo(g,y,"sum",n),v=ce({inputs:{x:b},attrs:{shape:d},backend:n});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(b),u&&n.disposeIntermediateTensorInfo(c),v}function Of(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{axis:s,keepDims:i}=n;return WG(o,s,i,r)}var GG={kernelName:nc,backendName:"webgl",kernelFunc:Of};function Ut(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{perm:s}=n,i=r,a=o.shape.length,l=new Array(a);for(let c=0;c<l.length;c++)l[c]=o.shape[s[c]];let u;if(i.shouldExecuteOnCPU([o])){let p=i.texData.get(o.dataId).values,f=$f(p,o.shape,o.dtype,s,l);u=i.makeTensorInfo(l,o.dtype);let d=i.texData.get(u.dataId);d.values=f}else u=$c(o,s,i);return u}var UG={kernelName:Li,backendName:"webgl",kernelFunc:Ut};var tA=1e3;function Ff({a:t,b:e,transposeA:r,transposeB:n,backend:o,bias:s=null,preluActivationWeights:i=null,leakyreluAlpha:a=0,activation:l=null}){let u=t.shape.length,c=e.shape.length,p=r?t.shape[u-2]:t.shape[u-1],f=n?e.shape[c-1]:e.shape[c-2],d=r?t.shape[u-1]:t.shape[u-2],m=n?e.shape[c-2]:e.shape[c-1],h=t.shape.slice(0,-2),x=e.shape.slice(0,-2),g=w.sizeFromShape(h),y=w.sizeFromShape(x),v=No.assertAndGetBroadcastShape(t.shape.slice(0,-2),e.shape.slice(0,-2)).concat([d,m]);w.assert(p===f,()=>`Error in matMul: inner shapes (${p}) and (${f}) of Tensors with shapes ${t.shape} and ${e.shape} and transposeA=${r} and transposeB=${n} must match.`);let C=r?[g,p,d]:[g,d,p],S=n?[y,m,f]:[y,f,m],k=ce({inputs:{x:t},backend:o,attrs:{shape:C}}),I=ce({inputs:{x:e},backend:o,attrs:{shape:S}}),A=[k,I],$=Math.max(g,y),O=r?k.shape[1]:k.shape[2],j=s!=null,H=i!=null,Y=l==="leakyrelu",B=l!=null?Pl(l,!0):null,K=j||H||Y||B!=null,X;if((d===1||m===1)&&O>tA&&K===!1){let Q=k,ie=I;r&&(Q=Ut({inputs:{x:k},backend:o,attrs:{perm:[0,2,1]}}),A.push(Q)),n&&(ie=Ut({inputs:{x:I},backend:o,attrs:{perm:[0,2,1]}}),A.push(ie));let re=m!==1,ue=m===1,ne=Q;re&&(ne=ce({inputs:{x:Q},backend:o,attrs:{shape:[$,O,1]}}),A.push(ne));let le=m===1?2:1,ae=ie;ue&&(ae=ce({inputs:{x:ie},backend:o,attrs:{shape:[$,1,O]}}),A.push(ae));let me=G0({inputs:{a:ne,b:ae},backend:o});X=Of({inputs:{x:me},backend:o,attrs:{axis:le,keepDims:!0}}),A.push(me)}else{let Q=wr(t.dtype,e.dtype),ie=new Wh(C,S,[$,d,m],r,n,j,B,H,Y),re=[k,I];if(s!=null&&re.push(s),H&&re.push(i),Y){let ue=o.makeTensorInfo([],"float32",w.createScalarValue(a,"float32"));re.push(ue),A.push(ue)}X=o.runWebGLProgram(ie,re,Q)}let Z=ce({inputs:{x:X},backend:o,attrs:{shape:v}});A.push(X);for(let Q of A)o.disposeIntermediateTensorInfo(Q);return Z}function qce(t){let{inputs:e,backend:r,attrs:n}=t,{a:o,b:s,bias:i,preluActivationWeights:a}=e,{transposeA:l,transposeB:u,activation:c,leakyreluAlpha:p}=n;return Ff({a:o,b:s,transposeA:l,transposeB:u,backend:r,bias:i,preluActivationWeights:a,leakyreluAlpha:p,activation:c})}var HG={kernelName:Pp,backendName:"webgl",kernelFunc:qce};var qG="return abs(x);";function jce(t){let{inputs:e,backend:r}=t,{x:n}=e;if(r.shouldExecuteOnCPU([n])&&n.dtype!=="complex64"){let s=r.texData.get(n.dataId),i=$C(s.values);return r.makeTensorInfo(n.shape,n.dtype,i)}let o;return W().getBool("WEBGL_PACK_UNARY_OPERATIONS")?o=new uo(n.shape,qG):o=new cn(n.shape,qG),r.runWebGLProgram(o,[n],n.dtype)}var jG={kernelName:yu,backendName:"webgl",kernelFunc:jce};var Kce=Or+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,Xce=Te({opSnippet:Kce}),KG={kernelName:va,backendName:"webgl",kernelFunc:Xce};var Yce=Or+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,Qce=Te({opSnippet:Yce}),XG={kernelName:wa,backendName:"webgl",kernelFunc:Qce};var YG="return a + b;",Zce=lt({opSnippet:YG,packedOpSnippet:YG,supportsComplex:!0,cpuKernelImpl:AW}),QG={kernelName:ri,backendName:"webgl",kernelFunc:Zce};var VC=class{constructor(e,r){this.outputShape=[],this.outputShape=e,this.variableNames=r.map((s,i)=>`T${i}`);let n=[];this.variableNames.forEach(s=>{n.push(`float v${s} = get${s}AtOutCoords();`)});let o=this.variableNames.map(s=>`v${s}`).join(" + ");this.userCode=`
      void main() {
        ${n.join(`
        `)}

        float result = ${o};
        setOutput(result);
      }
    `}};var WC=class{constructor(e,r){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=r.map((s,i)=>`T${i}`);let n=[];this.variableNames.forEach(s=>{n.push(`vec4 v${s} = get${s}AtOutCoords();`)});let o=this.variableNames.map(s=>`v${s}`).join(" + ");this.userCode=`
      void main() {
        ${n.join(`
        `)}

        vec4 result = ${o};
        setOutput(result);
      }
    `}};function GC(t){let{inputs:e,backend:r}=t,n=e;if(n.length===1)return ur({inputs:{x:n[0]},backend:r});if(n.length>W().get("WEBGL_MAX_TEXTURES_IN_SHADER")){let l=Math.floor(n.length/2),u=GC({inputs:n.slice(0,l),backend:r}),c=GC({inputs:n.slice(l),backend:r});return GC({inputs:[u,c],backend:r})}let o=n.map(l=>l.dtype).reduce((l,u)=>wr(l,u)),s=n.map(l=>l.shape),a=W().getBool("WEBGL_PACK")?new WC(n[0].shape,s):new VC(n[0].shape,s);return r.runWebGLProgram(a,n,o)}var ZG={kernelName:Pd,backendName:"webgl",kernelFunc:GC};function Jce(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{axis:s,keepDims:i}=n,a=o.shape.length,l=w.parseAxisParam(s,o.shape),u=l,c=T.getAxesPermutation(u,a),p=o;c!=null&&(p=Ut({inputs:{x:o},backend:r,attrs:{perm:c}}),u=T.getInnerMostAxes(u.length,a)),T.assertAxesAreInnerMostDims("all",u,a);let[f,d]=T.computeOutAndReduceShapes(p.shape,u),m=w.sizeFromShape(d),h=ce({inputs:{x:p},backend:r,attrs:{shape:[-1,m]}}),x=Oo(h,h.dtype,"all",r),g;if(i){let y=T.expandShapeToKeepDim(f,l);g=ce({inputs:{x},backend:r,attrs:{shape:y}})}else g=ce({inputs:{x},backend:r,attrs:{shape:f}});return r.disposeIntermediateTensorInfo(h),r.disposeIntermediateTensorInfo(x),c!=null&&r.disposeIntermediateTensorInfo(p),g}var JG={kernelName:Ld,backendName:"webgl",kernelFunc:Jce};function epe(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{axis:s,keepDims:i}=n,a=o.shape.length,l=w.parseAxisParam(s,o.shape),u=l,c=T.getAxesPermutation(u,a),p=o;c!=null&&(p=Ut({inputs:{x:o},backend:r,attrs:{perm:c}}),u=T.getInnerMostAxes(u.length,a)),T.assertAxesAreInnerMostDims("any",u,a);let[f,d]=T.computeOutAndReduceShapes(p.shape,u),m=w.sizeFromShape(d),h=ce({inputs:{x:p},backend:r,attrs:{shape:[-1,m]}}),x=Oo(h,h.dtype,"any",r),g;if(i){let y=T.expandShapeToKeepDim(f,l);g=ce({inputs:{x},backend:r,attrs:{shape:y}})}else g=ce({inputs:{x},backend:r,attrs:{shape:f}});return r.disposeIntermediateTensorInfo(h),r.disposeIntermediateTensorInfo(x),c!=null&&r.disposeIntermediateTensorInfo(p),g}var e6={kernelName:Md,backendName:"webgl",kernelFunc:epe};var UC=class{constructor(e,r,n){this.variableNames=["A"];let{windowSize:o,batchSize:s,outSize:i}=e;n||this.variableNames.push("bestIndicesA"),this.outputShape=[s,i];let a=r==="max"?">":"<",l=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${o};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${o}; i++) {
          int inIdx = ${l};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}};var HC=class{constructor(e,r,n,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,w.assert(e.length>2,()=>`Packed arg${n.charAt(0).toUpperCase()+n.slice(1)} supports only inputs with rank above 2.`);let s=e[e.length-1],i=Math.ceil(s/r);this.outputShape=e.slice(0,-1),i>1&&this.outputShape.push(i),o||this.variableNames.push("bestIndicesA");let a=this.outputShape,l=a.length,u=je(l),c=lr("coords",l),p,f;if(i===1){f=l+1;let I=je(f);p=`
        ${I} sourceLocR = ${I}(${c.join()}, 0);
        ++${c[l-1]};
        ${I} sourceLocG = ${I}(${c.join()}, 0);
        ++${c[l-2]};
        ${I} sourceLocA = ${I}(${c.join()}, 0);
        --${c[l-1]};
        ${I} sourceLocB = ${I}(${c.join()}, 0);
        --${c[l-2]};`}else f=l,p=`
        ${u} sourceLocR = coords;
        ++${c[l-1]};
        ${u} sourceLocG = coords;
        ++${c[l-2]};
        ${u} sourceLocA = coords;
        --${c[l-1]};
        ${u} sourceLocB = coords;
        --${c[l-2]};`;let d=["x","y","z","w","u","v"].slice(0,f),m="."+d[f-1],h=d.map(I=>"int "+I),x=lr("sourceLocR",f-1).concat("inIdx.r"),g=lr("sourceLocG",f-1).concat("inIdx.g"),y=lr("sourceLocB",f-1).concat("inIdx.b"),b=lr("sourceLocA",f-1).concat("inIdx.a"),v=n==="max"?"greaterThan":"lessThan",C=o?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${x.join()}),
                             getBestIndicesAChannel(${g.join()}),
                             getBestIndicesAChannel(${y.join()}),
                             getBestIndicesAChannel(${b.join()})));`,S=`vec4(
            getAChannel(${x.join()}),
            hasNextCol ? getAChannel(${g.join()}) : 0.,
            hasNextRow ? getAChannel(${y.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${b.join()}) : 0.)`,k=o?"":`
      float getBestIndicesAChannel(${h.join()}) {
        return getChannel(getBestIndicesA(${d.join()}),
                                          vec2(${d.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${h.join()}) {
        return getChannel(getA(${d.join()}),
                               vec2(${d.slice(-2).join()}));
      }
      ${k}
      void main() {
        ${u} coords = getOutputCoords();
        bool hasNextCol = ${c[l-1]} < ${a[l-1]-1};
        bool hasNextRow = ${c[l-2]} < ${a[l-2]-1};
        ${p}
        ivec4 srcIdx = ivec4(sourceLocR${m}, sourceLocG${m},
          sourceLocB${m}, sourceLocA${m}) * ${r};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${S};

        for (int i = 0; i < ${r}; i++) {
          inIdx = srcIdx;
          ${C}
          vec4 candidate = ${S};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${v}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}};function t6(t,e,r,n=null){let o=e.shape[0],s=e.shape[1];n!=null&&(o=n.shape[0],s=n.shape[1]);let i=T.computeOptimalWindowSize(s),a={windowSize:i,inSize:s,batchSize:o,outSize:Math.ceil(s/i)},l=new UC(a,r,n==null),u=[e];n!=null&&u.push(n);let c=t.runWebGLProgram(l,u,"int32");if(c.shape[1]===1)return c;let p=t6(t,e,r,c);return t.disposeIntermediateTensorInfo(c),p}function r6(t,e,r,n=null){let o=n!=null?n.shape:e.shape,s=o[o.length-1],i=T.computeOptimalWindowSize(s),a=new HC(o,i,r,n==null),l=n==null?[e]:[e,n],u=t.runWebGLProgram(a,l,"int32");if(u.shape.length===e.shape.length){let c=r6(t,e,r,u);return t.disposeIntermediateTensorInfo(u),c}return u}function qC(t,e,r,n){let o=[r];if(T.assertAxesAreInnerMostDims("arg"+n.charAt(0).toUpperCase()+n.slice(1),o,e.shape.length),!W().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){let s=[],i=t.texData.get(e.dataId),a=i!==null&&i.isPacked,l=e;a&&(l=t.unpackTensor(e),s.push(l));let[u,c]=T.computeOutAndReduceShapes(l.shape,o),p=w.sizeFromShape(c),f=ce({inputs:{x:l},backend:t,attrs:{shape:[-1,p]}});s.push(f);let d=t6(t,f,n);s.push(d);let m=ce({inputs:{x:d},backend:t,attrs:{shape:u}});return s.forEach(h=>t.disposeIntermediateTensorInfo(h)),m}return r6(t,e,n)}function tpe(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{axis:s}=n,i=w.parseAxisParam(s,o.shape),a=T.getAxesPermutation(i,o.shape.length),l=o,u=[];a!=null&&(l=Ut({inputs:{x:o},backend:r,attrs:{perm:a}}),u.push(l),i=T.getInnerMostAxes(i.length,l.shape.length)),T.assertAxesAreInnerMostDims("argMax",[i[0]],l.shape.length);let c=qC(r,l,i[0],"max");return u.forEach(p=>r.disposeIntermediateTensorInfo(p)),c}var n6={kernelName:bu,backendName:"webgl",kernelFunc:tpe};function rpe(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{axis:s}=n,i=w.parseAxisParam(s,o.shape),a=T.getAxesPermutation(i,o.shape.length),l=o,u=[];a!=null&&(l=Ut({inputs:{x:o},backend:r,attrs:{perm:a}}),u.push(l),i=T.getInnerMostAxes(i.length,l.shape.length)),T.assertAxesAreInnerMostDims("argMin",[i[0]],l.shape.length);let c=qC(r,l,i[0],"min");return u.forEach(p=>r.disposeIntermediateTensorInfo(p)),c}var o6={kernelName:vu,backendName:"webgl",kernelFunc:rpe};var npe=Or+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,ope=Te({opSnippet:npe}),s6={kernelName:Ca,backendName:"webgl",kernelFunc:ope};var spe=Or+"return log(x + sqrt(x * x + 1.0));",ipe=Te({opSnippet:spe}),i6={kernelName:Sa,backendName:"webgl",kernelFunc:ipe};var ape=Or+`
  return atan(x);
`,lpe=Te({opSnippet:ape}),a6={kernelName:ka,backendName:"webgl",kernelFunc:lpe};var upe=Vh+`
  return atan(a, b);
`,cpe=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+ra+`
  return result;
`,ppe=lt({opSnippet:upe,packedOpSnippet:cpe}),l6={kernelName:Na,backendName:"webgl",kernelFunc:ppe};var fpe=Or+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,dpe=Te({opSnippet:fpe}),u6={kernelName:Ta,backendName:"webgl",kernelFunc:dpe};var gi=class{constructor(e,r,n,o=!1,s=!1){if(this.variableNames=["x"],r==="avg"&&n)throw new Error("Cannot compute positions for average pool.");let i=e.filterWidth,a=e.strideHeight,l=e.strideWidth,u=e.dilationHeight,c=e.dilationWidth,p=e.effectiveFilterHeight,f=e.effectiveFilterWidth,d=e.padInfo.top,m=e.padInfo.left;this.outputShape=e.outShape;let h=r==="avg",x=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,g=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`,y="0.0";if(h||(y="-1.0 / 1e-20"),n){let I=">=";this.userCode=`
        const ivec2 strides = ivec2(${a}, ${l});
        const ivec2 pads = ivec2(${d}, ${m});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${p};
              wR += ${u}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${f};
                wC += ${c}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${I} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${o?s?x:g:`wR * ${f} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}let b="max",v=`${r}(${r}(${r}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;r==="avg"&&(v="avgValue / count");let C=Math.floor(i/4)*4,S=i%4,k=`
      if (${h}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${b}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${l});
      const ivec2 pads = ivec2(${d}, ${m});
      const float initializationValue = ${y};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${y});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${p};
            wR += ${u}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${C}; wC += 4) {
            int xC = xCCorner + wC * ${c};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${c}, d),
              getValue(batch, xR, xC + 2 * ${c}, d),
              getValue(batch, xR, xC + 3 * ${c}, d)
            );

            ${k}
          }

          int xC = xCCorner + ${C};
          if (${S===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${k}
          } else if (${S===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${c}, d),
              initializationValue,
              initializationValue
            );

            ${k}
          } else if (${S===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${c}, d),
              getValue(batch, xR, xC + 2 * ${c}, d),
              initializationValue
            );

            ${k}
          }
        }
        setOutput(${v});
      }
    `}},Rc=class{constructor(e,r,n,o=!1,s=!1){if(this.variableNames=["x"],r==="avg"&&n)throw new Error("Cannot compute positions for average pool.");let i=e.filterWidth,a=e.strideDepth,l=e.strideHeight,u=e.strideWidth,c=e.dilationDepth,p=e.dilationHeight,f=e.dilationWidth,d=e.effectiveFilterDepth,m=e.effectiveFilterHeight,h=e.effectiveFilterWidth,x=e.padInfo.front,g=e.padInfo.top,y=e.padInfo.left;this.outputShape=e.outShape;let b=r==="avg",v="0.0";if(b||(v="-1.0 / 1e-20"),n){let $=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${l}, ${u});
        const ivec3 pads = ivec3(${x}, ${g}, ${y});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${d};
              wD += ${c}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${m};
                wR += ${p}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${h};
                  wC += ${f}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${$} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${o?s?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${m} * ${h} +
                      wR * ${h} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}let C="max",S=`${r}(${r}(${r}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;r==="avg"&&(S="avgValue / count");let k=Math.floor(i/4)*4,I=i%4,A=`
      if (${b}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${C}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${l}, ${u});
      const ivec3 pads = ivec3(${x}, ${g}, ${y});
      const float initializationValue = ${v};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${v});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${d};
            wD += ${c}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${m};
            wR += ${p}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${k}; wC += 4) {
              int xC = xCCorner + wC * ${f};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                getValue(batch, xD, xR, xC + 2 * ${f}, ch),
                getValue(batch, xD, xR, xC + 3 * ${f}, ch)
              );

              ${A}
            }

            int xC = xCCorner + ${k};
            if (${I===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${A}
            } else if (${I===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                initializationValue,
                initializationValue
              );

              ${A}
            } else if (${I===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                getValue(batch, xD, xR, xC + 2 * ${f}, ch),
                initializationValue
              );

              ${A}
            }
          }
          setOutput(${S});
        }
      }
    `}};function mpe(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e;ea(o,"avgPool");let{filterSize:s,strides:i,pad:a,dimRoundingMode:l}=n,u=1;w.assert(T.eitherStridesOrDilationsAreOne(i,u),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);let c=T.computePool2DInfo(o.shape,s,i,u,a,l);if(c.filterWidth===1&&c.filterHeight===1&&w.arraysEqual(c.inShape,c.outShape))return ur({inputs:{x:o},backend:r});let p=new gi(c,"avg",!1);return r.runWebGLProgram(p,[o],"float32")}var c6={kernelName:wu,backendName:"webgl",kernelFunc:mpe};function hpe(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{filterSize:s,strides:i,pad:a,dimRoundingMode:l,dataFormat:u}=n,c=[1,1,1],p=T.computePool3DInfo(o.shape,s,i,c,a,l,u),f=new Rc(p,"avg",!1);return r.runWebGLProgram(f,[o],"float32")}var p6={kernelName:Cu,backendName:"webgl",kernelFunc:hpe};var jC=class{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;let r=e.filterHeight,n=e.filterWidth,o=e.strideHeight,s=e.strideWidth,i=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterHeight,u=e.effectiveFilterWidth,c=l-1-e.padInfo.top,p=u-1-e.padInfo.left,f=1/(r*n);this.userCode=`
      const ivec2 pads = ivec2(${c}, ${p});
      const float avgMultiplier = float(${f});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${l};
            wR += ${i}) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${u};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}},KC=class{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;let r=e.filterDepth,n=e.filterHeight,o=e.filterWidth,s=e.strideDepth,i=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,u=e.dilationHeight,c=e.dilationWidth,p=e.effectiveFilterDepth,f=e.effectiveFilterHeight,d=e.effectiveFilterWidth,m=p-1-e.padInfo.front,h=f-1-e.padInfo.top,x=d-1-e.padInfo.left,g=1/(r*n*o);this.userCode=`
      const ivec3 pads = ivec3(${m}, ${h}, ${x});
      const float avgMultiplier = float(${g});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${p};
            wD += ${l}) {
          float dyD = float(dyDCorner + wD) / ${s}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${f};
              wR += ${u}) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${d};
                wC += ${c}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function gpe(t){let{inputs:e,backend:r,attrs:n}=t,{dy:o,input:s}=e,i=s,{filterSize:a,strides:l,pad:u,dimRoundingMode:c}=n,p=[1,1,1],f=T.computePool3DInfo(i.shape,a,l,p,u,c),d=new KC(f);return r.runWebGLProgram(d,[o],i.dtype)}var f6={kernelName:Bd,backendName:"webgl",kernelFunc:gpe};function xpe(t){let{inputs:e,backend:r,attrs:n}=t,{dy:o,input:s}=e,i=s;ea([o,s],"avgPoolGrad");let{filterSize:a,strides:l,pad:u}=n,c=T.computePool2DInfo(i.shape,a,l,1,u),p=new jC(c);return r.runWebGLProgram(p,[o],i.dtype)}var d6={kernelName:zd,backendName:"webgl",kernelFunc:xpe};function ype(t){let{inputs:e,backend:r,attrs:n}=t,{a:o,b:s}=e,{transposeA:i,transposeB:a}=n;return Ff({a:o,b:s,transposeA:i,transposeB:a,backend:r})}var m6={kernelName:Su,backendName:"webgl",kernelFunc:ype};var XC=class{constructor(e,r,n,o,s,i){this.outputShape=[],this.variableNames=["x","mean","variance"],T.assertAndGetBroadcastShape(e,r),T.assertAndGetBroadcastShape(e,n);let a="0.0";o!=null&&(T.assertAndGetBroadcastShape(e,o),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="1.0";s!=null&&(T.assertAndGetBroadcastShape(e,s),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${l};
        float inv = scale * inversesqrt(variance + float(${i}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}};var YC=class{constructor(e,r,n,o,s,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],T.assertAndGetBroadcastShape(e,r),T.assertAndGetBroadcastShape(e,n);let a="vec4(0.0)";o!=null&&(T.assertAndGetBroadcastShape(e,o),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="vec4(1.0)";s!=null&&(T.assertAndGetBroadcastShape(e,s),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${l};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${i}));

        setOutput((x - mean) * inv + offset);
      }
    `}};var bpe=({inputs:t,backend:e,attrs:r})=>{let{x:n,mean:o,variance:s,offset:i,scale:a}=t;w.assert(o.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),w.assert(i==null||o.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),w.assert(a==null||o.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=r;l==null&&(l=.001);let u=[n,o,s],c=null;i!=null&&(c=i.shape,u.push(i));let p=null;a!=null&&(p=a.shape,u.push(a));let f=W().getBool("WEBGL_PACK_NORMALIZATION")?new YC(n.shape,o.shape,s.shape,c,p,l):new XC(n.shape,o.shape,s.shape,c,p,l);return e.runWebGLProgram(f,u,u[0].dtype)},h6={kernelName:Ou,backendName:"webgl",kernelFunc:bpe};var QC=class{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;let r=je(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];let n=vpe(this.rank),o,s=e.map((i,a)=>`sourceLoc.${rA[a]} = start[${a}] + coords.${rA[a]};`);o=`
        ${r} sourceLoc;
        ${r} coords = getOutputCoords();
        ${s.join(`
`)}
      `,this.userCode=`
      void main() {
        ${o}
        setOutput(getSource(${n}));
      }
    `}},rA=["x","y","z","w","u","v"];function vpe(t){if(t===1)return"sourceLoc";if(t<=6)return rA.slice(0,t).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${t} is not yet supported`)}var ZC=class{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];let r=je(this.rank),n=lr("coords",this.rank),o=lr("sourceLoc",this.rank),s=this.rank===1?"sourceLoc":`vec2(${o.slice(-2).join()})`,i=`getChannel(getSource(${o.join()}), ${s})`,a=`
      result.x = ${i};
      if (++${n[this.rank-1]} < ${e[this.rank-1]}) {
        ++${o[this.rank-1]};
        result.y = ${i};
        --${o[this.rank-1]};
      }
    `,l=this.rank===1?"":`
      --${n[this.rank-1]};
      if (++${n[this.rank-2]} < ${e[this.rank-2]}) {
        ++${o[this.rank-2]};
        result.z = ${i};
        if (++${n[this.rank-1]} < ${e[this.rank-1]}) {
          ++${o[this.rank-1]};
          result.w = ${i};
        }
      }
    `,u=this.rank<=4?`sourceLoc = coords +
            ${r}(${e.map((c,p)=>`start[${p}]`).join()});`:e.map((c,p)=>`${o[p]} = ${n[p]} + start[${p}];`).join(`
`);this.userCode=`
      void main() {
        ${r} coords = getOutputCoords();
        ${r} sourceLoc;
        ${u}
        vec4 result = vec4(0.);
        ${a}
        ${l}
        setOutput(result);
      }
    `}};function wpe(t,e,r,n){let o=n.texData.get(t.dataId),s=n.makeTensorInfo(r,t.dtype),i=n.texData.get(s.dataId);Object.assign(i,o),i.refCount=1,i.shape=r,i.dtype=t.dtype;let a=Hr.computeFlatOffset(e,w.computeStrides(t.shape));o.slice&&(a+=o.slice.flatOffset),i.slice={flatOffset:a,origDataId:o.slice&&o.slice.origDataId||t.dataId};let l=n.dataRefCount.get(i.slice.origDataId)||1;return n.dataRefCount.set(i.slice.origDataId,l+1),s}function xi(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{begin:s,size:i}=n,[a,l]=Hr.parseSliceParams(o,s,i);if(Hr.assertParamsValid(o,a,l),w.sizeFromShape(l)===0)return r.makeTensorInfo(l,o.dtype,[]);if(r.shouldExecuteOnCPU([o])||o.dtype==="string"){let p=r.texData.get(o.dataId),f=aG(p.values,a,l,o.shape,o.dtype);return r.makeTensorInfo(l,o.dtype,f)}let{isPacked:u}=r.texData.get(o.dataId),c=Hr.isSliceContinous(o.shape,a,l);if(u||!c){let p=W().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new ZC(l):new QC(l),f=[a];return r.runWebGLProgram(p,[o],o.dtype,f)}return r.uploadToGPU(o.dataId),wpe(o,a,l,r)}var g6={kernelName:rc,backendName:"webgl",kernelFunc:xi};var Cpe=t=>{let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{blockShape:s,crops:i}=n;w.assert(o.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");let a=s.reduce((y,b)=>y*b),l=T.getReshaped(o.shape,s,a),u=T.getPermuted(l.length,s.length),c=T.getReshapedPermuted(o.shape,s,a),p=T.getSliceBeginCoords(i,s.length),f=T.getSliceSize(c,i,s.length),d=[],m=ce({inputs:{x:o},backend:r,attrs:{shape:l}}),h=Ut({inputs:{x:m},backend:r,attrs:{perm:u}}),x=ce({inputs:{x:h},backend:r,attrs:{shape:c}}),g=xi({inputs:{x},backend:r,attrs:{begin:p,size:f}});return d.push(m),d.push(h),d.push(x),d.forEach(y=>r.disposeIntermediateTensorInfo(y)),g},x6={kernelName:ku,backendName:"webgl",kernelFunc:Cpe};function Spe(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,weights:s}=e,{size:i}=n,a=r.readSync(o.dataId),l=r.readSync(s.dataId),u=DC(a,l,s.dtype,s.shape,i);return r.makeTensorInfo([i],s.dtype,u)}var y6={kernelName:Vd,backendName:"webgl",kernelFunc:Spe};function kpe(t){let{inputs:e,backend:r}=t,{s0:n,s1:o}=e,s=r.readSync(n.dataId),i=r.readSync(o.dataId),a=T.assertAndGetBroadcastShape(Array.from(s),Array.from(i));return r.makeTensorInfo([a.length],"int32",Int32Array.from(a))}var b6={kernelName:Lv,backendName:"webgl",kernelFunc:kpe};var Tpe="return float(a != b);",nA=lt({opSnippet:Tpe,cpuKernelImpl:ZW,dtype:"bool"}),v6={kernelName:Fp,backendName:"webgl",kernelFunc:nA};function Ll(t){let{inputs:e,backend:r}=t,{input:n}=e,o=r.texData.get(n.dataId);return ur({inputs:{x:o.complexTensorInfos.real},backend:r})}var w6={kernelName:fm,backendName:"webgl",kernelFunc:Ll};var Npe="return float(int(x));";function C6(t,e){let r=new cn(t.shape,Npe),n=e.runWebGLProgram(r,[t],"int32");return{dataId:n.dataId,shape:n.shape,dtype:n.dtype}}function oA(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{dtype:s}=n;if(s==="complex64"){if(o.dtype==="complex64")return ur({inputs:{x:o},backend:r});let i=Pt(o.shape),a=oA({inputs:{x:o},backend:r,attrs:{dtype:"float32"}}),l=co({inputs:{real:a,imag:i},backend:r});return i.dispose(),r.disposeIntermediateTensorInfo(a),l}if(o.dtype==="complex64"){let i=Ll({inputs:{input:o},backend:r}),a=oA({inputs:{x:i},backend:r,attrs:{dtype:s}});return r.disposeIntermediateTensorInfo(i),a}if(!w.hasEncodingLoss(o.dtype,s)){let i=ur({inputs:{x:o},backend:r});return{dataId:i.dataId,shape:i.shape,dtype:s}}if(r.shouldExecuteOnCPU([o])){let i=r.texData.get(o.dataId).values,[a,l,u]=$W(i,o.shape,o.dtype,s);return r.makeTensorInfo(a,l,u)}if(s==="int32")return C6(o,r);if(s==="bool"){let i=r.makeTensorInfo([],"bool",w.getTypedArrayFromDType("bool",1)),l=nA({inputs:{a:o,b:i},backend:r});return r.disposeIntermediateTensorInfo(i),l}throw new Error(`Error in Cast: failed to cast ${o.dtype} to ${s}`)}var S6={kernelName:Oi,backendName:"webgl",kernelFunc:oA};var k6="return ceil(x);",Ipe=Te({opSnippet:k6,packedOpSnippet:k6,cpuKernelImpl:RW}),T6={kernelName:Ia,backendName:"webgl",kernelFunc:Ipe};var JC=class{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}};var eS=class{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}};function Epe(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{clipValueMin:s,clipValueMax:i}=n,a;W().getBool("WEBGL_PACK_CLIP")?a=new eS(o.shape):a=new JC(o.shape);let l=[[s],[i]];return r.runWebGLProgram(a,[o],o.dtype,l)}var N6={kernelName:Ea,backendName:"webgl",kernelFunc:Epe};var tS=class{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}};function I6(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}}function _pe(t){let{inputs:e,backend:r}=t,{x:n}=e,o=r.texData.get(n.dataId),s=new tS(n.shape),i=[I6(n,o.complexTensorInfos.real),I6(n,o.complexTensorInfos.imag)];return r.runWebGLProgram(s,i,i[0].dtype)}var E6={kernelName:Tu,backendName:"webgl",kernelFunc:_pe};var rS=class{constructor(e){this.outputShape=[],this.outputShape=T.computeOutShape(e,1),this.variableNames=e.map((i,a)=>`T${a}`);let r=new Array(e.length-1);r[0]=e[0][1];for(let i=1;i<r.length;i++)r[i]=r[i-1]+e[i][1];let n=[`if (yC < ${r[0]}) setOutput(getT0(yR, yC));`];for(let i=1;i<r.length;i++){let a=r[i-1];n.push(`else if (yC < ${r[i]}) setOutput(getT${i}(yR, yC-${a}));`)}let o=r.length,s=r[r.length-1];n.push(`else setOutput(getT${o}(yR, yC-${s}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${n.join(`
        `)}
      }
    `}};var oS=class{constructor(e,r){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=T.computeOutShape(e,r);let n=this.outputShape,o=n.length,s=je(o),i=lr("coords",o),a=["x","y","z","w","u","v"].slice(0,o);this.variableNames=e.map((h,x)=>`T${x}`);let l=new Array(e.length-1);l[0]=e[0][r];for(let h=1;h<l.length;h++)l[h]=l[h-1]+e[h][r];let u=a[r],c=a.slice(-2),p=a.join(),f=`if (${u} < ${l[0]}) {
        return getChannel(
            getT0(${p}), vec2(${c.join()}));
        }`;for(let h=1;h<l.length;h++){let x=l[h-1];f+=`
        if (${u} < ${l[h]}  && ${u} >= ${l[h-1]}) {
          return getChannel(
            getT${h}(${nS(a,u,x)}),
            vec2(${nS(c,u,x)}));
        }`}let d=l.length,m=l[l.length-1];f+=`
        return getChannel(
          getT${d}(${nS(a,u,m)}),
          vec2(${nS(c,u,m)}));`,this.userCode=`
      float getValue(${a.map(h=>"int "+h)}) {
        ${f}
      }

      void main() {
        ${s} coords = getOutputCoords();
        vec4 result = vec4(getValue(${i}), 0., 0., 0.);

        ${i[o-1]} = ${i[o-1]} + 1;
        if (${i[o-1]} < ${n[o-1]}) {
          result.g = getValue(${i});
        }

        ${i[o-2]} = ${i[o-2]} + 1;
        if (${i[o-2]} < ${n[o-2]}) {
          result.a = getValue(${i});
        }

        ${i[o-1]} = ${i[o-1]} - 1;
        if (${i[o-2]} < ${n[o-2]} &&
            ${i[o-1]} < ${n[o-1]}) {
          result.b = getValue(${i});
        }
        setOutput(result);
      }
    `}};function nS(t,e,r){let n=t.indexOf(e);return t.map((s,i)=>i===n?`${s} - ${r}`:s).join()}function Pf(t){let{inputs:e,backend:r}=t,{input:n}=e,o=r.texData.get(n.dataId);return ur({inputs:{x:o.complexTensorInfos.imag},backend:r})}var _6={kernelName:om,backendName:"webgl",kernelFunc:Pf};function Gh(t,e,r){let n=t[0].dtype;if(n==="complex64"){let d=t.map(y=>Ll({inputs:{input:y},backend:r})),m=t.map(y=>Pf({inputs:{input:y},backend:r})),h=Gh(d,e,r),x=Gh(m,e,r),g=co({inputs:{real:h,imag:x},backend:r});return d.forEach(y=>r.disposeIntermediateTensorInfo(y)),m.forEach(y=>r.disposeIntermediateTensorInfo(y)),r.disposeIntermediateTensorInfo(h),r.disposeIntermediateTensorInfo(x),g}let o=r.shouldExecuteOnCPU(t);if(n==="string"&&(o=!0),o){let d=t.map(v=>{let S=[-1,w.sizeFromShape(v.shape.slice(e))];return ce({inputs:{x:v},backend:r,attrs:{shape:S}})}),m=d.map(v=>({vals:r.readSync(v.dataId),shape:v.shape})),h=T.computeOutShape(d.map(v=>v.shape),1),x=d[0].shape[0]===1,g=OW(m,h,n,x),y=T.computeOutShape(t.map(v=>v.shape),e),b=r.makeTensorInfo(y,n,g);return d.forEach(v=>r.disposeIntermediateTensorInfo(v)),b}let s=t.filter(d=>w.sizeFromShape(d.shape)>0),i=W().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&s[0].shape.length>1;if(s.length===1){let d=i?new cn(t[0].shape,ta):new uo(t[0].shape,ta);return r.runWebGLProgram(d,t,n)}let a=W().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(s.length>a){let d=[];for(let h=0;h<s.length;h+=a){let x=s.slice(h,h+a);d.push(Gh(x,e,r))}let m=Gh(d,e,r);for(let h of d)r.disposeIntermediateTensorInfo(h);return m}if(i){let d=new oS(s.map(m=>m.shape),e);return r.runWebGLProgram(d,s,n)}let{tensors2D:l,outShape:u}=Ape(s,e,r),c=new rS(l.map(d=>d.shape)),p=r.runWebGLProgram(c,l,n);l.forEach(d=>r.disposeIntermediateTensorInfo(d));let f=ce({inputs:{x:p},attrs:{shape:u},backend:r});return r.disposeIntermediateTensorInfo(p),f}function Ape(t,e,r){let n=T.computeOutShape(t.map(s=>s.shape),e);return{tensors2D:t.map(s=>ce({inputs:{x:s},attrs:{shape:[-1,w.sizeFromShape(s.shape.slice(e))]},backend:r})),outShape:n}}function sA(t){let{inputs:e,backend:r,attrs:n}=t,{axis:o}=n,s=w.parseAxisParam(o,e[0].shape)[0],i=e.map(u=>u.shape);T.assertParamsConsistent(i,s);let a=T.computeOutShape(e.map(u=>u.shape),s);if(w.sizeFromShape(a)===0)return r.makeTensorInfo(a,e[0].dtype,[]);let l=e.filter(u=>w.sizeFromShape(u.shape)>0);return l.length===1?ur({inputs:{x:l[0]},backend:r}):Gh(l,s,r)}var A6={kernelName:Nu,backendName:"webgl",kernelFunc:sA};var Uh=class{constructor(e,r=!1,n=null,o=!1,s=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;let i=e.padInfo.top,a=e.padInfo.left,l=e.strideHeight,u=e.strideWidth,c=e.dilationHeight,p=e.dilationWidth,f=e.filterHeight,d=e.filterWidth,m=Math.floor(e.inChannels/4)*4,h=e.inChannels%4,x=e.dataFormat==="channelsLast",g=x?1:2,y=x?2:3,b=x?3:1,v="",C="";n&&(o?v=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${n}
        }`:s?v=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${n}
        }`:v=`
          float activation(float x) {
            ${n}
          }
        `,C="result = activation(result);");let S=r?"result += getBiasAtOutCoords();":"";r&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${v}

      const ivec2 strides = ivec2(${l}, ${u});
      const ivec2 pads = ivec2(${i}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${b}];

        ivec2 xRCCorner =
            ivec2(coords[${g}], coords[${y}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${f}; wR++) {
          int xR = xRCorner + wR * ${c};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${d}; wC++) {
            int xC = xCCorner + wC * ${p};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${m}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${x}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${h===1}) {

              if (${x}) {
                dotProd +=
                    getX(batch, xR, xC, ${m}) *
                    getW(wR, wC, ${m}, d2);
              } else {
                dotProd +=
                    getX(batch, ${m}, xR, xC) *
                    getW(wR, wC, ${m}, d2);
              }

            } else if (${h===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${m}, d2),
                getW(wR, wC, ${m} + 1, d2)
              );

              if (${x}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${m}),
                  getX(batch, xR, xC, ${m} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${m}, xR, xC),
                  getX(batch, ${m} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${h===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${m}, d2),
                getW(wR, wC, ${m} + 1, d2),
                getW(wR, wC, ${m} + 2, d2)
              );

              if (${x}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${m}),
                  getX(batch, xR, xC, ${m} + 1),
                  getX(batch, xR, xC, ${m} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${m}, xR, xC),
                  getX(batch, ${m} + 1, xR, xC),
                  getX(batch, ${m} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${S}
        ${C}
        setOutput(result);
      }
    `}},sS=class{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;let r=e.padInfo.front,n=e.padInfo.top,o=e.padInfo.left,s=e.strideDepth,i=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,u=e.dilationHeight,c=e.dilationWidth,p=e.filterDepth,f=e.filterHeight,d=e.filterWidth,m=Math.floor(e.inChannels/4)*4,h=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${s}, ${i}, ${a});
      const ivec3 pads = ivec3(${r}, ${n}, ${o});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${p}; wF++) {
          int xF = xFCorner + wF * ${l};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${f}; wR++) {
            int xR = xRCorner + wR * ${u};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${d}; wC++) {
              int xC = xCCorner + wC * ${c};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${m}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${h===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${m}) *
                  getW(wF, wR, wC, ${m}, d2);
              } else if (${h===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${m}),
                  getX(batch, xF, xR, xC, ${m} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${m}, d2),
                  getW(wF, wR, wC, ${m} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${h===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${m}),
                  getX(batch, xF, xR, xC, ${m} + 1),
                  getX(batch, xF, xR, xC, ${m} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${m}, d2),
                  getW(wF, wR, wC, ${m} + 1, d2),
                  getW(wF, wR, wC, ${m} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}};var Hh=class{constructor(e,r=!1,n=null,o=!1,s=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=kt(this.outputShape.length);let i=e.padInfo.left,a=e.strideWidth,l=e.dilationWidth,u=e.filterHeight,c=e.filterWidth,p=c,f=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let x=0;x<c;x++)f+=`
           vec4 xTexelC${x*2};
           int xTexelC${x*2}Ready;
           vec4 xTexelC${x*2+1};
           int xTexelC${x*2+1}Ready;
           vec4 xC${x};`;f+=`
     for (int r = 0; r < ${u}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let x=0;x<c;x++)f+=`
           xTexelC${x*2} = vec4(0.0);
           xTexelC${x*2}Ready = 0;
           xTexelC${x*2+1} = vec4(0.0);
           xTexelC${x*2+1}Ready = 0;
           xC${x} = vec4(0.0);`;f+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let x=0;x<(p+1)/2;x++){let g=x*2;if(f+=`
           xC = xCCorner + ${g*l};
           `,a===1){if(g<c&&(i%2===1?(f+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${g}Ready == 0) {
                   xTexelC${g} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${g}.zw = vec2(0.0);
                   }
                   xTexelC${g}Ready = 1;
                 }
               `,l===1&&g>0?f+=`
                 xC${g} = vec4(xTexelC${g-2}.zw, xTexelC${g}.xy);
                 `:f+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${g} = vec4(previous.zw, xTexelC${g}.xy);
                   } else {
                     xC${g} = vec4(0.0, 0.0, xTexelC${g}.xy);
                   }
                   `):f+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${g}Ready == 0) {
                   xTexelC${g} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${g}.zw = vec2(0.0);
                   }
                   xTexelC${g}Ready = 1;
                 }

                 xC${g} = xTexelC${g};
                 `,g+1<c)){let y=i%2===0?w.nearestLargerEven(l):l;l%2===0&&i%2===1||l%2!==0&&i%2!==1?(f+=`
                   xCOffset = xC + imod(pads[1], 2) + ${y};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${g+1}Ready == 0) {
                     xTexelC${g+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${g+1}.zw = vec2(0.0);
                     }
                     xTexelC${g+1}Ready = 1;
                   }
                   `,l>1?f+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${g+1} = vec4(previous.zw, xTexelC${g+1}.xy);
                     } else {
                      xC${g+1} = vec4(0.0, 0.0, xTexelC${g+1}.xy);
                     }
                     `:f+=`
                     xC${g+1} = vec4(xTexelC${g}.zw, xTexelC${g+1}.xy);
                     `):y===1?f+=`
                     xC${g+1} = xTexelC${g};
                     `:f+=`
                     xCOffset = xC + ${y};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${g+1}Ready == 0) {
                       xTexelC${g+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${g+1}.zw = vec2(0.0);
                       }
                       xTexelC${g+1}Ready = 1;
                     }

                     xC${g+1} = xTexelC${g+1};
                     `}}else g<c&&(i%2===1?(f+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${g}Ready == 0) {
                   xTexelC${g} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${g}.zw = vec2(0.0);
                   }
                   xTexelC${g}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${g+1}Ready == 0) {
                   xTexelC${g+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${g+1}.zw = vec2(0.0);
                   }
                   xTexelC${g+1}Ready = 1;
                 }

                 xC${g} = vec4(xTexelC${g}.zw, xTexelC${g+1}.zw);
               `,g+1<c&&(f+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${g+1} = vec4(xTexelC${g+1}.xy, final.xy);
                 `)):(f+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${g}Ready == 0) {
                   xTexelC${g} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${g}.zw = vec2(0.0);
                   }
                   xTexelC${g}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${g+1}Ready == 0) {
                   xTexelC${g+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${g+1}.zw = vec2(0.);
                   }
                   xTexelC${g+1}Ready = 1;
                 }

                 xC${g} = vec4(
                   xTexelC${g}.xy, xTexelC${g+1}.xy);
               `,g+1<c&&(f+=`
                   xC${g+1} = vec4(xTexelC${g}.zw, xTexelC${g+1}.zw);
                 `)));g<c&&(f+=`
             wTexel = getW(r, ${g}, d1, d2);
             dotProd += xC${g}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${g}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,g+1<c&&(f+=`
               wTexel = getW(r, ${g+1}, d1, d2);
               dotProd += xC${g+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${g+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}f+=`
     }
   `,f+=`
     }
   `,f+=`
     }
   `;let d="",m="";n&&(o?d=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${n}
         }`:s?d=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${n}
         }`:d=`vec4 activation(vec4 x) {
           ${n}
         }`,m="result = activation(result);");let h=r?"result += getBiasAtOutCoords();":"";r&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${d}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${f}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${h}
         ${m}
         setOutput(result);
       }
     `}};var iS=class{constructor(e,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=kt(this.outputShape.length);let{dataFormat:n}=r,o=Qt(),s=n==="channelsLast",i=s?1:2,a=s?2:3,l=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`,u="";for(let c=0;c<=1;c++)for(let p=0;p<=1;p++)u+=`
          blockIndex = rc.z + ${p};
          pos = rc.y + ${c};

          ${l}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${i}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${s}) {
                  innerDims = vec2(d1, ch);
                  result[${c*2+p}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${c*2+p}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${u}

        ${o.output} = result;
      }
    `}};function aS(t,e){let r=t.length;return r>=3?e?[...t.slice(0,-3),t[r-3]*t[r-2],t[r-1]]:[...t.slice(0,-3),t[r-3],t[r-2]*t[r-1]]:!e&&r===1&&t[0]>1?[t[0],1]:null}function lS({x:t,filter:e,convInfo:r,backend:n,bias:o=null,preluActivationWeights:s=null,leakyreluAlpha:i=0,activation:a=null}){let l=t.shape,u=n.texData.get(t.dataId),c=r.inChannels,p=l[0]*l[1]*l[2],f=r.outChannels,d=r.dataFormat==="channelsLast",m=!1,h=!1,x,g=[];if(s!=null){let v=aS(s.shape,d);v!=null&&(s=ce({inputs:{x:s},backend:n,attrs:{shape:v}}),g.push(s))}if(o!=null){let v=aS(o.shape,d);v!=null&&(o=ce({inputs:{x:o},backend:n,attrs:{shape:v}}),g.push(o))}if(!((p===1||f===1)&&c>tA)&&u.isPacked&&d&&u.texture!=null&&l[2]%2!==0&&w.arraysEqual(u.shape.slice(-3),l.slice(-3))){let v=l[0]*l[1]*(l[2]+1),C={dataId:t.dataId,shape:[1,v,r.inChannels],dtype:t.dtype},S=u.shape;u.shape=u.shape.slice(),u.shape[u.shape.length-2]++,w.assert(_f(u.shape,C.shape),()=>`packed reshape ${u.shape} to ${C.shape} isn't free`);let k=ce({inputs:{x:e},backend:n,attrs:{shape:[1,r.inChannels,r.outChannels]}});g.push(k);let I=Ff({a:C,b:k,backend:n,transposeA:m,transposeB:h,bias:o,activation:a,preluActivationWeights:s,leakyreluAlpha:i}),A=n.texData.get(I.dataId);w.assert(A.isPacked,()=>"batchMatMul result is expected to be packed"),u.shape=S,A.shape=r.outShape,x=ur({inputs:{x:I},backend:n}),x.shape=r.outShape,g.push(I)}else{let v=r.outHeight*r.outWidth,C=ce({inputs:{x:t},backend:n,attrs:{shape:d?[r.batchSize,v,r.inChannels]:[r.batchSize,r.inChannels,v]}}),S=ce({inputs:{x:e},backend:n,attrs:{shape:[1,r.inChannels,r.outChannels]}}),k=Ff({a:d?C:S,b:d?S:C,transposeA:!d,transposeB:h,backend:n,bias:o,activation:a,preluActivationWeights:s,leakyreluAlpha:i});x=ce({inputs:{x:k},backend:n,attrs:{shape:r.outShape}}),g.push(C),g.push(S),g.push(k)}for(let v of g)n.disposeIntermediateTensorInfo(v);return x}function uS({x:t,filter:e,convInfo:r,backend:n,bias:o=null,preluActivationWeights:s=null,leakyreluAlpha:i=0,activation:a=null}){let{filterWidth:l,filterHeight:u,inChannels:c,outWidth:p,outHeight:f,dataFormat:d}=r,m=d==="channelsLast",h=l*u*c,x=f*p,g=[r.batchSize,h,x],y=!0,b=!1,v=[];if(s!=null){let Z=aS(s.shape,m);Z!=null&&(s=ce({inputs:{x:s},backend:n,attrs:{shape:Z}}),v.push(s))}if(o!=null){let Z=aS(o.shape,m);Z!=null&&(o=ce({inputs:{x:o},backend:n,attrs:{shape:Z}}),v.push(o))}let C=ce({inputs:{x:e},backend:n,attrs:{shape:[1,h,w.sizeFromShape(e.shape)/h]}});v.push(C);let S=new iS(g,r),k=[t.shape,[r.padInfo.top,r.padInfo.left],[r.strideHeight,r.strideWidth],[r.dilationHeight,r.dilationWidth],[r.inChannels],[r.filterWidth*r.inChannels],[r.outWidth]],I=n.runWebGLProgram(S,[t],"float32",k),A=ce({inputs:{x:I},backend:n,attrs:{shape:g}});v.push(I),v.push(A);let $=o!=null,O=s!=null,j=a==="leakyrelu",H=a?Pl(a,!0):null,Y=new Wh(m?A.shape:C.shape,m?C.shape:A.shape,m?[r.batchSize,x,r.outChannels]:[r.batchSize,r.outChannels,x],y,b,$,H,O,j),B=m?[A,C]:[C,A];if(o&&B.push(o),O&&B.push(s),j){let Z=n.makeTensorInfo([],"float32",w.createScalarValue(i,"float32"));B.push(Z),v.push(Z)}let K=n.runWebGLProgram(Y,B,"float32"),X=ce({inputs:{x:K},backend:n,attrs:{shape:r.outShape}});v.push(K);for(let Z of v)n.disposeIntermediateTensorInfo(Z);return X}function Dpe(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,filter:s}=e,{strides:i,pad:a,dataFormat:l,dilations:u,dimRoundingMode:c}=n,p=T.convertConv2DDataFormat(l),f=T.computeConv2DInfo(o.shape,s.shape,i,u,a,c,!1,p),d;if(f.filterHeight===1&&f.filterWidth===1&&f.dilationHeight===1&&f.dilationWidth===1&&f.strideHeight===1&&f.strideWidth===1&&(f.padInfo.type==="SAME"||f.padInfo.type==="VALID"))d=lS({x:o,filter:s,convInfo:f,backend:r});else if(f.strideWidth<=2&&p==="channelsLast"&&W().getBool("WEBGL_EXP_CONV")){let h=new Hh(f),x=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];d=r.runWebGLProgram(h,[o,s],"float32",x)}else if(W().getBool("WEBGL_CONV_IM2COL"))d=uS({x:o,filter:s,convInfo:f,backend:r});else{let h=new Uh(f);d=r.runWebGLProgram(h,[o,s],"float32")}let m=ce({inputs:{x:d},backend:r,attrs:{shape:f.outShape}});return r.disposeIntermediateTensorInfo(d),m}var D6={kernelName:Iu,backendName:"webgl",kernelFunc:Dpe};var cS=class{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;let r=e.strideHeight,n=e.strideWidth,o=e.padInfo.top,s=e.padInfo.left,i=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${r} - ${o};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${n} - ${s};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              if (${i}) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}},pS=class{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;let r=e.filterHeight,n=e.filterWidth,o=e.strideHeight,s=e.strideWidth,i=e.dataFormat==="channelsLast",a=r-1-e.padInfo.top,l=n-1-e.padInfo.left,u=i?1:2,c=i?2:3,p=i?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${p}];

        ivec2 dyCorner = ivec2(coords[${u}], coords[${c}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${r}; wR++) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${r} - 1 - wR;

          for (int wC = 0; wC < ${n}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${n} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${i}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}},fS=class{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;let r=e.strideDepth,n=e.strideHeight,o=e.strideWidth,s=e.padInfo.front,i=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${r} - ${s};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${n} - ${i};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${o} - ${a};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}},dS=class{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;let r=e.filterDepth,n=e.filterHeight,o=e.filterWidth,s=e.strideDepth,i=e.strideHeight,a=e.strideWidth,l=r-1-e.padInfo.front,u=n-1-e.padInfo.top,c=o-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${l}, ${u}, ${c});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${r}; wF++) {
          float dyF = float(dyFCorner + wF) / ${s}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${r} - 1 - wF;

          for (int wR = 0; wR < ${n}; wR++) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${n} - 1 - wR;

            for (int wC = 0; wC < ${o}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${o} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function $pe(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,dy:s}=e,{strides:i,pad:a,dataFormat:l,dimRoundingMode:u,filterShape:c}=n,p=T.convertConv2DDataFormat(l),f=T.computeConv2DInfo(o.shape,c,i,1,a,u,!1,p),d=new cS(f);return r.runWebGLProgram(d,[o,s],"float32")}var $6={kernelName:Gd,backendName:"webgl",kernelFunc:$pe};function Rpe(t){let{inputs:e,backend:r,attrs:n}=t,{dy:o,filter:s}=e,{inputShape:i,strides:a,pad:l,dataFormat:u,dimRoundingMode:c}=n,p=T.convertConv2DDataFormat(u),f=T.computeConv2DInfo(i,s.shape,a,1,l,c,!1,p),d=new pS(f);return r.runWebGLProgram(d,[o,s],"float32")}var R6={kernelName:Eu,backendName:"webgl",kernelFunc:Rpe};function Ope(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,filter:s}=e,{strides:i,pad:a,dilations:l}=n,u=T.computeConv3DInfo(o.shape,s.shape,i,l,a),c=new sS(u);return r.runWebGLProgram(c,[o,s],"float32")}var O6={kernelName:_u,backendName:"webgl",kernelFunc:Ope};function Fpe(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,dy:s}=e,{strides:i,pad:a,filterShape:l}=n,u=T.computeConv3DInfo(o.shape,l,i,1,a),c=new fS(u);return r.runWebGLProgram(c,[o,s],"float32")}var F6={kernelName:Ud,backendName:"webgl",kernelFunc:Fpe};function Ppe(t){let{inputs:e,backend:r,attrs:n}=t,{dy:o,filter:s}=e,{pad:i,strides:a,inputShape:l}=n,u=T.computeConv3DInfo(l,s.shape,a,1,i),c=new dS(u);return r.runWebGLProgram(c,[o,s],"float32")}var P6={kernelName:Hd,backendName:"webgl",kernelFunc:Ppe};var Lpe=Ms+`
  return cos(x);
`,Mpe=Te({opSnippet:Lpe}),L6={kernelName:_a,backendName:"webgl",kernelFunc:Mpe};var zpe=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,Bpe=Te({opSnippet:zpe}),M6={kernelName:Aa,backendName:"webgl",kernelFunc:Bpe};var mS=class{constructor(e,r,n,o,s){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];let[i,a,l,u]=e,[c]=r,[p,f]=n;this.outputShape=[c,p,f,u];let d=o==="bilinear"?1:0,[m,h]=[`${a-1}.0`,`${l-1}.0`],[x,g,y]=p>1?[`${(a-1)/(p-1)}`,"(y2-y1) * height_ratio",`y1*${m} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${m}`],[b,v,C]=f>1?[`${(l-1)/(f-1)}`,"(x2-x1) * width_ratio",`x1*${h} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${h}`];this.userCode=`
      const float height_ratio = float(${x});
      const float width_ratio = float(${b});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${i}) {
          return;
        }

        float height_scale = ${g};
        float width_scale = ${v};

        float in_y = ${y};
        if( in_y < 0.0 || in_y > ${m} ) {
          setOutput(float(${s}));
          return;
        }
        float in_x = ${C};
        if( in_x < 0.0 || in_x > ${h} ) {
          setOutput(float(${s}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${d} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}};var Vpe=t=>{let{inputs:e,backend:r,attrs:n}=t,{image:o,boxes:s,boxInd:i}=e,{cropSize:a,method:l,extrapolationValue:u}=n,c=new mS(o.shape,s.shape,a,l,u);return r.runWebGLProgram(c,[o,s,i],"float32")},z6={kernelName:jd,backendName:"webgl",kernelFunc:Vpe};var Lf;(function(t){t.Prod="*",t.Sum="+"})(Lf||(Lf={}));var H0=class{constructor(e,r,n,o){this.op=e,this.outputShape=r,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];let s=this.outputShape.length,i=this.op===Lf.Prod?"1.0":"0.0",a=n?i:`getX(${B6(s,"coords",this.op)})`,l=this.outputShape[this.outputShape.length-1],u="",c="";n?(u=o?`end != ${l-1}`:"end != 0",c=o?"end + 1":"end - 1"):(u=o?`end + pow2 < ${l}`:"end >= pow2",c=o?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${je(s)} coords = getOutputCoords();
        int end = ${V6(s,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${u}) {
          int idx = ${c};
          ${V6(s,"coords",this.op)} = idx;
          val ${this.op}= getX(${B6(s,"coords",this.op)});
        }
        setOutput(val);
      }
    `}};function B6(t,e,r){if(t===1)return`${e}`;if(t===2)return`${e}.x, ${e}.y`;if(t===3)return`${e}.x, ${e}.y, ${e}.z`;if(t===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${r} for rank ${t} is not yet supported`)}function V6(t,e,r){if(t===1)return`${e}`;if(t===2)return`${e}.y`;if(t===3)return`${e}.z`;if(t===4)return`${e}.w`;throw new Error(`Cumulative ${r} for rank ${t} is not yet supported`)}function hS(t,e,r,n,o,s){let i=e.shape.length,a=T.getAxesPermutation([n],i),l=e;a!=null&&(l=Ut({inputs:{x:e},backend:r,attrs:{perm:a}}));let u=T.getInnerMostAxes(1,i)[0];if(u!==i-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${n}`);let c=l.shape[u],p=ur({inputs:{x:l},backend:r});for(let f=0;f<=Math.ceil(Math.log2(c))-1;f++){let d=new H0(t,l.shape,!1,s),m=[[f]],h=p;p=r.runWebGLProgram(d,[p],p.dtype,m),r.disposeIntermediateTensorInfo(h)}if(o){let f=new H0(t,l.shape,o,s),d=p;p=r.runWebGLProgram(f,[p],p.dtype),r.disposeIntermediateTensorInfo(d)}if(a!=null){let f=T.getUndoAxesPermutation(a),d=Ut({inputs:{x:p},backend:r,attrs:{perm:f}});return r.disposeIntermediateTensorInfo(p),r.disposeIntermediateTensorInfo(l),d}return p}function Wpe(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{axis:s,exclusive:i,reverse:a}=n;return hS(Lf.Prod,o,r,s,i,a)}var W6={kernelName:qd,backendName:"webgl",kernelFunc:Wpe};function Gpe(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{axis:s,exclusive:i,reverse:a}=n;return hS(Lf.Sum,o,r,s,i,a)}var G6={kernelName:Au,backendName:"webgl",kernelFunc:Gpe};function Upe(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,weights:s}=e,{size:i,binaryOutput:a}=n;if(o.shape.length===1){let l=r.readSync(o.dataId),u=r.readSync(s.dataId),c=DC(l,u,s.dtype,s.shape,i);return r.makeTensorInfo([i],s.dtype,c)}else if(o.shape.length===2){let l=r.bufferSync(o),u=r.bufferSync(s),c=DW(l,u,i,a);return r.makeTensorInfo(c.shape,s.dtype,c.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${o.shape.length}.`)}var U6={kernelName:Kd,backendName:"webgl",kernelFunc:Upe};var gS=class{constructor(e,r,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=r,this.dataFormat=n,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${r};
      int offset_h = imod(h, ${r});
      int in_w = w / ${r};
      int offset_w = imod(w, ${r});
      int offset_d = (offset_h * ${r} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}};function Hpe(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{blockSize:s,dataFormat:i}=n,a=o.shape[0],l=i==="NHWC"?o.shape[1]:o.shape[2],u=i==="NHWC"?o.shape[2]:o.shape[3],c=i==="NHWC"?o.shape[3]:o.shape[1],p=l*s,f=u*s,d=c/(s*s),m=i==="NHWC"?[a,p,f,d]:[a,d,p,f],h=new gS(m,s,i);return r.runWebGLProgram(h,[o],o.dtype)}var H6={kernelName:Xd,backendName:"webgl",kernelFunc:Hpe};var qh=class{constructor(e,r=!1,n=null,o=!1,s=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=kt(this.outputShape.length);let i=e.filterHeight,a=e.filterWidth,l=e.outChannels/e.inChannels,u="",c="";n&&(o?u=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${n}
        }`:s?u=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${n}
        }`:u=`
          float activation(float x) {
            ${n}
          }
        `,c="result = activation(result);");let p=r?"result += getBiasAtOutCoords();":"";r&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${u}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${l};
        int q = d2 - d1 * ${l};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${i}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${p}
        ${c}
        setOutput(result);
      }
    `}};var jh=class{constructor(e,r=!1,n=null,o=!1,s=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=kt(this.outputShape.length);let i=e.outChannels/e.inChannels,a=e.padInfo.left,l=e.strideWidth,u=e.dilationWidth,c=e.filterHeight,p=e.filterWidth,f=p,d=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let g=0;g<p;g++)d+=`
          vec4 xTexelC${g*2};
          int xTexelC${g*2}Ready;
          vec4 xTexelC${g*2+1};
          int xTexelC${g*2+1}Ready;
          vec4 xC${g};`;d+=`
    for (int r = 0; r < ${c}; r++) {
      `;for(let g=0;g<p;g++)d+=`
          xTexelC${g*2} = vec4(0.0);
          xTexelC${g*2}Ready = 0;
          xTexelC${g*2+1} = vec4(0.0);
          xTexelC${g*2+1}Ready = 0;
          xC${g} = vec4(0.0);`;d+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let g=0;g<(f+1)/2;g++){let y=g*2;if(d+=`
          xC = xCCorner + ${y*u};
          `,l===1){if(y<p&&(a%2===1?(d+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                  xTexelC${y} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${y}.zw = vec2(0.0);
                  }
                  xTexelC${y}Ready = 1;
                }
              `,u===1&&y>0?d+=`
                xC${y} = vec4(xTexelC${y-2}.zw, xTexelC${y}.xy);
                `:d+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${y} = vec4(previous.zw, xTexelC${y}.xy);
                  } else {
                    xC${y} = vec4(0.0, 0.0, xTexelC${y}.xy);
                  }
                  `):d+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                  xTexelC${y} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${y}.zw = vec2(0.0);
                  }
                  xTexelC${y}Ready = 1;
                }

                xC${y} = xTexelC${y};
                `,y+1<p)){let b=a%2===0?w.nearestLargerEven(u):u;u%2===0&&a%2===1||u%2!==0&&a%2!==1?(d+=`
                  xCOffset = xC + imod(pads[1], 2) + ${b};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                    xTexelC${y+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${y+1}.zw = vec2(0.0);
                    }
                    xTexelC${y+1}Ready = 1;
                  }
                  `,u>1?d+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${y+1} = vec4(previous.zw, xTexelC${y+1}.xy);
                    } else {
                     xC${y+1} = vec4(0.0, 0.0, xTexelC${y+1}.xy);
                    }
                    `:d+=`
                    xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.xy);
                    `):b===1?d+=`
                    xC${y+1} = xTexelC${y};
                    `:d+=`
                    xCOffset = xC + ${b};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                      xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${y+1}.zw = vec2(0.0);
                      }
                      xTexelC${y+1}Ready = 1;
                    }

                    xC${y+1} = xTexelC${y+1};
                    `}}else y<p&&(a%2===1?(d+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                  xTexelC${y} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${y}.zw = vec2(0.0);
                  }
                  xTexelC${y}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${y+1}Ready == 0) {
                  xTexelC${y+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${y+1}.zw = vec2(0.0);
                  }
                  xTexelC${y+1}Ready = 1;
                }

                xC${y} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
              `,y+1<p&&(d+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${y+1} = vec4(xTexelC${y+1}.xy, final.xy);
                `)):(d+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                  xTexelC${y} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${y}.zw = vec2(0.0);
                  }
                  xTexelC${y}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                  xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${y+1}.zw = vec2(0.);
                  }
                  xTexelC${y+1}Ready = 1;
                }

                xC${y} = vec4(
                  xTexelC${y}.xy, xTexelC${y+1}.xy);
              `,y+1<p&&(d+=`
                  xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
                `)));y<p&&(d+=`
            wTexel = getW(r, ${y}, d1, q);
            dotProd += xC${y} * vec4(wTexel.xz, wTexel.xz);
          `,y+1<p&&(d+=`
              wTexel = getW(r, ${y+1}, d1, q);
              dotProd += xC${y+1} * vec4(wTexel.xz, wTexel.xz);
            `))}d+=`
    }
  `,d+=`
      }
    `;let m="",h="";n&&(o?m=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${n}
        }`:s?m=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${n}
        }`:m=`vec4 activation(vec4 x) {
          ${n}
        }`,h="result = activation(result);");let x=r?"result += getBiasAtOutCoords();":"";r&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${m}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${i};
        int q = d2 - d1 * ${i};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${d}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${x}
        ${h}
        setOutput(result);
      }
    `}};function qpe(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,filter:s}=e,{strides:i,pad:a,dilations:l,dimRoundingMode:u}=n,c=l;c==null&&(c=[1,1]),w.assert(T.eitherStridesOrDilationsAreOne(i,c),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${c}'`);let p=T.computeConv2DInfo(o.shape,s.shape,i,c,a,u,!0),f;W().getBool("WEBGL_PACK_DEPTHWISECONV")&&p.strideWidth<=2&&p.outChannels/p.inChannels===1?f=new jh(p):f=new qh(p);let d=[[p.padInfo.top,p.padInfo.left],[p.strideHeight,p.strideWidth],[p.dilationHeight,p.dilationWidth],[p.inHeight,p.inWidth]];return r.runWebGLProgram(f,[o,s],"float32",d)}var q6={kernelName:Du,backendName:"webgl",kernelFunc:qpe};var xS=class{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;let r=e.strideHeight,n=e.strideWidth,o=e.padInfo.top,s=e.padInfo.left,i=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${i} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${r} - ${o};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${n} - ${s};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}},yS=class{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;let r=e.filterHeight,n=e.filterWidth,o=e.strideHeight,s=e.strideWidth,i=r-1-e.padInfo.top,a=n-1-e.padInfo.left,l=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${i}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${r}; wR++) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${r} - 1 - wR;

          for (int wC = 0; wC < ${n}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${n} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${l}; dm++) {
              int d2 = d1 * ${l} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function jpe(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,dy:s}=e,{strides:i,dilations:a,pad:l,dimRoundingMode:u,filterShape:c}=n,p=T.computeConv2DInfo(o.shape,c,i,a,l,u,!0),f=new xS(p);return r.runWebGLProgram(f,[o,s],"float32")}var j6={kernelName:Yd,backendName:"webgl",kernelFunc:jpe};function Kpe(t){let{inputs:e,backend:r,attrs:n}=t,{dy:o,filter:s}=e,{strides:i,dilations:a,pad:l,dimRoundingMode:u,inputShape:c}=n,p=T.computeConv2DInfo(c,s.shape,i,a,l,u,!0),f=new yS(p);return r.runWebGLProgram(f,[o,s],"float32")}var K6={kernelName:Qd,backendName:"webgl",kernelFunc:Kpe};var bS=class{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}};function Xpe(t){let{inputs:e,backend:r}=t,{x:n}=e,o=[...n.shape,...n.shape],s=w.sizeFromShape(n.shape),i=ce({inputs:{x:n},backend:r,attrs:{shape:[s]}}),a=new bS(s),l=r.runWebGLProgram(a,[i],i.dtype),u=ce({inputs:{x:l},backend:r,attrs:{shape:o}});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(l),u}var X6={kernelName:Mv,backendName:"webgl",kernelFunc:Xpe};var vS=class{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;let{inHeight:r,inWidth:n,padInfo:o,strideHeight:s,strideWidth:i,filterHeight:a,filterWidth:l,dilationHeight:u,dilationWidth:c}=e,{top:p,left:f}=o;this.userCode=`
      const ivec2 strides = ivec2(${s}, ${i});
      const ivec2 pads = ivec2(${p}, ${f});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${u};

          if (hIn >= 0 && hIn < ${r}) {
            for (int w = 0; w < ${l}; w++) {
              int wIn = wBeg + w * ${c};

              if (wIn >= 0 && wIn < ${n}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}};function Ype(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,filter:s}=e,{strides:i,pad:a,dilations:l}=n,u=T.computeDilation2DInfo(o.shape,s.shape,i,a,"NHWC",l),c,p=new vS(u);c=r.runWebGLProgram(p,[o,s],"float32");let f=ce({inputs:{x:c},backend:r,attrs:{shape:u.outShape}});return r.disposeIntermediateTensorInfo(c),f}var Y6={kernelName:$u,backendName:"webgl",kernelFunc:Ype};function Qpe(t){let{inputs:e,backend:r,attrs:n}=t,{equation:o}=n,s=e,{allDims:i,summedDims:a,idDims:l}=T.decodeEinsumEquation(o,s.length);T.checkEinsumDimSizes(i.length,l,s);let{path:u,steps:c}=T.getEinsumComputePath(a,l),p=c.length,f=null,d=i.length,m=[];for(let h=0;h<p;++h){for(let x of c[h]){let{permutationIndices:g,expandDims:y}=T.getEinsumPermutation(d,l[x]),b;T.isIdentityPermutation(g)?b=s[x]:(b=Ut({inputs:{x:s[x]},backend:r,attrs:{perm:g}}),m.push(b));let v=b.shape.slice();for(let C=0;C<y.length;++C)v.splice(y[C],0,1);w.arraysEqual(b.shape,v)||(b=ce({inputs:{x:b},backend:r,attrs:{shape:v}}),m.push(b)),f===null?f=b:(f=G0({inputs:{a:b,b:f},backend:r}),m.push(f))}h<p-1&&(u[h]>=0&&(f=Of({inputs:{x:f},backend:r,attrs:{axis:u[h]-(i.length-d),keepDims:!1}}),m.push(f)),d--)}for(let h of m)h!==f&&r.disposeIntermediateTensorInfo(h);return f}var Q6={kernelName:Zd,backendName:"webgl",kernelFunc:Qpe};var Zpe="return (x >= 0.0) ? x : (exp(x) - 1.0);",Jpe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,efe=Te({opSnippet:Zpe,packedOpSnippet:Jpe}),Z6={kernelName:$a,backendName:"webgl",kernelFunc:efe};var tfe="return (b >= 1.0) ? a : a * (b + 1.0);",rfe=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,nfe=t=>{let{inputs:e,backend:r}=t,{dy:n,y:o}=e,s=W().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Ls(rfe,n.shape,o.shape):new rs(tfe,n.shape,o.shape);return r.runWebGLProgram(s,[n,o],n.dtype)},J6={kernelName:Jd,backendName:"webgl",kernelFunc:nfe};var ofe=`
  return vec4(equal(a, b));
`,sfe="return float(a == b);",ife=lt({opSnippet:sfe,packedOpSnippet:ofe,dtype:"bool",cpuKernelImpl:FW}),eU={kernelName:Ep,backendName:"webgl",kernelFunc:ife};var afe=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${T.ERF_P};
  float a1 = ${T.ERF_A1};
  float a2 = ${T.ERF_A2};
  float a3 = ${T.ERF_A3};
  float a4 = ${T.ERF_A4};
  float a5 = ${T.ERF_A5};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,lfe=Te({opSnippet:afe}),tU={kernelName:Ra,backendName:"webgl",kernelFunc:lfe};var ufe=Ms+`
  return exp(x);
`,cfe=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,iA=Te({opSnippet:ufe,packedOpSnippet:cfe,cpuKernelImpl:PW,dtype:"float32"}),rU={kernelName:Oa,backendName:"webgl",kernelFunc:iA};function wS(t){let{inputs:e,attrs:r,backend:n}=t,{dim:o}=r,{input:s}=e,i=s.shape.length,a=s.shape.slice(),l=o;return o<0&&(w.assert(-(i+1)<=o,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),l=i+o+1),a.splice(l,0,1),ce({inputs:{x:s},backend:n,attrs:{shape:a}})}var nU={kernelName:Ru,backendName:"webgl",kernelFunc:wS};var oU="return exp(x) - 1.0;",pfe=Te({opSnippet:oU,packedOpSnippet:oU,cpuKernelImpl:LW}),sU={kernelName:Fa,backendName:"webgl",kernelFunc:pfe};var q0=class{constructor(e,r,n){this.variableNames=["real","imag"];let o=r[1];this.outputShape=r;let s=n?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,i=n?`${o}.0`:"1.0",a;if(e==="real")a="return real * expR - imag * expI;";else if(e==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${s};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${o});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${o}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${i};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}};function CS(t,e,r){let n=r.texData.get(t.dataId),o=w.sizeFromShape(t.shape),s=t.shape[t.shape.length-1],i=o/s,a=ce({inputs:{x:t},backend:r,attrs:{shape:[i,s]}}),l=a.shape,u=new q0("real",l,e),c=new q0("imag",l,e),p=[{dataId:n.complexTensorInfos.real.dataId,dtype:n.complexTensorInfos.real.dtype,shape:l},{dataId:n.complexTensorInfos.imag.dataId,dtype:n.complexTensorInfos.imag.dtype,shape:l}],f=r.runWebGLProgram(u,p,"float32"),d=r.runWebGLProgram(c,p,"float32"),m=co({inputs:{real:f,imag:d},backend:r});r.disposeIntermediateTensorInfo(f),r.disposeIntermediateTensorInfo(d);let h=ce({inputs:{x:m},backend:r,attrs:{shape:t.shape}});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(m),h}function ffe(t){let{inputs:e,backend:r}=t,{input:n}=e;return CS(n,!1,r)}var iU={kernelName:em,backendName:"webgl",kernelFunc:ffe};var SS=class{constructor(e,r){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}};function Ml(t){let{backend:e,attrs:r}=t,{shape:n,value:o}=r,{dtype:s}=r;if(s=s||w.inferDtype(o),s==="string"){let i=w.getArrayFromDType(s,w.sizeFromShape(n));return i.fill(o),e.makeTensorInfo(n,s,i)}else{let i=new SS(n,o),a=[[o]];return e.runWebGLProgram(i,[],s,a)}}var aU={kernelName:tm,backendName:"webgl",kernelFunc:Ml};var kS=class{constructor(e){this.variableNames=["Image"],this.outputShape=[];let r=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${r} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${r}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}};var lU={kernelName:rm,backendName:"webgl",kernelFunc:({inputs:t,backend:e})=>{let{image:r}=t,n=e,o=new kS(r.shape);return n.runWebGLProgram(o,[r],r.dtype)}};var uU="return floor(x);",dfe=Te({opSnippet:uU,packedOpSnippet:uU,cpuKernelImpl:MW}),cU={kernelName:Pa,backendName:"webgl",kernelFunc:dfe};var mfe=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,hfe=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,gfe=lt({opSnippet:mfe,packedOpSnippet:hfe,dtype:"int32"}),pU={kernelName:La,backendName:"webgl",kernelFunc:gfe};var TS=class{constructor(e){this.variableNames=["A"];let r=Qt(),[n,o]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${o}.0, ${n}.0);

        vec4 values = ${r.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}};var NS=class{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;let r=Qt(),[n,o]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${o}.0, ${n}.0);
            vec4 values = ${r.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${r.output} = result;
      }
    `}};var fU={kernelName:yx,backendName:"webgl",kernelFunc:xfe},Kh,aA=W().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function xfe(t){let{inputs:e,backend:r,attrs:n}=t,{pixels:o}=e,{numChannels:s}=n,i=typeof HTMLVideoElement<"u"&&o instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement,[l,u]=i?[o.videoWidth,o.videoHeight]:[o.width,o.height],c=[u,l],p=[u,l,s];if(a||i){let h=W().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(Kh==null||h!==aA)&&(aA=h,Kh=document.createElement("canvas").getContext("2d",{willReadFrequently:aA})),Kh.canvas.width=l,Kh.canvas.height=u,Kh.drawImage(o,0,0,l,u),o=Kh.canvas}let f=r.makeTensorInfo(c,"int32");r.texData.get(f.dataId).usage=Cn.PIXELS,r.gpgpu.uploadPixelDataToTexture(r.getTexture(f.dataId),o);let d=W().getBool("WEBGL_PACK")?new NS(p):new TS(p),m=r.runWebGLProgram(d,[f],"int32");return r.disposeData(f.dataId),m}function yfe(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,filter:s,bias:i,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:c,dilations:p,dimRoundingMode:f,activation:d,leakyreluAlpha:m}=n,h=T.convertConv2DDataFormat(c),x=T.computeConv2DInfo(o.shape,s.shape,l,p,u,f,!1,h),g,y=[],b=i!=null,v=a!=null,C=d==="leakyrelu",S=()=>{let I=[o,s],A=($,O)=>{if(O==="NCHW"&&$.shape.length===1&&$.shape[0]!==1){let j=ce({inputs:{x:$},backend:r,attrs:{shape:[$.shape[0],1,1]}});return y.push(j),j}return $};if(b&&I.push(A(i,c)),v&&I.push(A(a,c)),C){let $=r.makeTensorInfo([],"float32",w.createScalarValue(m,"float32"));I.push($),y.push($)}return I};if(x.filterHeight===1&&x.filterWidth===1&&x.dilationHeight===1&&x.dilationWidth===1&&x.strideHeight===1&&x.strideWidth===1&&(x.padInfo.type==="SAME"||x.padInfo.type==="VALID"))g=lS({x:o,filter:s,convInfo:x,backend:r,bias:i,activation:d,preluActivationWeights:a,leakyreluAlpha:m});else if(x.strideWidth<=2&&h==="channelsLast"&&W().getBool("WEBGL_EXP_CONV")){let I=d?Pl(d,!0):null,A=new Hh(x,b,I,v,C),$=[[x.padInfo.top,x.padInfo.left],[x.strideHeight,x.strideWidth],[x.dilationHeight,x.dilationWidth],[x.inHeight,x.inWidth]],O=S();g=r.runWebGLProgram(A,O,"float32",$)}else if(W().getBool("WEBGL_CONV_IM2COL"))g=uS({x:o,filter:s,convInfo:x,backend:r,bias:i,activation:d,preluActivationWeights:a,leakyreluAlpha:m});else{let I=d?Pl(d,!1):null,A=new Uh(x,b,I,v,C),$=S();g=r.runWebGLProgram(A,$,"float32")}let k=ce({inputs:{x:g},backend:r,attrs:{shape:x.outShape}});return y.push(g),y.forEach(I=>r.disposeIntermediateTensorInfo(I)),k}var dU={kernelName:Lp,backendName:"webgl",kernelFunc:yfe};function bfe(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,filter:s,bias:i,preluActivationWeights:a}=e,{strides:l,pad:u,dilations:c,dimRoundingMode:p,activation:f,leakyreluAlpha:d}=n,m=[],h=c;h==null&&(h=[1,1]),w.assert(T.eitherStridesOrDilationsAreOne(l,h),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${h}'`);let x=T.computeConv2DInfo(o.shape,s.shape,l,h,u,p,!0),g=W().getBool("WEBGL_PACK_DEPTHWISECONV")&&x.strideWidth<=2&&x.outChannels/x.inChannels===1,y=f?Pl(f,g):null,b=[o,s],v=i!=null,C=a!=null,S=f==="leakyrelu";if(v&&b.push(i),C&&b.push(a),S){let $=r.makeTensorInfo([],"float32",w.createScalarValue(d,"float32"));b.push($),m.push($)}let k;g?k=new jh(x,v,y,C,S):k=new qh(x,v,y,C,S);let I=[[x.padInfo.top,x.padInfo.left],[x.strideHeight,x.strideWidth],[x.dilationHeight,x.dilationWidth],[x.inHeight,x.inWidth]],A=r.runWebGLProgram(k,b,"float32",I);return m.forEach($=>r.disposeIntermediateTensorInfo($)),A}var mU={kernelName:Mp,backendName:"webgl",kernelFunc:bfe};var IS=class{constructor(e,r,n,o){this.sliceDim=e,this.strides=r,this.paramsShape=o,this.variableNames=["x","indices"],this.outputShape=n;let s=je(n.length),i=`
    int index;`;for(let a=0;a<this.sliceDim;a++)i+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${s} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${i}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}};function vfe(t){let{inputs:e,backend:r}=t,{params:n,indices:o}=e,s=o.shape,i=s[s.length-1],a=w.sizeFromShape(n.shape),[l,u,c,p]=T.prepareAndValidate(n,o),f=ce({inputs:{x:o},backend:r,attrs:{shape:[u,i]}}),d=ce({inputs:{x:n},backend:r,attrs:{shape:[w.sizeFromShape(n.shape)/c,c]}});if(r.shouldExecuteOnCPU([n,o])||n.dtype==="string"){let g=r.readSync(o.dataId),y=r.bufferSync(n),b=zW(g,y,n.dtype,u,i,c,p,n.shape,a);return r.makeTensorInfo(l,n.dtype,b.values)}let m=new IS(i,p,[u,c],n.shape),h=r.runWebGLProgram(m,[d,f],d.dtype),x=ce({inputs:{x:h},backend:r,attrs:{shape:l}});return r.disposeIntermediateTensorInfo(f),r.disposeIntermediateTensorInfo(d),r.disposeIntermediateTensorInfo(h),x}var hU={kernelName:zv,backendName:"webgl",kernelFunc:vfe};var ES=class{constructor(e,r){this.variableNames=["A","indices"],this.outputShape=r,this.rank=r.length;let n=je(this.rank),o=wfe(e,2);this.userCode=`
      void main() {
        ${n} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${o}));
      }
    `}};function wfe(t,e){let r=["resRC.x","resRC.y","resRC.z","resRC.w"],n=[];for(let o=0;o<t.length;o++)o===2?n.push("index"):n.push(`${r[o]}`);return n.join()}function lA(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,indices:s}=e,{axis:i,batchDims:a}=n,l=w.parseAxisParam(i,o.shape)[0];if(W().get("DEBUG")){let y=r.readSync(s.dataId),b=o.shape[l];for(let v=0;v<y.length;++v){let C=y[v];w.assert(C<=b-1&&C>=0,()=>`GatherV2: the index value ${C} is not in [0, ${b-1}]`)}}let u=T.segment_util.collectGatherOpShapeInfo(o,s,l,a),c=w.sizeFromShape(s.shape),p=[],f=ce({inputs:{x:o},backend:r,attrs:{shape:[u.batchSize,u.outerSize,u.dimSize,u.sliceSize]}}),d=ce({inputs:{x:s},backend:r,attrs:{shape:[u.batchSize,c/u.batchSize]}});p.push(f),p.push(d);let m=[u.batchSize,u.outerSize,c/u.batchSize,u.sliceSize];if(r.shouldExecuteOnCPU([o,s])||o.dtype==="string"){let y=r.bufferSync(d),b=r.bufferSync(f),v=BW(b,y,m);return p.forEach(C=>r.disposeIntermediateTensorInfo(C)),r.makeTensorInfo(u.outputShape,v.dtype,v.values)}let h=new ES(f.shape,m),x=r.runWebGLProgram(h,[f,d],f.dtype);p.push(x);let g=ce({inputs:{x},backend:r,attrs:{shape:u.outputShape}});return p.forEach(y=>r.disposeIntermediateTensorInfo(y)),g}var gU={kernelName:Fu,backendName:"webgl",kernelFunc:lA};var Cfe="return float(a > b);",Sfe=`
  return vec4(greaterThan(a, b));
`,kfe=lt({opSnippet:Cfe,packedOpSnippet:Sfe,cpuKernelImpl:VW,dtype:"bool"}),xU={kernelName:_p,backendName:"webgl",kernelFunc:kfe};var Tfe="return float(a >= b);",Nfe=`
  return vec4(greaterThanEqual(a, b));
`,Ife=lt({opSnippet:Tfe,packedOpSnippet:Nfe,dtype:"bool",cpuKernelImpl:WW}),yU={kernelName:Ma,backendName:"webgl",kernelFunc:Ife};function Efe(t){let{inputs:e,backend:r}=t,{input:n}=e;return CS(n,!0,r)}var bU={kernelName:nm,backendName:"webgl",kernelFunc:Efe};var _fe="return float(!isnan(x) && !isinf(x));",Afe=Te({opSnippet:_fe,dtype:"bool"}),vU={kernelName:za,backendName:"webgl",kernelFunc:Afe};var Dfe="return float(isinf(x));",$fe=Te({opSnippet:Dfe,dtype:"bool"}),wU={kernelName:Ba,backendName:"webgl",kernelFunc:$fe};var Rfe="return float(isnan(x));",Ofe=Te({opSnippet:Rfe,dtype:"bool"}),CU={kernelName:Va,backendName:"webgl",kernelFunc:Ofe};var Ffe="return float(a < b);",Pfe=`
  return vec4(lessThan(a, b));
`,Lfe=lt({opSnippet:Ffe,packedOpSnippet:Pfe,cpuKernelImpl:GW,dtype:"bool"}),SU={kernelName:Ap,backendName:"webgl",kernelFunc:Lfe};var Mfe="return float(a <= b);",zfe=`
  return vec4(lessThanEqual(a, b));
`,Bfe=lt({opSnippet:Mfe,packedOpSnippet:zfe,cpuKernelImpl:UW,dtype:"bool"}),kU={kernelName:Dp,backendName:"webgl",kernelFunc:Bfe};function Vfe(t){let{backend:e,attrs:r}=t,{start:n,stop:o,num:s}=r,i=HW(n,o,s);return e.makeTensorInfo([i.length],"float32",i)}var TU={kernelName:Bv,backendName:"webgl",kernelFunc:Vfe};var Wfe=Ms+`
  return x < 0.0 ? 0./0. : log(x);
`,Gfe=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,Ufe=Te({opSnippet:Wfe,packedOpSnippet:Gfe,cpuKernelImpl:qW}),NU={kernelName:Wa,backendName:"webgl",kernelFunc:Ufe};var Hfe=Ms+`
  return log(1.0 + x);
`,qfe=Te({opSnippet:Hfe}),IU={kernelName:Ga,backendName:"webgl",kernelFunc:qfe};var jfe="return float(a >= 1.0 && b >= 1.0);",Kfe=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,Xfe=lt({opSnippet:jfe,packedOpSnippet:Kfe,dtype:"bool"}),EU={kernelName:$p,backendName:"webgl",kernelFunc:Xfe};var Yfe="return float(!(x >= 1.0));",Qfe=Te({opSnippet:Yfe}),_U={kernelName:Rp,backendName:"webgl",kernelFunc:Qfe};var Zfe="return float(a >= 1.0 || b >= 1.0);",Jfe=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,ede=lt({opSnippet:Zfe,packedOpSnippet:Jfe,dtype:"bool"}),AU={kernelName:Op,backendName:"webgl",kernelFunc:ede};var _S=class{constructor(e,r,n,o,s){this.variableNames=["x"],this.outputShape=[];let i=r,a=e[3]-1;this.outputShape=e;let l,u=`float(${n}) + float(${o}) * sum`;s===.5?l=`inversesqrt(${u})`:s===1?l=`1.0/(${u})`:l=`exp(log(${u}) * float(-${s}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${i}; j <= ${i}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${l};
        setOutput(val);
      }
    `}};var AS=class{constructor(e,r,n,o,s){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;let i=r,a=e[3]-1;this.outputShape=e;let l,u=`float(${n}) + float(${o}) * sum`;s===.5?l=`inversesqrt(${u})`:s===1?l=`1.0/(${u})`:l=`exp(log(${u}) * float(-${s}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${i};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${i}; j <= ${i}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${l};
        setOutput(result);
      }
    `}};var tde=t=>{let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{depthRadius:s,bias:i,alpha:a,beta:l}=n,u=W().getBool("WEBGL_PACK_NORMALIZATION")?new AS(o.shape,s,i,a,l):new _S(o.shape,s,i,a,l);return r.runWebGLProgram(u,[o],o.dtype)},DU={kernelName:Lu,backendName:"webgl",kernelFunc:tde};var DS=class{constructor(e,r,n,o,s){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=r,this.bias=n,this.alpha=o,this.beta=s,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${r})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${r} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${o}) * norm + float(${n});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${o})
                * float(${s})
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${s});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}};var rde=t=>{let{inputs:e,backend:r,attrs:n}=t,{x:o,y:s,dy:i}=e,{depthRadius:a,bias:l,alpha:u,beta:c}=n,p=new DS(o.shape,a,l,u,c);return r.runWebGLProgram(p,[o,s,i],o.dtype)},$U={kernelName:sm,backendName:"webgl",kernelFunc:rde};function RU(t,e,r,n){let o=w.sizeFromShape(e),i=w.sizeFromShape(t.shape)/o,a=ce({inputs:{x:t},attrs:{shape:[i,o]},backend:n}),l=Oo(a,t.dtype,"max",n),u=ce({inputs:{x:l},attrs:{shape:r},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),u}function uA(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{reductionIndices:s,keepDims:i}=n,a=o.shape.length,l=w.parseAxisParam(s,o.shape),u=l,c=T.getAxesPermutation(u,a),p=c!=null,f=r.shouldExecuteOnCPU([o]),d=o;if(p){if(f){let b=r.texData.get(d.dataId).values,v=new Array(a);for(let k=0;k<v.length;k++)v[k]=o.shape[c[k]];let C=$f(b,o.shape,o.dtype,c,v);d=r.makeTensorInfo(v,o.dtype);let S=r.texData.get(d.dataId);S.values=C}else d=$c(o,c,r);u=T.getInnerMostAxes(u.length,a)}T.assertAxesAreInnerMostDims("max",u,a);let[m,h]=T.computeOutAndReduceShapes(d.shape,u),x=m;i&&(x=T.expandShapeToKeepDim(m,l));let g;if(f){let b=r.texData.get(d.dataId).values,v=jW(b,w.sizeFromShape(h),x,o.dtype);g=r.makeTensorInfo(x,o.dtype);let C=r.texData.get(g.dataId);C.values=v}else g=RU(d,h,x,r);return p&&r.disposeIntermediateTensorInfo(d),g}var OU={kernelName:Mu,backendName:"webgl",kernelFunc:uA};var nde=Vh+`
  return max(a, b);
`,ode=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+ra+`
  return result;
`,sde=lt({opSnippet:nde,packedOpSnippet:ode,cpuKernelImpl:KW}),FU={kernelName:Ua,backendName:"webgl",kernelFunc:sde};function ide(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e;ea(o,"maxPool");let{filterSize:s,strides:i,pad:a,dimRoundingMode:l}=n,u=1;w.assert(T.eitherStridesOrDilationsAreOne(i,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);let c=T.computePool2DInfo(o.shape,s,i,u,a,l);if(c.filterWidth===1&&c.filterHeight===1&&w.arraysEqual(c.inShape,c.outShape))return ur({inputs:{x:o},backend:r});let p=new gi(c,"max",!1);return r.runWebGLProgram(p,[o],o.dtype)}var PU={kernelName:zu,backendName:"webgl",kernelFunc:ide};function ade(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{filterSize:s,strides:i,pad:a,dataFormat:l,dimRoundingMode:u}=n,c=[1,1,1],p=T.computePool3DInfo(o.shape,s,i,c,a,u,l),f=new Rc(p,"max",!1);return r.runWebGLProgram(f,[o],o.dtype)}var LU={kernelName:Bu,backendName:"webgl",kernelFunc:ade};var $S=class{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;let r=e.strideHeight,n=e.strideWidth,o=e.dilationHeight,s=e.effectiveFilterHeight,i=e.effectiveFilterWidth,a=s-1-e.padInfo.top,l=i-1-e.padInfo.left,u=s*i-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${s};
          wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${i}; wC++) {
            float dyC = float(dyCCorner + wC) / ${n}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${u} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${i} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}},RS=class{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;let r=e.strideDepth,n=e.strideHeight,o=e.strideWidth,s=e.dilationDepth,i=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterDepth,u=e.effectiveFilterHeight,c=e.effectiveFilterWidth,p=l-1-e.padInfo.front,f=u-1-e.padInfo.top,d=c-1-e.padInfo.left,m=l*u*c-1;this.userCode=`
      const ivec3 pads = ivec3(${p}, ${f}, ${d});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${l};
           wD += ${s}) {
          float dyD = float(dyDCorner + wD) / ${r}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${u};
              wR += ${i}) {
            float dyR = float(dyRCorner + wR) / ${n}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${c};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${o}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${m} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${u} * ${c} +
                  wR * ${c} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function lde(t){let{inputs:e,backend:r,attrs:n}=t,{dy:o,input:s}=e,i=s,{filterSize:a,strides:l,pad:u,dimRoundingMode:c}=n,p=[1,1,1],f=T.computePool3DInfo(i.shape,a,l,p,u,c),d=new Rc(f,"max",!0),m=r.runWebGLProgram(d,[i],i.dtype),h=new RS(f),x=r.runWebGLProgram(h,[o,m],i.dtype);return r.disposeIntermediateTensorInfo(m),x}var MU={kernelName:am,backendName:"webgl",kernelFunc:lde};function ude(t){let{inputs:e,backend:r,attrs:n}=t,{dy:o,input:s,output:i}=e,a=s;ea([s,i],"maxPoolGrad");let{filterSize:l,strides:u,pad:c,dimRoundingMode:p}=n,f=T.computePool2DInfo(a.shape,l,u,1,c,p),d=!0,m=new gi(f,"max",d),h=r.runWebGLProgram(m,[a],a.dtype),x=new $S(f),g=r.runWebGLProgram(x,[o,h],a.dtype);return r.disposeIntermediateTensorInfo(h),g}var zU={kernelName:im,backendName:"webgl",kernelFunc:ude};function BU(t,e,r,n){let o=new gi(r,"max",!1),s=n.runWebGLProgram(o,[t],"float32");o=new gi(r,"max",!0,!0,e);let i=n.runWebGLProgram(o,[t],"float32");return[s,i]}var VU={kernelName:Vv,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:r})=>{let{x:n}=t,{filterSize:o,strides:s,pad:i,includeBatchInIndex:a}=e,l=r;w.assert(n.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${n.shape.length}.`);let u=[1,1];w.assert(T.eitherStridesOrDilationsAreOne(s,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${u}'`);let c=T.computePool2DInfo(n.shape,o,s,u,i),[p,f]=BU(n,a,c,l);return[p,f]}};function WU(t,e,r,n){let o=w.sizeFromShape(e),i=w.sizeFromShape(t.shape)/o,a=ce({inputs:{x:t},attrs:{shape:[i,o]},backend:n}),l=Oo(a,"float32","mean",n),u=ce({inputs:{x:l},attrs:{shape:r},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),u}var GU={kernelName:Vu,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:r})=>{let{x:n}=t,{keepDims:o,axis:s}=e,i=r,a=n.shape.length,l=w.parseAxisParam(s,n.shape),u=l,c=T.getAxesPermutation(u,a),p=c!=null,f=i.shouldExecuteOnCPU([n]),d=[],m=n;if(p){if(f){let v=i.texData.get(m.dataId).values,C=new Array(a);for(let I=0;I<C.length;I++)C[I]=n.shape[c[I]];let S=$f(v,n.shape,n.dtype,c,C);m=i.makeTensorInfo(C,n.dtype);let k=i.texData.get(m.dataId);k.values=S}else m=$c(n,c,i);d.push(m),u=T.getInnerMostAxes(u.length,a)}T.assertAxesAreInnerMostDims("sum",u,a);let[h,x]=T.computeOutAndReduceShapes(m.shape,u),g=h;o&&(g=T.expandShapeToKeepDim(h,l));let y=WU(m,x,g,i);for(let b of d)i.disposeIntermediateTensorInfo(b);return y}};function cde(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{axis:s,keepDims:i}=n,a=o.shape.length,l=w.parseAxisParam(s,o.shape),u=l,c=T.getAxesPermutation(u,a),p=o;c!=null&&(p=Ut({inputs:{x:o},backend:r,attrs:{perm:c}}),u=T.getInnerMostAxes(u.length,o.shape.length)),T.assertAxesAreInnerMostDims("min",u,a);let[f,d]=T.computeOutAndReduceShapes(p.shape,u),m=w.sizeFromShape(d),h=ce({inputs:{x:p},backend:r,attrs:{shape:[-1,m]}}),x=Oo(h,h.dtype,"min",r),g;if(i){let y=T.expandShapeToKeepDim(f,l);g=ce({inputs:{x},backend:r,attrs:{shape:y}})}else g=ce({inputs:{x},backend:r,attrs:{shape:f}});return r.disposeIntermediateTensorInfo(h),r.disposeIntermediateTensorInfo(x),c!=null&&r.disposeIntermediateTensorInfo(p),g}var UU={kernelName:Wu,backendName:"webgl",kernelFunc:cde};var pde=Vh+`
  return min(a, b);
`,fde=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+ra+`
  return result;
`,dde=lt({opSnippet:pde,packedOpSnippet:fde,cpuKernelImpl:XW}),HU={kernelName:Ha,backendName:"webgl",kernelFunc:dde};var OS=class{constructor(e,r,n){this.variableNames=["x"],this.outputShape=r.map((c,p)=>c[0]+e[p]+c[1]);let o=e.length,s=je(o),i=r.map(c=>c[0]).join(","),a=r.map((c,p)=>c[0]+e[p]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,o),u=n==="reflect"?0:1;if(o===1){this.userCode=`
        int start = ${i};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${u};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${u};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${s} start = ${s}(${i});
      ${s} end = ${s}(${a});

      void main() {
        ${s} outC = getOutputCoords();
        for (int i = 0; i < ${o}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${u};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${u};
          }
        }
        ${s} coords = outC - start;
        setOutput(getX(${l}));
      }
    `}};var FS=class{constructor(e,r,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r.map((m,h)=>m[0]+e[h]+m[1]);let o=e.length,s=je(o),i=r.map(m=>m[0]).join(","),a=r.map((m,h)=>m[0]+e[h]).join(","),l=lr("rc",o),u=lr("source",o),c=`${l[o-1]} < ${this.outputShape[o-1]}`,p=o===1?"source":`vec2(${u.slice(-2).join()})`,f=n==="reflect"?0:1,d="";if(o===1){let m=`
        ${s} source = rc;
        if (source < start) {
          source = start * 2 - source - ${f};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${f};
        }
        source -= start;
      `;d=`
        ${s} rc = outputLoc;
        ${m}
        result[0] = getChannel(getX(${u.join()}), ${p});
        ${l[o-1]} += 1;
        if(${c}) {
          ${m}
          result[1] = getChannel(getX(${u.join()}), ${p});
        }
      `}else{let m=`
        ${s} source = rc;
        ${s} lt = ${s}(lessThan(source, start));
        ${s} gte = ${s}(greaterThanEqual(source, end));
        ${s} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${f}) +
                gte * ((end - 1) * 2 - source + ${f});
        source -= start;
      `;d=`
        ${s} rc = outputLoc;
        ${m}
        result[0] = getChannel(getX(${u.join()}), ${p});
        ${l[o-1]} += 1;
        if(${c}) {
          ${m}
          result[1] = getChannel(getX(${u.join()}), ${p});
        }
        rc = outputLoc;
        ${l[o-2]} += 1;
        if(${l[o-2]} < ${this.outputShape[o-2]}) {
          ${m}
          result[2] = getChannel(getX(${u.join()}), ${p});
          ${l[o-1]} += 1;
          if(${c}) {
            ${m}
            result[3] = getChannel(getX(${u.join()}), ${p});
          }
        }
      `}this.userCode=`
      const ${s} start = ${s}(${i});
      const ${s} end = ${s}(${a});

      void main() {
        ${s} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${d}
        setOutput(result);
      }
    `}};var mde=({inputs:t,backend:e,attrs:r})=>{let{x:n}=t,{paddings:o,mode:s}=r,i=W().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new FS(n.shape,o,s):new OS(n.shape,o,s);return e.runWebGLProgram(i,[n],n.dtype)},qU={kernelName:Gu,backendName:"webgl",kernelFunc:mde};var hde=`if (b == 0.0) return NAN;
  return mod(a, b);`,gde=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+ra+`
  return result;
`,xde=lt({opSnippet:hde,packedOpSnippet:gde}),jU={kernelName:qa,backendName:"webgl",kernelFunc:xde};var PS=class{constructor(e,r,n){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${r-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${r-1}));
      }
    `}};var yde=`
if (a == b) {
  return 1.0;
};
return a / b;`,bde=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,cA=lt({opSnippet:yde,packedOpSnippet:bde,checkOutOfBounds:!0}),KU={kernelName:Da,backendName:"webgl",kernelFunc:cA};var XU="return a - b;",pA=lt({opSnippet:XU,packedOpSnippet:XU,supportsComplex:!0,cpuKernelImpl:hG}),YU={kernelName:ll,backendName:"webgl",kernelFunc:pA};function fA(t){let{inputs:e,backend:r,attrs:n}=t,{logits:o}=e,{dim:s}=n,i=w.parseAxisParam([s],o.shape),a=uA({inputs:{x:o},backend:r,attrs:{reductionIndices:i,keepDims:!1}}),l=T.expandShapeToKeepDim(a.shape,i),u=ce({inputs:{x:a},backend:r,attrs:{shape:l}}),c=pA({inputs:{a:o,b:u},backend:r}),p=iA({inputs:{x:c},backend:r}),f=Of({inputs:{x:p},backend:r,attrs:{axis:i,keepDims:!1}}),d=ce({inputs:{x:f},backend:r,attrs:{shape:l}}),m=cA({inputs:{a:p,b:d},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(u),r.disposeIntermediateTensorInfo(c),r.disposeIntermediateTensorInfo(p),r.disposeIntermediateTensorInfo(f),r.disposeIntermediateTensorInfo(d),m}var QU={kernelName:ic,backendName:"webgl",kernelFunc:fA};function vde(t){let{inputs:e,backend:r,attrs:n}=t,{logits:o}=e,{numSamples:s,seed:i,normalized:a}=n,l=a?o:fA({inputs:{logits:o},backend:r,attrs:{dim:o.shape.length-1}}),u=l.shape[0],c=l.shape[1],p=new PS(u,c,s),f=[[i]],d=r.runWebGLProgram(p,[l],"int32",f);return a||r.disposeIntermediateTensorInfo(l),d}var ZU={kernelName:Wv,backendName:"webgl",kernelFunc:vde};var wde=Or+`
  return -x;
`,Cde=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function Sde(t){let{inputs:e,backend:r}=t,{x:n}=e;if(r.shouldExecuteOnCPU([n])){let s=r.texData.get(n.dataId),[i,a]=QW(s.values,n.shape,n.dtype);return r.makeTensorInfo(a,n.dtype,i)}let o;return W().getBool("WEBGL_PACK_UNARY_OPERATIONS")?o=new uo(n.shape,Cde):o=new cn(n.shape,wde),r.runWebGLProgram(o,[n],n.dtype)}var JU={kernelName:Uu,backendName:"webgl",kernelFunc:Sde};var kde=bn.nonMaxSuppressionV3Impl;function Tde(t){T.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:e,backend:r,attrs:n}=t,{boxes:o,scores:s}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l}=n,u=r.readSync(o.dataId),c=r.readSync(s.dataId),{selectedIndices:p}=kde(u,c,i,a,l);return r.makeTensorInfo([p.length],"int32",new Int32Array(p))}var e8={kernelName:lm,backendName:"webgl",kernelFunc:Tde};var Nde=bn.nonMaxSuppressionV4Impl;function Ide(t){T.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:e,backend:r,attrs:n}=t,{boxes:o,scores:s}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:u}=n,c=r.readSync(o.dataId),p=r.readSync(s.dataId),{selectedIndices:f,validOutputs:d}=Nde(c,p,i,a,l,u);return[r.makeTensorInfo([f.length],"int32",new Int32Array(f)),r.makeTensorInfo([],"int32",new Int32Array([d]))]}var t8={kernelName:um,backendName:"webgl",kernelFunc:Ide};var Ede=bn.nonMaxSuppressionV5Impl;function _de(t){T.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:e,backend:r,attrs:n}=t,{boxes:o,scores:s}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,softNmsSigma:u}=n,c=r.readSync(o.dataId),p=r.readSync(s.dataId),f=i,d=a,m=l,h=u,{selectedIndices:x,selectedScores:g}=Ede(c,p,f,d,m,h);return[r.makeTensorInfo([x.length],"int32",new Int32Array(x)),r.makeTensorInfo([g.length],"float32",new Float32Array(g))]}var r8={kernelName:cm,backendName:"webgl",kernelFunc:_de};var LS=class{constructor(e,r,n,o){this.variableNames=["indices"],this.outputShape=[e,r],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${o}), float(${n}),
                      float(index == coords.y)));
      }
    `}};var Ade=t=>{let{inputs:e,backend:r,attrs:n}=t,{indices:o}=e,{dtype:s,depth:i,onValue:a,offValue:l}=n,u=w.sizeFromShape(o.shape),c=new LS(u,i,a,l),p=ce({inputs:{x:o},backend:r,attrs:{shape:[u]}}),f=r.runWebGLProgram(c,[p],s);r.disposeIntermediateTensorInfo(p);let d=[...o.shape,i],m=ce({inputs:{x:f},backend:r,attrs:{shape:d}});return r.disposeIntermediateTensorInfo(f),m},n8={kernelName:qu,backendName:"webgl",kernelFunc:Ade};function j0(t){let{inputs:e,backend:r}=t,{x:n}=e;if(n.dtype==="complex64"){let o=Ll({inputs:{input:n},backend:r}),s=j0({inputs:{x:o},backend:r}),i=Pf({inputs:{input:n},backend:r}),a=j0({inputs:{x:i},backend:r}),l=co({inputs:{real:s,imag:a},backend:r});return r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(a),l}else return Ml({attrs:{shape:n.shape,dtype:n.dtype,value:n.dtype==="string"?"":0},backend:r})}var o8={kernelName:uc,backendName:"webgl",kernelFunc:j0};function s8(t){let{inputs:e,backend:r}=t,{x:n}=e;if(n.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(n.dtype==="complex64"){let o=Ll({inputs:{input:n},backend:r}),s=s8({inputs:{x:o},backend:r}),i=Pf({inputs:{input:n},backend:r}),a=j0({inputs:{x:i},backend:r}),l=co({inputs:{real:s,imag:a},backend:r});return r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(a),l}else return Ml({attrs:{shape:n.shape,dtype:n.dtype,value:1},backend:r})}var i8={kernelName:Hu,backendName:"webgl",kernelFunc:s8};function Dde(t){let{inputs:e,backend:r,attrs:n}=t,{axis:o}=n;if(e.length===1)return wS({inputs:{input:e[0]},backend:r,attrs:{dim:o}});let s=e[0].shape,i=e[0].dtype;e.forEach(c=>{w.assertShapesMatch(s,c.shape,"All tensors passed to stack must have matching shapes"),w.assert(i===c.dtype,()=>"All tensors passed to stack must have matching dtypes")});let a=[],l=e.map(c=>{let p=wS({inputs:{input:c},backend:r,attrs:{dim:o}});return a.push(p),p}),u=sA({inputs:l,backend:r,attrs:{axis:o}});return a.forEach(c=>r.disposeIntermediateTensorInfo(c)),u}var a8={kernelName:ju,backendName:"webgl",kernelFunc:Dde};var MS=class{constructor(e,r,n){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=r.map((u,c)=>u[0]+e[c]+u[1]);let o=e.length,s=je(o),i=r.map(u=>u[0]).join(","),a=r.map((u,c)=>u[0]+e[c]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,o);if(o===1){this.userCode=`
        int start = ${i};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${s} start = ${s}(${i});
      ${s} end = ${s}(${a});

      void main() {
        ${s} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${s} coords = outC - start;
          setOutput(getX(${l}));
        }
      }
    `}};var zS=class{constructor(e,r,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=r.map((h,x)=>h[0]+e[x]+h[1]);let o=e.length,s=je(o),i=r.map(h=>h[0]).join(","),a=r.map((h,x)=>h[0]+e[x]).join(","),l=lr("rc",o),u=lr("source",o),c=`${l[o-1]} < ${this.outputShape[o-1]}`,p=o===1?"source":`vec2(${u.slice(-2).join()})`,f=[`${s} rc = outputLoc;`,`${l[o-1]} += 1;
       if(${c}) {
      `,o===1?"":`}
       rc = outputLoc;
       ${l[o-2]} += 1;
       if(${l[o-2]} < ${this.outputShape[o-2]}) {`,o===1?"":`  ${l[o-1]} += 1;
         if(${c}) {`],d=o===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",m="";for(let h=0,x=o===1?2:4;h<x;h++)m+=`
        ${f[h]}
        if (${d}) {
          result[${h}] = float(value);
        } else {
          ${s} source = rc - start;
          result[${h}] = getChannel(getX(${u.join()}), ${p});
        }
      `;m+=o===1?"} ":"}}",this.userCode=`
      const ${s} start = ${s}(${i});
      const ${s} end = ${s}(${a});

      void main() {
        ${s} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${m}
        setOutput(result);
      }
    `}};var dA=t=>{let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{paddings:s,constantValue:i}=n;if(w.sizeFromShape(o.shape)===0){let u=s.map((c,p)=>c[0]+o.shape[p]+c[1]);return Ml({backend:r,attrs:{shape:u,value:i,dtype:o.dtype}})}let a=W().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new zS(o.shape,s,i):new MS(o.shape,s,i),l=[[i]];return r.runWebGLProgram(a,[o],o.dtype,l)},l8={kernelName:Ku,backendName:"webgl",kernelFunc:dA};var $de=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,Rde=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+ra+`
  return result;
`,Ode=lt({opSnippet:$de,packedOpSnippet:Rde}),u8={kernelName:Ka,backendName:"webgl",kernelFunc:Ode};function Fde(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{axis:s,keepDims:i}=n,a=o.shape.length,l=[],u=w.parseAxisParam(s,o.shape),c=u,p=T.getAxesPermutation(c,a),f=o;p!=null&&(f=Ut({inputs:{x:o},backend:r,attrs:{perm:p}}),c=T.getInnerMostAxes(c.length,a),l.push(f)),T.assertAxesAreInnerMostDims("prod",c,a);let d;if(r.shouldExecuteOnCPU([f])){let m=r.texData.get(f.dataId).values,{outVals:h,outShape:x,outDtype:g}=JW(f.shape,f.dtype,m,c);d=r.makeTensorInfo(x,g,h)}else{let[m,h]=T.computeOutAndReduceShapes(f.shape,c),x=w.sizeFromShape(h),g=ce({inputs:{x:f},backend:r,attrs:{shape:[-1,x]}}),y=Up(o.dtype),b=Oo(g,y,"prod",r);d=ce({inputs:{x:b},backend:r,attrs:{shape:m}}),l.push(g),l.push(b)}if(i){l.push(d);let m=T.expandShapeToKeepDim(d.shape,u);d=ce({inputs:{x:d},backend:r,attrs:{shape:m}})}return l.forEach(m=>r.disposeIntermediateTensorInfo(m)),d}var c8={kernelName:Yu,backendName:"webgl",kernelFunc:Fde};function Pde(t){let{inputs:e,backend:r,attrs:n}=t,{paramsNestedSplits:o,paramsDenseValues:s,indices:i}=e,{outputRaggedRank:a}=n,l=o.map(g=>r.readSync(g.dataId)),u=o.map(g=>g.shape),c=r.readSync(s.dataId),p=r.readSync(i.dataId),[f,d,m]=eG(l,u,c,s.shape,s.dtype,p,i.shape,a),h=f.map(g=>r.makeTensorInfo([g.length],"int32",g)),x=r.makeTensorInfo(m,s.dtype,d);return h.concat([x])}var p8={kernelName:Gv,backendName:"webgl",kernelFunc:Pde};function Lde(t){let{inputs:e,backend:r}=t,{starts:n,limits:o,deltas:s}=e,i=r.readSync(n.dataId),a=r.readSync(o.dataId),l=r.readSync(s.dataId),[u,c]=tG(i,n.shape,n.dtype,a,o.shape,l,s.shape),p=r.makeTensorInfo([u.length],"int32",u),f=r.makeTensorInfo([c.length],n.dtype,c);return[p,f]}var f8={kernelName:Uv,backendName:"webgl",kernelFunc:Lde};function Mde(t){let{inputs:e,backend:r,attrs:n}=t,{shape:o,values:s,defaultValue:i,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=n,u=r.readSync(o.dataId),c=r.readSync(s.dataId),p=r.readSync(i.dataId),f=a.map(x=>r.readSync(x.dataId)),d=a.map(x=>x.shape),[m,h]=rG(u,o.shape,c,s.shape,s.dtype,p,i.shape,f,d,l);return r.makeTensorInfo(m,s.dtype,h)}var d8={kernelName:Hv,backendName:"webgl",kernelFunc:Mde};var mA=t=>{let{backend:e,attrs:r}=t,{start:n,stop:o,step:s,dtype:i}=r,a=nG(n,o,s,i);return e.makeTensorInfo([a.length],i,a)},m8={kernelName:pm,backendName:"webgl",kernelFunc:mA};var zde="return 1.0 / x;",Bde=Te({opSnippet:zde}),h8={kernelName:Xa,backendName:"webgl",kernelFunc:Bde};var Vde=Or+`
  return (x < 0.0) ? 0.0 : x;
`,Wde=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Gde=Te({opSnippet:Vde,packedOpSnippet:Wde}),g8={kernelName:Ya,backendName:"webgl",kernelFunc:Gde};var Ude=Or+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Hde=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,qde=Te({opSnippet:Ude,packedOpSnippet:Hde}),x8={kernelName:Qa,backendName:"webgl",kernelFunc:qde};var BS=class{constructor(e,r,n,o,s){this.variableNames=["A"],this.outputShape=[];let[i,a,l,u]=e;this.outputShape=[i,r,n,u];let c=[o&&r>1?a-1:a,o&&n>1?l-1:l],p=[o&&r>1?r-1:r,o&&n>1?n-1:n],f;s?f="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":f="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${c[0]/p[0]},
          ${c[1]/p[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${f};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}};var VS=class{constructor(e,r,n,o,s){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];let[i,a,l,u]=e;this.outputShape=[i,r,n,u];let c=[o&&r>1?a-1:a,o&&n>1?l-1:l],p=[o&&r>1?r-1:r,o&&n>1?n-1:n],f;s?f="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":f="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${c[0]/p[0]},
          ${c[1]/p[1]},
          ${c[1]/p[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${f};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${n-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}};function jde(t){let{inputs:e,backend:r,attrs:n}=t,{images:o}=e,{alignCorners:s,halfPixelCenters:i,size:a}=n,[l,u]=a,c=W().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new VS(o.shape,l,u,s,i):new BS(o.shape,l,u,s,i);return r.runWebGLProgram(c,[o],"float32")}var y8={kernelName:Ju,backendName:"webgl",kernelFunc:jde};var WS=class{constructor(e,r,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=r;let[,o,s]=r,[,i,a]=e,l=[n&&i>1?o-1:o,n&&a>1?s-1:s],u=[n&&i>1?i-1:i,n&&a>1?a-1:a],c=l[0]/u[0],p=l[1]/u[1],f=1/c,d=1/p,m=Math.ceil(f)*2+2,h=Math.ceil(d)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${c});
        const float widthScale = float(${p});

        const float invHeightScale = float(${f});
        const float invWidthScale = float(${d});

        const int winHeight = int(${m});
        const int winWidth = int(${h});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${i}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${o-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${s-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}};function Kde(t){let{inputs:e,backend:r,attrs:n}=t,{images:o,dy:s}=e,{alignCorners:i}=n,a=new WS(s.shape,o.shape,i);return r.runWebGLProgram(a,[s],s.dtype)}var b8={kernelName:mm,backendName:"webgl",kernelFunc:Kde};var GS=class{constructor(e,r,n,o,s){this.variableNames=["A"],this.outputShape=[];let[i,a,l,u]=e;this.outputShape=[i,r,n,u];let c=[o&&r>1?a-1:a,o&&n>1?l-1:l],p=[o&&r>1?r-1:r,o&&n>1?n-1:n],f=o?"0.5":"0.0",d;s?d="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":d="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${c[0]/p[0]},
          ${c[1]/p[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${d};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${f})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}};var US=class{constructor(e,r,n,o,s){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];let[i,a,l,u]=e;this.outputShape=[i,r,n,u];let c=[o&&r>1?a-1:a,o&&n>1?l-1:l],p=[o&&r>1?r-1:r,o&&n>1?n-1:n],f=o?"0.5":"0.0",d;s?d="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":d="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${c[0]/p[0]},
          ${c[1]/p[1]},
          ${c[1]/p[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${d};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${f})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${n-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}};function Xde(t){let{inputs:e,backend:r,attrs:n}=t,{images:o}=e,{alignCorners:s,halfPixelCenters:i,size:a}=n,[l,u]=a,c=W().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new US(o.shape,l,u,s,i):new GS(o.shape,l,u,s,i);return r.runWebGLProgram(c,[o],o.dtype)}var v8={kernelName:Zu,backendName:"webgl",kernelFunc:Xde};var HS=class{constructor(e,r,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=r;let[,o,s]=r,[,i,a]=e,l=[n&&i>1?o-1:o,n&&a>1?s-1:s],u=[n&&i>1?i-1:i,n&&a>1?a-1:a],c=l[0]/u[0],p=l[1]/u[1],f=1/c,d=1/p,m=Math.ceil(f)*2+2,h=Math.ceil(d)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${c});
        const float widthScale = float(${p});

        const float invHeightScale = float(${f});
        const float invWidthScale = float(${d});

        const int winHeight = int(${m});
        const int winWidth = int(${h});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${i}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${l[0]}) *
                (float(dyR) / float(${u[0]}));

            float sourceFracCol =
                float(${l[1]}) *
                  (float(dyC) / float(${u[1]}));

            int sourceNearestRow = int(min(
                float(int(${o}) - 1),
                ${n} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${s}) - 1),
                ${n} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}};function Yde(t){let{inputs:e,backend:r,attrs:n}=t,{images:o,dy:s}=e,{alignCorners:i}=n,a=new HS(s.shape,o.shape,i);return r.runWebGLProgram(a,[s],s.dtype)}var w8={kernelName:dm,backendName:"webgl",kernelFunc:Yde};var qS=class{constructor(e,r){this.variableNames=["x"];let n=e.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);if(this.outputShape=e,n===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}let o=a=>r.indexOf(a)!==-1&&e[a]!==1?`${e[a]} - coords[${a}] - 1`:`coords[${a}]`,s=e.map((a,l)=>o(l)).join(","),i=je(n);this.userCode=`
      void main() {
        ${i} coords = getOutputCoords();
        setOutput(getX(${s}));
      }
    `}};var jS=class{constructor(e,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;let n=e.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);this.outputShape=e;let o=lr("rc",n),s=`${o[n-1]} + 1 < ${this.outputShape[n-1]}`,i=`${o[n-2]} + 1 < ${this.outputShape[n-2]}`,a=je(n);n===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${s}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${l(o.slice())};
          if(${s}){
            result.g = ${u(o.slice())};
          }
          if(${i}) {
            result.b = ${c(o.slice())};
            if(${s}) {
              result.a = ${p(o.slice())};
            }
          }
          setOutput(result);
        }
    `;function l(m){return f(m)}function u(m){return m[n-1]="("+m[n-1]+" + 1)",f(m)}function c(m){return m[n-2]="("+m[n-2]+" + 1)",f(m)}function p(m){return m[n-1]="("+m[n-1]+" + 1)",m[n-2]="("+m[n-2]+" + 1)",f(m)}function f(m){let h=e.map((y,b)=>d(b,m)),x=h.join(","),g=h.slice(-2).join(",");return`getChannel(getX(${x}), vec2(${g}))`}function d(m,h){return r.indexOf(m)!==-1&&e[m]!==1?`${e[m]} - ${h[m]} - 1`:`${h[m]}`}}};function Qde(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{dims:s}=n,i=o.shape.length,a=w.parseAxisParam(s,o.shape);if(i===0)return ur({inputs:{x:o},backend:r});let l=W().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new jS(o.shape,a):new qS(o.shape,a);return r.runWebGLProgram(l,[o],o.dtype)}var C8={kernelName:ec,backendName:"webgl",kernelFunc:Qde};var KS=class{constructor(e,r){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];let n=e[1],o=e[2];this.outputShape=e;let s="";typeof r=="number"?s=`float outputValue = ${r.toFixed(2)};`:s=`
        vec3 fill = vec3(${r.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${s}
          if(coordX >= 0 && coordX < ${o} && coordY >= 0 && coordY < ${n}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}};var S8={kernelName:vm,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:r})=>{let{image:n}=t,{radians:o,fillValue:s,center:i}=e,a=r,l=new KS(n.shape,s),[u,c]=T.getImageCenter(i,n.shape[1],n.shape[2]),p=[[u,c,Math.sin(o),Math.cos(o)]];return a.runWebGLProgram(l,[n],n.dtype,p)}};var Zde=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,Jde=Te({opSnippet:Zde}),k8={kernelName:Za,backendName:"webgl",kernelFunc:Jde};var eme="return inversesqrt(x);",tme=Te({opSnippet:eme,cpuKernelImpl:oG}),T8={kernelName:Ja,backendName:"webgl",kernelFunc:tme};var Xh=class{constructor(e,r,n,o,s,i,a=!0){this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;let l=je(s.length),u=je(i.length),c="";n===1?c="i":n===2&&(c="i, j");let p=`getIndices(${c})`,f="";o===1?f="i":o===2&&(f="i, coords[1]");let d=`getUpdates(${f})`,m=r>1?"strides[j]":"strides";this.userCode=`
        ${l} strides = ${l}(${s});

        void main() {
          ${u} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${r}; j++) {
              int index = round(${p});
              flattenedIndex += index * ${m};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${d};
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `}};function rme(t){let{inputs:e,backend:r,attrs:n}=t,{indices:o,updates:s}=e,{shape:i}=n,{sliceRank:a,numUpdates:l,sliceSize:u,strides:c,outputSize:p}=T.calculateShapes(s,o,i),f=[p/u,u];if(p===0)return r.makeTensorInfo(i,o.dtype);let d=ce({inputs:{x:o},backend:r,attrs:{shape:[l,a]}}),m=ce({inputs:{x:s},backend:r,attrs:{shape:[l,u]}}),h=r.makeTensorInfo([],"float32",new Float32Array([0])),x=new Xh(l,a,d.shape.length,m.shape.length,c,f),g=r.runWebGLProgram(x,[m,d,h],m.dtype),y=ce({inputs:{x:g},backend:r,attrs:{shape:i}});return r.disposeIntermediateTensorInfo(d),r.disposeIntermediateTensorInfo(m),r.disposeIntermediateTensorInfo(g),r.disposeIntermediateTensorInfo(h),y}var N8={kernelName:qv,backendName:"webgl",kernelFunc:rme};var XS=class{constructor(e,r,n,o){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,n];let s="while (left < right) {",i=`for (int i = 0; i < ${Math.ceil(Math.log2(r+1))}; ++i) { if (left >= right) break;`,a=W().getNumber("WEBGL_VERSION")===2?s:i,l=o==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${l} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}};function nme(t){let{inputs:e,backend:r,attrs:n}=t,{sortedSequence:o,values:s}=e,{side:i}=n,a=new XS(o.shape[0],o.shape[1],s.shape[1],i),l=[[o.shape[1]]];return r.runWebGLProgram(a,[o,s],"int32",l)}var I8={kernelName:jv,backendName:"webgl",kernelFunc:nme};var YS=class{constructor(e,r,n){this.variableNames=["c","a","b"],this.outputShape=r;let o,s;if(n>4)throw Error(`Where for rank ${n} is not yet supported`);if(n===1)s="resRC",o="resRC";else{let a=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],u=[];for(let c=0;c<r.length;c++)u.push(`${a[c]}`),c<e&&l.push(`${a[c]}`);o=l.join(),s=u.join()}let i=je(n);this.userCode=`
      void main() {
        ${i} resRC = getOutputCoords();
        float cVal = getC(${o});
        if (cVal >= 1.0) {
          setOutput(getA(${s}));
        } else {
          setOutput(getB(${s}));
        }
      }
    `}};function ome(t){let{inputs:e,backend:r}=t,{condition:n,t:o,e:s}=e,i=new YS(n.shape.length,o.shape,o.shape.length);return r.runWebGLProgram(i,[n,o,s],wr(o.dtype,s.dtype))}var E8={kernelName:tc,backendName:"webgl",kernelFunc:ome};var sme=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${T.SELU_SCALEALPHA};
  float scale = ${T.SELU_SCALE};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,ime=Te({opSnippet:sme}),_8={kernelName:el,backendName:"webgl",kernelFunc:ime};var ame=Ms+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,lme=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,ume=Te({opSnippet:ame,packedOpSnippet:lme,cpuKernelImpl:iG}),A8={kernelName:ol,backendName:"webgl",kernelFunc:ume};var cme=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,pme=Te({opSnippet:cme}),D8={kernelName:nl,backendName:"webgl",kernelFunc:pme};var fme=Ms+`
  return sin(x);
`,dme=Te({opSnippet:fme}),$8={kernelName:tl,backendName:"webgl",kernelFunc:dme};var mme=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,hme=Te({opSnippet:mme}),R8={kernelName:rl,backendName:"webgl",kernelFunc:hme};var gme=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,xme=Te({opSnippet:gme}),O8={kernelName:sl,backendName:"webgl",kernelFunc:xme};var yme=t=>{let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{blockShape:s,paddings:i}=n;w.assert(o.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");let a=s.reduce((g,y)=>g*y),l=[[0,0]];l.push(...i);for(let g=1+s.length;g<o.shape.length;++g)l.push([0,0]);let u=[],c=dA({inputs:{x:o},backend:r,attrs:{paddings:l,constantValue:0}}),p=T.getReshaped(c.shape,s,a,!1),f=T.getPermuted(p.length,s.length,!1),d=T.getReshapedPermuted(c.shape,s,a,!1),m=ce({inputs:{x:c},backend:r,attrs:{shape:p}}),h=Ut({inputs:{x:m},backend:r,attrs:{perm:f}}),x=ce({inputs:{x:h},backend:r,attrs:{shape:d}});return u.push(c),u.push(m),u.push(h),u.forEach(g=>r.disposeIntermediateTensorInfo(g)),x},F8={kernelName:oc,backendName:"webgl",kernelFunc:yme};function bme(t){let{inputs:e,backend:r}=t,{indices:n,values:o,denseShape:s,defaultValue:i}=e;if(s.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${s.shape}`);if(n.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${n.shape}`);if(o.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${o.shape}`);if(i.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${i.shape}`);let a=r.readSync(n.dataId),l=r.readSync(o.dataId),u=r.readSync(s.dataId),c=r.readSync(i.dataId)[0],[p,f,d,m,h]=lG(a,n.shape,n.dtype,l,o.dtype,u,c);return[r.makeTensorInfo(f,n.dtype,p),r.makeTensorInfo([f[0]],o.dtype,d),r.makeTensorInfo([m.length],"bool",new Uint8Array(m.map(x=>Number(x)))),r.makeTensorInfo([h.length],n.dtype,new Int32Array(h))]}var P8={kernelName:Kv,backendName:"webgl",kernelFunc:bme};function vme(t){let{inputs:e,backend:r}=t,{inputIndices:n,inputShape:o,newShape:s}=e;if(n.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${n.shape}`);if(o.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${o.shape}`);if(s.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${s.shape}`);let i=Array.from(r.readSync(o.dataId)),a=r.readSync(n.dataId),l=Array.from(r.readSync(s.dataId)),[u,c,p]=uG(a,n.shape,n.dtype,i,l);return[r.makeTensorInfo(c,n.dtype,u),r.makeTensorInfo([p.length],s.dtype,new Int32Array(p))]}var L8={kernelName:Xv,backendName:"webgl",kernelFunc:vme};function wme(t){let{inputs:e,backend:r}=t,{data:n,indices:o,segmentIds:s}=e;if(n.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${o.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${s.shape}`);let i=r.readSync(n.dataId),a=r.readSync(o.dataId),l=r.readSync(s.dataId),[u,c]=RC(i,n.shape,n.dtype,a,l,!0);return r.makeTensorInfo(c,n.dtype,u)}var M8={kernelName:Yv,backendName:"webgl",kernelFunc:wme};function Cme(t){let{inputs:e,backend:r}=t,{data:n,indices:o,segmentIds:s}=e;if(n.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${o.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${s.shape}`);let i=r.readSync(n.dataId),a=r.readSync(o.dataId),l=r.readSync(s.dataId),[u,c]=RC(i,n.shape,n.dtype,a,l);return r.makeTensorInfo(c,n.dtype,u)}var z8={kernelName:Qv,backendName:"webgl",kernelFunc:Cme};function Sme(t){let{inputs:e,backend:r,attrs:n}=t,{sparseIndices:o,sparseValues:s,defaultValue:i}=e,{outputShape:a}=n,{sliceRank:l,numUpdates:u,sliceSize:c,strides:p,outputSize:f}=T.calculateShapes(s,o,a),d=!1;if(s.dtype==="string"){let g=r.bufferSync(o),y=r.bufferSync(s),b=w.decodeString(r.readSync(i.dataId)[0]),v=sG(g,y,a,f,c,u,l,p,b,d);return r.makeTensorInfo(a,v.dtype,v.values)}let m=new Xh(u,l,o.shape.length,s.shape.length,p,[f,1],d),h=r.runWebGLProgram(m,[s,o,i],s.dtype),x=ce({inputs:{x:h},backend:r,attrs:{shape:a}});return r.disposeIntermediateTensorInfo(h),x}var B8={kernelName:Zv,backendName:"webgl",kernelFunc:Sme};function kme(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{numOrSizeSplits:s,axis:i}=n,a=w.parseAxisParam(i,o.shape)[0],l=T.prepareSplitSize(o,s,a),u=o.shape.length,c=new Array(u).fill(0),p=o.shape.slice();return l.map(f=>{let d=[...p];d[a]=f;let m=xi({inputs:{x:o},backend:r,attrs:{begin:c,size:d}});return c[a]+=f,m})}var V8={kernelName:sc,backendName:"webgl",kernelFunc:kme};var W8="return sqrt(x);",Tme=Te({opSnippet:W8,packedOpSnippet:W8,cpuKernelImpl:cG}),G8={kernelName:il,backendName:"webgl",kernelFunc:Tme};var Nme="return x * x;",Ime=Te({opSnippet:Nme}),U8={kernelName:hm,backendName:"webgl",kernelFunc:Ime};var H8="return (a - b) * (a - b);",Eme=lt({opSnippet:H8,packedOpSnippet:H8}),q8={kernelName:al,backendName:"webgl",kernelFunc:Eme};function _me({inputs:t,attrs:e,backend:r}){let{x:n}=t,o=Or+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,s=new cn(n.shape,o);return r.runWebGLProgram(s,[n],n.dtype)}var j8={kernelName:pl,backendName:"webgl",kernelFunc:_me};var QS=class{constructor(e,r,n){this.variableNames=["x"],this.outputShape=n;let o=n.length,s=je(n.length),i=je(n.length),a="";if(o===1)a="coords * strides + begin";else{let l=0;a=n.map((u,c)=>(l++,n.length===1?`coords * strides[${c}] + begin[${c}]`:`coords[${l-1}] * strides[${c}] + begin[${c}]`)).join(",")}this.userCode=`
      ${s} begin = ${s}(${e});
      ${s} strides = ${s}(${r});

      void main() {
        ${i} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}};function Ame(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{begin:s,end:i,strides:a,beginMask:l,endMask:u,ellipsisMask:c,newAxisMask:p,shrinkAxisMask:f}=n,{finalShapeSparse:d,finalShape:m,isIdentity:h,sliceDim0:x,isSimpleSlice:g,begin:y,end:b,strides:v}=Hr.sliceInfo(o.shape,s,i,a,l,u,c,p,f),C;if(h)C=ce({inputs:{x:o},backend:r,attrs:{shape:m}});else if(x||g){w.assert(o.shape.length>=1,()=>`Input must have rank at least 1, got: ${o.shape.length}`);let k=Hr.computeOutShape(y,b,v),I=xi({inputs:{x:o},backend:r,attrs:{begin:y,size:k}});C=ce({inputs:{x:I},backend:r,attrs:{shape:m}}),r.disposeIntermediateTensorInfo(I)}else if(r.shouldExecuteOnCPU([o])){let I=r.readSync(o.dataId),A=Ie(o.shape,o.dtype,I),$=pG(d,A,v,y);C=r.makeTensorInfo(m,o.dtype,$.values)}else{let I=new QS(y,v,d);C=r.runWebGLProgram(I,[o],o.dtype)}let S=ce({inputs:{x:C},backend:r,attrs:{shape:m}});return r.disposeIntermediateTensorInfo(C),S}var K8={kernelName:gm,backendName:"webgl",kernelFunc:Ame};function Dme(t){let{inputs:e,backend:r,attrs:n}=t,{separator:o,nGramWidths:s,leftPad:i,rightPad:a,padWidth:l,preserveShortSequences:u}=n,{data:c,dataSplits:p}=e,f=r.readSync(c.dataId),d=r.readSync(p.dataId),[m,h]=fG(f,d,o,s,i,a,l,u);return[r.makeTensorInfo([m.length],"string",m),r.makeTensorInfo(p.shape,"int32",h)]}var X8={kernelName:Jv,backendName:"webgl",kernelFunc:Dme};function $me(t){let{inputs:e,backend:r,attrs:n}=t,{skipEmpty:o}=n,{input:s,delimiter:i}=e;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(s.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${s.shape}`);if(i.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${i.shape}`);let a=r.readSync(s.dataId),l=r.readSync(i.dataId)[0],[u,c,p]=dG(a,l,o),f=c.length;return[r.makeTensorInfo([f,2],"int32",u),r.makeTensorInfo([f],"string",c),r.makeTensorInfo([2],"int32",new Int32Array(p))]}var Y8={kernelName:e1,backendName:"webgl",kernelFunc:$me};function Rme(t){let{inputs:e,backend:r,attrs:n}=t,{numBuckets:o}=n,{input:s}=e;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(o<=0)throw new Error("Number of buckets must be at least 1");let i=r.readSync(s.dataId),a=mG(i,o);return r.makeTensorInfo(s.shape,"int32",a)}var Q8={kernelName:t1,backendName:"webgl",kernelFunc:Rme};var Ome="return tan(x);",Fme=Te({opSnippet:Ome}),Z8={kernelName:ul,backendName:"webgl",kernelFunc:Fme};var Pme=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,Lme=Te({opSnippet:Pme}),J8={kernelName:cl,backendName:"webgl",kernelFunc:Lme};var ZS=class{constructor(e,r){this.variableNames=["A"];let n=new Array(e.length);for(let i=0;i<n.length;i++)n[i]=e[i]*r[i];this.outputShape=n,this.rank=n.length;let o=je(this.rank),s=Mme(e);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        setOutput(getA(${s}));
      }
    `}};function Mme(t){let e=t.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${t[0]})`;let r=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],n=[];for(let o=0;o<t.length;o++)n.push(`imod(${r[o]}, ${t[o]})`);return n.join()}function hA(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{reps:s}=n;if(o.dtype==="string"||o.shape.length>5){let l=r.readSync(o.dataId),u=o.dtype==="string"?l.map(f=>w.decodeString(f)):l,c=Ie(o.shape,o.dtype,u),p=gG(c,s);return r.makeTensorInfo(p.shape,p.dtype,p.values)}let i=new ZS(o.shape,s);return r.runWebGLProgram(i,[o],o.dtype)}var eH={kernelName:Pi,backendName:"webgl",kernelFunc:hA};var JS=class{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}},ek=class{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}};function Mf(t,e){e!==null&&t.disposeIntermediateTensorInfo(e)}function tH(t){let e=1;for(;e<t;)e*=2;return e}function zme(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{k:s,sorted:i}=n,a=W().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=W().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),u=o.shape,c=u[u.length-1];if(r.shouldExecuteOnCPU([o])||c<a||s>l){let $=r.readSync(o.dataId),[O,j]=xG($,u,o.dtype,s,i);return[r.makeTensorInfo(O.shape,O.dtype,O.values),r.makeTensorInfo(j.shape,j.dtype,j.values)]}if(s===0)return u[u.length-1]=0,[r.makeTensorInfo(u,o.dtype,[]),r.makeTensorInfo(u,"int32",[])];if(c===1)return[o,Ml({attrs:{shape:u,dtype:"int32",value:0},backend:r})];let p=r.texData.get(o.dataId),f=p!==null&&p.isPacked,d=f?r.unpackTensor(o):o,h=w.sizeFromShape(u)/c,x=ce({inputs:{x:d},attrs:{shape:[h,c]},backend:r});f&&Mf(r,d);let g=tH(s),y=tH(c),b=null,v=()=>b===null?[x,x]:[x,b],C=($,O,j)=>{let H=v(),Y=new JS(j),K=[[c],[b===null?1:0],[Number.NEGATIVE_INFINITY],[$],[O]],X=b;b=r.runWebGLProgram(Y,H,"int32",K),Mf(r,X)};for(let $=1;$<g;$*=2){let O=$*2;for(let j=$;j>=1;j/=2)C(O,j,[h,y])}for(let $=y;$>g;$/=2){let O=v(),j=new ek([h,$/2]),Y=[[c],[b===null?1:0],[g]],B=b;b=r.runWebGLProgram(j,O,"int32",Y),Mf(r,B);let K=g/2,X=K*2;for(let Z=K;Z>=1;Z/=2)C(X,Z,b.shape)}let S=b;b=xi({inputs:{x:b},backend:r,attrs:{begin:0,size:[h,s]}}),Mf(r,S);let k=lA({inputs:{x,indices:b},backend:r,attrs:{axis:1,batchDims:1}});Mf(r,x);let I=u.slice(0,-1);I.push(s),S=b,b=ce({inputs:{x:b},attrs:{shape:I},backend:r}),Mf(r,S);let A=k;return k=ce({inputs:{x:k},attrs:{shape:I},backend:r}),Mf(r,A),[k,b]}var rH={kernelName:xm,backendName:"webgl",kernelFunc:zme};var tk=class{constructor(e,r,n,o,s,i){this.variableNames=["Image","Transforms"],this.outputShape=i;let a=n==="nearest"?1:2,l;switch(o){case"constant":l=1;break;case"reflect":l=2;break;case"wrap":l=3;break;case"nearest":l=4;break;default:l=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${l} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${r}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${s});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${s});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${r}));
                float mapY = mapCoord(inY, float(${e}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}};function Bme(t){let{inputs:e,backend:r,attrs:n}=t,{image:o,transforms:s}=e,{interpolation:i,fillMode:a,fillValue:l,outputShape:u}=n,[c,p,f,d]=o.shape,[m,h]=u??[p,f],x=[c,m,h,d],g=new tk(p,f,i,a,l,x);return r.runWebGLProgram(g,[o,s],"float32")}var nH={kernelName:ym,backendName:"webgl",kernelFunc:Bme};function Vme(t){let{inputs:e,attrs:r,backend:n}=t,{axis:o}=r,{x:s}=e;ea(s,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");let i=n.readSync(s.dataId),{outputValues:a,outputShape:l,indices:u}=yG(i,o,s.shape,s.dtype);return[n.makeTensorInfo(l,s.dtype,a),n.makeTensorInfo([u.length],"int32",u)]}var oH={kernelName:bm,backendName:"webgl",kernelFunc:Vme};function Wme(t){let{inputs:e,backend:r,attrs:n}=t,{value:o}=e,{axis:s}=n;s<0&&(s+=o.shape.length);let i=o,a=i.shape.length,l=o.shape[s],u=new Array(a-1),c=0;for(let h=0;h<a;h++)h!==s&&(u[c++]=i.shape[h]);let p=[],f=new Array(a).fill(0),d=i.shape.slice();d[s]=1;let m=new Array(l);for(let h=0;h<m.length;h++){f[s]=h;let x=xi({inputs:{x:i},backend:r,attrs:{begin:f,size:d}}),g=ce({inputs:{x},backend:r,attrs:{shape:u}});m[h]=g,p.push(x)}return p.forEach(h=>r.disposeIntermediateTensorInfo(h)),m}var sH={kernelName:ac,backendName:"webgl",kernelFunc:Wme};var rk=class{constructor(e,r){this.variableNames=["x","segmentIds"];let n=e.windowSize,o=e.batchSize,s=e.inSize,i=e.numSegments,a=i*Math.ceil(s/n);this.outputShape=[o,a];let l="0.0",u="sumValue",c=Math.floor(n/4)*4,p=n%4,f=`
        sumValue += dot(values, segFilter);
    `,d="";s%n>0&&(d=`
        if (inIdx < 0 || inIdx >= ${s}) {
          return initializationValue;
        }
      `);let m="";s%n>0&&(m=`
        if (inIdx < 0 || inIdx >= ${s}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${l};

      float getValue(int batch, int inIdx) {
        ${d}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${m}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${i})) * float(${n}));
        int currentSeg = int(mod(float(outIdx), float(${i})));

        float sumValue = 0.0;

        for (int i = 0; i < ${c}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${f}
        }

        int inIdx = inOffset + ${c};
        if (${p===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${f}
        } else if (${p===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${f}
        } else if (${p===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${f}
        }
        setOutput(${u});
      }
    `}};function Gme(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,segmentIds:s}=e,{numSegments:i}=n,a=o.shape.length,l=[],u=0,c=T.getAxesPermutation([u],a),p=o;c!=null&&(p=Ut({inputs:{x:o},backend:r,attrs:{perm:c}}),l.push(p),u=T.getInnerMostAxes(1,a)[0]);let f=T.segment_util.computeOutShape(p.shape,u,i),d=w.sizeFromShape([p.shape[u]]),m=ce({inputs:{x:p},backend:r,attrs:{shape:[-1,d]}});l.push(m);let h=Up(o.dtype),x=(v,C,S,k,I)=>{let A=v.shape[0],$=v.shape[1],O=T.segment_util.segOpComputeOptimalWindowSize($,I),j={windowSize:O,inSize:$,batchSize:A,numSegments:I},H=new rk(j,C),Y=r.compileAndRun(H,[v,S],k);if(l.push(Y),Y.shape[1]===I)return Y;let B=mA({backend:r,attrs:{start:0,stop:I,step:1,dtype:"float32"}}),K=hA({inputs:{x:B},backend:r,attrs:{reps:[$/O]}});return l.push(B),l.push(K),x(Y,C,K,k,I)},g=x(m,"unsortedSegmentSum",s,h,i),y=ce({inputs:{x:g},backend:r,attrs:{shape:f}}),b=y;if(c!=null){l.push(y);let v=T.getUndoAxesPermutation(c);b=Ut({inputs:{x:b},backend:r,attrs:{perm:v}})}return l.forEach(v=>r.disposeIntermediateTensorInfo(v)),b}var iH={kernelName:lc,backendName:"webgl",kernelFunc:Gme};var Ume=[HG,jG,KG,XG,QG,ZG,JG,e6,n6,o6,s6,i6,a6,l6,u6,c6,p6,f6,d6,m6,h6,x6,y6,b6,S6,T6,N6,FG,E6,A6,D6,$6,R6,O6,F6,P6,L6,M6,z6,W6,G6,U6,H6,q6,j6,K6,X6,Y6,Q6,Z6,J6,eU,tU,rU,nU,sU,iU,aU,lU,cU,pU,fU,dU,mU,hU,gU,xU,yU,OG,bU,_6,vU,wU,CU,PG,SU,kU,TU,NU,IU,EU,_U,AU,DU,$U,OU,FU,PU,LU,MU,zU,VU,GU,UU,HU,qU,jU,ZU,zG,JU,e8,t8,r8,v6,n8,i8,a8,l8,u8,LG,c8,p8,f8,d8,m8,w6,KU,h8,g8,x8,VG,y8,b8,v8,w8,C8,S8,k8,T8,N8,I8,E8,_8,A8,D8,$8,R8,g6,QU,O8,F8,P8,L8,M8,z8,B8,V8,G8,U8,q8,j8,K8,X8,Y8,Q8,YU,GG,Z8,J8,eH,rH,nH,UG,oH,sH,iH,o8];for(let t of Ume)n1(t);var _t=nt(ct()),zn=nt(Bf());var up=nt(ct()),Vg=nt(Bf());var ER=nt(ct());var eu=nt(ct());var bge={grad:.9,turn:360,rad:360/(2*Math.PI)},Bl=function(t){return typeof t=="string"?t.length>0:typeof t=="number"},Sn=function(t,e,r){return e===void 0&&(e=0),r===void 0&&(r=Math.pow(10,e)),Math.round(r*t)/r+0},Bs=function(t,e,r){return e===void 0&&(e=0),r===void 0&&(r=1),t>r?r:t>e?t:e},p7=function(t){return(t=isFinite(t)?t%360:0)>0?t:t+360},o7=function(t){return{r:Bs(t.r,0,255),g:Bs(t.g,0,255),b:Bs(t.b,0,255),a:Bs(t.a)}},BA=function(t){return{r:Sn(t.r),g:Sn(t.g),b:Sn(t.b),a:Sn(t.a,3)}},vge=/^#([0-9a-f]{3,8})$/i,kk=function(t){var e=t.toString(16);return e.length<2?"0"+e:e},f7=function(t){var e=t.r,r=t.g,n=t.b,o=t.a,s=Math.max(e,r,n),i=s-Math.min(e,r,n),a=i?s===e?(r-n)/i:s===r?2+(n-e)/i:4+(e-r)/i:0;return{h:60*(a<0?a+6:a),s:s?i/s*100:0,v:s/255*100,a:o}},d7=function(t){var e=t.h,r=t.s,n=t.v,o=t.a;e=e/360*6,r/=100,n/=100;var s=Math.floor(e),i=n*(1-r),a=n*(1-(e-s)*r),l=n*(1-(1-e+s)*r),u=s%6;return{r:255*[n,a,i,i,l,n][u],g:255*[l,n,n,a,i,i][u],b:255*[i,i,l,n,n,a][u],a:o}},s7=function(t){return{h:p7(t.h),s:Bs(t.s,0,100),l:Bs(t.l,0,100),a:Bs(t.a)}},i7=function(t){return{h:Sn(t.h),s:Sn(t.s),l:Sn(t.l),a:Sn(t.a,3)}},a7=function(t){return d7((r=(e=t).s,{h:e.h,s:(r*=((n=e.l)<50?n:100-n)/100)>0?2*r/(n+r)*100:0,v:n+r,a:e.a}));var e,r,n},Q0=function(t){return{h:(e=f7(t)).h,s:(o=(200-(r=e.s))*(n=e.v)/100)>0&&o<200?r*n/100/(o<=100?o:200-o)*100:0,l:o/2,a:e.a};var e,r,n,o},wge=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Cge=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Sge=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,kge=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,GA={string:[[function(t){var e=vge.exec(t);return e?(t=e[1]).length<=4?{r:parseInt(t[0]+t[0],16),g:parseInt(t[1]+t[1],16),b:parseInt(t[2]+t[2],16),a:t.length===4?Sn(parseInt(t[3]+t[3],16)/255,2):1}:t.length===6||t.length===8?{r:parseInt(t.substr(0,2),16),g:parseInt(t.substr(2,2),16),b:parseInt(t.substr(4,2),16),a:t.length===8?Sn(parseInt(t.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(t){var e=Sge.exec(t)||kge.exec(t);return e?e[2]!==e[4]||e[4]!==e[6]?null:o7({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:e[7]===void 0?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(t){var e=wge.exec(t)||Cge.exec(t);if(!e)return null;var r,n,o=s7({h:(r=e[1],n=e[2],n===void 0&&(n="deg"),Number(r)*(bge[n]||1)),s:Number(e[3]),l:Number(e[4]),a:e[5]===void 0?1:Number(e[5])/(e[6]?100:1)});return a7(o)},"hsl"]],object:[[function(t){var e=t.r,r=t.g,n=t.b,o=t.a,s=o===void 0?1:o;return Bl(e)&&Bl(r)&&Bl(n)?o7({r:Number(e),g:Number(r),b:Number(n),a:Number(s)}):null},"rgb"],[function(t){var e=t.h,r=t.s,n=t.l,o=t.a,s=o===void 0?1:o;if(!Bl(e)||!Bl(r)||!Bl(n))return null;var i=s7({h:Number(e),s:Number(r),l:Number(n),a:Number(s)});return a7(i)},"hsl"],[function(t){var e=t.h,r=t.s,n=t.v,o=t.a,s=o===void 0?1:o;if(!Bl(e)||!Bl(r)||!Bl(n))return null;var i=function(a){return{h:p7(a.h),s:Bs(a.s,0,100),v:Bs(a.v,0,100),a:Bs(a.a)}}({h:Number(e),s:Number(r),v:Number(n),a:Number(s)});return d7(i)},"hsv"]]},l7=function(t,e){for(var r=0;r<e.length;r++){var n=e[r][0](t);if(n)return[n,e[r][1]]}return[null,void 0]},Tge=function(t){return typeof t=="string"?l7(t.trim(),GA.string):typeof t=="object"&&t!==null?l7(t,GA.object):[null,void 0]};var VA=function(t,e){var r=Q0(t);return{h:r.h,s:Bs(r.s+100*e,0,100),l:r.l,a:r.a}},WA=function(t){return(299*t.r+587*t.g+114*t.b)/1e3/255},u7=function(t,e){var r=Q0(t);return{h:r.h,s:r.s,l:Bs(r.l+100*e,0,100),a:r.a}},UA=function(){function t(e){this.parsed=Tge(e)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return t.prototype.isValid=function(){return this.parsed!==null},t.prototype.brightness=function(){return Sn(WA(this.rgba),2)},t.prototype.isDark=function(){return WA(this.rgba)<.5},t.prototype.isLight=function(){return WA(this.rgba)>=.5},t.prototype.toHex=function(){return e=BA(this.rgba),r=e.r,n=e.g,o=e.b,i=(s=e.a)<1?kk(Sn(255*s)):"","#"+kk(r)+kk(n)+kk(o)+i;var e,r,n,o,s,i},t.prototype.toRgb=function(){return BA(this.rgba)},t.prototype.toRgbString=function(){return e=BA(this.rgba),r=e.r,n=e.g,o=e.b,(s=e.a)<1?"rgba("+r+", "+n+", "+o+", "+s+")":"rgb("+r+", "+n+", "+o+")";var e,r,n,o,s},t.prototype.toHsl=function(){return i7(Q0(this.rgba))},t.prototype.toHslString=function(){return e=i7(Q0(this.rgba)),r=e.h,n=e.s,o=e.l,(s=e.a)<1?"hsla("+r+", "+n+"%, "+o+"%, "+s+")":"hsl("+r+", "+n+"%, "+o+"%)";var e,r,n,o,s},t.prototype.toHsv=function(){return e=f7(this.rgba),{h:Sn(e.h),s:Sn(e.s),v:Sn(e.v),a:Sn(e.a,3)};var e},t.prototype.invert=function(){return cr({r:255-(e=this.rgba).r,g:255-e.g,b:255-e.b,a:e.a});var e},t.prototype.saturate=function(e){return e===void 0&&(e=.1),cr(VA(this.rgba,e))},t.prototype.desaturate=function(e){return e===void 0&&(e=.1),cr(VA(this.rgba,-e))},t.prototype.grayscale=function(){return cr(VA(this.rgba,-1))},t.prototype.lighten=function(e){return e===void 0&&(e=.1),cr(u7(this.rgba,e))},t.prototype.darken=function(e){return e===void 0&&(e=.1),cr(u7(this.rgba,-e))},t.prototype.rotate=function(e){return e===void 0&&(e=15),this.hue(this.hue()+e)},t.prototype.alpha=function(e){return typeof e=="number"?cr({r:(r=this.rgba).r,g:r.g,b:r.b,a:e}):Sn(this.rgba.a,3);var r},t.prototype.hue=function(e){var r=Q0(this.rgba);return typeof e=="number"?cr({h:e,s:r.s,l:r.l,a:r.a}):Sn(r.h)},t.prototype.isEqual=function(e){return this.toHex()===cr(e).toHex()},t}(),cr=function(t){return t instanceof UA?t:new UA(t)},c7=[],Tk=function(t){t.forEach(function(e){c7.indexOf(e)<0&&(e(UA,GA),c7.push(e))})};function HA(t,e){if(t==null)return{};var r={},n=Object.keys(t),o,s;for(s=0;s<n.length;s++)o=n[s],!(e.indexOf(o)>=0)&&(r[o]=t[o]);return r}function yi(){return yi=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},yi.apply(this,arguments)}var Ht=nt(ct());var Nk=nt(ct());var qA=function(e){return e.reduce(function(r,n){var o=n[0],s=n[1];return r[o]=s,r},{})},jA=typeof window<"u"&&window.document&&window.document.createElement?Nk.useLayoutEffect:Nk.useEffect;var ap=nt(ct()),nK=nt(aR());var Pr="top",dn="bottom",Qr="right",Vr="left",qT="auto",sp=[Pr,dn,Qr,Vr],Ql="start",rd="end",Oj="clippingParents",jT="viewport",Og="popper",Fj="reference",lR=sp.reduce(function(t,e){return t.concat([e+"-"+Ql,e+"-"+rd])},[]),KT=[].concat(sp,[qT]).reduce(function(t,e){return t.concat([e,e+"-"+Ql,e+"-"+rd])},[]),Iye="beforeRead",Eye="read",_ye="afterRead",Aye="beforeMain",Dye="main",$ye="afterMain",Rye="beforeWrite",Oye="write",Fye="afterWrite",Pj=[Iye,Eye,_ye,Aye,Dye,$ye,Rye,Oye,Fye];function Nn(t){return t?(t.nodeName||"").toLowerCase():null}function Er(t){if(t==null)return window;if(t.toString()!=="[object Window]"){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function Ks(t){var e=Er(t).Element;return t instanceof e||t instanceof Element}function mn(t){var e=Er(t).HTMLElement;return t instanceof e||t instanceof HTMLElement}function Fg(t){if(typeof ShadowRoot>"u")return!1;var e=Er(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}function Pye(t){var e=t.state;Object.keys(e.elements).forEach(function(r){var n=e.styles[r]||{},o=e.attributes[r]||{},s=e.elements[r];!mn(s)||!Nn(s)||(Object.assign(s.style,n),Object.keys(o).forEach(function(i){var a=o[i];a===!1?s.removeAttribute(i):s.setAttribute(i,a===!0?"":a)}))})}function Lye(t){var e=t.state,r={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,r.popper),e.styles=r,e.elements.arrow&&Object.assign(e.elements.arrow.style,r.arrow),function(){Object.keys(e.elements).forEach(function(n){var o=e.elements[n],s=e.attributes[n]||{},i=Object.keys(e.styles.hasOwnProperty(n)?e.styles[n]:r[n]),a=i.reduce(function(l,u){return l[u]="",l},{});!mn(o)||!Nn(o)||(Object.assign(o.style,a),Object.keys(s).forEach(function(l){o.removeAttribute(l)}))})}}var Lj={name:"applyStyles",enabled:!0,phase:"write",fn:Pye,effect:Lye,requires:["computeStyles"]};function In(t){return t.split("-")[0]}var Ii=Math.max,nd=Math.min,Zl=Math.round;function Pg(){var t=navigator.userAgentData;return t!=null&&t.brands?t.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function Gb(){return!/^((?!chrome|android).)*safari/i.test(Pg())}function Xs(t,e,r){e===void 0&&(e=!1),r===void 0&&(r=!1);var n=t.getBoundingClientRect(),o=1,s=1;e&&mn(t)&&(o=t.offsetWidth>0&&Zl(n.width)/t.offsetWidth||1,s=t.offsetHeight>0&&Zl(n.height)/t.offsetHeight||1);var i=Ks(t)?Er(t):window,a=i.visualViewport,l=!Gb()&&r,u=(n.left+(l&&a?a.offsetLeft:0))/o,c=(n.top+(l&&a?a.offsetTop:0))/s,p=n.width/o,f=n.height/s;return{width:p,height:f,top:c,right:u+p,bottom:c+f,left:u,x:u,y:c}}function od(t){var e=Xs(t),r=t.offsetWidth,n=t.offsetHeight;return Math.abs(e.width-r)<=1&&(r=e.width),Math.abs(e.height-n)<=1&&(n=e.height),{x:t.offsetLeft,y:t.offsetTop,width:r,height:n}}function Ub(t,e){var r=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(r&&Fg(r)){var n=e;do{if(n&&t.isSameNode(n))return!0;n=n.parentNode||n.host}while(n)}return!1}function go(t){return Er(t).getComputedStyle(t)}function uR(t){return["table","td","th"].indexOf(Nn(t))>=0}function Mn(t){return((Ks(t)?t.ownerDocument:t.document)||window.document).documentElement}function Jl(t){return Nn(t)==="html"?t:t.assignedSlot||t.parentNode||(Fg(t)?t.host:null)||Mn(t)}function Mj(t){return!mn(t)||go(t).position==="fixed"?null:t.offsetParent}function Mye(t){var e=/firefox/i.test(Pg()),r=/Trident/i.test(Pg());if(r&&mn(t)){var n=go(t);if(n.position==="fixed")return null}var o=Jl(t);for(Fg(o)&&(o=o.host);mn(o)&&["html","body"].indexOf(Nn(o))<0;){var s=go(o);if(s.transform!=="none"||s.perspective!=="none"||s.contain==="paint"||["transform","perspective"].indexOf(s.willChange)!==-1||e&&s.willChange==="filter"||e&&s.filter&&s.filter!=="none")return o;o=o.parentNode}return null}function Ei(t){for(var e=Er(t),r=Mj(t);r&&uR(r)&&go(r).position==="static";)r=Mj(r);return r&&(Nn(r)==="html"||Nn(r)==="body"&&go(r).position==="static")?e:r||Mye(t)||e}function sd(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function id(t,e,r){return Ii(t,nd(e,r))}function zj(t,e,r){var n=id(t,e,r);return n>r?r:n}function Hb(){return{top:0,right:0,bottom:0,left:0}}function qb(t){return Object.assign({},Hb(),t)}function jb(t,e){return e.reduce(function(r,n){return r[n]=t,r},{})}var zye=function(e,r){return e=typeof e=="function"?e(Object.assign({},r.rects,{placement:r.placement})):e,qb(typeof e!="number"?e:jb(e,sp))};function Bye(t){var e,r=t.state,n=t.name,o=t.options,s=r.elements.arrow,i=r.modifiersData.popperOffsets,a=In(r.placement),l=sd(a),u=[Vr,Qr].indexOf(a)>=0,c=u?"height":"width";if(!(!s||!i)){var p=zye(o.padding,r),f=od(s),d=l==="y"?Pr:Vr,m=l==="y"?dn:Qr,h=r.rects.reference[c]+r.rects.reference[l]-i[l]-r.rects.popper[c],x=i[l]-r.rects.reference[l],g=Ei(s),y=g?l==="y"?g.clientHeight||0:g.clientWidth||0:0,b=h/2-x/2,v=p[d],C=y-f[c]-p[m],S=y/2-f[c]/2+b,k=id(v,S,C),I=l;r.modifiersData[n]=(e={},e[I]=k,e.centerOffset=k-S,e)}}function Vye(t){var e=t.state,r=t.options,n=r.element,o=n===void 0?"[data-popper-arrow]":n;o!=null&&(typeof o=="string"&&(o=e.elements.popper.querySelector(o),!o)||!Ub(e.elements.popper,o)||(e.elements.arrow=o))}var Bj={name:"arrow",enabled:!0,phase:"main",fn:Bye,effect:Vye,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Ys(t){return t.split("-")[1]}var Wye={top:"auto",right:"auto",bottom:"auto",left:"auto"};function Gye(t){var e=t.x,r=t.y,n=window,o=n.devicePixelRatio||1;return{x:Zl(e*o)/o||0,y:Zl(r*o)/o||0}}function Vj(t){var e,r=t.popper,n=t.popperRect,o=t.placement,s=t.variation,i=t.offsets,a=t.position,l=t.gpuAcceleration,u=t.adaptive,c=t.roundOffsets,p=t.isFixed,f=i.x,d=f===void 0?0:f,m=i.y,h=m===void 0?0:m,x=typeof c=="function"?c({x:d,y:h}):{x:d,y:h};d=x.x,h=x.y;var g=i.hasOwnProperty("x"),y=i.hasOwnProperty("y"),b=Vr,v=Pr,C=window;if(u){var S=Ei(r),k="clientHeight",I="clientWidth";if(S===Er(r)&&(S=Mn(r),go(S).position!=="static"&&a==="absolute"&&(k="scrollHeight",I="scrollWidth")),S=S,o===Pr||(o===Vr||o===Qr)&&s===rd){v=dn;var A=p&&S===C&&C.visualViewport?C.visualViewport.height:S[k];h-=A-n.height,h*=l?1:-1}if(o===Vr||(o===Pr||o===dn)&&s===rd){b=Qr;var $=p&&S===C&&C.visualViewport?C.visualViewport.width:S[I];d-=$-n.width,d*=l?1:-1}}var O=Object.assign({position:a},u&&Wye),j=c===!0?Gye({x:d,y:h}):{x:d,y:h};if(d=j.x,h=j.y,l){var H;return Object.assign({},O,(H={},H[v]=y?"0":"",H[b]=g?"0":"",H.transform=(C.devicePixelRatio||1)<=1?"translate("+d+"px, "+h+"px)":"translate3d("+d+"px, "+h+"px, 0)",H))}return Object.assign({},O,(e={},e[v]=y?h+"px":"",e[b]=g?d+"px":"",e.transform="",e))}function Uye(t){var e=t.state,r=t.options,n=r.gpuAcceleration,o=n===void 0?!0:n,s=r.adaptive,i=s===void 0?!0:s,a=r.roundOffsets,l=a===void 0?!0:a;if(!1)var u;var c={placement:In(e.placement),variation:Ys(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:o,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,Vj(Object.assign({},c,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:i,roundOffsets:l})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,Vj(Object.assign({},c,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}var Wj={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:Uye,data:{}};var XT={passive:!0};function Hye(t){var e=t.state,r=t.instance,n=t.options,o=n.scroll,s=o===void 0?!0:o,i=n.resize,a=i===void 0?!0:i,l=Er(e.elements.popper),u=[].concat(e.scrollParents.reference,e.scrollParents.popper);return s&&u.forEach(function(c){c.addEventListener("scroll",r.update,XT)}),a&&l.addEventListener("resize",r.update,XT),function(){s&&u.forEach(function(c){c.removeEventListener("scroll",r.update,XT)}),a&&l.removeEventListener("resize",r.update,XT)}}var Gj={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:Hye,data:{}};var qye={left:"right",right:"left",bottom:"top",top:"bottom"};function Lg(t){return t.replace(/left|right|bottom|top/g,function(e){return qye[e]})}var jye={start:"end",end:"start"};function YT(t){return t.replace(/start|end/g,function(e){return jye[e]})}function ad(t){var e=Er(t),r=e.pageXOffset,n=e.pageYOffset;return{scrollLeft:r,scrollTop:n}}function ld(t){return Xs(Mn(t)).left+ad(t).scrollLeft}function cR(t,e){var r=Er(t),n=Mn(t),o=r.visualViewport,s=n.clientWidth,i=n.clientHeight,a=0,l=0;if(o){s=o.width,i=o.height;var u=Gb();(u||!u&&e==="fixed")&&(a=o.offsetLeft,l=o.offsetTop)}return{width:s,height:i,x:a+ld(t),y:l}}function pR(t){var e,r=Mn(t),n=ad(t),o=(e=t.ownerDocument)==null?void 0:e.body,s=Ii(r.scrollWidth,r.clientWidth,o?o.scrollWidth:0,o?o.clientWidth:0),i=Ii(r.scrollHeight,r.clientHeight,o?o.scrollHeight:0,o?o.clientHeight:0),a=-n.scrollLeft+ld(t),l=-n.scrollTop;return go(o||r).direction==="rtl"&&(a+=Ii(r.clientWidth,o?o.clientWidth:0)-s),{width:s,height:i,x:a,y:l}}function ud(t){var e=go(t),r=e.overflow,n=e.overflowX,o=e.overflowY;return/auto|scroll|overlay|hidden/.test(r+o+n)}function QT(t){return["html","body","#document"].indexOf(Nn(t))>=0?t.ownerDocument.body:mn(t)&&ud(t)?t:QT(Jl(t))}function ip(t,e){var r;e===void 0&&(e=[]);var n=QT(t),o=n===((r=t.ownerDocument)==null?void 0:r.body),s=Er(n),i=o?[s].concat(s.visualViewport||[],ud(n)?n:[]):n,a=e.concat(i);return o?a:a.concat(ip(Jl(i)))}function Mg(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function Kye(t,e){var r=Xs(t,!1,e==="fixed");return r.top=r.top+t.clientTop,r.left=r.left+t.clientLeft,r.bottom=r.top+t.clientHeight,r.right=r.left+t.clientWidth,r.width=t.clientWidth,r.height=t.clientHeight,r.x=r.left,r.y=r.top,r}function Uj(t,e,r){return e===jT?Mg(cR(t,r)):Ks(e)?Kye(e,r):Mg(pR(Mn(t)))}function Xye(t){var e=ip(Jl(t)),r=["absolute","fixed"].indexOf(go(t).position)>=0,n=r&&mn(t)?Ei(t):t;return Ks(n)?e.filter(function(o){return Ks(o)&&Ub(o,n)&&Nn(o)!=="body"}):[]}function fR(t,e,r,n){var o=e==="clippingParents"?Xye(t):[].concat(e),s=[].concat(o,[r]),i=s[0],a=s.reduce(function(l,u){var c=Uj(t,u,n);return l.top=Ii(c.top,l.top),l.right=nd(c.right,l.right),l.bottom=nd(c.bottom,l.bottom),l.left=Ii(c.left,l.left),l},Uj(t,i,n));return a.width=a.right-a.left,a.height=a.bottom-a.top,a.x=a.left,a.y=a.top,a}function Kb(t){var e=t.reference,r=t.element,n=t.placement,o=n?In(n):null,s=n?Ys(n):null,i=e.x+e.width/2-r.width/2,a=e.y+e.height/2-r.height/2,l;switch(o){case Pr:l={x:i,y:e.y-r.height};break;case dn:l={x:i,y:e.y+e.height};break;case Qr:l={x:e.x+e.width,y:a};break;case Vr:l={x:e.x-r.width,y:a};break;default:l={x:e.x,y:e.y}}var u=o?sd(o):null;if(u!=null){var c=u==="y"?"height":"width";switch(s){case Ql:l[u]=l[u]-(e[c]/2-r[c]/2);break;case rd:l[u]=l[u]+(e[c]/2-r[c]/2);break;default:}}return l}function _i(t,e){e===void 0&&(e={});var r=e,n=r.placement,o=n===void 0?t.placement:n,s=r.strategy,i=s===void 0?t.strategy:s,a=r.boundary,l=a===void 0?Oj:a,u=r.rootBoundary,c=u===void 0?jT:u,p=r.elementContext,f=p===void 0?Og:p,d=r.altBoundary,m=d===void 0?!1:d,h=r.padding,x=h===void 0?0:h,g=qb(typeof x!="number"?x:jb(x,sp)),y=f===Og?Fj:Og,b=t.rects.popper,v=t.elements[m?y:f],C=fR(Ks(v)?v:v.contextElement||Mn(t.elements.popper),l,c,i),S=Xs(t.elements.reference),k=Kb({reference:S,element:b,strategy:"absolute",placement:o}),I=Mg(Object.assign({},b,k)),A=f===Og?I:S,$={top:C.top-A.top+g.top,bottom:A.bottom-C.bottom+g.bottom,left:C.left-A.left+g.left,right:A.right-C.right+g.right},O=t.modifiersData.offset;if(f===Og&&O){var j=O[o];Object.keys($).forEach(function(H){var Y=[Qr,dn].indexOf(H)>=0?1:-1,B=[Pr,dn].indexOf(H)>=0?"y":"x";$[H]+=j[B]*Y})}return $}function dR(t,e){e===void 0&&(e={});var r=e,n=r.placement,o=r.boundary,s=r.rootBoundary,i=r.padding,a=r.flipVariations,l=r.allowedAutoPlacements,u=l===void 0?KT:l,c=Ys(n),p=c?a?lR:lR.filter(function(m){return Ys(m)===c}):sp,f=p.filter(function(m){return u.indexOf(m)>=0});f.length===0&&(f=p);var d=f.reduce(function(m,h){return m[h]=_i(t,{placement:h,boundary:o,rootBoundary:s,padding:i})[In(h)],m},{});return Object.keys(d).sort(function(m,h){return d[m]-d[h]})}function Yye(t){if(In(t)===qT)return[];var e=Lg(t);return[YT(t),e,YT(e)]}function Qye(t){var e=t.state,r=t.options,n=t.name;if(!e.modifiersData[n]._skip){for(var o=r.mainAxis,s=o===void 0?!0:o,i=r.altAxis,a=i===void 0?!0:i,l=r.fallbackPlacements,u=r.padding,c=r.boundary,p=r.rootBoundary,f=r.altBoundary,d=r.flipVariations,m=d===void 0?!0:d,h=r.allowedAutoPlacements,x=e.options.placement,g=In(x),y=g===x,b=l||(y||!m?[Lg(x)]:Yye(x)),v=[x].concat(b).reduce(function(le,ae){return le.concat(In(ae)===qT?dR(e,{placement:ae,boundary:c,rootBoundary:p,padding:u,flipVariations:m,allowedAutoPlacements:h}):ae)},[]),C=e.rects.reference,S=e.rects.popper,k=new Map,I=!0,A=v[0],$=0;$<v.length;$++){var O=v[$],j=In(O),H=Ys(O)===Ql,Y=[Pr,dn].indexOf(j)>=0,B=Y?"width":"height",K=_i(e,{placement:O,boundary:c,rootBoundary:p,altBoundary:f,padding:u}),X=Y?H?Qr:Vr:H?dn:Pr;C[B]>S[B]&&(X=Lg(X));var Z=Lg(X),Q=[];if(s&&Q.push(K[j]<=0),a&&Q.push(K[X]<=0,K[Z]<=0),Q.every(function(le){return le})){A=O,I=!1;break}k.set(O,Q)}if(I)for(var ie=m?3:1,re=function(ae){var me=v.find(function(be){var we=k.get(be);if(we)return we.slice(0,ae).every(function(ke){return ke})});if(me)return A=me,"break"},ue=ie;ue>0;ue--){var ne=re(ue);if(ne==="break")break}e.placement!==A&&(e.modifiersData[n]._skip=!0,e.placement=A,e.reset=!0)}}var Hj={name:"flip",enabled:!0,phase:"main",fn:Qye,requiresIfExists:["offset"],data:{_skip:!1}};function qj(t,e,r){return r===void 0&&(r={x:0,y:0}),{top:t.top-e.height-r.y,right:t.right-e.width+r.x,bottom:t.bottom-e.height+r.y,left:t.left-e.width-r.x}}function jj(t){return[Pr,Qr,dn,Vr].some(function(e){return t[e]>=0})}function Zye(t){var e=t.state,r=t.name,n=e.rects.reference,o=e.rects.popper,s=e.modifiersData.preventOverflow,i=_i(e,{elementContext:"reference"}),a=_i(e,{altBoundary:!0}),l=qj(i,n),u=qj(a,o,s),c=jj(l),p=jj(u);e.modifiersData[r]={referenceClippingOffsets:l,popperEscapeOffsets:u,isReferenceHidden:c,hasPopperEscaped:p},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":c,"data-popper-escaped":p})}var Kj={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:Zye};function Jye(t,e,r){var n=In(t),o=[Vr,Pr].indexOf(n)>=0?-1:1,s=typeof r=="function"?r(Object.assign({},e,{placement:t})):r,i=s[0],a=s[1];return i=i||0,a=(a||0)*o,[Vr,Qr].indexOf(n)>=0?{x:a,y:i}:{x:i,y:a}}function e0e(t){var e=t.state,r=t.options,n=t.name,o=r.offset,s=o===void 0?[0,0]:o,i=KT.reduce(function(c,p){return c[p]=Jye(p,e.rects,s),c},{}),a=i[e.placement],l=a.x,u=a.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=l,e.modifiersData.popperOffsets.y+=u),e.modifiersData[n]=i}var Xj={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:e0e};function t0e(t){var e=t.state,r=t.name;e.modifiersData[r]=Kb({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})}var Yj={name:"popperOffsets",enabled:!0,phase:"read",fn:t0e,data:{}};function mR(t){return t==="x"?"y":"x"}function r0e(t){var e=t.state,r=t.options,n=t.name,o=r.mainAxis,s=o===void 0?!0:o,i=r.altAxis,a=i===void 0?!1:i,l=r.boundary,u=r.rootBoundary,c=r.altBoundary,p=r.padding,f=r.tether,d=f===void 0?!0:f,m=r.tetherOffset,h=m===void 0?0:m,x=_i(e,{boundary:l,rootBoundary:u,padding:p,altBoundary:c}),g=In(e.placement),y=Ys(e.placement),b=!y,v=sd(g),C=mR(v),S=e.modifiersData.popperOffsets,k=e.rects.reference,I=e.rects.popper,A=typeof h=="function"?h(Object.assign({},e.rects,{placement:e.placement})):h,$=typeof A=="number"?{mainAxis:A,altAxis:A}:Object.assign({mainAxis:0,altAxis:0},A),O=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,j={x:0,y:0};if(!!S){if(s){var H,Y=v==="y"?Pr:Vr,B=v==="y"?dn:Qr,K=v==="y"?"height":"width",X=S[v],Z=X+x[Y],Q=X-x[B],ie=d?-I[K]/2:0,re=y===Ql?k[K]:I[K],ue=y===Ql?-I[K]:-k[K],ne=e.elements.arrow,le=d&&ne?od(ne):{width:0,height:0},ae=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:Hb(),me=ae[Y],be=ae[B],we=id(0,k[K],le[K]),ke=b?k[K]/2-ie-we-me-$.mainAxis:re-we-me-$.mainAxis,He=b?-k[K]/2+ie+we+be+$.mainAxis:ue+we+be+$.mainAxis,We=e.elements.arrow&&Ei(e.elements.arrow),R=We?v==="y"?We.clientTop||0:We.clientLeft||0:0,U=(H=O?.[v])!=null?H:0,P=X+ke-U-R,se=X+He-U,pe=id(d?nd(Z,P):Z,X,d?Ii(Q,se):Q);S[v]=pe,j[v]=pe-X}if(a){var fe,Pe=v==="x"?Pr:Vr,Be=v==="x"?dn:Qr,Ge=S[C],$t=C==="y"?"height":"width",hr=Ge+x[Pe],mt=Ge-x[Be],ge=[Pr,Vr].indexOf(g)!==-1,pt=(fe=O?.[C])!=null?fe:0,ht=ge?hr:Ge-k[$t]-I[$t]-pt+$.altAxis,bo=ge?Ge+k[$t]+I[$t]-pt-$.altAxis:mt,_r=d&&ge?zj(ht,Ge,bo):id(d?ht:hr,Ge,d?bo:mt);S[C]=_r,j[C]=_r-Ge}e.modifiersData[n]=j}}var Qj={name:"preventOverflow",enabled:!0,phase:"main",fn:r0e,requiresIfExists:["offset"]};function hR(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}function gR(t){return t===Er(t)||!mn(t)?ad(t):hR(t)}function n0e(t){var e=t.getBoundingClientRect(),r=Zl(e.width)/t.offsetWidth||1,n=Zl(e.height)/t.offsetHeight||1;return r!==1||n!==1}function xR(t,e,r){r===void 0&&(r=!1);var n=mn(e),o=mn(e)&&n0e(e),s=Mn(e),i=Xs(t,o,r),a={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(n||!n&&!r)&&((Nn(e)!=="body"||ud(s))&&(a=gR(e)),mn(e)?(l=Xs(e,!0),l.x+=e.clientLeft,l.y+=e.clientTop):s&&(l.x=ld(s))),{x:i.left+a.scrollLeft-l.x,y:i.top+a.scrollTop-l.y,width:i.width,height:i.height}}function o0e(t){var e=new Map,r=new Set,n=[];t.forEach(function(s){e.set(s.name,s)});function o(s){r.add(s.name);var i=[].concat(s.requires||[],s.requiresIfExists||[]);i.forEach(function(a){if(!r.has(a)){var l=e.get(a);l&&o(l)}}),n.push(s)}return t.forEach(function(s){r.has(s.name)||o(s)}),n}function yR(t){var e=o0e(t);return Pj.reduce(function(r,n){return r.concat(e.filter(function(o){return o.phase===n}))},[])}function bR(t){var e;return function(){return e||(e=new Promise(function(r){Promise.resolve().then(function(){e=void 0,r(t())})})),e}}function vR(t){var e=t.reduce(function(r,n){var o=r[n.name];return r[n.name]=o?Object.assign({},o,n,{options:Object.assign({},o.options,n.options),data:Object.assign({},o.data,n.data)}):n,r},{});return Object.keys(e).map(function(r){return e[r]})}var Zj={placement:"bottom",modifiers:[],strategy:"absolute"};function Jj(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return!e.some(function(n){return!(n&&typeof n.getBoundingClientRect=="function")})}function eK(t){t===void 0&&(t={});var e=t,r=e.defaultModifiers,n=r===void 0?[]:r,o=e.defaultOptions,s=o===void 0?Zj:o;return function(a,l,u){u===void 0&&(u=s);var c={placement:"bottom",orderedModifiers:[],options:Object.assign({},Zj,s),modifiersData:{},elements:{reference:a,popper:l},attributes:{},styles:{}},p=[],f=!1,d={state:c,setOptions:function(g){var y=typeof g=="function"?g(c.options):g;h(),c.options=Object.assign({},s,c.options,y),c.scrollParents={reference:Ks(a)?ip(a):a.contextElement?ip(a.contextElement):[],popper:ip(l)};var b=yR(vR([].concat(n,c.options.modifiers)));if(c.orderedModifiers=b.filter(function(O){return O.enabled}),!1){var v;if(getBasePlacement(c.options.placement)===auto)var C;var S,k,I,A,$}return m(),d.update()},forceUpdate:function(){if(!f){var g=c.elements,y=g.reference,b=g.popper;if(!!Jj(y,b)){c.rects={reference:xR(y,Ei(b),c.options.strategy==="fixed"),popper:od(b)},c.reset=!1,c.placement=c.options.placement,c.orderedModifiers.forEach(function(O){return c.modifiersData[O.name]=Object.assign({},O.data)});for(var v=0,C=0;C<c.orderedModifiers.length;C++){if(c.reset===!0){c.reset=!1,C=-1;continue}var S=c.orderedModifiers[C],k=S.fn,I=S.options,A=I===void 0?{}:I,$=S.name;typeof k=="function"&&(c=k({state:c,options:A,name:$,instance:d})||c)}}}},update:bR(function(){return new Promise(function(x){d.forceUpdate(),x(c)})}),destroy:function(){h(),f=!0}};if(!Jj(a,l))return d;d.setOptions(u).then(function(x){!f&&u.onFirstUpdate&&u.onFirstUpdate(x)});function m(){c.orderedModifiers.forEach(function(x){var g=x.name,y=x.options,b=y===void 0?{}:y,v=x.effect;if(typeof v=="function"){var C=v({state:c,name:g,instance:d,options:b}),S=function(){};p.push(C||S)}})}function h(){p.forEach(function(x){return x()}),p=[]}return d}}var s0e=[Gj,Yj,Wj,Lj,Xj,Hj,Qj,Bj,Kj],wR=eK({defaultModifiers:s0e});var oK=nt(rK());var c0e=[],CR=function(e,r,n){n===void 0&&(n={});var o=ap.useRef(null),s={onFirstUpdate:n.onFirstUpdate,placement:n.placement||"bottom",strategy:n.strategy||"absolute",modifiers:n.modifiers||c0e},i=ap.useState({styles:{popper:{position:s.strategy,left:"0",top:"0"},arrow:{position:"absolute"}},attributes:{}}),a=i[0],l=i[1],u=ap.useMemo(function(){return{name:"updateState",enabled:!0,phase:"write",fn:function(d){var m=d.state,h=Object.keys(m.elements);nK.flushSync(function(){l({styles:qA(h.map(function(x){return[x,m.styles[x]||{}]})),attributes:qA(h.map(function(x){return[x,m.attributes[x]]}))})})},requires:["computeStyles"]}},[]),c=ap.useMemo(function(){var f={onFirstUpdate:s.onFirstUpdate,placement:s.placement,strategy:s.strategy,modifiers:[].concat(s.modifiers,[u,{name:"applyStyles",enabled:!1}])};return(0,oK.default)(o.current,f)?o.current||f:(o.current=f,f)},[s.onFirstUpdate,s.placement,s.strategy,s.modifiers,u]),p=ap.useRef();return jA(function(){p.current&&p.current.setOptions(c)},[c]),jA(function(){if(!(e==null||r==null)){var f=n.createPopper||wR,d=f(e,r,c);return p.current=d,function(){d.destroy(),p.current=null}}},[e,r,n.createPopper]),{state:p.current?p.current.state:null,styles:a.styles,attributes:a.attributes,update:p.current?p.current.update:null,forceUpdate:p.current?p.current.forceUpdate:null}};function aK(t){var e=Ht.useRef(t);return e.current=t,Ht.useCallback(function(){return e.current},[])}var p0e=function(){};function f0e(t){var e=t.initial,r=t.value,n=t.onChange,o=n===void 0?p0e:n;if(e===void 0&&r===void 0)throw new TypeError('Either "value" or "initial" variable must be set. Now both are undefined');var s=Ht.useState(e),i=s[0],a=s[1],l=aK(i),u=Ht.useCallback(function(p){var f=l(),d=typeof p=="function"?p(f):p;typeof d.persist=="function"&&d.persist(),a(d),typeof o=="function"&&o(d)},[l,o]),c=r!==void 0;return[c?r:i,c?o:u]}function lK(t,e){return t===void 0&&(t=0),e===void 0&&(e=0),function(){return{width:0,height:0,top:e,right:t,bottom:e,left:t,x:0,y:0,toJSON:function(){return null}}}}var d0e=["styles","attributes"],sK={getBoundingClientRect:lK()},iK={closeOnOutsideClick:!0,closeOnTriggerHidden:!1,defaultVisible:!1,delayHide:0,delayShow:0,followCursor:!1,interactive:!1,mutationObserverOptions:{attributes:!0,childList:!0,subtree:!0},offset:[0,6],trigger:"hover"};function zg(t,e){var r,n,o;t===void 0&&(t={}),e===void 0&&(e={});var s=Object.keys(iK).reduce(function(B,K){var X;return yi({},B,(X={},X[K]=B[K]!==void 0?B[K]:iK[K],X))},t),i=Ht.useMemo(function(){return[{name:"offset",options:{offset:s.offset}}]},Array.isArray(s.offset)?s.offset:[]),a=yi({},e,{placement:e.placement||s.placement,modifiers:e.modifiers||i}),l=Ht.useState(null),u=l[0],c=l[1],p=Ht.useState(null),f=p[0],d=p[1],m=f0e({initial:s.defaultVisible,value:s.visible,onChange:s.onVisibleChange}),h=m[0],x=m[1],g=Ht.useRef();Ht.useEffect(function(){return function(){return clearTimeout(g.current)}},[]);var y=CR(s.followCursor?sK:u,f,a),b=y.styles,v=y.attributes,C=HA(y,d0e),S=C.update,k=aK({visible:h,triggerRef:u,tooltipRef:f,finalConfig:s}),I=Ht.useCallback(function(B){return Array.isArray(s.trigger)?s.trigger.includes(B):s.trigger===B},Array.isArray(s.trigger)?s.trigger:[s.trigger]),A=Ht.useCallback(function(){clearTimeout(g.current),g.current=window.setTimeout(function(){return x(!1)},s.delayHide)},[s.delayHide,x]),$=Ht.useCallback(function(){clearTimeout(g.current),g.current=window.setTimeout(function(){return x(!0)},s.delayShow)},[s.delayShow,x]),O=Ht.useCallback(function(){k().visible?A():$()},[k,A,$]);Ht.useEffect(function(){if(!!k().finalConfig.closeOnOutsideClick){var B=function(X){var Z,Q=k(),ie=Q.tooltipRef,re=Q.triggerRef,ue=(X.composedPath==null||(Z=X.composedPath())==null?void 0:Z[0])||X.target;ue instanceof Node&&ie!=null&&re!=null&&!ie.contains(ue)&&!re.contains(ue)&&A()};return document.addEventListener("mousedown",B),function(){return document.removeEventListener("mousedown",B)}}},[k,A]),Ht.useEffect(function(){if(!(u==null||!I("click")))return u.addEventListener("click",O),function(){return u.removeEventListener("click",O)}},[u,I,O]),Ht.useEffect(function(){if(!(u==null||!I("double-click")))return u.addEventListener("dblclick",O),function(){return u.removeEventListener("dblclick",O)}},[u,I,O]),Ht.useEffect(function(){if(!(u==null||!I("right-click"))){var B=function(X){X.preventDefault(),O()};return u.addEventListener("contextmenu",B),function(){return u.removeEventListener("contextmenu",B)}}},[u,I,O]),Ht.useEffect(function(){if(!(u==null||!I("focus")))return u.addEventListener("focus",$),u.addEventListener("blur",A),function(){u.removeEventListener("focus",$),u.removeEventListener("blur",A)}},[u,I,$,A]),Ht.useEffect(function(){if(!(u==null||!I("hover")))return u.addEventListener("mouseenter",$),u.addEventListener("mouseleave",A),function(){u.removeEventListener("mouseenter",$),u.removeEventListener("mouseleave",A)}},[u,I,$,A]),Ht.useEffect(function(){if(!(f==null||!I("hover")||!k().finalConfig.interactive))return f.addEventListener("mouseenter",$),f.addEventListener("mouseleave",A),function(){f.removeEventListener("mouseenter",$),f.removeEventListener("mouseleave",A)}},[f,I,$,A,k]);var j=C==null||(r=C.state)==null||(n=r.modifiersData)==null||(o=n.hide)==null?void 0:o.isReferenceHidden;Ht.useEffect(function(){s.closeOnTriggerHidden&&j&&A()},[s.closeOnTriggerHidden,A,j]),Ht.useEffect(function(){if(!s.followCursor||u==null)return;function B(K){var X=K.clientX,Z=K.clientY;sK.getBoundingClientRect=lK(X,Z),S?.()}return u.addEventListener("mousemove",B),function(){return u.removeEventListener("mousemove",B)}},[s.followCursor,u,S]),Ht.useEffect(function(){if(!(f==null||S==null||s.mutationObserverOptions==null)){var B=new MutationObserver(S);return B.observe(f,s.mutationObserverOptions),function(){return B.disconnect()}}},[s.mutationObserverOptions,f,S]);var H=function(K){return K===void 0&&(K={}),yi({},K,{style:yi({},K.style,b.popper)},v.popper,{"data-popper-interactive":s.interactive})},Y=function(K){return K===void 0&&(K={}),yi({},K,v.arrow,{style:yi({},K.style,b.arrow),"data-popper-arrow":!0})};return yi({getArrowProps:Y,getTooltipProps:H,setTooltipRef:d,setTriggerRef:c,tooltipRef:f,triggerRef:u,visible:h},C)}var ua=function(t,e,r){return e===void 0&&(e=0),r===void 0&&(r=1),t>r?r:t>e?t:e},SR=function(t){var e=t/255;return e<.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)},kR=function(t){return 255*(t>.0031308?1.055*Math.pow(t,.4166666666666667)-.055:12.92*t)},TR=96.422,NR=100,IR=82.521,m0e=function(t){var e,r,n={x:.9555766*(e=t).x+-.0230393*e.y+.0631636*e.z,y:-.0282895*e.x+1.0099416*e.y+.0210077*e.z,z:.0122982*e.x+-.020483*e.y+1.3299098*e.z};return r={r:kR(.032404542*n.x-.015371385*n.y-.004985314*n.z),g:kR(-.00969266*n.x+.018760108*n.y+41556e-8*n.z),b:kR(556434e-9*n.x-.002040259*n.y+.010572252*n.z),a:t.a},{r:ua(r.r,0,255),g:ua(r.g,0,255),b:ua(r.b,0,255),a:ua(r.a)}},h0e=function(t){var e=SR(t.r),r=SR(t.g),n=SR(t.b);return function(o){return{x:ua(o.x,0,TR),y:ua(o.y,0,NR),z:ua(o.z,0,IR),a:ua(o.a)}}(function(o){return{x:1.0478112*o.x+.0228866*o.y+-.050127*o.z,y:.0295424*o.x+.9904844*o.y+-.0170491*o.z,z:-.0092345*o.x+.0150436*o.y+.7521316*o.z,a:o.a}}({x:100*(.4124564*e+.3575761*r+.1804375*n),y:100*(.2126729*e+.7151522*r+.072175*n),z:100*(.0193339*e+.119192*r+.9503041*n),a:t.a}))},Xb=216/24389,Bg=24389/27,uK=function(t){var e=h0e(t),r=e.x/TR,n=e.y/NR,o=e.z/IR;return r=r>Xb?Math.cbrt(r):(Bg*r+16)/116,{l:116*(n=n>Xb?Math.cbrt(n):(Bg*n+16)/116)-16,a:500*(r-n),b:200*(n-(o=o>Xb?Math.cbrt(o):(Bg*o+16)/116)),alpha:e.a}},g0e=function(t,e,r){var n,o=uK(t),s=uK(e);return function(i){var a=(i.l+16)/116,l=i.a/500+a,u=a-i.b/200;return m0e({x:(Math.pow(l,3)>Xb?Math.pow(l,3):(116*l-16)/Bg)*TR,y:(i.l>8?Math.pow((i.l+16)/116,3):i.l/Bg)*NR,z:(Math.pow(u,3)>Xb?Math.pow(u,3):(116*u-16)/Bg)*IR,a:i.alpha})}({l:ua((n={l:o.l*(1-r)+s.l*r,a:o.a*(1-r)+s.a*r,b:o.b*(1-r)+s.b*r,alpha:o.alpha*(1-r)+s.alpha*r}).l,0,400),a:n.a,b:n.b,alpha:ua(n.alpha)})};function JT(t){function e(r,n,o){o===void 0&&(o=5);for(var s=[],i=1/(o-1),a=0;a<=o-1;a++)s.push(r.mix(n,i*a));return s}t.prototype.mix=function(r,n){n===void 0&&(n=.5);var o=r instanceof t?r:new t(r),s=g0e(this.toRgb(),o.toRgb(),n);return new t(s)},t.prototype.tints=function(r){return e(this,"#fff",r)},t.prototype.shades=function(r){return e(this,"#000",r)},t.prototype.tones=function(r){return e(this,"#808080",r)}}function eN(t,e){var r={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},n={};for(var o in r)n[r[o]]=o;var s={};t.prototype.toName=function(i){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var a,l,u=n[this.toHex()];if(u)return u;if(i?.closest){var c=this.toRgb(),p=1/0,f="black";if(!s.length)for(var d in r)s[d]=new t(r[d]).toRgb();for(var m in r){var h=(a=c,l=s[m],Math.pow(a.r-l.r,2)+Math.pow(a.g-l.g,2)+Math.pow(a.b-l.b,2));h<p&&(p=h,f=m)}return f}},e.string.push([function(i){var a=i.toLowerCase(),l=a==="transparent"?"#0000":r[a];return l?new t(l).toRgb():null},"name"])}Tk([JT,eN]);function lp(t,e,r,n="red",o="blue"){return t>=0?cr(o).mix(cr("white"),Math.min(Math.max(1-t/r,0),1)):cr(n).mix(cr("white"),Math.min(Math.max(1- -t/-e,0),1))}function Yb(t){return t.replace(/\s/g,"&nbsp;").replace(/\n/g,"\xB6")}function cK({token:t,value:e,min:r,max:n,negativeColor:o,positiveColor:s}){let{getTooltipProps:i,setTooltipRef:a,setTriggerRef:l,visible:u}=zg({followCursor:!0}),c=lp(e,r,n,o,s).toRgbString(),p=cr(c).brightness()<.6?"white":"black",f={display:"inline-block",backgroundColor:c,color:p,lineHeight:"1em",padding:"3px 0",marginLeft:-1,marginBottom:1,borderWidth:1,borderStyle:"solid",borderColor:"#eee"},d=Yb(t),m=t.match(/\n/g);return eu.default.createElement(eu.default.Fragment,null,eu.default.createElement("span",{ref:l},eu.default.createElement("span",{style:f,dangerouslySetInnerHTML:{__html:d}}),m?.map((h,x)=>eu.default.createElement("br",{key:x}))),u&&eu.default.createElement("div",{ref:a,...i({style:{background:"#333",color:"white",textAlign:"center",padding:10,borderRadius:5,boxShadow:"5px 5px rgba(0, 0, 0, 0.03)",marginTop:15,zIndex:1}})},eu.default.createElement("strong",null,t),eu.default.createElement("br",null),e))}function tN({maxValue:t,minValue:e,negativeColor:r,positiveColor:n,tokens:o,values:s,paddingBottom:i}){let a=e??Math.min(...s),l=t??Math.max(...s);return ER.default.createElement("div",{className:"colored-tokens",style:{paddingBottom:i}},o.map((u,c)=>ER.default.createElement(cK,{key:c,token:u,value:s[c],min:a,max:l,negativeColor:r,positiveColor:n})))}function rN({activationsList:t,tokensList:e,minValue:r,maxValue:n}){let o={border:"1px solid black",borderRadius:5,padding:10,marginTop:10,marginBottom:10,backgroundColor:"#f5f5f5"};return up.default.createElement("div",null,t&&e&&t.length>1&&t.map((s,i)=>up.default.createElement(Vg.Row,{key:i},up.default.createElement(Vg.Col,{style:o},up.default.createElement(tN,{minValue:r,maxValue:n,tokens:e[i],values:s,paddingBottom:0})))),t&&e&&t.length===1&&up.default.createElement(Vg.Row,{key:0},up.default.createElement(Vg.Col,null,up.default.createElement(tN,{tokens:e[0],values:t[0]}))))}var _R=nt(ct());function x0e(t){return t.length<3?t.join("-"):`${t[0]}-${t[t.length-1]}`}function y0e(t){let e=t.split("-");if(e.length===1)return[parseInt(e[0],10)];let r=parseInt(e[0],10),n=parseInt(e[e.length-1],10);return Array.from({length:n-r+1},(o,s)=>r+s)}function Wg({smallestNumber:t=0,largestNumber:e,currentRangeArr:r,setCurrentValue:n,numValsInRange:o,id:s}){let i=x0e(r),a=[];for(let l=t;l<=e;l+=o){let u=l,c=Math.min(l+o-1,e);u===c?a.push(`${u}`):a.push(`${u}-${c}`)}return _R.default.createElement("select",{value:i,onChange:l=>n(y0e(l.target.value)),id:s},a.map(l=>_R.default.createElement("option",{key:l},l)))}var AR=nt(ct());function cs({smallestNumber:t=0,largestNumber:e,currentValue:r,setCurrentValue:n,id:o,labels:s}){let i=[...Array(e-t+1).keys()].map(l=>l+t),a=s&&s.length===i.length?s:i.map(l=>l.toString());return AR.default.createElement("select",{value:r,onChange:l=>n(Number(l.target.value)),id:o},i.map((l,u)=>AR.default.createElement("option",{key:l,value:l},a[u])))}function Qb(t,e){return t.slice(e[0][0],e[0][1]).map(r=>r.slice(e[1][0],e[1][1]))}function Zb(t){if(t.length===0)return[0,1];let e=Number.MAX_VALUE,r=Number.MIN_VALUE;for(let n=0;n<t.length;n+=1)if(Array.isArray(t[n])){let[o,s]=Zb(t[n]);e=Math.min(e,o),r=Math.max(r,s)}else e=Math.min(e,t[n]),r=Math.max(r,t[n]);return[e,r]}function b0e(t,e,r){return t.slice([0,e,r],[-1,1,1]).squeeze([1,2]).arraySync()}function v0e({tokens:t,activations:e,firstDimensionName:r="Layer",secondDimensionName:n="Neuron",firstDimensionLabels:o,secondDimensionLabels:s}){let i=typeof t[0]=="string"?[t]:t,a=typeof e[0][0][0]=="number"?[e]:e,[l,u]=Zb(a),c=a.map(A=>Cr(A)),p=c[0].shape[1],f=c[0].shape[2],d=c.length,[m,h]=(0,_t.useState)(Math.min(5,d)),[x,g]=(0,_t.useState)([...Array(m).keys()]),[y,b]=(0,_t.useState)(0),[v,C]=(0,_t.useState)(0);(0,_t.useEffect)(()=>{g([...Array(m).keys()])},[m]);let S=x.map(A=>b0e(c[A],y,v)),k=x.map(A=>i[A]),I={paddingTop:5,paddingBottom:5};return _t.default.createElement(zn.Container,{fluid:!0},_t.default.createElement(zn.Row,null,_t.default.createElement(zn.Col,null,_t.default.createElement(zn.Row,{style:I},_t.default.createElement(zn.Col,null,_t.default.createElement("label",{htmlFor:"layer-selector",style:{marginRight:15}},r,":"),_t.default.createElement(cs,{id:"layer-selector",largestNumber:p-1,currentValue:y,setCurrentValue:b,labels:o}))),_t.default.createElement(zn.Row,{style:I},_t.default.createElement(zn.Col,null,_t.default.createElement("label",{htmlFor:"neuron-selector",style:{marginRight:15}},n,":"),_t.default.createElement(cs,{id:"neuron-selector",largestNumber:f-1,currentValue:v,setCurrentValue:C,labels:s}))),d>1&&_t.default.createElement(zn.Row,{style:I},_t.default.createElement(zn.Col,null,_t.default.createElement("label",{htmlFor:"sample-selector",style:{marginRight:15}},"Samples:"),_t.default.createElement(Wg,{id:"sample-selector",largestNumber:d-1,currentRangeArr:x,setCurrentValue:g,numValsInRange:m})))),_t.default.createElement(zn.Col,null,d>1&&_t.default.createElement(zn.Row,{style:I},_t.default.createElement(zn.Col,null,_t.default.createElement("label",{htmlFor:"samples-per-page-selector",style:{marginRight:15}},"Samples per page:"),_t.default.createElement(cs,{id:"samples-per-page-selector",smallestNumber:1,largestNumber:d,currentValue:m,setCurrentValue:h}))))),_t.default.createElement(zn.Row,null,_t.default.createElement(zn.Col,null,_t.default.createElement(rN,{activationsList:S,tokensList:k,minValue:l,maxValue:u}))))}var Bn=nt(ct()),pu=nt(Bf());var xp=nt(ct());function Ai(){}var PR=(()=>{let t=0;return()=>t++})();function or(t){return t===null||typeof t>"u"}function yr(t){if(Array.isArray&&Array.isArray(t))return!0;let e=Object.prototype.toString.call(t);return e.slice(0,7)==="[object"&&e.slice(-6)==="Array]"}function dt(t){return t!==null&&Object.prototype.toString.call(t)==="[object Object]"}function Zr(t){return(typeof t=="number"||t instanceof Number)&&isFinite(+t)}function xo(t,e){return Zr(t)?t:e}function xr(t,e){return typeof t>"u"?e:t}var LR=(t,e)=>typeof t=="string"&&t.endsWith("%")?parseFloat(t)/100*e:+t;function br(t,e,r){if(t&&typeof t.call=="function")return t.apply(r,e)}function At(t,e,r,n){let o,s,i;if(yr(t))if(s=t.length,n)for(o=s-1;o>=0;o--)e.call(r,t[o],o);else for(o=0;o<s;o++)e.call(r,t[o],o);else if(dt(t))for(i=Object.keys(t),s=i.length,o=0;o<s;o++)e.call(r,t[i[o]],i[o])}function qg(t,e){let r,n,o,s;if(!t||!e||t.length!==e.length)return!1;for(r=0,n=t.length;r<n;++r)if(o=t[r],s=e[r],o.datasetIndex!==s.datasetIndex||o.index!==s.index)return!1;return!0}function tv(t){if(yr(t))return t.map(tv);if(dt(t)){let e=Object.create(null),r=Object.keys(t),n=r.length,o=0;for(;o<n;++o)e[r[o]]=tv(t[r[o]]);return e}return t}function wK(t){return["__proto__","prototype","constructor"].indexOf(t)===-1}function CK(t,e,r,n){if(!wK(t))return;let o=e[t],s=r[t];dt(o)&&dt(s)?pd(o,s,n):e[t]=tv(s)}function pd(t,e,r){let n=yr(e)?e:[e],o=n.length;if(!dt(t))return t;r=r||{};let s=r.merger||CK,i;for(let a=0;a<o;++a){if(i=n[a],!dt(i))continue;let l=Object.keys(i);for(let u=0,c=l.length;u<c;++u)s(l[u],t,i,r)}return t}function fd(t,e){return pd(t,e,{merger:SK})}function SK(t,e,r){if(!wK(t))return;let n=e[t],o=r[t];dt(n)&&dt(o)?fd(n,o):Object.prototype.hasOwnProperty.call(e,t)||(e[t]=tv(o))}var pK={"":t=>t,x:t=>t.x,y:t=>t.y};function kK(t){let e=t.split("."),r=[],n="";for(let o of e)n+=o,n.endsWith("\\")?n=n.slice(0,-1)+".":(r.push(n),n="");return r}function w0e(t){let e=kK(t);return r=>{for(let n of e){if(n==="")break;r=r&&r[n]}return r}}function jg(t,e){return(pK[e]||(pK[e]=w0e(e)))(t)}function nv(t){return t.charAt(0).toUpperCase()+t.slice(1)}var fs=t=>typeof t<"u",ca=t=>typeof t=="function",pN=(t,e)=>{if(t.size!==e.size)return!1;for(let r of t)if(!e.has(r))return!1;return!0};function MR(t){return t.type==="mouseup"||t.type==="click"||t.type==="contextmenu"}var En=Math.PI,ps=2*En,C0e=ps+En,rv=Number.POSITIVE_INFINITY,TK=En/180,no=En/2,cp=En/4,RR=En*2/3,pa=Math.log10,Kg=Math.sign;function Xg(t,e,r){return Math.abs(t-e)<r}function fN(t){let e=Math.round(t);t=Xg(t,e,t/1e3)?e:t;let r=Math.pow(10,Math.floor(pa(t))),n=t/r;return(n<=1?1:n<=2?2:n<=5?5:10)*r}function zR(t){let e=[],r=Math.sqrt(t),n;for(n=1;n<r;n++)t%n===0&&(e.push(n),e.push(t/n));return r===(r|0)&&e.push(r),e.sort((o,s)=>o-s).pop(),e}function Yg(t){return!isNaN(parseFloat(t))&&isFinite(t)}function BR(t,e){let r=Math.round(t);return r-e<=t&&r+e>=t}function dN(t,e,r){let n,o,s;for(n=0,o=t.length;n<o;n++)s=t[n][r],isNaN(s)||(e.min=Math.min(e.min,s),e.max=Math.max(e.max,s))}function fa(t){return t*(En/180)}function ov(t){return t*(180/En)}function mN(t){if(!Zr(t))return;let e=1,r=0;for(;Math.round(t*e)/e!==t;)e*=10,r++;return r}function VR(t,e){let r=e.x-t.x,n=e.y-t.y,o=Math.sqrt(r*r+n*n),s=Math.atan2(n,r);return s<-.5*En&&(s+=ps),{angle:s,distance:o}}function WR(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function Zs(t){return(t%ps+ps)%ps}function GR(t,e,r,n){let o=Zs(t),s=Zs(e),i=Zs(r),a=Zs(s-o),l=Zs(i-o),u=Zs(o-s),c=Zs(o-i);return o===s||o===i||n&&s===i||a>l&&u<c}function Js(t,e,r){return Math.max(e,Math.min(r,t))}function UR(t){return Js(t,-32768,32767)}function sv(t,e,r){r=r||(i=>t[i]<e);let n=t.length-1,o=0,s;for(;n-o>1;)s=o+n>>1,r(s)?o=s:n=s;return{lo:o,hi:n}}var iv=(t,e,r,n)=>sv(t,r,n?o=>{let s=t[o][e];return s<r||s===r&&t[o+1][e]===r}:o=>t[o][e]<r),HR=(t,e,r)=>sv(t,r,n=>t[n][e]>=r);function qR(t,e,r){let n=0,o=t.length;for(;n<o&&t[n]<e;)n++;for(;o>n&&t[o-1]>r;)o--;return n>0||o<t.length?t.slice(n,o):t}var NK=["push","pop","shift","splice","unshift"];function jR(t,e){if(t._chartjs){t._chartjs.listeners.push(e);return}Object.defineProperty(t,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[e]}}),NK.forEach(r=>{let n="_onData"+nv(r),o=t[r];Object.defineProperty(t,r,{configurable:!0,enumerable:!1,value(...s){let i=o.apply(this,s);return t._chartjs.listeners.forEach(a=>{typeof a[n]=="function"&&a[n](...s)}),i}})})}function hN(t,e){let r=t._chartjs;if(!r)return;let n=r.listeners,o=n.indexOf(e);o!==-1&&n.splice(o,1),!(n.length>0)&&(NK.forEach(s=>{delete t[s]}),delete t._chartjs)}function KR(t){let e=new Set,r,n;for(r=0,n=t.length;r<n;++r)e.add(t[r]);return e.size===n?t:Array.from(e)}var gN=function(){return typeof window>"u"?function(t){return t()}:window.requestAnimationFrame}();function xN(t,e){let r=!1;return function(...n){r||(r=!0,gN.call(window,()=>{r=!1,t.apply(e,n)}))}}function XR(t,e){let r;return function(...n){return e?(clearTimeout(r),r=setTimeout(t,e,n)):t.apply(this,n),e}}var YR=t=>t==="start"?"left":t==="end"?"right":"center",yN=(t,e,r)=>t==="start"?e:t==="end"?r:(e+r)/2;var nN=t=>t===0||t===1,fK=(t,e,r)=>-(Math.pow(2,10*(t-=1))*Math.sin((t-e)*ps/r)),dK=(t,e,r)=>Math.pow(2,-10*t)*Math.sin((t-e)*ps/r)+1,lN={linear:t=>t,easeInQuad:t=>t*t,easeOutQuad:t=>-t*(t-2),easeInOutQuad:t=>(t/=.5)<1?.5*t*t:-.5*(--t*(t-2)-1),easeInCubic:t=>t*t*t,easeOutCubic:t=>(t-=1)*t*t+1,easeInOutCubic:t=>(t/=.5)<1?.5*t*t*t:.5*((t-=2)*t*t+2),easeInQuart:t=>t*t*t*t,easeOutQuart:t=>-((t-=1)*t*t*t-1),easeInOutQuart:t=>(t/=.5)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2),easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>(t-=1)*t*t*t*t+1,easeInOutQuint:t=>(t/=.5)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2),easeInSine:t=>-Math.cos(t*no)+1,easeOutSine:t=>Math.sin(t*no),easeInOutSine:t=>-.5*(Math.cos(En*t)-1),easeInExpo:t=>t===0?0:Math.pow(2,10*(t-1)),easeOutExpo:t=>t===1?1:-Math.pow(2,-10*t)+1,easeInOutExpo:t=>nN(t)?t:t<.5?.5*Math.pow(2,10*(t*2-1)):.5*(-Math.pow(2,-10*(t*2-1))+2),easeInCirc:t=>t>=1?t:-(Math.sqrt(1-t*t)-1),easeOutCirc:t=>Math.sqrt(1-(t-=1)*t),easeInOutCirc:t=>(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1),easeInElastic:t=>nN(t)?t:fK(t,.075,.3),easeOutElastic:t=>nN(t)?t:dK(t,.075,.3),easeInOutElastic(t){return nN(t)?t:t<.5?.5*fK(t*2,.1125,.45):.5+.5*dK(t*2-1,.1125,.45)},easeInBack(t){return t*t*((1.70158+1)*t-1.70158)},easeOutBack(t){return(t-=1)*t*((1.70158+1)*t+1.70158)+1},easeInOutBack(t){let e=1.70158;return(t/=.5)<1?.5*(t*t*(((e*=1.525)+1)*t-e)):.5*((t-=2)*t*(((e*=1.525)+1)*t+e)+2)},easeInBounce:t=>1-lN.easeOutBounce(1-t),easeOutBounce(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},easeInOutBounce:t=>t<.5?lN.easeInBounce(t*2)*.5:lN.easeOutBounce(t*2-1)*.5+.5},bN=lN;function av(t){return t+.5|0}var pp=(t,e,r)=>Math.max(Math.min(t,r),e);function Jb(t){return pp(av(t*2.55),0,255)}function fp(t){return pp(av(t*255),0,255)}function tu(t){return pp(av(t/2.55)/100,0,1)}function mK(t){return pp(av(t*100),0,100)}var Qs={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},OR=[..."0123456789ABCDEF"],S0e=t=>OR[t&15],k0e=t=>OR[(t&240)>>4]+OR[t&15],oN=t=>(t&240)>>4===(t&15),T0e=t=>oN(t.r)&&oN(t.g)&&oN(t.b)&&oN(t.a);function N0e(t){var e=t.length,r;return t[0]==="#"&&(e===4||e===5?r={r:255&Qs[t[1]]*17,g:255&Qs[t[2]]*17,b:255&Qs[t[3]]*17,a:e===5?Qs[t[4]]*17:255}:(e===7||e===9)&&(r={r:Qs[t[1]]<<4|Qs[t[2]],g:Qs[t[3]]<<4|Qs[t[4]],b:Qs[t[5]]<<4|Qs[t[6]],a:e===9?Qs[t[7]]<<4|Qs[t[8]]:255})),r}var I0e=(t,e)=>t<255?e(t):"";function E0e(t){var e=T0e(t)?S0e:k0e;return t?"#"+e(t.r)+e(t.g)+e(t.b)+I0e(t.a,e):void 0}var _0e=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function IK(t,e,r){let n=e*Math.min(r,1-r),o=(s,i=(s+t/30)%12)=>r-n*Math.max(Math.min(i-3,9-i,1),-1);return[o(0),o(8),o(4)]}function A0e(t,e,r){let n=(o,s=(o+t/60)%6)=>r-r*e*Math.max(Math.min(s,4-s,1),0);return[n(5),n(3),n(1)]}function D0e(t,e,r){let n=IK(t,1,.5),o;for(e+r>1&&(o=1/(e+r),e*=o,r*=o),o=0;o<3;o++)n[o]*=1-e-r,n[o]+=e;return n}function $0e(t,e,r,n,o){return t===o?(e-r)/n+(e<r?6:0):e===o?(r-t)/n+2:(t-e)/n+4}function QR(t){let r=t.r/255,n=t.g/255,o=t.b/255,s=Math.max(r,n,o),i=Math.min(r,n,o),a=(s+i)/2,l,u,c;return s!==i&&(c=s-i,u=a>.5?c/(2-s-i):c/(s+i),l=$0e(r,n,o,c,s),l=l*60+.5),[l|0,u||0,a]}function ZR(t,e,r,n){return(Array.isArray(e)?t(e[0],e[1],e[2]):t(e,r,n)).map(fp)}function JR(t,e,r){return ZR(IK,t,e,r)}function R0e(t,e,r){return ZR(D0e,t,e,r)}function O0e(t,e,r){return ZR(A0e,t,e,r)}function EK(t){return(t%360+360)%360}function F0e(t){let e=_0e.exec(t),r=255,n;if(!e)return;e[5]!==n&&(r=e[6]?Jb(+e[5]):fp(+e[5]));let o=EK(+e[2]),s=+e[3]/100,i=+e[4]/100;return e[1]==="hwb"?n=R0e(o,s,i):e[1]==="hsv"?n=O0e(o,s,i):n=JR(o,s,i),{r:n[0],g:n[1],b:n[2],a:r}}function P0e(t,e){var r=QR(t);r[0]=EK(r[0]+e),r=JR(r),t.r=r[0],t.g=r[1],t.b=r[2]}function L0e(t){if(!t)return;let e=QR(t),r=e[0],n=mK(e[1]),o=mK(e[2]);return t.a<255?`hsla(${r}, ${n}%, ${o}%, ${tu(t.a)})`:`hsl(${r}, ${n}%, ${o}%)`}var hK={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},gK={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function M0e(){let t={},e=Object.keys(gK),r=Object.keys(hK),n,o,s,i,a;for(n=0;n<e.length;n++){for(i=a=e[n],o=0;o<r.length;o++)s=r[o],a=a.replace(s,hK[s]);s=parseInt(gK[i],16),t[a]=[s>>16&255,s>>8&255,s&255]}return t}var sN;function z0e(t){sN||(sN=M0e(),sN.transparent=[0,0,0,0]);let e=sN[t.toLowerCase()];return e&&{r:e[0],g:e[1],b:e[2],a:e.length===4?e[3]:255}}var B0e=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function V0e(t){let e=B0e.exec(t),r=255,n,o,s;if(!!e){if(e[7]!==n){let i=+e[7];r=e[8]?Jb(i):pp(i*255,0,255)}return n=+e[1],o=+e[3],s=+e[5],n=255&(e[2]?Jb(n):pp(n,0,255)),o=255&(e[4]?Jb(o):pp(o,0,255)),s=255&(e[6]?Jb(s):pp(s,0,255)),{r:n,g:o,b:s,a:r}}}function W0e(t){return t&&(t.a<255?`rgba(${t.r}, ${t.g}, ${t.b}, ${tu(t.a)})`:`rgb(${t.r}, ${t.g}, ${t.b})`)}var DR=t=>t<=.0031308?t*12.92:Math.pow(t,1/2.4)*1.055-.055,Gg=t=>t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4);function G0e(t,e,r){let n=Gg(tu(t.r)),o=Gg(tu(t.g)),s=Gg(tu(t.b));return{r:fp(DR(n+r*(Gg(tu(e.r))-n))),g:fp(DR(o+r*(Gg(tu(e.g))-o))),b:fp(DR(s+r*(Gg(tu(e.b))-s))),a:t.a+r*(e.a-t.a)}}function iN(t,e,r){if(t){let n=QR(t);n[e]=Math.max(0,Math.min(n[e]+n[e]*r,e===0?360:1)),n=JR(n),t.r=n[0],t.g=n[1],t.b=n[2]}}function _K(t,e){return t&&Object.assign(e||{},t)}function xK(t){var e={r:0,g:0,b:0,a:255};return Array.isArray(t)?t.length>=3&&(e={r:t[0],g:t[1],b:t[2],a:255},t.length>3&&(e.a=fp(t[3]))):(e=_K(t,{r:0,g:0,b:0,a:1}),e.a=fp(e.a)),e}function U0e(t){return t.charAt(0)==="r"?V0e(t):F0e(t)}var Ug=class{constructor(e){if(e instanceof Ug)return e;let r=typeof e,n;r==="object"?n=xK(e):r==="string"&&(n=N0e(e)||z0e(e)||U0e(e)),this._rgb=n,this._valid=!!n}get valid(){return this._valid}get rgb(){var e=_K(this._rgb);return e&&(e.a=tu(e.a)),e}set rgb(e){this._rgb=xK(e)}rgbString(){return this._valid?W0e(this._rgb):void 0}hexString(){return this._valid?E0e(this._rgb):void 0}hslString(){return this._valid?L0e(this._rgb):void 0}mix(e,r){if(e){let n=this.rgb,o=e.rgb,s,i=r===s?.5:r,a=2*i-1,l=n.a-o.a,u=((a*l===-1?a:(a+l)/(1+a*l))+1)/2;s=1-u,n.r=255&u*n.r+s*o.r+.5,n.g=255&u*n.g+s*o.g+.5,n.b=255&u*n.b+s*o.b+.5,n.a=i*n.a+(1-i)*o.a,this.rgb=n}return this}interpolate(e,r){return e&&(this._rgb=G0e(this._rgb,e._rgb,r)),this}clone(){return new Ug(this.rgb)}alpha(e){return this._rgb.a=fp(e),this}clearer(e){let r=this._rgb;return r.a*=1-e,this}greyscale(){let e=this._rgb,r=av(e.r*.3+e.g*.59+e.b*.11);return e.r=e.g=e.b=r,this}opaquer(e){let r=this._rgb;return r.a*=1+e,this}negate(){let e=this._rgb;return e.r=255-e.r,e.g=255-e.g,e.b=255-e.b,this}lighten(e){return iN(this._rgb,2,e),this}darken(e){return iN(this._rgb,2,-e),this}saturate(e){return iN(this._rgb,1,e),this}desaturate(e){return iN(this._rgb,1,-e),this}rotate(e){return P0e(this._rgb,e),this}};function AK(t){return new Ug(t)}function eO(t){if(t&&typeof t=="object"){let e=t.toString();return e==="[object CanvasPattern]"||e==="[object CanvasGradient]"}return!1}function vN(t){return eO(t)?t:AK(t)}function uN(t){return eO(t)?t:AK(t).saturate(.5).darken(.1).hexString()}var H0e=["x","y","borderWidth","radius","tension"],q0e=["color","borderColor","backgroundColor"];function j0e(t){t.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),t.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:e=>e!=="onProgress"&&e!=="onComplete"&&e!=="fn"}),t.set("animations",{colors:{type:"color",properties:q0e},numbers:{type:"number",properties:H0e}}),t.describe("animations",{_fallback:"animation"}),t.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:e=>e|0}}}})}function K0e(t){t.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}var yK=new Map;function X0e(t,e){e=e||{};let r=t+JSON.stringify(e),n=yK.get(r);return n||(n=new Intl.NumberFormat(t,e),yK.set(r,n)),n}function lv(t,e,r){return X0e(e,r).format(t)}var DK={values(t){return yr(t)?t:""+t},numeric(t,e,r){if(t===0)return"0";let n=this.chart.options.locale,o,s=t;if(r.length>1){let u=Math.max(Math.abs(r[0].value),Math.abs(r[r.length-1].value));(u<1e-4||u>1e15)&&(o="scientific"),s=Y0e(t,r)}let i=pa(Math.abs(s)),a=Math.max(Math.min(-1*Math.floor(i),20),0),l={notation:o,minimumFractionDigits:a,maximumFractionDigits:a};return Object.assign(l,this.options.ticks.format),lv(t,n,l)},logarithmic(t,e,r){if(t===0)return"0";let n=r[e].significand||t/Math.pow(10,Math.floor(pa(t)));return[1,2,3,5,10,15].includes(n)||e>.8*r.length?DK.numeric.call(this,t,e,r):""}};function Y0e(t,e){let r=e.length>3?e[2].value-e[1].value:e[1].value-e[0].value;return Math.abs(r)>=1&&t!==Math.floor(t)&&(r=t-Math.floor(t)),r}var uv={formatters:DK};function Q0e(t){t.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(e,r)=>r.lineWidth,tickColor:(e,r)=>r.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:uv.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),t.route("scale.ticks","color","","color"),t.route("scale.grid","color","","borderColor"),t.route("scale.border","color","","borderColor"),t.route("scale.title","color","","color"),t.describe("scale",{_fallback:!1,_scriptable:e=>!e.startsWith("before")&&!e.startsWith("after")&&e!=="callback"&&e!=="parser",_indexable:e=>e!=="borderDash"&&e!=="tickBorderDash"&&e!=="dash"}),t.describe("scales",{_fallback:"scale"}),t.describe("scale.ticks",{_scriptable:e=>e!=="backdropPadding"&&e!=="callback",_indexable:e=>e!=="backdropPadding"})}var mp=Object.create(null),wN=Object.create(null);function ev(t,e){if(!e)return t;let r=e.split(".");for(let n=0,o=r.length;n<o;++n){let s=r[n];t=t[s]||(t[s]=Object.create(null))}return t}function $R(t,e,r){return typeof e=="string"?pd(ev(t,e),r):pd(ev(t,""),e)}var FR=class{constructor(e,r){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=n=>n.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(n,o)=>uN(o.backgroundColor),this.hoverBorderColor=(n,o)=>uN(o.borderColor),this.hoverColor=(n,o)=>uN(o.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(e),this.apply(r)}set(e,r){return $R(this,e,r)}get(e){return ev(this,e)}describe(e,r){return $R(wN,e,r)}override(e,r){return $R(mp,e,r)}route(e,r,n,o){let s=ev(this,e),i=ev(this,n),a="_"+r;Object.defineProperties(s,{[a]:{value:s[r],writable:!0},[r]:{enumerable:!0,get(){let l=this[a],u=i[o];return dt(l)?Object.assign({},u,l):xr(l,u)},set(l){this[a]=l}}})}apply(e){e.forEach(r=>r(this))}},Wr=new FR({_scriptable:t=>!t.startsWith("on"),_indexable:t=>t!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[j0e,K0e,Q0e]);function $K(t){return!t||or(t.size)||or(t.family)?null:(t.style?t.style+" ":"")+(t.weight?t.weight+" ":"")+t.size+"px "+t.family}function Hg(t,e,r,n,o){let s=e[o];return s||(s=e[o]=t.measureText(o).width,r.push(o)),s>n&&(n=s),n}function tO(t,e,r,n){n=n||{};let o=n.data=n.data||{},s=n.garbageCollect=n.garbageCollect||[];n.font!==e&&(o=n.data={},s=n.garbageCollect=[],n.font=e),t.save(),t.font=e;let i=0,a=r.length,l,u,c,p,f;for(l=0;l<a;l++)if(p=r[l],p!=null&&yr(p)!==!0)i=Hg(t,o,s,i,p);else if(yr(p))for(u=0,c=p.length;u<c;u++)f=p[u],f!=null&&!yr(f)&&(i=Hg(t,o,s,i,f));t.restore();let d=s.length/2;if(d>r.length){for(l=0;l<d;l++)delete o[s[l]];s.splice(0,d)}return i}function ru(t,e,r){let n=t.currentDevicePixelRatio,o=r!==0?Math.max(r/2,.5):0;return Math.round((e-o)*n)/n+o}function CN(t,e){e=e||t.getContext("2d"),e.save(),e.resetTransform(),e.clearRect(0,0,t.width,t.height),e.restore()}function SN(t,e,r,n){rO(t,e,r,n,null)}function rO(t,e,r,n,o){let s,i,a,l,u,c,p,f,d=e.pointStyle,m=e.rotation,h=e.radius,x=(m||0)*TK;if(d&&typeof d=="object"&&(s=d.toString(),s==="[object HTMLImageElement]"||s==="[object HTMLCanvasElement]")){t.save(),t.translate(r,n),t.rotate(x),t.drawImage(d,-d.width/2,-d.height/2,d.width,d.height),t.restore();return}if(!(isNaN(h)||h<=0)){switch(t.beginPath(),d){default:o?t.ellipse(r,n,o/2,h,0,0,ps):t.arc(r,n,h,0,ps),t.closePath();break;case"triangle":c=o?o/2:h,t.moveTo(r+Math.sin(x)*c,n-Math.cos(x)*h),x+=RR,t.lineTo(r+Math.sin(x)*c,n-Math.cos(x)*h),x+=RR,t.lineTo(r+Math.sin(x)*c,n-Math.cos(x)*h),t.closePath();break;case"rectRounded":u=h*.516,l=h-u,i=Math.cos(x+cp)*l,p=Math.cos(x+cp)*(o?o/2-u:l),a=Math.sin(x+cp)*l,f=Math.sin(x+cp)*(o?o/2-u:l),t.arc(r-p,n-a,u,x-En,x-no),t.arc(r+f,n-i,u,x-no,x),t.arc(r+p,n+a,u,x,x+no),t.arc(r-f,n+i,u,x+no,x+En),t.closePath();break;case"rect":if(!m){l=Math.SQRT1_2*h,c=o?o/2:l,t.rect(r-c,n-l,2*c,2*l);break}x+=cp;case"rectRot":p=Math.cos(x)*(o?o/2:h),i=Math.cos(x)*h,a=Math.sin(x)*h,f=Math.sin(x)*(o?o/2:h),t.moveTo(r-p,n-a),t.lineTo(r+f,n-i),t.lineTo(r+p,n+a),t.lineTo(r-f,n+i),t.closePath();break;case"crossRot":x+=cp;case"cross":p=Math.cos(x)*(o?o/2:h),i=Math.cos(x)*h,a=Math.sin(x)*h,f=Math.sin(x)*(o?o/2:h),t.moveTo(r-p,n-a),t.lineTo(r+p,n+a),t.moveTo(r+f,n-i),t.lineTo(r-f,n+i);break;case"star":p=Math.cos(x)*(o?o/2:h),i=Math.cos(x)*h,a=Math.sin(x)*h,f=Math.sin(x)*(o?o/2:h),t.moveTo(r-p,n-a),t.lineTo(r+p,n+a),t.moveTo(r+f,n-i),t.lineTo(r-f,n+i),x+=cp,p=Math.cos(x)*(o?o/2:h),i=Math.cos(x)*h,a=Math.sin(x)*h,f=Math.sin(x)*(o?o/2:h),t.moveTo(r-p,n-a),t.lineTo(r+p,n+a),t.moveTo(r+f,n-i),t.lineTo(r-f,n+i);break;case"line":i=o?o/2:Math.cos(x)*h,a=Math.sin(x)*h,t.moveTo(r-i,n-a),t.lineTo(r+i,n+a);break;case"dash":t.moveTo(r,n),t.lineTo(r+Math.cos(x)*(o?o/2:h),n+Math.sin(x)*h);break}t.fill(),e.borderWidth>0&&t.stroke()}}function kN(t,e,r){return r=r||.5,!e||t&&t.x>e.left-r&&t.x<e.right+r&&t.y>e.top-r&&t.y<e.bottom+r}function TN(t,e){t.save(),t.beginPath(),t.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),t.clip()}function NN(t){t.restore()}function Qg(t,e,r,n,o,s={}){let i=yr(e)?e:[e],a=s.strokeWidth>0&&s.strokeColor!=="",l,u;for(t.save(),t.font=o.string,Z0e(t,s),l=0;l<i.length;++l)u=i[l],s.backdrop&&ebe(t,s.backdrop),a&&(s.strokeColor&&(t.strokeStyle=s.strokeColor),or(s.strokeWidth)||(t.lineWidth=s.strokeWidth),t.strokeText(u,r,n,s.maxWidth)),t.fillText(u,r,n,s.maxWidth),J0e(t,r,n,u,s),n+=o.lineHeight;t.restore()}function Z0e(t,e){e.translation&&t.translate(e.translation[0],e.translation[1]),or(e.rotation)||t.rotate(e.rotation),e.color&&(t.fillStyle=e.color),e.textAlign&&(t.textAlign=e.textAlign),e.textBaseline&&(t.textBaseline=e.textBaseline)}function J0e(t,e,r,n,o){if(o.strikethrough||o.underline){let s=t.measureText(n),i=e-s.actualBoundingBoxLeft,a=e+s.actualBoundingBoxRight,l=r-s.actualBoundingBoxAscent,u=r+s.actualBoundingBoxDescent,c=o.strikethrough?(l+u)/2:u;t.strokeStyle=t.fillStyle,t.beginPath(),t.lineWidth=o.decorationWidth||2,t.moveTo(i,c),t.lineTo(a,c),t.stroke()}}function ebe(t,e){let r=t.fillStyle;t.fillStyle=e.color,t.fillRect(e.left,e.top,e.width,e.height),t.fillStyle=r}function nu(t,e){let{x:r,y:n,w:o,h:s,radius:i}=e;t.arc(r+i.topLeft,n+i.topLeft,i.topLeft,-no,En,!0),t.lineTo(r,n+s-i.bottomLeft),t.arc(r+i.bottomLeft,n+s-i.bottomLeft,i.bottomLeft,En,no,!0),t.lineTo(r+o-i.bottomRight,n+s),t.arc(r+o-i.bottomRight,n+s-i.bottomRight,i.bottomRight,no,0,!0),t.lineTo(r+o,n+i.topRight),t.arc(r+o-i.topRight,n+i.topRight,i.topRight,0,-no,!0),t.lineTo(r+i.topLeft,n)}var tbe=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,rbe=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function RK(t,e){let r=(""+t).match(tbe);if(!r||r[1]==="normal")return e*1.2;switch(t=+r[2],r[3]){case"px":return t;case"%":t/=100;break}return e*t}var nbe=t=>+t||0;function IN(t,e){let r={},n=dt(e),o=n?Object.keys(e):e,s=dt(t)?n?i=>xr(t[i],t[e[i]]):i=>t[i]:()=>t;for(let i of o)r[i]=nbe(s(i));return r}function nO(t){return IN(t,{top:"y",right:"x",bottom:"y",left:"x"})}function ou(t){return IN(t,["topLeft","topRight","bottomLeft","bottomRight"])}function Vo(t){let e=nO(t);return e.width=e.left+e.right,e.height=e.top+e.bottom,e}function yo(t,e){t=t||{},e=e||Wr.font;let r=xr(t.size,e.size);typeof r=="string"&&(r=parseInt(r,10));let n=xr(t.style,e.style);n&&!(""+n).match(rbe)&&(console.warn('Invalid font style specified: "'+n+'"'),n=void 0);let o={family:xr(t.family,e.family),lineHeight:RK(xr(t.lineHeight,e.lineHeight),r),size:r,style:n,weight:xr(t.weight,e.weight),string:""};return o.string=$K(o),o}function Zg(t,e,r,n){let o=!0,s,i,a;for(s=0,i=t.length;s<i;++s)if(a=t[s],a!==void 0&&(e!==void 0&&typeof a=="function"&&(a=a(e),o=!1),r!==void 0&&yr(a)&&(a=a[r%a.length],o=!1),a!==void 0))return n&&!o&&(n.cacheable=!1),a}function oO(t,e,r){let{min:n,max:o}=t,s=LR(e,(o-n)/2),i=(a,l)=>r&&a===0?0:a+l;return{min:i(n,-Math.abs(s)),max:i(o,s)}}function su(t,e){return Object.assign(Object.create(t),e)}function cv(t,e=[""],r=t,n,o=()=>t[0]){fs(n)||(n=PK("_fallback",t));let s={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:t,_rootScopes:r,_fallback:n,_getTarget:o,override:i=>cv([i,...t],e,r,n)};return new Proxy(s,{deleteProperty(i,a){return delete i[a],delete i._keys,delete t[0][a],!0},get(i,a){return OK(i,a,()=>pbe(a,e,t,i))},getOwnPropertyDescriptor(i,a){return Reflect.getOwnPropertyDescriptor(i._scopes[0],a)},getPrototypeOf(){return Reflect.getPrototypeOf(t[0])},has(i,a){return vK(i).includes(a)},ownKeys(i){return vK(i)},set(i,a,l){let u=i._storage||(i._storage=o());return i[a]=u[a]=l,delete i._keys,!0}})}function dp(t,e,r,n){let o={_cacheable:!1,_proxy:t,_context:e,_subProxy:r,_stack:new Set,_descriptors:EN(t,n),setContext:s=>dp(t,s,r,n),override:s=>dp(t.override(s),e,r,n)};return new Proxy(o,{deleteProperty(s,i){return delete s[i],delete t[i],!0},get(s,i,a){return OK(s,i,()=>sbe(s,i,a))},getOwnPropertyDescriptor(s,i){return s._descriptors.allKeys?Reflect.has(t,i)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(t,i)},getPrototypeOf(){return Reflect.getPrototypeOf(t)},has(s,i){return Reflect.has(t,i)},ownKeys(){return Reflect.ownKeys(t)},set(s,i,a){return t[i]=a,delete s[i],!0}})}function EN(t,e={scriptable:!0,indexable:!0}){let{_scriptable:r=e.scriptable,_indexable:n=e.indexable,_allKeys:o=e.allKeys}=t;return{allKeys:o,scriptable:r,indexable:n,isScriptable:ca(r)?r:()=>r,isIndexable:ca(n)?n:()=>n}}var obe=(t,e)=>t?t+nv(e):e,sO=(t,e)=>dt(e)&&t!=="adapters"&&(Object.getPrototypeOf(e)===null||e.constructor===Object);function OK(t,e,r){if(Object.prototype.hasOwnProperty.call(t,e))return t[e];let n=r();return t[e]=n,n}function sbe(t,e,r){let{_proxy:n,_context:o,_subProxy:s,_descriptors:i}=t,a=n[e];return ca(a)&&i.isScriptable(e)&&(a=ibe(e,a,t,r)),yr(a)&&a.length&&(a=abe(e,a,t,i.isIndexable)),sO(e,a)&&(a=dp(a,o,s&&s[e],i)),a}function ibe(t,e,r,n){let{_proxy:o,_context:s,_subProxy:i,_stack:a}=r;if(a.has(t))throw new Error("Recursion detected: "+Array.from(a).join("->")+"->"+t);return a.add(t),e=e(s,i||n),a.delete(t),sO(t,e)&&(e=iO(o._scopes,o,t,e)),e}function abe(t,e,r,n){let{_proxy:o,_context:s,_subProxy:i,_descriptors:a}=r;if(fs(s.index)&&n(t))e=e[s.index%e.length];else if(dt(e[0])){let l=e,u=o._scopes.filter(c=>c!==l);e=[];for(let c of l){let p=iO(u,o,t,c);e.push(dp(p,s,i&&i[t],a))}}return e}function FK(t,e,r){return ca(t)?t(e,r):t}var lbe=(t,e)=>t===!0?e:typeof t=="string"?jg(e,t):void 0;function ube(t,e,r,n,o){for(let s of e){let i=lbe(r,s);if(i){t.add(i);let a=FK(i._fallback,r,o);if(fs(a)&&a!==r&&a!==n)return a}else if(i===!1&&fs(n)&&r!==n)return null}return!1}function iO(t,e,r,n){let o=e._rootScopes,s=FK(e._fallback,r,n),i=[...t,...o],a=new Set;a.add(n);let l=bK(a,i,r,s||r,n);return l===null||fs(s)&&s!==r&&(l=bK(a,i,s,l,n),l===null)?!1:cv(Array.from(a),[""],o,s,()=>cbe(e,r,n))}function bK(t,e,r,n,o){for(;r;)r=ube(t,e,r,n,o);return r}function cbe(t,e,r){let n=t._getTarget();e in n||(n[e]={});let o=n[e];return yr(o)&&dt(r)?r:o||{}}function pbe(t,e,r,n){let o;for(let s of e)if(o=PK(obe(s,t),r),fs(o))return sO(t,o)?iO(r,n,t,o):o}function PK(t,e){for(let r of e){if(!r)continue;let n=r[t];if(fs(n))return n}}function vK(t){let e=t._keys;return e||(e=t._keys=fbe(t._scopes)),e}function fbe(t){let e=new Set;for(let r of t)for(let n of Object.keys(r).filter(o=>!o.startsWith("_")))e.add(n);return Array.from(e)}var SQt=Number.EPSILON||1e-14;function _N(){return typeof window<"u"&&typeof document<"u"}function pv(t){let e=t.parentNode;return e&&e.toString()==="[object ShadowRoot]"&&(e=e.host),e}function cN(t,e,r){let n;return typeof t=="string"?(n=parseInt(t,10),t.indexOf("%")!==-1&&(n=n/100*e.parentNode[r])):n=t,n}var AN=t=>t.ownerDocument.defaultView.getComputedStyle(t,null);function LK(t,e){return AN(t).getPropertyValue(e)}var dbe=["top","right","bottom","left"];function cd(t,e,r){let n={};r=r?"-"+r:"";for(let o=0;o<4;o++){let s=dbe[o];n[s]=parseFloat(t[e+"-"+s+r])||0}return n.width=n.left+n.right,n.height=n.top+n.bottom,n}var mbe=(t,e,r)=>(t>0||e>0)&&(!r||!r.shadowRoot);function hbe(t,e){let r=t.touches,n=r&&r.length?r[0]:t,{offsetX:o,offsetY:s}=n,i=!1,a,l;if(mbe(o,s,t.target))a=o,l=s;else{let u=e.getBoundingClientRect();a=n.clientX-u.left,l=n.clientY-u.top,i=!0}return{x:a,y:l,box:i}}function iu(t,e){if("native"in t)return t;let{canvas:r,currentDevicePixelRatio:n}=e,o=AN(r),s=o.boxSizing==="border-box",i=cd(o,"padding"),a=cd(o,"border","width"),{x:l,y:u,box:c}=hbe(t,r),p=i.left+(c&&a.left),f=i.top+(c&&a.top),{width:d,height:m}=e;return s&&(d-=i.width+a.width,m-=i.height+a.height),{x:Math.round((l-p)/d*r.width/n),y:Math.round((u-f)/m*r.height/n)}}function gbe(t,e,r){let n,o;if(e===void 0||r===void 0){let s=pv(t);if(!s)e=t.clientWidth,r=t.clientHeight;else{let i=s.getBoundingClientRect(),a=AN(s),l=cd(a,"border","width"),u=cd(a,"padding");e=i.width-u.width-l.width,r=i.height-u.height-l.height,n=cN(a.maxWidth,s,"clientWidth"),o=cN(a.maxHeight,s,"clientHeight")}}return{width:e,height:r,maxWidth:n||rv,maxHeight:o||rv}}var aN=t=>Math.round(t*10)/10;function aO(t,e,r,n){let o=AN(t),s=cd(o,"margin"),i=cN(o.maxWidth,t,"clientWidth")||rv,a=cN(o.maxHeight,t,"clientHeight")||rv,l=gbe(t,e,r),{width:u,height:c}=l;if(o.boxSizing==="content-box"){let f=cd(o,"border","width"),d=cd(o,"padding");u-=d.width+f.width,c-=d.height+f.height}return u=Math.max(0,u-s.width),c=Math.max(0,n?Math.floor(u/n):c-s.height),u=aN(Math.min(u,i,l.maxWidth)),c=aN(Math.min(c,a,l.maxHeight)),u&&!c&&(c=aN(u/2)),(e!==void 0||r!==void 0)&&n&&l.height&&c>l.height&&(c=l.height,u=aN(Math.floor(c*n))),{width:u,height:c}}function DN(t,e,r){let n=e||1,o=Math.floor(t.height*n),s=Math.floor(t.width*n);t.height=o/n,t.width=s/n;let i=t.canvas;return i.style&&(r||!i.style.height&&!i.style.width)&&(i.style.height=`${t.height}px`,i.style.width=`${t.width}px`),t.currentDevicePixelRatio!==n||i.height!==o||i.width!==s?(t.currentDevicePixelRatio=n,i.height=o,i.width=s,t.ctx.setTransform(n,0,0,n,0,0),!0):!1}var lO=function(){let t=!1;try{let e={get passive(){return t=!0,!1}};window.addEventListener("test",null,e),window.removeEventListener("test",null,e)}catch{}return t}();function $N(t,e){let r=LK(t,e),n=r&&r.match(/^(\d+)(\.\d+)?px$/);return n?+n[1]:void 0}var xbe=function(t,e){return{x(r){return t+t+e-r},setWidth(r){e=r},textAlign(r){return r==="center"?r:r==="right"?"left":"right"},xPlus(r,n){return r-n},leftForLtr(r,n){return r-n}}},ybe=function(){return{x(t){return t},setWidth(t){},textAlign(t){return t},xPlus(t,e){return t+e},leftForLtr(t,e){return t}}};function fv(t,e,r){return t?xbe(e,r):ybe()}function uO(t,e){let r,n;(e==="ltr"||e==="rtl")&&(r=t.canvas.style,n=[r.getPropertyValue("direction"),r.getPropertyPriority("direction")],r.setProperty("direction",e,"important"),t.prevTextDirection=n)}function cO(t,e){e!==void 0&&(delete t.prevTextDirection,t.canvas.style.setProperty("direction",e[0],e[1]))}var gO=class{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(e,r,n,o){let s=r.listeners[o],i=r.duration;s.forEach(a=>a({chart:e,initial:r.initial,numSteps:i,currentStep:Math.min(n-r.start,i)}))}_refresh(){this._request||(this._running=!0,this._request=gN.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(e=Date.now()){let r=0;this._charts.forEach((n,o)=>{if(!n.running||!n.items.length)return;let s=n.items,i=s.length-1,a=!1,l;for(;i>=0;--i)l=s[i],l._active?(l._total>n.duration&&(n.duration=l._total),l.tick(e),a=!0):(s[i]=s[s.length-1],s.pop());a&&(o.draw(),this._notify(o,n,e,"progress")),s.length||(n.running=!1,this._notify(o,n,e,"complete"),n.initial=!1),r+=s.length}),this._lastDate=e,r===0&&(this._running=!1)}_getAnims(e){let r=this._charts,n=r.get(e);return n||(n={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},r.set(e,n)),n}listen(e,r,n){this._getAnims(e).listeners[r].push(n)}add(e,r){!r||!r.length||this._getAnims(e).items.push(...r)}has(e){return this._getAnims(e).items.length>0}start(e){let r=this._charts.get(e);!r||(r.running=!0,r.start=Date.now(),r.duration=r.items.reduce((n,o)=>Math.max(n,o._duration),0),this._refresh())}running(e){if(!this._running)return!1;let r=this._charts.get(e);return!(!r||!r.running||!r.items.length)}stop(e){let r=this._charts.get(e);if(!r||!r.items.length)return;let n=r.items,o=n.length-1;for(;o>=0;--o)n[o].cancel();r.items=[],this._notify(e,r,Date.now(),"complete")}remove(e){return this._charts.delete(e)}},au=new gO,MK="transparent",Obe={boolean(t,e,r){return r>.5?e:t},color(t,e,r){let n=vN(t||MK),o=n.valid&&vN(e||MK);return o&&o.valid?o.mix(n,r).hexString():e},number(t,e,r){return t+(e-t)*r}},xO=class{constructor(e,r,n,o){let s=r[n];o=Zg([e.to,o,s,e.from]);let i=Zg([e.from,s,o]);this._active=!0,this._fn=e.fn||Obe[e.type||typeof i],this._easing=bN[e.easing]||bN.linear,this._start=Math.floor(Date.now()+(e.delay||0)),this._duration=this._total=Math.floor(e.duration),this._loop=!!e.loop,this._target=r,this._prop=n,this._from=i,this._to=o,this._promises=void 0}active(){return this._active}update(e,r,n){if(this._active){this._notify(!1);let o=this._target[this._prop],s=n-this._start,i=this._duration-s;this._start=n,this._duration=Math.floor(Math.max(i,e.duration)),this._total+=s,this._loop=!!e.loop,this._to=Zg([e.to,r,o,e.from]),this._from=Zg([e.from,o,r])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(e){let r=e-this._start,n=this._duration,o=this._prop,s=this._from,i=this._loop,a=this._to,l;if(this._active=s!==a&&(i||r<n),!this._active){this._target[o]=a,this._notify(!0);return}if(r<0){this._target[o]=s;return}l=r/n%2,l=i&&l>1?2-l:l,l=this._easing(Math.min(1,Math.max(0,l))),this._target[o]=this._fn(s,a,l)}wait(){let e=this._promises||(this._promises=[]);return new Promise((r,n)=>{e.push({res:r,rej:n})})}_notify(e){let r=e?"res":"rej",n=this._promises||[];for(let o=0;o<n.length;o++)n[o][r]()}},GN=class{constructor(e,r){this._chart=e,this._properties=new Map,this.configure(r)}configure(e){if(!dt(e))return;let r=Object.keys(Wr.animation),n=this._properties;Object.getOwnPropertyNames(e).forEach(o=>{let s=e[o];if(!dt(s))return;let i={};for(let a of r)i[a]=s[a];(yr(s.properties)&&s.properties||[o]).forEach(a=>{(a===o||!n.has(a))&&n.set(a,i)})})}_animateOptions(e,r){let n=r.options,o=Pbe(e,n);if(!o)return[];let s=this._createAnimations(o,n);return n.$shared&&Fbe(e.options.$animations,n).then(()=>{e.options=n},()=>{}),s}_createAnimations(e,r){let n=this._properties,o=[],s=e.$animations||(e.$animations={}),i=Object.keys(r),a=Date.now(),l;for(l=i.length-1;l>=0;--l){let u=i[l];if(u.charAt(0)==="$")continue;if(u==="options"){o.push(...this._animateOptions(e,r));continue}let c=r[u],p=s[u],f=n.get(u);if(p)if(f&&p.active()){p.update(f,c,a);continue}else p.cancel();if(!f||!f.duration){e[u]=c;continue}s[u]=p=new xO(f,e,u,c),o.push(p)}return o}update(e,r){if(this._properties.size===0){Object.assign(e,r);return}let n=this._createAnimations(e,r);if(n.length)return au.add(this._chart,n),!0}};function Fbe(t,e){let r=[],n=Object.keys(e);for(let o=0;o<n.length;o++){let s=t[n[o]];s&&s.active()&&r.push(s.wait())}return Promise.all(r)}function Pbe(t,e){if(!e)return;let r=t.options;if(!r){t.options=e;return}return r.$shared&&(t.options=r=Object.assign({},r,{$shared:!1,$animations:{}})),r}function zK(t,e){let r=t&&t.options||{},n=r.reverse,o=r.min===void 0?e:0,s=r.max===void 0?e:0;return{start:n?s:o,end:n?o:s}}function Lbe(t,e,r){if(r===!1)return!1;let n=zK(t,r),o=zK(e,r);return{top:o.end,right:n.end,bottom:o.start,left:n.start}}function Mbe(t){let e,r,n,o;return dt(t)?(e=t.top,r=t.right,n=t.bottom,o=t.left):e=r=n=o=t,{top:e,right:r,bottom:n,left:o,disabled:t===!1}}function wX(t,e){let r=[],n=t._getSortedDatasetMetas(e),o,s;for(o=0,s=n.length;o<s;++o)r.push(n[o].index);return r}function BK(t,e,r,n={}){let o=t.keys,s=n.mode==="single",i,a,l,u;if(e!==null){for(i=0,a=o.length;i<a;++i){if(l=+o[i],l===r){if(n.all)continue;break}u=t.values[l],Zr(u)&&(s||e===0||Kg(e)===Kg(u))&&(e+=u)}return e}}function zbe(t){let e=Object.keys(t),r=new Array(e.length),n,o,s;for(n=0,o=e.length;n<o;++n)s=e[n],r[n]={x:s,y:t[s]};return r}function VK(t,e){let r=t&&t.options.stacked;return r||r===void 0&&e.stack!==void 0}function Bbe(t,e,r){return`${t.id}.${e.id}.${r.stack||r.type}`}function Vbe(t){let{min:e,max:r,minDefined:n,maxDefined:o}=t.getUserBounds();return{min:n?e:Number.NEGATIVE_INFINITY,max:o?r:Number.POSITIVE_INFINITY}}function Wbe(t,e,r){let n=t[e]||(t[e]={});return n[r]||(n[r]={})}function WK(t,e,r,n){for(let o of e.getMatchingVisibleMetas(n).reverse()){let s=t[o.index];if(r&&s>0||!r&&s<0)return o.index}return null}function GK(t,e){let{chart:r,_cachedMeta:n}=t,o=r._stacks||(r._stacks={}),{iScale:s,vScale:i,index:a}=n,l=s.axis,u=i.axis,c=Bbe(s,i,n),p=e.length,f;for(let d=0;d<p;++d){let m=e[d],{[l]:h,[u]:x}=m,g=m._stacks||(m._stacks={});f=g[u]=Wbe(o,c,h),f[a]=x,f._top=WK(f,i,!0,n.type),f._bottom=WK(f,i,!1,n.type)}}function pO(t,e){let r=t.scales;return Object.keys(r).filter(n=>r[n].axis===e).shift()}function Gbe(t,e){return su(t,{active:!1,dataset:void 0,datasetIndex:e,index:e,mode:"default",type:"dataset"})}function Ube(t,e,r){return su(t,{active:!1,dataIndex:e,parsed:void 0,raw:void 0,element:r,index:e,mode:"default",type:"data"})}function dv(t,e){let r=t.controller.index,n=t.vScale&&t.vScale.axis;if(!!n){e=e||t._parsed;for(let o of e){let s=o._stacks;if(!s||s[n]===void 0||s[n][r]===void 0)return;delete s[n][r]}}}var fO=t=>t==="reset"||t==="none",UK=(t,e)=>e?t:Object.assign({},t),Hbe=(t,e,r)=>t&&!e.hidden&&e._stacked&&{keys:wX(r,!0),values:null},hp=class{constructor(e,r){this.chart=e,this._ctx=e.ctx,this.index=r,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){let e=this._cachedMeta;this.configure(),this.linkScales(),e._stacked=VK(e.vScale,e),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(e){this.index!==e&&dv(this._cachedMeta),this.index=e}linkScales(){let e=this.chart,r=this._cachedMeta,n=this.getDataset(),o=(p,f,d,m)=>p==="x"?f:p==="r"?m:d,s=r.xAxisID=xr(n.xAxisID,pO(e,"x")),i=r.yAxisID=xr(n.yAxisID,pO(e,"y")),a=r.rAxisID=xr(n.rAxisID,pO(e,"r")),l=r.indexAxis,u=r.iAxisID=o(l,s,i,a),c=r.vAxisID=o(l,i,s,a);r.xScale=this.getScaleForId(s),r.yScale=this.getScaleForId(i),r.rScale=this.getScaleForId(a),r.iScale=this.getScaleForId(u),r.vScale=this.getScaleForId(c)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(e){return this.chart.scales[e]}_getOtherScale(e){let r=this._cachedMeta;return e===r.iScale?r.vScale:r.iScale}reset(){this._update("reset")}_destroy(){let e=this._cachedMeta;this._data&&hN(this._data,this),e._stacked&&dv(e)}_dataCheck(){let e=this.getDataset(),r=e.data||(e.data=[]),n=this._data;if(dt(r))this._data=zbe(r);else if(n!==r){if(n){hN(n,this);let o=this._cachedMeta;dv(o),o._parsed=[]}r&&Object.isExtensible(r)&&jR(r,this),this._syncList=[],this._data=r}}addElements(){let e=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(e.dataset=new this.datasetElementType)}buildOrUpdateElements(e){let r=this._cachedMeta,n=this.getDataset(),o=!1;this._dataCheck();let s=r._stacked;r._stacked=VK(r.vScale,r),r.stack!==n.stack&&(o=!0,dv(r),r.stack=n.stack),this._resyncElements(e),(o||s!==r._stacked)&&GK(this,r._parsed)}configure(){let e=this.chart.config,r=e.datasetScopeKeys(this._type),n=e.getOptionScopes(this.getDataset(),r,!0);this.options=e.createResolver(n,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(e,r){let{_cachedMeta:n,_data:o}=this,{iScale:s,_stacked:i}=n,a=s.axis,l=e===0&&r===o.length?!0:n._sorted,u=e>0&&n._parsed[e-1],c,p,f;if(this._parsing===!1)n._parsed=o,n._sorted=!0,f=o;else{yr(o[e])?f=this.parseArrayData(n,o,e,r):dt(o[e])?f=this.parseObjectData(n,o,e,r):f=this.parsePrimitiveData(n,o,e,r);let d=()=>p[a]===null||u&&p[a]<u[a];for(c=0;c<r;++c)n._parsed[c+e]=p=f[c],l&&(d()&&(l=!1),u=p);n._sorted=l}i&&GK(this,f)}parsePrimitiveData(e,r,n,o){let{iScale:s,vScale:i}=e,a=s.axis,l=i.axis,u=s.getLabels(),c=s===i,p=new Array(o),f,d,m;for(f=0,d=o;f<d;++f)m=f+n,p[f]={[a]:c||s.parse(u[m],m),[l]:i.parse(r[m],m)};return p}parseArrayData(e,r,n,o){let{xScale:s,yScale:i}=e,a=new Array(o),l,u,c,p;for(l=0,u=o;l<u;++l)c=l+n,p=r[c],a[l]={x:s.parse(p[0],c),y:i.parse(p[1],c)};return a}parseObjectData(e,r,n,o){let{xScale:s,yScale:i}=e,{xAxisKey:a="x",yAxisKey:l="y"}=this._parsing,u=new Array(o),c,p,f,d;for(c=0,p=o;c<p;++c)f=c+n,d=r[f],u[c]={x:s.parse(jg(d,a),f),y:i.parse(jg(d,l),f)};return u}getParsed(e){return this._cachedMeta._parsed[e]}getDataElement(e){return this._cachedMeta.data[e]}applyStack(e,r,n){let o=this.chart,s=this._cachedMeta,i=r[e.axis],a={keys:wX(o,!0),values:r._stacks[e.axis]};return BK(a,i,s.index,{mode:n})}updateRangeFromParsed(e,r,n,o){let s=n[r.axis],i=s===null?NaN:s,a=o&&n._stacks[r.axis];o&&a&&(o.values=a,i=BK(o,s,this._cachedMeta.index)),e.min=Math.min(e.min,i),e.max=Math.max(e.max,i)}getMinMax(e,r){let n=this._cachedMeta,o=n._parsed,s=n._sorted&&e===n.iScale,i=o.length,a=this._getOtherScale(e),l=Hbe(r,n,this.chart),u={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:c,max:p}=Vbe(a),f,d;function m(){d=o[f];let h=d[a.axis];return!Zr(d[e.axis])||c>h||p<h}for(f=0;f<i&&!(!m()&&(this.updateRangeFromParsed(u,e,d,l),s));++f);if(s){for(f=i-1;f>=0;--f)if(!m()){this.updateRangeFromParsed(u,e,d,l);break}}return u}getAllParsedValues(e){let r=this._cachedMeta._parsed,n=[],o,s,i;for(o=0,s=r.length;o<s;++o)i=r[o][e.axis],Zr(i)&&n.push(i);return n}getMaxOverflow(){return!1}getLabelAndValue(e){let r=this._cachedMeta,n=r.iScale,o=r.vScale,s=this.getParsed(e);return{label:n?""+n.getLabelForValue(s[n.axis]):"",value:o?""+o.getLabelForValue(s[o.axis]):""}}_update(e){let r=this._cachedMeta;this.update(e||"default"),r._clip=Mbe(xr(this.options.clip,Lbe(r.xScale,r.yScale,this.getMaxOverflow())))}update(e){}draw(){let e=this._ctx,r=this.chart,n=this._cachedMeta,o=n.data||[],s=r.chartArea,i=[],a=this._drawStart||0,l=this._drawCount||o.length-a,u=this.options.drawActiveElementsOnTop,c;for(n.dataset&&n.dataset.draw(e,s,a,l),c=a;c<a+l;++c){let p=o[c];p.hidden||(p.active&&u?i.push(p):p.draw(e,s))}for(c=0;c<i.length;++c)i[c].draw(e,s)}getStyle(e,r){let n=r?"active":"default";return e===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(n):this.resolveDataElementOptions(e||0,n)}getContext(e,r,n){let o=this.getDataset(),s;if(e>=0&&e<this._cachedMeta.data.length){let i=this._cachedMeta.data[e];s=i.$context||(i.$context=Ube(this.getContext(),e,i)),s.parsed=this.getParsed(e),s.raw=o.data[e],s.index=s.dataIndex=e}else s=this.$context||(this.$context=Gbe(this.chart.getContext(),this.index)),s.dataset=o,s.index=s.datasetIndex=this.index;return s.active=!!r,s.mode=n,s}resolveDatasetElementOptions(e){return this._resolveElementOptions(this.datasetElementType.id,e)}resolveDataElementOptions(e,r){return this._resolveElementOptions(this.dataElementType.id,r,e)}_resolveElementOptions(e,r="default",n){let o=r==="active",s=this._cachedDataOpts,i=e+"-"+r,a=s[i],l=this.enableOptionSharing&&fs(n);if(a)return UK(a,l);let u=this.chart.config,c=u.datasetElementScopeKeys(this._type,e),p=o?[`${e}Hover`,"hover",e,""]:[e,""],f=u.getOptionScopes(this.getDataset(),c),d=Object.keys(Wr.elements[e]),m=()=>this.getContext(n,o),h=u.resolveNamedOptions(f,d,m,p);return h.$shared&&(h.$shared=l,s[i]=Object.freeze(UK(h,l))),h}_resolveAnimations(e,r,n){let o=this.chart,s=this._cachedDataOpts,i=`animation-${r}`,a=s[i];if(a)return a;let l;if(o.options.animation!==!1){let c=this.chart.config,p=c.datasetAnimationScopeKeys(this._type,r),f=c.getOptionScopes(this.getDataset(),p);l=c.createResolver(f,this.getContext(e,n,r))}let u=new GN(o,l&&l.animations);return l&&l._cacheable&&(s[i]=Object.freeze(u)),u}getSharedOptions(e){if(!!e.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},e))}includeOptions(e,r){return!r||fO(e)||this.chart._animationsDisabled}_getSharedOptions(e,r){let n=this.resolveDataElementOptions(e,r),o=this._sharedOptions,s=this.getSharedOptions(n),i=this.includeOptions(r,s)||s!==o;return this.updateSharedOptions(s,r,n),{sharedOptions:s,includeOptions:i}}updateElement(e,r,n,o){fO(o)?Object.assign(e,n):this._resolveAnimations(r,o).update(e,n)}updateSharedOptions(e,r,n){e&&!fO(r)&&this._resolveAnimations(void 0,r).update(e,n)}_setStyle(e,r,n,o){e.active=o;let s=this.getStyle(r,o);this._resolveAnimations(r,n,o).update(e,{options:!o&&this.getSharedOptions(s)||s})}removeHoverStyle(e,r,n){this._setStyle(e,n,"active",!1)}setHoverStyle(e,r,n){this._setStyle(e,n,"active",!0)}_removeDatasetHoverStyle(){let e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!1)}_setDatasetHoverStyle(){let e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!0)}_resyncElements(e){let r=this._data,n=this._cachedMeta.data;for(let[a,l,u]of this._syncList)this[a](l,u);this._syncList=[];let o=n.length,s=r.length,i=Math.min(s,o);i&&this.parse(0,i),s>o?this._insertElements(o,s-o,e):s<o&&this._removeElements(s,o-s)}_insertElements(e,r,n=!0){let o=this._cachedMeta,s=o.data,i=e+r,a,l=u=>{for(u.length+=r,a=u.length-1;a>=i;a--)u[a]=u[a-r]};for(l(s),a=e;a<i;++a)s[a]=new this.dataElementType;this._parsing&&l(o._parsed),this.parse(e,r),n&&this.updateElements(s,e,r,"reset")}updateElements(e,r,n,o){}_removeElements(e,r){let n=this._cachedMeta;if(this._parsing){let o=n._parsed.splice(e,r);n._stacked&&dv(n,o)}n.data.splice(e,r)}_sync(e){if(this._parsing)this._syncList.push(e);else{let[r,n,o]=e;this[r](n,o)}this.chart._dataChanges.push([this.index,...e])}_onDataPush(){let e=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-e,e])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(e,r){r&&this._sync(["_removeElements",e,r]);let n=arguments.length-2;n&&this._sync(["_insertElements",e,n])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}};Bt(hp,"defaults",{}),Bt(hp,"datasetElementType",null),Bt(hp,"dataElementType",null);function dd(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}var wv=class{static override(e){Object.assign(wv.prototype,e)}constructor(e){this.options=e||{}}init(){}formats(){return dd()}parse(){return dd()}format(){return dd()}add(){return dd()}diff(){return dd()}startOf(){return dd()}endOf(){return dd()}},qbe={_date:wv};function jbe(t,e,r,n){let{controller:o,data:s,_sorted:i}=t,a=o._cachedMeta.iScale;if(a&&e===a.axis&&e!=="r"&&i&&s.length){let l=a._reversePixels?HR:iv;if(n){if(o._sharedOptions){let u=s[0],c=typeof u.getRange=="function"&&u.getRange(e);if(c){let p=l(s,e,r-c),f=l(s,e,r+c);return{lo:p.lo,hi:f.hi}}}}else return l(s,e,r)}return{lo:0,hi:s.length-1}}function kv(t,e,r,n,o){let s=t.getSortedVisibleDatasetMetas(),i=r[e];for(let a=0,l=s.length;a<l;++a){let{index:u,data:c}=s[a],{lo:p,hi:f}=jbe(s[a],e,i,o);for(let d=p;d<=f;++d){let m=c[d];m.skip||n(m,u,d)}}}function Kbe(t){let e=t.indexOf("x")!==-1,r=t.indexOf("y")!==-1;return function(n,o){let s=e?Math.abs(n.x-o.x):0,i=r?Math.abs(n.y-o.y):0;return Math.sqrt(Math.pow(s,2)+Math.pow(i,2))}}function dO(t,e,r,n,o){let s=[];return!o&&!t.isPointInArea(e)||kv(t,r,e,function(a,l,u){!o&&!kN(a,t.chartArea,0)||a.inRange(e.x,e.y,n)&&s.push({element:a,datasetIndex:l,index:u})},!0),s}function Xbe(t,e,r,n){let o=[];function s(i,a,l){let{startAngle:u,endAngle:c}=i.getProps(["startAngle","endAngle"],n),{angle:p}=VR(i,{x:e.x,y:e.y});GR(p,u,c)&&o.push({element:i,datasetIndex:a,index:l})}return kv(t,r,e,s),o}function Ybe(t,e,r,n,o,s){let i=[],a=Kbe(r),l=Number.POSITIVE_INFINITY;function u(c,p,f){let d=c.inRange(e.x,e.y,o);if(n&&!d)return;let m=c.getCenterPoint(o);if(!(!!s||t.isPointInArea(m))&&!d)return;let x=a(e,m);x<l?(i=[{element:c,datasetIndex:p,index:f}],l=x):x===l&&i.push({element:c,datasetIndex:p,index:f})}return kv(t,r,e,u),i}function mO(t,e,r,n,o,s){return!s&&!t.isPointInArea(e)?[]:r==="r"&&!n?Xbe(t,e,r,o):Ybe(t,e,r,n,o,s)}function HK(t,e,r,n,o){let s=[],i=r==="x"?"inXRange":"inYRange",a=!1;return kv(t,r,e,(l,u,c)=>{l[i](e[r],o)&&(s.push({element:l,datasetIndex:u,index:c}),a=a||l.inRange(e.x,e.y,o))}),n&&!a?[]:s}var Qbe={evaluateInteractionItems:kv,modes:{index(t,e,r,n){let o=iu(e,t),s=r.axis||"x",i=r.includeInvisible||!1,a=r.intersect?dO(t,o,s,n,i):mO(t,o,s,!1,n,i),l=[];return a.length?(t.getSortedVisibleDatasetMetas().forEach(u=>{let c=a[0].index,p=u.data[c];p&&!p.skip&&l.push({element:p,datasetIndex:u.index,index:c})}),l):[]},dataset(t,e,r,n){let o=iu(e,t),s=r.axis||"xy",i=r.includeInvisible||!1,a=r.intersect?dO(t,o,s,n,i):mO(t,o,s,!1,n,i);if(a.length>0){let l=a[0].datasetIndex,u=t.getDatasetMeta(l).data;a=[];for(let c=0;c<u.length;++c)a.push({element:u[c],datasetIndex:l,index:c})}return a},point(t,e,r,n){let o=iu(e,t),s=r.axis||"xy",i=r.includeInvisible||!1;return dO(t,o,s,n,i)},nearest(t,e,r,n){let o=iu(e,t),s=r.axis||"xy",i=r.includeInvisible||!1;return mO(t,o,s,r.intersect,n,i)},x(t,e,r,n){let o=iu(e,t);return HK(t,o,"x",r.intersect,n)},y(t,e,r,n){let o=iu(e,t);return HK(t,o,"y",r.intersect,n)}}},CX=["left","top","right","bottom"];function mv(t,e){return t.filter(r=>r.pos===e)}function qK(t,e){return t.filter(r=>CX.indexOf(r.pos)===-1&&r.box.axis===e)}function hv(t,e){return t.sort((r,n)=>{let o=e?n:r,s=e?r:n;return o.weight===s.weight?o.index-s.index:o.weight-s.weight})}function Zbe(t){let e=[],r,n,o,s,i,a;for(r=0,n=(t||[]).length;r<n;++r)o=t[r],{position:s,options:{stack:i,stackWeight:a=1}}=o,e.push({index:r,box:o,pos:s,horizontal:o.isHorizontal(),weight:o.weight,stack:i&&s+i,stackWeight:a});return e}function Jbe(t){let e={};for(let r of t){let{stack:n,pos:o,stackWeight:s}=r;if(!n||!CX.includes(o))continue;let i=e[n]||(e[n]={count:0,placed:0,weight:0,size:0});i.count++,i.weight+=s}return e}function eve(t,e){let r=Jbe(t),{vBoxMaxWidth:n,hBoxMaxHeight:o}=e,s,i,a;for(s=0,i=t.length;s<i;++s){a=t[s];let{fullSize:l}=a.box,u=r[a.stack],c=u&&a.stackWeight/u.weight;a.horizontal?(a.width=c?c*n:l&&e.availableWidth,a.height=o):(a.width=n,a.height=c?c*o:l&&e.availableHeight)}return r}function tve(t){let e=Zbe(t),r=hv(e.filter(u=>u.box.fullSize),!0),n=hv(mv(e,"left"),!0),o=hv(mv(e,"right")),s=hv(mv(e,"top"),!0),i=hv(mv(e,"bottom")),a=qK(e,"x"),l=qK(e,"y");return{fullSize:r,leftAndTop:n.concat(s),rightAndBottom:o.concat(l).concat(i).concat(a),chartArea:mv(e,"chartArea"),vertical:n.concat(o).concat(l),horizontal:s.concat(i).concat(a)}}function jK(t,e,r,n){return Math.max(t[r],e[r])+Math.max(t[n],e[n])}function SX(t,e){t.top=Math.max(t.top,e.top),t.left=Math.max(t.left,e.left),t.bottom=Math.max(t.bottom,e.bottom),t.right=Math.max(t.right,e.right)}function rve(t,e,r,n){let{pos:o,box:s}=r,i=t.maxPadding;if(!dt(o)){r.size&&(t[o]-=r.size);let p=n[r.stack]||{size:0,count:1};p.size=Math.max(p.size,r.horizontal?s.height:s.width),r.size=p.size/p.count,t[o]+=r.size}s.getPadding&&SX(i,s.getPadding());let a=Math.max(0,e.outerWidth-jK(i,t,"left","right")),l=Math.max(0,e.outerHeight-jK(i,t,"top","bottom")),u=a!==t.w,c=l!==t.h;return t.w=a,t.h=l,r.horizontal?{same:u,other:c}:{same:c,other:u}}function nve(t){let e=t.maxPadding;function r(n){let o=Math.max(e[n]-t[n],0);return t[n]+=o,o}t.y+=r("top"),t.x+=r("left"),r("right"),r("bottom")}function ove(t,e){let r=e.maxPadding;function n(o){let s={left:0,top:0,right:0,bottom:0};return o.forEach(i=>{s[i]=Math.max(e[i],r[i])}),s}return n(t?["left","right"]:["top","bottom"])}function yv(t,e,r,n){let o=[],s,i,a,l,u,c;for(s=0,i=t.length,u=0;s<i;++s){a=t[s],l=a.box,l.update(a.width||e.w,a.height||e.h,ove(a.horizontal,e));let{same:p,other:f}=rve(e,r,a,n);u|=p&&o.length,c=c||f,l.fullSize||o.push(a)}return u&&yv(o,e,r,n)||c}function RN(t,e,r,n,o){t.top=r,t.left=e,t.right=e+n,t.bottom=r+o,t.width=n,t.height=o}function KK(t,e,r,n){let o=r.padding,{x:s,y:i}=e;for(let a of t){let l=a.box,u=n[a.stack]||{count:1,placed:0,weight:1},c=a.stackWeight/u.weight||1;if(a.horizontal){let p=e.w*c,f=u.size||l.height;fs(u.start)&&(i=u.start),l.fullSize?RN(l,o.left,i,r.outerWidth-o.right-o.left,f):RN(l,e.left+u.placed,i,p,f),u.start=i,u.placed+=p,i=l.bottom}else{let p=e.h*c,f=u.size||l.width;fs(u.start)&&(s=u.start),l.fullSize?RN(l,s,o.top,f,r.outerHeight-o.bottom-o.top):RN(l,s,e.top+u.placed,f,p),u.start=s,u.placed+=p,s=l.right}}e.x=s,e.y=i}var ON={addBox(t,e){t.boxes||(t.boxes=[]),e.fullSize=e.fullSize||!1,e.position=e.position||"top",e.weight=e.weight||0,e._layers=e._layers||function(){return[{z:0,draw(r){e.draw(r)}}]},t.boxes.push(e)},removeBox(t,e){let r=t.boxes?t.boxes.indexOf(e):-1;r!==-1&&t.boxes.splice(r,1)},configure(t,e,r){e.fullSize=r.fullSize,e.position=r.position,e.weight=r.weight},update(t,e,r,n){if(!t)return;let o=Vo(t.options.layout.padding),s=Math.max(e-o.width,0),i=Math.max(r-o.height,0),a=tve(t.boxes),l=a.vertical,u=a.horizontal;At(t.boxes,h=>{typeof h.beforeLayout=="function"&&h.beforeLayout()});let c=l.reduce((h,x)=>x.box.options&&x.box.options.display===!1?h:h+1,0)||1,p=Object.freeze({outerWidth:e,outerHeight:r,padding:o,availableWidth:s,availableHeight:i,vBoxMaxWidth:s/2/c,hBoxMaxHeight:i/2}),f=Object.assign({},o);SX(f,Vo(n));let d=Object.assign({maxPadding:f,w:s,h:i,x:o.left,y:o.top},o),m=eve(l.concat(u),p);yv(a.fullSize,d,p,m),yv(l,d,p,m),yv(u,d,p,m)&&yv(l,d,p,m),nve(d),KK(a.leftAndTop,d,p,m),d.x+=d.w,d.y+=d.h,KK(a.rightAndBottom,d,p,m),t.chartArea={left:d.left,top:d.top,right:d.left+d.w,bottom:d.top+d.h,height:d.h,width:d.w},At(a.chartArea,h=>{let x=h.box;Object.assign(x,t.chartArea),x.update(d.w,d.h,{left:0,top:0,right:0,bottom:0})})}},UN=class{acquireContext(e,r){}releaseContext(e){return!1}addEventListener(e,r,n){}removeEventListener(e,r,n){}getDevicePixelRatio(){return 1}getMaximumSize(e,r,n,o){return r=Math.max(0,r||e.width),n=n||e.height,{width:r,height:Math.max(0,o?Math.floor(r/o):n)}}isAttached(e){return!0}updateConfig(e){}},yO=class extends UN{acquireContext(e){return e&&e.getContext&&e.getContext("2d")||null}updateConfig(e){e.options.animation=!1}},VN="$chartjs",sve={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},XK=t=>t===null||t==="";function ive(t,e){let r=t.style,n=t.getAttribute("height"),o=t.getAttribute("width");if(t[VN]={initial:{height:n,width:o,style:{display:r.display,height:r.height,width:r.width}}},r.display=r.display||"block",r.boxSizing=r.boxSizing||"border-box",XK(o)){let s=$N(t,"width");s!==void 0&&(t.width=s)}if(XK(n))if(t.style.height==="")t.height=t.width/(e||2);else{let s=$N(t,"height");s!==void 0&&(t.height=s)}return t}var kX=lO?{passive:!0}:!1;function ave(t,e,r){t.addEventListener(e,r,kX)}function lve(t,e,r){t.canvas.removeEventListener(e,r,kX)}function uve(t,e){let r=sve[t.type]||t.type,{x:n,y:o}=iu(t,e);return{type:r,chart:e,native:t,x:n!==void 0?n:null,y:o!==void 0?o:null}}function HN(t,e){for(let r of t)if(r===e||r.contains(e))return!0}function cve(t,e,r){let n=t.canvas,o=new MutationObserver(s=>{let i=!1;for(let a of s)i=i||HN(a.addedNodes,n),i=i&&!HN(a.removedNodes,n);i&&r()});return o.observe(document,{childList:!0,subtree:!0}),o}function pve(t,e,r){let n=t.canvas,o=new MutationObserver(s=>{let i=!1;for(let a of s)i=i||HN(a.removedNodes,n),i=i&&!HN(a.addedNodes,n);i&&r()});return o.observe(document,{childList:!0,subtree:!0}),o}var Cv=new Map,YK=0;function TX(){let t=window.devicePixelRatio;t!==YK&&(YK=t,Cv.forEach((e,r)=>{r.currentDevicePixelRatio!==t&&e()}))}function fve(t,e){Cv.size||window.addEventListener("resize",TX),Cv.set(t,e)}function dve(t){Cv.delete(t),Cv.size||window.removeEventListener("resize",TX)}function mve(t,e,r){let n=t.canvas,o=n&&pv(n);if(!o)return;let s=xN((a,l)=>{let u=o.clientWidth;r(a,l),u<o.clientWidth&&r()},window),i=new ResizeObserver(a=>{let l=a[0],u=l.contentRect.width,c=l.contentRect.height;u===0&&c===0||s(u,c)});return i.observe(o),fve(t,s),i}function hO(t,e,r){r&&r.disconnect(),e==="resize"&&dve(t)}function hve(t,e,r){let n=t.canvas,o=xN(s=>{t.ctx!==null&&r(uve(s,t))},t);return ave(n,e,o),o}var bO=class extends UN{acquireContext(e,r){let n=e&&e.getContext&&e.getContext("2d");return n&&n.canvas===e?(ive(e,r),n):null}releaseContext(e){let r=e.canvas;if(!r[VN])return!1;let n=r[VN].initial;["height","width"].forEach(s=>{let i=n[s];or(i)?r.removeAttribute(s):r.setAttribute(s,i)});let o=n.style||{};return Object.keys(o).forEach(s=>{r.style[s]=o[s]}),r.width=r.width,delete r[VN],!0}addEventListener(e,r,n){this.removeEventListener(e,r);let o=e.$proxies||(e.$proxies={}),i={attach:cve,detach:pve,resize:mve}[r]||hve;o[r]=i(e,r,n)}removeEventListener(e,r){let n=e.$proxies||(e.$proxies={}),o=n[r];if(!o)return;({attach:hO,detach:hO,resize:hO}[r]||lve)(e,r,o),n[r]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(e,r,n,o){return aO(e,r,n,o)}isAttached(e){let r=pv(e);return!!(r&&r.isConnected)}};function gve(t){return!_N()||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas?yO:bO}var uu=class{constructor(){Bt(this,"active",!1)}tooltipPosition(e){let{x:r,y:n}=this.getProps(["x","y"],e);return{x:r,y:n}}hasValue(){return Yg(this.x)&&Yg(this.y)}getProps(e,r){let n=this.$animations;if(!r||!n)return this;let o={};return e.forEach(s=>{o[s]=n[s]&&n[s].active()?n[s]._to:this[s]}),o}};Bt(uu,"defaults",{}),Bt(uu,"defaultRoutes");function xve(t,e){let r=t.options.ticks,n=yve(t),o=Math.min(r.maxTicksLimit||n,n),s=r.major.enabled?vve(e):[],i=s.length,a=s[0],l=s[i-1],u=[];if(i>o)return wve(e,u,s,i/o),u;let c=bve(s,e,o);if(i>0){let p,f,d=i>1?Math.round((l-a)/(i-1)):null;for(FN(e,u,c,or(d)?0:a-d,a),p=0,f=i-1;p<f;p++)FN(e,u,c,s[p],s[p+1]);return FN(e,u,c,l,or(d)?e.length:l+d),u}return FN(e,u,c),u}function yve(t){let e=t.options.offset,r=t._tickSize(),n=t._length/r+(e?0:1),o=t._maxLength/r;return Math.floor(Math.min(n,o))}function bve(t,e,r){let n=Cve(t),o=e.length/r;if(!n)return Math.max(o,1);let s=zR(n);for(let i=0,a=s.length-1;i<a;i++){let l=s[i];if(l>o)return l}return Math.max(o,1)}function vve(t){let e=[],r,n;for(r=0,n=t.length;r<n;r++)t[r].major&&e.push(r);return e}function wve(t,e,r,n){let o=0,s=r[0],i;for(n=Math.ceil(n),i=0;i<t.length;i++)i===s&&(e.push(t[i]),o++,s=r[o*n])}function FN(t,e,r,n,o){let s=xr(n,0),i=Math.min(xr(o,t.length),t.length),a=0,l,u,c;for(r=Math.ceil(r),o&&(l=o-n,r=l/Math.floor(l/r)),c=s;c<0;)a++,c=Math.round(s+a*r);for(u=Math.max(s,0);u<i;u++)u===c&&(e.push(t[u]),a++,c=Math.round(s+a*r))}function Cve(t){let e=t.length,r,n;if(e<2)return!1;for(n=t[0],r=1;r<e;++r)if(t[r]-t[r-1]!==n)return!1;return n}var Sve=t=>t==="left"?"right":t==="right"?"left":t,QK=(t,e,r)=>e==="top"||e==="left"?t[e]+r:t[e]-r;function ZK(t,e){let r=[],n=t.length/e,o=t.length,s=0;for(;s<o;s+=n)r.push(t[Math.floor(s)]);return r}function kve(t,e,r){let n=t.ticks.length,o=Math.min(e,n-1),s=t._startPixel,i=t._endPixel,a=1e-6,l=t.getPixelForTick(o),u;if(!(r&&(n===1?u=Math.max(l-s,i-l):e===0?u=(t.getPixelForTick(1)-l)/2:u=(l-t.getPixelForTick(o-1))/2,l+=o<e?u:-u,l<s-a||l>i+a)))return l}function Tve(t,e){At(t,r=>{let n=r.gc,o=n.length/2,s;if(o>e){for(s=0;s<o;++s)delete r.data[n[s]];n.splice(0,o)}})}function gv(t){return t.drawTicks?t.tickLength:0}function JK(t,e){if(!t.display)return 0;let r=yo(t.font,e),n=Vo(t.padding);return(yr(t.text)?t.text.length:1)*r.lineHeight+n.height}function Nve(t,e){return su(t,{scale:e,type:"scale"})}function Ive(t,e,r){return su(t,{tick:r,index:e,type:"tick"})}function Eve(t,e,r){let n=YR(t);return(r&&e!=="right"||!r&&e==="right")&&(n=Sve(n)),n}function _ve(t,e,r,n){let{top:o,left:s,bottom:i,right:a,chart:l}=t,{chartArea:u,scales:c}=l,p=0,f,d,m,h=i-o,x=a-s;if(t.isHorizontal()){if(d=yN(n,s,a),dt(r)){let g=Object.keys(r)[0],y=r[g];m=c[g].getPixelForValue(y)+h-e}else r==="center"?m=(u.bottom+u.top)/2+h-e:m=QK(t,r,e);f=a-s}else{if(dt(r)){let g=Object.keys(r)[0],y=r[g];d=c[g].getPixelForValue(y)-x+e}else r==="center"?d=(u.left+u.right)/2-x+e:d=QK(t,r,e);m=yN(n,i,o),p=r==="left"?-no:no}return{titleX:d,titleY:m,maxWidth:f,rotation:p}}var cu=class extends uu{constructor(e){super(),this.id=e.id,this.type=e.type,this.options=void 0,this.ctx=e.ctx,this.chart=e.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(e){this.options=e.setContext(this.getContext()),this.axis=e.axis,this._userMin=this.parse(e.min),this._userMax=this.parse(e.max),this._suggestedMin=this.parse(e.suggestedMin),this._suggestedMax=this.parse(e.suggestedMax)}parse(e,r){return e}getUserBounds(){let{_userMin:e,_userMax:r,_suggestedMin:n,_suggestedMax:o}=this;return e=xo(e,Number.POSITIVE_INFINITY),r=xo(r,Number.NEGATIVE_INFINITY),n=xo(n,Number.POSITIVE_INFINITY),o=xo(o,Number.NEGATIVE_INFINITY),{min:xo(e,n),max:xo(r,o),minDefined:Zr(e),maxDefined:Zr(r)}}getMinMax(e){let{min:r,max:n,minDefined:o,maxDefined:s}=this.getUserBounds(),i;if(o&&s)return{min:r,max:n};let a=this.getMatchingVisibleMetas();for(let l=0,u=a.length;l<u;++l)i=a[l].controller.getMinMax(this,e),o||(r=Math.min(r,i.min)),s||(n=Math.max(n,i.max));return r=s&&r>n?n:r,n=o&&r>n?r:n,{min:xo(r,xo(n,r)),max:xo(n,xo(r,n))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){let e=this.chart.data;return this.options.labels||(this.isHorizontal()?e.xLabels:e.yLabels)||e.labels||[]}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){br(this.options.beforeUpdate,[this])}update(e,r,n){let{beginAtZero:o,grace:s,ticks:i}=this.options,a=i.sampleSize;this.beforeUpdate(),this.maxWidth=e,this.maxHeight=r,this._margins=n=Object.assign({left:0,right:0,top:0,bottom:0},n),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+n.left+n.right:this.height+n.top+n.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=oO(this,s,o),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();let l=a<this.ticks.length;this._convertTicksToLabels(l?ZK(this.ticks,a):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),i.display&&(i.autoSkip||i.source==="auto")&&(this.ticks=xve(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),l&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let e=this.options.reverse,r,n;this.isHorizontal()?(r=this.left,n=this.right):(r=this.top,n=this.bottom,e=!e),this._startPixel=r,this._endPixel=n,this._reversePixels=e,this._length=n-r,this._alignToPixels=this.options.alignToPixels}afterUpdate(){br(this.options.afterUpdate,[this])}beforeSetDimensions(){br(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){br(this.options.afterSetDimensions,[this])}_callHooks(e){this.chart.notifyPlugins(e,this.getContext()),br(this.options[e],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){br(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(e){let r=this.options.ticks,n,o,s;for(n=0,o=e.length;n<o;n++)s=e[n],s.label=br(r.callback,[s.value,n,e],this)}afterTickToLabelConversion(){br(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){br(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){let e=this.options,r=e.ticks,n=this.ticks.length,o=r.minRotation||0,s=r.maxRotation,i=o,a,l,u;if(!this._isVisible()||!r.display||o>=s||n<=1||!this.isHorizontal()){this.labelRotation=o;return}let c=this._getLabelSizes(),p=c.widest.width,f=c.highest.height,d=Js(this.chart.width-p,0,this.maxWidth);a=e.offset?this.maxWidth/n:d/(n-1),p+6>a&&(a=d/(n-(e.offset?.5:1)),l=this.maxHeight-gv(e.grid)-r.padding-JK(e.title,this.chart.options.font),u=Math.sqrt(p*p+f*f),i=ov(Math.min(Math.asin(Js((c.highest.height+6)/a,-1,1)),Math.asin(Js(l/u,-1,1))-Math.asin(Js(f/u,-1,1)))),i=Math.max(o,Math.min(s,i))),this.labelRotation=i}afterCalculateLabelRotation(){br(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){br(this.options.beforeFit,[this])}fit(){let e={width:0,height:0},{chart:r,options:{ticks:n,title:o,grid:s}}=this,i=this._isVisible(),a=this.isHorizontal();if(i){let l=JK(o,r.options.font);if(a?(e.width=this.maxWidth,e.height=gv(s)+l):(e.height=this.maxHeight,e.width=gv(s)+l),n.display&&this.ticks.length){let{first:u,last:c,widest:p,highest:f}=this._getLabelSizes(),d=n.padding*2,m=fa(this.labelRotation),h=Math.cos(m),x=Math.sin(m);if(a){let g=n.mirror?0:x*p.width+h*f.height;e.height=Math.min(this.maxHeight,e.height+g+d)}else{let g=n.mirror?0:h*p.width+x*f.height;e.width=Math.min(this.maxWidth,e.width+g+d)}this._calculatePadding(u,c,x,h)}}this._handleMargins(),a?(this.width=this._length=r.width-this._margins.left-this._margins.right,this.height=e.height):(this.width=e.width,this.height=this._length=r.height-this._margins.top-this._margins.bottom)}_calculatePadding(e,r,n,o){let{ticks:{align:s,padding:i},position:a}=this.options,l=this.labelRotation!==0,u=a!=="top"&&this.axis==="x";if(this.isHorizontal()){let c=this.getPixelForTick(0)-this.left,p=this.right-this.getPixelForTick(this.ticks.length-1),f=0,d=0;l?u?(f=o*e.width,d=n*r.height):(f=n*e.height,d=o*r.width):s==="start"?d=r.width:s==="end"?f=e.width:s!=="inner"&&(f=e.width/2,d=r.width/2),this.paddingLeft=Math.max((f-c+i)*this.width/(this.width-c),0),this.paddingRight=Math.max((d-p+i)*this.width/(this.width-p),0)}else{let c=r.height/2,p=e.height/2;s==="start"?(c=0,p=e.height):s==="end"&&(c=r.height,p=0),this.paddingTop=c+i,this.paddingBottom=p+i}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){br(this.options.afterFit,[this])}isHorizontal(){let{axis:e,position:r}=this.options;return r==="top"||r==="bottom"||e==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(e){this.beforeTickToLabelConversion(),this.generateTickLabels(e);let r,n;for(r=0,n=e.length;r<n;r++)or(e[r].label)&&(e.splice(r,1),n--,r--);this.afterTickToLabelConversion()}_getLabelSizes(){let e=this._labelSizes;if(!e){let r=this.options.ticks.sampleSize,n=this.ticks;r<n.length&&(n=ZK(n,r)),this._labelSizes=e=this._computeLabelSizes(n,n.length)}return e}_computeLabelSizes(e,r){let{ctx:n,_longestTextCache:o}=this,s=[],i=[],a=0,l=0,u,c,p,f,d,m,h,x,g,y,b;for(u=0;u<r;++u){if(f=e[u].label,d=this._resolveTickFontOptions(u),n.font=m=d.string,h=o[m]=o[m]||{data:{},gc:[]},x=d.lineHeight,g=y=0,!or(f)&&!yr(f))g=Hg(n,h.data,h.gc,g,f),y=x;else if(yr(f))for(c=0,p=f.length;c<p;++c)b=f[c],!or(b)&&!yr(b)&&(g=Hg(n,h.data,h.gc,g,b),y+=x);s.push(g),i.push(y),a=Math.max(g,a),l=Math.max(y,l)}Tve(o,r);let v=s.indexOf(a),C=i.indexOf(l),S=k=>({width:s[k]||0,height:i[k]||0});return{first:S(0),last:S(r-1),widest:S(v),highest:S(C),widths:s,heights:i}}getLabelForValue(e){return e}getPixelForValue(e,r){return NaN}getValueForPixel(e){}getPixelForTick(e){let r=this.ticks;return e<0||e>r.length-1?null:this.getPixelForValue(r[e].value)}getPixelForDecimal(e){this._reversePixels&&(e=1-e);let r=this._startPixel+e*this._length;return UR(this._alignToPixels?ru(this.chart,r,0):r)}getDecimalForPixel(e){let r=(e-this._startPixel)/this._length;return this._reversePixels?1-r:r}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){let{min:e,max:r}=this;return e<0&&r<0?r:e>0&&r>0?e:0}getContext(e){let r=this.ticks||[];if(e>=0&&e<r.length){let n=r[e];return n.$context||(n.$context=Ive(this.getContext(),e,n))}return this.$context||(this.$context=Nve(this.chart.getContext(),this))}_tickSize(){let e=this.options.ticks,r=fa(this.labelRotation),n=Math.abs(Math.cos(r)),o=Math.abs(Math.sin(r)),s=this._getLabelSizes(),i=e.autoSkipPadding||0,a=s?s.widest.width+i:0,l=s?s.highest.height+i:0;return this.isHorizontal()?l*n>a*o?a/n:l/o:l*o<a*n?l/n:a/o}_isVisible(){let e=this.options.display;return e!=="auto"?!!e:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(e){let r=this.axis,n=this.chart,o=this.options,{grid:s,position:i,border:a}=o,l=s.offset,u=this.isHorizontal(),p=this.ticks.length+(l?1:0),f=gv(s),d=[],m=a.setContext(this.getContext()),h=m.display?m.width:0,x=h/2,g=function(K){return ru(n,K,h)},y,b,v,C,S,k,I,A,$,O,j,H;if(i==="top")y=g(this.bottom),k=this.bottom-f,A=y-x,O=g(e.top)+x,H=e.bottom;else if(i==="bottom")y=g(this.top),O=e.top,H=g(e.bottom)-x,k=y+x,A=this.top+f;else if(i==="left")y=g(this.right),S=this.right-f,I=y-x,$=g(e.left)+x,j=e.right;else if(i==="right")y=g(this.left),$=e.left,j=g(e.right)-x,S=y+x,I=this.left+f;else if(r==="x"){if(i==="center")y=g((e.top+e.bottom)/2+.5);else if(dt(i)){let K=Object.keys(i)[0],X=i[K];y=g(this.chart.scales[K].getPixelForValue(X))}O=e.top,H=e.bottom,k=y+x,A=k+f}else if(r==="y"){if(i==="center")y=g((e.left+e.right)/2);else if(dt(i)){let K=Object.keys(i)[0],X=i[K];y=g(this.chart.scales[K].getPixelForValue(X))}S=y-x,I=S-f,$=e.left,j=e.right}let Y=xr(o.ticks.maxTicksLimit,p),B=Math.max(1,Math.ceil(p/Y));for(b=0;b<p;b+=B){let K=this.getContext(b),X=s.setContext(K),Z=a.setContext(K),Q=X.lineWidth,ie=X.color,re=Z.dash||[],ue=Z.dashOffset,ne=X.tickWidth,le=X.tickColor,ae=X.tickBorderDash||[],me=X.tickBorderDashOffset;v=kve(this,b,l),v!==void 0&&(C=ru(n,v,Q),u?S=I=$=j=C:k=A=O=H=C,d.push({tx1:S,ty1:k,tx2:I,ty2:A,x1:$,y1:O,x2:j,y2:H,width:Q,color:ie,borderDash:re,borderDashOffset:ue,tickWidth:ne,tickColor:le,tickBorderDash:ae,tickBorderDashOffset:me}))}return this._ticksLength=p,this._borderValue=y,d}_computeLabelItems(e){let r=this.axis,n=this.options,{position:o,ticks:s}=n,i=this.isHorizontal(),a=this.ticks,{align:l,crossAlign:u,padding:c,mirror:p}=s,f=gv(n.grid),d=f+c,m=p?-c:d,h=-fa(this.labelRotation),x=[],g,y,b,v,C,S,k,I,A,$,O,j,H="middle";if(o==="top")S=this.bottom-m,k=this._getXAxisLabelAlignment();else if(o==="bottom")S=this.top+m,k=this._getXAxisLabelAlignment();else if(o==="left"){let B=this._getYAxisLabelAlignment(f);k=B.textAlign,C=B.x}else if(o==="right"){let B=this._getYAxisLabelAlignment(f);k=B.textAlign,C=B.x}else if(r==="x"){if(o==="center")S=(e.top+e.bottom)/2+d;else if(dt(o)){let B=Object.keys(o)[0],K=o[B];S=this.chart.scales[B].getPixelForValue(K)+d}k=this._getXAxisLabelAlignment()}else if(r==="y"){if(o==="center")C=(e.left+e.right)/2-d;else if(dt(o)){let B=Object.keys(o)[0],K=o[B];C=this.chart.scales[B].getPixelForValue(K)}k=this._getYAxisLabelAlignment(f).textAlign}r==="y"&&(l==="start"?H="top":l==="end"&&(H="bottom"));let Y=this._getLabelSizes();for(g=0,y=a.length;g<y;++g){b=a[g],v=b.label;let B=s.setContext(this.getContext(g));I=this.getPixelForTick(g)+s.labelOffset,A=this._resolveTickFontOptions(g),$=A.lineHeight,O=yr(v)?v.length:1;let K=O/2,X=B.color,Z=B.textStrokeColor,Q=B.textStrokeWidth,ie=k;i?(C=I,k==="inner"&&(g===y-1?ie=this.options.reverse?"left":"right":g===0?ie=this.options.reverse?"right":"left":ie="center"),o==="top"?u==="near"||h!==0?j=-O*$+$/2:u==="center"?j=-Y.highest.height/2-K*$+$:j=-Y.highest.height+$/2:u==="near"||h!==0?j=$/2:u==="center"?j=Y.highest.height/2-K*$:j=Y.highest.height-O*$,p&&(j*=-1),h!==0&&!B.showLabelBackdrop&&(C+=$/2*Math.sin(h))):(S=I,j=(1-O)*$/2);let re;if(B.showLabelBackdrop){let ue=Vo(B.backdropPadding),ne=Y.heights[g],le=Y.widths[g],ae=j-ue.top,me=0-ue.left;switch(H){case"middle":ae-=ne/2;break;case"bottom":ae-=ne;break}switch(k){case"center":me-=le/2;break;case"right":me-=le;break}re={left:me,top:ae,width:le+ue.width,height:ne+ue.height,color:B.backdropColor}}x.push({rotation:h,label:v,font:A,color:X,strokeColor:Z,strokeWidth:Q,textOffset:j,textAlign:ie,textBaseline:H,translation:[C,S],backdrop:re})}return x}_getXAxisLabelAlignment(){let{position:e,ticks:r}=this.options;if(-fa(this.labelRotation))return e==="top"?"left":"right";let o="center";return r.align==="start"?o="left":r.align==="end"?o="right":r.align==="inner"&&(o="inner"),o}_getYAxisLabelAlignment(e){let{position:r,ticks:{crossAlign:n,mirror:o,padding:s}}=this.options,i=this._getLabelSizes(),a=e+s,l=i.widest.width,u,c;return r==="left"?o?(c=this.right+s,n==="near"?u="left":n==="center"?(u="center",c+=l/2):(u="right",c+=l)):(c=this.right-a,n==="near"?u="right":n==="center"?(u="center",c-=l/2):(u="left",c=this.left)):r==="right"?o?(c=this.left+s,n==="near"?u="right":n==="center"?(u="center",c-=l/2):(u="left",c-=l)):(c=this.left+a,n==="near"?u="left":n==="center"?(u="center",c+=l/2):(u="right",c=this.right)):u="right",{textAlign:u,x:c}}_computeLabelArea(){if(this.options.ticks.mirror)return;let e=this.chart,r=this.options.position;if(r==="left"||r==="right")return{top:0,left:this.left,bottom:e.height,right:this.right};if(r==="top"||r==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:e.width}}drawBackground(){let{ctx:e,options:{backgroundColor:r},left:n,top:o,width:s,height:i}=this;r&&(e.save(),e.fillStyle=r,e.fillRect(n,o,s,i),e.restore())}getLineWidthForValue(e){let r=this.options.grid;if(!this._isVisible()||!r.display)return 0;let o=this.ticks.findIndex(s=>s.value===e);return o>=0?r.setContext(this.getContext(o)).lineWidth:0}drawGrid(e){let r=this.options.grid,n=this.ctx,o=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(e)),s,i,a=(l,u,c)=>{!c.width||!c.color||(n.save(),n.lineWidth=c.width,n.strokeStyle=c.color,n.setLineDash(c.borderDash||[]),n.lineDashOffset=c.borderDashOffset,n.beginPath(),n.moveTo(l.x,l.y),n.lineTo(u.x,u.y),n.stroke(),n.restore())};if(r.display)for(s=0,i=o.length;s<i;++s){let l=o[s];r.drawOnChartArea&&a({x:l.x1,y:l.y1},{x:l.x2,y:l.y2},l),r.drawTicks&&a({x:l.tx1,y:l.ty1},{x:l.tx2,y:l.ty2},{color:l.tickColor,width:l.tickWidth,borderDash:l.tickBorderDash,borderDashOffset:l.tickBorderDashOffset})}}drawBorder(){let{chart:e,ctx:r,options:{border:n,grid:o}}=this,s=n.setContext(this.getContext()),i=n.display?s.width:0;if(!i)return;let a=o.setContext(this.getContext(0)).lineWidth,l=this._borderValue,u,c,p,f;this.isHorizontal()?(u=ru(e,this.left,i)-i/2,c=ru(e,this.right,a)+a/2,p=f=l):(p=ru(e,this.top,i)-i/2,f=ru(e,this.bottom,a)+a/2,u=c=l),r.save(),r.lineWidth=s.width,r.strokeStyle=s.color,r.beginPath(),r.moveTo(u,p),r.lineTo(c,f),r.stroke(),r.restore()}drawLabels(e){if(!this.options.ticks.display)return;let n=this.ctx,o=this._computeLabelArea();o&&TN(n,o);let s=this._labelItems||(this._labelItems=this._computeLabelItems(e)),i,a;for(i=0,a=s.length;i<a;++i){let l=s[i],u=l.font,c=l.label,p=l.textOffset;Qg(n,c,0,p,u,l)}o&&NN(n)}drawTitle(){let{ctx:e,options:{position:r,title:n,reverse:o}}=this;if(!n.display)return;let s=yo(n.font),i=Vo(n.padding),a=n.align,l=s.lineHeight/2;r==="bottom"||r==="center"||dt(r)?(l+=i.bottom,yr(n.text)&&(l+=s.lineHeight*(n.text.length-1))):l+=i.top;let{titleX:u,titleY:c,maxWidth:p,rotation:f}=_ve(this,l,r,a);Qg(e,n.text,0,0,s,{color:n.color,maxWidth:p,rotation:f,textAlign:Eve(a,r,o),textBaseline:"middle",translation:[u,c]})}draw(e){!this._isVisible()||(this.drawBackground(),this.drawGrid(e),this.drawBorder(),this.drawTitle(),this.drawLabels(e))}_layers(){let e=this.options,r=e.ticks&&e.ticks.z||0,n=xr(e.grid&&e.grid.z,-1),o=xr(e.border&&e.border.z,0);return!this._isVisible()||this.draw!==cu.prototype.draw?[{z:r,draw:s=>{this.draw(s)}}]:[{z:n,draw:s=>{this.drawBackground(),this.drawGrid(s),this.drawTitle()}},{z:o,draw:()=>{this.drawBorder()}},{z:r,draw:s=>{this.drawLabels(s)}}]}getMatchingVisibleMetas(e){let r=this.chart.getSortedVisibleDatasetMetas(),n=this.axis+"AxisID",o=[],s,i;for(s=0,i=r.length;s<i;++s){let a=r[s];a[n]===this.id&&(!e||a.type===e)&&o.push(a)}return o}_resolveTickFontOptions(e){let r=this.options.ticks.setContext(this.getContext(e));return yo(r.font)}_maxDigits(){let e=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/e}},ex=class{constructor(e,r,n){this.type=e,this.scope=r,this.override=n,this.items=Object.create(null)}isForType(e){return Object.prototype.isPrototypeOf.call(this.type.prototype,e.prototype)}register(e){let r=Object.getPrototypeOf(e),n;$ve(r)&&(n=this.register(r));let o=this.items,s=e.id,i=this.scope+"."+s;if(!s)throw new Error("class does not have id: "+e);return s in o||(o[s]=e,Ave(e,i,n),this.override&&Wr.override(e.id,e.overrides)),i}get(e){return this.items[e]}unregister(e){let r=this.items,n=e.id,o=this.scope;n in r&&delete r[n],o&&n in Wr[o]&&(delete Wr[o][n],this.override&&delete mp[n])}};function Ave(t,e,r){let n=pd(Object.create(null),[r?Wr.get(r):{},Wr.get(e),t.defaults]);Wr.set(e,n),t.defaultRoutes&&Dve(e,t.defaultRoutes),t.descriptors&&Wr.describe(e,t.descriptors)}function Dve(t,e){Object.keys(e).forEach(r=>{let n=r.split("."),o=n.pop(),s=[t].concat(n).join("."),i=e[r].split("."),a=i.pop(),l=i.join(".");Wr.route(s,o,l,a)})}function $ve(t){return"id"in t&&"defaults"in t}var vO=class{constructor(){this.controllers=new ex(hp,"datasets",!0),this.elements=new ex(uu,"elements"),this.plugins=new ex(Object,"plugins"),this.scales=new ex(cu,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...e){this._each("register",e)}remove(...e){this._each("unregister",e)}addControllers(...e){this._each("register",e,this.controllers)}addElements(...e){this._each("register",e,this.elements)}addPlugins(...e){this._each("register",e,this.plugins)}addScales(...e){this._each("register",e,this.scales)}getController(e){return this._get(e,this.controllers,"controller")}getElement(e){return this._get(e,this.elements,"element")}getPlugin(e){return this._get(e,this.plugins,"plugin")}getScale(e){return this._get(e,this.scales,"scale")}removeControllers(...e){this._each("unregister",e,this.controllers)}removeElements(...e){this._each("unregister",e,this.elements)}removePlugins(...e){this._each("unregister",e,this.plugins)}removeScales(...e){this._each("unregister",e,this.scales)}_each(e,r,n){[...r].forEach(o=>{let s=n||this._getRegistryForType(o);n||s.isForType(o)||s===this.plugins&&o.id?this._exec(e,s,o):At(o,i=>{let a=n||this._getRegistryForType(i);this._exec(e,a,i)})})}_exec(e,r,n){let o=nv(e);br(n["before"+o],[],n),r[e](n),br(n["after"+o],[],n)}_getRegistryForType(e){for(let r=0;r<this._typedRegistries.length;r++){let n=this._typedRegistries[r];if(n.isForType(e))return n}return this.plugins}_get(e,r,n){let o=r.get(e);if(o===void 0)throw new Error('"'+e+'" is not a registered '+n+".");return o}},ma=new vO,wO=class{constructor(){this._init=[]}notify(e,r,n,o){r==="beforeInit"&&(this._init=this._createDescriptors(e,!0),this._notify(this._init,e,"install"));let s=o?this._descriptors(e).filter(o):this._descriptors(e),i=this._notify(s,e,r,n);return r==="afterDestroy"&&(this._notify(s,e,"stop"),this._notify(this._init,e,"uninstall")),i}_notify(e,r,n,o){o=o||{};for(let s of e){let i=s.plugin,a=i[n],l=[r,o,s.options];if(br(a,l,i)===!1&&o.cancelable)return!1}return!0}invalidate(){or(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(e){if(this._cache)return this._cache;let r=this._cache=this._createDescriptors(e);return this._notifyStateChanges(e),r}_createDescriptors(e,r){let n=e&&e.config,o=xr(n.options&&n.options.plugins,{}),s=Rve(n);return o===!1&&!r?[]:Fve(e,s,o,r)}_notifyStateChanges(e){let r=this._oldCache||[],n=this._cache,o=(s,i)=>s.filter(a=>!i.some(l=>a.plugin.id===l.plugin.id));this._notify(o(r,n),e,"stop"),this._notify(o(n,r),e,"start")}};function Rve(t){let e={},r=[],n=Object.keys(ma.plugins.items);for(let s=0;s<n.length;s++)r.push(ma.getPlugin(n[s]));let o=t.plugins||[];for(let s=0;s<o.length;s++){let i=o[s];r.indexOf(i)===-1&&(r.push(i),e[i.id]=!0)}return{plugins:r,localIds:e}}function Ove(t,e){return!e&&t===!1?null:t===!0?{}:t}function Fve(t,{plugins:e,localIds:r},n,o){let s=[],i=t.getContext();for(let a of e){let l=a.id,u=Ove(n[l],o);u!==null&&s.push({plugin:a,options:Pve(t.config,{plugin:a,local:r[l]},u,i)})}return s}function Pve(t,{plugin:e,local:r},n,o){let s=t.pluginScopeKeys(e),i=t.getOptionScopes(n,s);return r&&e.defaults&&i.push(e.defaults),t.createResolver(i,o,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function CO(t,e){let r=Wr.datasets[t]||{};return((e.datasets||{})[t]||{}).indexAxis||e.indexAxis||r.indexAxis||"x"}function Lve(t,e){let r=t;return t==="_index_"?r=e:t==="_value_"&&(r=e==="x"?"y":"x"),r}function Mve(t,e){return t===e?"_index_":"_value_"}function zve(t){if(t==="top"||t==="bottom")return"x";if(t==="left"||t==="right")return"y"}function qN(t,e){if(t==="x"||t==="y"||t==="r"||(t=e.axis||zve(e.position)||t.length>1&&qN(t[0].toLowerCase(),e),t))return t;throw new Error(`Cannot determine type of '${name}' axis. Please provide 'axis' or 'position' option.`)}function Bve(t,e){let r=mp[t.type]||{scales:{}},n=e.scales||{},o=CO(t.type,e),s=Object.create(null);return Object.keys(n).forEach(i=>{let a=n[i];if(!dt(a))return console.error(`Invalid scale configuration for scale: ${i}`);if(a._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${i}`);let l=qN(i,a),u=Mve(l,o),c=r.scales||{};s[i]=fd(Object.create(null),[{axis:l},a,c[l],c[u]])}),t.data.datasets.forEach(i=>{let a=i.type||t.type,l=i.indexAxis||CO(a,e),c=(mp[a]||{}).scales||{};Object.keys(c).forEach(p=>{let f=Lve(p,l),d=i[f+"AxisID"]||f;s[d]=s[d]||Object.create(null),fd(s[d],[{axis:f},n[d],c[p]])})}),Object.keys(s).forEach(i=>{let a=s[i];fd(a,[Wr.scales[a.type],Wr.scale])}),s}function NX(t){let e=t.options||(t.options={});e.plugins=xr(e.plugins,{}),e.scales=Bve(t,e)}function IX(t){return t=t||{},t.datasets=t.datasets||[],t.labels=t.labels||[],t}function Vve(t){return t=t||{},t.data=IX(t.data),NX(t),t}var eX=new Map,EX=new Set;function PN(t,e){let r=eX.get(t);return r||(r=e(),eX.set(t,r),EX.add(r)),r}var xv=(t,e,r)=>{let n=jg(e,r);n!==void 0&&t.add(n)},SO=class{constructor(e){this._config=Vve(e),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(e){this._config.type=e}get data(){return this._config.data}set data(e){this._config.data=IX(e)}get options(){return this._config.options}set options(e){this._config.options=e}get plugins(){return this._config.plugins}update(){let e=this._config;this.clearCache(),NX(e)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(e){return PN(e,()=>[[`datasets.${e}`,""]])}datasetAnimationScopeKeys(e,r){return PN(`${e}.transition.${r}`,()=>[[`datasets.${e}.transitions.${r}`,`transitions.${r}`],[`datasets.${e}`,""]])}datasetElementScopeKeys(e,r){return PN(`${e}-${r}`,()=>[[`datasets.${e}.elements.${r}`,`datasets.${e}`,`elements.${r}`,""]])}pluginScopeKeys(e){let r=e.id,n=this.type;return PN(`${n}-plugin-${r}`,()=>[[`plugins.${r}`,...e.additionalOptionScopes||[]]])}_cachedScopes(e,r){let n=this._scopeCache,o=n.get(e);return(!o||r)&&(o=new Map,n.set(e,o)),o}getOptionScopes(e,r,n){let{options:o,type:s}=this,i=this._cachedScopes(e,n),a=i.get(r);if(a)return a;let l=new Set;r.forEach(c=>{e&&(l.add(e),c.forEach(p=>xv(l,e,p))),c.forEach(p=>xv(l,o,p)),c.forEach(p=>xv(l,mp[s]||{},p)),c.forEach(p=>xv(l,Wr,p)),c.forEach(p=>xv(l,wN,p))});let u=Array.from(l);return u.length===0&&u.push(Object.create(null)),EX.has(r)&&i.set(r,u),u}chartOptionScopes(){let{options:e,type:r}=this;return[e,mp[r]||{},Wr.datasets[r]||{},{type:r},Wr,wN]}resolveNamedOptions(e,r,n,o=[""]){let s={$shared:!0},{resolver:i,subPrefixes:a}=tX(this._resolverCache,e,o),l=i;if(Gve(i,r)){s.$shared=!1,n=ca(n)?n():n;let u=this.createResolver(e,n,a);l=dp(i,n,u)}for(let u of r)s[u]=l[u];return s}createResolver(e,r,n=[""],o){let{resolver:s}=tX(this._resolverCache,e,n);return dt(r)?dp(s,r,void 0,o):s}};function tX(t,e,r){let n=t.get(e);n||(n=new Map,t.set(e,n));let o=r.join(),s=n.get(o);return s||(s={resolver:cv(e,r),subPrefixes:r.filter(a=>!a.toLowerCase().includes("hover"))},n.set(o,s)),s}var Wve=t=>dt(t)&&Object.getOwnPropertyNames(t).reduce((e,r)=>e||ca(t[r]),!1);function Gve(t,e){let{isScriptable:r,isIndexable:n}=EN(t);for(let o of e){let s=r(o),i=n(o),a=(i||s)&&t[o];if(s&&(ca(a)||Wve(a))||i&&yr(a))return!0}return!1}var Uve="4.0.1",Hve=["top","bottom","left","right","chartArea"];function rX(t,e){return t==="top"||t==="bottom"||Hve.indexOf(t)===-1&&e==="x"}function nX(t,e){return function(r,n){return r[t]===n[t]?r[e]-n[e]:r[t]-n[t]}}function oX(t){let e=t.chart,r=e.options.animation;e.notifyPlugins("afterRender"),br(r&&r.onComplete,[t],e)}function qve(t){let e=t.chart,r=e.options.animation;br(r&&r.onProgress,[t],e)}function _X(t){return _N()&&typeof t=="string"?t=document.getElementById(t):t&&t.length&&(t=t[0]),t&&t.canvas&&(t=t.canvas),t}var WN={},sX=t=>{let e=_X(t);return Object.values(WN).filter(r=>r.canvas===e).pop()};function jve(t,e,r){let n=Object.keys(t);for(let o of n){let s=+o;if(s>=e){let i=t[o];delete t[o],(r>0||s>e)&&(t[s+r]=i)}}}function Kve(t,e,r,n){return!r||t.type==="mouseout"?null:n?e:t}function Xve(t){let{xScale:e,yScale:r}=t;if(e&&r)return{left:e.left,right:e.right,top:r.top,bottom:r.bottom}}var ha=class{static register(...e){ma.add(...e),iX()}static unregister(...e){ma.remove(...e),iX()}constructor(e,r){let n=this.config=new SO(r),o=_X(e),s=sX(o);if(s)throw new Error("Canvas is already in use. Chart with ID '"+s.id+"' must be destroyed before the canvas with ID '"+s.canvas.id+"' can be reused.");let i=n.createResolver(n.chartOptionScopes(),this.getContext());this.platform=new(n.platform||gve(o)),this.platform.updateConfig(n);let a=this.platform.acquireContext(o,i.aspectRatio),l=a&&a.canvas,u=l&&l.height,c=l&&l.width;if(this.id=PR(),this.ctx=a,this.canvas=l,this.width=c,this.height=u,this._options=i,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new wO,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=XR(p=>this.update(p),i.resizeDelay||0),this._dataChanges=[],WN[this.id]=this,!a||!l){console.error("Failed to create chart: can't acquire context from the given item");return}au.listen(this,"complete",oX),au.listen(this,"progress",qve),this._initialize(),this.attached&&this.update()}get aspectRatio(){let{options:{aspectRatio:e,maintainAspectRatio:r},width:n,height:o,_aspectRatio:s}=this;return or(e)?r&&s?s:o?n/o:null:e}get data(){return this.config.data}set data(e){this.config.data=e}get options(){return this._options}set options(e){this.config.options=e}get registry(){return ma}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():DN(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return CN(this.canvas,this.ctx),this}stop(){return au.stop(this),this}resize(e,r){au.running(this)?this._resizeBeforeDraw={width:e,height:r}:this._resize(e,r)}_resize(e,r){let n=this.options,o=this.canvas,s=n.maintainAspectRatio&&this.aspectRatio,i=this.platform.getMaximumSize(o,e,r,s),a=n.devicePixelRatio||this.platform.getDevicePixelRatio(),l=this.width?"resize":"attach";this.width=i.width,this.height=i.height,this._aspectRatio=this.aspectRatio,DN(this,a,!0)&&(this.notifyPlugins("resize",{size:i}),br(n.onResize,[this,i],this),this.attached&&this._doResize(l)&&this.render())}ensureScalesHaveIDs(){let r=this.options.scales||{};At(r,(n,o)=>{n.id=o})}buildOrUpdateScales(){let e=this.options,r=e.scales,n=this.scales,o=Object.keys(n).reduce((i,a)=>(i[a]=!1,i),{}),s=[];r&&(s=s.concat(Object.keys(r).map(i=>{let a=r[i],l=qN(i,a),u=l==="r",c=l==="x";return{options:a,dposition:u?"chartArea":c?"bottom":"left",dtype:u?"radialLinear":c?"category":"linear"}}))),At(s,i=>{let a=i.options,l=a.id,u=qN(l,a),c=xr(a.type,i.dtype);(a.position===void 0||rX(a.position,u)!==rX(i.dposition))&&(a.position=i.dposition),o[l]=!0;let p=null;if(l in n&&n[l].type===c)p=n[l];else{let f=ma.getScale(c);p=new f({id:l,type:c,ctx:this.ctx,chart:this}),n[p.id]=p}p.init(a,e)}),At(o,(i,a)=>{i||delete n[a]}),At(n,i=>{ON.configure(this,i,i.options),ON.addBox(this,i)})}_updateMetasets(){let e=this._metasets,r=this.data.datasets.length,n=e.length;if(e.sort((o,s)=>o.index-s.index),n>r){for(let o=r;o<n;++o)this._destroyDatasetMeta(o);e.splice(r,n-r)}this._sortedMetasets=e.slice(0).sort(nX("order","index"))}_removeUnreferencedMetasets(){let{_metasets:e,data:{datasets:r}}=this;e.length>r.length&&delete this._stacks,e.forEach((n,o)=>{r.filter(s=>s===n._dataset).length===0&&this._destroyDatasetMeta(o)})}buildOrUpdateControllers(){let e=[],r=this.data.datasets,n,o;for(this._removeUnreferencedMetasets(),n=0,o=r.length;n<o;n++){let s=r[n],i=this.getDatasetMeta(n),a=s.type||this.config.type;if(i.type&&i.type!==a&&(this._destroyDatasetMeta(n),i=this.getDatasetMeta(n)),i.type=a,i.indexAxis=s.indexAxis||CO(a,this.options),i.order=s.order||0,i.index=n,i.label=""+s.label,i.visible=this.isDatasetVisible(n),i.controller)i.controller.updateIndex(n),i.controller.linkScales();else{let l=ma.getController(a),{datasetElementType:u,dataElementType:c}=Wr.datasets[a];Object.assign(l,{dataElementType:ma.getElement(c),datasetElementType:u&&ma.getElement(u)}),i.controller=new l(this,n),e.push(i.controller)}}return this._updateMetasets(),e}_resetElements(){At(this.data.datasets,(e,r)=>{this.getDatasetMeta(r).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(e){let r=this.config;r.update();let n=this._options=r.createResolver(r.chartOptionScopes(),this.getContext()),o=this._animationsDisabled=!n.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:e,cancelable:!0})===!1)return;let s=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let i=0;for(let u=0,c=this.data.datasets.length;u<c;u++){let{controller:p}=this.getDatasetMeta(u),f=!o&&s.indexOf(p)===-1;p.buildOrUpdateElements(f),i=Math.max(+p.getMaxOverflow(),i)}i=this._minPadding=n.layout.autoPadding?i:0,this._updateLayout(i),o||At(s,u=>{u.reset()}),this._updateDatasets(e),this.notifyPlugins("afterUpdate",{mode:e}),this._layers.sort(nX("z","_idx"));let{_active:a,_lastEvent:l}=this;l?this._eventHandler(l,!0):a.length&&this._updateHoverStyles(a,a,!0),this.render()}_updateScales(){At(this.scales,e=>{ON.removeBox(this,e)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){let e=this.options,r=new Set(Object.keys(this._listeners)),n=new Set(e.events);(!pN(r,n)||!!this._responsiveListeners!==e.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){let{_hiddenIndices:e}=this,r=this._getUniformDataChanges()||[];for(let{method:n,start:o,count:s}of r){let i=n==="_removeElements"?-s:s;jve(e,o,i)}}_getUniformDataChanges(){let e=this._dataChanges;if(!e||!e.length)return;this._dataChanges=[];let r=this.data.datasets.length,n=s=>new Set(e.filter(i=>i[0]===s).map((i,a)=>a+","+i.splice(1).join(","))),o=n(0);for(let s=1;s<r;s++)if(!pN(o,n(s)))return;return Array.from(o).map(s=>s.split(",")).map(s=>({method:s[1],start:+s[2],count:+s[3]}))}_updateLayout(e){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;ON.update(this,this.width,this.height,e);let r=this.chartArea,n=r.width<=0||r.height<=0;this._layers=[],At(this.boxes,o=>{n&&o.position==="chartArea"||(o.configure&&o.configure(),this._layers.push(...o._layers()))},this),this._layers.forEach((o,s)=>{o._idx=s}),this.notifyPlugins("afterLayout")}_updateDatasets(e){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:e,cancelable:!0})!==!1){for(let r=0,n=this.data.datasets.length;r<n;++r)this.getDatasetMeta(r).controller.configure();for(let r=0,n=this.data.datasets.length;r<n;++r)this._updateDataset(r,ca(e)?e({datasetIndex:r}):e);this.notifyPlugins("afterDatasetsUpdate",{mode:e})}}_updateDataset(e,r){let n=this.getDatasetMeta(e),o={meta:n,index:e,mode:r,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",o)!==!1&&(n.controller._update(r),o.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",o))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(au.has(this)?this.attached&&!au.running(this)&&au.start(this):(this.draw(),oX({chart:this})))}draw(){let e;if(this._resizeBeforeDraw){let{width:n,height:o}=this._resizeBeforeDraw;this._resize(n,o),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;let r=this._layers;for(e=0;e<r.length&&r[e].z<=0;++e)r[e].draw(this.chartArea);for(this._drawDatasets();e<r.length;++e)r[e].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(e){let r=this._sortedMetasets,n=[],o,s;for(o=0,s=r.length;o<s;++o){let i=r[o];(!e||i.visible)&&n.push(i)}return n}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;let e=this.getSortedVisibleDatasetMetas();for(let r=e.length-1;r>=0;--r)this._drawDataset(e[r]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(e){let r=this.ctx,n=e._clip,o=!n.disabled,s=Xve(e)||this.chartArea,i={meta:e,index:e.index,cancelable:!0};this.notifyPlugins("beforeDatasetDraw",i)!==!1&&(o&&TN(r,{left:n.left===!1?0:s.left-n.left,right:n.right===!1?this.width:s.right+n.right,top:n.top===!1?0:s.top-n.top,bottom:n.bottom===!1?this.height:s.bottom+n.bottom}),e.controller.draw(),o&&NN(r),i.cancelable=!1,this.notifyPlugins("afterDatasetDraw",i))}isPointInArea(e){return kN(e,this.chartArea,this._minPadding)}getElementsAtEventForMode(e,r,n,o){let s=Qbe.modes[r];return typeof s=="function"?s(this,e,n,o):[]}getDatasetMeta(e){let r=this.data.datasets[e],n=this._metasets,o=n.filter(s=>s&&s._dataset===r).pop();return o||(o={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:r&&r.order||0,index:e,_dataset:r,_parsed:[],_sorted:!1},n.push(o)),o}getContext(){return this.$context||(this.$context=su(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(e){let r=this.data.datasets[e];if(!r)return!1;let n=this.getDatasetMeta(e);return typeof n.hidden=="boolean"?!n.hidden:!r.hidden}setDatasetVisibility(e,r){let n=this.getDatasetMeta(e);n.hidden=!r}toggleDataVisibility(e){this._hiddenIndices[e]=!this._hiddenIndices[e]}getDataVisibility(e){return!this._hiddenIndices[e]}_updateVisibility(e,r,n){let o=n?"show":"hide",s=this.getDatasetMeta(e),i=s.controller._resolveAnimations(void 0,o);fs(r)?(s.data[r].hidden=!n,this.update()):(this.setDatasetVisibility(e,n),i.update(s,{visible:n}),this.update(a=>a.datasetIndex===e?o:void 0))}hide(e,r){this._updateVisibility(e,r,!1)}show(e,r){this._updateVisibility(e,r,!0)}_destroyDatasetMeta(e){let r=this._metasets[e];r&&r.controller&&r.controller._destroy(),delete this._metasets[e]}_stop(){let e,r;for(this.stop(),au.remove(this),e=0,r=this.data.datasets.length;e<r;++e)this._destroyDatasetMeta(e)}destroy(){this.notifyPlugins("beforeDestroy");let{canvas:e,ctx:r}=this;this._stop(),this.config.clearCache(),e&&(this.unbindEvents(),CN(e,r),this.platform.releaseContext(r),this.canvas=null,this.ctx=null),delete WN[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...e){return this.canvas.toDataURL(...e)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){let e=this._listeners,r=this.platform,n=(s,i)=>{r.addEventListener(this,s,i),e[s]=i},o=(s,i,a)=>{s.offsetX=i,s.offsetY=a,this._eventHandler(s)};At(this.options.events,s=>n(s,o))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});let e=this._responsiveListeners,r=this.platform,n=(l,u)=>{r.addEventListener(this,l,u),e[l]=u},o=(l,u)=>{e[l]&&(r.removeEventListener(this,l,u),delete e[l])},s=(l,u)=>{this.canvas&&this.resize(l,u)},i,a=()=>{o("attach",a),this.attached=!0,this.resize(),n("resize",s),n("detach",i)};i=()=>{this.attached=!1,o("resize",s),this._stop(),this._resize(0,0),n("attach",a)},r.isAttached(this.canvas)?a():i()}unbindEvents(){At(this._listeners,(e,r)=>{this.platform.removeEventListener(this,r,e)}),this._listeners={},At(this._responsiveListeners,(e,r)=>{this.platform.removeEventListener(this,r,e)}),this._responsiveListeners=void 0}updateHoverStyle(e,r,n){let o=n?"set":"remove",s,i,a,l;for(r==="dataset"&&(s=this.getDatasetMeta(e[0].datasetIndex),s.controller["_"+o+"DatasetHoverStyle"]()),a=0,l=e.length;a<l;++a){i=e[a];let u=i&&this.getDatasetMeta(i.datasetIndex).controller;u&&u[o+"HoverStyle"](i.element,i.datasetIndex,i.index)}}getActiveElements(){return this._active||[]}setActiveElements(e){let r=this._active||[],n=e.map(({datasetIndex:s,index:i})=>{let a=this.getDatasetMeta(s);if(!a)throw new Error("No dataset found at index "+s);return{datasetIndex:s,element:a.data[i],index:i}});!qg(n,r)&&(this._active=n,this._lastEvent=null,this._updateHoverStyles(n,r))}notifyPlugins(e,r,n){return this._plugins.notify(this,e,r,n)}isPluginEnabled(e){return this._plugins._cache.filter(r=>r.plugin.id===e).length===1}_updateHoverStyles(e,r,n){let o=this.options.hover,s=(l,u)=>l.filter(c=>!u.some(p=>c.datasetIndex===p.datasetIndex&&c.index===p.index)),i=s(r,e),a=n?e:s(e,r);i.length&&this.updateHoverStyle(i,o.mode,!1),a.length&&o.mode&&this.updateHoverStyle(a,o.mode,!0)}_eventHandler(e,r){let n={event:e,replay:r,cancelable:!0,inChartArea:this.isPointInArea(e)},o=i=>(i.options.events||this.options.events).includes(e.native.type);if(this.notifyPlugins("beforeEvent",n,o)===!1)return;let s=this._handleEvent(e,r,n.inChartArea);return n.cancelable=!1,this.notifyPlugins("afterEvent",n,o),(s||n.changed)&&this.render(),this}_handleEvent(e,r,n){let{_active:o=[],options:s}=this,i=r,a=this._getActiveElements(e,o,n,i),l=MR(e),u=Kve(e,this._lastEvent,n,l);n&&(this._lastEvent=null,br(s.onHover,[e,a,this],this),l&&br(s.onClick,[e,a,this],this));let c=!qg(a,o);return(c||r)&&(this._active=a,this._updateHoverStyles(a,o,r)),this._lastEvent=u,c}_getActiveElements(e,r,n,o){if(e.type==="mouseout")return[];if(!n)return r;let s=this.options.hover;return this.getElementsAtEventForMode(e,s.mode,s,o)}};Bt(ha,"defaults",Wr),Bt(ha,"instances",WN),Bt(ha,"overrides",mp),Bt(ha,"registry",ma),Bt(ha,"version",Uve),Bt(ha,"getChart",sX);function iX(){return At(ha.instances,t=>t._plugins.invalidate())}var jN=ha;var bv={average(t){if(!t.length)return!1;let e,r,n=0,o=0,s=0;for(e=0,r=t.length;e<r;++e){let i=t[e].element;if(i&&i.hasValue()){let a=i.tooltipPosition();n+=a.x,o+=a.y,++s}}return{x:n/s,y:o/s}},nearest(t,e){if(!t.length)return!1;let r=e.x,n=e.y,o=Number.POSITIVE_INFINITY,s,i,a;for(s=0,i=t.length;s<i;++s){let l=t[s].element;if(l&&l.hasValue()){let u=l.getCenterPoint(),c=WR(e,u);c<o&&(o=c,a=l)}}if(a){let l=a.tooltipPosition();r=l.x,n=l.y}return{x:r,y:n}}};function da(t,e){return e&&(yr(e)?Array.prototype.push.apply(t,e):t.push(e)),t}function lu(t){return(typeof t=="string"||t instanceof String)&&t.indexOf(`
`)>-1?t.split(`
`):t}function Yve(t,e){let{element:r,datasetIndex:n,index:o}=e,s=t.getDatasetMeta(n).controller,{label:i,value:a}=s.getLabelAndValue(o);return{chart:t,label:i,parsed:s.getParsed(o),raw:t.data.datasets[n].data[o],formattedValue:a,dataset:s.getDataset(),dataIndex:o,datasetIndex:n,element:r}}function aX(t,e){let r=t.chart.ctx,{body:n,footer:o,title:s}=t,{boxWidth:i,boxHeight:a}=e,l=yo(e.bodyFont),u=yo(e.titleFont),c=yo(e.footerFont),p=s.length,f=o.length,d=n.length,m=Vo(e.padding),h=m.height,x=0,g=n.reduce((v,C)=>v+C.before.length+C.lines.length+C.after.length,0);if(g+=t.beforeBody.length+t.afterBody.length,p&&(h+=p*u.lineHeight+(p-1)*e.titleSpacing+e.titleMarginBottom),g){let v=e.displayColors?Math.max(a,l.lineHeight):l.lineHeight;h+=d*v+(g-d)*l.lineHeight+(g-1)*e.bodySpacing}f&&(h+=e.footerMarginTop+f*c.lineHeight+(f-1)*e.footerSpacing);let y=0,b=function(v){x=Math.max(x,r.measureText(v).width+y)};return r.save(),r.font=u.string,At(t.title,b),r.font=l.string,At(t.beforeBody.concat(t.afterBody),b),y=e.displayColors?i+2+e.boxPadding:0,At(n,v=>{At(v.before,b),At(v.lines,b),At(v.after,b)}),y=0,r.font=c.string,At(t.footer,b),r.restore(),x+=m.width,{width:x,height:h}}function Qve(t,e){let{y:r,height:n}=e;return r<n/2?"top":r>t.height-n/2?"bottom":"center"}function Zve(t,e,r,n){let{x:o,width:s}=n,i=r.caretSize+r.caretPadding;if(t==="left"&&o+s+i>e.width||t==="right"&&o-s-i<0)return!0}function Jve(t,e,r,n){let{x:o,width:s}=r,{width:i,chartArea:{left:a,right:l}}=t,u="center";return n==="center"?u=o<=(a+l)/2?"left":"right":o<=s/2?u="left":o>=i-s/2&&(u="right"),Zve(u,t,e,r)&&(u="center"),u}function lX(t,e,r){let n=r.yAlign||e.yAlign||Qve(t,r);return{xAlign:r.xAlign||e.xAlign||Jve(t,e,r,n),yAlign:n}}function e1e(t,e){let{x:r,width:n}=t;return e==="right"?r-=n:e==="center"&&(r-=n/2),r}function t1e(t,e,r){let{y:n,height:o}=t;return e==="top"?n+=r:e==="bottom"?n-=o+r:n-=o/2,n}function uX(t,e,r,n){let{caretSize:o,caretPadding:s,cornerRadius:i}=t,{xAlign:a,yAlign:l}=r,u=o+s,{topLeft:c,topRight:p,bottomLeft:f,bottomRight:d}=ou(i),m=e1e(e,a),h=t1e(e,l,u);return l==="center"?a==="left"?m+=u:a==="right"&&(m-=u):a==="left"?m-=Math.max(c,f)+o:a==="right"&&(m+=Math.max(p,d)+o),{x:Js(m,0,n.width-e.width),y:Js(h,0,n.height-e.height)}}function LN(t,e,r){let n=Vo(r.padding);return e==="center"?t.x+t.width/2:e==="right"?t.x+t.width-n.right:t.x+n.left}function cX(t){return da([],lu(t))}function r1e(t,e,r){return su(t,{tooltip:e,tooltipItems:r,type:"tooltip"})}function pX(t,e){let r=e&&e.dataset&&e.dataset.tooltip&&e.dataset.tooltip.callbacks;return r?t.override(r):t}var AX={beforeTitle:Ai,title(t){if(t.length>0){let e=t[0],r=e.chart.data.labels,n=r?r.length:0;if(this&&this.options&&this.options.mode==="dataset")return e.dataset.label||"";if(e.label)return e.label;if(n>0&&e.dataIndex<n)return r[e.dataIndex]}return""},afterTitle:Ai,beforeBody:Ai,beforeLabel:Ai,label(t){if(this&&this.options&&this.options.mode==="dataset")return t.label+": "+t.formattedValue||t.formattedValue;let e=t.dataset.label||"";e&&(e+=": ");let r=t.formattedValue;return or(r)||(e+=r),e},labelColor(t){let r=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{borderColor:r.borderColor,backgroundColor:r.backgroundColor,borderWidth:r.borderWidth,borderDash:r.borderDash,borderDashOffset:r.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(t){let r=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{pointStyle:r.pointStyle,rotation:r.rotation}},afterLabel:Ai,afterBody:Ai,beforeFooter:Ai,footer:Ai,afterFooter:Ai};function Wo(t,e,r,n){let o=t[e].call(r,n);return typeof o>"u"?AX[e].call(r,n):o}var vv=class extends uu{constructor(e){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=e.chart,this.options=e.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(e){this.options=e,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){let e=this._cachedAnimations;if(e)return e;let r=this.chart,n=this.options.setContext(this.getContext()),o=n.enabled&&r.options.animation&&n.animations,s=new GN(this.chart,o);return o._cacheable&&(this._cachedAnimations=Object.freeze(s)),s}getContext(){return this.$context||(this.$context=r1e(this.chart.getContext(),this,this._tooltipItems))}getTitle(e,r){let{callbacks:n}=r,o=Wo(n,"beforeTitle",this,e),s=Wo(n,"title",this,e),i=Wo(n,"afterTitle",this,e),a=[];return a=da(a,lu(o)),a=da(a,lu(s)),a=da(a,lu(i)),a}getBeforeBody(e,r){return cX(Wo(r.callbacks,"beforeBody",this,e))}getBody(e,r){let{callbacks:n}=r,o=[];return At(e,s=>{let i={before:[],lines:[],after:[]},a=pX(n,s);da(i.before,lu(Wo(a,"beforeLabel",this,s))),da(i.lines,Wo(a,"label",this,s)),da(i.after,lu(Wo(a,"afterLabel",this,s))),o.push(i)}),o}getAfterBody(e,r){return cX(Wo(r.callbacks,"afterBody",this,e))}getFooter(e,r){let{callbacks:n}=r,o=Wo(n,"beforeFooter",this,e),s=Wo(n,"footer",this,e),i=Wo(n,"afterFooter",this,e),a=[];return a=da(a,lu(o)),a=da(a,lu(s)),a=da(a,lu(i)),a}_createItems(e){let r=this._active,n=this.chart.data,o=[],s=[],i=[],a=[],l,u;for(l=0,u=r.length;l<u;++l)a.push(Yve(this.chart,r[l]));return e.filter&&(a=a.filter((c,p,f)=>e.filter(c,p,f,n))),e.itemSort&&(a=a.sort((c,p)=>e.itemSort(c,p,n))),At(a,c=>{let p=pX(e.callbacks,c);o.push(Wo(p,"labelColor",this,c)),s.push(Wo(p,"labelPointStyle",this,c)),i.push(Wo(p,"labelTextColor",this,c))}),this.labelColors=o,this.labelPointStyles=s,this.labelTextColors=i,this.dataPoints=a,a}update(e,r){let n=this.options.setContext(this.getContext()),o=this._active,s,i=[];if(!o.length)this.opacity!==0&&(s={opacity:0});else{let a=bv[n.position].call(this,o,this._eventPosition);i=this._createItems(n),this.title=this.getTitle(i,n),this.beforeBody=this.getBeforeBody(i,n),this.body=this.getBody(i,n),this.afterBody=this.getAfterBody(i,n),this.footer=this.getFooter(i,n);let l=this._size=aX(this,n),u=Object.assign({},a,l),c=lX(this.chart,n,u),p=uX(n,u,c,this.chart);this.xAlign=c.xAlign,this.yAlign=c.yAlign,s={opacity:1,x:p.x,y:p.y,width:l.width,height:l.height,caretX:a.x,caretY:a.y}}this._tooltipItems=i,this.$context=void 0,s&&this._resolveAnimations().update(this,s),e&&n.external&&n.external.call(this,{chart:this.chart,tooltip:this,replay:r})}drawCaret(e,r,n,o){let s=this.getCaretPosition(e,n,o);r.lineTo(s.x1,s.y1),r.lineTo(s.x2,s.y2),r.lineTo(s.x3,s.y3)}getCaretPosition(e,r,n){let{xAlign:o,yAlign:s}=this,{caretSize:i,cornerRadius:a}=n,{topLeft:l,topRight:u,bottomLeft:c,bottomRight:p}=ou(a),{x:f,y:d}=e,{width:m,height:h}=r,x,g,y,b,v,C;return s==="center"?(v=d+h/2,o==="left"?(x=f,g=x-i,b=v+i,C=v-i):(x=f+m,g=x+i,b=v-i,C=v+i),y=x):(o==="left"?g=f+Math.max(l,c)+i:o==="right"?g=f+m-Math.max(u,p)-i:g=this.caretX,s==="top"?(b=d,v=b-i,x=g-i,y=g+i):(b=d+h,v=b+i,x=g+i,y=g-i),C=b),{x1:x,x2:g,x3:y,y1:b,y2:v,y3:C}}drawTitle(e,r,n){let o=this.title,s=o.length,i,a,l;if(s){let u=fv(n.rtl,this.x,this.width);for(e.x=LN(this,n.titleAlign,n),r.textAlign=u.textAlign(n.titleAlign),r.textBaseline="middle",i=yo(n.titleFont),a=n.titleSpacing,r.fillStyle=n.titleColor,r.font=i.string,l=0;l<s;++l)r.fillText(o[l],u.x(e.x),e.y+i.lineHeight/2),e.y+=i.lineHeight+a,l+1===s&&(e.y+=n.titleMarginBottom-a)}}_drawColorBox(e,r,n,o,s){let i=this.labelColors[n],a=this.labelPointStyles[n],{boxHeight:l,boxWidth:u,boxPadding:c}=s,p=yo(s.bodyFont),f=LN(this,"left",s),d=o.x(f),m=l<p.lineHeight?(p.lineHeight-l)/2:0,h=r.y+m;if(s.usePointStyle){let x={radius:Math.min(u,l)/2,pointStyle:a.pointStyle,rotation:a.rotation,borderWidth:1},g=o.leftForLtr(d,u)+u/2,y=h+l/2;e.strokeStyle=s.multiKeyBackground,e.fillStyle=s.multiKeyBackground,SN(e,x,g,y),e.strokeStyle=i.borderColor,e.fillStyle=i.backgroundColor,SN(e,x,g,y)}else{e.lineWidth=dt(i.borderWidth)?Math.max(...Object.values(i.borderWidth)):i.borderWidth||1,e.strokeStyle=i.borderColor,e.setLineDash(i.borderDash||[]),e.lineDashOffset=i.borderDashOffset||0;let x=o.leftForLtr(d,u-c),g=o.leftForLtr(o.xPlus(d,1),u-c-2),y=ou(i.borderRadius);Object.values(y).some(b=>b!==0)?(e.beginPath(),e.fillStyle=s.multiKeyBackground,nu(e,{x,y:h,w:u,h:l,radius:y}),e.fill(),e.stroke(),e.fillStyle=i.backgroundColor,e.beginPath(),nu(e,{x:g,y:h+1,w:u-2,h:l-2,radius:y}),e.fill()):(e.fillStyle=s.multiKeyBackground,e.fillRect(x,h,u,l),e.strokeRect(x,h,u,l),e.fillStyle=i.backgroundColor,e.fillRect(g,h+1,u-2,l-2))}e.fillStyle=this.labelTextColors[n]}drawBody(e,r,n){let{body:o}=this,{bodySpacing:s,bodyAlign:i,displayColors:a,boxHeight:l,boxWidth:u,boxPadding:c}=n,p=yo(n.bodyFont),f=p.lineHeight,d=0,m=fv(n.rtl,this.x,this.width),h=function(I){r.fillText(I,m.x(e.x+d),e.y+f/2),e.y+=f+s},x=m.textAlign(i),g,y,b,v,C,S,k;for(r.textAlign=i,r.textBaseline="middle",r.font=p.string,e.x=LN(this,x,n),r.fillStyle=n.bodyColor,At(this.beforeBody,h),d=a&&x!=="right"?i==="center"?u/2+c:u+2+c:0,v=0,S=o.length;v<S;++v){for(g=o[v],y=this.labelTextColors[v],r.fillStyle=y,At(g.before,h),b=g.lines,a&&b.length&&(this._drawColorBox(r,e,v,m,n),f=Math.max(p.lineHeight,l)),C=0,k=b.length;C<k;++C)h(b[C]),f=p.lineHeight;At(g.after,h)}d=0,f=p.lineHeight,At(this.afterBody,h),e.y-=s}drawFooter(e,r,n){let o=this.footer,s=o.length,i,a;if(s){let l=fv(n.rtl,this.x,this.width);for(e.x=LN(this,n.footerAlign,n),e.y+=n.footerMarginTop,r.textAlign=l.textAlign(n.footerAlign),r.textBaseline="middle",i=yo(n.footerFont),r.fillStyle=n.footerColor,r.font=i.string,a=0;a<s;++a)r.fillText(o[a],l.x(e.x),e.y+i.lineHeight/2),e.y+=i.lineHeight+n.footerSpacing}}drawBackground(e,r,n,o){let{xAlign:s,yAlign:i}=this,{x:a,y:l}=e,{width:u,height:c}=n,{topLeft:p,topRight:f,bottomLeft:d,bottomRight:m}=ou(o.cornerRadius);r.fillStyle=o.backgroundColor,r.strokeStyle=o.borderColor,r.lineWidth=o.borderWidth,r.beginPath(),r.moveTo(a+p,l),i==="top"&&this.drawCaret(e,r,n,o),r.lineTo(a+u-f,l),r.quadraticCurveTo(a+u,l,a+u,l+f),i==="center"&&s==="right"&&this.drawCaret(e,r,n,o),r.lineTo(a+u,l+c-m),r.quadraticCurveTo(a+u,l+c,a+u-m,l+c),i==="bottom"&&this.drawCaret(e,r,n,o),r.lineTo(a+d,l+c),r.quadraticCurveTo(a,l+c,a,l+c-d),i==="center"&&s==="left"&&this.drawCaret(e,r,n,o),r.lineTo(a,l+p),r.quadraticCurveTo(a,l,a+p,l),r.closePath(),r.fill(),o.borderWidth>0&&r.stroke()}_updateAnimationTarget(e){let r=this.chart,n=this.$animations,o=n&&n.x,s=n&&n.y;if(o||s){let i=bv[e.position].call(this,this._active,this._eventPosition);if(!i)return;let a=this._size=aX(this,e),l=Object.assign({},i,this._size),u=lX(r,e,l),c=uX(e,l,u,r);(o._to!==c.x||s._to!==c.y)&&(this.xAlign=u.xAlign,this.yAlign=u.yAlign,this.width=a.width,this.height=a.height,this.caretX=i.x,this.caretY=i.y,this._resolveAnimations().update(this,c))}}_willRender(){return!!this.opacity}draw(e){let r=this.options.setContext(this.getContext()),n=this.opacity;if(!n)return;this._updateAnimationTarget(r);let o={width:this.width,height:this.height},s={x:this.x,y:this.y};n=Math.abs(n)<.001?0:n;let i=Vo(r.padding),a=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;r.enabled&&a&&(e.save(),e.globalAlpha=n,this.drawBackground(s,e,o,r),uO(e,r.textDirection),s.y+=i.top,this.drawTitle(s,e,r),this.drawBody(s,e,r),this.drawFooter(s,e,r),cO(e,r.textDirection),e.restore())}getActiveElements(){return this._active||[]}setActiveElements(e,r){let n=this._active,o=e.map(({datasetIndex:a,index:l})=>{let u=this.chart.getDatasetMeta(a);if(!u)throw new Error("Cannot find a dataset at index "+a);return{datasetIndex:a,element:u.data[l],index:l}}),s=!qg(n,o),i=this._positionChanged(o,r);(s||i)&&(this._active=o,this._eventPosition=r,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(e,r,n=!0){if(r&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;let o=this.options,s=this._active||[],i=this._getActiveElements(e,s,r,n),a=this._positionChanged(i,e),l=r||!qg(i,s)||a;return l&&(this._active=i,(o.enabled||o.external)&&(this._eventPosition={x:e.x,y:e.y},this.update(!0,r))),l}_getActiveElements(e,r,n,o){let s=this.options;if(e.type==="mouseout")return[];if(!o)return r;let i=this.chart.getElementsAtEventForMode(e,s.mode,s,n);return s.reverse&&i.reverse(),i}_positionChanged(e,r){let{caretX:n,caretY:o,options:s}=this,i=bv[s.position].call(this,e,r);return i!==!1&&(n!==i.x||o!==i.y)}};Bt(vv,"positioners",bv);var DX={id:"tooltip",_element:vv,positioners:bv,afterInit(t,e,r){r&&(t.tooltip=new vv({chart:t,options:r}))},beforeUpdate(t,e,r){t.tooltip&&t.tooltip.initialize(r)},reset(t,e,r){t.tooltip&&t.tooltip.initialize(r)},afterDraw(t){let e=t.tooltip;if(e&&e._willRender()){let r={tooltip:e};if(t.notifyPlugins("beforeTooltipDraw",{...r,cancelable:!0})===!1)return;e.draw(t.ctx),t.notifyPlugins("afterTooltipDraw",r)}},afterEvent(t,e){if(t.tooltip){let r=e.replay;t.tooltip.handleEvent(e.event,r,e.inChartArea)&&(e.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(t,e)=>e.bodyFont.size,boxWidth:(t,e)=>e.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:AX},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:t=>t!=="filter"&&t!=="itemSort"&&t!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]};var n1e=(t,e,r,n)=>(typeof e=="string"?(r=t.push(e)-1,n.unshift({index:r,label:e})):isNaN(e)&&(r=null),r);function o1e(t,e,r,n){let o=t.indexOf(e);if(o===-1)return n1e(t,e,r,n);let s=t.lastIndexOf(e);return o!==s?r:o}var s1e=(t,e)=>t===null?null:Js(Math.round(t),0,e);function fX(t){let e=this.getLabels();return t>=0&&t<e.length?e[t]:t}var tx=class extends cu{constructor(e){super(e),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(e){let r=this._addedLabels;if(r.length){let n=this.getLabels();for(let{index:o,label:s}of r)n[o]===s&&n.splice(o,1);this._addedLabels=[]}super.init(e)}parse(e,r){if(or(e))return null;let n=this.getLabels();return r=isFinite(r)&&n[r]===e?r:o1e(n,e,xr(r,e),this._addedLabels),s1e(r,n.length-1)}determineDataLimits(){let{minDefined:e,maxDefined:r}=this.getUserBounds(),{min:n,max:o}=this.getMinMax(!0);this.options.bounds==="ticks"&&(e||(n=0),r||(o=this.getLabels().length-1)),this.min=n,this.max=o}buildTicks(){let e=this.min,r=this.max,n=this.options.offset,o=[],s=this.getLabels();s=e===0&&r===s.length-1?s:s.slice(e,r+1),this._valueRange=Math.max(s.length-(n?0:1),1),this._startValue=this.min-(n?.5:0);for(let i=e;i<=r;i++)o.push({value:i});return o}getLabelForValue(e){return fX.call(this,e)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(e){return typeof e!="number"&&(e=this.parse(e)),e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getPixelForTick(e){let r=this.ticks;return e<0||e>r.length-1?null:this.getPixelForValue(r[e].value)}getValueForPixel(e){return Math.round(this._startValue+this.getDecimalForPixel(e)*this._valueRange)}getBasePixel(){return this.bottom}};Bt(tx,"id","category"),Bt(tx,"defaults",{ticks:{callback:fX}});function i1e(t,e){let r=[],{bounds:o,step:s,min:i,max:a,precision:l,count:u,maxTicks:c,maxDigits:p,includeBounds:f}=t,d=s||1,m=c-1,{min:h,max:x}=e,g=!or(i),y=!or(a),b=!or(u),v=(x-h)/(p+1),C=fN((x-h)/m/d)*d,S,k,I,A;if(C<1e-14&&!g&&!y)return[{value:h},{value:x}];A=Math.ceil(x/C)-Math.floor(h/C),A>m&&(C=fN(A*C/m/d)*d),or(l)||(S=Math.pow(10,l),C=Math.ceil(C*S)/S),o==="ticks"?(k=Math.floor(h/C)*C,I=Math.ceil(x/C)*C):(k=h,I=x),g&&y&&s&&BR((a-i)/s,C/1e3)?(A=Math.round(Math.min((a-i)/C,c)),C=(a-i)/A,k=i,I=a):b?(k=g?i:k,I=y?a:I,A=u-1,C=(I-k)/A):(A=(I-k)/C,Xg(A,Math.round(A),C/1e3)?A=Math.round(A):A=Math.ceil(A));let $=Math.max(mN(C),mN(k));S=Math.pow(10,or(l)?$:l),k=Math.round(k*S)/S,I=Math.round(I*S)/S;let O=0;for(g&&(f&&k!==i?(r.push({value:i}),k<i&&O++,Xg(Math.round((k+O*C)*S)/S,i,dX(i,v,t))&&O++):k<i&&O++);O<A;++O)r.push({value:Math.round((k+O*C)*S)/S});return y&&f&&I!==a?r.length&&Xg(r[r.length-1].value,a,dX(a,v,t))?r[r.length-1].value=a:r.push({value:a}):(!y||I===a)&&r.push({value:I}),r}function dX(t,e,{horizontal:r,minRotation:n}){let o=fa(n),s=(r?Math.sin(o):Math.cos(o))||.001,i=.75*e*(""+t).length;return Math.min(e/s,i)}var ox=class extends cu{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(e,r){return or(e)||(typeof e=="number"||e instanceof Number)&&!isFinite(+e)?null:+e}handleTickRangeOptions(){let{beginAtZero:e}=this.options,{minDefined:r,maxDefined:n}=this.getUserBounds(),{min:o,max:s}=this,i=l=>o=r?o:l,a=l=>s=n?s:l;if(e){let l=Kg(o),u=Kg(s);l<0&&u<0?a(0):l>0&&u>0&&i(0)}if(o===s){let l=s===0?1:Math.abs(s*.05);a(s+l),e||i(o-l)}this.min=o,this.max=s}getTickLimit(){let e=this.options.ticks,{maxTicksLimit:r,stepSize:n}=e,o;return n?(o=Math.ceil(this.max/n)-Math.floor(this.min/n)+1,o>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${n} would result generating up to ${o} ticks. Limiting to 1000.`),o=1e3)):(o=this.computeTickLimit(),r=r||11),r&&(o=Math.min(r,o)),o}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){let e=this.options,r=e.ticks,n=this.getTickLimit();n=Math.max(2,n);let o={maxTicks:n,bounds:e.bounds,min:e.min,max:e.max,precision:r.precision,step:r.stepSize,count:r.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:r.minRotation||0,includeBounds:r.includeBounds!==!1},s=this._range||this,i=i1e(o,s);return e.bounds==="ticks"&&dN(i,this,"value"),e.reverse?(i.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),i}configure(){let e=this.ticks,r=this.min,n=this.max;if(super.configure(),this.options.offset&&e.length){let o=(n-r)/Math.max(e.length-1,1)/2;r-=o,n+=o}this._startValue=r,this._endValue=n,this._valueRange=n-r}getLabelForValue(e){return lv(e,this.chart.options.locale,this.options.ticks.format)}},rx=class extends ox{determineDataLimits(){let{min:e,max:r}=this.getMinMax(!0);this.min=Zr(e)?e:0,this.max=Zr(r)?r:1,this.handleTickRangeOptions()}computeTickLimit(){let e=this.isHorizontal(),r=e?this.width:this.height,n=fa(this.options.ticks.minRotation),o=(e?Math.sin(n):Math.cos(n))||.001,s=this._resolveTickFontOptions(0);return Math.ceil(r/Math.min(40,s.lineHeight/o))}getPixelForValue(e){return e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getValueForPixel(e){return this._startValue+this.getDecimalForPixel(e)*this._valueRange}};Bt(rx,"id","linear"),Bt(rx,"defaults",{ticks:{callback:uv.formatters.numeric}});var Sv=t=>Math.floor(pa(t)),md=(t,e)=>Math.pow(10,Sv(t)+e);function mX(t){return t/Math.pow(10,Sv(t))===1}function hX(t,e,r){let n=Math.pow(10,r),o=Math.floor(t/n);return Math.ceil(e/n)-o}function a1e(t,e){let r=e-t,n=Sv(r);for(;hX(t,e,n)>10;)n++;for(;hX(t,e,n)<10;)n--;return Math.min(n,Sv(t))}function l1e(t,{min:e,max:r}){e=xo(t.min,e);let n=[],o=Sv(e),s=a1e(e,r),i=s<0?Math.pow(10,Math.abs(s)):1,a=Math.pow(10,s),l=o>s?Math.pow(10,o):0,u=Math.round((e-l)*i)/i,c=Math.floor((e-l)/a/10)*a*10,p=Math.floor((u-c)/Math.pow(10,s)),f=xo(t.min,Math.round((l+c+p*Math.pow(10,s))*i)/i);for(;f<r;)n.push({value:f,major:mX(f),significand:p}),p>=10?p=p<15?15:20:p++,p>=20&&(s++,p=2,i=s>=0?1:i),f=Math.round((l+c+p*Math.pow(10,s))*i)/i;let d=xo(t.max,f);return n.push({value:d,major:mX(d),significand:p}),n}var MN=class extends cu{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(e,r){let n=ox.prototype.parse.apply(this,[e,r]);if(n===0){this._zero=!0;return}return Zr(n)&&n>0?n:null}determineDataLimits(){let{min:e,max:r}=this.getMinMax(!0);this.min=Zr(e)?Math.max(0,e):null,this.max=Zr(r)?Math.max(0,r):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!Zr(this._userMin)&&(this.min=e===md(this.min,0)?md(this.min,-1):md(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){let{minDefined:e,maxDefined:r}=this.getUserBounds(),n=this.min,o=this.max,s=a=>n=e?n:a,i=a=>o=r?o:a;n===o&&(n<=0?(s(1),i(10)):(s(md(n,-1)),i(md(o,1)))),n<=0&&s(md(o,-1)),o<=0&&i(md(n,1)),this.min=n,this.max=o}buildTicks(){let e=this.options,r={min:this._userMin,max:this._userMax},n=l1e(r,this);return e.bounds==="ticks"&&dN(n,this,"value"),e.reverse?(n.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),n}getLabelForValue(e){return e===void 0?"0":lv(e,this.chart.options.locale,this.options.ticks.format)}configure(){let e=this.min;super.configure(),this._startValue=pa(e),this._valueRange=pa(this.max)-pa(e)}getPixelForValue(e){return(e===void 0||e===0)&&(e=this.min),e===null||isNaN(e)?NaN:this.getPixelForDecimal(e===this.min?0:(pa(e)-this._startValue)/this._valueRange)}getValueForPixel(e){let r=this.getDecimalForPixel(e);return Math.pow(10,this._startValue+r*this._valueRange)}};Bt(MN,"id","logarithmic"),Bt(MN,"defaults",{ticks:{callback:uv.formatters.logarithmic,major:{enabled:!0}}});function kO(t){let e=t.ticks;if(e.display&&t.display){let r=Vo(e.backdropPadding);return xr(e.font&&e.font.size,Wr.font.size)+r.height}return 0}function u1e(t,e,r){return r=yr(r)?r:[r],{w:tO(t,e.string,r),h:r.length*e.lineHeight}}function gX(t,e,r,n,o){return t===n||t===o?{start:e-r/2,end:e+r/2}:t<n||t>o?{start:e-r,end:e}:{start:e,end:e+r}}function c1e(t){let e={l:t.left+t._padding.left,r:t.right-t._padding.right,t:t.top+t._padding.top,b:t.bottom-t._padding.bottom},r=Object.assign({},e),n=[],o=[],s=t._pointLabels.length,i=t.options.pointLabels,a=i.centerPointLabels?En/s:0;for(let l=0;l<s;l++){let u=i.setContext(t.getPointLabelContext(l));o[l]=u.padding;let c=t.getPointPosition(l,t.drawingArea+o[l],a),p=yo(u.font),f=u1e(t.ctx,p,t._pointLabels[l]);n[l]=f;let d=Zs(t.getIndexAngle(l)+a),m=Math.round(ov(d)),h=gX(m,c.x,f.w,0,180),x=gX(m,c.y,f.h,90,270);p1e(r,e,d,h,x)}t.setCenterPoint(e.l-r.l,r.r-e.r,e.t-r.t,r.b-e.b),t._pointLabelItems=f1e(t,n,o)}function p1e(t,e,r,n,o){let s=Math.abs(Math.sin(r)),i=Math.abs(Math.cos(r)),a=0,l=0;n.start<e.l?(a=(e.l-n.start)/s,t.l=Math.min(t.l,e.l-a)):n.end>e.r&&(a=(n.end-e.r)/s,t.r=Math.max(t.r,e.r+a)),o.start<e.t?(l=(e.t-o.start)/i,t.t=Math.min(t.t,e.t-l)):o.end>e.b&&(l=(o.end-e.b)/i,t.b=Math.max(t.b,e.b+l))}function f1e(t,e,r){let n=[],o=t._pointLabels.length,s=t.options,i=kO(s)/2,a=t.drawingArea,l=s.pointLabels.centerPointLabels?En/o:0;for(let u=0;u<o;u++){let c=t.getPointPosition(u,a+i+r[u],l),p=Math.round(ov(Zs(c.angle+no))),f=e[u],d=h1e(c.y,f.h,p),m=d1e(p),h=m1e(c.x,f.w,m);n.push({x:c.x,y:d,textAlign:m,left:h,top:d,right:h+f.w,bottom:d+f.h})}return n}function d1e(t){return t===0||t===180?"center":t<180?"left":"right"}function m1e(t,e,r){return r==="right"?t-=e:r==="center"&&(t-=e/2),t}function h1e(t,e,r){return r===90||r===270?t-=e/2:(r>270||r<90)&&(t-=e),t}function g1e(t,e){let{ctx:r,options:{pointLabels:n}}=t;for(let o=e-1;o>=0;o--){let s=n.setContext(t.getPointLabelContext(o)),i=yo(s.font),{x:a,y:l,textAlign:u,left:c,top:p,right:f,bottom:d}=t._pointLabelItems[o],{backdropColor:m}=s;if(!or(m)){let h=ou(s.borderRadius),x=Vo(s.backdropPadding);r.fillStyle=m;let g=c-x.left,y=p-x.top,b=f-c+x.width,v=d-p+x.height;Object.values(h).some(C=>C!==0)?(r.beginPath(),nu(r,{x:g,y,w:b,h:v,radius:h}),r.fill()):r.fillRect(g,y,b,v)}Qg(r,t._pointLabels[o],a,l+i.lineHeight/2,i,{color:s.color,textAlign:u,textBaseline:"middle"})}}function $X(t,e,r,n){let{ctx:o}=t;if(r)o.arc(t.xCenter,t.yCenter,e,0,ps);else{let s=t.getPointPosition(0,e);o.moveTo(s.x,s.y);for(let i=1;i<n;i++)s=t.getPointPosition(i,e),o.lineTo(s.x,s.y)}}function x1e(t,e,r,n,o){let s=t.ctx,i=e.circular,{color:a,lineWidth:l}=e;!i&&!n||!a||!l||r<0||(s.save(),s.strokeStyle=a,s.lineWidth=l,s.setLineDash(o.dash),s.lineDashOffset=o.dashOffset,s.beginPath(),$X(t,r,i,n),s.closePath(),s.stroke(),s.restore())}function y1e(t,e,r){return su(t,{label:r,index:e,type:"pointLabel"})}var Jg=class extends ox{constructor(e){super(e),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){let e=this._padding=Vo(kO(this.options)/2),r=this.width=this.maxWidth-e.width,n=this.height=this.maxHeight-e.height;this.xCenter=Math.floor(this.left+r/2+e.left),this.yCenter=Math.floor(this.top+n/2+e.top),this.drawingArea=Math.floor(Math.min(r,n)/2)}determineDataLimits(){let{min:e,max:r}=this.getMinMax(!1);this.min=Zr(e)&&!isNaN(e)?e:0,this.max=Zr(r)&&!isNaN(r)?r:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/kO(this.options))}generateTickLabels(e){ox.prototype.generateTickLabels.call(this,e),this._pointLabels=this.getLabels().map((r,n)=>{let o=br(this.options.pointLabels.callback,[r,n],this);return o||o===0?o:""}).filter((r,n)=>this.chart.getDataVisibility(n))}fit(){let e=this.options;e.display&&e.pointLabels.display?c1e(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(e,r,n,o){this.xCenter+=Math.floor((e-r)/2),this.yCenter+=Math.floor((n-o)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(e,r,n,o))}getIndexAngle(e){let r=ps/(this._pointLabels.length||1),n=this.options.startAngle||0;return Zs(e*r+fa(n))}getDistanceFromCenterForValue(e){if(or(e))return NaN;let r=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-e)*r:(e-this.min)*r}getValueForDistanceFromCenter(e){if(or(e))return NaN;let r=e/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-r:this.min+r}getPointLabelContext(e){let r=this._pointLabels||[];if(e>=0&&e<r.length){let n=r[e];return y1e(this.getContext(),e,n)}}getPointPosition(e,r,n=0){let o=this.getIndexAngle(e)-no+n;return{x:Math.cos(o)*r+this.xCenter,y:Math.sin(o)*r+this.yCenter,angle:o}}getPointPositionForValue(e,r){return this.getPointPosition(e,this.getDistanceFromCenterForValue(r))}getBasePosition(e){return this.getPointPositionForValue(e||0,this.getBaseValue())}getPointLabelPosition(e){let{left:r,top:n,right:o,bottom:s}=this._pointLabelItems[e];return{left:r,top:n,right:o,bottom:s}}drawBackground(){let{backgroundColor:e,grid:{circular:r}}=this.options;if(e){let n=this.ctx;n.save(),n.beginPath(),$X(this,this.getDistanceFromCenterForValue(this._endValue),r,this._pointLabels.length),n.closePath(),n.fillStyle=e,n.fill(),n.restore()}}drawGrid(){let e=this.ctx,r=this.options,{angleLines:n,grid:o,border:s}=r,i=this._pointLabels.length,a,l,u;if(r.pointLabels.display&&g1e(this,i),o.display&&this.ticks.forEach((c,p)=>{if(p!==0){l=this.getDistanceFromCenterForValue(c.value);let f=this.getContext(p),d=o.setContext(f),m=s.setContext(f);x1e(this,d,l,i,m)}}),n.display){for(e.save(),a=i-1;a>=0;a--){let c=n.setContext(this.getPointLabelContext(a)),{color:p,lineWidth:f}=c;!f||!p||(e.lineWidth=f,e.strokeStyle=p,e.setLineDash(c.borderDash),e.lineDashOffset=c.borderDashOffset,l=this.getDistanceFromCenterForValue(r.ticks.reverse?this.min:this.max),u=this.getPointPosition(a,l),e.beginPath(),e.moveTo(this.xCenter,this.yCenter),e.lineTo(u.x,u.y),e.stroke())}e.restore()}}drawBorder(){}drawLabels(){let e=this.ctx,r=this.options,n=r.ticks;if(!n.display)return;let o=this.getIndexAngle(0),s,i;e.save(),e.translate(this.xCenter,this.yCenter),e.rotate(o),e.textAlign="center",e.textBaseline="middle",this.ticks.forEach((a,l)=>{if(l===0&&!r.reverse)return;let u=n.setContext(this.getContext(l)),c=yo(u.font);if(s=this.getDistanceFromCenterForValue(this.ticks[l].value),u.showLabelBackdrop){e.font=c.string,i=e.measureText(a.label).width,e.fillStyle=u.backdropColor;let p=Vo(u.backdropPadding);e.fillRect(-i/2-p.left,-s-c.size/2-p.top,i+p.width,c.size+p.height)}Qg(e,a.label,0,-s,c,{color:u.color})}),e.restore()}drawTitle(){}};Bt(Jg,"id","radialLinear"),Bt(Jg,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:uv.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(e){return e},padding:5,centerPointLabels:!1}}),Bt(Jg,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),Bt(Jg,"descriptors",{angleLines:{_fallback:"grid"}});var KN={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},Go=Object.keys(KN);function b1e(t,e){return t-e}function xX(t,e){if(or(e))return null;let r=t._adapter,{parser:n,round:o,isoWeekday:s}=t._parseOpts,i=e;return typeof n=="function"&&(i=n(i)),Zr(i)||(i=typeof n=="string"?r.parse(i,n):r.parse(i)),i===null?null:(o&&(i=o==="week"&&(Yg(s)||s===!0)?r.startOf(i,"isoWeek",s):r.startOf(i,o)),+i)}function yX(t,e,r,n){let o=Go.length;for(let s=Go.indexOf(t);s<o-1;++s){let i=KN[Go[s]],a=i.steps?i.steps:Number.MAX_SAFE_INTEGER;if(i.common&&Math.ceil((r-e)/(a*i.size))<=n)return Go[s]}return Go[o-1]}function v1e(t,e,r,n,o){for(let s=Go.length-1;s>=Go.indexOf(r);s--){let i=Go[s];if(KN[i].common&&t._adapter.diff(o,n,i)>=e-1)return i}return Go[r?Go.indexOf(r):0]}function w1e(t){for(let e=Go.indexOf(t)+1,r=Go.length;e<r;++e)if(KN[Go[e]].common)return Go[e]}function bX(t,e,r){if(!r)t[e]=!0;else if(r.length){let{lo:n,hi:o}=sv(r,e),s=r[n]>=e?r[n]:r[o];t[s]=!0}}function C1e(t,e,r,n){let o=t._adapter,s=+o.startOf(e[0].value,n),i=e[e.length-1].value,a,l;for(a=s;a<=i;a=+o.add(a,1,n))l=r[a],l>=0&&(e[l].major=!0);return e}function vX(t,e,r){let n=[],o={},s=e.length,i,a;for(i=0;i<s;++i)a=e[i],o[a]=i,n.push({value:a,major:!1});return s===0||!r?n:C1e(t,n,o,r)}var nx=class extends cu{constructor(e){super(e),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(e,r={}){let n=e.time||(e.time={}),o=this._adapter=new qbe._date(e.adapters.date);o.init(r),fd(n.displayFormats,o.formats()),this._parseOpts={parser:n.parser,round:n.round,isoWeekday:n.isoWeekday},super.init(e),this._normalized=r.normalized}parse(e,r){return e===void 0?null:xX(this,e)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){let e=this.options,r=this._adapter,n=e.time.unit||"day",{min:o,max:s,minDefined:i,maxDefined:a}=this.getUserBounds();function l(u){!i&&!isNaN(u.min)&&(o=Math.min(o,u.min)),!a&&!isNaN(u.max)&&(s=Math.max(s,u.max))}(!i||!a)&&(l(this._getLabelBounds()),(e.bounds!=="ticks"||e.ticks.source!=="labels")&&l(this.getMinMax(!1))),o=Zr(o)&&!isNaN(o)?o:+r.startOf(Date.now(),n),s=Zr(s)&&!isNaN(s)?s:+r.endOf(Date.now(),n)+1,this.min=Math.min(o,s-1),this.max=Math.max(o+1,s)}_getLabelBounds(){let e=this.getLabelTimestamps(),r=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;return e.length&&(r=e[0],n=e[e.length-1]),{min:r,max:n}}buildTicks(){let e=this.options,r=e.time,n=e.ticks,o=n.source==="labels"?this.getLabelTimestamps():this._generate();e.bounds==="ticks"&&o.length&&(this.min=this._userMin||o[0],this.max=this._userMax||o[o.length-1]);let s=this.min,i=this.max,a=qR(o,s,i);return this._unit=r.unit||(n.autoSkip?yX(r.minUnit,this.min,this.max,this._getLabelCapacity(s)):v1e(this,a.length,r.minUnit,this.min,this.max)),this._majorUnit=!n.major.enabled||this._unit==="year"?void 0:w1e(this._unit),this.initOffsets(o),e.reverse&&a.reverse(),vX(this,a,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(e=>+e.value))}initOffsets(e=[]){let r=0,n=0,o,s;this.options.offset&&e.length&&(o=this.getDecimalForValue(e[0]),e.length===1?r=1-o:r=(this.getDecimalForValue(e[1])-o)/2,s=this.getDecimalForValue(e[e.length-1]),e.length===1?n=s:n=(s-this.getDecimalForValue(e[e.length-2]))/2);let i=e.length<3?.5:.25;r=Js(r,0,i),n=Js(n,0,i),this._offsets={start:r,end:n,factor:1/(r+1+n)}}_generate(){let e=this._adapter,r=this.min,n=this.max,o=this.options,s=o.time,i=s.unit||yX(s.minUnit,r,n,this._getLabelCapacity(r)),a=xr(o.ticks.stepSize,1),l=i==="week"?s.isoWeekday:!1,u=Yg(l)||l===!0,c={},p=r,f,d;if(u&&(p=+e.startOf(p,"isoWeek",l)),p=+e.startOf(p,u?"day":i),e.diff(n,r,i)>1e5*a)throw new Error(r+" and "+n+" are too far apart with stepSize of "+a+" "+i);let m=o.ticks.source==="data"&&this.getDataTimestamps();for(f=p,d=0;f<n;f=+e.add(f,a,i),d++)bX(c,f,m);return(f===n||o.bounds==="ticks"||d===1)&&bX(c,f,m),Object.keys(c).sort((h,x)=>h-x).map(h=>+h)}getLabelForValue(e){let r=this._adapter,n=this.options.time;return n.tooltipFormat?r.format(e,n.tooltipFormat):r.format(e,n.displayFormats.datetime)}_tickFormatFunction(e,r,n,o){let s=this.options,i=s.ticks.callback;if(i)return br(i,[e,r,n],this);let a=s.time.displayFormats,l=this._unit,u=this._majorUnit,c=l&&a[l],p=u&&a[u],f=n[r],d=u&&p&&f&&f.major;return this._adapter.format(e,o||(d?p:c))}generateTickLabels(e){let r,n,o;for(r=0,n=e.length;r<n;++r)o=e[r],o.label=this._tickFormatFunction(o.value,r,e)}getDecimalForValue(e){return e===null?NaN:(e-this.min)/(this.max-this.min)}getPixelForValue(e){let r=this._offsets,n=this.getDecimalForValue(e);return this.getPixelForDecimal((r.start+n)*r.factor)}getValueForPixel(e){let r=this._offsets,n=this.getDecimalForPixel(e)/r.factor-r.end;return this.min+n*(this.max-this.min)}_getLabelSize(e){let r=this.options.ticks,n=this.ctx.measureText(e).width,o=fa(this.isHorizontal()?r.maxRotation:r.minRotation),s=Math.cos(o),i=Math.sin(o),a=this._resolveTickFontOptions(0).size;return{w:n*s+a*i,h:n*i+a*s}}_getLabelCapacity(e){let r=this.options.time,n=r.displayFormats,o=n[r.unit]||n.millisecond,s=this._tickFormatFunction(e,0,vX(this,[e],this._majorUnit),o),i=this._getLabelSize(s),a=Math.floor(this.isHorizontal()?this.width/i.w:this.height/i.h)-1;return a>0?a:1}getDataTimestamps(){let e=this._cache.data||[],r,n;if(e.length)return e;let o=this.getMatchingVisibleMetas();if(this._normalized&&o.length)return this._cache.data=o[0].controller.getAllParsedValues(this);for(r=0,n=o.length;r<n;++r)e=e.concat(o[r].controller.getAllParsedValues(this));return this._cache.data=this.normalize(e)}getLabelTimestamps(){let e=this._cache.labels||[],r,n;if(e.length)return e;let o=this.getLabels();for(r=0,n=o.length;r<n;++r)e.push(xX(this,o[r]));return this._cache.labels=this._normalized?e:this.normalize(e)}normalize(e){return KR(e.sort(b1e))}};Bt(nx,"id","time"),Bt(nx,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function zN(t,e,r){let n=0,o=t.length-1,s,i,a,l;r?(e>=t[n].pos&&e<=t[o].pos&&({lo:n,hi:o}=iv(t,"pos",e)),{pos:s,time:a}=t[n],{pos:i,time:l}=t[o]):(e>=t[n].time&&e<=t[o].time&&({lo:n,hi:o}=iv(t,"time",e)),{time:s,pos:a}=t[n],{time:i,pos:l}=t[o]);let u=i-s;return u?a+(l-a)*(e-s)/u:a}var BN=class extends nx{constructor(e){super(e),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){let e=this._getTimestampsForTable(),r=this._table=this.buildLookupTable(e);this._minPos=zN(r,this.min),this._tableRange=zN(r,this.max)-this._minPos,super.initOffsets(e)}buildLookupTable(e){let{min:r,max:n}=this,o=[],s=[],i,a,l,u,c;for(i=0,a=e.length;i<a;++i)u=e[i],u>=r&&u<=n&&o.push(u);if(o.length<2)return[{time:r,pos:0},{time:n,pos:1}];for(i=0,a=o.length;i<a;++i)c=o[i+1],l=o[i-1],u=o[i],Math.round((c+l)/2)!==u&&s.push({time:u,pos:i/(a-1)});return s}_getTimestampsForTable(){let e=this._cache.all||[];if(e.length)return e;let r=this.getDataTimestamps(),n=this.getLabelTimestamps();return r.length&&n.length?e=this.normalize(r.concat(n)):e=r.length?r:n,e=this._cache.all=e,e}getDecimalForValue(e){return(zN(this._table,e)-this._minPos)/this._tableRange}getValueForPixel(e){let r=this._offsets,n=this.getDecimalForPixel(e)/r.factor-r.end;return zN(this._table,n*this._tableRange+this._minPos,!0)}};Bt(BN,"id","timeseries"),Bt(BN,"defaults",nx.defaults);var S1e="1.3.0",gp=class extends hp{initialize(){this.enableOptionSharing=!0,super.initialize()}update(e){let r=this,n=r._cachedMeta;r.updateElements(n.data,0,n.data.length,e)}updateElements(e,r,n,o){let s=this,i=o==="reset",{xScale:a,yScale:l}=s._cachedMeta,u=s.resolveDataElementOptions(r,o),c=s.getSharedOptions(o,e[r],u);for(let p=r;p<r+n;p++){let f=!i&&s.getParsed(p),d=i?a.getBasePixel():a.getPixelForValue(f.x),m=i?l.getBasePixel():l.getPixelForValue(f.y),h=s.resolveDataElementOptions(p,o),{width:x,height:g,anchorX:y,anchorY:b}=h,v={x:k1e(y,d,x),y:T1e(b,m,g),width:x,height:g,options:h};s.updateElement(e[p],p,v,o)}s.updateSharedOptions(c,o)}draw(){let e=this,r=e.getMeta().data||[],n,o;for(n=0,o=r.length;n<o;++n)r[n].draw(e._ctx)}};function k1e(t,e,r){return t==="left"||t==="start"?e:t==="right"||t==="end"?e-r:e-r/2}function T1e(t,e,r){return t==="top"||t==="start"?e:t==="bottom"||t==="end"?e-r:e-r/2}gp.id="matrix";gp.version=S1e;gp.defaults={dataElementType:"matrix",animations:{numbers:{type:"number",properties:["x","y","width","height"]}}};gp.overrides={interaction:{mode:"nearest",intersect:!0},scales:{x:{type:"linear",offset:!0},y:{type:"linear",reverse:!0}}};function RX(t,e){let{x:r,y:n,width:o,height:s}=t.getProps(["x","y","width","height"],e);return{left:r,top:n,right:r+o,bottom:n+s}}function XN(t,e,r){return Math.max(Math.min(t,r),e)}function N1e(t,e,r){let n=t.options.borderWidth,o,s,i,a;return dt(n)?(o=+n.top||0,s=+n.right||0,i=+n.bottom||0,a=+n.left||0):o=s=i=a=+n||0,{t:XN(o,0,r),r:XN(s,0,e),b:XN(i,0,r),l:XN(a,0,e)}}function I1e(t){let e=RX(t),r=e.right-e.left,n=e.bottom-e.top,o=N1e(t,r/2,n/2);return{outer:{x:e.left,y:e.top,w:r,h:n},inner:{x:e.left+o.l,y:e.top+o.t,w:r-o.l-o.r,h:n-o.t-o.b}}}function TO(t,e,r,n){let o=e===null,s=r===null,i=!t||o&&s?!1:RX(t,n);return i&&(o||e>=i.left&&e<=i.right)&&(s||r>=i.top&&r<=i.bottom)}var sx=class extends uu{constructor(e){super(),this.options=void 0,this.width=void 0,this.height=void 0,e&&Object.assign(this,e)}draw(e){let r=this.options,{inner:n,outer:o}=I1e(this),s=ou(r.borderRadius);e.save(),o.w!==n.w||o.h!==n.h?(e.beginPath(),nu(e,{x:o.x,y:o.y,w:o.w,h:o.h,radius:s}),nu(e,{x:n.x,y:n.y,w:n.w,h:n.h,radius:s}),e.fillStyle=r.backgroundColor,e.fill(),e.fillStyle=r.borderColor,e.fill("evenodd")):(e.beginPath(),nu(e,{x:n.x,y:n.y,w:n.w,h:n.h,radius:s}),e.fillStyle=r.backgroundColor,e.fill()),e.restore()}inRange(e,r,n){return TO(this,e,r,n)}inXRange(e,r){return TO(this,e,null,r)}inYRange(e,r){return TO(this,null,e,r)}getCenterPoint(e){let{x:r,y:n,width:o,height:s}=this.getProps(["x","y","width","height"],e);return{x:r+o/2,y:n+s/2}}tooltipPosition(){return this.getCenterPoint()}getRange(e){return e==="x"?this.width/2:this.height/2}};sx.id="matrix";sx.defaults={backgroundColor:void 0,borderColor:void 0,borderWidth:void 0,borderRadius:0,anchorX:"center",anchorY:"center",width:20,height:20};var Uo=nt(ct(),1);var FX="label";function OX(t,e){typeof t=="function"?t(e):t&&(t.current=e)}function E1e(t,e){let r=t.options;r&&e&&Object.assign(r,e)}function PX(t,e){t.labels=e}function LX(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:FX,n=[];t.datasets=e.map(o=>{let s=t.datasets.find(i=>i[r]===o[r]);return!s||!o.data||n.includes(s)?{...o}:(n.push(s),Object.assign(s,o),s)})}function _1e(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:FX,r={labels:[],datasets:[]};return PX(r,t.labels),LX(r,t.datasets,e),r}function A1e(t,e){let{height:r=150,width:n=300,redraw:o=!1,datasetIdKey:s,type:i,data:a,options:l,plugins:u=[],fallbackContent:c,updateMode:p,...f}=t,d=(0,Uo.useRef)(null),m=(0,Uo.useRef)(),h=()=>{!d.current||(m.current=new jN(d.current,{type:i,data:_1e(a,s),options:l&&{...l},plugins:u}),OX(e,m.current))},x=()=>{OX(e,null),m.current&&(m.current.destroy(),m.current=null)};return(0,Uo.useEffect)(()=>{!o&&m.current&&l&&E1e(m.current,l)},[o,l]),(0,Uo.useEffect)(()=>{!o&&m.current&&PX(m.current.config.data,a.labels)},[o,a.labels]),(0,Uo.useEffect)(()=>{!o&&m.current&&a.datasets&&LX(m.current.config.data,a.datasets,s)},[o,a.datasets]),(0,Uo.useEffect)(()=>{!m.current||(o?(x(),setTimeout(h)):m.current.update(p))},[o,l,a.labels,a.datasets,p]),(0,Uo.useEffect)(()=>{!m.current||(x(),setTimeout(h))},[i]),(0,Uo.useEffect)(()=>(h(),()=>x()),[]),Uo.default.createElement("canvas",Object.assign({ref:d,role:"img",height:r,width:n},f),c)}var MX=(0,Uo.forwardRef)(A1e);var YN=nt(Bf());jN.register(tx,DX,sx,gp,rx);var D1e="rgb(200,200,200)";function QN({attention:t,maxValue:e=1,minValue:r=-1,negativeColor:n,positiveColor:o,upperTriColor:s=D1e,showAxisLabels:i=!0,zoomed:a=!1,maskUpperTri:l=!0,tokens:u}){let c=(0,xp.useMemo)(()=>u.map((m,h)=>`${m.replace(/\s/g,"")} (${h})`),[u]),f={datasets:[{data:(0,xp.useMemo)(()=>t.map((m,h)=>m.map((x,g)=>({srcIdx:g,destIdx:h,srcToken:u[g],destToken:u[h],x:c[g],y:c[h],v:x}))).flat(),[t,u,c]),backgroundColor(m){let h=m.dataset.data[m.dataIndex];return l&&h.srcIdx>h.destIdx?cr(s).toRgbString():lp(h.v,r,e,n,o).toRgbString()},width:m=>m.chart.chartArea.width/u.length,height:m=>m.chart.chartArea.height/u.length}]},d={animation:{duration:0},plugins:{tooltip:{enabled:i,yAlign:"bottom",callbacks:{title:()=>"",label({raw:m}){let h=m;return l&&h.destIdx<h.srcIdx?"N/A":[`(${h.destIdx}, ${h.srcIdx})`,`Src: ${h.srcToken}`,`Dest: ${h.destToken} `,`Val: ${h.v}`]}}}},scales:{x:{title:{display:!0,text:"Source Token",padding:1},type:"category",labels:c,offset:!0,ticks:{display:!0,minRotation:45,maxRotation:90},grid:{display:!1},display:i},y:{title:{display:!0,text:"Destination Token",padding:1},type:"category",offset:!0,labels:[...c].reverse(),ticks:{display:!0},grid:{display:!1},display:i}}};return xp.default.createElement(YN.Col,null,xp.default.createElement(YN.Row,null,xp.default.createElement("div",{style:{position:"relative",maxWidth:a?`min(100%, ${Math.round(u.length*8)}em)`:"initial",width:a?"initial":"100%",aspectRatio:"1/1"}},xp.default.createElement(MX,{type:"matrix",options:d,data:f,width:1e3,height:1e3,updateMode:"none"}))))}var NO=nt(ct());function hd(t=null){let[e,r]=(0,NO.useState)(null),[n,o]=(0,NO.useState)(t);function s(u){o(u)}function i(u){r(u)}function a(){r(null)}return{focused:e??n,onClick:s,onMouseEnter:i,onMouseLeave:a}}function ZN(t,e,r="100%"){return`hsla(${Math.round(t/e*360)}, 70%, 50%,  ${r})`}function $1e({attention:t,attentionHeadNames:e,focused:r,maxValue:n,minValue:o,negativeColor:s,onClick:i,onMouseEnter:a,onMouseLeave:l,positiveColor:u,maskUpperTri:c,tokens:p}){return Bn.default.createElement(pu.Row,{style:{marginBottom:15}},t.map((f,d)=>{let m=r===d;return Bn.default.createElement(pu.Col,{lg:1,md:2,xs:3,style:{margin:0,padding:0},key:d},Bn.default.createElement("div",{style:{padding:3},onClick:()=>i(d),onMouseEnter:()=>a(d),onMouseLeave:l},Bn.default.createElement("div",{style:{position:"relative",borderStyle:"solid",borderWidth:1,borderColor:ZN(d,t.length),boxShadow:m?`0px 0px 4px 3px ${ZN(d,t.length,"60%")}`:void 0}},Bn.default.createElement("h4",{style:{position:"absolute",top:0,right:0,zIndex:100,margin:0,padding:1,background:ZN(d,t.length),color:"white"}},e[d]),Bn.default.createElement(QN,{attention:f,tokens:p,showAxisLabels:!1,maxValue:n,minValue:o,negativeColor:s,positiveColor:u,maskUpperTri:c}))))}))}function R1e({attention:t,attentionHeadNames:e,maxValue:r,minValue:n,negativeColor:o,positiveColor:s,maskUpperTri:i=!0,tokens:a}){let{focused:l,onClick:u,onMouseEnter:c,onMouseLeave:p}=hd(0),f=e||t.map((d,m)=>`Head ${m}`);return Bn.default.createElement(pu.Container,null,Bn.default.createElement("h3",{style:{marginBottom:15}},"Head Selector (hover to view, click to lock)"),Bn.default.createElement($1e,{attention:t,attentionHeadNames:f,focused:l,maxValue:r,minValue:n,negativeColor:o,onClick:u,onMouseEnter:c,onMouseLeave:p,positiveColor:s,maskUpperTri:i,tokens:a}),Bn.default.createElement(pu.Row,null,Bn.default.createElement(pu.Col,{xs:12},Bn.default.createElement("h3",{style:{marginBottom:10}},f[l]," Zoomed"),Bn.default.createElement("div",null,Bn.default.createElement("h2",{style:{position:"absolute",top:0,right:0,zIndex:1e3,margin:6,padding:"5px 10px",background:ZN(l,t.length),color:"white"}},f[l]),Bn.default.createElement(QN,{attention:t[l],maxValue:r,minValue:n,negativeColor:o,positiveColor:s,zoomed:!0,maskUpperTri:i,tokens:a})))),Bn.default.createElement(pu.Row,null))}var dr=nt(ct());var VX=nt(IO());var ix=nt(ct());function EO({coloredAttention:t,style:e={},isSelected:r=!1}){let n=(0,ix.useRef)(null);return(0,ix.useEffect)(()=>{let o=n.current;_x.toPixels(t.toInt(),o)},[t]),ix.default.createElement("canvas",{ref:n,style:{imageRendering:"pixelated",borderColor:r?"rgba(0,0,200,0.5)":"#DDD",borderStyle:"solid",borderWidth:1,boxShadow:r?"0px 0px 3px 3px rgba(0,0,200,0.4)":void 0,width:200,...e}})}var zX=nt(IO()),eI=nt(ct());function O1e(t,e,r,n){let o=e,s=e,i=0,a=e;return typeof n=="number"&&r==="DESTINATION_TO_SOURCE"?(o=n,s=n,i=e,a=e):typeof n=="number"&&r==="SOURCE_TO_DESTINATION"&&(o=e,s=e,i=n,a=n),t.slice([o,i],[s+1-o,a+1-i])}function F1e({focusedToken:t,onClickToken:e,onMouseEnterToken:r,onMouseLeaveToken:n,maxAttentionAcrossHeads:o,text:s,tokenIndex:i,tokensView:a}){let l=t!==null&&t===i,c=O1e(o,i,a,t).mean(0).mean(0),[p,f,d]=c.arraySync(),m=(0,zX.default)({r:p,g:f,b:d}),h=m.getBrightness()<180?"white":"black";return eI.default.createElement("button",{style:{backgroundColor:m.toRgbString(),borderColor:"#DDD",borderStyle:"solid",borderWidth:0,borderRightWidth:1,color:h,display:"inline-block",marginBottom:3,padding:"3px 0px",boxShadow:l?"0px 0px 3px 3px rgba(0,0,200,0.4)":void 0},onClick:()=>e(i),onMouseEnter:()=>r(i),onMouseLeave:n,dangerouslySetInnerHTML:{__html:s.replace(" ","&nbsp;")}})}function BX({coloredAttention:t,focusedHead:e,focusedToken:r,onClickToken:n,onMouseEnterToken:o,onMouseLeaveToken:s,tokens:i,tokensView:a}){let l=typeof e=="number"?t.slice([e],[1]):t,u=Px("hdsc -> dsch",l).min(3);return eI.default.createElement("div",null,i.map((c,p)=>eI.default.createElement(F1e,{focusedToken:r,onClickToken:n,onMouseEnterToken:o,onMouseLeaveToken:s,key:p,maxAttentionAcrossHeads:u,text:c,tokenIndex:p,tokensView:a})))}function P1e(t){let r=Cr(t).arraySync(),n=r.map((o,s)=>o.map(i=>i.map(a=>{let l=(0,VX.default)({h:s/r.length*360,s:.8,l:1-.75*a}),{r:u,g:c,b:p}=l.toRgb();return[u,c,p]})));return Cr(n)}function L1e({tokens:t,attention:e,headLabels:r}){let[n,o]=(0,dr.useState)("DESTINATION_TO_SOURCE"),{focused:s,onClick:i,onMouseEnter:a,onMouseLeave:l}=hd(),{focused:u,onClick:c,onMouseEnter:p,onMouseLeave:f}=hd(),d=(0,dr.useMemo)(()=>P1e(e),[e]),m=d.unstack(0),h=Px("hdsc -> dsch",d).min(3),x=s===null?h:m[s];return dr.default.createElement("div",null,dr.default.createElement("div",{style:{display:"flex"}},dr.default.createElement("div",null,dr.default.createElement("h4",null,"Attention Patterns"),dr.default.createElement(EO,{coloredAttention:x})),dr.default.createElement("div",{style:{marginLeft:15}},dr.default.createElement("h4",null,"Head selector",dr.default.createElement("span",{style:{fontWeight:"normal"}}," ","(hover to focus, click to lock)")),dr.default.createElement("div",{style:{display:"flex",flexWrap:"wrap"}},m.map((g,y)=>dr.default.createElement("figure",{key:y,style:{margin:0,marginRight:15},onClick:()=>i(y),onMouseEnter:()=>a(y),onMouseLeave:l},dr.default.createElement(EO,{coloredAttention:g,style:{width:80},isSelected:y===s}),dr.default.createElement("figcaption",null,r?.[y]??`Head ${y}`)))))),dr.default.createElement("div",{className:"tokens"},dr.default.createElement("h4",{style:{display:"inline-block",marginRight:15}},"Tokens",dr.default.createElement("span",{style:{fontWeight:"normal"}}," (click to focus)")),dr.default.createElement("select",{value:n,onChange:g=>o(g.target.value)},dr.default.createElement("option",{value:"DESTINATION_TO_SOURCE"},"Source \u2190 Destination"),dr.default.createElement("option",{value:"SOURCE_TO_DESTINATION"},"Destination \u2190 Source")),dr.default.createElement("div",null,dr.default.createElement(BX,{coloredAttention:d,focusedHead:s,focusedToken:u,onClickToken:c,onMouseEnterToken:p,onMouseLeaveToken:f,tokens:t,tokensView:n}))))}function gd(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function _O(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function tI(t){let e,r,n;t.length!==2?(e=gd,r=(a,l)=>gd(t(a),l),n=(a,l)=>t(a)-l):(e=t===gd||t===_O?t:M1e,r=t,n=t);function o(a,l,u=0,c=a.length){if(u<c){if(e(l,l)!==0)return c;do{let p=u+c>>>1;r(a[p],l)<0?u=p+1:c=p}while(u<c)}return u}function s(a,l,u=0,c=a.length){if(u<c){if(e(l,l)!==0)return c;do{let p=u+c>>>1;r(a[p],l)<=0?u=p+1:c=p}while(u<c)}return u}function i(a,l,u=0,c=a.length){let p=o(a,l,u,c-1);return p>u&&n(a[p-1],l)>-n(a[p],l)?p-1:p}return{left:o,center:i,right:s}}function M1e(){return 0}function AO(t){return t===null?NaN:+t}var WX=tI(gd),GX=WX.right,z1e=WX.left,B1e=tI(AO).center,DO=GX;var V1e=Math.sqrt(50),W1e=Math.sqrt(10),G1e=Math.sqrt(2);function rI(t,e,r){let n=(e-t)/Math.max(0,r),o=Math.floor(Math.log10(n)),s=n/Math.pow(10,o),i=s>=V1e?10:s>=W1e?5:s>=G1e?2:1,a,l,u;return o<0?(u=Math.pow(10,-o)/i,a=Math.round(t*u),l=Math.round(e*u),a/u<t&&++a,l/u>e&&--l,u=-u):(u=Math.pow(10,o)*i,a=Math.round(t/u),l=Math.round(e/u),a*u<t&&++a,l*u>e&&--l),l<a&&.5<=r&&r<2?rI(t,e,r*2):[a,l,u]}function nI(t,e,r){if(e=+e,t=+t,r=+r,!(r>0))return[];if(t===e)return[t];let n=e<t,[o,s,i]=n?rI(e,t,r):rI(t,e,r);if(!(s>=o))return[];let a=s-o+1,l=new Array(a);if(n)if(i<0)for(let u=0;u<a;++u)l[u]=(s-u)/-i;else for(let u=0;u<a;++u)l[u]=(s-u)*i;else if(i<0)for(let u=0;u<a;++u)l[u]=(o+u)/-i;else for(let u=0;u<a;++u)l[u]=(o+u)*i;return l}function Tv(t,e,r){return e=+e,t=+t,r=+r,rI(t,e,r)[2]}function $O(t,e,r){e=+e,t=+t,r=+r;let n=e<t,o=n?Tv(e,t,r):Tv(t,e,r);return(n?-1:1)*(o<0?1/-o:o)}function UX(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function HX(t,e){switch(arguments.length){case 0:break;case 1:{typeof t=="function"?this.interpolator(t):this.range(t);break}default:{this.domain(t),typeof e=="function"?this.interpolator(e):this.range(e);break}}return this}function ax(t,e,r){t.prototype=e.prototype=r,r.constructor=t}function Nv(t,e){var r=Object.create(t.prototype);for(var n in e)r[n]=e[n];return r}function vd(){}var yp=.7,bd=1/yp,lx="\\s*([+-]?\\d+)\\s*",Iv="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ga="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",U1e=/^#([0-9a-f]{3,8})$/,H1e=new RegExp(`^rgb\\(${lx},${lx},${lx}\\)$`),q1e=new RegExp(`^rgb\\(${ga},${ga},${ga}\\)$`),j1e=new RegExp(`^rgba\\(${lx},${lx},${lx},${Iv}\\)$`),K1e=new RegExp(`^rgba\\(${ga},${ga},${ga},${Iv}\\)$`),X1e=new RegExp(`^hsl\\(${Iv},${ga},${ga}\\)$`),Y1e=new RegExp(`^hsla\\(${Iv},${ga},${ga},${Iv}\\)$`),qX={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};ax(vd,bp,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:jX,formatHex:jX,formatHex8:Q1e,formatHsl:Z1e,formatRgb:KX,toString:KX});function jX(){return this.rgb().formatHex()}function Q1e(){return this.rgb().formatHex8()}function Z1e(){return eY(this).formatHsl()}function KX(){return this.rgb().formatRgb()}function bp(t){var e,r;return t=(t+"").trim().toLowerCase(),(e=U1e.exec(t))?(r=e[1].length,e=parseInt(e[1],16),r===6?XX(e):r===3?new Vn(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):r===8?oI(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):r===4?oI(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=H1e.exec(t))?new Vn(e[1],e[2],e[3],1):(e=q1e.exec(t))?new Vn(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=j1e.exec(t))?oI(e[1],e[2],e[3],e[4]):(e=K1e.exec(t))?oI(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=X1e.exec(t))?ZX(e[1],e[2]/100,e[3]/100,1):(e=Y1e.exec(t))?ZX(e[1],e[2]/100,e[3]/100,e[4]):qX.hasOwnProperty(t)?XX(qX[t]):t==="transparent"?new Vn(NaN,NaN,NaN,0):null}function XX(t){return new Vn(t>>16&255,t>>8&255,t&255,1)}function oI(t,e,r,n){return n<=0&&(t=e=r=NaN),new Vn(t,e,r,n)}function OO(t){return t instanceof vd||(t=bp(t)),t?(t=t.rgb(),new Vn(t.r,t.g,t.b,t.opacity)):new Vn}function ux(t,e,r,n){return arguments.length===1?OO(t):new Vn(t,e,r,n??1)}function Vn(t,e,r,n){this.r=+t,this.g=+e,this.b=+r,this.opacity=+n}ax(Vn,ux,Nv(vd,{brighter(t){return t=t==null?bd:Math.pow(bd,t),new Vn(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?yp:Math.pow(yp,t),new Vn(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Vn(yd(this.r),yd(this.g),yd(this.b),iI(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:YX,formatHex:YX,formatHex8:J1e,formatRgb:QX,toString:QX}));function YX(){return`#${xd(this.r)}${xd(this.g)}${xd(this.b)}`}function J1e(){return`#${xd(this.r)}${xd(this.g)}${xd(this.b)}${xd((isNaN(this.opacity)?1:this.opacity)*255)}`}function QX(){let t=iI(this.opacity);return`${t===1?"rgb(":"rgba("}${yd(this.r)}, ${yd(this.g)}, ${yd(this.b)}${t===1?")":`, ${t})`}`}function iI(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function yd(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function xd(t){return t=yd(t),(t<16?"0":"")+t.toString(16)}function ZX(t,e,r,n){return n<=0?t=e=r=NaN:r<=0||r>=1?t=e=NaN:e<=0&&(t=NaN),new Di(t,e,r,n)}function eY(t){if(t instanceof Di)return new Di(t.h,t.s,t.l,t.opacity);if(t instanceof vd||(t=bp(t)),!t)return new Di;if(t instanceof Di)return t;t=t.rgb();var e=t.r/255,r=t.g/255,n=t.b/255,o=Math.min(e,r,n),s=Math.max(e,r,n),i=NaN,a=s-o,l=(s+o)/2;return a?(e===s?i=(r-n)/a+(r<n)*6:r===s?i=(n-e)/a+2:i=(e-r)/a+4,a/=l<.5?s+o:2-s-o,i*=60):a=l>0&&l<1?0:i,new Di(i,a,l,t.opacity)}function tY(t,e,r,n){return arguments.length===1?eY(t):new Di(t,e,r,n??1)}function Di(t,e,r,n){this.h=+t,this.s=+e,this.l=+r,this.opacity=+n}ax(Di,tY,Nv(vd,{brighter(t){return t=t==null?bd:Math.pow(bd,t),new Di(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?yp:Math.pow(yp,t),new Di(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*e,o=2*r-n;return new Vn(RO(t>=240?t-240:t+120,o,n),RO(t,o,n),RO(t<120?t+240:t-120,o,n),this.opacity)},clamp(){return new Di(JX(this.h),sI(this.s),sI(this.l),iI(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){let t=iI(this.opacity);return`${t===1?"hsl(":"hsla("}${JX(this.h)}, ${sI(this.s)*100}%, ${sI(this.l)*100}%${t===1?")":`, ${t})`}`}}));function JX(t){return t=(t||0)%360,t<0?t+360:t}function sI(t){return Math.max(0,Math.min(1,t||0))}function RO(t,e,r){return(t<60?e+(r-e)*t/60:t<180?r:t<240?e+(r-e)*(240-t)/60:e)*255}var rY=Math.PI/180,nY=180/Math.PI;var aY=-.14861,FO=1.78277,PO=-.29227,aI=-.90649,Ev=1.97294,oY=Ev*aI,sY=Ev*FO,iY=FO*PO-aI*aY;function ewe(t){if(t instanceof wd)return new wd(t.h,t.s,t.l,t.opacity);t instanceof Vn||(t=OO(t));var e=t.r/255,r=t.g/255,n=t.b/255,o=(iY*n+oY*e-sY*r)/(iY+oY-sY),s=n-o,i=(Ev*(r-o)-PO*s)/aI,a=Math.sqrt(i*i+s*s)/(Ev*o*(1-o)),l=a?Math.atan2(i,s)*nY-120:NaN;return new wd(l<0?l+360:l,a,o,t.opacity)}function ei(t,e,r,n){return arguments.length===1?ewe(t):new wd(t,e,r,n??1)}function wd(t,e,r,n){this.h=+t,this.s=+e,this.l=+r,this.opacity=+n}ax(wd,ei,Nv(vd,{brighter(t){return t=t==null?bd:Math.pow(bd,t),new wd(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?yp:Math.pow(yp,t),new wd(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=isNaN(this.h)?0:(this.h+120)*rY,e=+this.l,r=isNaN(this.s)?0:this.s*e*(1-e),n=Math.cos(t),o=Math.sin(t);return new Vn(255*(e+r*(aY*n+FO*o)),255*(e+r*(PO*n+aI*o)),255*(e+r*(Ev*n)),this.opacity)}}));function LO(t,e,r,n,o){var s=t*t,i=s*t;return((1-3*t+3*s-i)*e+(4-6*s+3*i)*r+(1+3*t+3*s-3*i)*n+i*o)/6}function lY(t){var e=t.length-1;return function(r){var n=r<=0?r=0:r>=1?(r=1,e-1):Math.floor(r*e),o=t[n],s=t[n+1],i=n>0?t[n-1]:2*o-s,a=n<e-1?t[n+2]:2*s-o;return LO((r-n/e)*e,i,o,s,a)}}function uY(t){var e=t.length;return function(r){var n=Math.floor(((r%=1)<0?++r:r)*e),o=t[(n+e-1)%e],s=t[n%e],i=t[(n+1)%e],a=t[(n+2)%e];return LO((r-n/e)*e,o,s,i,a)}}var cx=t=>()=>t;function cY(t,e){return function(r){return t+r*e}}function twe(t,e,r){return t=Math.pow(t,r),e=Math.pow(e,r)-t,r=1/r,function(n){return Math.pow(t+n*e,r)}}function pY(t,e){var r=e-t;return r?cY(t,r>180||r<-180?r-360*Math.round(r/360):r):cx(isNaN(t)?e:t)}function fY(t){return(t=+t)==1?fu:function(e,r){return r-e?twe(e,r,t):cx(isNaN(e)?r:e)}}function fu(t,e){var r=e-t;return r?cY(t,r):cx(isNaN(t)?e:t)}var lI=function t(e){var r=fY(e);function n(o,s){var i=r((o=ux(o)).r,(s=ux(s)).r),a=r(o.g,s.g),l=r(o.b,s.b),u=fu(o.opacity,s.opacity);return function(c){return o.r=i(c),o.g=a(c),o.b=l(c),o.opacity=u(c),o+""}}return n.gamma=t,n}(1);function dY(t){return function(e){var r=e.length,n=new Array(r),o=new Array(r),s=new Array(r),i,a;for(i=0;i<r;++i)a=ux(e[i]),n[i]=a.r||0,o[i]=a.g||0,s[i]=a.b||0;return n=t(n),o=t(o),s=t(s),a.opacity=1,function(l){return a.r=n(l),a.g=o(l),a.b=s(l),a+""}}}var MO=dY(lY),rwe=dY(uY);function mY(t,e){e||(e=[]);var r=t?Math.min(e.length,t.length):0,n=e.slice(),o;return function(s){for(o=0;o<r;++o)n[o]=t[o]*(1-s)+e[o]*s;return n}}function hY(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function gY(t,e){var r=e?e.length:0,n=t?Math.min(r,t.length):0,o=new Array(n),s=new Array(r),i;for(i=0;i<n;++i)o[i]=du(t[i],e[i]);for(;i<r;++i)s[i]=e[i];return function(a){for(i=0;i<n;++i)s[i]=o[i](a);return s}}function xY(t,e){var r=new Date;return t=+t,e=+e,function(n){return r.setTime(t*(1-n)+e*n),r}}function vp(t,e){return t=+t,e=+e,function(r){return t*(1-r)+e*r}}function yY(t,e){var r={},n={},o;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(o in e)o in t?r[o]=du(t[o],e[o]):n[o]=e[o];return function(s){for(o in r)n[o]=r[o](s);return n}}var BO=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,zO=new RegExp(BO.source,"g");function nwe(t){return function(){return t}}function owe(t){return function(e){return t(e)+""}}function bY(t,e){var r=BO.lastIndex=zO.lastIndex=0,n,o,s,i=-1,a=[],l=[];for(t=t+"",e=e+"";(n=BO.exec(t))&&(o=zO.exec(e));)(s=o.index)>r&&(s=e.slice(r,s),a[i]?a[i]+=s:a[++i]=s),(n=n[0])===(o=o[0])?a[i]?a[i]+=o:a[++i]=o:(a[++i]=null,l.push({i,x:vp(n,o)})),r=zO.lastIndex;return r<e.length&&(s=e.slice(r),a[i]?a[i]+=s:a[++i]=s),a.length<2?l[0]?owe(l[0].x):nwe(e):(e=l.length,function(u){for(var c=0,p;c<e;++c)a[(p=l[c]).i]=p.x(u);return a.join("")})}function du(t,e){var r=typeof e,n;return e==null||r==="boolean"?cx(e):(r==="number"?vp:r==="string"?(n=bp(e))?(e=n,lI):bY:e instanceof bp?lI:e instanceof Date?xY:hY(e)?mY:Array.isArray(e)?gY:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?yY:vp)(t,e)}function _v(t,e){return t=+t,e=+e,function(r){return Math.round(t*(1-r)+e*r)}}function vY(t){return function e(r){r=+r;function n(o,s){var i=t((o=ei(o)).h,(s=ei(s)).h),a=fu(o.s,s.s),l=fu(o.l,s.l),u=fu(o.opacity,s.opacity);return function(c){return o.h=i(c),o.s=a(c),o.l=l(Math.pow(c,r)),o.opacity=u(c),o+""}}return n.gamma=e,n}(1)}var swe=vY(pY),uI=vY(fu);function VO(t){return function(){return t}}function WO(t){return+t}var wY=[0,1];function mu(t){return t}function GO(t,e){return(e-=t=+t)?function(r){return(r-t)/e}:VO(isNaN(e)?NaN:.5)}function iwe(t,e){var r;return t>e&&(r=t,t=e,e=r),function(n){return Math.max(t,Math.min(e,n))}}function awe(t,e,r){var n=t[0],o=t[1],s=e[0],i=e[1];return o<n?(n=GO(o,n),s=r(i,s)):(n=GO(n,o),s=r(s,i)),function(a){return s(n(a))}}function lwe(t,e,r){var n=Math.min(t.length,e.length)-1,o=new Array(n),s=new Array(n),i=-1;for(t[n]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++i<n;)o[i]=GO(t[i],t[i+1]),s[i]=r(e[i],e[i+1]);return function(a){var l=DO(t,a,1,n)-1;return s[l](o[l](a))}}function CY(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function uwe(){var t=wY,e=wY,r=du,n,o,s,i=mu,a,l,u;function c(){var f=Math.min(t.length,e.length);return i!==mu&&(i=iwe(t[0],t[f-1])),a=f>2?lwe:awe,l=u=null,p}function p(f){return f==null||isNaN(f=+f)?s:(l||(l=a(t.map(n),e,r)))(n(i(f)))}return p.invert=function(f){return i(o((u||(u=a(e,t.map(n),vp)))(f)))},p.domain=function(f){return arguments.length?(t=Array.from(f,WO),c()):t.slice()},p.range=function(f){return arguments.length?(e=Array.from(f),c()):e.slice()},p.rangeRound=function(f){return e=Array.from(f),r=_v,c()},p.clamp=function(f){return arguments.length?(i=f?!0:mu,c()):i!==mu},p.interpolate=function(f){return arguments.length?(r=f,c()):r},p.unknown=function(f){return arguments.length?(s=f,p):s},function(f,d){return n=f,o=d,c()}}function UO(){return uwe()(mu,mu)}function SY(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function Cd(t,e){if((r=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var r,n=t.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+t.slice(r+1)]}function xa(t){return t=Cd(Math.abs(t)),t?t[1]:NaN}function kY(t,e){return function(r,n){for(var o=r.length,s=[],i=0,a=t[0],l=0;o>0&&a>0&&(l+a+1>n&&(a=Math.max(1,n-l)),s.push(r.substring(o-=a,o+a)),!((l+=a+1)>n));)a=t[i=(i+1)%t.length];return s.reverse().join(e)}}function TY(t){return function(e){return e.replace(/[0-9]/g,function(r){return t[+r]})}}var cwe=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function wp(t){if(!(e=cwe.exec(t)))throw new Error("invalid format: "+t);var e;return new cI({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}wp.prototype=cI.prototype;function cI(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}cI.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function NY(t){e:for(var e=t.length,r=1,n=-1,o;r<e;++r)switch(t[r]){case".":n=o=r;break;case"0":n===0&&(n=r),o=r;break;default:if(!+t[r])break e;n>0&&(n=0);break}return n>0?t.slice(0,n)+t.slice(o+1):t}var HO;function IY(t,e){var r=Cd(t,e);if(!r)return t+"";var n=r[0],o=r[1],s=o-(HO=Math.max(-8,Math.min(8,Math.floor(o/3)))*3)+1,i=n.length;return s===i?n:s>i?n+new Array(s-i+1).join("0"):s>0?n.slice(0,s)+"."+n.slice(s):"0."+new Array(1-s).join("0")+Cd(t,Math.max(0,e+s-1))[0]}function qO(t,e){var r=Cd(t,e);if(!r)return t+"";var n=r[0],o=r[1];return o<0?"0."+new Array(-o).join("0")+n:n.length>o+1?n.slice(0,o+1)+"."+n.slice(o+1):n+new Array(o-n.length+2).join("0")}var jO={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:SY,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>qO(t*100,e),r:qO,s:IY,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function KO(t){return t}var EY=Array.prototype.map,_Y=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function AY(t){var e=t.grouping===void 0||t.thousands===void 0?KO:kY(EY.call(t.grouping,Number),t.thousands+""),r=t.currency===void 0?"":t.currency[0]+"",n=t.currency===void 0?"":t.currency[1]+"",o=t.decimal===void 0?".":t.decimal+"",s=t.numerals===void 0?KO:TY(EY.call(t.numerals,String)),i=t.percent===void 0?"%":t.percent+"",a=t.minus===void 0?"\u2212":t.minus+"",l=t.nan===void 0?"NaN":t.nan+"";function u(p){p=wp(p);var f=p.fill,d=p.align,m=p.sign,h=p.symbol,x=p.zero,g=p.width,y=p.comma,b=p.precision,v=p.trim,C=p.type;C==="n"?(y=!0,C="g"):jO[C]||(b===void 0&&(b=12),v=!0,C="g"),(x||f==="0"&&d==="=")&&(x=!0,f="0",d="=");var S=h==="$"?r:h==="#"&&/[boxX]/.test(C)?"0"+C.toLowerCase():"",k=h==="$"?n:/[%p]/.test(C)?i:"",I=jO[C],A=/[defgprs%]/.test(C);b=b===void 0?6:/[gprs]/.test(C)?Math.max(1,Math.min(21,b)):Math.max(0,Math.min(20,b));function $(O){var j=S,H=k,Y,B,K;if(C==="c")H=I(O)+H,O="";else{O=+O;var X=O<0||1/O<0;if(O=isNaN(O)?l:I(Math.abs(O),b),v&&(O=NY(O)),X&&+O==0&&m!=="+"&&(X=!1),j=(X?m==="("?m:a:m==="-"||m==="("?"":m)+j,H=(C==="s"?_Y[8+HO/3]:"")+H+(X&&m==="("?")":""),A){for(Y=-1,B=O.length;++Y<B;)if(K=O.charCodeAt(Y),48>K||K>57){H=(K===46?o+O.slice(Y+1):O.slice(Y))+H,O=O.slice(0,Y);break}}}y&&!x&&(O=e(O,1/0));var Z=j.length+O.length+H.length,Q=Z<g?new Array(g-Z+1).join(f):"";switch(y&&x&&(O=e(Q+O,Q.length?g-H.length:1/0),Q=""),d){case"<":O=j+O+H+Q;break;case"=":O=j+Q+O+H;break;case"^":O=Q.slice(0,Z=Q.length>>1)+j+O+H+Q.slice(Z);break;default:O=Q+j+O+H;break}return s(O)}return $.toString=function(){return p+""},$}function c(p,f){var d=u((p=wp(p),p.type="f",p)),m=Math.max(-8,Math.min(8,Math.floor(xa(f)/3)))*3,h=Math.pow(10,-m),x=_Y[8+m/3];return function(g){return d(h*g)+x}}return{format:u,formatPrefix:c}}var pI,fI,dI;XO({thousands:",",grouping:[3],currency:["$",""]});function XO(t){return pI=AY(t),fI=pI.format,dI=pI.formatPrefix,pI}function YO(t){return Math.max(0,-xa(Math.abs(t)))}function QO(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(xa(e)/3)))*3-xa(Math.abs(t)))}function ZO(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,xa(e)-xa(t))+1}function JO(t,e,r,n){var o=$O(t,e,r),s;switch(n=wp(n??",f"),n.type){case"s":{var i=Math.max(Math.abs(t),Math.abs(e));return n.precision==null&&!isNaN(s=QO(o,i))&&(n.precision=s),dI(n,i)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(s=ZO(o,Math.max(Math.abs(t),Math.abs(e))))&&(n.precision=s-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(s=YO(o))&&(n.precision=s-(n.type==="%")*2);break}}return fI(n)}function eF(t){var e=t.domain;return t.ticks=function(r){var n=e();return nI(n[0],n[n.length-1],r??10)},t.tickFormat=function(r,n){var o=e();return JO(o[0],o[o.length-1],r??10,n)},t.nice=function(r){r==null&&(r=10);var n=e(),o=0,s=n.length-1,i=n[o],a=n[s],l,u,c=10;for(a<i&&(u=i,i=a,a=u,u=o,o=s,s=u);c-- >0;){if(u=Tv(i,a,r),u===l)return n[o]=i,n[s]=a,e(n);if(u>0)i=Math.floor(i/u)*u,a=Math.ceil(a/u)*u;else if(u<0)i=Math.ceil(i*u)/u,a=Math.floor(a*u)/u;else break;l=u}return t},t}function Av(){var t=UO();return t.copy=function(){return CY(t,Av())},UX.apply(t,arguments),eF(t)}function pwe(){var t=0,e=1,r,n,o,s,i=mu,a=!1,l;function u(p){return p==null||isNaN(p=+p)?l:i(o===0?.5:(p=(s(p)-r)*o,a?Math.max(0,Math.min(1,p)):p))}u.domain=function(p){return arguments.length?([t,e]=p,r=s(t=+t),n=s(e=+e),o=r===n?0:1/(n-r),u):[t,e]},u.clamp=function(p){return arguments.length?(a=!!p,u):a},u.interpolator=function(p){return arguments.length?(i=p,u):i};function c(p){return function(f){var d,m;return arguments.length?([d,m]=f,i=p(d,m),u):[i(0),i(1)]}}return u.range=c(du),u.rangeRound=c(_v),u.unknown=function(p){return arguments.length?(l=p,u):l},function(p){return s=p,r=p(t),n=p(e),o=r===n?0:1/(n-r),u}}function fwe(t,e){return e.domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown())}function Sd(){var t=eF(pwe()(mu));return t.copy=function(){return fwe(t,Sd())},HX.apply(t,arguments)}function mr(t){for(var e=t.length/6|0,r=new Array(e),n=0;n<e;)r[n]="#"+t.slice(n*6,++n*6);return r}var Jr=t=>MO(t[t.length-1]);var DY=new Array(3).concat("af8dc3f7f7f77fbf7b","7b3294c2a5cfa6dba0008837","7b3294c2a5cff7f7f7a6dba0008837","762a83af8dc3e7d4e8d9f0d37fbf7b1b7837","762a83af8dc3e7d4e8f7f7f7d9f0d37fbf7b1b7837","762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b7837","762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b7837","40004b762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b783700441b","40004b762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b783700441b").map(mr),tF=Jr(DY);var $Y=new Array(3).concat("e9a3c9f7f7f7a1d76a","d01c8bf1b6dab8e1864dac26","d01c8bf1b6daf7f7f7b8e1864dac26","c51b7de9a3c9fde0efe6f5d0a1d76a4d9221","c51b7de9a3c9fde0eff7f7f7e6f5d0a1d76a4d9221","c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221","c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221","8e0152c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221276419","8e0152c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221276419").map(mr),rF=Jr($Y);var RY=new Array(3).concat("fc8d59ffffbf91bfdb","d7191cfdae61abd9e92c7bb6","d7191cfdae61ffffbfabd9e92c7bb6","d73027fc8d59fee090e0f3f891bfdb4575b4","d73027fc8d59fee090ffffbfe0f3f891bfdb4575b4","d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4","d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4","a50026d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4313695","a50026d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4313695").map(mr),nF=Jr(RY);var OY=new Array(3).concat("fc8d59ffffbf99d594","d7191cfdae61abdda42b83ba","d7191cfdae61ffffbfabdda42b83ba","d53e4ffc8d59fee08be6f59899d5943288bd","d53e4ffc8d59fee08bffffbfe6f59899d5943288bd","d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd","d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd","9e0142d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd5e4fa2","9e0142d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd5e4fa2").map(mr),oF=Jr(OY);var FY=new Array(3).concat("deebf79ecae13182bd","eff3ffbdd7e76baed62171b5","eff3ffbdd7e76baed63182bd08519c","eff3ffc6dbef9ecae16baed63182bd08519c","eff3ffc6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b508519c08306b").map(mr),sF=Jr(FY);var PY=new Array(3).concat("e5f5e0a1d99b31a354","edf8e9bae4b374c476238b45","edf8e9bae4b374c47631a354006d2c","edf8e9c7e9c0a1d99b74c47631a354006d2c","edf8e9c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45006d2c00441b").map(mr),iF=Jr(PY);var LY=new Array(3).concat("f0f0f0bdbdbd636363","f7f7f7cccccc969696525252","f7f7f7cccccc969696636363252525","f7f7f7d9d9d9bdbdbd969696636363252525","f7f7f7d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525000000").map(mr),aF=Jr(LY);var MY=new Array(3).concat("efedf5bcbddc756bb1","f2f0f7cbc9e29e9ac86a51a3","f2f0f7cbc9e29e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a354278f3f007d").map(mr),lF=Jr(MY);var zY=new Array(3).concat("fee0d2fc9272de2d26","fee5d9fcae91fb6a4acb181d","fee5d9fcae91fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181da50f1567000d").map(mr),uF=Jr(zY);var BY=new Array(3).concat("fee6cefdae6be6550d","feeddefdbe85fd8d3cd94701","feeddefdbe85fd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d94801a636037f2704").map(mr),cF=Jr(BY);function pF(t){return t=Math.max(0,Math.min(1,t)),"rgb("+Math.max(0,Math.min(255,Math.round(-4.54-t*(35.34-t*(2381.73-t*(6402.7-t*(7024.72-t*2710.57)))))))+", "+Math.max(0,Math.min(255,Math.round(32.49+t*(170.73+t*(52.82-t*(131.46-t*(176.58-t*67.37)))))))+", "+Math.max(0,Math.min(255,Math.round(81.24+t*(442.36-t*(2482.43-t*(6167.24-t*(6614.94-t*2475.67)))))))+")"}var fF=uI(ei(-100,.75,.35),ei(80,1.5,.8)),dwe=uI(ei(260,.75,.35),ei(80,1.5,.8)),Ltr=ei();function mI(t){var e=t.length;return function(r){return t[Math.max(0,Math.min(e-1,Math.floor(r*e)))]}}var dF=mI(mr("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725")),mF=mI(mr("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf")),hF=mI(mr("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4")),gF=mI(mr("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));var V=nt(ct());function kd(t){if(!t||t.length<4)return 1;let e=t,r=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(r,(a,l,u,c)=>l+l+u+u+c+c);let n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);if(!n)return 1;let o=parseInt(n[1],16),s=parseInt(n[2],16),i=parseInt(n[3],16);return(.2126*o+.7152*s+.0722*i)/255}var hwe=Av().domain([0,.5,1]).range(["#ffffff","#ff9966","#ff6633"]).clamp(!0);function Dv(t,e,r={}){let{minClamp:n=0,maxClamp:o=.7,isDiverging:s=!1,shouldApplyRangeClamp:i=!0}=r;return!s&&i?Sd(l=>t(l*(o-n)+n)).domain(e).clamp(!0):s?Sd(t).domain(e).clamp(!0):Sd(t).domain(e).clamp(!0)}function xF(t,e=0,r=.7){return n=>t(n*(r-e)+e)}var Td={claudeOranges:hwe,viridis:dF,plasma:gF,inferno:xF(hF),magma:xF(mF),cividis:pF,gray:xF(aF,.1,.9),coolwarm:fF,rdylbu:nF,piyg:rF,prgn:tF,spectral:oF,blues:sF,greens:iF,reds:uF,oranges:cF,purples:lF},hI=["coolwarm","rdylbu","piyg","prgn","spectral"];function gwe(t,e,r,n=null){if(!t.length||!t[0]?.length)return[];let o=t.length,s=t[0].length,i=[],a=n??0;for(let l=0;l<s;l++){let u=-1/0,c=0,p=0;for(let f=0;f<o;f++){let d=t[f]?.[l]??0;d>u&&(u=d),c+=Math.abs(d),Math.abs(d)>a&&(p+=1)}i.push({index:r?r[l]:l,label:e[l]??`Feature ${l}`,score:0,maxActivation:u,meanAbsActivation:c/o,nonZeroCount:p})}return i}function xwe(t,e){return[...t].sort((r,n)=>{let o=0,s=0;switch(e){case"l1":o=r.meanAbsActivation,s=n.meanAbsActivation;break;case"l0":o=r.nonZeroCount,s=n.nonZeroCount;break;case"max":default:o=r.maxActivation,s=n.maxActivation;break}return s-o})}function gI(t,e,r,n,o,s){if(!e[t])return[];let i=e[0]?.length??0,a=[];for(let l=0;l<i;l++){let u=e[t][l]??0;(s===null||Math.abs(u)>=s)&&a.push({index:n?n[l]:l,label:r[l]??`Feature ${l}`,activation:u})}return a.sort((l,u)=>Math.abs(u.activation)-Math.abs(l.activation)).slice(0,o)}var en={light:{bg:"#ffffff",text:"#000000",border:"#ccc",containerBg:"#f9f9f9",selectedItemBg:"#e0e8ff",selectedItemBorder:"#4a90e2",hoverOutline:"#cccccc",subtleBorder:"#eee",dimText:"#555",closeButton:"#aaa",boxHoverBg:"#f0f0f0"},dark:{bg:"#1e1e1e",text:"#e0e0e0",border:"#555",containerBg:"#2a2a2a",selectedItemBg:"#3a4a7e",selectedItemBorder:"#6a90e2",hoverOutline:"#777777",subtleBorder:"#444",dimText:"#aaa",closeButton:"#ccc",boxHoverBg:"#333333"},"claude-brown":{bg:"hsl(30, 40%, 96%)",text:"hsl(30, 30%, 20%)",border:"hsl(30, 20%, 70%)",containerBg:"hsl(30, 30%, 90%)",selectedItemBg:"hsl(30, 50%, 80%)",selectedItemBorder:"hsl(30, 70%, 50%)",hoverOutline:"hsl(30, 30%, 60%)",subtleBorder:"hsl(30, 25%, 85%)",dimText:"hsl(30, 20%, 40%)",closeButton:"hsl(30, 25%, 50%)",boxHoverBg:"hsl(30, 35%, 92%)"}},ywe=(t,e)=>{let r=en[t]??en.light;return{container:{fontFamily:"sans-serif",padding:"10px",border:`1px solid ${r.border}`,borderRadius:"5px",position:"relative",backgroundColor:r.bg,color:r.text},controls:{marginBottom:"10px",display:"flex",gap:"15px",alignItems:"center",flexWrap:"wrap",flexShrink:0},featureSearch:{marginBottom:"10px"},featureListContainer:{marginBottom:"15px",maxHeight:"200px",overflowY:"auto",border:`1px solid ${r.subtleBorder}`,backgroundColor:r.containerBg},featureListItem:{padding:"5px 8px",cursor:"pointer",borderBottom:`1px solid ${r.subtleBorder}`,fontSize:"0.9em",display:"flex",justifyContent:"space-between"},featureListItemHover:{outline:`1px solid ${r.hoverOutline}`},featureListItemSelected:{backgroundColor:r.selectedItemBg,fontWeight:"bold",borderLeft:`3px solid ${r.selectedItemBorder}`,color:r.text},featureScore:{color:r.dimText,fontSize:"0.9em"},selectedFeaturesContainer:{marginTop:"15px",marginBottom:"15px",padding:"10px",border:`1px solid ${r.border}`,borderRadius:"4px",maxHeight:"200px",overflowY:"auto",flexShrink:0},selectedFeatureInfoBox:{border:`1px solid ${r.border}`,borderRadius:"3px",padding:"8px",marginBottom:"8px",backgroundColor:r.bg,position:"relative",fontSize:"0.9em",transition:"background-color 0.1s ease-in-out"},featureValueIndicator:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:"auto",minWidth:"2.5em",height:"1.5em",marginLeft:"5px",border:`1px solid ${r.border}`,borderRadius:"3px",verticalAlign:"middle",padding:"0 4px",fontSize:"0.85em",overflow:"hidden",whiteSpace:"nowrap"},selectedTokensContainer:{marginTop:"15px",marginBottom:"5px",padding:"10px",border:`1px solid ${r.border}`,borderRadius:"4px",maxHeight:"200px",overflowY:"auto",flexShrink:0},selectedTokensContainerCompactWrap:{display:"flex",flexWrap:"wrap",gap:"5px"},selectedTokenInfoBox:{border:`1px solid ${r.border}`,borderRadius:"3px",padding:"8px",marginBottom:"8px",backgroundColor:r.bg,position:"relative",fontSize:"0.9em",transition:"background-color 0.1s ease-in-out"},selectedTokenInfoBoxCompactTile:{border:`1px solid ${r.border}`,borderRadius:"3px",padding:"2px 5px",backgroundColor:r.bg,fontSize:"0.85em",display:"inline-flex",alignItems:"center",gap:"4px",whiteSpace:"nowrap"},selectedItemCloseButton:{position:"absolute",top:"2px",right:"5px",background:"none",border:"none",color:r.closeButton,cursor:"pointer",fontSize:"1.2em",padding:"0",lineHeight:"1"},tokenSequence:{display:"block",lineHeight:1.5,border:`1px solid ${r.subtleBorder}`,padding:"5px",marginTop:"10px",flexShrink:0,letterSpacing:"normal"},token:{padding:"0",margin:"-1px -1px 0 -1px",borderRadius:"2px",cursor:"pointer",whiteSpace:"pre",border:"1px solid transparent",transition:"outline 0.1s ease-in-out, background-color 0.1s ease-in-out",letterSpacing:"0.08em",display:"inline-block",position:"relative",verticalAlign:"middle",lineHeight:1.2,overflow:"visible"},tokenTextOverlay:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",padding:"2px 0px",zIndex:1,pointerEvents:"none",width:"100%",height:"100%",letterSpacing:"0.08em"},tokenHover:{outline:`1px solid ${r.hoverOutline}`,outlineOffset:"0px"},tokenClicked:{outline:`2px solid ${r.selectedItemBorder}`,outlineOffset:"-1px",textDecoration:"underline",textUnderlineOffset:"2px"},tooltip:{position:"absolute",backgroundColor:t==="light"?"rgba(0, 0, 0, 0.85)":"rgba(40, 40, 40, 0.9)",color:t==="light"?"white":"#e0e0e0",padding:"8px 10px",borderRadius:"4px",fontSize:"0.85em",zIndex:10,maxWidth:"350px",pointerEvents:"none",boxShadow:"0 2px 5px rgba(0,0,0,0.2)"},tooltipSticky:{pointerEvents:"auto"},tooltipCloseButton:{position:"absolute",top:"2px",right:"5px",background:"none",border:"none",color:t==="light"?"#ccc":"#aaa",cursor:"pointer",fontSize:"1.2em",padding:"0",lineHeight:"1"},tooltipFeature:{padding:"2px 0",cursor:"pointer"},tooltipFeatureHover:{textDecoration:"underline"},inputGroup:{display:"flex",alignItems:"center",gap:"5px"},compactButton:{padding:"2px 6px",fontSize:"0.8em"},featureGrid:{display:"flex",flexWrap:"wrap",gap:"3px",padding:"5px"},featureTile:{padding:"1px 2px",fontSize:"0.85em",border:`1px solid ${r.border}`,borderRadius:"3px",cursor:"pointer",textAlign:"center",whiteSpace:"nowrap",minWidth:"2.5em"},featureTileHover:{outline:`1px solid ${r.hoverOutline}`},featureTileSelected:{backgroundColor:r.selectedItemBg,fontWeight:"bold",borderColor:r.selectedItemBorder,color:r.text},mainContentArea:{display:"flex",flexDirection:"column"},featureListIndexValue:{fontWeight:"bold",marginRight:"5px"},featureListDescription:{color:r.dimText},dynamicInfoLabel:{fontStyle:"italic",marginRight:"5px"}}},bwe=t=>{switch(t){case"l1":return"L1";case"l0":return"L0";case"max":default:return"Max"}},vwe=({tokens:t,featureActivations:e,featureLabels:r,featureIDs:n,numTopFeaturesPerToken:o=5,numTopFeaturesOverall:s=20,initialRankingMetric:i="max",activationThreshold:a=null,colorMap:l="reds",colorMidpoint:u})=>{let c=(0,V.useMemo)(()=>t.map(q=>q.replace(/\n/g,"\u21B5")),[t]),[p,f]=(0,V.useState)(i),[d,m]=(0,V.useState)(a),[h,x]=(0,V.useState)(null),[g,y]=(0,V.useState)(null),[b,v]=(0,V.useState)(null),[C,S]=(0,V.useState)([]),[k,I]=(0,V.useState)(""),[A,$]=(0,V.useState)(s),[O,j]=(0,V.useState)(o),[H,Y]=(0,V.useState)(null),[B,K]=(0,V.useState)(null),[X,Z]=(0,V.useState)(u??null),[Q,ie]=(0,V.useState)("200px"),[re,ue]=(0,V.useState)("200px"),[ne,le]=(0,V.useState)(null),[ae,me]=(0,V.useState)([]),[be,we]=(0,V.useState)(null),[ke,He]=(0,V.useState)(!1),[We,R]=(0,V.useState)("claude-brown"),[U,P]=(0,V.useState)("claudeOranges"),[se,pe]=(0,V.useState)(!1),[fe,Pe]=(0,V.useState)(!0),[Be,Ge]=(0,V.useState)(!1),[$t,hr]=(0,V.useState)("200px"),mt=(0,V.useRef)(null),ge=(0,V.useMemo)(()=>ywe(We,fe),[We,fe]),pt=en[We]??en.light,ht=(0,V.useMemo)(()=>{let q=new Map;if(n)n.forEach((de,Ne)=>{q.set(de,Ne)});else if(e.length>0&&e[0]){let de=e[0].length;for(let Ne=0;Ne<de;Ne++)q.set(Ne,Ne)}return q},[n,e]),bo=(0,V.useMemo)(()=>gwe(e,r,n,d),[e,r,n,d]),_r=(0,V.useMemo)(()=>{let q=bo.map(de=>{let Ne=0;switch(p){case"l1":Ne=de.meanAbsActivation;break;case"l0":Ne=de.nonZeroCount;break;case"max":default:Ne=de.maxActivation;break}return{...de,score:Ne}});return xwe(q,p)},[bo,p]),ds=(0,V.useMemo)(()=>{let q=k.toLowerCase().trim();return q?_r.filter(de=>de.label.toLowerCase().includes(q)||String(de.index).includes(q)):_r},[_r,k]),Cp=(0,V.useMemo)(()=>ds.slice(0,A),[ds,A]),ti=g??(ae.length===1?ae[0]:h),yI=ke&&ae.length>=2,Nd=!ke&&ae.length>=1,$v=(0,V.useMemo)(()=>ae.map(q=>_r.find(de=>de.index===q)).filter(q=>q!==void 0),[ae,_r]),Id=(0,V.useMemo)(()=>{let q=ht.get(ti??-1);if(q===void 0||!e[0])return{min:0,max:0};let de=e.map(Ne=>Ne[q]??0);return{min:Math.min(...de),max:Math.max(...de)}},[ti,e,ht]),SF=(0,V.useMemo)(()=>{let q=ht.get(ti??-1);if(q===void 0||!e[0])return()=>ge.container.backgroundColor||"#ffffff";let de=e.map(Gr=>Gr[q]??0),Ne=Math.min(...de),Xe=Math.max(...de),Lt=H!==null&&H!==""?parseFloat(H):Ne,sr=B!==null&&B!==""?parseFloat(B):Xe,Ze=Number.isNaN(Lt)?Ne:Lt,yt=Number.isNaN(sr)?Xe:sr,Zt=U.toLowerCase();fe&&(Zt="claudeOranges");let zt=Td[Zt]??Td.reds;if(Td[Zt]||console.warn(`Color map "${Zt}" not supported, using Reds.`),hI.includes(Zt)){let Gr=(Ze+yt)/2;if(X!==null&&X!==""){let Sp=parseFloat(X);Number.isNaN(Sp)||(Gr=Sp)}let Ho=[Ze===Gr&&Ze===yt?Ze-.001:Ze,Gr,yt===Gr&&yt===Ze?yt+.001:yt];return Dv(zt,Ho,{isDiverging:!0})}let Tt=Ze,Ar=Ze===yt?yt+1e-5:yt;return Dv(zt,[Tt,Ar],{minClamp:0,maxClamp:.7,isDiverging:!1})},[ti,U,H,B,X,e,ge.container.backgroundColor,fe,ht]),$i=(0,V.useMemo)(()=>{let q={};if(!e[0])return q;let de=e[0].length,Ne=U.toLowerCase(),Xe=Td[Ne]??Td.reds,Lt=hI.includes(Ne);for(let sr=0;sr<de;sr++){let Ze=e.map(Ar=>Ar[sr]??0),yt=Math.min(...Ze),vo=Math.max(...Ze),Zt=H!==null&&H!==""?parseFloat(H):yt,zt=B!==null&&B!==""?parseFloat(B):vo,Rt=Number.isNaN(Zt)?yt:Zt,Tt=Number.isNaN(zt)?vo:zt;if(Lt){let Ar=(Rt+Tt)/2;if(X!==null&&X!==""){let Ho=parseFloat(X);Number.isNaN(Ho)||(Ar=Ho)}let Gr=[Rt===Ar&&Rt===Tt?Rt-.001:Rt,Ar,Tt===Ar&&Tt===Rt?Tt+.001:Tt];q[sr]=Dv(Xe,Gr,{isDiverging:!0})}else{let Ar=Rt,Gr=Rt===Tt?Tt+1e-5:Tt;q[sr]=Dv(Xe,[Ar,Gr],{minClamp:0,maxClamp:.7,isDiverging:!1})}}return q},[e,U,H,B,X,Td,hI,Dv]),kF=(0,V.useCallback)((q,de)=>{if(y(q),Be){let Ne=_r.find(Xe=>Xe.index===q);if(Ne&&(!ne||!ne.isClick||ne.index!==q)){let Xe=mt.current?.getBoundingClientRect(),Lt={x:de.clientX-(Xe?.left??0)+15,y:de.clientY-(Xe?.top??0)+15};le({...Ne,isClick:!1,position:Lt})}}},[Be,_r,ne,mt]),TF=(0,V.useCallback)(()=>{y(null),Be&&ne&&!ne.isClick&&le(null)},[Be,ne]),NF=(0,V.useCallback)((q,de)=>{if(me(Ne=>Ne.includes(q)?Ne.filter(Xe=>Xe!==q):[...Ne,q]),me(Ne=>(Ne.length===1?x(Ne[0]):x(null),Ne)),Be){let Ne=_r.find(Xe=>Xe.index===q);if(!Ne)return;if(ne?.index===q&&ne.isClick)le(null);else{let Xe=mt.current?.getBoundingClientRect(),Lt={x:de.clientX-(Xe?.left??0)+15,y:de.clientY-(Xe?.top??0)+15};le({...Ne,isClick:!0,position:Lt})}}},[Be,_r,ne,mt]),QY=(0,V.useCallback)((q,de)=>{if(we(q),C.includes(q)){let Zt=gI(q,e,r,n,O,d),zt=ht.get(h??-1),Rt=zt!==void 0?e[q]?.[zt]??null:null,Tt=mt.current?.getBoundingClientRect(),Ar=mt.current?.scrollLeft??0,Gr=mt.current?.scrollTop??0,Ho={x:de.clientX-(Tt?.left??0)+Ar+15,y:de.clientY-(Tt?.top??0)+Gr+15};v({tokenIndex:q,topFeatures:Zt,selectedFeatureValue:Rt,position:Ho});return}let Ne=gI(q,e,r,n,O,d),Xe=ht.get(h??-1),Lt=Xe!==void 0?e[q]?.[Xe]??null:null,sr=mt.current?.getBoundingClientRect(),Ze=mt.current?.scrollLeft??0,yt=mt.current?.scrollTop??0,vo={x:de.clientX-(sr?.left??0)+Ze+15,y:de.clientY-(sr?.top??0)+yt+15};v({tokenIndex:q,topFeatures:Ne,selectedFeatureValue:Lt,position:vo})},[e,r,n,O,d,h,C,ht]),ZY=(0,V.useCallback)(()=>{we(null),v(null)},[]),JY=(0,V.useCallback)(q=>{S(de=>de.includes(q)?de.filter(Ne=>Ne!==q):[...de,q]),v(null)},[]),IF=q=>{if(me(de=>de.includes(q)?de.filter(Ne=>Ne!==q):[...de,q]),me(de=>(de.length===1?x(de[0]):x(null),de)),Be&&ne?.isClick){let de=_r.find(Ne=>Ne.index===q);de&&le({...de,isClick:!0,position:ne.position})}},bI=(0,V.useCallback)(q=>{S(de=>de.filter(Ne=>Ne!==q)),v(null)},[]),EF=(0,V.useCallback)(q=>{me(de=>de.filter(Ne=>Ne!==q)),me(de=>(de.length===1?x(de[0]):de.length===0&&x(null),de))},[]),eQ=(0,V.useCallback)(()=>{le(null)},[]),vI=(q,de)=>{(de===""||de==="-"||!Number.isNaN(parseFloat(de)))&&q(de)},tQ=(0,V.useCallback)(()=>{Y(null),K(null),x(null),S([]),le(null),v(null),me([]),we(null),He(!1),P(l),pe(!1),R("claude-brown"),Pe(!0),Z(u??null)},[l,u]),rQ=(0,V.useCallback)(()=>{Ge(q=>!q),le(null),y(null)},[]),nQ=(0,V.useCallback)(()=>{ie(q=>q==="200px"?"500px":"200px")},[]),oQ=(0,V.useCallback)(q=>{He(q.target.checked)},[]),sQ=(0,V.useCallback)(()=>{R(q=>q==="light"?"dark":"light"),Pe(!1)},[]),iQ=(0,V.useCallback)(()=>{R("claude-brown"),P("claudeOranges"),Pe(!0)},[]),aQ=(0,V.useCallback)(()=>{pe(q=>!q)},[]),lQ=(0,V.useMemo)(()=>Object.keys(Td).filter(q=>q!=="claudeOranges"),[]),uQ=(0,V.useCallback)(()=>{ue(q=>q==="200px"?"500px":"200px")},[]),cQ=(0,V.useCallback)(()=>{hr(q=>q==="200px"?"500px":"200px")},[]),Ed=(0,V.useCallback)((q,de)=>{if(q===null)return"N/A";let Ne=ht.get(q);return Ne===void 0?"N/A":(e[de]?.[Ne]??0).toPrecision(3)},[ht,e]),_d=(0,V.useCallback)((q,de)=>{if(q===null)return pt.bg;let Ne=ht.get(q);if(Ne===void 0)return pt.bg;let Xe=e[de]?.[Ne]??0,Lt=$i[Ne];return Lt?Lt(Xe):pt.bg},[ht,e,$i,pt.bg]),wI=(0,V.useCallback)(q=>kd(q)>.5?en.light.text:en.dark.text,[en.light.text,en.dark.text]);if(!c||!e)return V.default.createElement("div",{style:ge.container},"Loading or no data...");let pQ=q=>C.includes(q);return V.default.createElement("div",{style:{...ge.container},ref:mt},V.default.createElement("div",{style:ge.controls},V.default.createElement("div",null,V.default.createElement("label",null,"Rank by: "),V.default.createElement("select",{value:p,onChange:q=>f(q.target.value)},V.default.createElement("option",{value:"max"},"Max Activation"),V.default.createElement("option",{value:"l1"},"Mean Abs Activation (L1)"),V.default.createElement("option",{value:"l0"},"Non-Zero Count (L0)"))),V.default.createElement("div",null,V.default.createElement("label",null,"Threshold: "),V.default.createElement("input",{type:"number",step:"any",placeholder:"None",value:d===null?"":d,onChange:q=>m(q.target.value===""?null:parseFloat(q.target.value)),style:{width:"60px"},title:"Activation threshold for L0 ranking and token tooltips"})),V.default.createElement("div",{style:ge.inputGroup},V.default.createElement("label",null,"Min Color: "),V.default.createElement("input",{type:"number",step:"any",placeholder:Id.min.toPrecision(3),value:H??"",onChange:q=>vI(Y,q.target.value),style:{width:"60px"},title:"Minimum value for color scale (leave blank for auto)"})),V.default.createElement("div",{style:ge.inputGroup},V.default.createElement("label",null,"Max Color: "),V.default.createElement("input",{type:"number",step:"any",placeholder:Id.max.toPrecision(3),value:B??"",onChange:q=>vI(K,q.target.value),style:{width:"60px"},title:"Maximum value for color scale (leave blank for auto)"})),hI.includes(U.toLowerCase())&&V.default.createElement("div",{style:ge.inputGroup},V.default.createElement("label",null,"Midpoint: "),V.default.createElement("input",{type:"number",step:"any",placeholder:`(${(Id.min+Id.max)/2})`,value:X??"",onChange:q=>vI(Z,q.target.value),style:{width:"60px"},title:"Midpoint for diverging color scale (leave blank for auto)"})),V.default.createElement("div",{style:ge.inputGroup},V.default.createElement("button",{onClick:tQ,title:"Reset color bounds, selected features, and selected tokens"},"Reset All")),V.default.createElement("div",null,V.default.createElement("label",null,"Top Overall: "),V.default.createElement("input",{type:"number",min:"1",step:"1",value:A,onChange:q=>$(parseInt(q.target.value,10)),style:{width:"50px"}})),V.default.createElement("div",null,V.default.createElement("label",null,"Top Per Token: "),V.default.createElement("input",{type:"number",min:"1",step:"1",value:O,onChange:q=>j(parseInt(q.target.value,10)),style:{width:"50px"}})),V.default.createElement("div",{style:ge.inputGroup},V.default.createElement("input",{type:"checkbox",id:"multiColorCheckbox",checked:ke,onChange:oQ,disabled:ae.length<2,title:ae.length<2?"Select 2 or more features to enable":"Color tokens based on activations of all selected features"}),V.default.createElement("label",{htmlFor:"multiColorCheckbox"},"Multi-Color Tokens")),V.default.createElement("div",null,V.default.createElement("label",null,"Color Map: "),V.default.createElement("select",{value:U,onChange:q=>{P(q.target.value),Pe(!1)},title:"Select color map for activations"},lQ.map(q=>V.default.createElement("option",{key:q,value:q},q)))),V.default.createElement("button",{onClick:sQ,title:`Switch to ${We==="light"?"Dark":"Light"} Mode`},We==="light"?"Dark Mode":"Light Mode"),V.default.createElement("button",{onClick:iQ,title:"Activate Claude Mode Theme",style:{opacity:.7}},"\u2728"),V.default.createElement("button",{onClick:rQ,style:{...ge.compactButton,marginLeft:"auto"},title:Be?"Show Full Labels":"Show Compact View"},Be?"Expand View":"Compact View")),V.default.createElement("div",{style:{display:"flex",justifyContent:"flex-start",alignItems:"center",marginBottom:"5px",flexWrap:"wrap",gap:"10px"}},V.default.createElement("div",{style:{...ge.featureSearch,marginRight:"auto"}}," ",V.default.createElement("label",null,"Search Features: "),V.default.createElement("input",{type:"text",placeholder:"Index or Label...",value:k,onChange:q=>I(q.target.value),style:{width:"200px",padding:"4px"}})),V.default.createElement("div",{style:{display:"flex",gap:"5px",alignItems:"center",marginLeft:"10px"}},V.default.createElement("button",{onClick:nQ,style:ge.compactButton,title:Q==="200px"?"Expand Feature List":"Collapse Feature List"},Q==="200px"?"Expand":"Collapse"))),V.default.createElement("div",{style:{...ge.featureListContainer,maxHeight:Q}},V.default.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"baseline",paddingRight:"8px",paddingTop:"10px",paddingLeft:"5px",paddingBottom:"10px",position:"sticky",top:0,backgroundColor:pt.containerBg,zIndex:5,boxShadow:"0 2px 4px rgba(0,0,0,0.05)",isolation:"isolate",backdropFilter:"blur(2px)"}},V.default.createElement("strong",null,"Top ",Cp.length," Features (",ds.length," Total) (Ranked by"," ",bwe(p),k?", Filtered":"","):"),!Be&&V.default.createElement("span",{style:{fontSize:"0.8em",color:pt.dimText,whiteSpace:"nowrap"}},"Value ")),Be?V.default.createElement("div",{style:ge.featureGrid},Cp.map(q=>{let de=`Index: ${q.index}
Max: ${q.maxActivation.toFixed(3)}, L1: ${q.meanAbsActivation.toFixed(3)}, L0: ${q.nonZeroCount}
${q.label}`,Ne=ae.includes(q.index),Xe=g===q.index;return V.default.createElement("div",{key:q.index,style:{...ge.featureTile,...Xe?ge.featureTileHover:{},...Ne?ge.featureTileSelected:{}},onMouseEnter:Lt=>kF(q.index,Lt),onMouseLeave:TF,onClick:Lt=>NF(q.index,Lt),title:de},q.index," ")})):V.default.createElement("div",null,Cp.map(q=>{let de=q.index,Ne=be!==null?ht.get(de):void 0,Xe=be!==null&&Ne!==void 0?e[be]?.[Ne]??0:null,Lt=ht.get(q.index),sr=Lt!==void 0&&$i?$i[Lt]:null,Ze=Xe!==null&&sr?sr(Xe):pt.bg,yt=pt.text;Xe!==null&&(yt=kd(Ze)>.5?en.light.text:en.dark.text);let vo=Xe?.toPrecision(3)??"N/A",Zt=Xe!==null?`Activation at Token ${be}: ${Xe.toPrecision(4)}`:"Hover over a token to see value";return V.default.createElement("div",{key:q.index,style:{...ge.featureListItem,...g===q.index?ge.featureListItemHover:{},...ae.includes(q.index)?ge.featureListItemSelected:{}},onMouseEnter:zt=>kF(q.index,zt),onMouseLeave:TF,onClick:zt=>NF(q.index,zt),title:`Feature ${q.index}: ${q.label}
Max: ${q.maxActivation.toPrecision(3)}, L1: ${q.meanAbsActivation.toPrecision(3)}, L0: ${q.nonZeroCount}`},V.default.createElement("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",marginRight:"10px"}},V.default.createElement("strong",null,"Feature ",q.index,":")," ",q.label,V.default.createElement("span",{style:{fontSize:"0.85em",color:ge.featureScore.color,marginLeft:"5px"}},"(Max: ",q.maxActivation.toPrecision(3),", L1:"," ",q.meanAbsActivation.toPrecision(3),", L0:"," ",q.nonZeroCount,")")),V.default.createElement("div",{style:{display:"flex",alignItems:"center",marginLeft:"auto",flexShrink:0}},V.default.createElement("span",{style:{...ge.featureValueIndicator,backgroundColor:Ze,color:yt},title:Zt},vo)))})),ds.length>A&&V.default.createElement("div",{style:{textAlign:"center",padding:"5px",fontSize:"0.8em",color:"#555"}},"Showing ",A," of ",ds.length," ","features."),ds.length===0&&k&&V.default.createElement("div",{style:{textAlign:"center",padding:"5px",fontSize:"0.9em",color:"#777"}},"No features match search term.")),$v.length>0&&V.default.createElement("div",{style:{...ge.selectedFeaturesContainer,maxHeight:re,position:"relative"}},V.default.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"5px",position:"sticky",top:0,backgroundColor:pt.containerBg,zIndex:5,paddingBottom:"3px",paddingTop:"3px",borderBottom:`1px solid ${pt.subtleBorder}`,width:"100%",boxShadow:"0 2px 4px rgba(0,0,0,0.05)",isolation:"isolate"}},V.default.createElement("strong",null,"Selected Features:"),V.default.createElement("button",{onClick:uQ,style:ge.compactButton,title:re==="200px"?"Expand Selected Features":"Collapse Selected Features"},re==="200px"?"Expand":"Collapse")),V.default.createElement("div",{style:{paddingTop:"10px"}}," ",$v.map(q=>{let de=ht.get(q.index),Ne=be!==null&&de!==void 0?e[be]?.[de]??0:null,Xe=de!==void 0&&$i?$i[de]:null,Lt=Ne!==null&&Xe?Xe(Ne):pt.bg,sr=pt.text;Ne!==null&&(sr=kd(Lt)>.5?en.light.text:en.dark.text);let Ze=Ne?.toPrecision(3)??"N/A",yt=be!==null&&de!==void 0&&e[be]?.[de]!==void 0;if(Be)return V.default.createElement("div",{key:q.index,onMouseEnter:()=>y(q.index),onMouseLeave:()=>y(null),style:{...ge.selectedFeatureInfoBox,display:"flex",justifyContent:"space-between",alignItems:"center",padding:"4px 8px"}},V.default.createElement("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",marginRight:"10px"},title:q.label},V.default.createElement("strong",null,"Feature ",q.index,":")," ",q.label,V.default.createElement("span",{style:{fontSize:"0.85em",color:ge.featureScore.color,marginLeft:"5px",whiteSpace:"nowrap"},title:`Max: ${q.maxActivation.toPrecision(3)}, L1: ${q.meanAbsActivation.toPrecision(3)}, L0: ${q.nonZeroCount}`},"(Max: ",q.maxActivation.toPrecision(3),", L1:"," ",q.meanAbsActivation.toPrecision(3),", L0:"," ",q.nonZeroCount,")")),V.default.createElement("div",{style:{display:"flex",alignItems:"center",gap:"5px",marginLeft:"auto",flexShrink:0}},V.default.createElement("span",{style:{...ge.featureValueIndicator,backgroundColor:Lt,color:sr},title:`Activation at hovered token: ${Ze}`},Ze),V.default.createElement("button",{onClick:()=>EF(q.index),style:{...ge.selectedItemCloseButton,position:"static",fontSize:"1.1em",padding:"0 3px"},title:"Deselect Feature"},"\xD7")));let vo={backgroundColor:yt?pt.boxHoverBg:pt.bg};return V.default.createElement("div",{key:q.index,style:{...ge.selectedFeatureInfoBox,...vo},onMouseEnter:()=>y(q.index),onMouseLeave:()=>y(null)},V.default.createElement("button",{onClick:()=>EF(q.index),style:ge.selectedItemCloseButton,title:"Deselect Feature"},"\xD7"),V.default.createElement("div",null,V.default.createElement("strong",null,"Feature ",q.index,":")," ",q.label," - ",V.default.createElement("span",{style:{fontSize:"0.9em",color:ge.featureScore.color}},"(Max: ",q.maxActivation.toPrecision(3),", L1:"," ",q.meanAbsActivation.toPrecision(3),", L0:"," ",q.nonZeroCount,")")),V.default.createElement("div",{style:{marginTop:"3px"}},V.default.createElement("span",{style:ge.dynamicInfoLabel},"Value at Token "),be!==null?V.default.createElement("span",{style:{fontWeight:"bold"}},c[be]):"?",":",V.default.createElement("span",{style:{...ge.featureValueIndicator,backgroundColor:Lt,color:sr},title:`Activation: ${Ze}`},Ze)))}))),C.length>0&&V.default.createElement("div",{style:{...ge.selectedTokensContainer,maxHeight:$t,position:"relative",...Be&&!se?ge.selectedTokensContainerCompactWrap:{}}},V.default.createElement("div",{style:{display:"flex",gap:"10px",justifyContent:"space-between",alignItems:"center",marginBottom:"5px",position:"sticky",top:0,backgroundColor:pt.containerBg,zIndex:5,paddingBottom:"3px",paddingTop:"3px",borderBottom:`1px solid ${pt.subtleBorder}`,width:"100%",boxShadow:"0 2px 4px rgba(0,0,0,0.05)",isolation:"isolate",backdropFilter:"blur(2px)"}},V.default.createElement("strong",null,"Selected Tokens:"),V.default.createElement("div",{style:{display:"flex",gap:"5px"}},!(Be&&!se)&&V.default.createElement("button",{onClick:aQ,style:ge.compactButton,title:se?"Hide Top Features list":"Show Top Features list"},se?"Hide Top Features":"Show Top Features"),V.default.createElement("button",{onClick:cQ,style:ge.compactButton,title:$t==="200px"?"Expand Selected Tokens":"Collapse Selected Tokens"},$t==="200px"?"Expand":"Collapse"))),V.default.createElement("div",{style:{paddingTop:"10px"}}," ",C.map(q=>{let de=h,Ne=de!==null?ht.get(de):void 0,Xe=null;Ne!==void 0&&q<e.length?Xe=e[q]?.[Ne]??0:de!==null&&(console.warn(`[SaeVis] Could not find array index for selected feature ID: ${de}.`),Xe=null);let Lt=Ne!==void 0&&$i?$i[Ne]:null,sr=Xe!==null&&Lt?Lt(Xe):pt.bg,Ze=pt.text;Xe!==null&&(Ze=kd(sr)>.5?en.light.text:en.dark.text);let yt=Xe!==null?Xe.toPrecision(3):"N/A",vo=ht.get(g??-1),Zt=vo!==void 0&&e[q]?.[vo]!==void 0,zt={...ge.selectedTokenInfoBox,backgroundColor:Zt?pt.boxHoverBg:pt.bg};return Be&&!se?V.default.createElement("div",{key:q,style:ge.selectedTokenInfoBoxCompactTile},V.default.createElement("span",null,V.default.createElement("strong",null,"T",q,":"),' "',c[q].substring(0,10),'"',c[q].length>10?"...":""),g!==null&&V.default.createElement("span",{style:{...ge.featureValueIndicator,padding:"0 2px",height:"1.3em",minWidth:"2em",fontSize:"0.8em",backgroundColor:_d(g,q),color:wI(_d(g,q))},title:`Feature ${g}: ${Ed(g,q)}`},Ed(g,q)),g===null&&h!==null&&V.default.createElement("span",{style:{...ge.featureValueIndicator,padding:"0 2px",height:"1.3em",minWidth:"2em",fontSize:"0.8em",backgroundColor:sr,color:Ze},title:`Feature ${de??"?"}: ${yt}`},yt),g===null&&h===null&&V.default.createElement("span",{style:{...ge.featureValueIndicator,padding:"0 2px",height:"1.3em",minWidth:"2em",fontSize:"0.8em"}},"N/A"),V.default.createElement("button",{onClick:()=>bI(q),style:{...ge.selectedItemCloseButton,position:"static",fontSize:"1em",padding:"0 2px"},title:"Deselect Token"},"\xD7")):Be?V.default.createElement("div",{key:q,style:zt},V.default.createElement("button",{onClick:()=>bI(q),style:ge.selectedItemCloseButton,title:"Deselect Token"},"\xD7"),V.default.createElement("strong",null,"Token ",q,': "',c[q],'"'),V.default.createElement("div",{style:{marginTop:"5px",paddingTop:"5px",borderTop:`1px dashed ${ge.container.borderColor}`}},g!==null&&V.default.createElement(V.default.Fragment,null,V.default.createElement("span",{style:ge.dynamicInfoLabel},"Feature ",g,":"," "),V.default.createElement("span",{style:{...ge.featureValueIndicator,backgroundColor:_d(g,q),color:wI(_d(g,q))},title:`Value: ${Ed(g,q)}`},Ed(g,q))),g===null&&h!==null&&V.default.createElement(V.default.Fragment,null,V.default.createElement("span",{style:ge.dynamicInfoLabel},"Feature ",de??"?",":"," "),V.default.createElement("span",{style:{...ge.featureValueIndicator,backgroundColor:sr,color:Ze},title:`Value: ${yt}`},yt)),g===null&&h===null&&V.default.createElement("span",{style:ge.dynamicInfoLabel},"Hover over a feature to see values"))):V.default.createElement("div",{key:q,style:zt},V.default.createElement("button",{onClick:()=>bI(q),style:ge.selectedItemCloseButton,title:"Deselect Token"},"\xD7"),V.default.createElement("strong",null,"Token ",q,': "',c[q],'"'),V.default.createElement("div",{style:{marginTop:"3px"}},g!==null&&V.default.createElement(V.default.Fragment,null,V.default.createElement("span",{style:ge.dynamicInfoLabel},"Feature ",g,":"," "),V.default.createElement("span",{style:{...ge.featureValueIndicator,backgroundColor:_d(g,q),color:wI(_d(g,q))},title:`Value: ${Ed(g,q)}`},Ed(g,q))),g===null&&h!==null&&V.default.createElement(V.default.Fragment,null,V.default.createElement("span",{style:ge.dynamicInfoLabel},"Feature ",de??"?",":"," "),V.default.createElement("span",{style:{...ge.featureValueIndicator,backgroundColor:sr,color:Ze},title:`Value: ${yt}`},yt)),g===null&&h===null&&V.default.createElement("span",{style:ge.dynamicInfoLabel},"Hover over a feature to see values")),se&&V.default.createElement("div",{style:{marginTop:"5px",paddingTop:"5px",borderTop:`1px dashed ${ge.container.borderColor}`},title:`Showing top ${O} features with abs activation >= ${d??0}`},V.default.createElement("strong",null,"Top Features:"),gI(q,e,r,n,O,d).length===0&&V.default.createElement("div",null,"(None above threshold)"),gI(q,e,r,n,O,d).map(Rt=>V.default.createElement("div",{key:Rt.index},V.default.createElement("span",{style:ge.featureListIndexValue},`Feature ${Rt.index}: ${Rt.activation.toFixed(3)}`)," ",V.default.createElement("span",{style:{...ge.featureListDescription,cursor:"pointer"},className:"feature-list-item-clickable",onClick:()=>IF(Rt.index),onMouseEnter:Tt=>{Tt.target.style.textDecoration="underline"},onMouseLeave:Tt=>{Tt.target.style.textDecoration="none"},title:`Select Feature ${Rt.index} for coloring/multi-select`},"- ",Rt.label.substring(0,60),Rt.label.length>60?"...":"")))))}))),V.default.createElement("div",{style:ge.tokenSequence},c.map((q,de)=>{let Ne=be===de,Xe=pQ(de),Lt=yI,sr=Nd,Ze={...ge.token},yt=q,vo=typeof q=="string"&&/[↵]/.test(q);if(g!==null){let Zt=ht.get(g??-1);if(Zt!==void 0){let zt=e[de]?.[Zt]??0,Tt=SF(zt),Ar=kd(Tt)>.5?en.light.text:en.dark.text,Gr=d!==null&&zt!==0&&Math.abs(zt)<d;Ze={...Ze,backgroundColor:Tt,color:Ar,opacity:Gr?.5:1}}else console.warn("Could not find array index for hovered feature:",g)}else if(Lt){let zt=100/ae.length,Rt=ae.map(Tt=>{let Ar=ht.get(Tt);if(Ar===void 0)return console.warn("Could not find array index for selected feature:",Tt),null;let Gr=e[de]?.[Ar]??0,Ho=$i[Ar],Sp=Ho?Ho(Gr):"transparent",px={height:`${zt}%`,width:"100%",backgroundColor:Sp};return V.default.createElement("div",{key:Tt,style:px})});Ze={...Ze,display:"inline",position:"relative",backgroundColor:"transparent",color:pt.text},yt=V.default.createElement("span",{style:{position:"relative",display:"inline-block",verticalAlign:"bottom"}},V.default.createElement("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",flexDirection:"column",zIndex:0}},Rt),V.default.createElement("span",{style:{...ge.tokenTextOverlay,position:"relative"}},typeof q=="string"?q.replace(/\n/g,"\u21B5"):""))}else if(sr){let Zt=ae.reduce((Gr,Ho)=>{let Sp=ht.get(Ho);if(Sp===void 0)return console.warn("Could not find array index for selected feature:",Ho),Gr;let px=e[de]?.[Sp]??0;return Math.abs(px)>Gr.maxAbs?{index:Ho,value:px,maxAbs:Math.abs(px)}:Gr},{index:-1,value:0,maxAbs:-1/0}),zt=ht.get(Zt.index??-1),Rt=zt!==void 0?$i[zt]:null,Tt=Rt?Rt(Zt.value):"transparent",Ar=kd(Tt)>.5?en.light.text:en.dark.text;Ze={...Ze,backgroundColor:Tt,color:Ar}}else{let Zt=ht.get(ti??-1);if(Zt!==void 0){let zt=e[de]?.[Zt]??0,Rt=ti!==null?SF(zt):ge.container.backgroundColor||"transparent",Tt=kd(Rt)>.5?en.light.text:en.dark.text,Ar=ti!==null&&d!==null&&zt!==0&&Math.abs(zt)<d;Ze={...Ze,backgroundColor:Rt,color:Tt,opacity:Ar?.5:1}}else Ze={...Ze,backgroundColor:ge.container.backgroundColor||"transparent",color:pt.text}}return Ne&&!Xe&&(Ze={...Ze,...ge.tokenHover}),Xe&&(Ze={...Ze,...ge.tokenClicked}),V.default.createElement(V.default.Fragment,{key:de},V.default.createElement("span",{style:Ze,onMouseEnter:Zt=>QY(de,Zt),onMouseLeave:ZY,onClick:()=>JY(de),title:q.includes(`
`)?q.replace(/\n/g,"\u21B5"):void 0},typeof yt=="string"?yt.replace(/\n/g,"\u21B5"):yt),vo&&V.default.createElement("br",null))})),b&&V.default.createElement("div",{style:{...ge.tooltip,left:`${b.position.x}px`,top:`${b.position.y}px`}},V.default.createElement("strong",null,"Token ",b.tokenIndex,': "',c[b.tokenIndex],'"'),b.selectedFeatureValue!==null&&V.default.createElement("div",{style:{marginTop:"5px",borderTop:"1px dashed #ccc",paddingTop:"5px"}},"Selected Feature ",h,":"," ",b.selectedFeatureValue.toPrecision(3)),V.default.createElement("br",null),V.default.createElement("strong",{title:`Showing top ${O} features with abs activation >= ${d??0}`},"Top Features:"),b.topFeatures.length===0&&V.default.createElement("div",null,"(None above threshold)"),b.topFeatures.map(q=>V.default.createElement("div",{key:q.index},V.default.createElement("span",{style:ge.featureListIndexValue},`Feature ${q.index}: ${q.activation.toFixed(3)}`),V.default.createElement("span",{style:{...ge.featureListDescription,cursor:"pointer"},className:"feature-list-item-clickable",onClick:()=>IF(q.index),onMouseEnter:de=>{de.target.style.textDecoration="underline"},onMouseLeave:de=>{de.target.style.textDecoration="none"},title:`Select Feature ${q.index} for coloring/multi-select`},"- ",q.label.substring(0,60),q.label.length>60?"...":"")))),Be&&ne&&V.default.createElement("div",{style:{...ge.tooltip,position:"absolute",left:`${ne.position.x}px`,top:`${ne.position.y}px`,...ne.isClick?ge.tooltipSticky:{}}},ne.isClick&&V.default.createElement("button",{onClick:eQ,style:ge.tooltipCloseButton,title:"Close Feature Info"},"\xD7"),V.default.createElement("strong",null,"Feature ",ne.index),V.default.createElement("div",{style:{marginTop:"5px"}},V.default.createElement("strong",null,"Label:")," ",ne.label),V.default.createElement("div",{style:{marginTop:"5px",paddingTop:"5px",borderTop:"1px dashed #ccc"}},V.default.createElement("strong",null,"Stats:"),V.default.createElement("div",null,"Max: ",ne.maxActivation.toPrecision(3)),V.default.createElement("div",null,"L1: ",ne.meanAbsActivation.toPrecision(3)),V.default.createElement("div",null,"L0: ",ne.nonZeroCount))))};var VY=nt(ct());function wwe({name:t}){return VY.default.createElement("p",null,"Hello, ",t,"!")}var vr=nt(ct());var hu=nt(ct());function xI({token:t,value:e,min:r,max:n,negativeColor:o,positiveColor:s,tooltip:i=hu.default.createElement(hu.default.Fragment,null,"Intentionally Left Blank")}){let{getTooltipProps:a,setTooltipRef:l,setTriggerRef:u,visible:c}=zg({followCursor:!0}),p=lp(e,r,n,o,s).toRgbString(),f=cr(p).brightness()<.6?"white":"black",d={display:"inline-block",backgroundColor:p,color:f,lineHeight:"1em",padding:"3px 0",marginLeft:-1,marginBottom:1,borderWidth:1,borderStyle:"solid",borderColor:"#eee"},m=Yb(t),h=t.match(/\n/g);return hu.default.createElement(hu.default.Fragment,null,hu.default.createElement("span",{ref:u},hu.default.createElement("span",{style:d,dangerouslySetInnerHTML:{__html:m}}),h?.map((x,g)=>hu.default.createElement("br",{key:g}))),c&&hu.default.createElement("div",{ref:l,...a({style:{background:"#eee",color:"black",textAlign:"center",padding:10,borderRadius:5,boxShadow:"5px 5px rgba(0, 0, 0, 0.03)",marginTop:15}})},i))}Tk([JT,eN]);var yF=5;function WY(t,e="blue",r=-yF){return cr(e).mix(cr("grey"),Math.min(-t/-r,1))}function bF({token:t}){return vr.default.createElement("span",{style:{borderColor:"green",borderWidth:1,borderStyle:"solid"},dangerouslySetInnerHTML:{__html:Yb(t)}})}function GY({token:t,logProb:e,rank:r,isCorrectToken:n}){let o={color:"orange",backgroundColor:WY(e).toRgbString(),fontWeight:"bold"},s={color:"white",backgroundColor:WY(e).toRgbString()};return vr.default.createElement("tr",{style:n?o:s},vr.default.createElement("td",null,"#",r),vr.default.createElement("td",null,(Math.exp(e)*100).toFixed(2),"%"),vr.default.createElement("td",null,e.toFixed(3)),vr.default.createElement("td",null,vr.default.createElement(bF,{token:t})))}function Cwe({currentCorrectToken:t,currentCorrectTokenRank:e,currentCorrectTokenLogProb:r,currentTopKLogProbs:n,currentTopKTokens:o,prevToken:s}){return vr.default.createElement("div",null,vr.default.createElement("div",{style:{fontSize:20,fontWeight:"bold",backgroundColor:"white",color:"black"}},vr.default.createElement(bF,{token:s})," -",">"," ",vr.default.createElement(bF,{token:t})),vr.default.createElement("table",null,vr.default.createElement("tr",null,vr.default.createElement("th",null,"Rank"),vr.default.createElement("th",null,"Prob"),vr.default.createElement("th",null,"Log Prob"),vr.default.createElement("th",null,"String")),vr.default.createElement(GY,{token:t,logProb:r,rank:e,isCorrectToken:!0}),vr.default.createElement("hr",null),o.map((i,a)=>vr.default.createElement(GY,{key:a,token:o[a],logProb:n[a],rank:a,isCorrectToken:e===a}))))}function Swe({prompt:t,topKLogProbs:e,topKTokens:r,correctTokenRank:n,correctTokenLogProb:o}){return vr.default.createElement("div",{style:{paddingBottom:350}},t.slice(1).map((s,i)=>vr.default.createElement(xI,{key:i,token:s,value:Math.max(yF+o[i],0),min:-.1,max:yF,positiveColor:"red",tooltip:vr.default.createElement(Cwe,{currentCorrectToken:s,currentCorrectTokenRank:n[i],currentCorrectTokenLogProb:o[i],currentTopKLogProbs:e[i],currentTopKTokens:r[i],prevToken:t[i]})})))}var qY=nt(ct()),jY=nt(HY());function kwe(t,e,r={}){let n=document.querySelector(`#${t}`),o=jY.default.createRoot(n),s=qY.default.createElement(e,r);o.render(s)}var qt=nt(ct());var wF=nt(ct());function KY({maxValue:t,minValue:e,negativeColor:r,positiveColor:n,tokens:o,values:s,tooltips:i}){let a=e??Math.min(...s),l=t??Math.max(...s);return wF.default.createElement("div",{className:"colored-tokens",style:{paddingBottom:30}},o.map((u,c)=>wF.default.createElement(xI,{key:c,token:u,value:s[c],min:a,max:l,negativeColor:r,positiveColor:n,tooltip:i[c]})))}var CF=6;function Twe({values:t,labels:e,selectedValue:r,setSelectedValue:n}){let o=t.shape[1],{focused:s,onClick:i,onMouseEnter:a,onMouseLeave:l}=hd();(0,qt.useEffect)(()=>{s!==null&&n(s)},[s,n]);let u=[];for(let c=0;c<o;c++){let p=c===r,f=e[c];u.push(qt.default.createElement("div",{key:c,style:{display:"inline-block",padding:"0 5px",backgroundColor:p?"black":"white",color:p?"white":"black",cursor:"pointer"},onClick:()=>i(c),onMouseEnter:()=>a(c),onMouseLeave:l},f))}return qt.default.createElement("div",null,u)}function XY({value:t,setValue:e,defaultValue:r,label:n}){return qt.default.createElement("div",null,qt.default.createElement("label",{htmlFor:n},n,":")," ",qt.default.createElement("input",{type:"text",id:"number",value:t,onChange:i=>{e(parseFloat(i.target.value))}}),r&&qt.default.createElement("button",{type:"button",onClick:()=>{e(r)}},"Reset"))}function Nwe({title:t,labels:e,values:r,tokenIndex:n,currentValueIndex:o}){let s=r.shape[1],i=[];for(let a=0;a<s;a++)i.push(qt.default.createElement("tr",{key:a},qt.default.createElement("td",{style:{fontWeight:"bold"}},e[a]),qt.default.createElement("td",{style:{textAlign:"right",fontWeight:o===a?"bold":"normal"}},r.bufferSync().get(n,a).toFixed(CF))));return qt.default.createElement(qt.default.Fragment,null,qt.default.createElement("div",{style:{fontWeight:"bold",fontSize:16,backgroundColor:"white"}},t),qt.default.createElement("table",null,qt.default.createElement("tbody",null,i)))}function Iwe({tokens:t,values:e,labels:r,positiveBounds:n,negativeBounds:o}){let s=Cr(e),i=s.shape[1],a=n?Cr(n):s.max(0).maximum(1e-7),l=o?Cr(o):s.min(0).minimum(-1e-7),u=r||Array.from(Array(i).keys()).map((b,v)=>`${v}`),[c,p]=(0,qt.useState)(0),f=Number(a.arraySync()[c].toFixed(CF)),d=Number(l.arraySync()[c].toFixed(CF)),[m,h]=(0,qt.useState)(Number(f)),[x,g]=(0,qt.useState)(Number(d)),y=s.slice([0,c],[-1,1]).squeeze([1]);return qt.default.createElement("div",{style:{paddingBottom:20*i}},qt.default.createElement(Twe,{values:s,labels:u,selectedValue:c,setSelectedValue:p}),qt.default.createElement(XY,{value:m,setValue:h,defaultValue:f,label:"Positive Bound"}),qt.default.createElement(XY,{value:x,setValue:g,defaultValue:d,label:"Negative Bound"}),qt.default.createElement("br",null),qt.default.createElement(KY,{tokens:t,values:y.arraySync(),maxValue:m,minValue:x,tooltips:y.arraySync().map((b,v)=>qt.default.createElement(Nwe,{key:v,title:t[v],labels:u,values:s,tokenIndex:v,currentValueIndex:c}))}))}var Dt=nt(ct()),Wn=nt(Bf());function Ewe({tokens:t,activations:e,zerothDimensionName:r="Layer",firstDimensionName:n="Neuron",zerothDimensionLabels:o,firstDimensionLabels:s}){let i=e.length,a=e[0].length,l=e[0][0].length,[u,c]=(0,Dt.useState)(Math.min(5,l)),[p,f]=(0,Dt.useState)([...Array(u).keys()]),[d,m]=(0,Dt.useState)(0),[h,x]=(0,Dt.useState)(0);(0,Dt.useEffect)(()=>{f([...Array(u).keys()])},[u]);let g=p.map(S=>e[d][h][S]),y=p.map(S=>t[d][h][S]),[b,v]=Zb(e[d][h]),C={paddingTop:5,paddingBottom:5};return Dt.default.createElement(Wn.Container,{fluid:!0},Dt.default.createElement(Wn.Row,null,Dt.default.createElement(Wn.Col,null,Dt.default.createElement(Wn.Row,{style:C},Dt.default.createElement(Wn.Col,null,Dt.default.createElement("label",{htmlFor:"layer-selector",style:{marginRight:15}},r,":"),Dt.default.createElement(cs,{id:"layer-selector",largestNumber:i-1,currentValue:d,setCurrentValue:m,labels:o}))),Dt.default.createElement(Wn.Row,{style:C},Dt.default.createElement(Wn.Col,null,Dt.default.createElement("label",{htmlFor:"neuron-selector",style:{marginRight:15}},n,":"),Dt.default.createElement(cs,{id:"neuron-selector",largestNumber:a-1,currentValue:h,setCurrentValue:x,labels:s}))),l>1&&Dt.default.createElement(Wn.Row,{style:C},Dt.default.createElement(Wn.Col,null,Dt.default.createElement("label",{htmlFor:"sample-selector",style:{marginRight:15}},"Samples (descending):"),Dt.default.createElement(Wg,{id:"sample-selector",largestNumber:l-1,currentRangeArr:p,setCurrentValue:f,numValsInRange:u})))),Dt.default.createElement(Wn.Col,null,l>1&&Dt.default.createElement(Wn.Row,{style:C},Dt.default.createElement(Wn.Col,null,Dt.default.createElement("label",{htmlFor:"samples-per-page-selector",style:{marginRight:15}},"Samples per page:"),Dt.default.createElement(cs,{id:"samples-per-page-selector",smallestNumber:1,largestNumber:l,currentValue:u,setCurrentValue:c}))))),Dt.default.createElement(Wn.Row,null,Dt.default.createElement(Wn.Col,null,Dt.default.createElement(rN,{activationsList:g,tokensList:y,minValue:b,maxValue:v}))))}var Ae=nt(ct()),hn=nt(Bf());function YY({tdKey:t,token:e,value:r,minValue:n,maxValue:o,negativeColor:s,positiveColor:i}){let{getTooltipProps:a,setTooltipRef:l,setTriggerRef:u,visible:c}=zg({followCursor:!0}),p=lp(r,n,o,s,i).toRgbString(),f=cr(p).brightness()<.6?"white":"black",m=e.replace(/\s/g,"&nbsp;").replace(/\n/g,"\xB6");return Ae.default.createElement("td",{key:t,style:{backgroundColor:p,borderWidth:1,borderStyle:"solid",borderColor:"black"}},Ae.default.createElement("span",{ref:u,style:{display:"block",color:f},dangerouslySetInnerHTML:{__html:m}}),c&&Ae.default.createElement("div",{ref:l,...a({style:{background:"#333",color:"white",textAlign:"center",padding:10,borderRadius:5,boxShadow:"5px 5px rgba(0, 0, 0, 0.03)",marginTop:15,zIndex:1}})},Ae.default.createElement("strong",null,e),Ae.default.createElement("br",null),r))}function _we({topkActivations:t,bottomkActivations:e,topkTokens:r,bottomkTokens:n,neuronNumbers:o,filter:s,colLabel:i}){return Ae.default.createElement("table",{style:{marginTop:15,marginLeft:15}},Ae.default.createElement("thead",null,Ae.default.createElement("tr",null,Ae.default.createElement("th",{colSpan:o.length+1,style:{textAlign:"center",paddingLeft:"9ch"}},i)),Ae.default.createElement("tr",null,Ae.default.createElement("th",{key:"default",style:{textAlign:"center"}}),o.map(a=>Ae.default.createElement("th",{key:a,style:{textAlign:"center"}},a)))),Ae.default.createElement("tbody",null,s.includes("topk")&&t.map((a,l)=>Ae.default.createElement("tr",{key:l},l===0&&Ae.default.createElement("td",{key:"default",style:{textAlign:"center",fontWeight:"bold"},rowSpan:t.length},"Topk \u2193"),a.map((u,c)=>Ae.default.createElement(YY,{key:c,tdKey:c,token:r[l][c],value:u,minValue:0,maxValue:1})))),s==="topk+bottomk"&&Ae.default.createElement("tr",null,Ae.default.createElement("td",{key:"default",style:{textAlign:"center"}}),Array(t[0].length).fill(0).map((a,l)=>Ae.default.createElement("td",{key:l},Ae.default.createElement("div",{style:{textAlign:"center"}},"...")))),s.includes("bottomk")&&e.map((a,l)=>Ae.default.createElement("tr",{key:l},l===0&&Ae.default.createElement("td",{key:"default",style:{textAlign:"center",fontWeight:"bold"},rowSpan:e.length},"Bottomk \u2193"),a.map((u,c)=>Ae.default.createElement(YY,{key:c,tdKey:c,token:n[l][c],value:u,minValue:0,maxValue:1}))))))}function Awe({tokens:t,topkVals:e,topkIdxs:r,bottomkVals:n,bottomkIdxs:o,firstDimensionName:s="Layer",thirdDimensionName:i="Neuron",sampleLabels:a,firstDimensionLabels:l}){let u=e.length,c=e[0].length,p=e[0][0].length,f=e[0][0][0].length,[d,m]=(0,Ae.useState)(0),[h,x]=(0,Ae.useState)(0),[g,y]=(0,Ae.useState)(5),[b,v]=(0,Ae.useState)(p),[C,S]=(0,Ae.useState)([...Array(g).keys()]),[k,I]=(0,Ae.useState)("topk+bottomk");(0,Ae.useEffect)(()=>{S(u>1?[...Array(g).keys()]:[0])},[g,u]);let A=t[d],$=[[0,b],[C[0],C[C.length-1]+1]],O=Qb(e[d][h],$),j=Qb(r[d][h],$),H=Qb(n[d][h],$),Y=Qb(o[d][h],$),B=j.map(Z=>Z.map(Q=>A[Q])),K=Y.map(Z=>Z.map(Q=>A[Q])),X={paddingTop:5,paddingBottom:5};return Ae.default.createElement("div",null,Ae.default.createElement(hn.Container,{fluid:!0},Ae.default.createElement(hn.Row,null,Ae.default.createElement(hn.Col,null,Ae.default.createElement(hn.Row,{style:X},Ae.default.createElement(hn.Col,null,Ae.default.createElement("label",{htmlFor:"sample-selector",style:{marginRight:15}},"Sample:"),Ae.default.createElement(cs,{id:"sample-selector",smallestNumber:0,largestNumber:u-1,currentValue:d,setCurrentValue:m,labels:a}))),Ae.default.createElement(hn.Row,{style:X},Ae.default.createElement(hn.Col,null,Ae.default.createElement("label",{htmlFor:"layer-selector",style:{marginRight:15}},s,":"),Ae.default.createElement(cs,{id:"layer-selector",largestNumber:c-1,currentValue:h,setCurrentValue:x,labels:l}))),Ae.default.createElement(hn.Row,{style:X},Ae.default.createElement(hn.Col,null,Ae.default.createElement("label",{htmlFor:"neuron-selector",style:{marginRight:15}},i,":"),Ae.default.createElement(Wg,{id:"neuron-selector",largestNumber:f-1,currentRangeArr:C,setCurrentValue:S,numValsInRange:g})))),Ae.default.createElement(hn.Col,null,Ae.default.createElement(hn.Row,{style:X},Ae.default.createElement(hn.Col,null,Ae.default.createElement("label",{htmlFor:"filter-select",style:{marginRight:15}},"Filter:"),Ae.default.createElement("select",{value:k,onChange:Z=>I(Z.target.value),id:"filter-select"},Ae.default.createElement("option",{value:void 0},"topk+bottomk"),Ae.default.createElement("option",{value:"topk"},"topk"),Ae.default.createElement("option",{value:"bottomk"},"bottomk")))),Ae.default.createElement(hn.Row,{style:X},Ae.default.createElement(hn.Col,null,Ae.default.createElement("label",{htmlFor:"visibleCols-selector",style:{marginRight:15}},i,"s to show:"),Ae.default.createElement(cs,{id:"visible-cols-selector",smallestNumber:1,largestNumber:f,currentValue:g,setCurrentValue:y}))),Ae.default.createElement(hn.Row,{style:X},Ae.default.createElement(hn.Col,null,Ae.default.createElement("label",{htmlFor:"k-selector",style:{marginRight:15}},"k:"),Ae.default.createElement(cs,{id:"k-selector",smallestNumber:1,largestNumber:p,currentValue:b,setCurrentValue:v})))))),Ae.default.createElement(_we,{topkActivations:O,bottomkActivations:H,topkTokens:B,bottomkTokens:K,neuronNumbers:C,filter:k,colLabel:i}))}export{R1e as AttentionHeads,QN as AttentionPattern,L1e as AttentionPatterns,tN as ColoredTokens,Iwe as ColoredTokensMulti,wwe as Hello,vwe as SaeVis,v0e as TextNeuronActivations,Swe as TokenLogProbs,Ewe as TopkSamples,Awe as TopkTokens,kwe as render};
//# sourceMappingURL=esm.js.map
