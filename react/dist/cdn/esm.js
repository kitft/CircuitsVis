var cQ=Object.create;var $v=Object.defineProperty;var pQ=Object.getOwnPropertyDescriptor;var fQ=Object.getOwnPropertyNames;var dQ=Object.getPrototypeOf,mQ=Object.prototype.hasOwnProperty;var hQ=(t,e,r)=>e in t?$v(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r;var Ye=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),Ho=(t,e)=>{for(var r in e)$v(t,r,{get:e[r],enumerable:!0})},gQ=(t,e,r,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of fQ(e))!mQ.call(t,o)&&o!==r&&$v(t,o,{get:()=>e[o],enumerable:!(n=pQ(e,o))||n.enumerable});return t};var rt=(t,e,r)=>(r=t!=null?cQ(dQ(t)):{},gQ(e||!t||!t.__esModule?$v(r,"default",{value:t,enumerable:!0}):r,t));var zt=(t,e,r)=>(hQ(t,typeof e!="symbol"?e+"":e,r),r);var KF=Ye((zwe,jF)=>{jF.exports=Zt;var fs=null;try{fs=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function Zt(t,e,r){this.low=t|0,this.high=e|0,this.unsigned=!!r}Zt.prototype.__isLong__;Object.defineProperty(Zt.prototype,"__isLong__",{value:!0});function ko(t){return(t&&t.__isLong__)===!0}Zt.isLong=ko;var MF={},zF={};function Bp(t,e){var r,n,o;return e?(t>>>=0,(o=0<=t&&t<256)&&(n=zF[t],n)?n:(r=Jt(t,(t|0)<0?-1:0,!0),o&&(zF[t]=r),r)):(t|=0,(o=-128<=t&&t<128)&&(n=MF[t],n)?n:(r=Jt(t,t<0?-1:0,!1),o&&(MF[t]=r),r))}Zt.fromInt=Bp;function ds(t,e){if(isNaN(t))return e?zp:ms;if(e){if(t<0)return zp;if(t>=GF)return qF}else{if(t<=-VF)return So;if(t+1>=VF)return HF}return t<0?ds(-t,e).neg():Jt(t%wm|0,t/wm|0,e)}Zt.fromNumber=ds;function Jt(t,e,r){return new Zt(t,e,r)}Zt.fromBits=Jt;var n1=Math.pow;function RI(t,e,r){if(t.length===0)throw Error("empty string");if(t==="NaN"||t==="Infinity"||t==="+Infinity"||t==="-Infinity")return ms;if(typeof e=="number"?(r=e,e=!1):e=!!e,r=r||10,r<2||36<r)throw RangeError("radix");var n;if((n=t.indexOf("-"))>0)throw Error("interior hyphen");if(n===0)return RI(t.substring(1),e,r).neg();for(var o=ds(n1(r,8)),s=ms,i=0;i<t.length;i+=8){var a=Math.min(8,t.length-i),l=parseInt(t.substring(i,i+a),r);if(a<8){var u=ds(n1(r,a));s=s.mul(u).add(ds(l))}else s=s.mul(o),s=s.add(ds(l))}return s.unsigned=e,s}Zt.fromString=RI;function ri(t,e){return typeof t=="number"?ds(t,e):typeof t=="string"?RI(t,e):Jt(t.low,t.high,typeof e=="boolean"?e:t.unsigned)}Zt.fromValue=ri;var BF=1<<16,zQ=1<<24,wm=BF*BF,GF=wm*wm,VF=GF/2,WF=Bp(zQ),ms=Bp(0);Zt.ZERO=ms;var zp=Bp(0,!0);Zt.UZERO=zp;var vm=Bp(1);Zt.ONE=vm;var UF=Bp(1,!0);Zt.UONE=UF;var $I=Bp(-1);Zt.NEG_ONE=$I;var HF=Jt(-1,2147483647,!1);Zt.MAX_VALUE=HF;var qF=Jt(-1,-1,!0);Zt.MAX_UNSIGNED_VALUE=qF;var So=Jt(0,-2147483648,!1);Zt.MIN_VALUE=So;var be=Zt.prototype;be.toInt=function(){return this.unsigned?this.low>>>0:this.low};be.toNumber=function(){return this.unsigned?(this.high>>>0)*wm+(this.low>>>0):this.high*wm+(this.low>>>0)};be.toString=function(e){if(e=e||10,e<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(So)){var r=ds(e),n=this.div(r),o=n.mul(r).sub(this);return n.toString(e)+o.toInt().toString(e)}else return"-"+this.neg().toString(e);for(var s=ds(n1(e,6),this.unsigned),i=this,a="";;){var l=i.div(s),u=i.sub(l.mul(s)).toInt()>>>0,c=u.toString(e);if(i=l,i.isZero())return c+a;for(;c.length<6;)c="0"+c;a=""+c+a}};be.getHighBits=function(){return this.high};be.getHighBitsUnsigned=function(){return this.high>>>0};be.getLowBits=function(){return this.low};be.getLowBitsUnsigned=function(){return this.low>>>0};be.getNumBitsAbs=function(){if(this.isNegative())return this.eq(So)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,r=31;r>0&&(e&1<<r)==0;r--);return this.high!=0?r+33:r+1};be.isZero=function(){return this.high===0&&this.low===0};be.eqz=be.isZero;be.isNegative=function(){return!this.unsigned&&this.high<0};be.isPositive=function(){return this.unsigned||this.high>=0};be.isOdd=function(){return(this.low&1)===1};be.isEven=function(){return(this.low&1)===0};be.equals=function(e){return ko(e)||(e=ri(e)),this.unsigned!==e.unsigned&&this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low};be.eq=be.equals;be.notEquals=function(e){return!this.eq(e)};be.neq=be.notEquals;be.ne=be.notEquals;be.lessThan=function(e){return this.comp(e)<0};be.lt=be.lessThan;be.lessThanOrEqual=function(e){return this.comp(e)<=0};be.lte=be.lessThanOrEqual;be.le=be.lessThanOrEqual;be.greaterThan=function(e){return this.comp(e)>0};be.gt=be.greaterThan;be.greaterThanOrEqual=function(e){return this.comp(e)>=0};be.gte=be.greaterThanOrEqual;be.ge=be.greaterThanOrEqual;be.compare=function(e){if(ko(e)||(e=ri(e)),this.eq(e))return 0;var r=this.isNegative(),n=e.isNegative();return r&&!n?-1:!r&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1};be.comp=be.compare;be.negate=function(){return!this.unsigned&&this.eq(So)?So:this.not().add(vm)};be.neg=be.negate;be.add=function(e){ko(e)||(e=ri(e));var r=this.high>>>16,n=this.high&65535,o=this.low>>>16,s=this.low&65535,i=e.high>>>16,a=e.high&65535,l=e.low>>>16,u=e.low&65535,c=0,p=0,f=0,d=0;return d+=s+u,f+=d>>>16,d&=65535,f+=o+l,p+=f>>>16,f&=65535,p+=n+a,c+=p>>>16,p&=65535,c+=r+i,c&=65535,Jt(f<<16|d,c<<16|p,this.unsigned)};be.subtract=function(e){return ko(e)||(e=ri(e)),this.add(e.neg())};be.sub=be.subtract;be.multiply=function(e){if(this.isZero())return ms;if(ko(e)||(e=ri(e)),fs){var r=fs.mul(this.low,this.high,e.low,e.high);return Jt(r,fs.get_high(),this.unsigned)}if(e.isZero())return ms;if(this.eq(So))return e.isOdd()?So:ms;if(e.eq(So))return this.isOdd()?So:ms;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(WF)&&e.lt(WF))return ds(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,o=this.high&65535,s=this.low>>>16,i=this.low&65535,a=e.high>>>16,l=e.high&65535,u=e.low>>>16,c=e.low&65535,p=0,f=0,d=0,m=0;return m+=i*c,d+=m>>>16,m&=65535,d+=s*c,f+=d>>>16,d&=65535,d+=i*u,f+=d>>>16,d&=65535,f+=o*c,p+=f>>>16,f&=65535,f+=s*u,p+=f>>>16,f&=65535,f+=i*l,p+=f>>>16,f&=65535,p+=n*c+o*u+s*l+i*a,p&=65535,Jt(d<<16|m,p<<16|f,this.unsigned)};be.mul=be.multiply;be.divide=function(e){if(ko(e)||(e=ri(e)),e.isZero())throw Error("division by zero");if(fs){if(!this.unsigned&&this.high===-2147483648&&e.low===-1&&e.high===-1)return this;var r=(this.unsigned?fs.div_u:fs.div_s)(this.low,this.high,e.low,e.high);return Jt(r,fs.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?zp:ms;var n,o,s;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return zp;if(e.gt(this.shru(1)))return UF;s=zp}else{if(this.eq(So)){if(e.eq(vm)||e.eq($I))return So;if(e.eq(So))return vm;var i=this.shr(1);return n=i.div(e).shl(1),n.eq(ms)?e.isNegative()?vm:$I:(o=this.sub(e.mul(n)),s=n.add(o.div(e)),s)}else if(e.eq(So))return this.unsigned?zp:ms;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();s=ms}for(o=this;o.gte(e);){n=Math.max(1,Math.floor(o.toNumber()/e.toNumber()));for(var a=Math.ceil(Math.log(n)/Math.LN2),l=a<=48?1:n1(2,a-48),u=ds(n),c=u.mul(e);c.isNegative()||c.gt(o);)n-=l,u=ds(n,this.unsigned),c=u.mul(e);u.isZero()&&(u=vm),s=s.add(u),o=o.sub(c)}return s};be.div=be.divide;be.modulo=function(e){if(ko(e)||(e=ri(e)),fs){var r=(this.unsigned?fs.rem_u:fs.rem_s)(this.low,this.high,e.low,e.high);return Jt(r,fs.get_high(),this.unsigned)}return this.sub(this.div(e).mul(e))};be.mod=be.modulo;be.rem=be.modulo;be.not=function(){return Jt(~this.low,~this.high,this.unsigned)};be.and=function(e){return ko(e)||(e=ri(e)),Jt(this.low&e.low,this.high&e.high,this.unsigned)};be.or=function(e){return ko(e)||(e=ri(e)),Jt(this.low|e.low,this.high|e.high,this.unsigned)};be.xor=function(e){return ko(e)||(e=ri(e)),Jt(this.low^e.low,this.high^e.high,this.unsigned)};be.shiftLeft=function(e){return ko(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Jt(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):Jt(0,this.low<<e-32,this.unsigned)};be.shl=be.shiftLeft;be.shiftRight=function(e){return ko(e)&&(e=e.toInt()),(e&=63)===0?this:e<32?Jt(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):Jt(this.high>>e-32,this.high>=0?0:-1,this.unsigned)};be.shr=be.shiftRight;be.shiftRightUnsigned=function(e){if(ko(e)&&(e=e.toInt()),e&=63,e===0)return this;var r=this.high;if(e<32){var n=this.low;return Jt(n>>>e|r<<32-e,r>>>e,this.unsigned)}else return e===32?Jt(r,0,this.unsigned):Jt(r>>>e-32,0,this.unsigned)};be.shru=be.shiftRightUnsigned;be.shr_u=be.shiftRightUnsigned;be.toSigned=function(){return this.unsigned?Jt(this.low,this.high,!1):this};be.toUnsigned=function(){return this.unsigned?this:Jt(this.low,this.high,!0)};be.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()};be.toBytesLE=function(){var e=this.high,r=this.low;return[r&255,r>>>8&255,r>>>16&255,r>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]};be.toBytesBE=function(){var e=this.high,r=this.low;return[e>>>24,e>>>16&255,e>>>8&255,e&255,r>>>24,r>>>16&255,r>>>8&255,r&255]};Zt.fromBytes=function(e,r,n){return n?Zt.fromBytesLE(e,r):Zt.fromBytesBE(e,r)};Zt.fromBytesLE=function(e,r){return new Zt(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,r)};Zt.fromBytesBE=function(e,r){return new Zt(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],r)}});var EP=Ye(()=>{});var _P=Ye(()=>{});var vL=Ye((bL,W2)=>{(function(t,e,r){function n(a){var l=this,u=i();l.next=function(){var c=2091639*l.s0+l.c*23283064365386963e-26;return l.s0=l.s1,l.s1=l.s2,l.s2=c-(l.c=c|0)},l.c=1,l.s0=u(" "),l.s1=u(" "),l.s2=u(" "),l.s0-=u(a),l.s0<0&&(l.s0+=1),l.s1-=u(a),l.s1<0&&(l.s1+=1),l.s2-=u(a),l.s2<0&&(l.s2+=1),u=null}function o(a,l){return l.c=a.c,l.s0=a.s0,l.s1=a.s1,l.s2=a.s2,l}function s(a,l){var u=new n(a),c=l&&l.state,p=u.next;return p.int32=function(){return u.next()*4294967296|0},p.double=function(){return p()+(p()*2097152|0)*11102230246251565e-32},p.quick=p,c&&(typeof c=="object"&&o(c,u),p.state=function(){return o(u,{})}),p}function i(){var a=4022871197,l=function(u){u=String(u);for(var c=0;c<u.length;c++){a+=u.charCodeAt(c);var p=.02519603282416938*a;a=p>>>0,p-=a,p*=a,a=p>>>0,p-=a,a+=p*4294967296}return(a>>>0)*23283064365386963e-26};return l}e&&e.exports?e.exports=s:r&&r.amd?r(function(){return s}):this.alea=s})(bL,typeof W2=="object"&&W2,typeof define=="function"&&define)});var CL=Ye((wL,G2)=>{(function(t,e,r){function n(i){var a=this,l="";a.x=0,a.y=0,a.z=0,a.w=0,a.next=function(){var c=a.x^a.x<<11;return a.x=a.y,a.y=a.z,a.z=a.w,a.w^=a.w>>>19^c^c>>>8},i===(i|0)?a.x=i:l+=i;for(var u=0;u<l.length+64;u++)a.x^=l.charCodeAt(u)|0,a.next()}function o(i,a){return a.x=i.x,a.y=i.y,a.z=i.z,a.w=i.w,a}function s(i,a){var l=new n(i),u=a&&a.state,c=function(){return(l.next()>>>0)/4294967296};return c.double=function(){do var p=l.next()>>>11,f=(l.next()>>>0)/4294967296,d=(p+f)/(1<<21);while(d===0);return d},c.int32=l.next,c.quick=c,u&&(typeof u=="object"&&o(u,l),c.state=function(){return o(l,{})}),c}e&&e.exports?e.exports=s:r&&r.amd?r(function(){return s}):this.xor128=s})(wL,typeof G2=="object"&&G2,typeof define=="function"&&define)});var kL=Ye((SL,U2)=>{(function(t,e,r){function n(i){var a=this,l="";a.next=function(){var c=a.x^a.x>>>2;return a.x=a.y,a.y=a.z,a.z=a.w,a.w=a.v,(a.d=a.d+362437|0)+(a.v=a.v^a.v<<4^(c^c<<1))|0},a.x=0,a.y=0,a.z=0,a.w=0,a.v=0,i===(i|0)?a.x=i:l+=i;for(var u=0;u<l.length+64;u++)a.x^=l.charCodeAt(u)|0,u==l.length&&(a.d=a.x<<10^a.x>>>4),a.next()}function o(i,a){return a.x=i.x,a.y=i.y,a.z=i.z,a.w=i.w,a.v=i.v,a.d=i.d,a}function s(i,a){var l=new n(i),u=a&&a.state,c=function(){return(l.next()>>>0)/4294967296};return c.double=function(){do var p=l.next()>>>11,f=(l.next()>>>0)/4294967296,d=(p+f)/(1<<21);while(d===0);return d},c.int32=l.next,c.quick=c,u&&(typeof u=="object"&&o(u,l),c.state=function(){return o(l,{})}),c}e&&e.exports?e.exports=s:r&&r.amd?r(function(){return s}):this.xorwow=s})(SL,typeof U2=="object"&&U2,typeof define=="function"&&define)});var NL=Ye((TL,H2)=>{(function(t,e,r){function n(i){var a=this;a.next=function(){var u=a.x,c=a.i,p,f,d;return p=u[c],p^=p>>>7,f=p^p<<24,p=u[c+1&7],f^=p^p>>>10,p=u[c+3&7],f^=p^p>>>3,p=u[c+4&7],f^=p^p<<7,p=u[c+7&7],p=p^p<<13,f^=p^p<<9,u[c]=f,a.i=c+1&7,f};function l(u,c){var p,f,d=[];if(c===(c|0))f=d[0]=c;else for(c=""+c,p=0;p<c.length;++p)d[p&7]=d[p&7]<<15^c.charCodeAt(p)+d[p+1&7]<<13;for(;d.length<8;)d.push(0);for(p=0;p<8&&d[p]===0;++p);for(p==8?f=d[7]=-1:f=d[p],u.x=d,u.i=0,p=256;p>0;--p)u.next()}l(a,i)}function o(i,a){return a.x=i.x.slice(),a.i=i.i,a}function s(i,a){i==null&&(i=+new Date);var l=new n(i),u=a&&a.state,c=function(){return(l.next()>>>0)/4294967296};return c.double=function(){do var p=l.next()>>>11,f=(l.next()>>>0)/4294967296,d=(p+f)/(1<<21);while(d===0);return d},c.int32=l.next,c.quick=c,u&&(u.x&&o(u,l),c.state=function(){return o(l,{})}),c}e&&e.exports?e.exports=s:r&&r.amd?r(function(){return s}):this.xorshift7=s})(TL,typeof H2=="object"&&H2,typeof define=="function"&&define)});var EL=Ye((IL,q2)=>{(function(t,e,r){function n(i){var a=this;a.next=function(){var u=a.w,c=a.X,p=a.i,f,d;return a.w=u=u+1640531527|0,d=c[p+34&127],f=c[p=p+1&127],d^=d<<13,f^=f<<17,d^=d>>>15,f^=f>>>12,d=c[p]=d^f,a.i=p,d+(u^u>>>16)|0};function l(u,c){var p,f,d,m,h,g=[],x=128;for(c===(c|0)?(f=c,c=null):(c=c+"\0",f=0,x=Math.max(x,c.length)),d=0,m=-32;m<x;++m)c&&(f^=c.charCodeAt((m+32)%c.length)),m===0&&(h=f),f^=f<<10,f^=f>>>15,f^=f<<4,f^=f>>>13,m>=0&&(h=h+1640531527|0,p=g[m&127]^=f+h,d=p==0?d+1:0);for(d>=128&&(g[(c&&c.length||0)&127]=-1),d=127,m=4*128;m>0;--m)f=g[d+34&127],p=g[d=d+1&127],f^=f<<13,p^=p<<17,f^=f>>>15,p^=p>>>12,g[d]=f^p;u.w=h,u.X=g,u.i=d}l(a,i)}function o(i,a){return a.i=i.i,a.w=i.w,a.X=i.X.slice(),a}function s(i,a){i==null&&(i=+new Date);var l=new n(i),u=a&&a.state,c=function(){return(l.next()>>>0)/4294967296};return c.double=function(){do var p=l.next()>>>11,f=(l.next()>>>0)/4294967296,d=(p+f)/(1<<21);while(d===0);return d},c.int32=l.next,c.quick=c,u&&(u.X&&o(u,l),c.state=function(){return o(l,{})}),c}e&&e.exports?e.exports=s:r&&r.amd?r(function(){return s}):this.xor4096=s})(IL,typeof q2=="object"&&q2,typeof define=="function"&&define)});var AL=Ye((_L,j2)=>{(function(t,e,r){function n(i){var a=this,l="";a.next=function(){var c=a.b,p=a.c,f=a.d,d=a.a;return c=c<<25^c>>>7^p,p=p-f|0,f=f<<24^f>>>8^d,d=d-c|0,a.b=c=c<<20^c>>>12^p,a.c=p=p-f|0,a.d=f<<16^p>>>16^d,a.a=d-c|0},a.a=0,a.b=0,a.c=-1640531527,a.d=1367130551,i===Math.floor(i)?(a.a=i/4294967296|0,a.b=i|0):l+=i;for(var u=0;u<l.length+20;u++)a.b^=l.charCodeAt(u)|0,a.next()}function o(i,a){return a.a=i.a,a.b=i.b,a.c=i.c,a.d=i.d,a}function s(i,a){var l=new n(i),u=a&&a.state,c=function(){return(l.next()>>>0)/4294967296};return c.double=function(){do var p=l.next()>>>11,f=(l.next()>>>0)/4294967296,d=(p+f)/(1<<21);while(d===0);return d},c.int32=l.next,c.quick=c,u&&(typeof u=="object"&&o(u,l),c.state=function(){return o(l,{})}),c}e&&e.exports?e.exports=s:r&&r.amd?r(function(){return s}):this.tychei=s})(_L,typeof j2=="object"&&j2,typeof define=="function"&&define)});var DL=Ye(()=>{});var RL=Ye(($L,I1)=>{(function(t,e,r){var n=256,o=6,s=52,i="random",a=r.pow(n,o),l=r.pow(2,s),u=l*2,c=n-1,p;function f(b,v,C){var S=[];v=v==!0?{entropy:!0}:v||{};var k=g(h(v.entropy?[b,y(e)]:b??x(),3),S),N=new d(S),D=function(){for(var $=N.g(o),O=a,V=0;$<l;)$=($+V)*n,O*=n,V=N.g(1);for(;$>=u;)$/=2,O/=2,V>>>=1;return($+V)/O};return D.int32=function(){return N.g(4)|0},D.quick=function(){return N.g(4)/4294967296},D.double=D,g(y(N.S),e),(v.pass||C||function($,O,V,K){return K&&(K.S&&m(K,N),$.state=function(){return m(N,{})}),V?(r[i]=$,O):$})(D,k,"global"in v?v.global:this==r,v.state)}function d(b){var v,C=b.length,S=this,k=0,N=S.i=S.j=0,D=S.S=[];for(C||(b=[C++]);k<n;)D[k]=k++;for(k=0;k<n;k++)D[k]=D[N=c&N+b[k%C]+(v=D[k])],D[N]=v;(S.g=function($){for(var O,V=0,K=S.i,X=S.j,W=S.S;$--;)O=W[K=c&K+1],V=V*n+W[c&(W[K]=W[X=c&X+O])+(W[X]=O)];return S.i=K,S.j=X,V})(n)}function m(b,v){return v.i=b.i,v.j=b.j,v.S=b.S.slice(),v}function h(b,v){var C=[],S=typeof b,k;if(v&&S=="object")for(k in b)try{C.push(h(b[k],v-1))}catch{}return C.length?C:S=="string"?b:b+"\0"}function g(b,v){for(var C=b+"",S,k=0;k<C.length;)v[c&k]=c&(S^=v[c&k]*19)+C.charCodeAt(k++);return y(v)}function x(){try{var b;return p&&(b=p.randomBytes)?b=b(n):(b=new Uint8Array(n),(t.crypto||t.msCrypto).getRandomValues(b)),y(b)}catch{var v=t.navigator,C=v&&v.plugins;return[+new Date,t,C,t.screen,y(e)]}}function y(b){return String.fromCharCode.apply(0,b)}if(g(r.random(),e),typeof I1=="object"&&I1.exports){I1.exports=f;try{p=DL()}catch{}}else typeof define=="function"&&define.amd?define(function(){return f}):r["seed"+i]=f})(typeof self<"u"?self:$L,[],Math)});var zx=Ye((mPe,OL)=>{var xte=vL(),yte=CL(),bte=kL(),vte=NL(),wte=EL(),Cte=AL(),of=RL();of.alea=xte;of.xor128=yte;of.xorwow=bte;of.xorshift7=vte;of.xor4096=wte;of.tychei=Cte;OL.exports=of});var sB=Ye(()=>{});var hH=Ye(ct=>{"use strict";var j0=Symbol.for("react.element"),Gme=Symbol.for("react.portal"),Ume=Symbol.for("react.fragment"),Hme=Symbol.for("react.strict_mode"),qme=Symbol.for("react.profiler"),jme=Symbol.for("react.provider"),Kme=Symbol.for("react.context"),Xme=Symbol.for("react.forward_ref"),Yme=Symbol.for("react.suspense"),Qme=Symbol.for("react.memo"),Zme=Symbol.for("react.lazy"),sH=Symbol.iterator;function Jme(t){return t===null||typeof t!="object"?null:(t=sH&&t[sH]||t["@@iterator"],typeof t=="function"?t:null)}var lH={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},uH=Object.assign,cH={};function Xh(t,e,r){this.props=t,this.context=e,this.refs=cH,this.updater=r||lH}Xh.prototype.isReactComponent={};Xh.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};Xh.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function pH(){}pH.prototype=Xh.prototype;function gA(t,e,r){this.props=t,this.context=e,this.refs=cH,this.updater=r||lH}var xA=gA.prototype=new pH;xA.constructor=gA;uH(xA,Xh.prototype);xA.isPureReactComponent=!0;var iH=Array.isArray,fH=Object.prototype.hasOwnProperty,yA={current:null},dH={key:!0,ref:!0,__self:!0,__source:!0};function mH(t,e,r){var n,o={},s=null,i=null;if(e!=null)for(n in e.ref!==void 0&&(i=e.ref),e.key!==void 0&&(s=""+e.key),e)fH.call(e,n)&&!dH.hasOwnProperty(n)&&(o[n]=e[n]);var a=arguments.length-2;if(a===1)o.children=r;else if(1<a){for(var l=Array(a),u=0;u<a;u++)l[u]=arguments[u+2];o.children=l}if(t&&t.defaultProps)for(n in a=t.defaultProps,a)o[n]===void 0&&(o[n]=a[n]);return{$$typeof:j0,type:t,key:s,ref:i,props:o,_owner:yA.current}}function ehe(t,e){return{$$typeof:j0,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function bA(t){return typeof t=="object"&&t!==null&&t.$$typeof===j0}function the(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(r){return e[r]})}var aH=/\/+/g;function hA(t,e){return typeof t=="object"&&t!==null&&t.key!=null?the(""+t.key):e.toString(36)}function nk(t,e,r,n,o){var s=typeof t;(s==="undefined"||s==="boolean")&&(t=null);var i=!1;if(t===null)i=!0;else switch(s){case"string":case"number":i=!0;break;case"object":switch(t.$$typeof){case j0:case Gme:i=!0}}if(i)return i=t,o=o(i),t=n===""?"."+hA(i,0):n,iH(o)?(r="",t!=null&&(r=t.replace(aH,"$&/")+"/"),nk(o,e,r,"",function(u){return u})):o!=null&&(bA(o)&&(o=ehe(o,r+(!o.key||i&&i.key===o.key?"":(""+o.key).replace(aH,"$&/")+"/")+t)),e.push(o)),1;if(i=0,n=n===""?".":n+":",iH(t))for(var a=0;a<t.length;a++){s=t[a];var l=n+hA(s,a);i+=nk(s,e,r,l,o)}else if(l=Jme(t),typeof l=="function")for(t=l.call(t),a=0;!(s=t.next()).done;)s=s.value,l=n+hA(s,a++),i+=nk(s,e,r,l,o);else if(s==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return i}function rk(t,e,r){if(t==null)return t;var n=[],o=0;return nk(t,n,"","",function(s){return e.call(r,s,o++)}),n}function rhe(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(r){(t._status===0||t._status===-1)&&(t._status=1,t._result=r)},function(r){(t._status===0||t._status===-1)&&(t._status=2,t._result=r)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var fo={current:null},ok={transition:null},nhe={ReactCurrentDispatcher:fo,ReactCurrentBatchConfig:ok,ReactCurrentOwner:yA};ct.Children={map:rk,forEach:function(t,e,r){rk(t,function(){e.apply(this,arguments)},r)},count:function(t){var e=0;return rk(t,function(){e++}),e},toArray:function(t){return rk(t,function(e){return e})||[]},only:function(t){if(!bA(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};ct.Component=Xh;ct.Fragment=Ume;ct.Profiler=qme;ct.PureComponent=gA;ct.StrictMode=Hme;ct.Suspense=Yme;ct.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=nhe;ct.cloneElement=function(t,e,r){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var n=uH({},t.props),o=t.key,s=t.ref,i=t._owner;if(e!=null){if(e.ref!==void 0&&(s=e.ref,i=yA.current),e.key!==void 0&&(o=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(l in e)fH.call(e,l)&&!dH.hasOwnProperty(l)&&(n[l]=e[l]===void 0&&a!==void 0?a[l]:e[l])}var l=arguments.length-2;if(l===1)n.children=r;else if(1<l){a=Array(l);for(var u=0;u<l;u++)a[u]=arguments[u+2];n.children=a}return{$$typeof:j0,type:t.type,key:o,ref:s,props:n,_owner:i}};ct.createContext=function(t){return t={$$typeof:Kme,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:jme,_context:t},t.Consumer=t};ct.createElement=mH;ct.createFactory=function(t){var e=mH.bind(null,t);return e.type=t,e};ct.createRef=function(){return{current:null}};ct.forwardRef=function(t){return{$$typeof:Xme,render:t}};ct.isValidElement=bA;ct.lazy=function(t){return{$$typeof:Zme,_payload:{_status:-1,_result:t},_init:rhe}};ct.memo=function(t,e){return{$$typeof:Qme,type:t,compare:e===void 0?null:e}};ct.startTransition=function(t){var e=ok.transition;ok.transition={};try{t()}finally{ok.transition=e}};ct.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};ct.useCallback=function(t,e){return fo.current.useCallback(t,e)};ct.useContext=function(t){return fo.current.useContext(t)};ct.useDebugValue=function(){};ct.useDeferredValue=function(t){return fo.current.useDeferredValue(t)};ct.useEffect=function(t,e){return fo.current.useEffect(t,e)};ct.useId=function(){return fo.current.useId()};ct.useImperativeHandle=function(t,e,r){return fo.current.useImperativeHandle(t,e,r)};ct.useInsertionEffect=function(t,e){return fo.current.useInsertionEffect(t,e)};ct.useLayoutEffect=function(t,e){return fo.current.useLayoutEffect(t,e)};ct.useMemo=function(t,e){return fo.current.useMemo(t,e)};ct.useReducer=function(t,e,r){return fo.current.useReducer(t,e,r)};ct.useRef=function(t){return fo.current.useRef(t)};ct.useState=function(t){return fo.current.useState(t)};ct.useSyncExternalStore=function(t,e,r){return fo.current.useSyncExternalStore(t,e,r)};ct.useTransition=function(){return fo.current.useTransition()};ct.version="18.2.0"});var pt=Ye((uqt,gH)=>{"use strict";gH.exports=hH()});var yH=Ye((cqt,xH)=>{"use strict";var ohe="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";xH.exports=ohe});var CH=Ye((pqt,wH)=>{"use strict";var she=yH();function bH(){}function vH(){}vH.resetWarningCache=bH;wH.exports=function(){function t(n,o,s,i,a,l){if(l!==she){var u=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw u.name="Invariant Violation",u}}t.isRequired=t;function e(){return t}var r={array:t,bigint:t,bool:t,func:t,number:t,object:t,string:t,symbol:t,any:t,arrayOf:e,element:t,elementType:t,instanceOf:e,node:t,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:vH,resetWarningCache:bH};return r.PropTypes=r,r}});var zl=Ye((mqt,SH)=>{SH.exports=CH()();var fqt,dqt});var zf=Ye(Yh=>{"use strict";Object.defineProperty(Yh,"__esModule",{value:!0});Yh.setConfiguration=Yh.getConfiguration=void 0;var vA={breakpoints:[576,768,992,1200,1600,1920],containerWidths:[540,750,960,1140,1540,1810],gutterWidth:30,gridColumns:12,defaultScreenClass:"xxl",maxScreenClass:"xxl"},ihe=()=>vA;Yh.getConfiguration=ihe;var ahe=t=>{vA={...vA,...t}};Yh.setConfiguration=ahe});var kH=Ye(sk=>{"use strict";Object.defineProperty(sk,"__esModule",{value:!0});sk.default=void 0;var lhe="div";sk.default=lhe});var TH=Ye(ik=>{"use strict";Object.defineProperty(ik,"__esModule",{value:!0});ik.default=void 0;var uhe="span";ik.default=uhe});var NH=Ye(ak=>{"use strict";Object.defineProperty(ak,"__esModule",{value:!0});ak.default=void 0;var che=typeof window<"u"?window:void 0;ak.default=che});var Qh=Ye(K0=>{"use strict";Object.defineProperty(K0,"__esModule",{value:!0});Object.defineProperty(K0,"Div",{enumerable:!0,get:function(){return phe.default}});Object.defineProperty(K0,"Span",{enumerable:!0,get:function(){return fhe.default}});Object.defineProperty(K0,"Window",{enumerable:!0,get:function(){return dhe.default}});var phe=wA(kH()),fhe=wA(TH()),dhe=wA(NH());function wA(t){return t&&t.__esModule?t:{default:t}}});var uk=Ye(Zh=>{"use strict";Object.defineProperty(Zh,"__esModule",{value:!0});Zh.useScreenClass=Zh.screenClasses=void 0;var IH=pt(),mhe=zf(),X0=Qh(),hhe=t=>t&&t.current&&t.current.clientWidth?t.current.clientWidth:typeof X0.Window<"u"&&X0.Window.innerWidth?X0.Window.innerWidth:null,lk=["xs","sm","md","lg","xl","xxl","xxxl"];Zh.screenClasses=lk;var ghe=(t,e)=>{let r=()=>{let{breakpoints:s,defaultScreenClass:i,maxScreenClass:a}=(0,mhe.getConfiguration)(),l=i,u=hhe(t);u?(l="xs",s[0]&&u>=s[0]&&(l="sm"),s[1]&&u>=s[1]&&(l="md"),s[2]&&u>=s[2]&&(l="lg"),s[3]&&u>=s[3]&&(l="xl"),s[4]&&u>=s[4]&&(l="xxl"),s[5]&&u>=s[5]&&(l="xxxl")):e&&(l=e);let c=lk.indexOf(l),p=lk.indexOf(a);return p>=0&&c>p&&(l=lk[p]),l},[n,o]=(0,IH.useState)(()=>r());return(0,IH.useEffect)(()=>{let s=()=>o(r());return X0.Window.addEventListener("resize",s,!1),()=>{X0.Window.removeEventListener("resize",s,!1)}},[]),n};Zh.useScreenClass=ghe});var _H=Ye(pk=>{"use strict";Object.defineProperty(pk,"__esModule",{value:!0});pk.default=void 0;var EH=uk(),xhe=t=>Object.keys(t).reduce((e,r)=>e||t[r],!1),ck=(t,e)=>{if(typeof t!="number")return;let r=Math.max(0,Math.min(e,t));return"".concat(100/e*r,"%")},yhe=t=>{let{forceWidth:e=null,width:r={},offset:n={},pull:o={},push:s={},order:i={},debug:a,screenClass:l,gutterWidth:u,moreStyle:c,gridColumns:p}=t,f={boxSizing:"border-box",minHeight:1,position:"relative",paddingLeft:u/2,paddingRight:u/2,width:"100%"};return a&&(f.outline="1px solid silver",f.background="rgba(0,0,0,.05)",f.lineHeight="32px"),f.flexBasis="100%",f.flexGrow=0,f.flexShrink=0,f.maxWidth="100%",f.marginLeft="0%",f.right="auto",f.left="auto",EH.screenClasses.forEach((d,m)=>{if(EH.screenClasses.indexOf(l)>=m){let h=ck(r[d],p),g=r[d]==="content";f.flexBasis=g?"auto":h||f.flexBasis,f.width=f.flexBasis,f.maxWidth=h||f.maxWidth,f.marginLeft=ck(n[d],p)||f.marginLeft,f.right=ck(o[d],p)||f.right,f.left=ck(s[d],p)||f.left,i[d]&&(f.order=i[d])}}),xhe(r)||(f.flexBasis=0,f.flexGrow=1),e&&(f.flexBasis="unset",f.flexGrow="unset",f.flexShrink="unset",f.width=e),{...f,...c}};pk.default=yhe});var AH=Ye(fk=>{"use strict";Object.defineProperty(fk,"__esModule",{value:!0});fk.default=void 0;var bhe=t=>{let{gutterWidth:e,align:r,justify:n,debug:o,moreStyle:s,direction:i,wrap:a}=t,l=r;r==="start"&&(l="flex-start"),r==="end"&&(l="flex-end");let u=n;n==="start"&&(u="flex-start"),n==="end"&&(u="flex-end"),n==="between"&&(u="space-between"),n==="around"&&(u="space-around"),n==="center"&&(u="center"),n==="initial"&&(u="initial"),n==="inherit"&&(u="inherit");let c=["column","row","column-reverse","row-reverse"].includes(i)?i:void 0,p=a;a==="nowrap"&&(p="nowrap"),a==="wrap"&&(p="wrap"),a==="reverse"&&(p="wrap-reverse");let f={marginLeft:-e/2,marginRight:-e/2,display:"flex",flexGrow:0,flexShrink:0,alignItems:l,justifyContent:u,flexDirection:c,flexWrap:p};return o&&(f.background="rgba(128,128,128,.05)"),{...f,...s}};fk.default=bhe});var kA=Ye(Jh=>{"use strict";Object.defineProperty(Jh,"__esModule",{value:!0});Jh.default=Jh.GutterWidthContext=void 0;var dk=CA(pt()),rs=CA(zl()),vhe=zf(),whe=CA(AH()),Che=Qh();function CA(t){return t&&t.__esModule?t:{default:t}}var DH=dk.default.createContext(!1);Jh.GutterWidthContext=DH;var SA=dk.default.forwardRef((t,e)=>{let{children:r,style:n,align:o,justify:s,wrap:i,debug:a,nogutter:l,gutterWidth:u,component:c,direction:p,...f}=t,d=(0,vhe.getConfiguration)().gutterWidth;l&&(d=0),typeof u=="number"&&(d=u);let m=(0,whe.default)({gutterWidth:d,align:o,justify:s,debug:a,moreStyle:n,direction:p,wrap:i});return dk.default.createElement(c,{ref:e,style:m,...f},dk.default.createElement(DH.Provider,{value:d},r))});SA.propTypes={children:rs.default.node.isRequired,align:rs.default.oneOf(["normal","start","center","end","stretch"]),justify:rs.default.oneOf(["start","center","end","between","around","initial","inherit"]),direction:rs.default.oneOf(["column","row","column-reverse","row-reverse"]),wrap:rs.default.oneOf(["nowrap","wrap","reverse"]),nogutter:rs.default.bool,gutterWidth:rs.default.number,style:rs.default.objectOf(rs.default.oneOfType([rs.default.number,rs.default.string])),debug:rs.default.bool,component:rs.default.elementType};SA.defaultProps={align:"normal",justify:"start",direction:"row",wrap:"wrap",nogutter:!1,gutterWidth:null,style:{},debug:!1,component:Che.Div};var She=SA;Jh.default=She});var IA=Ye(Pc=>{"use strict";Object.defineProperty(Pc,"__esModule",{value:!0});Pc.default=Pc.ScreenClassContext=Pc.NO_PROVIDER_FLAG=void 0;var Fc=Ehe(pt()),TA=Ihe(zl()),khe=uk(),The=zf(),Nhe=Qh();function Ihe(t){return t&&t.__esModule?t:{default:t}}function $H(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return($H=function(n){return n?r:e})(t)}function Ehe(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||typeof t!="object"&&typeof t!="function")return{default:t};var r=$H(e);if(r&&r.has(t))return r.get(t);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if(s!=="default"&&Object.prototype.hasOwnProperty.call(t,s)){var i=o?Object.getOwnPropertyDescriptor(t,s):null;i&&(i.get||i.set)?Object.defineProperty(n,s,i):n[s]=t[s]}return n.default=t,r&&r.set(t,n),n}var RH="NO_PROVIDER_FLAG";Pc.NO_PROVIDER_FLAG=RH;var OH=Fc.default.createContext(RH);Pc.ScreenClassContext=OH;var NA=t=>{let{useOwnWidth:e,children:r,fallbackScreenClass:n}=t,o=(0,Fc.useRef)(),[s,i]=(0,Fc.useState)(!1),a=(0,khe.useScreenClass)(o,n),{defaultScreenClass:l}=(0,The.getConfiguration)(),u=s?a:n||l;return(0,Fc.useEffect)(()=>i(!0),[]),Fc.default.createElement(OH.Provider,{value:u},e?Fc.default.createElement(Nhe.Div,{ref:e?o:null},r):Fc.default.createElement(Fc.default.Fragment,null,r))};NA.propTypes={children:TA.default.node.isRequired,useOwnWidth:TA.default.bool,fallbackScreenClass:TA.default.oneOf([null,"xs","sm","md","lg","xl","xxl","xxxl"])};NA.defaultProps={useOwnWidth:!1,fallbackScreenClass:null};var _he=NA;Pc.default=_he});var eg=Ye(hk=>{"use strict";Object.defineProperty(hk,"__esModule",{value:!0});hk.default=void 0;var EA=PH(pt()),Ahe=PH(zl()),mk=Dhe(IA());function FH(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(FH=function(n){return n?r:e})(t)}function Dhe(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||typeof t!="object"&&typeof t!="function")return{default:t};var r=FH(e);if(r&&r.has(t))return r.get(t);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if(s!=="default"&&Object.prototype.hasOwnProperty.call(t,s)){var i=o?Object.getOwnPropertyDescriptor(t,s):null;i&&(i.get||i.set)?Object.defineProperty(n,s,i):n[s]=t[s]}return n.default=t,r&&r.set(t,n),n}function PH(t){return t&&t.__esModule?t:{default:t}}var LH=t=>{let{children:e}=t;return EA.default.createElement(mk.ScreenClassContext.Consumer,null,r=>r===mk.NO_PROVIDER_FLAG?EA.default.createElement(mk.default,null,EA.default.createElement(mk.ScreenClassContext.Consumer,null,n=>e(n))):e(r))};LH.propTypes={children:Ahe.default.func.isRequired};var $he=LH;hk.default=$he});var zH=Ye(xk=>{"use strict";Object.defineProperty(xk,"__esModule",{value:!0});xk.default=void 0;var gk=Mhe(pt()),Oe=_A(zl()),Rhe=_A(_H()),Ohe=zf(),Fhe=kA(),Phe=_A(eg()),Lhe=Qh();function _A(t){return t&&t.__esModule?t:{default:t}}function MH(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(MH=function(n){return n?r:e})(t)}function Mhe(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||typeof t!="object"&&typeof t!="function")return{default:t};var r=MH(e);if(r&&r.has(t))return r.get(t);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if(s!=="default"&&Object.prototype.hasOwnProperty.call(t,s)){var i=o?Object.getOwnPropertyDescriptor(t,s):null;i&&(i.get||i.set)?Object.defineProperty(n,s,i):n[s]=t[s]}return n.default=t,r&&r.set(t,n),n}var AA=gk.default.forwardRef((t,e)=>{let{children:r,xs:n,sm:o,md:s,lg:i,xl:a,xxl:l,xxxl:u,offset:c,pull:p,push:f,order:d,debug:m,style:h,component:g,width:x,...y}=t;return gk.default.createElement(Phe.default,null,b=>gk.default.createElement(Fhe.GutterWidthContext.Consumer,null,v=>{let C=(0,Rhe.default)({forceWidth:x,width:{xs:n,sm:o,md:s,lg:i,xl:a,xxl:l,xxxl:u},offset:c,pull:p,push:f,order:d,debug:m,screenClass:b,gutterWidth:v,gridColumns:(0,Ohe.getConfiguration)().gridColumns,moreStyle:h});return(0,gk.createElement)(g,{ref:e,style:C,...y,children:r})}))});AA.propTypes={children:Oe.default.node,xs:Oe.default.oneOfType([Oe.default.number,Oe.default.oneOf(["content"])]),sm:Oe.default.oneOfType([Oe.default.number,Oe.default.oneOf(["content"])]),md:Oe.default.oneOfType([Oe.default.number,Oe.default.oneOf(["content"])]),lg:Oe.default.oneOfType([Oe.default.number,Oe.default.oneOf(["content"])]),xl:Oe.default.oneOfType([Oe.default.number,Oe.default.oneOf(["content"])]),xxl:Oe.default.oneOfType([Oe.default.number,Oe.default.oneOf(["content"])]),xxxl:Oe.default.oneOfType([Oe.default.number,Oe.default.oneOf(["content"])]),width:Oe.default.oneOfType([Oe.default.number,Oe.default.string]),offset:Oe.default.shape({xs:Oe.default.number,sm:Oe.default.number,md:Oe.default.number,lg:Oe.default.number,xl:Oe.default.number,xxl:Oe.default.number,xxxl:Oe.default.number}),push:Oe.default.shape({xs:Oe.default.number,sm:Oe.default.number,md:Oe.default.number,lg:Oe.default.number,xl:Oe.default.number,xxl:Oe.default.number,xxxl:Oe.default.number}),pull:Oe.default.shape({xs:Oe.default.number,sm:Oe.default.number,md:Oe.default.number,lg:Oe.default.number,xl:Oe.default.number,xxl:Oe.default.number,xxxl:Oe.default.number}),order:Oe.default.shape({xs:Oe.default.number,sm:Oe.default.number,md:Oe.default.number,lg:Oe.default.number,xl:Oe.default.number,xxl:Oe.default.number,xxxl:Oe.default.number}),style:Oe.default.objectOf(Oe.default.oneOfType([Oe.default.number,Oe.default.string])),debug:Oe.default.bool,component:Oe.default.elementType};AA.defaultProps={children:null,xs:null,sm:null,md:null,lg:null,xl:null,xxl:null,xxxl:null,width:null,offset:{},push:{},pull:{},style:{},order:{},debug:!1,component:Lhe.Div};var zhe=AA;xk.default=zhe});var BH=Ye(yk=>{"use strict";Object.defineProperty(yk,"__esModule",{value:!0});yk.default=void 0;var Bhe=t=>{let{fluid:e,xs:r,sm:n,md:o,lg:s,xl:i,xxl:a,xxxl:l,screenClass:u,containerWidths:c,gutterWidth:p,moreStyle:f}=t,d={boxSizing:"border-box",position:"relative",marginLeft:"auto",marginRight:"auto",paddingLeft:p/2,paddingRight:p/2};return e&&!r&&!n&&!o&&!s&&!i?{...d,...f}:(u==="xs"&&c[0]&&!r&&(d.maxWidth=c[0]),u==="sm"&&c[0]&&!n&&(d.maxWidth=c[0]),u==="md"&&c[1]&&!o&&(d.maxWidth=c[1]),u==="lg"&&c[2]&&!s&&(d.maxWidth=c[2]),u==="xl"&&c[3]&&!i&&(d.maxWidth=c[3]),u==="xxl"&&c[4]&&!a&&(d.maxWidth=c[4]),u==="xxxl"&&c[5]&&!l&&(d.maxWidth=c[5]),{...d,...f})};yk.default=Bhe});var GH=Ye(bk=>{"use strict";Object.defineProperty(bk,"__esModule",{value:!0});bk.default=void 0;var DA=Uhe(pt()),Fo=$A(zl()),Vhe=$A(BH()),VH=zf(),Whe=$A(eg()),Ghe=Qh();function $A(t){return t&&t.__esModule?t:{default:t}}function WH(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(WH=function(n){return n?r:e})(t)}function Uhe(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||typeof t!="object"&&typeof t!="function")return{default:t};var r=WH(e);if(r&&r.has(t))return r.get(t);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if(s!=="default"&&Object.prototype.hasOwnProperty.call(t,s)){var i=o?Object.getOwnPropertyDescriptor(t,s):null;i&&(i.get||i.set)?Object.defineProperty(n,s,i):n[s]=t[s]}return n.default=t,r&&r.set(t,n),n}var RA=DA.default.forwardRef((t,e)=>{let{children:r,fluid:n,xs:o,sm:s,md:i,lg:a,xl:l,xxl:u,xxxl:c,style:p,component:f,...d}=t;return DA.default.createElement(Whe.default,null,m=>(0,DA.createElement)(f,{ref:e,style:(0,Vhe.default)({fluid:n,xs:o,sm:s,md:i,lg:a,xl:l,xxl:u,xxxl:c,screenClass:m,containerWidths:(0,VH.getConfiguration)().containerWidths,gutterWidth:(0,VH.getConfiguration)().gutterWidth,moreStyle:p}),...d},r))});RA.propTypes={children:Fo.default.node.isRequired,fluid:Fo.default.bool,xs:Fo.default.bool,sm:Fo.default.bool,md:Fo.default.bool,lg:Fo.default.bool,xl:Fo.default.bool,xxl:Fo.default.bool,xxxl:Fo.default.bool,style:Fo.default.objectOf(Fo.default.oneOfType([Fo.default.number,Fo.default.string])),component:Fo.default.elementType};RA.defaultProps={fluid:!1,xs:!1,sm:!1,md:!1,lg:!1,xl:!1,xxl:!1,xxxl:!1,style:{},component:Ghe.Div};var Hhe=RA;bk.default=Hhe});var HH=Ye(tg=>{"use strict";Object.defineProperty(tg,"__esModule",{value:!0});tg.hidden=tg.default=void 0;var UH=t=>{let{screenClass:e,xs:r,sm:n,md:o,lg:s,xl:i,xxl:a,xxxl:l}=t;return e==="xxl"?a:e==="xxxl"?l:e==="xl"?i:e==="lg"?s:e==="md"?o:e==="sm"?n:r};tg.hidden=UH;var qhe=UH;tg.default=qhe});var jH=Ye(vk=>{"use strict";Object.defineProperty(vk,"__esModule",{value:!0});vk.default=void 0;var jhe=OA(pt()),Lc=OA(zl()),Khe=Yhe(HH()),Xhe=OA(eg());function qH(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(qH=function(n){return n?r:e})(t)}function Yhe(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||typeof t!="object"&&typeof t!="function")return{default:t};var r=qH(e);if(r&&r.has(t))return r.get(t);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if(s!=="default"&&Object.prototype.hasOwnProperty.call(t,s)){var i=o?Object.getOwnPropertyDescriptor(t,s):null;i&&(i.get||i.set)?Object.defineProperty(n,s,i):n[s]=t[s]}return n.default=t,r&&r.set(t,n),n}function OA(t){return t&&t.__esModule?t:{default:t}}var FA=t=>{let{children:e,xs:r,sm:n,md:o,lg:s,xl:i,xxl:a,xxxl:l}=t;return jhe.default.createElement(Xhe.default,null,u=>Khe.hidden({screenClass:u,xs:r,sm:n,md:o,lg:s,xl:i,xxl:a,xxxl:l})?null:e)};FA.propTypes={children:Lc.default.node.isRequired,xs:Lc.default.bool,sm:Lc.default.bool,md:Lc.default.bool,lg:Lc.default.bool,xl:Lc.default.bool,xxl:Lc.default.bool,xxxl:Lc.default.bool};FA.defaultProps={xs:!1,sm:!1,md:!1,lg:!1,xl:!1,xxl:!1,xxxl:!1};var Qhe=FA;vk.default=Qhe});var XH=Ye(rg=>{"use strict";Object.defineProperty(rg,"__esModule",{value:!0});rg.visible=rg.default=void 0;var KH=t=>{let{screenClass:e,xs:r,sm:n,md:o,lg:s,xl:i,xxl:a,xxxl:l}=t;return e==="xxl"?a:e==="xxxl"?l:e==="xl"?i:e==="lg"?s:e==="md"?o:e==="sm"?n:r};rg.visible=KH;var Zhe=KH;rg.default=Zhe});var QH=Ye(wk=>{"use strict";Object.defineProperty(wk,"__esModule",{value:!0});wk.default=void 0;var Jhe=PA(pt()),Mc=PA(zl()),ege=rge(XH()),tge=PA(eg());function YH(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(YH=function(n){return n?r:e})(t)}function rge(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||typeof t!="object"&&typeof t!="function")return{default:t};var r=YH(e);if(r&&r.has(t))return r.get(t);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if(s!=="default"&&Object.prototype.hasOwnProperty.call(t,s)){var i=o?Object.getOwnPropertyDescriptor(t,s):null;i&&(i.get||i.set)?Object.defineProperty(n,s,i):n[s]=t[s]}return n.default=t,r&&r.set(t,n),n}function PA(t){return t&&t.__esModule?t:{default:t}}var LA=t=>{let{children:e,xs:r,sm:n,md:o,lg:s,xl:i,xxl:a,xxxl:l}=t;return Jhe.default.createElement(tge.default,null,u=>ege.visible({screenClass:u,xs:r,sm:n,md:o,lg:s,xl:i,xxl:a,xxxl:l})?e:null)};LA.propTypes={children:Mc.default.node.isRequired,xs:Mc.default.bool,sm:Mc.default.bool,md:Mc.default.bool,lg:Mc.default.bool,xl:Mc.default.bool,xxl:Mc.default.bool,xxxl:Mc.default.bool};LA.defaultProps={xs:!1,sm:!1,md:!1,lg:!1,xl:!1,xxl:!1,xxxl:!1};var nge=LA;wk.default=nge});var JH=Ye(Ck=>{"use strict";Object.defineProperty(Ck,"__esModule",{value:!0});Ck.default=void 0;var oge=MA(pt()),sge=MA(zl()),ige=MA(eg());function MA(t){return t&&t.__esModule?t:{default:t}}var ZH=t=>{let{render:e}=t;return oge.default.createElement(ige.default,null,r=>e(r))};ZH.propTypes={render:sge.default.func.isRequired};var age=ZH;Ck.default=age});var Bf=Ye(Ls=>{"use strict";Object.defineProperty(Ls,"__esModule",{value:!0});Object.defineProperty(Ls,"Col",{enumerable:!0,get:function(){return lge.default}});Object.defineProperty(Ls,"Container",{enumerable:!0,get:function(){return uge.default}});Object.defineProperty(Ls,"Hidden",{enumerable:!0,get:function(){return pge.default}});Object.defineProperty(Ls,"Row",{enumerable:!0,get:function(){return cge.default}});Object.defineProperty(Ls,"ScreenClassContext",{enumerable:!0,get:function(){return e7.ScreenClassContext}});Object.defineProperty(Ls,"ScreenClassProvider",{enumerable:!0,get:function(){return e7.default}});Object.defineProperty(Ls,"ScreenClassRender",{enumerable:!0,get:function(){return dge.default}});Object.defineProperty(Ls,"Visible",{enumerable:!0,get:function(){return fge.default}});Object.defineProperty(Ls,"setConfiguration",{enumerable:!0,get:function(){return mge.setConfiguration}});Object.defineProperty(Ls,"useScreenClass",{enumerable:!0,get:function(){return hge.useScreenClass}});var lge=ng(zH()),uge=ng(GH()),cge=ng(kA()),pge=ng(jH()),fge=ng(QH()),dge=ng(JH()),e7=gge(IA()),mge=zf(),hge=uk();function t7(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,r=new WeakMap;return(t7=function(n){return n?r:e})(t)}function gge(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||typeof t!="object"&&typeof t!="function")return{default:t};var r=t7(e);if(r&&r.has(t))return r.get(t);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var s in t)if(s!=="default"&&Object.prototype.hasOwnProperty.call(t,s)){var i=o?Object.getOwnPropertyDescriptor(t,s):null;i&&(i.get||i.set)?Object.defineProperty(n,s,i):n[s]=t[s]}return n.default=t,r&&r.set(t,n),n}function ng(t){return t&&t.__esModule?t:{default:t}}});var w7=Ye(tr=>{"use strict";function YA(t,e){var r=t.length;t.push(e);e:for(;0<r;){var n=r-1>>>1,o=t[n];if(0<Nk(o,e))t[n]=e,t[r]=o,r=n;else break e}}function yi(t){return t.length===0?null:t[0]}function Ek(t){if(t.length===0)return null;var e=t[0],r=t.pop();if(r!==e){t[0]=r;e:for(var n=0,o=t.length,s=o>>>1;n<s;){var i=2*(n+1)-1,a=t[i],l=i+1,u=t[l];if(0>Nk(a,r))l<o&&0>Nk(u,a)?(t[n]=u,t[l]=r,n=l):(t[n]=a,t[i]=r,n=i);else if(l<o&&0>Nk(u,r))t[n]=u,t[l]=r,n=l;else break e}}return e}function Nk(t,e){var r=t.sortIndex-e.sortIndex;return r!==0?r:t.id-e.id}typeof performance=="object"&&typeof performance.now=="function"?(f7=performance,tr.unstable_now=function(){return f7.now()}):(jA=Date,d7=jA.now(),tr.unstable_now=function(){return jA.now()-d7});var f7,jA,d7,ra=[],zc=[],kge=1,zs=null,Jn=3,_k=!1,Vf=!1,Z0=!1,g7=typeof setTimeout=="function"?setTimeout:null,x7=typeof clearTimeout=="function"?clearTimeout:null,m7=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function QA(t){for(var e=yi(zc);e!==null;){if(e.callback===null)Ek(zc);else if(e.startTime<=t)Ek(zc),e.sortIndex=e.expirationTime,YA(ra,e);else break;e=yi(zc)}}function ZA(t){if(Z0=!1,QA(t),!Vf)if(yi(ra)!==null)Vf=!0,eD(JA);else{var e=yi(zc);e!==null&&tD(ZA,e.startTime-t)}}function JA(t,e){Vf=!1,Z0&&(Z0=!1,x7(J0),J0=-1),_k=!0;var r=Jn;try{for(QA(e),zs=yi(ra);zs!==null&&(!(zs.expirationTime>e)||t&&!v7());){var n=zs.callback;if(typeof n=="function"){zs.callback=null,Jn=zs.priorityLevel;var o=n(zs.expirationTime<=e);e=tr.unstable_now(),typeof o=="function"?zs.callback=o:zs===yi(ra)&&Ek(ra),QA(e)}else Ek(ra);zs=yi(ra)}if(zs!==null)var s=!0;else{var i=yi(zc);i!==null&&tD(ZA,i.startTime-e),s=!1}return s}finally{zs=null,Jn=r,_k=!1}}var Ak=!1,Ik=null,J0=-1,y7=5,b7=-1;function v7(){return!(tr.unstable_now()-b7<y7)}function KA(){if(Ik!==null){var t=tr.unstable_now();b7=t;var e=!0;try{e=Ik(!0,t)}finally{e?Q0():(Ak=!1,Ik=null)}}else Ak=!1}var Q0;typeof m7=="function"?Q0=function(){m7(KA)}:typeof MessageChannel<"u"?(XA=new MessageChannel,h7=XA.port2,XA.port1.onmessage=KA,Q0=function(){h7.postMessage(null)}):Q0=function(){g7(KA,0)};var XA,h7;function eD(t){Ik=t,Ak||(Ak=!0,Q0())}function tD(t,e){J0=g7(function(){t(tr.unstable_now())},e)}tr.unstable_IdlePriority=5;tr.unstable_ImmediatePriority=1;tr.unstable_LowPriority=4;tr.unstable_NormalPriority=3;tr.unstable_Profiling=null;tr.unstable_UserBlockingPriority=2;tr.unstable_cancelCallback=function(t){t.callback=null};tr.unstable_continueExecution=function(){Vf||_k||(Vf=!0,eD(JA))};tr.unstable_forceFrameRate=function(t){0>t||125<t?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):y7=0<t?Math.floor(1e3/t):5};tr.unstable_getCurrentPriorityLevel=function(){return Jn};tr.unstable_getFirstCallbackNode=function(){return yi(ra)};tr.unstable_next=function(t){switch(Jn){case 1:case 2:case 3:var e=3;break;default:e=Jn}var r=Jn;Jn=e;try{return t()}finally{Jn=r}};tr.unstable_pauseExecution=function(){};tr.unstable_requestPaint=function(){};tr.unstable_runWithPriority=function(t,e){switch(t){case 1:case 2:case 3:case 4:case 5:break;default:t=3}var r=Jn;Jn=t;try{return e()}finally{Jn=r}};tr.unstable_scheduleCallback=function(t,e,r){var n=tr.unstable_now();switch(typeof r=="object"&&r!==null?(r=r.delay,r=typeof r=="number"&&0<r?n+r:n):r=n,t){case 1:var o=-1;break;case 2:o=250;break;case 5:o=1073741823;break;case 4:o=1e4;break;default:o=5e3}return o=r+o,t={id:kge++,callback:e,priorityLevel:t,startTime:r,expirationTime:o,sortIndex:-1},r>n?(t.sortIndex=r,YA(zc,t),yi(ra)===null&&t===yi(zc)&&(Z0?(x7(J0),J0=-1):Z0=!0,tD(ZA,r-n))):(t.sortIndex=o,YA(ra,t),Vf||_k||(Vf=!0,eD(JA))),t};tr.unstable_shouldYield=v7;tr.unstable_wrapCallback=function(t){var e=Jn;return function(){var r=Jn;Jn=e;try{return t.apply(this,arguments)}finally{Jn=r}}}});var S7=Ye((Bqt,C7)=>{"use strict";C7.exports=w7()});var _j=Ye(ls=>{"use strict";var A9=pt(),is=S7();function ge(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,r=1;r<arguments.length;r++)e+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var D9=new Set,wb={};function ed(t,e){kg(t,e),kg(t+"Capture",e)}function kg(t,e){for(wb[t]=e,t=0;t<e.length;t++)D9.add(e[t])}var ql=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),kD=Object.prototype.hasOwnProperty,Tge=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,k7={},T7={};function Nge(t){return kD.call(T7,t)?!0:kD.call(k7,t)?!1:Tge.test(t)?T7[t]=!0:(k7[t]=!0,!1)}function Ige(t,e,r,n){if(r!==null&&r.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return n?!1:r!==null?!r.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function Ege(t,e,r,n){if(e===null||typeof e>"u"||Ige(t,e,r,n))return!0;if(n)return!1;if(r!==null)switch(r.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function go(t,e,r,n,o,s,i){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=n,this.attributeNamespace=o,this.mustUseProperty=r,this.propertyName=t,this.type=e,this.sanitizeURL=s,this.removeEmptyString=i}var Mn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Mn[t]=new go(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Mn[e]=new go(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Mn[t]=new go(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Mn[t]=new go(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Mn[t]=new go(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Mn[t]=new go(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Mn[t]=new go(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Mn[t]=new go(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Mn[t]=new go(t,5,!1,t.toLowerCase(),null,!1,!1)});var g$=/[\-:]([a-z])/g;function x$(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(g$,x$);Mn[e]=new go(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(g$,x$);Mn[e]=new go(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(g$,x$);Mn[e]=new go(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Mn[t]=new go(t,1,!1,t.toLowerCase(),null,!1,!1)});Mn.xlinkHref=new go("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Mn[t]=new go(t,1,!1,t.toLowerCase(),null,!0,!0)});function y$(t,e,r,n){var o=Mn.hasOwnProperty(e)?Mn[e]:null;(o!==null?o.type!==0:n||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Ege(e,r,o,n)&&(r=null),n||o===null?Nge(e)&&(r===null?t.removeAttribute(e):t.setAttribute(e,""+r)):o.mustUseProperty?t[o.propertyName]=r===null?o.type===3?!1:"":r:(e=o.attributeName,n=o.attributeNamespace,r===null?t.removeAttribute(e):(o=o.type,r=o===3||o===4&&r===!0?"":""+r,n?t.setAttributeNS(n,e,r):t.setAttribute(e,r))))}var Yl=A9.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Dk=Symbol.for("react.element"),ig=Symbol.for("react.portal"),ag=Symbol.for("react.fragment"),b$=Symbol.for("react.strict_mode"),TD=Symbol.for("react.profiler"),$9=Symbol.for("react.provider"),R9=Symbol.for("react.context"),v$=Symbol.for("react.forward_ref"),ND=Symbol.for("react.suspense"),ID=Symbol.for("react.suspense_list"),w$=Symbol.for("react.memo"),Vc=Symbol.for("react.lazy");Symbol.for("react.scope");Symbol.for("react.debug_trace_mode");var O9=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden");Symbol.for("react.cache");Symbol.for("react.tracing_marker");var N7=Symbol.iterator;function eb(t){return t===null||typeof t!="object"?null:(t=N7&&t[N7]||t["@@iterator"],typeof t=="function"?t:null)}var Ir=Object.assign,rD;function lb(t){if(rD===void 0)try{throw Error()}catch(r){var e=r.stack.trim().match(/\n( *(at )?)/);rD=e&&e[1]||""}return`
`+rD+t}var nD=!1;function oD(t,e){if(!t||nD)return"";nD=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var n=u}Reflect.construct(t,[],e)}else{try{e.call()}catch(u){n=u}t.call(e.prototype)}else{try{throw Error()}catch(u){n=u}t()}}catch(u){if(u&&n&&typeof u.stack=="string"){for(var o=u.stack.split(`
`),s=n.stack.split(`
`),i=o.length-1,a=s.length-1;1<=i&&0<=a&&o[i]!==s[a];)a--;for(;1<=i&&0<=a;i--,a--)if(o[i]!==s[a]){if(i!==1||a!==1)do if(i--,a--,0>a||o[i]!==s[a]){var l=`
`+o[i].replace(" at new "," at ");return t.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",t.displayName)),l}while(1<=i&&0<=a);break}}}finally{nD=!1,Error.prepareStackTrace=r}return(t=t?t.displayName||t.name:"")?lb(t):""}function _ge(t){switch(t.tag){case 5:return lb(t.type);case 16:return lb("Lazy");case 13:return lb("Suspense");case 19:return lb("SuspenseList");case 0:case 2:case 15:return t=oD(t.type,!1),t;case 11:return t=oD(t.type.render,!1),t;case 1:return t=oD(t.type,!0),t;default:return""}}function ED(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case ag:return"Fragment";case ig:return"Portal";case TD:return"Profiler";case b$:return"StrictMode";case ND:return"Suspense";case ID:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case R9:return(t.displayName||"Context")+".Consumer";case $9:return(t._context.displayName||"Context")+".Provider";case v$:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case w$:return e=t.displayName||null,e!==null?e:ED(t.type)||"Memo";case Vc:e=t._payload,t=t._init;try{return ED(t(e))}catch{}}return null}function Age(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ED(e);case 8:return e===b$?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function tp(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function F9(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Dge(t){var e=F9(t)?"checked":"value",r=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),n=""+t[e];if(!t.hasOwnProperty(e)&&typeof r<"u"&&typeof r.get=="function"&&typeof r.set=="function"){var o=r.get,s=r.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return o.call(this)},set:function(i){n=""+i,s.call(this,i)}}),Object.defineProperty(t,e,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(i){n=""+i},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function $k(t){t._valueTracker||(t._valueTracker=Dge(t))}function P9(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var r=e.getValue(),n="";return t&&(n=F9(t)?t.checked?"true":"false":t.value),t=n,t!==r?(e.setValue(t),!0):!1}function iT(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function _D(t,e){var r=e.checked;return Ir({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:r??t._wrapperState.initialChecked})}function I7(t,e){var r=e.defaultValue==null?"":e.defaultValue,n=e.checked!=null?e.checked:e.defaultChecked;r=tp(e.value!=null?e.value:r),t._wrapperState={initialChecked:n,initialValue:r,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function L9(t,e){e=e.checked,e!=null&&y$(t,"checked",e,!1)}function AD(t,e){L9(t,e);var r=tp(e.value),n=e.type;if(r!=null)n==="number"?(r===0&&t.value===""||t.value!=r)&&(t.value=""+r):t.value!==""+r&&(t.value=""+r);else if(n==="submit"||n==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?DD(t,e.type,r):e.hasOwnProperty("defaultValue")&&DD(t,e.type,tp(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function E7(t,e,r){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var n=e.type;if(!(n!=="submit"&&n!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,r||e===t.value||(t.value=e),t.defaultValue=e}r=t.name,r!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,r!==""&&(t.name=r)}function DD(t,e,r){(e!=="number"||iT(t.ownerDocument)!==t)&&(r==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+r&&(t.defaultValue=""+r))}var ub=Array.isArray;function yg(t,e,r,n){if(t=t.options,e){e={};for(var o=0;o<r.length;o++)e["$"+r[o]]=!0;for(r=0;r<t.length;r++)o=e.hasOwnProperty("$"+t[r].value),t[r].selected!==o&&(t[r].selected=o),o&&n&&(t[r].defaultSelected=!0)}else{for(r=""+tp(r),e=null,o=0;o<t.length;o++){if(t[o].value===r){t[o].selected=!0,n&&(t[o].defaultSelected=!0);return}e!==null||t[o].disabled||(e=t[o])}e!==null&&(e.selected=!0)}}function $D(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(ge(91));return Ir({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function _7(t,e){var r=e.value;if(r==null){if(r=e.children,e=e.defaultValue,r!=null){if(e!=null)throw Error(ge(92));if(ub(r)){if(1<r.length)throw Error(ge(93));r=r[0]}e=r}e==null&&(e=""),r=e}t._wrapperState={initialValue:tp(r)}}function M9(t,e){var r=tp(e.value),n=tp(e.defaultValue);r!=null&&(r=""+r,r!==t.value&&(t.value=r),e.defaultValue==null&&t.defaultValue!==r&&(t.defaultValue=r)),n!=null&&(t.defaultValue=""+n)}function A7(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function z9(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function RD(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?z9(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Rk,B9=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,r,n,o){MSApp.execUnsafeLocalFunction(function(){return t(e,r,n,o)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Rk=Rk||document.createElement("div"),Rk.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Rk.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Cb(t,e){if(e){var r=t.firstChild;if(r&&r===t.lastChild&&r.nodeType===3){r.nodeValue=e;return}}t.textContent=e}var fb={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},$ge=["Webkit","ms","Moz","O"];Object.keys(fb).forEach(function(t){$ge.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),fb[e]=fb[t]})});function V9(t,e,r){return e==null||typeof e=="boolean"||e===""?"":r||typeof e!="number"||e===0||fb.hasOwnProperty(t)&&fb[t]?(""+e).trim():e+"px"}function W9(t,e){t=t.style;for(var r in e)if(e.hasOwnProperty(r)){var n=r.indexOf("--")===0,o=V9(r,e[r],n);r==="float"&&(r="cssFloat"),n?t.setProperty(r,o):t[r]=o}}var Rge=Ir({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function OD(t,e){if(e){if(Rge[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(ge(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(ge(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(ge(61))}if(e.style!=null&&typeof e.style!="object")throw Error(ge(62))}}function FD(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var PD=null;function C$(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var LD=null,bg=null,vg=null;function D7(t){if(t=Bb(t)){if(typeof LD!="function")throw Error(ge(280));var e=t.stateNode;e&&(e=OT(e),LD(t.stateNode,t.type,e))}}function G9(t){bg?vg?vg.push(t):vg=[t]:bg=t}function U9(){if(bg){var t=bg,e=vg;if(vg=bg=null,D7(t),e)for(t=0;t<e.length;t++)D7(e[t])}}function H9(t,e){return t(e)}function q9(){}var sD=!1;function j9(t,e,r){if(sD)return t(e,r);sD=!0;try{return H9(t,e,r)}finally{sD=!1,(bg!==null||vg!==null)&&(q9(),U9())}}function Sb(t,e){var r=t.stateNode;if(r===null)return null;var n=OT(r);if(n===null)return null;r=n[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(t=t.type,n=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!n;break e;default:t=!1}if(t)return null;if(r&&typeof r!="function")throw Error(ge(231,e,typeof r));return r}var MD=!1;if(ql)try{og={},Object.defineProperty(og,"passive",{get:function(){MD=!0}}),window.addEventListener("test",og,og),window.removeEventListener("test",og,og)}catch{MD=!1}var og;function Oge(t,e,r,n,o,s,i,a,l){var u=Array.prototype.slice.call(arguments,3);try{e.apply(r,u)}catch(c){this.onError(c)}}var db=!1,aT=null,lT=!1,zD=null,Fge={onError:function(t){db=!0,aT=t}};function Pge(t,e,r,n,o,s,i,a,l){db=!1,aT=null,Oge.apply(Fge,arguments)}function Lge(t,e,r,n,o,s,i,a,l){if(Pge.apply(this,arguments),db){if(db){var u=aT;db=!1,aT=null}else throw Error(ge(198));lT||(lT=!0,zD=u)}}function td(t){var e=t,r=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,(e.flags&4098)!==0&&(r=e.return),t=e.return;while(t)}return e.tag===3?r:null}function K9(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function $7(t){if(td(t)!==t)throw Error(ge(188))}function Mge(t){var e=t.alternate;if(!e){if(e=td(t),e===null)throw Error(ge(188));return e!==t?null:t}for(var r=t,n=e;;){var o=r.return;if(o===null)break;var s=o.alternate;if(s===null){if(n=o.return,n!==null){r=n;continue}break}if(o.child===s.child){for(s=o.child;s;){if(s===r)return $7(o),t;if(s===n)return $7(o),e;s=s.sibling}throw Error(ge(188))}if(r.return!==n.return)r=o,n=s;else{for(var i=!1,a=o.child;a;){if(a===r){i=!0,r=o,n=s;break}if(a===n){i=!0,n=o,r=s;break}a=a.sibling}if(!i){for(a=s.child;a;){if(a===r){i=!0,r=s,n=o;break}if(a===n){i=!0,n=s,r=o;break}a=a.sibling}if(!i)throw Error(ge(189))}}if(r.alternate!==n)throw Error(ge(190))}if(r.tag!==3)throw Error(ge(188));return r.stateNode.current===r?t:e}function X9(t){return t=Mge(t),t!==null?Y9(t):null}function Y9(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=Y9(t);if(e!==null)return e;t=t.sibling}return null}var Q9=is.unstable_scheduleCallback,R7=is.unstable_cancelCallback,zge=is.unstable_shouldYield,Bge=is.unstable_requestPaint,zr=is.unstable_now,Vge=is.unstable_getCurrentPriorityLevel,S$=is.unstable_ImmediatePriority,Z9=is.unstable_UserBlockingPriority,uT=is.unstable_NormalPriority,Wge=is.unstable_LowPriority,J9=is.unstable_IdlePriority,AT=null,ia=null;function Gge(t){if(ia&&typeof ia.onCommitFiberRoot=="function")try{ia.onCommitFiberRoot(AT,t,void 0,(t.current.flags&128)===128)}catch{}}var Si=Math.clz32?Math.clz32:qge,Uge=Math.log,Hge=Math.LN2;function qge(t){return t>>>=0,t===0?32:31-(Uge(t)/Hge|0)|0}var Ok=64,Fk=4194304;function cb(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function cT(t,e){var r=t.pendingLanes;if(r===0)return 0;var n=0,o=t.suspendedLanes,s=t.pingedLanes,i=r&268435455;if(i!==0){var a=i&~o;a!==0?n=cb(a):(s&=i,s!==0&&(n=cb(s)))}else i=r&~o,i!==0?n=cb(i):s!==0&&(n=cb(s));if(n===0)return 0;if(e!==0&&e!==n&&(e&o)===0&&(o=n&-n,s=e&-e,o>=s||o===16&&(s&4194240)!==0))return e;if((n&4)!==0&&(n|=r&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=n;0<e;)r=31-Si(e),o=1<<r,n|=t[r],e&=~o;return n}function jge(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Kge(t,e){for(var r=t.suspendedLanes,n=t.pingedLanes,o=t.expirationTimes,s=t.pendingLanes;0<s;){var i=31-Si(s),a=1<<i,l=o[i];l===-1?((a&r)===0||(a&n)!==0)&&(o[i]=jge(a,e)):l<=e&&(t.expiredLanes|=a),s&=~a}}function BD(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function eq(){var t=Ok;return Ok<<=1,(Ok&4194240)===0&&(Ok=64),t}function iD(t){for(var e=[],r=0;31>r;r++)e.push(t);return e}function Mb(t,e,r){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Si(e),t[e]=r}function Xge(t,e){var r=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var n=t.eventTimes;for(t=t.expirationTimes;0<r;){var o=31-Si(r),s=1<<o;e[o]=0,n[o]=-1,t[o]=-1,r&=~s}}function k$(t,e){var r=t.entangledLanes|=e;for(t=t.entanglements;r;){var n=31-Si(r),o=1<<n;o&e|t[n]&e&&(t[n]|=e),r&=~o}}var Lt=0;function tq(t){return t&=-t,1<t?4<t?(t&268435455)!==0?16:536870912:4:1}var rq,T$,nq,oq,sq,VD=!1,Pk=[],jc=null,Kc=null,Xc=null,kb=new Map,Tb=new Map,Gc=[],Yge="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function O7(t,e){switch(t){case"focusin":case"focusout":jc=null;break;case"dragenter":case"dragleave":Kc=null;break;case"mouseover":case"mouseout":Xc=null;break;case"pointerover":case"pointerout":kb.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Tb.delete(e.pointerId)}}function tb(t,e,r,n,o,s){return t===null||t.nativeEvent!==s?(t={blockedOn:e,domEventName:r,eventSystemFlags:n,nativeEvent:s,targetContainers:[o]},e!==null&&(e=Bb(e),e!==null&&T$(e)),t):(t.eventSystemFlags|=n,e=t.targetContainers,o!==null&&e.indexOf(o)===-1&&e.push(o),t)}function Qge(t,e,r,n,o){switch(e){case"focusin":return jc=tb(jc,t,e,r,n,o),!0;case"dragenter":return Kc=tb(Kc,t,e,r,n,o),!0;case"mouseover":return Xc=tb(Xc,t,e,r,n,o),!0;case"pointerover":var s=o.pointerId;return kb.set(s,tb(kb.get(s)||null,t,e,r,n,o)),!0;case"gotpointercapture":return s=o.pointerId,Tb.set(s,tb(Tb.get(s)||null,t,e,r,n,o)),!0}return!1}function iq(t){var e=Uf(t.target);if(e!==null){var r=td(e);if(r!==null){if(e=r.tag,e===13){if(e=K9(r),e!==null){t.blockedOn=e,sq(t.priority,function(){nq(r)});return}}else if(e===3&&r.stateNode.current.memoizedState.isDehydrated){t.blockedOn=r.tag===3?r.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Yk(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var r=WD(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(r===null){r=t.nativeEvent;var n=new r.constructor(r.type,r);PD=n,r.target.dispatchEvent(n),PD=null}else return e=Bb(r),e!==null&&T$(e),t.blockedOn=r,!1;e.shift()}return!0}function F7(t,e,r){Yk(t)&&r.delete(e)}function Zge(){VD=!1,jc!==null&&Yk(jc)&&(jc=null),Kc!==null&&Yk(Kc)&&(Kc=null),Xc!==null&&Yk(Xc)&&(Xc=null),kb.forEach(F7),Tb.forEach(F7)}function rb(t,e){t.blockedOn===e&&(t.blockedOn=null,VD||(VD=!0,is.unstable_scheduleCallback(is.unstable_NormalPriority,Zge)))}function Nb(t){function e(o){return rb(o,t)}if(0<Pk.length){rb(Pk[0],t);for(var r=1;r<Pk.length;r++){var n=Pk[r];n.blockedOn===t&&(n.blockedOn=null)}}for(jc!==null&&rb(jc,t),Kc!==null&&rb(Kc,t),Xc!==null&&rb(Xc,t),kb.forEach(e),Tb.forEach(e),r=0;r<Gc.length;r++)n=Gc[r],n.blockedOn===t&&(n.blockedOn=null);for(;0<Gc.length&&(r=Gc[0],r.blockedOn===null);)iq(r),r.blockedOn===null&&Gc.shift()}var wg=Yl.ReactCurrentBatchConfig,pT=!0;function Jge(t,e,r,n){var o=Lt,s=wg.transition;wg.transition=null;try{Lt=1,N$(t,e,r,n)}finally{Lt=o,wg.transition=s}}function exe(t,e,r,n){var o=Lt,s=wg.transition;wg.transition=null;try{Lt=4,N$(t,e,r,n)}finally{Lt=o,wg.transition=s}}function N$(t,e,r,n){if(pT){var o=WD(t,e,r,n);if(o===null)dD(t,e,n,fT,r),O7(t,n);else if(Qge(o,t,e,r,n))n.stopPropagation();else if(O7(t,n),e&4&&-1<Yge.indexOf(t)){for(;o!==null;){var s=Bb(o);if(s!==null&&rq(s),s=WD(t,e,r,n),s===null&&dD(t,e,n,fT,r),s===o)break;o=s}o!==null&&n.stopPropagation()}else dD(t,e,n,null,r)}}var fT=null;function WD(t,e,r,n){if(fT=null,t=C$(n),t=Uf(t),t!==null)if(e=td(t),e===null)t=null;else if(r=e.tag,r===13){if(t=K9(e),t!==null)return t;t=null}else if(r===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return fT=t,null}function aq(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Vge()){case S$:return 1;case Z9:return 4;case uT:case Wge:return 16;case J9:return 536870912;default:return 16}default:return 16}}var Hc=null,I$=null,Qk=null;function lq(){if(Qk)return Qk;var t,e=I$,r=e.length,n,o="value"in Hc?Hc.value:Hc.textContent,s=o.length;for(t=0;t<r&&e[t]===o[t];t++);var i=r-t;for(n=1;n<=i&&e[r-n]===o[s-n];n++);return Qk=o.slice(t,1<n?1-n:void 0)}function Zk(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function Lk(){return!0}function P7(){return!1}function as(t){function e(r,n,o,s,i){this._reactName=r,this._targetInst=o,this.type=n,this.nativeEvent=s,this.target=i,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(r=t[a],this[a]=r?r(s):s[a]);return this.isDefaultPrevented=(s.defaultPrevented!=null?s.defaultPrevented:s.returnValue===!1)?Lk:P7,this.isPropagationStopped=P7,this}return Ir(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var r=this.nativeEvent;r&&(r.preventDefault?r.preventDefault():typeof r.returnValue!="unknown"&&(r.returnValue=!1),this.isDefaultPrevented=Lk)},stopPropagation:function(){var r=this.nativeEvent;r&&(r.stopPropagation?r.stopPropagation():typeof r.cancelBubble!="unknown"&&(r.cancelBubble=!0),this.isPropagationStopped=Lk)},persist:function(){},isPersistent:Lk}),e}var Dg={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},E$=as(Dg),zb=Ir({},Dg,{view:0,detail:0}),txe=as(zb),aD,lD,nb,DT=Ir({},zb,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:_$,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==nb&&(nb&&t.type==="mousemove"?(aD=t.screenX-nb.screenX,lD=t.screenY-nb.screenY):lD=aD=0,nb=t),aD)},movementY:function(t){return"movementY"in t?t.movementY:lD}}),L7=as(DT),rxe=Ir({},DT,{dataTransfer:0}),nxe=as(rxe),oxe=Ir({},zb,{relatedTarget:0}),uD=as(oxe),sxe=Ir({},Dg,{animationName:0,elapsedTime:0,pseudoElement:0}),ixe=as(sxe),axe=Ir({},Dg,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),lxe=as(axe),uxe=Ir({},Dg,{data:0}),M7=as(uxe),cxe={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},pxe={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},fxe={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function dxe(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=fxe[t])?!!e[t]:!1}function _$(){return dxe}var mxe=Ir({},zb,{key:function(t){if(t.key){var e=cxe[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Zk(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?pxe[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:_$,charCode:function(t){return t.type==="keypress"?Zk(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Zk(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),hxe=as(mxe),gxe=Ir({},DT,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),z7=as(gxe),xxe=Ir({},zb,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:_$}),yxe=as(xxe),bxe=Ir({},Dg,{propertyName:0,elapsedTime:0,pseudoElement:0}),vxe=as(bxe),wxe=Ir({},DT,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),Cxe=as(wxe),Sxe=[9,13,27,32],A$=ql&&"CompositionEvent"in window,mb=null;ql&&"documentMode"in document&&(mb=document.documentMode);var kxe=ql&&"TextEvent"in window&&!mb,uq=ql&&(!A$||mb&&8<mb&&11>=mb),B7=String.fromCharCode(32),V7=!1;function cq(t,e){switch(t){case"keyup":return Sxe.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function pq(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var lg=!1;function Txe(t,e){switch(t){case"compositionend":return pq(e);case"keypress":return e.which!==32?null:(V7=!0,B7);case"textInput":return t=e.data,t===B7&&V7?null:t;default:return null}}function Nxe(t,e){if(lg)return t==="compositionend"||!A$&&cq(t,e)?(t=lq(),Qk=I$=Hc=null,lg=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return uq&&e.locale!=="ko"?null:e.data;default:return null}}var Ixe={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function W7(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!Ixe[t.type]:e==="textarea"}function fq(t,e,r,n){G9(n),e=dT(e,"onChange"),0<e.length&&(r=new E$("onChange","change",null,r,n),t.push({event:r,listeners:e}))}var hb=null,Ib=null;function Exe(t){Sq(t,0)}function $T(t){var e=pg(t);if(P9(e))return t}function _xe(t,e){if(t==="change")return e}var dq=!1;ql&&(ql?(zk="oninput"in document,zk||(cD=document.createElement("div"),cD.setAttribute("oninput","return;"),zk=typeof cD.oninput=="function"),Mk=zk):Mk=!1,dq=Mk&&(!document.documentMode||9<document.documentMode));var Mk,zk,cD;function G7(){hb&&(hb.detachEvent("onpropertychange",mq),Ib=hb=null)}function mq(t){if(t.propertyName==="value"&&$T(Ib)){var e=[];fq(e,Ib,t,C$(t)),j9(Exe,e)}}function Axe(t,e,r){t==="focusin"?(G7(),hb=e,Ib=r,hb.attachEvent("onpropertychange",mq)):t==="focusout"&&G7()}function Dxe(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return $T(Ib)}function $xe(t,e){if(t==="click")return $T(e)}function Rxe(t,e){if(t==="input"||t==="change")return $T(e)}function Oxe(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Ti=typeof Object.is=="function"?Object.is:Oxe;function Eb(t,e){if(Ti(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var r=Object.keys(t),n=Object.keys(e);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var o=r[n];if(!kD.call(e,o)||!Ti(t[o],e[o]))return!1}return!0}function U7(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function H7(t,e){var r=U7(t);t=0;for(var n;r;){if(r.nodeType===3){if(n=t+r.textContent.length,t<=e&&n>=e)return{node:r,offset:e-t};t=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=U7(r)}}function hq(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?hq(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function gq(){for(var t=window,e=iT();e instanceof t.HTMLIFrameElement;){try{var r=typeof e.contentWindow.location.href=="string"}catch{r=!1}if(r)t=e.contentWindow;else break;e=iT(t.document)}return e}function D$(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function Fxe(t){var e=gq(),r=t.focusedElem,n=t.selectionRange;if(e!==r&&r&&r.ownerDocument&&hq(r.ownerDocument.documentElement,r)){if(n!==null&&D$(r)){if(e=n.start,t=n.end,t===void 0&&(t=e),"selectionStart"in r)r.selectionStart=e,r.selectionEnd=Math.min(t,r.value.length);else if(t=(e=r.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var o=r.textContent.length,s=Math.min(n.start,o);n=n.end===void 0?s:Math.min(n.end,o),!t.extend&&s>n&&(o=n,n=s,s=o),o=H7(r,s);var i=H7(r,n);o&&i&&(t.rangeCount!==1||t.anchorNode!==o.node||t.anchorOffset!==o.offset||t.focusNode!==i.node||t.focusOffset!==i.offset)&&(e=e.createRange(),e.setStart(o.node,o.offset),t.removeAllRanges(),s>n?(t.addRange(e),t.extend(i.node,i.offset)):(e.setEnd(i.node,i.offset),t.addRange(e)))}}for(e=[],t=r;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof r.focus=="function"&&r.focus(),r=0;r<e.length;r++)t=e[r],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var Pxe=ql&&"documentMode"in document&&11>=document.documentMode,ug=null,GD=null,gb=null,UD=!1;function q7(t,e,r){var n=r.window===r?r.document:r.nodeType===9?r:r.ownerDocument;UD||ug==null||ug!==iT(n)||(n=ug,"selectionStart"in n&&D$(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),gb&&Eb(gb,n)||(gb=n,n=dT(GD,"onSelect"),0<n.length&&(e=new E$("onSelect","select",null,e,r),t.push({event:e,listeners:n}),e.target=ug)))}function Bk(t,e){var r={};return r[t.toLowerCase()]=e.toLowerCase(),r["Webkit"+t]="webkit"+e,r["Moz"+t]="moz"+e,r}var cg={animationend:Bk("Animation","AnimationEnd"),animationiteration:Bk("Animation","AnimationIteration"),animationstart:Bk("Animation","AnimationStart"),transitionend:Bk("Transition","TransitionEnd")},pD={},xq={};ql&&(xq=document.createElement("div").style,"AnimationEvent"in window||(delete cg.animationend.animation,delete cg.animationiteration.animation,delete cg.animationstart.animation),"TransitionEvent"in window||delete cg.transitionend.transition);function RT(t){if(pD[t])return pD[t];if(!cg[t])return t;var e=cg[t],r;for(r in e)if(e.hasOwnProperty(r)&&r in xq)return pD[t]=e[r];return t}var yq=RT("animationend"),bq=RT("animationiteration"),vq=RT("animationstart"),wq=RT("transitionend"),Cq=new Map,j7="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function np(t,e){Cq.set(t,e),ed(e,[t])}for(Vk=0;Vk<j7.length;Vk++)Wk=j7[Vk],K7=Wk.toLowerCase(),X7=Wk[0].toUpperCase()+Wk.slice(1),np(K7,"on"+X7);var Wk,K7,X7,Vk;np(yq,"onAnimationEnd");np(bq,"onAnimationIteration");np(vq,"onAnimationStart");np("dblclick","onDoubleClick");np("focusin","onFocus");np("focusout","onBlur");np(wq,"onTransitionEnd");kg("onMouseEnter",["mouseout","mouseover"]);kg("onMouseLeave",["mouseout","mouseover"]);kg("onPointerEnter",["pointerout","pointerover"]);kg("onPointerLeave",["pointerout","pointerover"]);ed("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ed("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ed("onBeforeInput",["compositionend","keypress","textInput","paste"]);ed("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ed("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ed("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var pb="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Lxe=new Set("cancel close invalid load scroll toggle".split(" ").concat(pb));function Y7(t,e,r){var n=t.type||"unknown-event";t.currentTarget=r,Lge(n,e,void 0,t),t.currentTarget=null}function Sq(t,e){e=(e&4)!==0;for(var r=0;r<t.length;r++){var n=t[r],o=n.event;n=n.listeners;e:{var s=void 0;if(e)for(var i=n.length-1;0<=i;i--){var a=n[i],l=a.instance,u=a.currentTarget;if(a=a.listener,l!==s&&o.isPropagationStopped())break e;Y7(o,a,u),s=l}else for(i=0;i<n.length;i++){if(a=n[i],l=a.instance,u=a.currentTarget,a=a.listener,l!==s&&o.isPropagationStopped())break e;Y7(o,a,u),s=l}}}if(lT)throw t=zD,lT=!1,zD=null,t}function cr(t,e){var r=e[XD];r===void 0&&(r=e[XD]=new Set);var n=t+"__bubble";r.has(n)||(kq(e,t,2,!1),r.add(n))}function fD(t,e,r){var n=0;e&&(n|=4),kq(r,t,n,e)}var Gk="_reactListening"+Math.random().toString(36).slice(2);function _b(t){if(!t[Gk]){t[Gk]=!0,D9.forEach(function(r){r!=="selectionchange"&&(Lxe.has(r)||fD(r,!1,t),fD(r,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Gk]||(e[Gk]=!0,fD("selectionchange",!1,e))}}function kq(t,e,r,n){switch(aq(e)){case 1:var o=Jge;break;case 4:o=exe;break;default:o=N$}r=o.bind(null,e,r,t),o=void 0,!MD||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(o=!0),n?o!==void 0?t.addEventListener(e,r,{capture:!0,passive:o}):t.addEventListener(e,r,!0):o!==void 0?t.addEventListener(e,r,{passive:o}):t.addEventListener(e,r,!1)}function dD(t,e,r,n,o){var s=n;if((e&1)===0&&(e&2)===0&&n!==null)e:for(;;){if(n===null)return;var i=n.tag;if(i===3||i===4){var a=n.stateNode.containerInfo;if(a===o||a.nodeType===8&&a.parentNode===o)break;if(i===4)for(i=n.return;i!==null;){var l=i.tag;if((l===3||l===4)&&(l=i.stateNode.containerInfo,l===o||l.nodeType===8&&l.parentNode===o))return;i=i.return}for(;a!==null;){if(i=Uf(a),i===null)return;if(l=i.tag,l===5||l===6){n=s=i;continue e}a=a.parentNode}}n=n.return}j9(function(){var u=s,c=C$(r),p=[];e:{var f=Cq.get(t);if(f!==void 0){var d=E$,m=t;switch(t){case"keypress":if(Zk(r)===0)break e;case"keydown":case"keyup":d=hxe;break;case"focusin":m="focus",d=uD;break;case"focusout":m="blur",d=uD;break;case"beforeblur":case"afterblur":d=uD;break;case"click":if(r.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":d=L7;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":d=nxe;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":d=yxe;break;case yq:case bq:case vq:d=ixe;break;case wq:d=vxe;break;case"scroll":d=txe;break;case"wheel":d=Cxe;break;case"copy":case"cut":case"paste":d=lxe;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":d=z7}var h=(e&4)!==0,g=!h&&t==="scroll",x=h?f!==null?f+"Capture":null:f;h=[];for(var y=u,b;y!==null;){b=y;var v=b.stateNode;if(b.tag===5&&v!==null&&(b=v,x!==null&&(v=Sb(y,x),v!=null&&h.push(Ab(y,v,b)))),g)break;y=y.return}0<h.length&&(f=new d(f,m,null,r,c),p.push({event:f,listeners:h}))}}if((e&7)===0){e:{if(f=t==="mouseover"||t==="pointerover",d=t==="mouseout"||t==="pointerout",f&&r!==PD&&(m=r.relatedTarget||r.fromElement)&&(Uf(m)||m[jl]))break e;if((d||f)&&(f=c.window===c?c:(f=c.ownerDocument)?f.defaultView||f.parentWindow:window,d?(m=r.relatedTarget||r.toElement,d=u,m=m?Uf(m):null,m!==null&&(g=td(m),m!==g||m.tag!==5&&m.tag!==6)&&(m=null)):(d=null,m=u),d!==m)){if(h=L7,v="onMouseLeave",x="onMouseEnter",y="mouse",(t==="pointerout"||t==="pointerover")&&(h=z7,v="onPointerLeave",x="onPointerEnter",y="pointer"),g=d==null?f:pg(d),b=m==null?f:pg(m),f=new h(v,y+"leave",d,r,c),f.target=g,f.relatedTarget=b,v=null,Uf(c)===u&&(h=new h(x,y+"enter",m,r,c),h.target=b,h.relatedTarget=g,v=h),g=v,d&&m)t:{for(h=d,x=m,y=0,b=h;b;b=sg(b))y++;for(b=0,v=x;v;v=sg(v))b++;for(;0<y-b;)h=sg(h),y--;for(;0<b-y;)x=sg(x),b--;for(;y--;){if(h===x||x!==null&&h===x.alternate)break t;h=sg(h),x=sg(x)}h=null}else h=null;d!==null&&Q7(p,f,d,h,!1),m!==null&&g!==null&&Q7(p,g,m,h,!0)}}e:{if(f=u?pg(u):window,d=f.nodeName&&f.nodeName.toLowerCase(),d==="select"||d==="input"&&f.type==="file")var C=_xe;else if(W7(f))if(dq)C=Rxe;else{C=Dxe;var S=Axe}else(d=f.nodeName)&&d.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(C=$xe);if(C&&(C=C(t,u))){fq(p,C,r,c);break e}S&&S(t,f,u),t==="focusout"&&(S=f._wrapperState)&&S.controlled&&f.type==="number"&&DD(f,"number",f.value)}switch(S=u?pg(u):window,t){case"focusin":(W7(S)||S.contentEditable==="true")&&(ug=S,GD=u,gb=null);break;case"focusout":gb=GD=ug=null;break;case"mousedown":UD=!0;break;case"contextmenu":case"mouseup":case"dragend":UD=!1,q7(p,r,c);break;case"selectionchange":if(Pxe)break;case"keydown":case"keyup":q7(p,r,c)}var k;if(A$)e:{switch(t){case"compositionstart":var N="onCompositionStart";break e;case"compositionend":N="onCompositionEnd";break e;case"compositionupdate":N="onCompositionUpdate";break e}N=void 0}else lg?cq(t,r)&&(N="onCompositionEnd"):t==="keydown"&&r.keyCode===229&&(N="onCompositionStart");N&&(uq&&r.locale!=="ko"&&(lg||N!=="onCompositionStart"?N==="onCompositionEnd"&&lg&&(k=lq()):(Hc=c,I$="value"in Hc?Hc.value:Hc.textContent,lg=!0)),S=dT(u,N),0<S.length&&(N=new M7(N,t,null,r,c),p.push({event:N,listeners:S}),k?N.data=k:(k=pq(r),k!==null&&(N.data=k)))),(k=kxe?Txe(t,r):Nxe(t,r))&&(u=dT(u,"onBeforeInput"),0<u.length&&(c=new M7("onBeforeInput","beforeinput",null,r,c),p.push({event:c,listeners:u}),c.data=k))}Sq(p,e)})}function Ab(t,e,r){return{instance:t,listener:e,currentTarget:r}}function dT(t,e){for(var r=e+"Capture",n=[];t!==null;){var o=t,s=o.stateNode;o.tag===5&&s!==null&&(o=s,s=Sb(t,r),s!=null&&n.unshift(Ab(t,s,o)),s=Sb(t,e),s!=null&&n.push(Ab(t,s,o))),t=t.return}return n}function sg(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Q7(t,e,r,n,o){for(var s=e._reactName,i=[];r!==null&&r!==n;){var a=r,l=a.alternate,u=a.stateNode;if(l!==null&&l===n)break;a.tag===5&&u!==null&&(a=u,o?(l=Sb(r,s),l!=null&&i.unshift(Ab(r,l,a))):o||(l=Sb(r,s),l!=null&&i.push(Ab(r,l,a)))),r=r.return}i.length!==0&&t.push({event:e,listeners:i})}var Mxe=/\r\n?/g,zxe=/\u0000|\uFFFD/g;function Z7(t){return(typeof t=="string"?t:""+t).replace(Mxe,`
`).replace(zxe,"")}function Uk(t,e,r){if(e=Z7(e),Z7(t)!==e&&r)throw Error(ge(425))}function mT(){}var HD=null,qD=null;function jD(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var KD=typeof setTimeout=="function"?setTimeout:void 0,Bxe=typeof clearTimeout=="function"?clearTimeout:void 0,J7=typeof Promise=="function"?Promise:void 0,Vxe=typeof queueMicrotask=="function"?queueMicrotask:typeof J7<"u"?function(t){return J7.resolve(null).then(t).catch(Wxe)}:KD;function Wxe(t){setTimeout(function(){throw t})}function mD(t,e){var r=e,n=0;do{var o=r.nextSibling;if(t.removeChild(r),o&&o.nodeType===8)if(r=o.data,r==="/$"){if(n===0){t.removeChild(o),Nb(e);return}n--}else r!=="$"&&r!=="$?"&&r!=="$!"||n++;r=o}while(r);Nb(e)}function Yc(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function e9(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var r=t.data;if(r==="$"||r==="$!"||r==="$?"){if(e===0)return t;e--}else r==="/$"&&e++}t=t.previousSibling}return null}var $g=Math.random().toString(36).slice(2),sa="__reactFiber$"+$g,Db="__reactProps$"+$g,jl="__reactContainer$"+$g,XD="__reactEvents$"+$g,Gxe="__reactListeners$"+$g,Uxe="__reactHandles$"+$g;function Uf(t){var e=t[sa];if(e)return e;for(var r=t.parentNode;r;){if(e=r[jl]||r[sa]){if(r=e.alternate,e.child!==null||r!==null&&r.child!==null)for(t=e9(t);t!==null;){if(r=t[sa])return r;t=e9(t)}return e}t=r,r=t.parentNode}return null}function Bb(t){return t=t[sa]||t[jl],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function pg(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(ge(33))}function OT(t){return t[Db]||null}var YD=[],fg=-1;function op(t){return{current:t}}function pr(t){0>fg||(t.current=YD[fg],YD[fg]=null,fg--)}function rr(t,e){fg++,YD[fg]=t.current,t.current=e}var rp={},no=op(rp),Mo=op(!1),Xf=rp;function Tg(t,e){var r=t.type.contextTypes;if(!r)return rp;var n=t.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===e)return n.__reactInternalMemoizedMaskedChildContext;var o={},s;for(s in r)o[s]=e[s];return n&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=o),o}function zo(t){return t=t.childContextTypes,t!=null}function hT(){pr(Mo),pr(no)}function t9(t,e,r){if(no.current!==rp)throw Error(ge(168));rr(no,e),rr(Mo,r)}function Tq(t,e,r){var n=t.stateNode;if(e=e.childContextTypes,typeof n.getChildContext!="function")return r;n=n.getChildContext();for(var o in n)if(!(o in e))throw Error(ge(108,Age(t)||"Unknown",o));return Ir({},r,n)}function gT(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||rp,Xf=no.current,rr(no,t),rr(Mo,Mo.current),!0}function r9(t,e,r){var n=t.stateNode;if(!n)throw Error(ge(169));r?(t=Tq(t,e,Xf),n.__reactInternalMemoizedMergedChildContext=t,pr(Mo),pr(no),rr(no,t)):pr(Mo),rr(Mo,r)}var Wl=null,FT=!1,hD=!1;function Nq(t){Wl===null?Wl=[t]:Wl.push(t)}function Hxe(t){FT=!0,Nq(t)}function sp(){if(!hD&&Wl!==null){hD=!0;var t=0,e=Lt;try{var r=Wl;for(Lt=1;t<r.length;t++){var n=r[t];do n=n(!0);while(n!==null)}Wl=null,FT=!1}catch(o){throw Wl!==null&&(Wl=Wl.slice(t+1)),Q9(S$,sp),o}finally{Lt=e,hD=!1}}return null}var dg=[],mg=0,xT=null,yT=0,Bs=[],Vs=0,Yf=null,Gl=1,Ul="";function Wf(t,e){dg[mg++]=yT,dg[mg++]=xT,xT=t,yT=e}function Iq(t,e,r){Bs[Vs++]=Gl,Bs[Vs++]=Ul,Bs[Vs++]=Yf,Yf=t;var n=Gl;t=Ul;var o=32-Si(n)-1;n&=~(1<<o),r+=1;var s=32-Si(e)+o;if(30<s){var i=o-o%5;s=(n&(1<<i)-1).toString(32),n>>=i,o-=i,Gl=1<<32-Si(e)+o|r<<o|n,Ul=s+t}else Gl=1<<s|r<<o|n,Ul=t}function $$(t){t.return!==null&&(Wf(t,1),Iq(t,1,0))}function R$(t){for(;t===xT;)xT=dg[--mg],dg[mg]=null,yT=dg[--mg],dg[mg]=null;for(;t===Yf;)Yf=Bs[--Vs],Bs[Vs]=null,Ul=Bs[--Vs],Bs[Vs]=null,Gl=Bs[--Vs],Bs[Vs]=null}var ss=null,os=null,gr=!1,Ci=null;function Eq(t,e){var r=Ws(5,null,null,0);r.elementType="DELETED",r.stateNode=e,r.return=t,e=t.deletions,e===null?(t.deletions=[r],t.flags|=16):e.push(r)}function n9(t,e){switch(t.tag){case 5:var r=t.type;return e=e.nodeType!==1||r.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,ss=t,os=Yc(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,ss=t,os=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(r=Yf!==null?{id:Gl,overflow:Ul}:null,t.memoizedState={dehydrated:e,treeContext:r,retryLane:1073741824},r=Ws(18,null,null,0),r.stateNode=e,r.return=t,t.child=r,ss=t,os=null,!0):!1;default:return!1}}function QD(t){return(t.mode&1)!==0&&(t.flags&128)===0}function ZD(t){if(gr){var e=os;if(e){var r=e;if(!n9(t,e)){if(QD(t))throw Error(ge(418));e=Yc(r.nextSibling);var n=ss;e&&n9(t,e)?Eq(n,r):(t.flags=t.flags&-4097|2,gr=!1,ss=t)}}else{if(QD(t))throw Error(ge(418));t.flags=t.flags&-4097|2,gr=!1,ss=t}}}function o9(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;ss=t}function Hk(t){if(t!==ss)return!1;if(!gr)return o9(t),gr=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!jD(t.type,t.memoizedProps)),e&&(e=os)){if(QD(t))throw _q(),Error(ge(418));for(;e;)Eq(t,e),e=Yc(e.nextSibling)}if(o9(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(ge(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var r=t.data;if(r==="/$"){if(e===0){os=Yc(t.nextSibling);break e}e--}else r!=="$"&&r!=="$!"&&r!=="$?"||e++}t=t.nextSibling}os=null}}else os=ss?Yc(t.stateNode.nextSibling):null;return!0}function _q(){for(var t=os;t;)t=Yc(t.nextSibling)}function Ng(){os=ss=null,gr=!1}function O$(t){Ci===null?Ci=[t]:Ci.push(t)}var qxe=Yl.ReactCurrentBatchConfig;function vi(t,e){if(t&&t.defaultProps){e=Ir({},e),t=t.defaultProps;for(var r in t)e[r]===void 0&&(e[r]=t[r]);return e}return e}var bT=op(null),vT=null,hg=null,F$=null;function P$(){F$=hg=vT=null}function L$(t){var e=bT.current;pr(bT),t._currentValue=e}function JD(t,e,r){for(;t!==null;){var n=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,n!==null&&(n.childLanes|=e)):n!==null&&(n.childLanes&e)!==e&&(n.childLanes|=e),t===r)break;t=t.return}}function Cg(t,e){vT=t,F$=hg=null,t=t.dependencies,t!==null&&t.firstContext!==null&&((t.lanes&e)!==0&&(Lo=!0),t.firstContext=null)}function Us(t){var e=t._currentValue;if(F$!==t)if(t={context:t,memoizedValue:e,next:null},hg===null){if(vT===null)throw Error(ge(308));hg=t,vT.dependencies={lanes:0,firstContext:t}}else hg=hg.next=t;return e}var Hf=null;function M$(t){Hf===null?Hf=[t]:Hf.push(t)}function Aq(t,e,r,n){var o=e.interleaved;return o===null?(r.next=r,M$(e)):(r.next=o.next,o.next=r),e.interleaved=r,Kl(t,n)}function Kl(t,e){t.lanes|=e;var r=t.alternate;for(r!==null&&(r.lanes|=e),r=t,t=t.return;t!==null;)t.childLanes|=e,r=t.alternate,r!==null&&(r.childLanes|=e),r=t,t=t.return;return r.tag===3?r.stateNode:null}var Wc=!1;function z$(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Dq(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function Hl(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Qc(t,e,r){var n=t.updateQueue;if(n===null)return null;if(n=n.shared,(yt&2)!==0){var o=n.pending;return o===null?e.next=e:(e.next=o.next,o.next=e),n.pending=e,Kl(t,r)}return o=n.interleaved,o===null?(e.next=e,M$(n)):(e.next=o.next,o.next=e),n.interleaved=e,Kl(t,r)}function Jk(t,e,r){if(e=e.updateQueue,e!==null&&(e=e.shared,(r&4194240)!==0)){var n=e.lanes;n&=t.pendingLanes,r|=n,e.lanes=r,k$(t,r)}}function s9(t,e){var r=t.updateQueue,n=t.alternate;if(n!==null&&(n=n.updateQueue,r===n)){var o=null,s=null;if(r=r.firstBaseUpdate,r!==null){do{var i={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};s===null?o=s=i:s=s.next=i,r=r.next}while(r!==null);s===null?o=s=e:s=s.next=e}else o=s=e;r={baseState:n.baseState,firstBaseUpdate:o,lastBaseUpdate:s,shared:n.shared,effects:n.effects},t.updateQueue=r;return}t=r.lastBaseUpdate,t===null?r.firstBaseUpdate=e:t.next=e,r.lastBaseUpdate=e}function wT(t,e,r,n){var o=t.updateQueue;Wc=!1;var s=o.firstBaseUpdate,i=o.lastBaseUpdate,a=o.shared.pending;if(a!==null){o.shared.pending=null;var l=a,u=l.next;l.next=null,i===null?s=u:i.next=u,i=l;var c=t.alternate;c!==null&&(c=c.updateQueue,a=c.lastBaseUpdate,a!==i&&(a===null?c.firstBaseUpdate=u:a.next=u,c.lastBaseUpdate=l))}if(s!==null){var p=o.baseState;i=0,c=u=l=null,a=s;do{var f=a.lane,d=a.eventTime;if((n&f)===f){c!==null&&(c=c.next={eventTime:d,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var m=t,h=a;switch(f=e,d=r,h.tag){case 1:if(m=h.payload,typeof m=="function"){p=m.call(d,p,f);break e}p=m;break e;case 3:m.flags=m.flags&-65537|128;case 0:if(m=h.payload,f=typeof m=="function"?m.call(d,p,f):m,f==null)break e;p=Ir({},p,f);break e;case 2:Wc=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,f=o.effects,f===null?o.effects=[a]:f.push(a))}else d={eventTime:d,lane:f,tag:a.tag,payload:a.payload,callback:a.callback,next:null},c===null?(u=c=d,l=p):c=c.next=d,i|=f;if(a=a.next,a===null){if(a=o.shared.pending,a===null)break;f=a,a=f.next,f.next=null,o.lastBaseUpdate=f,o.shared.pending=null}}while(1);if(c===null&&(l=p),o.baseState=l,o.firstBaseUpdate=u,o.lastBaseUpdate=c,e=o.shared.interleaved,e!==null){o=e;do i|=o.lane,o=o.next;while(o!==e)}else s===null&&(o.shared.lanes=0);Zf|=i,t.lanes=i,t.memoizedState=p}}function i9(t,e,r){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var n=t[e],o=n.callback;if(o!==null){if(n.callback=null,n=r,typeof o!="function")throw Error(ge(191,o));o.call(n)}}}var $q=new A9.Component().refs;function e$(t,e,r,n){e=t.memoizedState,r=r(n,e),r=r==null?e:Ir({},e,r),t.memoizedState=r,t.lanes===0&&(t.updateQueue.baseState=r)}var PT={isMounted:function(t){return(t=t._reactInternals)?td(t)===t:!1},enqueueSetState:function(t,e,r){t=t._reactInternals;var n=ho(),o=Jc(t),s=Hl(n,o);s.payload=e,r!=null&&(s.callback=r),e=Qc(t,s,o),e!==null&&(ki(e,t,o,n),Jk(e,t,o))},enqueueReplaceState:function(t,e,r){t=t._reactInternals;var n=ho(),o=Jc(t),s=Hl(n,o);s.tag=1,s.payload=e,r!=null&&(s.callback=r),e=Qc(t,s,o),e!==null&&(ki(e,t,o,n),Jk(e,t,o))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var r=ho(),n=Jc(t),o=Hl(r,n);o.tag=2,e!=null&&(o.callback=e),e=Qc(t,o,n),e!==null&&(ki(e,t,n,r),Jk(e,t,n))}};function a9(t,e,r,n,o,s,i){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(n,s,i):e.prototype&&e.prototype.isPureReactComponent?!Eb(r,n)||!Eb(o,s):!0}function Rq(t,e,r){var n=!1,o=rp,s=e.contextType;return typeof s=="object"&&s!==null?s=Us(s):(o=zo(e)?Xf:no.current,n=e.contextTypes,s=(n=n!=null)?Tg(t,o):rp),e=new e(r,s),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=PT,t.stateNode=e,e._reactInternals=t,n&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=o,t.__reactInternalMemoizedMaskedChildContext=s),e}function l9(t,e,r,n){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(r,n),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(r,n),e.state!==t&&PT.enqueueReplaceState(e,e.state,null)}function t$(t,e,r,n){var o=t.stateNode;o.props=r,o.state=t.memoizedState,o.refs=$q,z$(t);var s=e.contextType;typeof s=="object"&&s!==null?o.context=Us(s):(s=zo(e)?Xf:no.current,o.context=Tg(t,s)),o.state=t.memoizedState,s=e.getDerivedStateFromProps,typeof s=="function"&&(e$(t,e,s,r),o.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof o.getSnapshotBeforeUpdate=="function"||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(e=o.state,typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount(),e!==o.state&&PT.enqueueReplaceState(o,o.state,null),wT(t,r,o,n),o.state=t.memoizedState),typeof o.componentDidMount=="function"&&(t.flags|=4194308)}function ob(t,e,r){if(t=r.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(r._owner){if(r=r._owner,r){if(r.tag!==1)throw Error(ge(309));var n=r.stateNode}if(!n)throw Error(ge(147,t));var o=n,s=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===s?e.ref:(e=function(i){var a=o.refs;a===$q&&(a=o.refs={}),i===null?delete a[s]:a[s]=i},e._stringRef=s,e)}if(typeof t!="string")throw Error(ge(284));if(!r._owner)throw Error(ge(290,t))}return t}function qk(t,e){throw t=Object.prototype.toString.call(e),Error(ge(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function u9(t){var e=t._init;return e(t._payload)}function Oq(t){function e(x,y){if(t){var b=x.deletions;b===null?(x.deletions=[y],x.flags|=16):b.push(y)}}function r(x,y){if(!t)return null;for(;y!==null;)e(x,y),y=y.sibling;return null}function n(x,y){for(x=new Map;y!==null;)y.key!==null?x.set(y.key,y):x.set(y.index,y),y=y.sibling;return x}function o(x,y){return x=ep(x,y),x.index=0,x.sibling=null,x}function s(x,y,b){return x.index=b,t?(b=x.alternate,b!==null?(b=b.index,b<y?(x.flags|=2,y):b):(x.flags|=2,y)):(x.flags|=1048576,y)}function i(x){return t&&x.alternate===null&&(x.flags|=2),x}function a(x,y,b,v){return y===null||y.tag!==6?(y=CD(b,x.mode,v),y.return=x,y):(y=o(y,b),y.return=x,y)}function l(x,y,b,v){var C=b.type;return C===ag?c(x,y,b.props.children,v,b.key):y!==null&&(y.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===Vc&&u9(C)===y.type)?(v=o(y,b.props),v.ref=ob(x,y,b),v.return=x,v):(v=sT(b.type,b.key,b.props,null,x.mode,v),v.ref=ob(x,y,b),v.return=x,v)}function u(x,y,b,v){return y===null||y.tag!==4||y.stateNode.containerInfo!==b.containerInfo||y.stateNode.implementation!==b.implementation?(y=SD(b,x.mode,v),y.return=x,y):(y=o(y,b.children||[]),y.return=x,y)}function c(x,y,b,v,C){return y===null||y.tag!==7?(y=Kf(b,x.mode,v,C),y.return=x,y):(y=o(y,b),y.return=x,y)}function p(x,y,b){if(typeof y=="string"&&y!==""||typeof y=="number")return y=CD(""+y,x.mode,b),y.return=x,y;if(typeof y=="object"&&y!==null){switch(y.$$typeof){case Dk:return b=sT(y.type,y.key,y.props,null,x.mode,b),b.ref=ob(x,null,y),b.return=x,b;case ig:return y=SD(y,x.mode,b),y.return=x,y;case Vc:var v=y._init;return p(x,v(y._payload),b)}if(ub(y)||eb(y))return y=Kf(y,x.mode,b,null),y.return=x,y;qk(x,y)}return null}function f(x,y,b,v){var C=y!==null?y.key:null;if(typeof b=="string"&&b!==""||typeof b=="number")return C!==null?null:a(x,y,""+b,v);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case Dk:return b.key===C?l(x,y,b,v):null;case ig:return b.key===C?u(x,y,b,v):null;case Vc:return C=b._init,f(x,y,C(b._payload),v)}if(ub(b)||eb(b))return C!==null?null:c(x,y,b,v,null);qk(x,b)}return null}function d(x,y,b,v,C){if(typeof v=="string"&&v!==""||typeof v=="number")return x=x.get(b)||null,a(y,x,""+v,C);if(typeof v=="object"&&v!==null){switch(v.$$typeof){case Dk:return x=x.get(v.key===null?b:v.key)||null,l(y,x,v,C);case ig:return x=x.get(v.key===null?b:v.key)||null,u(y,x,v,C);case Vc:var S=v._init;return d(x,y,b,S(v._payload),C)}if(ub(v)||eb(v))return x=x.get(b)||null,c(y,x,v,C,null);qk(y,v)}return null}function m(x,y,b,v){for(var C=null,S=null,k=y,N=y=0,D=null;k!==null&&N<b.length;N++){k.index>N?(D=k,k=null):D=k.sibling;var $=f(x,k,b[N],v);if($===null){k===null&&(k=D);break}t&&k&&$.alternate===null&&e(x,k),y=s($,y,N),S===null?C=$:S.sibling=$,S=$,k=D}if(N===b.length)return r(x,k),gr&&Wf(x,N),C;if(k===null){for(;N<b.length;N++)k=p(x,b[N],v),k!==null&&(y=s(k,y,N),S===null?C=k:S.sibling=k,S=k);return gr&&Wf(x,N),C}for(k=n(x,k);N<b.length;N++)D=d(k,x,N,b[N],v),D!==null&&(t&&D.alternate!==null&&k.delete(D.key===null?N:D.key),y=s(D,y,N),S===null?C=D:S.sibling=D,S=D);return t&&k.forEach(function(O){return e(x,O)}),gr&&Wf(x,N),C}function h(x,y,b,v){var C=eb(b);if(typeof C!="function")throw Error(ge(150));if(b=C.call(b),b==null)throw Error(ge(151));for(var S=C=null,k=y,N=y=0,D=null,$=b.next();k!==null&&!$.done;N++,$=b.next()){k.index>N?(D=k,k=null):D=k.sibling;var O=f(x,k,$.value,v);if(O===null){k===null&&(k=D);break}t&&k&&O.alternate===null&&e(x,k),y=s(O,y,N),S===null?C=O:S.sibling=O,S=O,k=D}if($.done)return r(x,k),gr&&Wf(x,N),C;if(k===null){for(;!$.done;N++,$=b.next())$=p(x,$.value,v),$!==null&&(y=s($,y,N),S===null?C=$:S.sibling=$,S=$);return gr&&Wf(x,N),C}for(k=n(x,k);!$.done;N++,$=b.next())$=d(k,x,N,$.value,v),$!==null&&(t&&$.alternate!==null&&k.delete($.key===null?N:$.key),y=s($,y,N),S===null?C=$:S.sibling=$,S=$);return t&&k.forEach(function(V){return e(x,V)}),gr&&Wf(x,N),C}function g(x,y,b,v){if(typeof b=="object"&&b!==null&&b.type===ag&&b.key===null&&(b=b.props.children),typeof b=="object"&&b!==null){switch(b.$$typeof){case Dk:e:{for(var C=b.key,S=y;S!==null;){if(S.key===C){if(C=b.type,C===ag){if(S.tag===7){r(x,S.sibling),y=o(S,b.props.children),y.return=x,x=y;break e}}else if(S.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===Vc&&u9(C)===S.type){r(x,S.sibling),y=o(S,b.props),y.ref=ob(x,S,b),y.return=x,x=y;break e}r(x,S);break}else e(x,S);S=S.sibling}b.type===ag?(y=Kf(b.props.children,x.mode,v,b.key),y.return=x,x=y):(v=sT(b.type,b.key,b.props,null,x.mode,v),v.ref=ob(x,y,b),v.return=x,x=v)}return i(x);case ig:e:{for(S=b.key;y!==null;){if(y.key===S)if(y.tag===4&&y.stateNode.containerInfo===b.containerInfo&&y.stateNode.implementation===b.implementation){r(x,y.sibling),y=o(y,b.children||[]),y.return=x,x=y;break e}else{r(x,y);break}else e(x,y);y=y.sibling}y=SD(b,x.mode,v),y.return=x,x=y}return i(x);case Vc:return S=b._init,g(x,y,S(b._payload),v)}if(ub(b))return m(x,y,b,v);if(eb(b))return h(x,y,b,v);qk(x,b)}return typeof b=="string"&&b!==""||typeof b=="number"?(b=""+b,y!==null&&y.tag===6?(r(x,y.sibling),y=o(y,b),y.return=x,x=y):(r(x,y),y=CD(b,x.mode,v),y.return=x,x=y),i(x)):r(x,y)}return g}var Ig=Oq(!0),Fq=Oq(!1),Vb={},aa=op(Vb),$b=op(Vb),Rb=op(Vb);function qf(t){if(t===Vb)throw Error(ge(174));return t}function B$(t,e){switch(rr(Rb,e),rr($b,t),rr(aa,Vb),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:RD(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=RD(e,t)}pr(aa),rr(aa,e)}function Eg(){pr(aa),pr($b),pr(Rb)}function Pq(t){qf(Rb.current);var e=qf(aa.current),r=RD(e,t.type);e!==r&&(rr($b,t),rr(aa,r))}function V$(t){$b.current===t&&(pr(aa),pr($b))}var Tr=op(0);function CT(t){for(var e=t;e!==null;){if(e.tag===13){var r=e.memoizedState;if(r!==null&&(r=r.dehydrated,r===null||r.data==="$?"||r.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if((e.flags&128)!==0)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var gD=[];function W$(){for(var t=0;t<gD.length;t++)gD[t]._workInProgressVersionPrimary=null;gD.length=0}var eT=Yl.ReactCurrentDispatcher,xD=Yl.ReactCurrentBatchConfig,Qf=0,Nr=null,pn=null,Tn=null,ST=!1,xb=!1,Ob=0,jxe=0;function eo(){throw Error(ge(321))}function G$(t,e){if(e===null)return!1;for(var r=0;r<e.length&&r<t.length;r++)if(!Ti(t[r],e[r]))return!1;return!0}function U$(t,e,r,n,o,s){if(Qf=s,Nr=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,eT.current=t===null||t.memoizedState===null?Qxe:Zxe,t=r(n,o),xb){s=0;do{if(xb=!1,Ob=0,25<=s)throw Error(ge(301));s+=1,Tn=pn=null,e.updateQueue=null,eT.current=Jxe,t=r(n,o)}while(xb)}if(eT.current=kT,e=pn!==null&&pn.next!==null,Qf=0,Tn=pn=Nr=null,ST=!1,e)throw Error(ge(300));return t}function H$(){var t=Ob!==0;return Ob=0,t}function oa(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Tn===null?Nr.memoizedState=Tn=t:Tn=Tn.next=t,Tn}function Hs(){if(pn===null){var t=Nr.alternate;t=t!==null?t.memoizedState:null}else t=pn.next;var e=Tn===null?Nr.memoizedState:Tn.next;if(e!==null)Tn=e,pn=t;else{if(t===null)throw Error(ge(310));pn=t,t={memoizedState:pn.memoizedState,baseState:pn.baseState,baseQueue:pn.baseQueue,queue:pn.queue,next:null},Tn===null?Nr.memoizedState=Tn=t:Tn=Tn.next=t}return Tn}function Fb(t,e){return typeof e=="function"?e(t):e}function yD(t){var e=Hs(),r=e.queue;if(r===null)throw Error(ge(311));r.lastRenderedReducer=t;var n=pn,o=n.baseQueue,s=r.pending;if(s!==null){if(o!==null){var i=o.next;o.next=s.next,s.next=i}n.baseQueue=o=s,r.pending=null}if(o!==null){s=o.next,n=n.baseState;var a=i=null,l=null,u=s;do{var c=u.lane;if((Qf&c)===c)l!==null&&(l=l.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),n=u.hasEagerState?u.eagerState:t(n,u.action);else{var p={lane:c,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};l===null?(a=l=p,i=n):l=l.next=p,Nr.lanes|=c,Zf|=c}u=u.next}while(u!==null&&u!==s);l===null?i=n:l.next=a,Ti(n,e.memoizedState)||(Lo=!0),e.memoizedState=n,e.baseState=i,e.baseQueue=l,r.lastRenderedState=n}if(t=r.interleaved,t!==null){o=t;do s=o.lane,Nr.lanes|=s,Zf|=s,o=o.next;while(o!==t)}else o===null&&(r.lanes=0);return[e.memoizedState,r.dispatch]}function bD(t){var e=Hs(),r=e.queue;if(r===null)throw Error(ge(311));r.lastRenderedReducer=t;var n=r.dispatch,o=r.pending,s=e.memoizedState;if(o!==null){r.pending=null;var i=o=o.next;do s=t(s,i.action),i=i.next;while(i!==o);Ti(s,e.memoizedState)||(Lo=!0),e.memoizedState=s,e.baseQueue===null&&(e.baseState=s),r.lastRenderedState=s}return[s,n]}function Lq(){}function Mq(t,e){var r=Nr,n=Hs(),o=e(),s=!Ti(n.memoizedState,o);if(s&&(n.memoizedState=o,Lo=!0),n=n.queue,q$(Vq.bind(null,r,n,t),[t]),n.getSnapshot!==e||s||Tn!==null&&Tn.memoizedState.tag&1){if(r.flags|=2048,Pb(9,Bq.bind(null,r,n,o,e),void 0,null),Nn===null)throw Error(ge(349));(Qf&30)!==0||zq(r,e,o)}return o}function zq(t,e,r){t.flags|=16384,t={getSnapshot:e,value:r},e=Nr.updateQueue,e===null?(e={lastEffect:null,stores:null},Nr.updateQueue=e,e.stores=[t]):(r=e.stores,r===null?e.stores=[t]:r.push(t))}function Bq(t,e,r,n){e.value=r,e.getSnapshot=n,Wq(e)&&Gq(t)}function Vq(t,e,r){return r(function(){Wq(e)&&Gq(t)})}function Wq(t){var e=t.getSnapshot;t=t.value;try{var r=e();return!Ti(t,r)}catch{return!0}}function Gq(t){var e=Kl(t,1);e!==null&&ki(e,t,1,-1)}function c9(t){var e=oa();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Fb,lastRenderedState:t},e.queue=t,t=t.dispatch=Yxe.bind(null,Nr,t),[e.memoizedState,t]}function Pb(t,e,r,n){return t={tag:t,create:e,destroy:r,deps:n,next:null},e=Nr.updateQueue,e===null?(e={lastEffect:null,stores:null},Nr.updateQueue=e,e.lastEffect=t.next=t):(r=e.lastEffect,r===null?e.lastEffect=t.next=t:(n=r.next,r.next=t,t.next=n,e.lastEffect=t)),t}function Uq(){return Hs().memoizedState}function tT(t,e,r,n){var o=oa();Nr.flags|=t,o.memoizedState=Pb(1|e,r,void 0,n===void 0?null:n)}function LT(t,e,r,n){var o=Hs();n=n===void 0?null:n;var s=void 0;if(pn!==null){var i=pn.memoizedState;if(s=i.destroy,n!==null&&G$(n,i.deps)){o.memoizedState=Pb(e,r,s,n);return}}Nr.flags|=t,o.memoizedState=Pb(1|e,r,s,n)}function p9(t,e){return tT(8390656,8,t,e)}function q$(t,e){return LT(2048,8,t,e)}function Hq(t,e){return LT(4,2,t,e)}function qq(t,e){return LT(4,4,t,e)}function jq(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function Kq(t,e,r){return r=r!=null?r.concat([t]):null,LT(4,4,jq.bind(null,e,t),r)}function j$(){}function Xq(t,e){var r=Hs();e=e===void 0?null:e;var n=r.memoizedState;return n!==null&&e!==null&&G$(e,n[1])?n[0]:(r.memoizedState=[t,e],t)}function Yq(t,e){var r=Hs();e=e===void 0?null:e;var n=r.memoizedState;return n!==null&&e!==null&&G$(e,n[1])?n[0]:(t=t(),r.memoizedState=[t,e],t)}function Qq(t,e,r){return(Qf&21)===0?(t.baseState&&(t.baseState=!1,Lo=!0),t.memoizedState=r):(Ti(r,e)||(r=eq(),Nr.lanes|=r,Zf|=r,t.baseState=!0),e)}function Kxe(t,e){var r=Lt;Lt=r!==0&&4>r?r:4,t(!0);var n=xD.transition;xD.transition={};try{t(!1),e()}finally{Lt=r,xD.transition=n}}function Zq(){return Hs().memoizedState}function Xxe(t,e,r){var n=Jc(t);if(r={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null},Jq(t))ej(e,r);else if(r=Aq(t,e,r,n),r!==null){var o=ho();ki(r,t,n,o),tj(r,e,n)}}function Yxe(t,e,r){var n=Jc(t),o={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null};if(Jq(t))ej(e,o);else{var s=t.alternate;if(t.lanes===0&&(s===null||s.lanes===0)&&(s=e.lastRenderedReducer,s!==null))try{var i=e.lastRenderedState,a=s(i,r);if(o.hasEagerState=!0,o.eagerState=a,Ti(a,i)){var l=e.interleaved;l===null?(o.next=o,M$(e)):(o.next=l.next,l.next=o),e.interleaved=o;return}}catch{}finally{}r=Aq(t,e,o,n),r!==null&&(o=ho(),ki(r,t,n,o),tj(r,e,n))}}function Jq(t){var e=t.alternate;return t===Nr||e!==null&&e===Nr}function ej(t,e){xb=ST=!0;var r=t.pending;r===null?e.next=e:(e.next=r.next,r.next=e),t.pending=e}function tj(t,e,r){if((r&4194240)!==0){var n=e.lanes;n&=t.pendingLanes,r|=n,e.lanes=r,k$(t,r)}}var kT={readContext:Us,useCallback:eo,useContext:eo,useEffect:eo,useImperativeHandle:eo,useInsertionEffect:eo,useLayoutEffect:eo,useMemo:eo,useReducer:eo,useRef:eo,useState:eo,useDebugValue:eo,useDeferredValue:eo,useTransition:eo,useMutableSource:eo,useSyncExternalStore:eo,useId:eo,unstable_isNewReconciler:!1},Qxe={readContext:Us,useCallback:function(t,e){return oa().memoizedState=[t,e===void 0?null:e],t},useContext:Us,useEffect:p9,useImperativeHandle:function(t,e,r){return r=r!=null?r.concat([t]):null,tT(4194308,4,jq.bind(null,e,t),r)},useLayoutEffect:function(t,e){return tT(4194308,4,t,e)},useInsertionEffect:function(t,e){return tT(4,2,t,e)},useMemo:function(t,e){var r=oa();return e=e===void 0?null:e,t=t(),r.memoizedState=[t,e],t},useReducer:function(t,e,r){var n=oa();return e=r!==void 0?r(e):e,n.memoizedState=n.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},n.queue=t,t=t.dispatch=Xxe.bind(null,Nr,t),[n.memoizedState,t]},useRef:function(t){var e=oa();return t={current:t},e.memoizedState=t},useState:c9,useDebugValue:j$,useDeferredValue:function(t){return oa().memoizedState=t},useTransition:function(){var t=c9(!1),e=t[0];return t=Kxe.bind(null,t[1]),oa().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,r){var n=Nr,o=oa();if(gr){if(r===void 0)throw Error(ge(407));r=r()}else{if(r=e(),Nn===null)throw Error(ge(349));(Qf&30)!==0||zq(n,e,r)}o.memoizedState=r;var s={value:r,getSnapshot:e};return o.queue=s,p9(Vq.bind(null,n,s,t),[t]),n.flags|=2048,Pb(9,Bq.bind(null,n,s,r,e),void 0,null),r},useId:function(){var t=oa(),e=Nn.identifierPrefix;if(gr){var r=Ul,n=Gl;r=(n&~(1<<32-Si(n)-1)).toString(32)+r,e=":"+e+"R"+r,r=Ob++,0<r&&(e+="H"+r.toString(32)),e+=":"}else r=jxe++,e=":"+e+"r"+r.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},Zxe={readContext:Us,useCallback:Xq,useContext:Us,useEffect:q$,useImperativeHandle:Kq,useInsertionEffect:Hq,useLayoutEffect:qq,useMemo:Yq,useReducer:yD,useRef:Uq,useState:function(){return yD(Fb)},useDebugValue:j$,useDeferredValue:function(t){var e=Hs();return Qq(e,pn.memoizedState,t)},useTransition:function(){var t=yD(Fb)[0],e=Hs().memoizedState;return[t,e]},useMutableSource:Lq,useSyncExternalStore:Mq,useId:Zq,unstable_isNewReconciler:!1},Jxe={readContext:Us,useCallback:Xq,useContext:Us,useEffect:q$,useImperativeHandle:Kq,useInsertionEffect:Hq,useLayoutEffect:qq,useMemo:Yq,useReducer:bD,useRef:Uq,useState:function(){return bD(Fb)},useDebugValue:j$,useDeferredValue:function(t){var e=Hs();return pn===null?e.memoizedState=t:Qq(e,pn.memoizedState,t)},useTransition:function(){var t=bD(Fb)[0],e=Hs().memoizedState;return[t,e]},useMutableSource:Lq,useSyncExternalStore:Mq,useId:Zq,unstable_isNewReconciler:!1};function _g(t,e){try{var r="",n=e;do r+=_ge(n),n=n.return;while(n);var o=r}catch(s){o=`
Error generating stack: `+s.message+`
`+s.stack}return{value:t,source:e,stack:o,digest:null}}function vD(t,e,r){return{value:t,source:null,stack:r??null,digest:e??null}}function r$(t,e){try{console.error(e.value)}catch(r){setTimeout(function(){throw r})}}var eye=typeof WeakMap=="function"?WeakMap:Map;function rj(t,e,r){r=Hl(-1,r),r.tag=3,r.payload={element:null};var n=e.value;return r.callback=function(){NT||(NT=!0,f$=n),r$(t,e)},r}function nj(t,e,r){r=Hl(-1,r),r.tag=3;var n=t.type.getDerivedStateFromError;if(typeof n=="function"){var o=e.value;r.payload=function(){return n(o)},r.callback=function(){r$(t,e)}}var s=t.stateNode;return s!==null&&typeof s.componentDidCatch=="function"&&(r.callback=function(){r$(t,e),typeof n!="function"&&(Zc===null?Zc=new Set([this]):Zc.add(this));var i=e.stack;this.componentDidCatch(e.value,{componentStack:i!==null?i:""})}),r}function f9(t,e,r){var n=t.pingCache;if(n===null){n=t.pingCache=new eye;var o=new Set;n.set(e,o)}else o=n.get(e),o===void 0&&(o=new Set,n.set(e,o));o.has(r)||(o.add(r),t=mye.bind(null,t,e,r),e.then(t,t))}function d9(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function m9(t,e,r,n,o){return(t.mode&1)===0?(t===e?t.flags|=65536:(t.flags|=128,r.flags|=131072,r.flags&=-52805,r.tag===1&&(r.alternate===null?r.tag=17:(e=Hl(-1,1),e.tag=2,Qc(r,e,1))),r.lanes|=1),t):(t.flags|=65536,t.lanes=o,t)}var tye=Yl.ReactCurrentOwner,Lo=!1;function mo(t,e,r,n){e.child=t===null?Fq(e,null,r,n):Ig(e,t.child,r,n)}function h9(t,e,r,n,o){r=r.render;var s=e.ref;return Cg(e,o),n=U$(t,e,r,n,s,o),r=H$(),t!==null&&!Lo?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~o,Xl(t,e,o)):(gr&&r&&$$(e),e.flags|=1,mo(t,e,n,o),e.child)}function g9(t,e,r,n,o){if(t===null){var s=r.type;return typeof s=="function"&&!tR(s)&&s.defaultProps===void 0&&r.compare===null&&r.defaultProps===void 0?(e.tag=15,e.type=s,oj(t,e,s,n,o)):(t=sT(r.type,null,n,e,e.mode,o),t.ref=e.ref,t.return=e,e.child=t)}if(s=t.child,(t.lanes&o)===0){var i=s.memoizedProps;if(r=r.compare,r=r!==null?r:Eb,r(i,n)&&t.ref===e.ref)return Xl(t,e,o)}return e.flags|=1,t=ep(s,n),t.ref=e.ref,t.return=e,e.child=t}function oj(t,e,r,n,o){if(t!==null){var s=t.memoizedProps;if(Eb(s,n)&&t.ref===e.ref)if(Lo=!1,e.pendingProps=n=s,(t.lanes&o)!==0)(t.flags&131072)!==0&&(Lo=!0);else return e.lanes=t.lanes,Xl(t,e,o)}return n$(t,e,r,n,o)}function sj(t,e,r){var n=e.pendingProps,o=n.children,s=t!==null?t.memoizedState:null;if(n.mode==="hidden")if((e.mode&1)===0)e.memoizedState={baseLanes:0,cachePool:null,transitions:null},rr(xg,ns),ns|=r;else{if((r&1073741824)===0)return t=s!==null?s.baseLanes|r:r,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,rr(xg,ns),ns|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=s!==null?s.baseLanes:r,rr(xg,ns),ns|=n}else s!==null?(n=s.baseLanes|r,e.memoizedState=null):n=r,rr(xg,ns),ns|=n;return mo(t,e,o,r),e.child}function ij(t,e){var r=e.ref;(t===null&&r!==null||t!==null&&t.ref!==r)&&(e.flags|=512,e.flags|=2097152)}function n$(t,e,r,n,o){var s=zo(r)?Xf:no.current;return s=Tg(e,s),Cg(e,o),r=U$(t,e,r,n,s,o),n=H$(),t!==null&&!Lo?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~o,Xl(t,e,o)):(gr&&n&&$$(e),e.flags|=1,mo(t,e,r,o),e.child)}function x9(t,e,r,n,o){if(zo(r)){var s=!0;gT(e)}else s=!1;if(Cg(e,o),e.stateNode===null)rT(t,e),Rq(e,r,n),t$(e,r,n,o),n=!0;else if(t===null){var i=e.stateNode,a=e.memoizedProps;i.props=a;var l=i.context,u=r.contextType;typeof u=="object"&&u!==null?u=Us(u):(u=zo(r)?Xf:no.current,u=Tg(e,u));var c=r.getDerivedStateFromProps,p=typeof c=="function"||typeof i.getSnapshotBeforeUpdate=="function";p||typeof i.UNSAFE_componentWillReceiveProps!="function"&&typeof i.componentWillReceiveProps!="function"||(a!==n||l!==u)&&l9(e,i,n,u),Wc=!1;var f=e.memoizedState;i.state=f,wT(e,n,i,o),l=e.memoizedState,a!==n||f!==l||Mo.current||Wc?(typeof c=="function"&&(e$(e,r,c,n),l=e.memoizedState),(a=Wc||a9(e,r,a,n,f,l,u))?(p||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount()),typeof i.componentDidMount=="function"&&(e.flags|=4194308)):(typeof i.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=n,e.memoizedState=l),i.props=n,i.state=l,i.context=u,n=a):(typeof i.componentDidMount=="function"&&(e.flags|=4194308),n=!1)}else{i=e.stateNode,Dq(t,e),a=e.memoizedProps,u=e.type===e.elementType?a:vi(e.type,a),i.props=u,p=e.pendingProps,f=i.context,l=r.contextType,typeof l=="object"&&l!==null?l=Us(l):(l=zo(r)?Xf:no.current,l=Tg(e,l));var d=r.getDerivedStateFromProps;(c=typeof d=="function"||typeof i.getSnapshotBeforeUpdate=="function")||typeof i.UNSAFE_componentWillReceiveProps!="function"&&typeof i.componentWillReceiveProps!="function"||(a!==p||f!==l)&&l9(e,i,n,l),Wc=!1,f=e.memoizedState,i.state=f,wT(e,n,i,o);var m=e.memoizedState;a!==p||f!==m||Mo.current||Wc?(typeof d=="function"&&(e$(e,r,d,n),m=e.memoizedState),(u=Wc||a9(e,r,u,n,f,m,l)||!1)?(c||typeof i.UNSAFE_componentWillUpdate!="function"&&typeof i.componentWillUpdate!="function"||(typeof i.componentWillUpdate=="function"&&i.componentWillUpdate(n,m,l),typeof i.UNSAFE_componentWillUpdate=="function"&&i.UNSAFE_componentWillUpdate(n,m,l)),typeof i.componentDidUpdate=="function"&&(e.flags|=4),typeof i.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof i.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof i.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),e.memoizedProps=n,e.memoizedState=m),i.props=n,i.state=m,i.context=l,n=u):(typeof i.componentDidUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=4),typeof i.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&f===t.memoizedState||(e.flags|=1024),n=!1)}return o$(t,e,r,n,s,o)}function o$(t,e,r,n,o,s){ij(t,e);var i=(e.flags&128)!==0;if(!n&&!i)return o&&r9(e,r,!1),Xl(t,e,s);n=e.stateNode,tye.current=e;var a=i&&typeof r.getDerivedStateFromError!="function"?null:n.render();return e.flags|=1,t!==null&&i?(e.child=Ig(e,t.child,null,s),e.child=Ig(e,null,a,s)):mo(t,e,a,s),e.memoizedState=n.state,o&&r9(e,r,!0),e.child}function aj(t){var e=t.stateNode;e.pendingContext?t9(t,e.pendingContext,e.pendingContext!==e.context):e.context&&t9(t,e.context,!1),B$(t,e.containerInfo)}function y9(t,e,r,n,o){return Ng(),O$(o),e.flags|=256,mo(t,e,r,n),e.child}var s$={dehydrated:null,treeContext:null,retryLane:0};function i$(t){return{baseLanes:t,cachePool:null,transitions:null}}function lj(t,e,r){var n=e.pendingProps,o=Tr.current,s=!1,i=(e.flags&128)!==0,a;if((a=i)||(a=t!==null&&t.memoizedState===null?!1:(o&2)!==0),a?(s=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(o|=1),rr(Tr,o&1),t===null)return ZD(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?((e.mode&1)===0?e.lanes=1:t.data==="$!"?e.lanes=8:e.lanes=1073741824,null):(i=n.children,t=n.fallback,s?(n=e.mode,s=e.child,i={mode:"hidden",children:i},(n&1)===0&&s!==null?(s.childLanes=0,s.pendingProps=i):s=BT(i,n,0,null),t=Kf(t,n,r,null),s.return=e,t.return=e,s.sibling=t,e.child=s,e.child.memoizedState=i$(r),e.memoizedState=s$,t):K$(e,i));if(o=t.memoizedState,o!==null&&(a=o.dehydrated,a!==null))return rye(t,e,i,n,a,o,r);if(s){s=n.fallback,i=e.mode,o=t.child,a=o.sibling;var l={mode:"hidden",children:n.children};return(i&1)===0&&e.child!==o?(n=e.child,n.childLanes=0,n.pendingProps=l,e.deletions=null):(n=ep(o,l),n.subtreeFlags=o.subtreeFlags&14680064),a!==null?s=ep(a,s):(s=Kf(s,i,r,null),s.flags|=2),s.return=e,n.return=e,n.sibling=s,e.child=n,n=s,s=e.child,i=t.child.memoizedState,i=i===null?i$(r):{baseLanes:i.baseLanes|r,cachePool:null,transitions:i.transitions},s.memoizedState=i,s.childLanes=t.childLanes&~r,e.memoizedState=s$,n}return s=t.child,t=s.sibling,n=ep(s,{mode:"visible",children:n.children}),(e.mode&1)===0&&(n.lanes=r),n.return=e,n.sibling=null,t!==null&&(r=e.deletions,r===null?(e.deletions=[t],e.flags|=16):r.push(t)),e.child=n,e.memoizedState=null,n}function K$(t,e){return e=BT({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function jk(t,e,r,n){return n!==null&&O$(n),Ig(e,t.child,null,r),t=K$(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function rye(t,e,r,n,o,s,i){if(r)return e.flags&256?(e.flags&=-257,n=vD(Error(ge(422))),jk(t,e,i,n)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(s=n.fallback,o=e.mode,n=BT({mode:"visible",children:n.children},o,0,null),s=Kf(s,o,i,null),s.flags|=2,n.return=e,s.return=e,n.sibling=s,e.child=n,(e.mode&1)!==0&&Ig(e,t.child,null,i),e.child.memoizedState=i$(i),e.memoizedState=s$,s);if((e.mode&1)===0)return jk(t,e,i,null);if(o.data==="$!"){if(n=o.nextSibling&&o.nextSibling.dataset,n)var a=n.dgst;return n=a,s=Error(ge(419)),n=vD(s,n,void 0),jk(t,e,i,n)}if(a=(i&t.childLanes)!==0,Lo||a){if(n=Nn,n!==null){switch(i&-i){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}o=(o&(n.suspendedLanes|i))!==0?0:o,o!==0&&o!==s.retryLane&&(s.retryLane=o,Kl(t,o),ki(n,t,o,-1))}return eR(),n=vD(Error(ge(421))),jk(t,e,i,n)}return o.data==="$?"?(e.flags|=128,e.child=t.child,e=hye.bind(null,t),o._reactRetry=e,null):(t=s.treeContext,os=Yc(o.nextSibling),ss=e,gr=!0,Ci=null,t!==null&&(Bs[Vs++]=Gl,Bs[Vs++]=Ul,Bs[Vs++]=Yf,Gl=t.id,Ul=t.overflow,Yf=e),e=K$(e,n.children),e.flags|=4096,e)}function b9(t,e,r){t.lanes|=e;var n=t.alternate;n!==null&&(n.lanes|=e),JD(t.return,e,r)}function wD(t,e,r,n,o){var s=t.memoizedState;s===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:o}:(s.isBackwards=e,s.rendering=null,s.renderingStartTime=0,s.last=n,s.tail=r,s.tailMode=o)}function uj(t,e,r){var n=e.pendingProps,o=n.revealOrder,s=n.tail;if(mo(t,e,n.children,r),n=Tr.current,(n&2)!==0)n=n&1|2,e.flags|=128;else{if(t!==null&&(t.flags&128)!==0)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&b9(t,r,e);else if(t.tag===19)b9(t,r,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}n&=1}if(rr(Tr,n),(e.mode&1)===0)e.memoizedState=null;else switch(o){case"forwards":for(r=e.child,o=null;r!==null;)t=r.alternate,t!==null&&CT(t)===null&&(o=r),r=r.sibling;r=o,r===null?(o=e.child,e.child=null):(o=r.sibling,r.sibling=null),wD(e,!1,o,r,s);break;case"backwards":for(r=null,o=e.child,e.child=null;o!==null;){if(t=o.alternate,t!==null&&CT(t)===null){e.child=o;break}t=o.sibling,o.sibling=r,r=o,o=t}wD(e,!0,r,null,s);break;case"together":wD(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function rT(t,e){(e.mode&1)===0&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Xl(t,e,r){if(t!==null&&(e.dependencies=t.dependencies),Zf|=e.lanes,(r&e.childLanes)===0)return null;if(t!==null&&e.child!==t.child)throw Error(ge(153));if(e.child!==null){for(t=e.child,r=ep(t,t.pendingProps),e.child=r,r.return=e;t.sibling!==null;)t=t.sibling,r=r.sibling=ep(t,t.pendingProps),r.return=e;r.sibling=null}return e.child}function nye(t,e,r){switch(e.tag){case 3:aj(e),Ng();break;case 5:Pq(e);break;case 1:zo(e.type)&&gT(e);break;case 4:B$(e,e.stateNode.containerInfo);break;case 10:var n=e.type._context,o=e.memoizedProps.value;rr(bT,n._currentValue),n._currentValue=o;break;case 13:if(n=e.memoizedState,n!==null)return n.dehydrated!==null?(rr(Tr,Tr.current&1),e.flags|=128,null):(r&e.child.childLanes)!==0?lj(t,e,r):(rr(Tr,Tr.current&1),t=Xl(t,e,r),t!==null?t.sibling:null);rr(Tr,Tr.current&1);break;case 19:if(n=(r&e.childLanes)!==0,(t.flags&128)!==0){if(n)return uj(t,e,r);e.flags|=128}if(o=e.memoizedState,o!==null&&(o.rendering=null,o.tail=null,o.lastEffect=null),rr(Tr,Tr.current),n)break;return null;case 22:case 23:return e.lanes=0,sj(t,e,r)}return Xl(t,e,r)}var cj,a$,pj,fj;cj=function(t,e){for(var r=e.child;r!==null;){if(r.tag===5||r.tag===6)t.appendChild(r.stateNode);else if(r.tag!==4&&r.child!==null){r.child.return=r,r=r.child;continue}if(r===e)break;for(;r.sibling===null;){if(r.return===null||r.return===e)return;r=r.return}r.sibling.return=r.return,r=r.sibling}};a$=function(){};pj=function(t,e,r,n){var o=t.memoizedProps;if(o!==n){t=e.stateNode,qf(aa.current);var s=null;switch(r){case"input":o=_D(t,o),n=_D(t,n),s=[];break;case"select":o=Ir({},o,{value:void 0}),n=Ir({},n,{value:void 0}),s=[];break;case"textarea":o=$D(t,o),n=$D(t,n),s=[];break;default:typeof o.onClick!="function"&&typeof n.onClick=="function"&&(t.onclick=mT)}OD(r,n);var i;r=null;for(u in o)if(!n.hasOwnProperty(u)&&o.hasOwnProperty(u)&&o[u]!=null)if(u==="style"){var a=o[u];for(i in a)a.hasOwnProperty(i)&&(r||(r={}),r[i]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(wb.hasOwnProperty(u)?s||(s=[]):(s=s||[]).push(u,null));for(u in n){var l=n[u];if(a=o?.[u],n.hasOwnProperty(u)&&l!==a&&(l!=null||a!=null))if(u==="style")if(a){for(i in a)!a.hasOwnProperty(i)||l&&l.hasOwnProperty(i)||(r||(r={}),r[i]="");for(i in l)l.hasOwnProperty(i)&&a[i]!==l[i]&&(r||(r={}),r[i]=l[i])}else r||(s||(s=[]),s.push(u,r)),r=l;else u==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,a=a?a.__html:void 0,l!=null&&a!==l&&(s=s||[]).push(u,l)):u==="children"?typeof l!="string"&&typeof l!="number"||(s=s||[]).push(u,""+l):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(wb.hasOwnProperty(u)?(l!=null&&u==="onScroll"&&cr("scroll",t),s||a===l||(s=[])):(s=s||[]).push(u,l))}r&&(s=s||[]).push("style",r);var u=s;(e.updateQueue=u)&&(e.flags|=4)}};fj=function(t,e,r,n){r!==n&&(e.flags|=4)};function sb(t,e){if(!gr)switch(t.tailMode){case"hidden":e=t.tail;for(var r=null;e!==null;)e.alternate!==null&&(r=e),e=e.sibling;r===null?t.tail=null:r.sibling=null;break;case"collapsed":r=t.tail;for(var n=null;r!==null;)r.alternate!==null&&(n=r),r=r.sibling;n===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:n.sibling=null}}function to(t){var e=t.alternate!==null&&t.alternate.child===t.child,r=0,n=0;if(e)for(var o=t.child;o!==null;)r|=o.lanes|o.childLanes,n|=o.subtreeFlags&14680064,n|=o.flags&14680064,o.return=t,o=o.sibling;else for(o=t.child;o!==null;)r|=o.lanes|o.childLanes,n|=o.subtreeFlags,n|=o.flags,o.return=t,o=o.sibling;return t.subtreeFlags|=n,t.childLanes=r,e}function oye(t,e,r){var n=e.pendingProps;switch(R$(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return to(e),null;case 1:return zo(e.type)&&hT(),to(e),null;case 3:return n=e.stateNode,Eg(),pr(Mo),pr(no),W$(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(t===null||t.child===null)&&(Hk(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&(e.flags&256)===0||(e.flags|=1024,Ci!==null&&(h$(Ci),Ci=null))),a$(t,e),to(e),null;case 5:V$(e);var o=qf(Rb.current);if(r=e.type,t!==null&&e.stateNode!=null)pj(t,e,r,n,o),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!n){if(e.stateNode===null)throw Error(ge(166));return to(e),null}if(t=qf(aa.current),Hk(e)){n=e.stateNode,r=e.type;var s=e.memoizedProps;switch(n[sa]=e,n[Db]=s,t=(e.mode&1)!==0,r){case"dialog":cr("cancel",n),cr("close",n);break;case"iframe":case"object":case"embed":cr("load",n);break;case"video":case"audio":for(o=0;o<pb.length;o++)cr(pb[o],n);break;case"source":cr("error",n);break;case"img":case"image":case"link":cr("error",n),cr("load",n);break;case"details":cr("toggle",n);break;case"input":I7(n,s),cr("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!s.multiple},cr("invalid",n);break;case"textarea":_7(n,s),cr("invalid",n)}OD(r,s),o=null;for(var i in s)if(s.hasOwnProperty(i)){var a=s[i];i==="children"?typeof a=="string"?n.textContent!==a&&(s.suppressHydrationWarning!==!0&&Uk(n.textContent,a,t),o=["children",a]):typeof a=="number"&&n.textContent!==""+a&&(s.suppressHydrationWarning!==!0&&Uk(n.textContent,a,t),o=["children",""+a]):wb.hasOwnProperty(i)&&a!=null&&i==="onScroll"&&cr("scroll",n)}switch(r){case"input":$k(n),E7(n,s,!0);break;case"textarea":$k(n),A7(n);break;case"select":case"option":break;default:typeof s.onClick=="function"&&(n.onclick=mT)}n=o,e.updateQueue=n,n!==null&&(e.flags|=4)}else{i=o.nodeType===9?o:o.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=z9(r)),t==="http://www.w3.org/1999/xhtml"?r==="script"?(t=i.createElement("div"),t.innerHTML="<script></script>",t=t.removeChild(t.firstChild)):typeof n.is=="string"?t=i.createElement(r,{is:n.is}):(t=i.createElement(r),r==="select"&&(i=t,n.multiple?i.multiple=!0:n.size&&(i.size=n.size))):t=i.createElementNS(t,r),t[sa]=e,t[Db]=n,cj(t,e,!1,!1),e.stateNode=t;e:{switch(i=FD(r,n),r){case"dialog":cr("cancel",t),cr("close",t),o=n;break;case"iframe":case"object":case"embed":cr("load",t),o=n;break;case"video":case"audio":for(o=0;o<pb.length;o++)cr(pb[o],t);o=n;break;case"source":cr("error",t),o=n;break;case"img":case"image":case"link":cr("error",t),cr("load",t),o=n;break;case"details":cr("toggle",t),o=n;break;case"input":I7(t,n),o=_D(t,n),cr("invalid",t);break;case"option":o=n;break;case"select":t._wrapperState={wasMultiple:!!n.multiple},o=Ir({},n,{value:void 0}),cr("invalid",t);break;case"textarea":_7(t,n),o=$D(t,n),cr("invalid",t);break;default:o=n}OD(r,o),a=o;for(s in a)if(a.hasOwnProperty(s)){var l=a[s];s==="style"?W9(t,l):s==="dangerouslySetInnerHTML"?(l=l?l.__html:void 0,l!=null&&B9(t,l)):s==="children"?typeof l=="string"?(r!=="textarea"||l!=="")&&Cb(t,l):typeof l=="number"&&Cb(t,""+l):s!=="suppressContentEditableWarning"&&s!=="suppressHydrationWarning"&&s!=="autoFocus"&&(wb.hasOwnProperty(s)?l!=null&&s==="onScroll"&&cr("scroll",t):l!=null&&y$(t,s,l,i))}switch(r){case"input":$k(t),E7(t,n,!1);break;case"textarea":$k(t),A7(t);break;case"option":n.value!=null&&t.setAttribute("value",""+tp(n.value));break;case"select":t.multiple=!!n.multiple,s=n.value,s!=null?yg(t,!!n.multiple,s,!1):n.defaultValue!=null&&yg(t,!!n.multiple,n.defaultValue,!0);break;default:typeof o.onClick=="function"&&(t.onclick=mT)}switch(r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return to(e),null;case 6:if(t&&e.stateNode!=null)fj(t,e,t.memoizedProps,n);else{if(typeof n!="string"&&e.stateNode===null)throw Error(ge(166));if(r=qf(Rb.current),qf(aa.current),Hk(e)){if(n=e.stateNode,r=e.memoizedProps,n[sa]=e,(s=n.nodeValue!==r)&&(t=ss,t!==null))switch(t.tag){case 3:Uk(n.nodeValue,r,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Uk(n.nodeValue,r,(t.mode&1)!==0)}s&&(e.flags|=4)}else n=(r.nodeType===9?r:r.ownerDocument).createTextNode(n),n[sa]=e,e.stateNode=n}return to(e),null;case 13:if(pr(Tr),n=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(gr&&os!==null&&(e.mode&1)!==0&&(e.flags&128)===0)_q(),Ng(),e.flags|=98560,s=!1;else if(s=Hk(e),n!==null&&n.dehydrated!==null){if(t===null){if(!s)throw Error(ge(318));if(s=e.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(ge(317));s[sa]=e}else Ng(),(e.flags&128)===0&&(e.memoizedState=null),e.flags|=4;to(e),s=!1}else Ci!==null&&(h$(Ci),Ci=null),s=!0;if(!s)return e.flags&65536?e:null}return(e.flags&128)!==0?(e.lanes=r,e):(n=n!==null,n!==(t!==null&&t.memoizedState!==null)&&n&&(e.child.flags|=8192,(e.mode&1)!==0&&(t===null||(Tr.current&1)!==0?fn===0&&(fn=3):eR())),e.updateQueue!==null&&(e.flags|=4),to(e),null);case 4:return Eg(),a$(t,e),t===null&&_b(e.stateNode.containerInfo),to(e),null;case 10:return L$(e.type._context),to(e),null;case 17:return zo(e.type)&&hT(),to(e),null;case 19:if(pr(Tr),s=e.memoizedState,s===null)return to(e),null;if(n=(e.flags&128)!==0,i=s.rendering,i===null)if(n)sb(s,!1);else{if(fn!==0||t!==null&&(t.flags&128)!==0)for(t=e.child;t!==null;){if(i=CT(t),i!==null){for(e.flags|=128,sb(s,!1),n=i.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),e.subtreeFlags=0,n=r,r=e.child;r!==null;)s=r,t=n,s.flags&=14680066,i=s.alternate,i===null?(s.childLanes=0,s.lanes=t,s.child=null,s.subtreeFlags=0,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=i.childLanes,s.lanes=i.lanes,s.child=i.child,s.subtreeFlags=0,s.deletions=null,s.memoizedProps=i.memoizedProps,s.memoizedState=i.memoizedState,s.updateQueue=i.updateQueue,s.type=i.type,t=i.dependencies,s.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),r=r.sibling;return rr(Tr,Tr.current&1|2),e.child}t=t.sibling}s.tail!==null&&zr()>Ag&&(e.flags|=128,n=!0,sb(s,!1),e.lanes=4194304)}else{if(!n)if(t=CT(i),t!==null){if(e.flags|=128,n=!0,r=t.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),sb(s,!0),s.tail===null&&s.tailMode==="hidden"&&!i.alternate&&!gr)return to(e),null}else 2*zr()-s.renderingStartTime>Ag&&r!==1073741824&&(e.flags|=128,n=!0,sb(s,!1),e.lanes=4194304);s.isBackwards?(i.sibling=e.child,e.child=i):(r=s.last,r!==null?r.sibling=i:e.child=i,s.last=i)}return s.tail!==null?(e=s.tail,s.rendering=e,s.tail=e.sibling,s.renderingStartTime=zr(),e.sibling=null,r=Tr.current,rr(Tr,n?r&1|2:r&1),e):(to(e),null);case 22:case 23:return J$(),n=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==n&&(e.flags|=8192),n&&(e.mode&1)!==0?(ns&1073741824)!==0&&(to(e),e.subtreeFlags&6&&(e.flags|=8192)):to(e),null;case 24:return null;case 25:return null}throw Error(ge(156,e.tag))}function sye(t,e){switch(R$(e),e.tag){case 1:return zo(e.type)&&hT(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Eg(),pr(Mo),pr(no),W$(),t=e.flags,(t&65536)!==0&&(t&128)===0?(e.flags=t&-65537|128,e):null;case 5:return V$(e),null;case 13:if(pr(Tr),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(ge(340));Ng()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return pr(Tr),null;case 4:return Eg(),null;case 10:return L$(e.type._context),null;case 22:case 23:return J$(),null;case 24:return null;default:return null}}var Kk=!1,ro=!1,iye=typeof WeakSet=="function"?WeakSet:Set,Ae=null;function gg(t,e){var r=t.ref;if(r!==null)if(typeof r=="function")try{r(null)}catch(n){Or(t,e,n)}else r.current=null}function l$(t,e,r){try{r()}catch(n){Or(t,e,n)}}var v9=!1;function aye(t,e){if(HD=pT,t=gq(),D$(t)){if("selectionStart"in t)var r={start:t.selectionStart,end:t.selectionEnd};else e:{r=(r=t.ownerDocument)&&r.defaultView||window;var n=r.getSelection&&r.getSelection();if(n&&n.rangeCount!==0){r=n.anchorNode;var o=n.anchorOffset,s=n.focusNode;n=n.focusOffset;try{r.nodeType,s.nodeType}catch{r=null;break e}var i=0,a=-1,l=-1,u=0,c=0,p=t,f=null;t:for(;;){for(var d;p!==r||o!==0&&p.nodeType!==3||(a=i+o),p!==s||n!==0&&p.nodeType!==3||(l=i+n),p.nodeType===3&&(i+=p.nodeValue.length),(d=p.firstChild)!==null;)f=p,p=d;for(;;){if(p===t)break t;if(f===r&&++u===o&&(a=i),f===s&&++c===n&&(l=i),(d=p.nextSibling)!==null)break;p=f,f=p.parentNode}p=d}r=a===-1||l===-1?null:{start:a,end:l}}else r=null}r=r||{start:0,end:0}}else r=null;for(qD={focusedElem:t,selectionRange:r},pT=!1,Ae=e;Ae!==null;)if(e=Ae,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,Ae=t;else for(;Ae!==null;){e=Ae;try{var m=e.alternate;if((e.flags&1024)!==0)switch(e.tag){case 0:case 11:case 15:break;case 1:if(m!==null){var h=m.memoizedProps,g=m.memoizedState,x=e.stateNode,y=x.getSnapshotBeforeUpdate(e.elementType===e.type?h:vi(e.type,h),g);x.__reactInternalSnapshotBeforeUpdate=y}break;case 3:var b=e.stateNode.containerInfo;b.nodeType===1?b.textContent="":b.nodeType===9&&b.documentElement&&b.removeChild(b.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ge(163))}}catch(v){Or(e,e.return,v)}if(t=e.sibling,t!==null){t.return=e.return,Ae=t;break}Ae=e.return}return m=v9,v9=!1,m}function yb(t,e,r){var n=e.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var o=n=n.next;do{if((o.tag&t)===t){var s=o.destroy;o.destroy=void 0,s!==void 0&&l$(e,r,s)}o=o.next}while(o!==n)}}function MT(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var r=e=e.next;do{if((r.tag&t)===t){var n=r.create;r.destroy=n()}r=r.next}while(r!==e)}}function u$(t){var e=t.ref;if(e!==null){var r=t.stateNode;switch(t.tag){case 5:t=r;break;default:t=r}typeof e=="function"?e(t):e.current=t}}function dj(t){var e=t.alternate;e!==null&&(t.alternate=null,dj(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[sa],delete e[Db],delete e[XD],delete e[Gxe],delete e[Uxe])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function mj(t){return t.tag===5||t.tag===3||t.tag===4}function w9(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||mj(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function c$(t,e,r){var n=t.tag;if(n===5||n===6)t=t.stateNode,e?r.nodeType===8?r.parentNode.insertBefore(t,e):r.insertBefore(t,e):(r.nodeType===8?(e=r.parentNode,e.insertBefore(t,r)):(e=r,e.appendChild(t)),r=r._reactRootContainer,r!=null||e.onclick!==null||(e.onclick=mT));else if(n!==4&&(t=t.child,t!==null))for(c$(t,e,r),t=t.sibling;t!==null;)c$(t,e,r),t=t.sibling}function p$(t,e,r){var n=t.tag;if(n===5||n===6)t=t.stateNode,e?r.insertBefore(t,e):r.appendChild(t);else if(n!==4&&(t=t.child,t!==null))for(p$(t,e,r),t=t.sibling;t!==null;)p$(t,e,r),t=t.sibling}var Pn=null,wi=!1;function Bc(t,e,r){for(r=r.child;r!==null;)hj(t,e,r),r=r.sibling}function hj(t,e,r){if(ia&&typeof ia.onCommitFiberUnmount=="function")try{ia.onCommitFiberUnmount(AT,r)}catch{}switch(r.tag){case 5:ro||gg(r,e);case 6:var n=Pn,o=wi;Pn=null,Bc(t,e,r),Pn=n,wi=o,Pn!==null&&(wi?(t=Pn,r=r.stateNode,t.nodeType===8?t.parentNode.removeChild(r):t.removeChild(r)):Pn.removeChild(r.stateNode));break;case 18:Pn!==null&&(wi?(t=Pn,r=r.stateNode,t.nodeType===8?mD(t.parentNode,r):t.nodeType===1&&mD(t,r),Nb(t)):mD(Pn,r.stateNode));break;case 4:n=Pn,o=wi,Pn=r.stateNode.containerInfo,wi=!0,Bc(t,e,r),Pn=n,wi=o;break;case 0:case 11:case 14:case 15:if(!ro&&(n=r.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){o=n=n.next;do{var s=o,i=s.destroy;s=s.tag,i!==void 0&&((s&2)!==0||(s&4)!==0)&&l$(r,e,i),o=o.next}while(o!==n)}Bc(t,e,r);break;case 1:if(!ro&&(gg(r,e),n=r.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=r.memoizedProps,n.state=r.memoizedState,n.componentWillUnmount()}catch(a){Or(r,e,a)}Bc(t,e,r);break;case 21:Bc(t,e,r);break;case 22:r.mode&1?(ro=(n=ro)||r.memoizedState!==null,Bc(t,e,r),ro=n):Bc(t,e,r);break;default:Bc(t,e,r)}}function C9(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var r=t.stateNode;r===null&&(r=t.stateNode=new iye),e.forEach(function(n){var o=gye.bind(null,t,n);r.has(n)||(r.add(n),n.then(o,o))})}}function bi(t,e){var r=e.deletions;if(r!==null)for(var n=0;n<r.length;n++){var o=r[n];try{var s=t,i=e,a=i;e:for(;a!==null;){switch(a.tag){case 5:Pn=a.stateNode,wi=!1;break e;case 3:Pn=a.stateNode.containerInfo,wi=!0;break e;case 4:Pn=a.stateNode.containerInfo,wi=!0;break e}a=a.return}if(Pn===null)throw Error(ge(160));hj(s,i,o),Pn=null,wi=!1;var l=o.alternate;l!==null&&(l.return=null),o.return=null}catch(u){Or(o,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)gj(e,t),e=e.sibling}function gj(t,e){var r=t.alternate,n=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(bi(e,t),na(t),n&4){try{yb(3,t,t.return),MT(3,t)}catch(h){Or(t,t.return,h)}try{yb(5,t,t.return)}catch(h){Or(t,t.return,h)}}break;case 1:bi(e,t),na(t),n&512&&r!==null&&gg(r,r.return);break;case 5:if(bi(e,t),na(t),n&512&&r!==null&&gg(r,r.return),t.flags&32){var o=t.stateNode;try{Cb(o,"")}catch(h){Or(t,t.return,h)}}if(n&4&&(o=t.stateNode,o!=null)){var s=t.memoizedProps,i=r!==null?r.memoizedProps:s,a=t.type,l=t.updateQueue;if(t.updateQueue=null,l!==null)try{a==="input"&&s.type==="radio"&&s.name!=null&&L9(o,s),FD(a,i);var u=FD(a,s);for(i=0;i<l.length;i+=2){var c=l[i],p=l[i+1];c==="style"?W9(o,p):c==="dangerouslySetInnerHTML"?B9(o,p):c==="children"?Cb(o,p):y$(o,c,p,u)}switch(a){case"input":AD(o,s);break;case"textarea":M9(o,s);break;case"select":var f=o._wrapperState.wasMultiple;o._wrapperState.wasMultiple=!!s.multiple;var d=s.value;d!=null?yg(o,!!s.multiple,d,!1):f!==!!s.multiple&&(s.defaultValue!=null?yg(o,!!s.multiple,s.defaultValue,!0):yg(o,!!s.multiple,s.multiple?[]:"",!1))}o[Db]=s}catch(h){Or(t,t.return,h)}}break;case 6:if(bi(e,t),na(t),n&4){if(t.stateNode===null)throw Error(ge(162));o=t.stateNode,s=t.memoizedProps;try{o.nodeValue=s}catch(h){Or(t,t.return,h)}}break;case 3:if(bi(e,t),na(t),n&4&&r!==null&&r.memoizedState.isDehydrated)try{Nb(e.containerInfo)}catch(h){Or(t,t.return,h)}break;case 4:bi(e,t),na(t);break;case 13:bi(e,t),na(t),o=t.child,o.flags&8192&&(s=o.memoizedState!==null,o.stateNode.isHidden=s,!s||o.alternate!==null&&o.alternate.memoizedState!==null||(Q$=zr())),n&4&&C9(t);break;case 22:if(c=r!==null&&r.memoizedState!==null,t.mode&1?(ro=(u=ro)||c,bi(e,t),ro=u):bi(e,t),na(t),n&8192){if(u=t.memoizedState!==null,(t.stateNode.isHidden=u)&&!c&&(t.mode&1)!==0)for(Ae=t,c=t.child;c!==null;){for(p=Ae=c;Ae!==null;){switch(f=Ae,d=f.child,f.tag){case 0:case 11:case 14:case 15:yb(4,f,f.return);break;case 1:gg(f,f.return);var m=f.stateNode;if(typeof m.componentWillUnmount=="function"){n=f,r=f.return;try{e=n,m.props=e.memoizedProps,m.state=e.memoizedState,m.componentWillUnmount()}catch(h){Or(n,r,h)}}break;case 5:gg(f,f.return);break;case 22:if(f.memoizedState!==null){k9(p);continue}}d!==null?(d.return=f,Ae=d):k9(p)}c=c.sibling}e:for(c=null,p=t;;){if(p.tag===5){if(c===null){c=p;try{o=p.stateNode,u?(s=o.style,typeof s.setProperty=="function"?s.setProperty("display","none","important"):s.display="none"):(a=p.stateNode,l=p.memoizedProps.style,i=l!=null&&l.hasOwnProperty("display")?l.display:null,a.style.display=V9("display",i))}catch(h){Or(t,t.return,h)}}}else if(p.tag===6){if(c===null)try{p.stateNode.nodeValue=u?"":p.memoizedProps}catch(h){Or(t,t.return,h)}}else if((p.tag!==22&&p.tag!==23||p.memoizedState===null||p===t)&&p.child!==null){p.child.return=p,p=p.child;continue}if(p===t)break e;for(;p.sibling===null;){if(p.return===null||p.return===t)break e;c===p&&(c=null),p=p.return}c===p&&(c=null),p.sibling.return=p.return,p=p.sibling}}break;case 19:bi(e,t),na(t),n&4&&C9(t);break;case 21:break;default:bi(e,t),na(t)}}function na(t){var e=t.flags;if(e&2){try{e:{for(var r=t.return;r!==null;){if(mj(r)){var n=r;break e}r=r.return}throw Error(ge(160))}switch(n.tag){case 5:var o=n.stateNode;n.flags&32&&(Cb(o,""),n.flags&=-33);var s=w9(t);p$(t,s,o);break;case 3:case 4:var i=n.stateNode.containerInfo,a=w9(t);c$(t,a,i);break;default:throw Error(ge(161))}}catch(l){Or(t,t.return,l)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function lye(t,e,r){Ae=t,xj(t,e,r)}function xj(t,e,r){for(var n=(t.mode&1)!==0;Ae!==null;){var o=Ae,s=o.child;if(o.tag===22&&n){var i=o.memoizedState!==null||Kk;if(!i){var a=o.alternate,l=a!==null&&a.memoizedState!==null||ro;a=Kk;var u=ro;if(Kk=i,(ro=l)&&!u)for(Ae=o;Ae!==null;)i=Ae,l=i.child,i.tag===22&&i.memoizedState!==null?T9(o):l!==null?(l.return=i,Ae=l):T9(o);for(;s!==null;)Ae=s,xj(s,e,r),s=s.sibling;Ae=o,Kk=a,ro=u}S9(t,e,r)}else(o.subtreeFlags&8772)!==0&&s!==null?(s.return=o,Ae=s):S9(t,e,r)}}function S9(t){for(;Ae!==null;){var e=Ae;if((e.flags&8772)!==0){var r=e.alternate;try{if((e.flags&8772)!==0)switch(e.tag){case 0:case 11:case 15:ro||MT(5,e);break;case 1:var n=e.stateNode;if(e.flags&4&&!ro)if(r===null)n.componentDidMount();else{var o=e.elementType===e.type?r.memoizedProps:vi(e.type,r.memoizedProps);n.componentDidUpdate(o,r.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var s=e.updateQueue;s!==null&&i9(e,s,n);break;case 3:var i=e.updateQueue;if(i!==null){if(r=null,e.child!==null)switch(e.child.tag){case 5:r=e.child.stateNode;break;case 1:r=e.child.stateNode}i9(e,i,r)}break;case 5:var a=e.stateNode;if(r===null&&e.flags&4){r=a;var l=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":l.autoFocus&&r.focus();break;case"img":l.src&&(r.src=l.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var c=u.memoizedState;if(c!==null){var p=c.dehydrated;p!==null&&Nb(p)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ge(163))}ro||e.flags&512&&u$(e)}catch(f){Or(e,e.return,f)}}if(e===t){Ae=null;break}if(r=e.sibling,r!==null){r.return=e.return,Ae=r;break}Ae=e.return}}function k9(t){for(;Ae!==null;){var e=Ae;if(e===t){Ae=null;break}var r=e.sibling;if(r!==null){r.return=e.return,Ae=r;break}Ae=e.return}}function T9(t){for(;Ae!==null;){var e=Ae;try{switch(e.tag){case 0:case 11:case 15:var r=e.return;try{MT(4,e)}catch(l){Or(e,r,l)}break;case 1:var n=e.stateNode;if(typeof n.componentDidMount=="function"){var o=e.return;try{n.componentDidMount()}catch(l){Or(e,o,l)}}var s=e.return;try{u$(e)}catch(l){Or(e,s,l)}break;case 5:var i=e.return;try{u$(e)}catch(l){Or(e,i,l)}}}catch(l){Or(e,e.return,l)}if(e===t){Ae=null;break}var a=e.sibling;if(a!==null){a.return=e.return,Ae=a;break}Ae=e.return}}var uye=Math.ceil,TT=Yl.ReactCurrentDispatcher,X$=Yl.ReactCurrentOwner,Gs=Yl.ReactCurrentBatchConfig,yt=0,Nn=null,Xr=null,Ln=0,ns=0,xg=op(0),fn=0,Lb=null,Zf=0,zT=0,Y$=0,bb=null,Po=null,Q$=0,Ag=1/0,Vl=null,NT=!1,f$=null,Zc=null,Xk=!1,qc=null,IT=0,vb=0,d$=null,nT=-1,oT=0;function ho(){return(yt&6)!==0?zr():nT!==-1?nT:nT=zr()}function Jc(t){return(t.mode&1)===0?1:(yt&2)!==0&&Ln!==0?Ln&-Ln:qxe.transition!==null?(oT===0&&(oT=eq()),oT):(t=Lt,t!==0||(t=window.event,t=t===void 0?16:aq(t.type)),t)}function ki(t,e,r,n){if(50<vb)throw vb=0,d$=null,Error(ge(185));Mb(t,r,n),((yt&2)===0||t!==Nn)&&(t===Nn&&((yt&2)===0&&(zT|=r),fn===4&&Uc(t,Ln)),Bo(t,n),r===1&&yt===0&&(e.mode&1)===0&&(Ag=zr()+500,FT&&sp()))}function Bo(t,e){var r=t.callbackNode;Kge(t,e);var n=cT(t,t===Nn?Ln:0);if(n===0)r!==null&&R7(r),t.callbackNode=null,t.callbackPriority=0;else if(e=n&-n,t.callbackPriority!==e){if(r!=null&&R7(r),e===1)t.tag===0?Hxe(N9.bind(null,t)):Nq(N9.bind(null,t)),Vxe(function(){(yt&6)===0&&sp()}),r=null;else{switch(tq(n)){case 1:r=S$;break;case 4:r=Z9;break;case 16:r=uT;break;case 536870912:r=J9;break;default:r=uT}r=Tj(r,yj.bind(null,t))}t.callbackPriority=e,t.callbackNode=r}}function yj(t,e){if(nT=-1,oT=0,(yt&6)!==0)throw Error(ge(327));var r=t.callbackNode;if(Sg()&&t.callbackNode!==r)return null;var n=cT(t,t===Nn?Ln:0);if(n===0)return null;if((n&30)!==0||(n&t.expiredLanes)!==0||e)e=ET(t,n);else{e=n;var o=yt;yt|=2;var s=vj();(Nn!==t||Ln!==e)&&(Vl=null,Ag=zr()+500,jf(t,e));do try{fye();break}catch(a){bj(t,a)}while(1);P$(),TT.current=s,yt=o,Xr!==null?e=0:(Nn=null,Ln=0,e=fn)}if(e!==0){if(e===2&&(o=BD(t),o!==0&&(n=o,e=m$(t,o))),e===1)throw r=Lb,jf(t,0),Uc(t,n),Bo(t,zr()),r;if(e===6)Uc(t,n);else{if(o=t.current.alternate,(n&30)===0&&!cye(o)&&(e=ET(t,n),e===2&&(s=BD(t),s!==0&&(n=s,e=m$(t,s))),e===1))throw r=Lb,jf(t,0),Uc(t,n),Bo(t,zr()),r;switch(t.finishedWork=o,t.finishedLanes=n,e){case 0:case 1:throw Error(ge(345));case 2:Gf(t,Po,Vl);break;case 3:if(Uc(t,n),(n&130023424)===n&&(e=Q$+500-zr(),10<e)){if(cT(t,0)!==0)break;if(o=t.suspendedLanes,(o&n)!==n){ho(),t.pingedLanes|=t.suspendedLanes&o;break}t.timeoutHandle=KD(Gf.bind(null,t,Po,Vl),e);break}Gf(t,Po,Vl);break;case 4:if(Uc(t,n),(n&4194240)===n)break;for(e=t.eventTimes,o=-1;0<n;){var i=31-Si(n);s=1<<i,i=e[i],i>o&&(o=i),n&=~s}if(n=o,n=zr()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*uye(n/1960))-n,10<n){t.timeoutHandle=KD(Gf.bind(null,t,Po,Vl),n);break}Gf(t,Po,Vl);break;case 5:Gf(t,Po,Vl);break;default:throw Error(ge(329))}}}return Bo(t,zr()),t.callbackNode===r?yj.bind(null,t):null}function m$(t,e){var r=bb;return t.current.memoizedState.isDehydrated&&(jf(t,e).flags|=256),t=ET(t,e),t!==2&&(e=Po,Po=r,e!==null&&h$(e)),t}function h$(t){Po===null?Po=t:Po.push.apply(Po,t)}function cye(t){for(var e=t;;){if(e.flags&16384){var r=e.updateQueue;if(r!==null&&(r=r.stores,r!==null))for(var n=0;n<r.length;n++){var o=r[n],s=o.getSnapshot;o=o.value;try{if(!Ti(s(),o))return!1}catch{return!1}}}if(r=e.child,e.subtreeFlags&16384&&r!==null)r.return=e,e=r;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Uc(t,e){for(e&=~Y$,e&=~zT,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var r=31-Si(e),n=1<<r;t[r]=-1,e&=~n}}function N9(t){if((yt&6)!==0)throw Error(ge(327));Sg();var e=cT(t,0);if((e&1)===0)return Bo(t,zr()),null;var r=ET(t,e);if(t.tag!==0&&r===2){var n=BD(t);n!==0&&(e=n,r=m$(t,n))}if(r===1)throw r=Lb,jf(t,0),Uc(t,e),Bo(t,zr()),r;if(r===6)throw Error(ge(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Gf(t,Po,Vl),Bo(t,zr()),null}function Z$(t,e){var r=yt;yt|=1;try{return t(e)}finally{yt=r,yt===0&&(Ag=zr()+500,FT&&sp())}}function Jf(t){qc!==null&&qc.tag===0&&(yt&6)===0&&Sg();var e=yt;yt|=1;var r=Gs.transition,n=Lt;try{if(Gs.transition=null,Lt=1,t)return t()}finally{Lt=n,Gs.transition=r,yt=e,(yt&6)===0&&sp()}}function J$(){ns=xg.current,pr(xg)}function jf(t,e){t.finishedWork=null,t.finishedLanes=0;var r=t.timeoutHandle;if(r!==-1&&(t.timeoutHandle=-1,Bxe(r)),Xr!==null)for(r=Xr.return;r!==null;){var n=r;switch(R$(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&hT();break;case 3:Eg(),pr(Mo),pr(no),W$();break;case 5:V$(n);break;case 4:Eg();break;case 13:pr(Tr);break;case 19:pr(Tr);break;case 10:L$(n.type._context);break;case 22:case 23:J$()}r=r.return}if(Nn=t,Xr=t=ep(t.current,null),Ln=ns=e,fn=0,Lb=null,Y$=zT=Zf=0,Po=bb=null,Hf!==null){for(e=0;e<Hf.length;e++)if(r=Hf[e],n=r.interleaved,n!==null){r.interleaved=null;var o=n.next,s=r.pending;if(s!==null){var i=s.next;s.next=o,n.next=i}r.pending=n}Hf=null}return t}function bj(t,e){do{var r=Xr;try{if(P$(),eT.current=kT,ST){for(var n=Nr.memoizedState;n!==null;){var o=n.queue;o!==null&&(o.pending=null),n=n.next}ST=!1}if(Qf=0,Tn=pn=Nr=null,xb=!1,Ob=0,X$.current=null,r===null||r.return===null){fn=1,Lb=e,Xr=null;break}e:{var s=t,i=r.return,a=r,l=e;if(e=Ln,a.flags|=32768,l!==null&&typeof l=="object"&&typeof l.then=="function"){var u=l,c=a,p=c.tag;if((c.mode&1)===0&&(p===0||p===11||p===15)){var f=c.alternate;f?(c.updateQueue=f.updateQueue,c.memoizedState=f.memoizedState,c.lanes=f.lanes):(c.updateQueue=null,c.memoizedState=null)}var d=d9(i);if(d!==null){d.flags&=-257,m9(d,i,a,s,e),d.mode&1&&f9(s,u,e),e=d,l=u;var m=e.updateQueue;if(m===null){var h=new Set;h.add(l),e.updateQueue=h}else m.add(l);break e}else{if((e&1)===0){f9(s,u,e),eR();break e}l=Error(ge(426))}}else if(gr&&a.mode&1){var g=d9(i);if(g!==null){(g.flags&65536)===0&&(g.flags|=256),m9(g,i,a,s,e),O$(_g(l,a));break e}}s=l=_g(l,a),fn!==4&&(fn=2),bb===null?bb=[s]:bb.push(s),s=i;do{switch(s.tag){case 3:s.flags|=65536,e&=-e,s.lanes|=e;var x=rj(s,l,e);s9(s,x);break e;case 1:a=l;var y=s.type,b=s.stateNode;if((s.flags&128)===0&&(typeof y.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(Zc===null||!Zc.has(b)))){s.flags|=65536,e&=-e,s.lanes|=e;var v=nj(s,a,e);s9(s,v);break e}}s=s.return}while(s!==null)}Cj(r)}catch(C){e=C,Xr===r&&r!==null&&(Xr=r=r.return);continue}break}while(1)}function vj(){var t=TT.current;return TT.current=kT,t===null?kT:t}function eR(){(fn===0||fn===3||fn===2)&&(fn=4),Nn===null||(Zf&268435455)===0&&(zT&268435455)===0||Uc(Nn,Ln)}function ET(t,e){var r=yt;yt|=2;var n=vj();(Nn!==t||Ln!==e)&&(Vl=null,jf(t,e));do try{pye();break}catch(o){bj(t,o)}while(1);if(P$(),yt=r,TT.current=n,Xr!==null)throw Error(ge(261));return Nn=null,Ln=0,fn}function pye(){for(;Xr!==null;)wj(Xr)}function fye(){for(;Xr!==null&&!zge();)wj(Xr)}function wj(t){var e=kj(t.alternate,t,ns);t.memoizedProps=t.pendingProps,e===null?Cj(t):Xr=e,X$.current=null}function Cj(t){var e=t;do{var r=e.alternate;if(t=e.return,(e.flags&32768)===0){if(r=oye(r,e,ns),r!==null){Xr=r;return}}else{if(r=sye(r,e),r!==null){r.flags&=32767,Xr=r;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{fn=6,Xr=null;return}}if(e=e.sibling,e!==null){Xr=e;return}Xr=e=t}while(e!==null);fn===0&&(fn=5)}function Gf(t,e,r){var n=Lt,o=Gs.transition;try{Gs.transition=null,Lt=1,dye(t,e,r,n)}finally{Gs.transition=o,Lt=n}return null}function dye(t,e,r,n){do Sg();while(qc!==null);if((yt&6)!==0)throw Error(ge(327));r=t.finishedWork;var o=t.finishedLanes;if(r===null)return null;if(t.finishedWork=null,t.finishedLanes=0,r===t.current)throw Error(ge(177));t.callbackNode=null,t.callbackPriority=0;var s=r.lanes|r.childLanes;if(Xge(t,s),t===Nn&&(Xr=Nn=null,Ln=0),(r.subtreeFlags&2064)===0&&(r.flags&2064)===0||Xk||(Xk=!0,Tj(uT,function(){return Sg(),null})),s=(r.flags&15990)!==0,(r.subtreeFlags&15990)!==0||s){s=Gs.transition,Gs.transition=null;var i=Lt;Lt=1;var a=yt;yt|=4,X$.current=null,aye(t,r),gj(r,t),Fxe(qD),pT=!!HD,qD=HD=null,t.current=r,lye(r,t,o),Bge(),yt=a,Lt=i,Gs.transition=s}else t.current=r;if(Xk&&(Xk=!1,qc=t,IT=o),s=t.pendingLanes,s===0&&(Zc=null),Gge(r.stateNode,n),Bo(t,zr()),e!==null)for(n=t.onRecoverableError,r=0;r<e.length;r++)o=e[r],n(o.value,{componentStack:o.stack,digest:o.digest});if(NT)throw NT=!1,t=f$,f$=null,t;return(IT&1)!==0&&t.tag!==0&&Sg(),s=t.pendingLanes,(s&1)!==0?t===d$?vb++:(vb=0,d$=t):vb=0,sp(),null}function Sg(){if(qc!==null){var t=tq(IT),e=Gs.transition,r=Lt;try{if(Gs.transition=null,Lt=16>t?16:t,qc===null)var n=!1;else{if(t=qc,qc=null,IT=0,(yt&6)!==0)throw Error(ge(331));var o=yt;for(yt|=4,Ae=t.current;Ae!==null;){var s=Ae,i=s.child;if((Ae.flags&16)!==0){var a=s.deletions;if(a!==null){for(var l=0;l<a.length;l++){var u=a[l];for(Ae=u;Ae!==null;){var c=Ae;switch(c.tag){case 0:case 11:case 15:yb(8,c,s)}var p=c.child;if(p!==null)p.return=c,Ae=p;else for(;Ae!==null;){c=Ae;var f=c.sibling,d=c.return;if(dj(c),c===u){Ae=null;break}if(f!==null){f.return=d,Ae=f;break}Ae=d}}}var m=s.alternate;if(m!==null){var h=m.child;if(h!==null){m.child=null;do{var g=h.sibling;h.sibling=null,h=g}while(h!==null)}}Ae=s}}if((s.subtreeFlags&2064)!==0&&i!==null)i.return=s,Ae=i;else e:for(;Ae!==null;){if(s=Ae,(s.flags&2048)!==0)switch(s.tag){case 0:case 11:case 15:yb(9,s,s.return)}var x=s.sibling;if(x!==null){x.return=s.return,Ae=x;break e}Ae=s.return}}var y=t.current;for(Ae=y;Ae!==null;){i=Ae;var b=i.child;if((i.subtreeFlags&2064)!==0&&b!==null)b.return=i,Ae=b;else e:for(i=y;Ae!==null;){if(a=Ae,(a.flags&2048)!==0)try{switch(a.tag){case 0:case 11:case 15:MT(9,a)}}catch(C){Or(a,a.return,C)}if(a===i){Ae=null;break e}var v=a.sibling;if(v!==null){v.return=a.return,Ae=v;break e}Ae=a.return}}if(yt=o,sp(),ia&&typeof ia.onPostCommitFiberRoot=="function")try{ia.onPostCommitFiberRoot(AT,t)}catch{}n=!0}return n}finally{Lt=r,Gs.transition=e}}return!1}function I9(t,e,r){e=_g(r,e),e=rj(t,e,1),t=Qc(t,e,1),e=ho(),t!==null&&(Mb(t,1,e),Bo(t,e))}function Or(t,e,r){if(t.tag===3)I9(t,t,r);else for(;e!==null;){if(e.tag===3){I9(e,t,r);break}else if(e.tag===1){var n=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(Zc===null||!Zc.has(n))){t=_g(r,t),t=nj(e,t,1),e=Qc(e,t,1),t=ho(),e!==null&&(Mb(e,1,t),Bo(e,t));break}}e=e.return}}function mye(t,e,r){var n=t.pingCache;n!==null&&n.delete(e),e=ho(),t.pingedLanes|=t.suspendedLanes&r,Nn===t&&(Ln&r)===r&&(fn===4||fn===3&&(Ln&130023424)===Ln&&500>zr()-Q$?jf(t,0):Y$|=r),Bo(t,e)}function Sj(t,e){e===0&&((t.mode&1)===0?e=1:(e=Fk,Fk<<=1,(Fk&130023424)===0&&(Fk=4194304)));var r=ho();t=Kl(t,e),t!==null&&(Mb(t,e,r),Bo(t,r))}function hye(t){var e=t.memoizedState,r=0;e!==null&&(r=e.retryLane),Sj(t,r)}function gye(t,e){var r=0;switch(t.tag){case 13:var n=t.stateNode,o=t.memoizedState;o!==null&&(r=o.retryLane);break;case 19:n=t.stateNode;break;default:throw Error(ge(314))}n!==null&&n.delete(e),Sj(t,r)}var kj;kj=function(t,e,r){if(t!==null)if(t.memoizedProps!==e.pendingProps||Mo.current)Lo=!0;else{if((t.lanes&r)===0&&(e.flags&128)===0)return Lo=!1,nye(t,e,r);Lo=(t.flags&131072)!==0}else Lo=!1,gr&&(e.flags&1048576)!==0&&Iq(e,yT,e.index);switch(e.lanes=0,e.tag){case 2:var n=e.type;rT(t,e),t=e.pendingProps;var o=Tg(e,no.current);Cg(e,r),o=U$(null,e,n,t,o,r);var s=H$();return e.flags|=1,typeof o=="object"&&o!==null&&typeof o.render=="function"&&o.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,zo(n)?(s=!0,gT(e)):s=!1,e.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,z$(e),o.updater=PT,e.stateNode=o,o._reactInternals=e,t$(e,n,t,r),e=o$(null,e,n,!0,s,r)):(e.tag=0,gr&&s&&$$(e),mo(null,e,o,r),e=e.child),e;case 16:n=e.elementType;e:{switch(rT(t,e),t=e.pendingProps,o=n._init,n=o(n._payload),e.type=n,o=e.tag=yye(n),t=vi(n,t),o){case 0:e=n$(null,e,n,t,r);break e;case 1:e=x9(null,e,n,t,r);break e;case 11:e=h9(null,e,n,t,r);break e;case 14:e=g9(null,e,n,vi(n.type,t),r);break e}throw Error(ge(306,n,""))}return e;case 0:return n=e.type,o=e.pendingProps,o=e.elementType===n?o:vi(n,o),n$(t,e,n,o,r);case 1:return n=e.type,o=e.pendingProps,o=e.elementType===n?o:vi(n,o),x9(t,e,n,o,r);case 3:e:{if(aj(e),t===null)throw Error(ge(387));n=e.pendingProps,s=e.memoizedState,o=s.element,Dq(t,e),wT(e,n,null,r);var i=e.memoizedState;if(n=i.element,s.isDehydrated)if(s={element:n,isDehydrated:!1,cache:i.cache,pendingSuspenseBoundaries:i.pendingSuspenseBoundaries,transitions:i.transitions},e.updateQueue.baseState=s,e.memoizedState=s,e.flags&256){o=_g(Error(ge(423)),e),e=y9(t,e,n,r,o);break e}else if(n!==o){o=_g(Error(ge(424)),e),e=y9(t,e,n,r,o);break e}else for(os=Yc(e.stateNode.containerInfo.firstChild),ss=e,gr=!0,Ci=null,r=Fq(e,null,n,r),e.child=r;r;)r.flags=r.flags&-3|4096,r=r.sibling;else{if(Ng(),n===o){e=Xl(t,e,r);break e}mo(t,e,n,r)}e=e.child}return e;case 5:return Pq(e),t===null&&ZD(e),n=e.type,o=e.pendingProps,s=t!==null?t.memoizedProps:null,i=o.children,jD(n,o)?i=null:s!==null&&jD(n,s)&&(e.flags|=32),ij(t,e),mo(t,e,i,r),e.child;case 6:return t===null&&ZD(e),null;case 13:return lj(t,e,r);case 4:return B$(e,e.stateNode.containerInfo),n=e.pendingProps,t===null?e.child=Ig(e,null,n,r):mo(t,e,n,r),e.child;case 11:return n=e.type,o=e.pendingProps,o=e.elementType===n?o:vi(n,o),h9(t,e,n,o,r);case 7:return mo(t,e,e.pendingProps,r),e.child;case 8:return mo(t,e,e.pendingProps.children,r),e.child;case 12:return mo(t,e,e.pendingProps.children,r),e.child;case 10:e:{if(n=e.type._context,o=e.pendingProps,s=e.memoizedProps,i=o.value,rr(bT,n._currentValue),n._currentValue=i,s!==null)if(Ti(s.value,i)){if(s.children===o.children&&!Mo.current){e=Xl(t,e,r);break e}}else for(s=e.child,s!==null&&(s.return=e);s!==null;){var a=s.dependencies;if(a!==null){i=s.child;for(var l=a.firstContext;l!==null;){if(l.context===n){if(s.tag===1){l=Hl(-1,r&-r),l.tag=2;var u=s.updateQueue;if(u!==null){u=u.shared;var c=u.pending;c===null?l.next=l:(l.next=c.next,c.next=l),u.pending=l}}s.lanes|=r,l=s.alternate,l!==null&&(l.lanes|=r),JD(s.return,r,e),a.lanes|=r;break}l=l.next}}else if(s.tag===10)i=s.type===e.type?null:s.child;else if(s.tag===18){if(i=s.return,i===null)throw Error(ge(341));i.lanes|=r,a=i.alternate,a!==null&&(a.lanes|=r),JD(i,r,e),i=s.sibling}else i=s.child;if(i!==null)i.return=s;else for(i=s;i!==null;){if(i===e){i=null;break}if(s=i.sibling,s!==null){s.return=i.return,i=s;break}i=i.return}s=i}mo(t,e,o.children,r),e=e.child}return e;case 9:return o=e.type,n=e.pendingProps.children,Cg(e,r),o=Us(o),n=n(o),e.flags|=1,mo(t,e,n,r),e.child;case 14:return n=e.type,o=vi(n,e.pendingProps),o=vi(n.type,o),g9(t,e,n,o,r);case 15:return oj(t,e,e.type,e.pendingProps,r);case 17:return n=e.type,o=e.pendingProps,o=e.elementType===n?o:vi(n,o),rT(t,e),e.tag=1,zo(n)?(t=!0,gT(e)):t=!1,Cg(e,r),Rq(e,n,o),t$(e,n,o,r),o$(null,e,n,!0,t,r);case 19:return uj(t,e,r);case 22:return sj(t,e,r)}throw Error(ge(156,e.tag))};function Tj(t,e){return Q9(t,e)}function xye(t,e,r,n){this.tag=t,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ws(t,e,r,n){return new xye(t,e,r,n)}function tR(t){return t=t.prototype,!(!t||!t.isReactComponent)}function yye(t){if(typeof t=="function")return tR(t)?1:0;if(t!=null){if(t=t.$$typeof,t===v$)return 11;if(t===w$)return 14}return 2}function ep(t,e){var r=t.alternate;return r===null?(r=Ws(t.tag,e,t.key,t.mode),r.elementType=t.elementType,r.type=t.type,r.stateNode=t.stateNode,r.alternate=t,t.alternate=r):(r.pendingProps=e,r.type=t.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=t.flags&14680064,r.childLanes=t.childLanes,r.lanes=t.lanes,r.child=t.child,r.memoizedProps=t.memoizedProps,r.memoizedState=t.memoizedState,r.updateQueue=t.updateQueue,e=t.dependencies,r.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},r.sibling=t.sibling,r.index=t.index,r.ref=t.ref,r}function sT(t,e,r,n,o,s){var i=2;if(n=t,typeof t=="function")tR(t)&&(i=1);else if(typeof t=="string")i=5;else e:switch(t){case ag:return Kf(r.children,o,s,e);case b$:i=8,o|=8;break;case TD:return t=Ws(12,r,e,o|2),t.elementType=TD,t.lanes=s,t;case ND:return t=Ws(13,r,e,o),t.elementType=ND,t.lanes=s,t;case ID:return t=Ws(19,r,e,o),t.elementType=ID,t.lanes=s,t;case O9:return BT(r,o,s,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case $9:i=10;break e;case R9:i=9;break e;case v$:i=11;break e;case w$:i=14;break e;case Vc:i=16,n=null;break e}throw Error(ge(130,t==null?t:typeof t,""))}return e=Ws(i,r,e,o),e.elementType=t,e.type=n,e.lanes=s,e}function Kf(t,e,r,n){return t=Ws(7,t,n,e),t.lanes=r,t}function BT(t,e,r,n){return t=Ws(22,t,n,e),t.elementType=O9,t.lanes=r,t.stateNode={isHidden:!1},t}function CD(t,e,r){return t=Ws(6,t,null,e),t.lanes=r,t}function SD(t,e,r){return e=Ws(4,t.children!==null?t.children:[],t.key,e),e.lanes=r,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function bye(t,e,r,n,o){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=iD(0),this.expirationTimes=iD(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=iD(0),this.identifierPrefix=n,this.onRecoverableError=o,this.mutableSourceEagerHydrationData=null}function rR(t,e,r,n,o,s,i,a,l){return t=new bye(t,e,r,a,l),e===1?(e=1,s===!0&&(e|=8)):e=0,s=Ws(3,null,null,e),t.current=s,s.stateNode=t,s.memoizedState={element:n,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},z$(s),t}function vye(t,e,r){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ig,key:n==null?null:""+n,children:t,containerInfo:e,implementation:r}}function Nj(t){if(!t)return rp;t=t._reactInternals;e:{if(td(t)!==t||t.tag!==1)throw Error(ge(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(zo(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(ge(171))}if(t.tag===1){var r=t.type;if(zo(r))return Tq(t,r,e)}return e}function Ij(t,e,r,n,o,s,i,a,l){return t=rR(r,n,!0,t,o,s,i,a,l),t.context=Nj(null),r=t.current,n=ho(),o=Jc(r),s=Hl(n,o),s.callback=e??null,Qc(r,s,o),t.current.lanes=o,Mb(t,o,n),Bo(t,n),t}function VT(t,e,r,n){var o=e.current,s=ho(),i=Jc(o);return r=Nj(r),e.context===null?e.context=r:e.pendingContext=r,e=Hl(s,i),e.payload={element:t},n=n===void 0?null:n,n!==null&&(e.callback=n),t=Qc(o,e,i),t!==null&&(ki(t,o,i,s),Jk(t,o,i)),i}function _T(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function E9(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var r=t.retryLane;t.retryLane=r!==0&&r<e?r:e}}function nR(t,e){E9(t,e),(t=t.alternate)&&E9(t,e)}function wye(){return null}var Ej=typeof reportError=="function"?reportError:function(t){console.error(t)};function oR(t){this._internalRoot=t}WT.prototype.render=oR.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(ge(409));VT(t,e,null,null)};WT.prototype.unmount=oR.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Jf(function(){VT(null,t,null,null)}),e[jl]=null}};function WT(t){this._internalRoot=t}WT.prototype.unstable_scheduleHydration=function(t){if(t){var e=oq();t={blockedOn:null,target:t,priority:e};for(var r=0;r<Gc.length&&e!==0&&e<Gc[r].priority;r++);Gc.splice(r,0,t),r===0&&iq(t)}};function sR(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function GT(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function _9(){}function Cye(t,e,r,n,o){if(o){if(typeof n=="function"){var s=n;n=function(){var u=_T(i);s.call(u)}}var i=Ij(e,n,t,0,null,!1,!1,"",_9);return t._reactRootContainer=i,t[jl]=i.current,_b(t.nodeType===8?t.parentNode:t),Jf(),i}for(;o=t.lastChild;)t.removeChild(o);if(typeof n=="function"){var a=n;n=function(){var u=_T(l);a.call(u)}}var l=rR(t,0,!1,null,null,!1,!1,"",_9);return t._reactRootContainer=l,t[jl]=l.current,_b(t.nodeType===8?t.parentNode:t),Jf(function(){VT(e,l,r,n)}),l}function UT(t,e,r,n,o){var s=r._reactRootContainer;if(s){var i=s;if(typeof o=="function"){var a=o;o=function(){var l=_T(i);a.call(l)}}VT(e,i,t,o)}else i=Cye(r,e,t,o,n);return _T(i)}rq=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var r=cb(e.pendingLanes);r!==0&&(k$(e,r|1),Bo(e,zr()),(yt&6)===0&&(Ag=zr()+500,sp()))}break;case 13:Jf(function(){var n=Kl(t,1);if(n!==null){var o=ho();ki(n,t,1,o)}}),nR(t,1)}};T$=function(t){if(t.tag===13){var e=Kl(t,134217728);if(e!==null){var r=ho();ki(e,t,134217728,r)}nR(t,134217728)}};nq=function(t){if(t.tag===13){var e=Jc(t),r=Kl(t,e);if(r!==null){var n=ho();ki(r,t,e,n)}nR(t,e)}};oq=function(){return Lt};sq=function(t,e){var r=Lt;try{return Lt=t,e()}finally{Lt=r}};LD=function(t,e,r){switch(e){case"input":if(AD(t,r),e=r.name,r.type==="radio"&&e!=null){for(r=t;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<r.length;e++){var n=r[e];if(n!==t&&n.form===t.form){var o=OT(n);if(!o)throw Error(ge(90));P9(n),AD(n,o)}}}break;case"textarea":M9(t,r);break;case"select":e=r.value,e!=null&&yg(t,!!r.multiple,e,!1)}};H9=Z$;q9=Jf;var Sye={usingClientEntryPoint:!1,Events:[Bb,pg,OT,G9,U9,Z$]},ib={findFiberByHostInstance:Uf,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},kye={bundleType:ib.bundleType,version:ib.version,rendererPackageName:ib.rendererPackageName,rendererConfig:ib.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Yl.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=X9(t),t===null?null:t.stateNode},findFiberByHostInstance:ib.findFiberByHostInstance||wye,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"&&(ab=__REACT_DEVTOOLS_GLOBAL_HOOK__,!ab.isDisabled&&ab.supportsFiber))try{AT=ab.inject(kye),ia=ab}catch{}var ab;ls.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Sye;ls.createPortal=function(t,e){var r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!sR(e))throw Error(ge(200));return vye(t,e,null,r)};ls.createRoot=function(t,e){if(!sR(t))throw Error(ge(299));var r=!1,n="",o=Ej;return e!=null&&(e.unstable_strictMode===!0&&(r=!0),e.identifierPrefix!==void 0&&(n=e.identifierPrefix),e.onRecoverableError!==void 0&&(o=e.onRecoverableError)),e=rR(t,1,!1,null,null,r,!1,n,o),t[jl]=e.current,_b(t.nodeType===8?t.parentNode:t),new oR(e)};ls.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(ge(188)):(t=Object.keys(t).join(","),Error(ge(268,t)));return t=X9(e),t=t===null?null:t.stateNode,t};ls.flushSync=function(t){return Jf(t)};ls.hydrate=function(t,e,r){if(!GT(e))throw Error(ge(200));return UT(null,t,e,!0,r)};ls.hydrateRoot=function(t,e,r){if(!sR(t))throw Error(ge(405));var n=r!=null&&r.hydratedSources||null,o=!1,s="",i=Ej;if(r!=null&&(r.unstable_strictMode===!0&&(o=!0),r.identifierPrefix!==void 0&&(s=r.identifierPrefix),r.onRecoverableError!==void 0&&(i=r.onRecoverableError)),e=Ij(e,null,t,1,r??null,o,!1,s,i),t[jl]=e.current,_b(t),n)for(t=0;t<n.length;t++)r=n[t],o=r._getVersion,o=o(r._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[r,o]:e.mutableSourceEagerHydrationData.push(r,o);return new WT(e)};ls.render=function(t,e,r){if(!GT(e))throw Error(ge(200));return UT(null,t,e,!1,r)};ls.unmountComponentAtNode=function(t){if(!GT(t))throw Error(ge(40));return t._reactRootContainer?(Jf(function(){UT(null,null,t,!1,function(){t._reactRootContainer=null,t[jl]=null})}),!0):!1};ls.unstable_batchedUpdates=Z$;ls.unstable_renderSubtreeIntoContainer=function(t,e,r,n){if(!GT(r))throw Error(ge(200));if(t==null||t._reactInternals===void 0)throw Error(ge(38));return UT(t,e,r,!1,n)};ls.version="18.2.0-next-9e3b772b8-20220608"});var iR=Ye((Wqt,Dj)=>{"use strict";function Aj(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Aj)}catch(t){console.error(t)}}Aj(),Dj.exports=_j()});var eK=Ye((PYt,Jj)=>{var o0e=typeof Element<"u",s0e=typeof Map=="function",i0e=typeof Set=="function",a0e=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function QT(t,e){if(t===e)return!0;if(t&&e&&typeof t=="object"&&typeof e=="object"){if(t.constructor!==e.constructor)return!1;var r,n,o;if(Array.isArray(t)){if(r=t.length,r!=e.length)return!1;for(n=r;n--!==0;)if(!QT(t[n],e[n]))return!1;return!0}var s;if(s0e&&t instanceof Map&&e instanceof Map){if(t.size!==e.size)return!1;for(s=t.entries();!(n=s.next()).done;)if(!e.has(n.value[0]))return!1;for(s=t.entries();!(n=s.next()).done;)if(!QT(n.value[1],e.get(n.value[0])))return!1;return!0}if(i0e&&t instanceof Set&&e instanceof Set){if(t.size!==e.size)return!1;for(s=t.entries();!(n=s.next()).done;)if(!e.has(n.value[0]))return!1;return!0}if(a0e&&ArrayBuffer.isView(t)&&ArrayBuffer.isView(e)){if(r=t.length,r!=e.length)return!1;for(n=r;n--!==0;)if(t[n]!==e[n])return!1;return!0}if(t.constructor===RegExp)return t.source===e.source&&t.flags===e.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===e.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===e.toString();if(o=Object.keys(t),r=o.length,r!==Object.keys(e).length)return!1;for(n=r;n--!==0;)if(!Object.prototype.hasOwnProperty.call(e,o[n]))return!1;if(o0e&&t instanceof Element)return!1;for(n=r;n--!==0;)if(!((o[n]==="_owner"||o[n]==="__v"||o[n]==="__o")&&t.$$typeof)&&!QT(t[o[n]],e[o[n]]))return!1;return!0}return t!==t&&e!==e}Jj.exports=function(e,r){try{return QT(e,r)}catch(n){if((n.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw n}}});var NO=Ye((uZt,ZN)=>{(function(t){var e=/^\s+/,r=/\s+$/,n=0,o=t.round,s=t.min,i=t.max,a=t.random;function l(R,q){if(R=R||"",q=q||{},R instanceof l)return R;if(!(this instanceof l))return new l(R,q);var P=u(R);this._originalInput=R,this._r=P.r,this._g=P.g,this._b=P.b,this._a=P.a,this._roundA=o(100*this._a)/100,this._format=q.format||P.format,this._gradientType=q.gradientType,this._r<1&&(this._r=o(this._r)),this._g<1&&(this._g=o(this._g)),this._b<1&&(this._b=o(this._b)),this._ok=P.ok,this._tc_id=n++}l.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var R=this.toRgb();return(R.r*299+R.g*587+R.b*114)/1e3},getLuminance:function(){var R=this.toRgb(),q,P,ie,pe,fe,Se;return q=R.r/255,P=R.g/255,ie=R.b/255,q<=.03928?pe=q/12.92:pe=t.pow((q+.055)/1.055,2.4),P<=.03928?fe=P/12.92:fe=t.pow((P+.055)/1.055,2.4),ie<=.03928?Se=ie/12.92:Se=t.pow((ie+.055)/1.055,2.4),.2126*pe+.7152*fe+.0722*Se},setAlpha:function(R){return this._a=Z(R),this._roundA=o(100*this._a)/100,this},toHsv:function(){var R=d(this._r,this._g,this._b);return{h:R.h*360,s:R.s,v:R.v,a:this._a}},toHsvString:function(){var R=d(this._r,this._g,this._b),q=o(R.h*360),P=o(R.s*100),ie=o(R.v*100);return this._a==1?"hsv("+q+", "+P+"%, "+ie+"%)":"hsva("+q+", "+P+"%, "+ie+"%, "+this._roundA+")"},toHsl:function(){var R=p(this._r,this._g,this._b);return{h:R.h*360,s:R.s,l:R.l,a:this._a}},toHslString:function(){var R=p(this._r,this._g,this._b),q=o(R.h*360),P=o(R.s*100),ie=o(R.l*100);return this._a==1?"hsl("+q+", "+P+"%, "+ie+"%)":"hsla("+q+", "+P+"%, "+ie+"%, "+this._roundA+")"},toHex:function(R){return h(this._r,this._g,this._b,R)},toHexString:function(R){return"#"+this.toHex(R)},toHex8:function(R){return g(this._r,this._g,this._b,this._a,R)},toHex8String:function(R){return"#"+this.toHex8(R)},toRgb:function(){return{r:o(this._r),g:o(this._g),b:o(this._b),a:this._a}},toRgbString:function(){return this._a==1?"rgb("+o(this._r)+", "+o(this._g)+", "+o(this._b)+")":"rgba("+o(this._r)+", "+o(this._g)+", "+o(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:o(Q(this._r,255)*100)+"%",g:o(Q(this._g,255)*100)+"%",b:o(Q(this._b,255)*100)+"%",a:this._a}},toPercentageRgbString:function(){return this._a==1?"rgb("+o(Q(this._r,255)*100)+"%, "+o(Q(this._g,255)*100)+"%, "+o(Q(this._b,255)*100)+"%)":"rgba("+o(Q(this._r,255)*100)+"%, "+o(Q(this._g,255)*100)+"%, "+o(Q(this._b,255)*100)+"%, "+this._roundA+")"},toName:function(){return this._a===0?"transparent":this._a<1?!1:H[h(this._r,this._g,this._b,!0)]||!1},toFilter:function(R){var q="#"+x(this._r,this._g,this._b,this._a),P=q,ie=this._gradientType?"GradientType = 1, ":"";if(R){var pe=l(R);P="#"+x(pe._r,pe._g,pe._b,pe._a)}return"progid:DXImageTransform.Microsoft.gradient("+ie+"startColorstr="+q+",endColorstr="+P+")"},toString:function(R){var q=!!R;R=R||this._format;var P=!1,ie=this._a<1&&this._a>=0,pe=!q&&ie&&(R==="hex"||R==="hex6"||R==="hex3"||R==="hex4"||R==="hex8"||R==="name");return pe?R==="name"&&this._a===0?this.toName():this.toRgbString():(R==="rgb"&&(P=this.toRgbString()),R==="prgb"&&(P=this.toPercentageRgbString()),(R==="hex"||R==="hex6")&&(P=this.toHexString()),R==="hex3"&&(P=this.toHexString(!0)),R==="hex4"&&(P=this.toHex8String(!0)),R==="hex8"&&(P=this.toHex8String()),R==="name"&&(P=this.toName()),R==="hsl"&&(P=this.toHslString()),R==="hsv"&&(P=this.toHsvString()),P||this.toHexString())},clone:function(){return l(this.toString())},_applyModification:function(R,q){var P=R.apply(null,[this].concat([].slice.call(q)));return this._r=P._r,this._g=P._g,this._b=P._b,this.setAlpha(P._a),this},lighten:function(){return this._applyModification(C,arguments)},brighten:function(){return this._applyModification(S,arguments)},darken:function(){return this._applyModification(k,arguments)},desaturate:function(){return this._applyModification(y,arguments)},saturate:function(){return this._applyModification(b,arguments)},greyscale:function(){return this._applyModification(v,arguments)},spin:function(){return this._applyModification(N,arguments)},_applyCombination:function(R,q){return R.apply(null,[this].concat([].slice.call(q)))},analogous:function(){return this._applyCombination(K,arguments)},complement:function(){return this._applyCombination(D,arguments)},monochromatic:function(){return this._applyCombination(X,arguments)},splitcomplement:function(){return this._applyCombination(V,arguments)},triad:function(){return this._applyCombination($,arguments)},tetrad:function(){return this._applyCombination(O,arguments)}},l.fromRatio=function(R,q){if(typeof R=="object"){var P={};for(var ie in R)R.hasOwnProperty(ie)&&(ie==="a"?P[ie]=R[ie]:P[ie]=le(R[ie]));R=P}return l(R,q)};function u(R){var q={r:0,g:0,b:0},P=1,ie=null,pe=null,fe=null,Se=!1,at=!1;return typeof R=="string"&&(R=Ve(R)),typeof R=="object"&&(Te(R.r)&&Te(R.g)&&Te(R.b)?(q=c(R.r,R.g,R.b),Se=!0,at=String(R.r).substr(-1)==="%"?"prgb":"rgb"):Te(R.h)&&Te(R.s)&&Te(R.v)?(ie=le(R.s),pe=le(R.v),q=m(R.h,ie,pe),Se=!0,at="hsv"):Te(R.h)&&Te(R.s)&&Te(R.l)&&(ie=le(R.s),fe=le(R.l),q=f(R.h,ie,fe),Se=!0,at="hsl"),R.hasOwnProperty("a")&&(P=R.a)),P=Z(P),{ok:Se,format:R.format||at,r:s(255,i(q.r,0)),g:s(255,i(q.g,0)),b:s(255,i(q.b,0)),a:P}}function c(R,q,P){return{r:Q(R,255)*255,g:Q(q,255)*255,b:Q(P,255)*255}}function p(R,q,P){R=Q(R,255),q=Q(q,255),P=Q(P,255);var ie=i(R,q,P),pe=s(R,q,P),fe,Se,at=(ie+pe)/2;if(ie==pe)fe=Se=0;else{var We=ie-pe;switch(Se=at>.5?We/(2-ie-pe):We/(ie+pe),ie){case R:fe=(q-P)/We+(q<P?6:0);break;case q:fe=(P-R)/We+2;break;case P:fe=(R-q)/We+4;break}fe/=6}return{h:fe,s:Se,l:at}}function f(R,q,P){var ie,pe,fe;R=Q(R,360),q=Q(q,100),P=Q(P,100);function Se(Mt,mt,he){return he<0&&(he+=1),he>1&&(he-=1),he<1/6?Mt+(mt-Mt)*6*he:he<1/2?mt:he<2/3?Mt+(mt-Mt)*(2/3-he)*6:Mt}if(q===0)ie=pe=fe=P;else{var at=P<.5?P*(1+q):P+q-P*q,We=2*P-at;ie=Se(We,at,R+1/3),pe=Se(We,at,R),fe=Se(We,at,R-1/3)}return{r:ie*255,g:pe*255,b:fe*255}}function d(R,q,P){R=Q(R,255),q=Q(q,255),P=Q(P,255);var ie=i(R,q,P),pe=s(R,q,P),fe,Se,at=ie,We=ie-pe;if(Se=ie===0?0:We/ie,ie==pe)fe=0;else{switch(ie){case R:fe=(q-P)/We+(q<P?6:0);break;case q:fe=(P-R)/We+2;break;case P:fe=(R-q)/We+4;break}fe/=6}return{h:fe,s:Se,v:at}}function m(R,q,P){R=Q(R,360)*6,q=Q(q,100),P=Q(P,100);var ie=t.floor(R),pe=R-ie,fe=P*(1-q),Se=P*(1-pe*q),at=P*(1-(1-pe)*q),We=ie%6,Mt=[P,Se,fe,fe,at,P][We],mt=[at,P,P,Se,fe,fe][We],he=[fe,fe,at,P,P,Se][We];return{r:Mt*255,g:mt*255,b:he*255}}function h(R,q,P,ie){var pe=[ae(o(R).toString(16)),ae(o(q).toString(16)),ae(o(P).toString(16))];return ie&&pe[0].charAt(0)==pe[0].charAt(1)&&pe[1].charAt(0)==pe[1].charAt(1)&&pe[2].charAt(0)==pe[2].charAt(1)?pe[0].charAt(0)+pe[1].charAt(0)+pe[2].charAt(0):pe.join("")}function g(R,q,P,ie,pe){var fe=[ae(o(R).toString(16)),ae(o(q).toString(16)),ae(o(P).toString(16)),ae(me(ie))];return pe&&fe[0].charAt(0)==fe[0].charAt(1)&&fe[1].charAt(0)==fe[1].charAt(1)&&fe[2].charAt(0)==fe[2].charAt(1)&&fe[3].charAt(0)==fe[3].charAt(1)?fe[0].charAt(0)+fe[1].charAt(0)+fe[2].charAt(0)+fe[3].charAt(0):fe.join("")}function x(R,q,P,ie){var pe=[ae(me(ie)),ae(o(R).toString(16)),ae(o(q).toString(16)),ae(o(P).toString(16))];return pe.join("")}l.equals=function(R,q){return!R||!q?!1:l(R).toRgbString()==l(q).toRgbString()},l.random=function(){return l.fromRatio({r:a(),g:a(),b:a()})};function y(R,q){q=q===0?0:q||10;var P=l(R).toHsl();return P.s-=q/100,P.s=se(P.s),l(P)}function b(R,q){q=q===0?0:q||10;var P=l(R).toHsl();return P.s+=q/100,P.s=se(P.s),l(P)}function v(R){return l(R).desaturate(100)}function C(R,q){q=q===0?0:q||10;var P=l(R).toHsl();return P.l+=q/100,P.l=se(P.l),l(P)}function S(R,q){q=q===0?0:q||10;var P=l(R).toRgb();return P.r=i(0,s(255,P.r-o(255*-(q/100)))),P.g=i(0,s(255,P.g-o(255*-(q/100)))),P.b=i(0,s(255,P.b-o(255*-(q/100)))),l(P)}function k(R,q){q=q===0?0:q||10;var P=l(R).toHsl();return P.l-=q/100,P.l=se(P.l),l(P)}function N(R,q){var P=l(R).toHsl(),ie=(P.h+q)%360;return P.h=ie<0?360+ie:ie,l(P)}function D(R){var q=l(R).toHsl();return q.h=(q.h+180)%360,l(q)}function $(R){var q=l(R).toHsl(),P=q.h;return[l(R),l({h:(P+120)%360,s:q.s,l:q.l}),l({h:(P+240)%360,s:q.s,l:q.l})]}function O(R){var q=l(R).toHsl(),P=q.h;return[l(R),l({h:(P+90)%360,s:q.s,l:q.l}),l({h:(P+180)%360,s:q.s,l:q.l}),l({h:(P+270)%360,s:q.s,l:q.l})]}function V(R){var q=l(R).toHsl(),P=q.h;return[l(R),l({h:(P+72)%360,s:q.s,l:q.l}),l({h:(P+216)%360,s:q.s,l:q.l})]}function K(R,q,P){q=q||6,P=P||30;var ie=l(R).toHsl(),pe=360/P,fe=[l(R)];for(ie.h=(ie.h-(pe*q>>1)+720)%360;--q;)ie.h=(ie.h+pe)%360,fe.push(l(ie));return fe}function X(R,q){q=q||6;for(var P=l(R).toHsv(),ie=P.h,pe=P.s,fe=P.v,Se=[],at=1/q;q--;)Se.push(l({h:ie,s:pe,v:fe})),fe=(fe+at)%1;return Se}l.mix=function(R,q,P){P=P===0?0:P||50;var ie=l(R).toRgb(),pe=l(q).toRgb(),fe=P/100,Se={r:(pe.r-ie.r)*fe+ie.r,g:(pe.g-ie.g)*fe+ie.g,b:(pe.b-ie.b)*fe+ie.b,a:(pe.a-ie.a)*fe+ie.a};return l(Se)},l.readability=function(R,q){var P=l(R),ie=l(q);return(t.max(P.getLuminance(),ie.getLuminance())+.05)/(t.min(P.getLuminance(),ie.getLuminance())+.05)},l.isReadable=function(R,q,P){var ie=l.readability(R,q),pe,fe;switch(fe=!1,pe=qe(P),pe.level+pe.size){case"AAsmall":case"AAAlarge":fe=ie>=4.5;break;case"AAlarge":fe=ie>=3;break;case"AAAsmall":fe=ie>=7;break}return fe},l.mostReadable=function(R,q,P){var ie=null,pe=0,fe,Se,at,We;P=P||{},Se=P.includeFallbackColors,at=P.level,We=P.size;for(var Mt=0;Mt<q.length;Mt++)fe=l.readability(R,q[Mt]),fe>pe&&(pe=fe,ie=l(q[Mt]));return l.isReadable(R,ie,{level:at,size:We})||!Se?ie:(P.includeFallbackColors=!1,l.mostReadable(R,["#fff","#000"],P))};var W=l.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},H=l.hexNames=Y(W);function Y(R){var q={};for(var P in R)R.hasOwnProperty(P)&&(q[R[P]]=P);return q}function Z(R){return R=parseFloat(R),(isNaN(R)||R<0||R>1)&&(R=1),R}function Q(R,q){re(R)&&(R="100%");var P=ue(R);return R=s(q,i(0,parseFloat(R))),P&&(R=parseInt(R*q,10)/100),t.abs(R-q)<1e-6?1:R%q/parseFloat(q)}function se(R){return s(1,i(0,R))}function ne(R){return parseInt(R,16)}function re(R){return typeof R=="string"&&R.indexOf(".")!=-1&&parseFloat(R)===1}function ue(R){return typeof R=="string"&&R.indexOf("%")!=-1}function ae(R){return R.length==1?"0"+R:""+R}function le(R){return R<=1&&(R=R*100+"%"),R}function me(R){return t.round(parseFloat(R)*255).toString(16)}function ke(R){return ne(R)/255}var ve=function(){var R="[-\\+]?\\d+%?",q="[-\\+]?\\d*\\.\\d+%?",P="(?:"+q+")|(?:"+R+")",ie="[\\s|\\(]+("+P+")[,|\\s]+("+P+")[,|\\s]+("+P+")\\s*\\)?",pe="[\\s|\\(]+("+P+")[,|\\s]+("+P+")[,|\\s]+("+P+")[,|\\s]+("+P+")\\s*\\)?";return{CSS_UNIT:new RegExp(P),rgb:new RegExp("rgb"+ie),rgba:new RegExp("rgba"+pe),hsl:new RegExp("hsl"+ie),hsla:new RegExp("hsla"+pe),hsv:new RegExp("hsv"+ie),hsva:new RegExp("hsva"+pe),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();function Te(R){return!!ve.CSS_UNIT.exec(R)}function Ve(R){R=R.replace(e,"").replace(r,"").toLowerCase();var q=!1;if(W[R])R=W[R],q=!0;else if(R=="transparent")return{r:0,g:0,b:0,a:0,format:"name"};var P;return(P=ve.rgb.exec(R))?{r:P[1],g:P[2],b:P[3]}:(P=ve.rgba.exec(R))?{r:P[1],g:P[2],b:P[3],a:P[4]}:(P=ve.hsl.exec(R))?{h:P[1],s:P[2],l:P[3]}:(P=ve.hsla.exec(R))?{h:P[1],s:P[2],l:P[3],a:P[4]}:(P=ve.hsv.exec(R))?{h:P[1],s:P[2],v:P[3]}:(P=ve.hsva.exec(R))?{h:P[1],s:P[2],v:P[3],a:P[4]}:(P=ve.hex8.exec(R))?{r:ne(P[1]),g:ne(P[2]),b:ne(P[3]),a:ke(P[4]),format:q?"name":"hex8"}:(P=ve.hex6.exec(R))?{r:ne(P[1]),g:ne(P[2]),b:ne(P[3]),format:q?"name":"hex"}:(P=ve.hex4.exec(R))?{r:ne(P[1]+""+P[1]),g:ne(P[2]+""+P[2]),b:ne(P[3]+""+P[3]),a:ke(P[4]+""+P[4]),format:q?"name":"hex8"}:(P=ve.hex3.exec(R))?{r:ne(P[1]+""+P[1]),g:ne(P[2]+""+P[2]),b:ne(P[3]+""+P[3]),format:q?"name":"hex"}:!1}function qe(R){var q,P;return R=R||{level:"AA",size:"small"},q=(R.level||"AA").toUpperCase(),P=(R.size||"small").toLowerCase(),q!=="AA"&&q!=="AAA"&&(q="AA"),P!=="small"&&P!=="large"&&(P="small"),{level:q,size:P}}typeof ZN<"u"&&ZN.exports?ZN.exports=l:typeof define=="function"&&define.amd?define(function(){return l}):window.tinycolor=l})(Math)});var GY=Ye(bF=>{"use strict";var WY=iR();bF.createRoot=WY.createRoot,bF.hydrateRoot=WY.hydrateRoot;var grr});var kp=class{constructor(e,r){this.backend=e,this.dataMover=r,this.data=new WeakMap,this.dataIdsCount=0}get(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}set(e,r){this.dataIdsCount++,this.data.set(e,r)}has(e){return this.data.has(e)}delete(e){return this.dataIdsCount--,this.data.delete(e)}numDataIds(){return this.dataIdsCount}},ya=class{refCount(e){return wo("refCount")}incRef(e){return wo("incRef")}timerAvailable(){return!0}time(e){return wo("time")}read(e){return wo("read")}readSync(e){return wo("readSync")}readToGPU(e,r){return wo("readToGPU")}numDataIds(){return wo("numDataIds")}disposeData(e,r){return wo("disposeData")}write(e,r,n){return wo("write")}move(e,r,n,o,s){return wo("move")}createTensorFromTexture(e,r,n){return wo("createTensorFromTexture")}memory(){return wo("memory")}floatPrecision(){return wo("floatPrecision")}epsilon(){return this.floatPrecision()===32?1e-7:1e-4}dispose(){return wo("dispose")}};function wo(t){throw new Error(`'${t}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}function IF(t){let e=t.length,r=0;for(;e>0;)r=Math.random()*e|0,e--,Rv(t,e,r)}function xQ(t,e){if(t.length!==e.length)throw new Error(`Array sizes must match to be shuffled together First array length was ${t.length}Second array length was ${e.length}`);let r=t.length,n=0;for(;r>0;)n=Math.random()*r|0,r--,Rv(t,r,n),Rv(e,r,n)}function _d(t,e,r){return Math.max(t,Math.min(e,r))}function yQ(t){return t%2===0?t:t+1}function Rv(t,e,r){let n=t[e];t[e]=t[r],t[r]=n}function bQ(t){let e=0;for(let r=0;r<t.length;r++)e+=t[r];return e}function vQ(t,e){let r=Math.random();return e*r+(1-r)*t}function wQ(t,e){let r=0;for(let n=0;n<t.length;n++){let o=Number(t[n])-Number(e[n]);r+=o*o}return r}function A(t,e){if(!t)throw new Error(typeof e=="string"?e:e())}function Ov(t,e,r=""){A(yu(t,e),()=>r+` Shapes ${t} and ${e} must match`)}function Np(t){A(t!=null,()=>"The input to the tensor constructor must be a non-null value.")}function xu(t,e=[],r=!1){if(e==null&&(e=[]),Array.isArray(t)||Co(t)&&!r)for(let n=0;n<t.length;++n)xu(t[n],e,r);else e.push(t);return e}function lt(t){if(t.length===0)return 1;let e=t[0];for(let r=1;r<t.length;r++)e*=t[r];return e}function CQ(t){return t.length===0}function yu(t,e){if(t===e)return!0;if(t==null||e==null||t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function ba(t){return t%1===0}function SQ(t){if(Math.tanh!=null)return Math.tanh(t);if(t===1/0)return 1;if(t===-1/0)return-1;{let e=Math.exp(2*t);return(e-1)/(e+1)}}function kQ(t){let e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]}function TQ(t){let e=new Uint32Array(t);for(let r=0;r<t;++r)e[r]=r;return IF(e),e}function Ip(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function NQ(t,e=o=>0,r,n){return new Promise((o,s)=>{let i=0,a=()=>{if(t()){o();return}i++;let l=e(i);if(r!=null&&i>=r){s();return}n!=null?n(a,l):setTimeout(a,l)};a()})}function IQ(t,e){let r=1,n=-1;for(let s=0;s<t.length;++s)if(t[s]>=0)r*=t[s];else if(t[s]===-1){if(n!==-1)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${n} and dim ${s}`);n=s}else if(t[s]<0)throw Error(`Shapes can not be < 0. Found ${t[s]} at dim ${s}`);if(n===-1){if(e>0&&e!==r)throw Error(`Size(${e}) must match the product of shape ${t}`);return t}if(r===0)throw Error(`Cannot infer the missing size in [${t}] when there are 0 elements`);if(e%r!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${r}`);let o=t.slice();return o[n]=e/r,o}function Ar(t,e){let r=e.length;return t=t==null?e.map((n,o)=>o):[].concat(t),A(t.every(n=>n>=-r&&n<r),()=>`All values in axis param must be in range [-${r}, ${r}) but got axis ${t}`),A(t.every(n=>ba(n)),()=>`All values in axis param must be integers but got axis ${t}`),t.map(n=>n<0?r+n:n)}function wI(t,e){let r=[],n=[],o=e!=null&&Array.isArray(e)&&e.length===0,s=e==null||o?null:Ar(e,t).sort(),i=0;for(let a=0;a<t.length;++a){if(s!=null){if(s[i]===a&&t[a]!==1)throw new Error(`Can't squeeze axis ${a} since its dim '${t[a]}' is not 1`);(s[i]==null||s[i]>a)&&t[a]===1&&(r.push(t[a]),n.push(a)),s[i]<=a&&i++}t[a]!==1&&(r.push(t[a]),n.push(a))}return{newShape:r,keptDims:n}}function EQ(t,e){let r=null;if(t==null||t==="float32")r=new Float32Array(e);else if(t==="int32")r=new Int32Array(e);else if(t==="bool")r=new Uint8Array(e);else throw new Error(`Unknown data type ${t}`);return r}function CI(t,e){let r=null;if(t==null||t==="float32")r=new Float32Array(e);else if(t==="int32")r=new Int32Array(e);else if(t==="bool")r=new Uint8Array(e);else if(t==="string")r=new Array(e);else throw new Error(`Unknown data type ${t}`);return r}function SI(t,e){for(let r=0;r<t.length;r++){let n=t[r];if(isNaN(n)||!isFinite(n))throw Error(`A tensor of type ${e} being uploaded contains ${n}.`)}}function kI(t){return t==="bool"||t==="complex64"||t==="float32"||t==="int32"||t==="string"}function _Q(t,e){return!(e==="complex64"||e==="float32"&&t!=="complex64"||e==="int32"&&t!=="float32"&&t!=="complex64"||e==="bool"&&t==="bool")}function Co(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray}function Fv(t){if(t==="float32"||t==="int32")return 4;if(t==="complex64")return 8;if(t==="bool")return 1;throw new Error(`Unknown dtype ${t}`)}function TI(t){if(t==null)return 0;let e=0;return t.forEach(r=>e+=r.length),e}function Ad(t){return typeof t=="string"||t instanceof String}function EF(t){return typeof t=="boolean"}function _F(t){return typeof t=="number"}function Dd(t){return Array.isArray(t)?Dd(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray?"int32":_F(t)?"float32":Ad(t)?"string":EF(t)?"bool":"float32"}function $d(t){return!!(t&&t.constructor&&t.call&&t.apply)}function Rd(t,e){for(let r=e;r<t;++r)if(t%r===0)return r;return t}function $i(t){let e=t.length;if(e<2)return[];let r=new Array(e-1);r[e-2]=t[e-1];for(let n=e-3;n>=0;--n)r[n]=r[n+1]*t[n+1];return r}function AF(t,e,r,n=!1){let o=new Array;if(e.length===1){let s=e[0]*(n?2:1);for(let i=0;i<s;i++)o[i]=r[t+i]}else{let s=e[0],i=e.slice(1),a=i.reduce((l,u)=>l*u)*(n?2:1);for(let l=0;l<s;l++)o[l]=AF(t+l*a,i,r,n)}return o}function Tp(t,e,r=!1){if(t.length===0)return e[0];let n=t.reduce((o,s)=>o*s)*(r?2:1);if(n===0)return[];if(n!==e.length)throw new Error(`[${t}] does not match the input size ${e.length}${r?" for a complex tensor":""}.`);return AF(0,t,e,r)}function px(t,e){let r=Od(t,e);for(let n=0;n<r.length;n++)r[n]=1;return r}function Od(t,e){if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool")return new Uint8Array(t);throw new Error(`Unknown data type ${e}`)}function AQ(t,e){let r=t.reduce((n,o)=>n*o,1);if(e==null||e==="float32")return Tp(t,new Float32Array(r));if(e==="int32")return Tp(t,new Int32Array(r));if(e==="bool")return Tp(t,new Uint8Array(r));throw new Error(`Unknown data type ${e}`)}function tn(t){t.forEach(e=>{A(Number.isInteger(e)&&e>=0,()=>`Tensor must have a shape comprised of positive integers but got shape [${t}].`)})}function DQ(t,e,r){if(e===0)return 0;if(e===1)return t[0];let n=t[t.length-1];for(let o=0;o<t.length-1;++o)n+=r[o]*t[o];return n}function $Q(t,e,r){if(e===0)return[];if(e===1)return[t];let n=new Array(e);for(let o=0;o<n.length-1;++o)n[o]=Math.floor(t/r[o]),t-=n[o]*r[o];return n[n.length-1]=t,n}function fx(t){return t&&t.then&&typeof t.then=="function"}var DF="tfjsflags",dx=class{constructor(e){this.global=e,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=OQ,this.populateURLFlags()}setPlatform(e,r){this.platform!=null&&(B().getBool("IS_TEST")||B().getBool("PROD")||console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`)),this.platformName=e,this.platform=r}registerFlag(e,r,n){if(this.flagRegistry[e]={evaluationFn:r,setHook:n},this.urlFlags[e]!=null){let o=this.urlFlags[e];B().getBool("IS_TEST")||B().getBool("PROD")||console.warn(`Setting feature override from URL ${e}: ${o}.`),this.set(e,o)}}async getAsync(e){return e in this.flags?this.flags[e]:(this.flags[e]=await this.evaluateFlag(e),this.flags[e])}get(e){if(e in this.flags)return this.flags[e];let r=this.evaluateFlag(e);if(fx(r))throw new Error(`Flag ${e} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[e]=r,this.flags[e]}getNumber(e){return this.get(e)}getBool(e){return this.get(e)}getFlags(){return this.flags}get features(){return this.flags}set(e,r){if(this.flagRegistry[e]==null)throw new Error(`Cannot set flag ${e} as it has not been registered.`);this.flags[e]=r,this.flagRegistry[e].setHook!=null&&this.flagRegistry[e].setHook(r)}evaluateFlag(e){if(this.flagRegistry[e]==null)throw new Error(`Cannot evaluate flag '${e}': no evaluation function found.`);return this.flagRegistry[e].evaluationFn()}setFlags(e){this.flags=Object.assign({},e)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if(typeof this.global>"u"||typeof this.global.location>"u"||typeof this.global.location.search>"u")return;let e=this.getQueryParams(this.global.location.search);DF in e&&e[DF].split(",").forEach(n=>{let[o,s]=n.split(":");this.urlFlags[o]=PQ(o,s)})}};function OQ(t){let e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(r,...n)=>(FQ(e,n[0],n[1]),n.join("="))),e}function FQ(t,e,r){t[decodeURIComponent(e)]=decodeURIComponent(r||"")}function PQ(t,e){if(e=e.toLowerCase(),e==="true"||e==="false")return e==="true";if(`${+e}`===e)return+e;throw new Error(`Could not parse value flag value ${e} for flag ${t}.`)}function B(){return NI}var NI=null;function $F(t){NI=t}var II;function EI(){if(II==null){let t;if(typeof window<"u")t=window;else if(typeof global<"u")t=global;else if(typeof process<"u")t=process;else if(typeof self<"u")t=self;else throw new Error("Could not find a global object");II=t}return II}function LQ(){let t=EI();return t._tfGlobals==null&&(t._tfGlobals=new Map),t._tfGlobals}function mx(t,e){let r=LQ();if(r.has(t))return r.get(t);{let n=e();return r.set(t,n),r.get(t)}}var bu="Abs",va="Acos",wa="Acosh",ti="Add",Fd="AddN",Pd="All",Ld="Any",vu="ArgMax",wu="ArgMin",Ca="Asin",Sa="Asinh",ka="Atan",Ta="Atanh",Na="Atan2",Cu="AvgPool",Md="AvgPoolGrad",Su="AvgPool3D",zd="AvgPool3DGrad",ku="BatchMatMul",Tu="BatchToSpaceND",Bd="Bincount",RF="BroadcastTo",Pv="BroadcastArgs",Ri="Cast",Ia="Ceil",Ea="ClipByValue",Vd="Complex",Nu="ComplexAbs",Iu="Concat",Eu="Conv2D",Wd="Conv2DBackpropFilter",_u="Conv2DBackpropInput",Au="Conv3D",Gd="Conv3DBackpropFilterV2",Ud="Conv3DBackpropInputV2",_a="Cos",Aa="Cosh",Hd="Cumprod",Du="Cumsum",qd="CropAndResize",jd="DenseBincount",Kd="DepthToSpace",$u="DepthwiseConv2dNative",Xd="DepthwiseConv2dNativeBackpropFilter",Yd="DepthwiseConv2dNativeBackpropInput",Lv="Diag",Ru="Dilation2D",hx="Dilation2DBackpropInput",gx="Dilation2DBackpropFilter",Da="RealDiv",Qd="Einsum",$a="Elu",Zd="EluGrad",Ra="Erf",Ep="Equal",Oa="Exp",Ou="ExpandDims",Fa="Expm1",Jd="FFT",em="Fill",tm="FlipLeftRight",Pa="Floor",La="FloorDiv",Fu="FusedBatchNorm",Pu="GatherV2",Mv="GatherNd",_p="Greater",Ma="GreaterEqual",Oi="Identity",rm="IFFT",nm="Imag",za="IsFinite",Ba="IsInf",Va="IsNan",Lu="LeakyRelu",Ap="Less",Dp="LessEqual",zv="LinSpace",Wa="Log",Ga="Log1p",$p="LogicalAnd",Rp="LogicalNot",Op="LogicalOr";var OF="LogSoftmax";var Mu="LRN",om="LRNGrad",zu="Max",Ua="Maximum",Bu="MaxPool",sm="MaxPoolGrad",Vu="MaxPool3D",im="MaxPool3DGrad",Bv="MaxPoolWithArgmax",Wu="Mean",Gu="Min",Ha="Minimum",Uu="MirrorPad",qa="Mod",Vv="Multinomial",ja="Multiply",Hu="Neg",Fp="NotEqual",am="NonMaxSuppressionV3",lm="NonMaxSuppressionV4",um="NonMaxSuppressionV5",qu="OnesLike",ju="OneHot",Ku="Pack",Xu="PadV2";var Ka="Pow",Yu="Prelu",Qu="Prod",Wv="RaggedGather",Gv="RaggedRange",Uv="RaggedTensorToTensor",cm="Range",pm="Real",Xa="Reciprocal",Ya="Relu",Zu="Reshape",Ju="ResizeNearestNeighbor",fm="ResizeNearestNeighborGrad",ec="ResizeBilinear",dm="ResizeBilinearGrad",Qa="Relu6",tc="Reverse",Za="Round",Ja="Rsqrt",Hv="ScatterNd",qv="SearchSorted",rc="Select",el="Selu",nc="Slice",tl="Sin",rl="Sinh",nl="Sign",ol="Sigmoid",sl="Softplus",il="Sqrt",oc="Sum",sc="SpaceToBatchND",ic="SplitV",ac="Softmax",jv="SparseFillEmptyRows",Kv="SparseReshape",Xv="SparseSegmentMean",Yv="SparseSegmentSum",Qv="SparseToDense",al="SquaredDifference",mm="Square",hm="StridedSlice",Zv="StringNGrams",Jv="StringSplit",e1="StringToHashBucketFast",ll="Sub",ul="Tan",cl="Tanh",Fi="Tile",gm="TopK",xm="Transform",Pi="Transpose",ym="Unique",lc="Unpack",uc="UnsortedSegmentSum";var cc="ZerosLike",pl="Step",xx="FromPixels",bm="RotateWithOffset",Pp="_FusedMatMul",Lp="FusedConv2D",Mp="FusedDepthwiseConv2D";function Li(...t){B().getBool("IS_TEST")||B().getBool("PROD")||console.warn(...t)}function MQ(...t){B().getBool("IS_TEST")||B().getBool("PROD")||console.log(...t)}var t1=mx("kernelRegistry",()=>new Map),_I=mx("gradRegistry",()=>new Map);function yx(t,e){let r=LF(t,e);return t1.get(r)}function AI(t){return _I.get(t)}function DI(t){let e=t1.entries(),r=[];for(;;){let{done:n,value:o}=e.next();if(n)break;let[s,i]=o,[a]=s.split("_");a===t&&r.push(i)}return r}function r1(t){let{kernelName:e,backendName:r}=t,n=LF(e,r);t1.has(n)&&Li(`The kernel '${e}' for backend '${r}' is already registered`),t1.set(n,t)}function PF(t){let{kernelName:e}=t;_I.has(e)&&B().getBool("DEBUG")&&Li(`Overriding the gradient for '${e}'`),_I.set(e,t)}function LF(t,e){return`${e}_${t}`}var w={};Ho(w,{arraysEqual:()=>yu,assert:()=>A,assertNonNegativeIntegerDimensions:()=>tn,assertNonNull:()=>Np,assertShapesMatch:()=>Ov,bytesFromStringArray:()=>TI,bytesPerElement:()=>Fv,checkConversionForErrors:()=>SI,clamp:()=>_d,computeStrides:()=>$i,createScalarValue:()=>HQ,createShuffledIndices:()=>TQ,decodeString:()=>km,distSquared:()=>wQ,encodeString:()=>Sm,fetch:()=>jQ,fingerPrint64:()=>UQ,flatten:()=>xu,getArrayFromDType:()=>CI,getTypedArrayFromDType:()=>EQ,hasEncodingLoss:()=>_Q,hexToLong:()=>bx,indexToLoc:()=>$Q,inferDtype:()=>Dd,inferFromImplicitShape:()=>IQ,isBoolean:()=>EF,isFunction:()=>$d,isInt:()=>ba,isNumber:()=>_F,isPromise:()=>fx,isScalarShape:()=>CQ,isString:()=>Ad,isTypedArray:()=>Co,isValidDtype:()=>kI,locToIndex:()=>DQ,makeOnesTypedArray:()=>px,makeZerosNestedTypedArray:()=>AQ,makeZerosTypedArray:()=>Od,nearestDivisor:()=>Rd,nearestLargerEven:()=>yQ,now:()=>Gp,parseAxisParam:()=>Ar,randUniform:()=>vQ,repeatedTry:()=>NQ,rightPad:()=>Ip,shuffle:()=>IF,shuffleCombo:()=>xQ,sizeFromShape:()=>lt,sizeToSquarishShape:()=>kQ,squeezeShape:()=>wI,sum:()=>bQ,swap:()=>Rv,tanh:()=>SQ,toNestedArray:()=>Tp,toTypedArray:()=>Cm});var FI=rt(KF());var Wp=FI.default||FI;function bx(t){return Wp.fromString(t,!0,16)}var YF=bx("c3a5c85c97cb3127"),Vp=bx("b492b66fbe98f273"),Un=bx("9ae16a3b2f90404f");function OI(t){return t.xor(t.shru(47))}function QF(t,e,r){let n=t.slice(e,e+r);return Wp.fromBytes(Array.from(n),!0,!0)}function jt(t,e){return QF(t,e,8)}function XF(t,e){return QF(t,e,4)}function rn(t,e){return e===0?t:t.shru(e).or(t.shl(64-e))}function pc(t,e,r=bx("9ddfea08eb382d69")){let n=t.xor(e).mul(r);n=n.xor(n.shru(47));let o=e.xor(n).mul(r);return o=o.xor(o.shru(47)),o=o.mul(r),o}function BQ(t,e,r,n,o,s){o=o.add(t),s=rn(s.add(o).add(n),21);let i=o;return o=o.add(e),o=o.add(r),s=s.add(rn(o,44)),[o.add(n),s.add(i)]}function o1(t,e,r,n){return BQ(jt(t,e),jt(t,e+8),jt(t,e+16),jt(t,e+24),r,n)}function VQ(t,e=t.length){if(e>=8){let r=Un.add(e*2),n=jt(t,0).add(Un),o=jt(t,e-8),s=rn(o,37).mul(r).add(n),i=rn(n,25).add(o).mul(r);return pc(s,i,r)}if(e>=4){let r=Un.add(e*2),n=XF(t,0);return pc(n.shl(3).add(e),XF(t,e-4),r)}if(e>0){let r=t[0],n=t[e>>1],o=t[e-1],s=r+(n<<8),i=e+(o<<2);return OI(Un.mul(s).xor(YF.mul(i))).mul(Un)}return Un}function WQ(t,e=t.length){let r=Un.add(e*2),n=jt(t,0).mul(Vp),o=jt(t,8),s=jt(t,e-8).mul(r),i=jt(t,e-16).mul(Un);return pc(rn(n.add(o),43).add(rn(s,30)).add(i),n.add(rn(o.add(Un),18)).add(s),r)}function GQ(t,e=t.length){let r=Un.add(e*2),n=jt(t,0).mul(Un),o=jt(t,8),s=jt(t,e-8).mul(r),i=jt(t,e-16).mul(Un),a=rn(n.add(o),43).add(rn(s,30)).add(i),l=pc(a,n.add(rn(o.add(Un),18)).add(s),r),u=jt(t,16).mul(r),c=jt(t,24),p=a.add(jt(t,e-32)).mul(r),f=l.add(jt(t,e-24)).mul(r);return pc(rn(u.add(c),43).add(rn(p,30)).add(f),u.add(rn(c.add(n),18)).add(p),r)}function UQ(t,e=t.length){let r=Wp.fromNumber(81,!0);if(e<=32)return e<=16?VQ(t,e):WQ(t,e);if(e<=64)return GQ(t,e);let n=r,o=r.mul(Vp).add(113),s=OI(o.mul(Un).add(113)).mul(Un),i=[Wp.UZERO,Wp.UZERO],a=[Wp.UZERO,Wp.UZERO];n=n.mul(Un).add(jt(t,0));let l=0,u=(e-1>>6)*64,c=u+(e-1&63)-63;do n=rn(n.add(o).add(i[0]).add(jt(t,l+8)),37).mul(Vp),o=rn(o.add(i[1]).add(jt(t,l+48)),42).mul(Vp),n=n.xor(a[1]),o=o.add(i[0]).add(jt(t,l+40)),s=rn(s.add(a[0]),33).mul(Vp),i=o1(t,l,i[1].mul(Vp),n.add(a[0])),a=o1(t,l+32,s.add(a[1]),o.add(jt(t,l+16))),[s,n]=[n,s],l+=64;while(l!==u);let p=Vp.add(s.and(255).shl(1));return l=c,a[0]=a[0].add(e-1&63),i[0]=i[0].add(a[0]),a[0]=a[0].add(i[0]),n=rn(n.add(o).add(i[0]).add(jt(t,l+8)),37).mul(p),o=rn(o.add(i[1]).add(jt(t,l+48)),42).mul(p),n=n.xor(a[1].mul(9)),o=o.add(i[0].mul(9).add(jt(t,l+40))),s=rn(s.add(a[0]),33).mul(p),i=o1(t,l,i[1].mul(p),n.add(a[0])),a=o1(t,l+32,s.add(a[1]),o.add(jt(t,l+16))),[s,n]=[n,s],pc(pc(i[0],a[0],p).add(OI(o).mul(YF)).add(s),pc(i[1],a[1],p).add(n),p)}function HQ(t,e){return e==="string"?Sm(t):Cm([t],e)}function qQ(t,e){return t instanceof Float32Array&&e==="float32"||t instanceof Int32Array&&e==="int32"||t instanceof Uint8Array&&e==="bool"}function Cm(t,e){if(e==="string")throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=xu(t)),B().getBool("DEBUG")&&SI(t,e),qQ(t,e))return t;if(e==null||e==="float32"||e==="complex64")return new Float32Array(t);if(e==="int32")return new Int32Array(t);if(e==="bool"){let r=new Uint8Array(t.length);for(let n=0;n<r.length;++n)Math.round(t[n])!==0&&(r[n]=1);return r}else throw new Error(`Unknown data type ${e}`)}function Gp(){return B().platform.now()}function jQ(t,e){return B().platform.fetch(t,e)}function Sm(t,e="utf-8"){return e=e||"utf-8",B().platform.encode(t,e)}function km(t,e="utf-8"){return e=e||"utf-8",B().platform.decode(t,e)}var s1=class{constructor(e,r){this.backendTimer=e,this.logger=r,r==null&&(this.logger=new PI)}profileKernel(e,r,n){let o,s=()=>{o=n()},i,a=Gp();if(this.backendTimer.timerAvailable())i=this.backendTimer.time(s);else{s();for(let u of o)u.dataSync();i=Promise.resolve({kernelMs:Gp()-a})}if(B().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let u=0;u<o.length;u++){let c=o[u];c.data().then(p=>{KQ(p,c.dtype,e)})}return{kernelName:e,outputs:o,inputs:r,timeMs:i.then(u=>u.kernelMs),extraInfo:i.then(u=>u.getExtraProfileInfo!=null?u.getExtraProfileInfo():"")}}logKernelProfile(e){let{kernelName:r,outputs:n,timeMs:o,inputs:s,extraInfo:i}=e;n.forEach(a=>{Promise.all([a.data(),o,i]).then(l=>{this.logger.logKernelProfile(r,a,l[0],l[1],s,l[2])})})}};function KQ(t,e,r){if(e!=="float32")return!1;for(let n=0;n<t.length;n++){let o=t[n];if(isNaN(o)||!isFinite(o))return console.warn(`Found ${o} in the result of '${r}'`),!0}return!1}var PI=class{logKernelProfile(e,r,n,o,s,i){let a=typeof o=="number"?Ip(`${o}ms`,9):o.error,l=Ip(e,25),u=r.rank,c=r.size,p=Ip(r.shape.toString(),14),f="";for(let d in s){let m=s[d];if(m!=null){let h=m.shape||r.shape,g=h.length;f+=`${d}: ${g}D ${g>0?h:""} `}}console.log(`%c${l}	%c${a}	%c${u}D ${p}	%c${c}	%c${f}	%c${i}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}};function ZF(t,e,r){let n={},o={};for(let l=0;l<e.length;l++)n[e[l].id]=!0;for(let l=0;l<t.length;l++){let u=t[l],c=u.inputs;for(let p in c){let f=c[p],d=!1;for(let m=0;m<e.length;m++)if(n[f.id]){u.outputs.forEach(h=>n[h.id]=!0),d=!0,o[u.id]=!0;break}if(d)break}}let s={};s[r.id]=!0;let i={};for(let l=t.length-1;l>=0;l--){let u=t[l],c=u.inputs;for(let p=0;p<u.outputs.length;p++)if(s[u.outputs[p].id]){for(let f in c)s[c[f].id]=!0,i[u.id]=!0;break}}let a=[];for(let l=0;l<t.length;l++){let u=t[l];if(o[u.id]&&i[u.id]){let c={};for(let f in u.inputs){let d=u.inputs[f];n[d.id]&&(c[f]=d)}let p=Object.assign({},u);p.inputs=c,p.outputs=u.outputs,a.push(p)}}return a}function JF(t,e,r,n){for(let o=e.length-1;o>=0;o--){let s=e[o],i=[];if(s.outputs.forEach(l=>{let u=t[l.id];u!=null?i.push(u):i.push(null)}),s.gradient==null)throw new Error(`Cannot compute gradient: gradient function not found for ${s.kernelName}.`);let a=s.gradient(i);for(let l in s.inputs){if(!(l in a))throw new Error(`Cannot backprop through input ${l}. Available gradients found: ${Object.keys(a)}.`);let u=r(()=>a[l]());if(u.dtype!=="float32")throw new Error(`Error in gradient for op ${s.kernelName}. The gradient of input ${l} must have 'float32' dtype, but has '${u.dtype}'`);let c=s.inputs[l];if(!yu(u.shape,c.shape))throw new Error(`Error in gradient for op ${s.kernelName}. The gradient of input '${l}' has shape '${u.shape}', which does not match the shape of the input '${c.shape}'`);if(t[c.id]==null)t[c.id]=u;else{let p=t[c.id];t[c.id]=n(p,u),p.dispose()}}}}var eP=20,vx=3,LI=7;function tP(t,e,r,n){let o=$i(e),s=XQ(t,e,r,o),i=e.length,a=i1(t,e,r,o,s),l=["Tensor"];return n&&(l.push(`  dtype: ${r}`),l.push(`  rank: ${i}`),l.push(`  shape: [${e}]`),l.push("  values:")),l.push(a.map(u=>"    "+u).join(`
`)),l.join(`
`)}function XQ(t,e,r,n){let o=lt(e),s=n[n.length-1],i=new Array(s).fill(0),a=e.length,l=r==="complex64"?Cx(t):t;if(a>1)for(let u=0;u<o/s;u++){let c=u*s;for(let p=0;p<s;p++)i[p]=Math.max(i[p],wx(l[c+p],0,r).length)}return i}function wx(t,e,r){let n;return Array.isArray(t)?n=`${parseFloat(t[0].toFixed(LI))} + ${parseFloat(t[1].toFixed(LI))}j`:Ad(t)?n=`'${t}'`:r==="bool"?n=rP(t):n=parseFloat(t.toFixed(LI)).toString(),Ip(n,e)}function rP(t){return t===0?"false":"true"}function i1(t,e,r,n,o,s=!0){let i=r==="complex64"?2:1,a=e[0],l=e.length;if(l===0){if(r==="complex64"){let h=Cx(t);return[wx(h[0],0,r)]}return r==="bool"?[rP(t[0])]:[t[0].toString()]}if(l===1){if(a>eP){let g=vx*i,x=Array.from(t.slice(0,g)),y=Array.from(t.slice((a-vx)*i,a*i));return r==="complex64"&&(x=Cx(x),y=Cx(y)),["["+x.map((b,v)=>wx(b,o[v],r)).join(", ")+", ..., "+y.map((b,v)=>wx(b,o[a-vx+v],r)).join(", ")+"]"]}return["["+(r==="complex64"?Cx(t):Array.from(t)).map((g,x)=>wx(g,o[x],r)).join(", ")+"]"]}let u=e.slice(1),c=n.slice(1),p=n[0]*i,f=[];if(a>eP){for(let h=0;h<vx;h++){let g=h*p,x=g+p;f.push(...i1(t.slice(g,x),u,r,c,o,!1))}f.push("...");for(let h=a-vx;h<a;h++){let g=h*p,x=g+p;f.push(...i1(t.slice(g,x),u,r,c,o,h===a-1))}}else for(let h=0;h<a;h++){let g=h*p,x=g+p;f.push(...i1(t.slice(g,x),u,r,c,o,h===a-1))}let d=l===2?",":"";f[0]="["+f[0]+d;for(let h=1;h<f.length-1;h++)f[h]=" "+f[h]+d;let m=`,
`;for(let h=2;h<l;h++)m+=`
`;return f[f.length-1]=" "+f[f.length-1]+"]"+(s?"":m),f}function Cx(t){let e=[];for(let r=0;r<t.length;r+=2)e.push([t[r],t[r+1]]);return e}var vt=class{constructor(e,r,n){if(this.dtype=r,this.shape=e.slice(),this.size=lt(e),n!=null){let o=n.length;A(o===this.size,()=>`Length of values '${o}' does not match the size inferred by the shape '${this.size}'.`)}if(r==="complex64")throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||CI(r,this.size),this.strides=$i(e)}set(e,...r){r.length===0&&(r=[0]),A(r.length===this.rank,()=>`The number of provided coordinates (${r.length}) must match the rank (${this.rank})`);let n=this.locToIndex(r);this.values[n]=e}get(...e){e.length===0&&(e=[0]);let r=0;for(let o of e){if(o<0||o>=this.shape[r]){let s=`Requested out of range element at ${e}.   Buffer shape=${this.shape}`;throw new Error(s)}r++}let n=e[e.length-1];for(let o=0;o<e.length-1;++o)n+=this.strides[o]*e[o];return this.values[n]}locToIndex(e){if(this.rank===0)return 0;if(this.rank===1)return e[0];let r=e[e.length-1];for(let n=0;n<e.length-1;++n)r+=this.strides[n]*e[n];return r}indexToLoc(e){if(this.rank===0)return[];if(this.rank===1)return[e];let r=new Array(this.shape.length);for(let n=0;n<r.length-1;++n)r[n]=Math.floor(e/this.strides[n]),e-=r[n]*this.strides[n];return r[r.length-1]=e,r}get rank(){return this.shape.length}toTensor(){return ni().makeTensor(this.values,this.shape,this.dtype)}},ni=null,Tm=null,YQ=null;function nP(t){ni=t}function oP(t){Tm=t}function sP(t){YQ=t}var Ze=class{constructor(e,r,n,o){this.kept=!1,this.isDisposedInternal=!1,this.shape=e.slice(),this.dtype=r||"float32",this.size=lt(e),this.strides=$i(e),this.dataId=n,this.id=o,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){let e=await this.data();return Tm.buffer(this.shape,this.dtype,e)}bufferSync(){return Tm.buffer(this.shape,this.dtype,this.dataSync())}async array(){let e=await this.data();return Tp(this.shape,e,this.dtype==="complex64")}arraySync(){return Tp(this.shape,this.dataSync(),this.dtype==="complex64")}async data(){this.throwIfDisposed();let e=ni().read(this.dataId);if(this.dtype==="string"){let r=await e;try{return r.map(n=>km(n))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return e}dataToGPU(e){return this.throwIfDisposed(),ni().readToGPU(this.dataId,e)}dataSync(){this.throwIfDisposed();let e=ni().readSync(this.dataId);if(this.dtype==="string")try{return e.map(r=>km(r))}catch{throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}async bytes(){this.throwIfDisposed();let e=await ni().read(this.dataId);return this.dtype==="string"?e:new Uint8Array(e.buffer)}dispose(){this.isDisposed||(ni().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(e=!1){return Tm.print(this,e)}clone(){return this.throwIfDisposed(),Tm.clone(this)}toString(e=!1){let r=this.dataSync();return tP(r,this.shape,this.dtype,e)}cast(e){return this.throwIfDisposed(),Tm.cast(this,e)}variable(e=!0,r,n){return this.throwIfDisposed(),ni().makeVariable(this,e,r,n)}};Object.defineProperty(Ze,Symbol.hasInstance,{value:t=>!!t&&t.data!=null&&t.dataSync!=null&&t.throwIfDisposed!=null});function F(){return mx("Tensor",()=>Ze)}F();var fl=class extends Ze{constructor(e,r,n,o){super(e.shape,e.dtype,e.dataId,o),this.trainable=r,this.name=n}assign(e){if(e.dtype!==this.dtype)throw new Error(`dtype of the new value (${e.dtype}) and previous value (${this.dtype}) must match`);if(!yu(e.shape,this.shape))throw new Error(`shape of the new value (${e.shape}) and previous value (${this.shape}) must match`);ni().disposeTensor(this),this.dataId=e.dataId,ni().incRef(this,null)}dispose(){ni().disposeVariable(this),this.isDisposedInternal=!0}};Object.defineProperty(fl,Symbol.hasInstance,{value:t=>t instanceof Ze&&t.assign!=null&&t.assign instanceof Function});var hs={};Ho(hs,{assertTypesMatch:()=>ZQ,getTensorsInContainer:()=>Sx,isTensorInList:()=>JQ,makeTypesMatch:()=>Xe});var MI;(function(t){t.R0="R0",t.R1="R1",t.R2="R2",t.R3="R3",t.R4="R4",t.R5="R5",t.R6="R6"})(MI||(MI={}));var zI;(function(t){t.float32="float32",t.int32="int32",t.bool="int32",t.complex64="complex64"})(zI||(zI={}));var BI;(function(t){t.float32="float32",t.int32="int32",t.bool="bool",t.complex64="complex64"})(BI||(BI={}));var VI;(function(t){t.float32="float32",t.int32="float32",t.bool="float32",t.complex64="complex64"})(VI||(VI={}));var WI;(function(t){t.float32="complex64",t.int32="complex64",t.bool="complex64",t.complex64="complex64"})(WI||(WI={}));var QQ={float32:VI,int32:zI,bool:BI,complex64:WI};function wr(t,e){if(t==="string"||e==="string"){if(t==="string"&&e==="string")return"string";throw new Error(`Can not upcast ${t} with ${e}`)}return QQ[t][e]}function Up(t){return wr(t,"int32")}function Xe(t,e){if(t.dtype===e.dtype)return[t,e];let r=wr(t.dtype,e.dtype);return[t.cast(r),e.cast(r)]}function ZQ(t,e){A(t.dtype===e.dtype,()=>`The dtypes of the first(${t.dtype}) and second(${e.dtype}) input must match`)}function JQ(t,e){return e.some(r=>r.id===t.id)}function Sx(t){let e=[];return iP(t,e,new Set),e}function iP(t,e,r){if(t==null)return;if(t instanceof Ze){e.push(t);return}if(!eZ(t))return;let n=t;for(let o in n){let s=n[o];r.has(s)||(r.add(s),iP(s,e,r))}}function eZ(t){return Array.isArray(t)||typeof t=="object"}function GI(t){return t.kernelName!=null}var a1=class{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map(e=>e.name)))}}}dispose(){for(let e in this.registeredVariables)this.registeredVariables[e].dispose()}},fc=class{constructor(e){this.ENV=e,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new a1}async ready(){if(this.pendingBackendInit!=null)return this.pendingBackendInit.then(()=>{});if(this.backendInstance!=null)return;let e=this.getSortedBackends();for(let r=0;r<e.length;r++){let n=e[r];if(await this.initializeBackend(n).success){await this.setBackend(n);return}}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(this.pendingBackendInit!=null)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(this.backendInstance==null){let{name:e,asyncInit:r}=this.initializeBackendsAndReturnBest();if(r)throw new Error(`The highest priority backend '${e}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(e)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(e){if(!(e in this.registry))if(e in this.registryFactory){let{asyncInit:r}=this.initializeBackend(e);if(r)return null}else return null;return this.registry[e]}findBackendFactory(e){return e in this.registryFactory?this.registryFactory[e].factory:null}registerBackend(e,r,n=1){return e in this.registryFactory?(Li(`${e} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[e]={factory:r,priority:n},!0)}async setBackend(e){if(this.registryFactory[e]==null)throw new Error(`Backend name '${e}' not found in registry`);if(this.backendName=e,this.registry[e]==null){this.backendInstance=null;let{success:r,asyncInit:n}=this.initializeBackend(e);if(!(n?await r:r))return!1}return this.backendInstance=this.registry[e],this.setupRegisteredKernels(),this.profiler=new s1(this.backendInstance),!0}setupRegisteredKernels(){DI(this.backendName).forEach(r=>{r.setupFunc!=null&&r.setupFunc(this.backendInstance)})}disposeRegisteredKernels(e){DI(e).forEach(n=>{n.disposeFunc!=null&&n.disposeFunc(this.registry[e])})}initializeBackend(e){let r=this.registryFactory[e];if(r==null)throw new Error(`Cannot initialize backend ${e}, no registration found.`);try{let n=r.factory();if(n&&!(n instanceof ya)&&typeof n.then=="function"){let o=++this.pendingBackendInitId,s=n.then(i=>o<this.pendingBackendInitId?!1:(this.registry[e]=i,this.pendingBackendInit=null,!0)).catch(i=>(o<this.pendingBackendInitId||(this.pendingBackendInit=null,Li(`Initialization of backend ${e} failed`),Li(i.stack||i.message)),!1));return this.pendingBackendInit=s,{success:s,asyncInit:!0}}else return this.registry[e]=n,{success:!0,asyncInit:!1}}catch(n){return Li(`Initialization of backend ${e} failed`),Li(n.stack||n.message),{success:!1,asyncInit:!1}}}removeBackend(e){if(!(e in this.registryFactory))throw new Error(`${e} backend not found in registry`);this.backendName===e&&this.pendingBackendInit!=null&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(Object.keys(this.registryFactory).length===0)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((e,r)=>this.registryFactory[r].priority-this.registryFactory[e].priority)}initializeBackendsAndReturnBest(){let e=this.getSortedBackends();for(let r=0;r<e.length;r++){let n=e[r],{success:o,asyncInit:s}=this.initializeBackend(n);if(s||o)return{name:n,asyncInit:s}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(e,r){let n=this.state.tensorInfo.get(r),o=n.backend,s=this.readSync(r),i=o.refCount(r);o.disposeData(r,!0),n.backend=e,e.move(r,s,n.shape,n.dtype,i),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(e,r){let n=null;if(r==null){if(typeof e!="function")throw new Error("Please provide a function to tidy()");r=e}else{if(typeof e!="string"&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if(typeof r!="function")throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");n=e}let o;return this.scopedRun(()=>this.startScope(n),()=>this.endScope(o),()=>(o=r(),o instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),o))}scopedRun(e,r,n){e();try{let o=n();return r(),o}catch(o){throw r(),o}}nextTensorId(){return fc.nextTensorId++}nextVariableId(){return fc.nextVariableId++}clone(e){let r=E.runKernel(Oi,{x:e}),n={x:e},o=i=>({x:()=>{let a="float32",l={x:i},u={dtype:a};return E.runKernel(Ri,l,u)}}),s=[];return this.addTapeNode(this.state.activeScope.name,n,[r],o,s,{}),r}runKernel(e,r,n){if(this.backendName==null&&this.backend,!(yx(e,this.backendName)!=null))throw new Error(`Kernel '${e}' not registered for backend '${this.backendName}'`);return this.runKernelFunc({kernelName:e,inputs:r,attrs:n})}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(e,r,n){let o=this.backend.numDataIds(),s=0;n.forEach(l=>{s+=l.dtype==="complex64"?3:1});let i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],a=o-r-s-i;if(a>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${a} data ids) after running '${e}'`)}runKernelFunc(e){let r,n=[],o=this.isTapeOn(),s=this.state.numBytes,i=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0);let a;this.backendName==null&&this.backend;let l,u=GI(e)?e.kernelName:this.state.activeScope!=null?this.state.activeScope.name:"";if(GI(e)){let{kernelName:m,inputs:h,attrs:g}=e;this.backendName==null&&this.backend;let x=yx(m,this.backendName);A(x!=null,()=>`Cannot find registered kernel '${m}' for backend '${this.backendName}'`),a=()=>{let y=this.backend.numDataIds();l=x.kernelFunc({inputs:h,attrs:g,backend:this.backend});let b=Array.isArray(l)?l:[l];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(m,y,b);let v=b.map(C=>C.rank!=null?C:this.makeTensorFromTensorInfo(C));if(o){let C=this.getTensorsForGradient(m,h,v);n=this.saveTensorsForBackwardMode(C)}return v}}else{let{forwardFunc:m}=e,h=g=>{!o||(n=g.map(x=>this.keep(this.clone(x))))};a=()=>{let g=this.backend.numDataIds();l=this.tidy(()=>m(this.backend,h));let x=Array.isArray(l)?l:[l];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(u,g,x),x}}let{inputs:c,attrs:p}=e,f=GI(e)?null:e.backwardsFunc,d;return this.scopedRun(()=>this.state.kernelDepth++,()=>this.state.kernelDepth--,()=>{!this.ENV.getBool("DEBUG")&&!this.state.profiling?r=a():(d=this.profiler.profileKernel(u,c,()=>a()),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(d),r=d.outputs)}),o&&this.addTapeNode(u,c,r,f,n,p),this.state.profiling&&this.state.activeProfile.kernels.push({name:u,bytesAdded:this.state.numBytes-s,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-i,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(c).map(m=>c[m]!=null?c[m].shape:null),outputShapes:r.map(m=>m.shape),kernelTimeMs:d.timeMs,extraInfo:d.extraInfo}),Array.isArray(l)?r:r[0]}saveTensorsForBackwardMode(e){return e.map(n=>this.keep(this.clone(n)))}getTensorsForGradient(e,r,n){let o=AI(e);if(o!=null){let s=o.inputsToSave||[],i=o.outputsToSave||[],a;o.saveAllInputs?(A(Array.isArray(r),()=>"saveAllInputs is true, expected inputs to be an array."),a=Object.keys(r).map(u=>r[u])):a=s.map(u=>r[u]);let l=n.filter((u,c)=>i[c]);return a.concat(l)}return[]}makeTensor(e,r,n,o){if(e==null)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",o=o||this.backend;let s=e;n==="string"&&Ad(e[0])&&(s=e.map(l=>Sm(l)));let i=o.write(s,r,n),a=new Ze(r,n,i,this.nextTensorId());if(this.trackTensor(a,o),n==="string"){let l=this.state.tensorInfo.get(i),u=TI(s);this.state.numBytes+=u-l.bytes,l.bytes=u}return a}makeTensorFromDataId(e,r,n,o){n=n||"float32";let s={dataId:e,shape:r,dtype:n};return this.makeTensorFromTensorInfo(s,o)}makeTensorFromTensorInfo(e,r){let{dataId:n,shape:o,dtype:s}=e,i=new Ze(o,s,n,this.nextTensorId());return this.trackTensor(i,r),i}makeVariable(e,r=!0,n,o){n=n||this.nextVariableId().toString(),o!=null&&o!==e.dtype&&(e=e.cast(o));let s=new fl(e,r,n,this.nextTensorId());if(this.state.registeredVariables[s.name]!=null)throw new Error(`Variable with name ${s.name} was already registered`);return this.state.registeredVariables[s.name]=s,this.incRef(s,this.backend),s}trackTensor(e,r){this.state.numTensors++,e.dtype==="string"&&this.state.numStringTensors++;let n=0;e.dtype!=="complex64"&&e.dtype!=="string"&&(n=e.size*Fv(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:r||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof fl||this.track(e)}incRef(e,r){this.trackTensor(e,r),this.backend.incRef(e.dataId)}removeDataId(e,r){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===r&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}disposeTensor(e){if(!this.state.tensorInfo.has(e.dataId))return;let r=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,e.dtype==="string"&&(this.state.numStringTensors--,this.state.numBytes-=r.bytes),e.dtype!=="complex64"&&e.dtype!=="string"){let n=e.size*Fv(e.dtype);this.state.numBytes-=n}r.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,r.backend)}disposeVariables(){for(let e in this.state.registeredVariables){let r=this.state.registeredVariables[e];this.disposeVariable(r)}}disposeVariable(e){this.disposeTensor(e),this.state.registeredVariables[e.name]!=null&&delete this.state.registeredVariables[e.name]}memory(){let e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,e.reasons==null&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}async profile(e){this.state.profiling=!0;let r=this.state.numBytes,n=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await e(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map(o=>o.totalBytesSnapshot)),this.state.activeProfile.newBytes=this.state.numBytes-r,this.state.activeProfile.newTensors=this.state.numTensors-n;for(let o of this.state.activeProfile.kernels)o.kernelTimeMs=await o.kernelTimeMs,o.extraInfo=await o.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&this.state.kernelDepth===0}addTapeNode(e,r,n,o,s,i){let a={id:this.state.nextTapeNodeId++,kernelName:e,inputs:r,outputs:n,saved:s},l=AI(e);l!=null&&(o=l.gradFunc),o!=null&&(a.gradient=u=>(u=u.map((c,p)=>{if(c==null){let f=n[p],d=Od(f.size,f.dtype);return this.makeTensor(d,f.shape,f.dtype)}return c}),o(u.length>1?u:u[0],s,i))),this.state.activeTape.push(a)}keep(e){return e.kept=!0,e}startTape(){this.state.gradientDepth===0&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(e){let r={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(r.name=e),this.state.scopeStack.push(r),this.state.activeScope=r}endScope(e){let r=Sx(e),n=new Set(r.map(s=>s.id));for(let s=0;s<this.state.activeScope.track.length;s++){let i=this.state.activeScope.track[s];!i.kept&&!n.has(i.id)&&i.dispose()}let o=this.state.scopeStack.pop();this.state.activeScope=this.state.scopeStack.length===0?null:this.state.scopeStack[this.state.scopeStack.length-1],r.forEach(s=>{!s.kept&&s.scopeId===o.id&&this.track(s)})}gradients(e,r,n,o=!1){if(A(r.length>0,()=>"gradients() received an empty list of xs."),n!=null&&n.dtype!=="float32")throw new Error(`dy must have 'float32' dtype, but has '${n.dtype}'`);let s=this.scopedRun(()=>this.startTape(),()=>this.endTape(),()=>this.tidy("forward",e));A(s instanceof Ze,()=>"The result y returned by f() must be a tensor.");let i=ZF(this.state.activeTape,r,s);if(!o&&i.length===0&&r.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",()=>{let a={};a[s.id]=n??tZ(s.shape),JF(a,i,u=>this.tidy(u),rZ);let l=r.map(u=>a[u.id]);return this.state.gradientDepth===0&&(this.state.activeTape.forEach(u=>{for(let c of u.saved)c.dispose()}),this.state.activeTape=null),{value:s,grads:l}})}customGrad(e){return A($d(e),()=>"The f passed in customGrad(f) must be a function."),(...r)=>{A(r.every(a=>a instanceof Ze),()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors");let n,o={};r.forEach((a,l)=>{o[l]=a});let s=(a,l)=>(n=e(...r,l),A(n.value instanceof Ze,()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"),A($d(n.gradFunc),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."),n.value),i=(a,l)=>{let u=n.gradFunc(a,l),c=Array.isArray(u)?u:[u];A(c.length===r.length,()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."),A(c.every(f=>f instanceof Ze),()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors.");let p={};return c.forEach((f,d)=>{p[d]=()=>f}),p};return this.runKernelFunc({forwardFunc:s,backwardsFunc:i,inputs:o})}}readSync(e){return this.state.tensorInfo.get(e).backend.readSync(e)}read(e){return this.state.tensorInfo.get(e).backend.read(e)}readToGPU(e,r){return this.state.tensorInfo.get(e).backend.readToGPU(e,r)}async time(e){let r=Gp(),n=await this.backend.time(e);return n.wallMs=Gp()-r,n}track(e){return this.state.activeScope!=null&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new a1;for(let e in this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}};fc.nextTensorId=0;fc.nextVariableId=0;function tZ(t){let e=px(lt(t),"float32");return E.makeTensor(e,t,"float32")}function UI(){let t=EI();if(t._tfengine==null){let e=new dx(t);t._tfengine=new fc(e)}return $F(t._tfengine.ENV),nP(()=>t._tfengine),t._tfengine}var E=UI();function rZ(t,e){let r={a:t,b:e};return E.runKernel(ti,r)}var dc={};Ho(dc,{isBrowser:()=>qI,isMobile:()=>sZ,mockIsMobile:()=>oZ});function nZ(){return typeof navigator<"u"&&navigator!=null}var HI;function oZ(t){HI=t}function sZ(t){if(HI!==void 0)return HI;if(t||nZ()){if(t||(t=navigator),t.product==="ReactNative")return!0;let e=t.userAgent||t.vendor||(typeof window<"u"?window.opera:"");if(!e){let r=t;return r.userAgentData&&r.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function qI(){return typeof window<"u"&&window.document!=null||typeof WorkerGlobalScope<"u"}var qo=B();qo.registerFlag("DEBUG",()=>!1,t=>{t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")});qo.registerFlag("IS_BROWSER",()=>qI());qo.registerFlag("IS_NODE",()=>typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u");qo.registerFlag("IS_CHROME",()=>typeof navigator<"u"&&navigator!=null&&navigator.userAgent!=null&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor));qo.registerFlag("PROD",()=>!1);qo.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",()=>qo.getBool("DEBUG"));qo.registerFlag("DEPRECATION_WARNINGS_ENABLED",()=>!0);qo.registerFlag("IS_TEST",()=>!1);qo.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",()=>!0);qo.registerFlag("WRAP_TO_IMAGEBITMAP",()=>!1);qo.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",()=>!1);qo.registerFlag("USE_SETTIMEOUTCUSTOM",()=>!1);function dl(t,e){let r=t;if(Co(t))return e==="string"?[]:[t.length];if(typeof t=="object"&&"texture"in t){let o=t.channels||"RGBA";return[t.height,t.width*o.length]}if(!Array.isArray(t))return[];let n=[];for(;Array.isArray(r)||Co(r)&&e!=="string";)n.push(r.length),r=r[0];return Array.isArray(t)&&B().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&lP(t,n,[]),n}function lP(t,e,r){if(r=r||[],!Array.isArray(t)&&!Co(t)){A(e.length===0,()=>`Element arr[${r.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`);return}A(e.length>0,()=>`Element arr[${r.join("][")}] should be a primitive, but is an array of ${t.length} elements`),A(t.length===e[0],()=>`Element arr[${r.join("][")}] should have ${e[0]} elements, but has ${t.length} elements`);let n=e.slice(1);for(let o=0;o<t.length;++o)lP(t[o],n,r.concat(o))}function aP(t,e,r,n){if(t!=="string_or_numeric"){if(t==null)throw new Error("Expected dtype cannot be null.");if(t!=="numeric"&&t!==e||t==="numeric"&&e==="string")throw new Error(`Argument '${r}' passed to '${n}' must be ${t} tensor, but got ${e} tensor`)}}function I(t,e,r,n="numeric"){if(t instanceof Ze)return aP(n,t.dtype,e,r),t;let o=Dd(t);if(o!=="string"&&["bool","int32","float32"].indexOf(n)>=0&&(o=n),aP(n,o,e,r),t==null||!Co(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string"){let l=t==null?"null":t.constructor.name;throw new Error(`Argument '${e}' passed to '${r}' must be a Tensor or TensorLike, but got '${l}'`)}let s=dl(t,o);!Co(t)&&!Array.isArray(t)&&(t=[t]);let a=o!=="string"?Cm(t,o):xu(t,[],!0);return E.makeTensor(a,s,o)}function l1(t,e,r,n="numeric"){if(!Array.isArray(t))throw new Error(`Argument ${e} passed to ${r} must be a \`Tensor[]\` or \`TensorLike[]\``);return t.map((s,i)=>I(s,`${e}[${i}]`,r,n))}var iZ="__op";function _(t){let e=Object.keys(t);if(e.length!==1)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let r=e[0],n=t[r];r.endsWith("_")&&(r=r.substring(0,r.length-1)),r=r+iZ;let o=(...s)=>{E.startScope(r);try{let i=n(...s);return fx(i)&&console.error("Cannot return a Promise inside of tidy."),E.endScope(i),i}catch(i){throw E.endScope(null),i}};return Object.defineProperty(o,"name",{value:r,configurable:!0}),o}function aZ(t,e){let r=I(t,"real","complex"),n=I(e,"imag","complex");Ov(r.shape,n.shape,`real and imag shapes, ${r.shape} and ${n.shape}, must match in call to tf.complex().`);let o={real:r,imag:n};return E.runKernel(Vd,o)}var jo=_({complex_:aZ});function Mi(t,e,r,n){if(n==null&&(n=Dd(t)),n==="complex64")throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(typeof t=="object"&&"texture"in t){if(n!=="float32"&&n!=="int32")throw new Error(`Creating tensor from texture only supports 'float32'|'int32' dtype, while the dtype is ${n}.`);return t.channels=t.channels||"RGBA",E.backend.createTensorFromTexture(t,e||r,n)}if(!Co(t)&&!Array.isArray(t)&&typeof t!="number"&&typeof t!="boolean"&&typeof t!="string")throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(e!=null){tn(e);let o=lt(e),s=lt(r);A(o===s,()=>`Based on the provided shape, [${e}], the tensor should have ${o} values but has ${s}`);for(let i=0;i<r.length;++i){let a=r[i],l=i===r.length-1?a!==lt(e.slice(i)):!0;A(r[i]===e[i]||!l,()=>`Error creating a new Tensor. Inferred shape (${r}) does not match the provided shape (${e}). `)}}return!Co(t)&&!Array.isArray(t)&&(t=[t]),e=e||r,t=n!=="string"?Cm(t,n):xu(t,[],!0),E.makeTensor(t,e,n)}function Cr(t,e,r){let n=dl(t,r);return Mi(t,e,n,r)}var kx={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};var u1=4;async function cP(t,e){let r=[],n=[],o=Array.isArray(t)?t.map(i=>i.name):Object.keys(t);for(let i=0;i<o.length;++i){let a=o[i],l=Array.isArray(t)?t[i].tensor:t[a];if(l.dtype!=="float32"&&l.dtype!=="int32"&&l.dtype!=="bool"&&l.dtype!=="string"&&l.dtype!=="complex64")throw new Error(`Unsupported dtype in weight '${a}': ${l.dtype}`);let u={name:a,shape:l.shape,dtype:l.dtype};if(l.dtype==="string"){let c=new Promise(async p=>{let f=await l.bytes(),d=f.reduce((g,x)=>g+x.length,0)+u1*f.length,m=new Uint8Array(d),h=0;for(let g=0;g<f.length;g++){let x=f[g],y=new Uint8Array(new Uint32Array([x.length]).buffer);m.set(y,h),h+=u1,m.set(x,h),h+=x.length}p(m)});n.push(c)}else n.push(l.data());e!=null&&(u.group=e),r.push(u)}let s=await Promise.all(n);return{data:lZ(s),specs:r}}function c1(t,e){let r={},n,o=0;for(let s of e){let i=s.name,a=s.dtype,l=s.shape,u=lt(l),c;if("quantization"in s){let p=s.quantization;if(p.dtype==="uint8"||p.dtype==="uint16"){if(!("min"in p&&"scale"in p))throw new Error(`Weight ${s.name} with quantization ${p.dtype} doesn't have corresponding metadata min and scale.`)}else if(p.dtype==="float16"){if(a!=="float32")throw new Error(`Weight ${s.name} is quantized with ${p.dtype} which only supports weights of type float32 not ${a}.`)}else throw new Error(`Weight ${s.name} has unknown quantization dtype ${p.dtype}. Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.`);let f=kx[p.dtype],d=t.slice(o,o+u*f),m=p.dtype==="uint8"?new Uint8Array(d):new Uint16Array(d);if(a==="float32")if(p.dtype==="uint8"||p.dtype==="uint16"){c=new Float32Array(m.length);for(let h=0;h<m.length;h++){let g=m[h];c[h]=g*p.scale+p.min}}else if(p.dtype==="float16")n===void 0&&(n=fZ()),c=n(m);else throw new Error(`Unsupported quantization type ${p.dtype} for weight type float32.`);else if(a==="int32"){if(p.dtype!=="uint8"&&p.dtype!=="uint16")throw new Error(`Unsupported quantization type ${p.dtype} for weight type int32.`);c=new Int32Array(m.length);for(let h=0;h<m.length;h++){let g=m[h];c[h]=Math.round(g*p.scale+p.min)}}else throw new Error(`Unsupported dtype in weight '${i}': ${a}`);o+=u*f}else if(a==="string"){let p=lt(s.shape);c=[];for(let f=0;f<p;f++){let d=new Uint32Array(t.slice(o,o+u1))[0];o+=u1;let m=new Uint8Array(t.slice(o,o+d));c.push(m),o+=d}}else{let p=kx[a],f=t.slice(o,o+u*p);if(a==="float32")c=new Float32Array(f);else if(a==="int32")c=new Int32Array(f);else if(a==="bool")c=new Uint8Array(f);else if(a==="complex64"){c=new Float32Array(f);let d=new Float32Array(c.length/2),m=new Float32Array(c.length/2);for(let x=0;x<d.length;x++)d[x]=c[x*2],m[x]=c[x*2+1];let h=Cr(d,l,"float32"),g=Cr(m,l,"float32");r[i]=jo(h,g),h.dispose(),g.dispose()}else throw new Error(`Unsupported dtype in weight '${i}': ${a}`);o+=u*p}a!=="complex64"&&(r[i]=Cr(c,l,a))}return r}function lZ(t){if(t===null)throw new Error(`Invalid input value: ${JSON.stringify(t)}`);let e=0,r=[];t.forEach(s=>{if(e+=s.byteLength,r.push(s.byteLength===s.buffer.byteLength?s:new s.constructor(s)),!(s instanceof Float32Array||s instanceof Int32Array||s instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${s.constructor.name}`)});let n=new Uint8Array(e),o=0;return r.forEach(s=>{n.set(new Uint8Array(s.buffer),o),o+=s.byteLength}),n.buffer}var jI=typeof Buffer<"u"&&(typeof Blob>"u"||typeof atob>"u"||typeof btoa>"u");function uP(t){return jI?Buffer.byteLength(t):new Blob([t]).size}function pP(t){if(jI)return Buffer.from(t).toString("base64");let e=new Uint8Array(t),r="";for(let n=0,o=e.length;n<o;n++)r+=String.fromCharCode(e[n]);return btoa(r)}function fP(t){if(jI){let n=Buffer.from(t,"base64");return n.buffer.slice(n.byteOffset,n.byteOffset+n.byteLength)}let e=atob(t),r=new Uint8Array(e.length);for(let n=0;n<e.length;++n)r.set([e.charCodeAt(n)],n);return r.buffer}function Nm(t){if(t.length===1)return t[0];let e=0;t.forEach(o=>{e+=o.byteLength});let r=new Uint8Array(e),n=0;return t.forEach(o=>{r.set(new Uint8Array(o),n),n+=o.byteLength}),r.buffer}function KI(t){let e="/";for(t=t.trim();t.endsWith(e);)t=t.slice(0,t.length-1);let r=t.split(e);return r[r.length-1]}function p1(t,e){let r={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:e};return t.signature!=null&&(r.signature=t.signature),t.userDefinedMetadata!=null&&(r.userDefinedMetadata=t.userDefinedMetadata),t.modelInitializer!=null&&(r.modelInitializer=t.modelInitializer),t.initializerSignature!=null&&(r.initializerSignature=t.initializerSignature),t.trainingConfig!=null&&(r.trainingConfig=t.trainingConfig),r}function XI(t,e,r){let n={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy};if(t.trainingConfig!=null&&(n.trainingConfig=t.trainingConfig),t.weightsManifest!=null){if(!e)throw new Error("modelJSON has weightsManifest but weightSpecs is null");if(!r)throw new Error("modelJSON has weightsManifest but weightData is null");n.weightSpecs=e,n.weightData=r}return t.signature!=null&&(n.signature=t.signature),t.userDefinedMetadata!=null&&(n.userDefinedMetadata=t.userDefinedMetadata),t.modelInitializer!=null&&(n.modelInitializer=t.modelInitializer),t.initializerSignature!=null&&(n.initializerSignature=t.initializerSignature),n}async function Im(t,e){let r,n;return t.weightsManifest!=null&&([r,n]=await e(t.weightsManifest)),XI(t,r,n)}function zi(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:t.modelTopology==null?0:uP(JSON.stringify(t.modelTopology)),weightSpecsBytes:t.weightSpecs==null?0:uP(JSON.stringify(t.weightSpecs)),weightDataBytes:t.weightData==null?0:t.weightData.byteLength}}function f1(t){let e=[];for(let r of t)e.push(...r.weights);return e}function uZ(){let t=r=>{let n=r<<13,o=0;for(;(n&8388608)===0;)o-=8388608,n<<=1;return n&=-8388609,o+=947912704,n|o},e=new Uint32Array(2048);e[0]=0;for(let r=1;r<1024;r++)e[r]=t(r);for(let r=1024;r<2048;r++)e[r]=939524096+(r-1024<<13);return e}function cZ(){let t=new Uint32Array(64);t[0]=0,t[31]=1199570944,t[32]=2147483648,t[63]=3347054592;for(let e=1;e<31;e++)t[e]=e<<23;for(let e=33;e<63;e++)t[e]=2147483648+(e-32<<23);return t}function pZ(){let t=new Uint32Array(64);for(let e=0;e<64;e++)t[e]=1024;return t[0]=t[32]=0,t}function fZ(){let t=uZ(),e=cZ(),r=pZ();return n=>{let o=new ArrayBuffer(4*n.length),s=new Uint32Array(o);for(let i=0;i<n.length;i++){let a=n[i],l=t[r[a>>10]+(a&1023)]+e[a>>10];s[i]=l}return new Float32Array(o)}}var Nt=class{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return Nt.instance==null&&(Nt.instance=new Nt),Nt.instance}static registerSaveRouter(e){Nt.getInstance().saveRouters.push(e)}static registerLoadRouter(e){Nt.getInstance().loadRouters.push(e)}static getSaveHandlers(e){return Nt.getHandlers(e,"save")}static getLoadHandlers(e,r){return Nt.getHandlers(e,"load",r)}static getHandlers(e,r,n){let o=[];return(r==="load"?Nt.getInstance().loadRouters:Nt.getInstance().saveRouters).forEach(i=>{let a=i(e,n);a!==null&&o.push(a)}),o}},dP=t=>Nt.registerSaveRouter(t),mP=t=>Nt.registerLoadRouter(t),hP=t=>Nt.getSaveHandlers(t),gP=(t,e)=>Nt.getLoadHandlers(t,e);var YI="tensorflowjs",QI=1,Hp="models_store",mc="model_info_store";function xP(){if(!B().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");let t=typeof window>"u"?self:window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(e==null)throw new Error("The current browser does not appear to support IndexedDB.");return e}function ZI(t){let e=t.result;e.createObjectStore(Hp,{keyPath:"modelPath"}),e.createObjectStore(mc,{keyPath:"modelPath"})}var Bi=class{constructor(e){if(this.indexedDB=xP(),e==null||!e)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=e}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,e)}async load(){return this.databaseAction(this.modelPath)}databaseAction(e,r){return new Promise((n,o)=>{let s=this.indexedDB.open(YI,QI);s.onupgradeneeded=()=>ZI(s),s.onsuccess=()=>{let i=s.result;if(r==null){let a=i.transaction(Hp,"readonly"),u=a.objectStore(Hp).get(this.modelPath);u.onsuccess=()=>{if(u.result==null)return i.close(),o(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));n(u.result.modelArtifacts)},u.onerror=c=>(i.close(),o(u.error)),a.oncomplete=()=>i.close()}else{let a=zi(r),l=i.transaction(mc,"readwrite"),u=l.objectStore(mc),c=u.put({modelPath:this.modelPath,modelArtifactsInfo:a}),p;c.onsuccess=()=>{p=i.transaction(Hp,"readwrite");let d=p.objectStore(Hp).put({modelPath:this.modelPath,modelArtifacts:r,modelArtifactsInfo:a});d.onsuccess=()=>n({modelArtifactsInfo:a}),d.onerror=m=>{u=l.objectStore(mc);let h=u.delete(this.modelPath);h.onsuccess=()=>(i.close(),o(d.error)),h.onerror=g=>(i.close(),o(d.error))}},c.onerror=f=>(i.close(),o(c.error)),l.oncomplete=()=>{p==null?i.close():p.oncomplete=()=>i.close()}}},s.onerror=i=>o(s.error)})}};Bi.URL_SCHEME="indexeddb://";var yP=t=>B().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Bi.URL_SCHEME)?dZ(t.slice(Bi.URL_SCHEME.length)):null;Nt.registerSaveRouter(yP);Nt.registerLoadRouter(yP);function dZ(t){return new Bi(t)}function mZ(t){return t.startsWith(Bi.URL_SCHEME)?t.slice(Bi.URL_SCHEME.length):t}var d1=class{constructor(){this.indexedDB=xP()}async listModels(){return new Promise((e,r)=>{let n=this.indexedDB.open(YI,QI);n.onupgradeneeded=()=>ZI(n),n.onsuccess=()=>{let o=n.result,s=o.transaction(mc,"readonly"),a=s.objectStore(mc).getAll();a.onsuccess=()=>{let l={};for(let u of a.result)l[u.modelPath]=u.modelArtifactsInfo;e(l)},a.onerror=l=>(o.close(),r(a.error)),s.oncomplete=()=>o.close()},n.onerror=o=>r(n.error)})}async removeModel(e){return e=mZ(e),new Promise((r,n)=>{let o=this.indexedDB.open(YI,QI);o.onupgradeneeded=()=>ZI(o),o.onsuccess=()=>{let s=o.result,i=s.transaction(mc,"readwrite"),a=i.objectStore(mc),l=a.get(e),u;l.onsuccess=()=>{if(l.result==null)return s.close(),n(new Error(`Cannot find model with path '${e}' in IndexedDB.`));{let c=a.delete(e),p=()=>{u=s.transaction(Hp,"readwrite");let d=u.objectStore(Hp).delete(e);d.onsuccess=()=>r(l.result.modelArtifactsInfo),d.onerror=m=>n(l.error)};c.onsuccess=p,c.onerror=f=>(p(),s.close(),n(l.error))}},l.onerror=c=>(s.close(),n(l.error)),i.oncomplete=()=>{u==null?s.close():u.oncomplete=()=>s.close()}},o.onerror=s=>n(o.error)})}};var ml="/",Em="tensorflowjs_models",bP="info",hZ="model_topology",gZ="weight_specs",xZ="weight_data",yZ="model_metadata";function vP(t){return{info:[Em,t,bP].join(ml),topology:[Em,t,hZ].join(ml),weightSpecs:[Em,t,gZ].join(ml),weightData:[Em,t,xZ].join(ml),modelMetadata:[Em,t,yZ].join(ml)}}function wP(t){for(let e of Object.values(t))window.localStorage.removeItem(e)}function bZ(t){let e=t.split(ml);if(e.length<3)throw new Error(`Invalid key format: ${t}`);return e.slice(1,e.length-1).join(ml)}function vZ(t){return t.startsWith(Vi.URL_SCHEME)?t.slice(Vi.URL_SCHEME.length):t}var Vi=class{constructor(e){if(!B().getBool("IS_BROWSER")||typeof window>"u"||typeof window.localStorage>"u")throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,e==null||!e)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=e,this.keys=vP(this.modelPath)}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{let r=JSON.stringify(e.modelTopology),n=JSON.stringify(e.weightSpecs),o=zi(e);try{this.LS.setItem(this.keys.info,JSON.stringify(o)),this.LS.setItem(this.keys.topology,r),this.LS.setItem(this.keys.weightSpecs,n),this.LS.setItem(this.keys.weightData,pP(e.weightData));let s={format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,signature:e.signature!=null?e.signature:void 0,userDefinedMetadata:e.userDefinedMetadata!=null?e.userDefinedMetadata:void 0,modelInitializer:e.modelInitializer!=null?e.modelInitializer:void 0,initializerSignature:e.initializerSignature!=null?e.initializerSignature:void 0,trainingConfig:e.trainingConfig!=null?e.trainingConfig:void 0};return this.LS.setItem(this.keys.modelMetadata,JSON.stringify(s)),{modelArtifactsInfo:o}}catch{throw wP(this.keys),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${o.modelTopologyBytes}, weightSpecsBytes=${o.weightSpecsBytes}, weightDataBytes=${o.weightDataBytes}.`)}}}async load(){let e=JSON.parse(this.LS.getItem(this.keys.info));if(e==null)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if(e.modelTopologyType!=="JSON")throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");let r={},n=JSON.parse(this.LS.getItem(this.keys.topology));if(n==null)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);r.modelTopology=n;let o=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(o==null)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);r.weightSpecs=o;let s=this.LS.getItem(this.keys.modelMetadata);if(s!=null){let a=JSON.parse(s);r.format=a.format,r.generatedBy=a.generatedBy,r.convertedBy=a.convertedBy,a.signature!=null&&(r.signature=a.signature),a.userDefinedMetadata!=null&&(r.userDefinedMetadata=a.userDefinedMetadata),a.modelInitializer!=null&&(r.modelInitializer=a.modelInitializer),a.initializerSignature!=null&&(r.initializerSignature=a.initializerSignature),a.trainingConfig!=null&&(r.trainingConfig=a.trainingConfig)}let i=this.LS.getItem(this.keys.weightData);if(i==null)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return r.weightData=fP(i),r}};Vi.URL_SCHEME="localstorage://";var CP=t=>B().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Vi.URL_SCHEME)?wZ(t.slice(Vi.URL_SCHEME.length)):null;Nt.registerSaveRouter(CP);Nt.registerLoadRouter(CP);function wZ(t){return new Vi(t)}var m1=class{constructor(){A(B().getBool("IS_BROWSER"),()=>"Current environment is not a web browser"),A(typeof window>"u"||typeof window.localStorage<"u",()=>"Current browser does not appear to support localStorage"),this.LS=window.localStorage}async listModels(){let e={},r=Em+ml,n=ml+bP;for(let o=0;o<this.LS.length;++o){let s=this.LS.key(o);if(s.startsWith(r)&&s.endsWith(n)){let i=bZ(s);e[i]=JSON.parse(this.LS.getItem(s))}}return e}async removeModel(e){e=vZ(e);let r=vP(e);if(this.LS.getItem(r.info)==null)throw new Error(`Cannot find model at path '${e}'`);let n=JSON.parse(this.LS.getItem(r.info));return wP(r),n}};var _m="://",nn=class{constructor(){this.managers={}}static getInstance(){return nn.instance==null&&(nn.instance=new nn),nn.instance}static registerManager(e,r){A(e!=null,()=>"scheme must not be undefined or null."),e.endsWith(_m)&&(e=e.slice(0,e.indexOf(_m))),A(e.length>0,()=>"scheme must not be an empty string.");let n=nn.getInstance();A(n.managers[e]==null,()=>`A model store manager is already registered for scheme '${e}'.`),n.managers[e]=r}static getManager(e){let r=nn.getInstance().managers[e];if(r==null)throw new Error(`Cannot find model manager for scheme '${e}'`);return r}static getSchemes(){return Object.keys(nn.getInstance().managers)}};function h1(t){if(t.indexOf(_m)===-1)throw new Error(`The url string provided does not contain a scheme. Supported schemes are: ${nn.getSchemes().join(",")}`);return{scheme:t.split(_m)[0],path:t.split(_m)[1]}}async function SP(t,e,r=!1){A(t!==e,()=>`Old path and new path are the same: '${t}'`);let n=Nt.getLoadHandlers(t);A(n.length>0,()=>`Copying failed because no load handler is found for source URL ${t}.`),A(n.length<2,()=>`Copying failed because more than one (${n.length}) load handlers for source URL ${t}.`);let o=n[0],s=Nt.getSaveHandlers(e);A(s.length>0,()=>`Copying failed because no save handler is found for destination URL ${e}.`),A(s.length<2,()=>`Copying failed because more than one (${n.length}) save handlers for destination URL ${e}.`);let i=s[0],a=h1(t).scheme,l=h1(t).path,u=a===h1(t).scheme,c=await o.load();r&&u&&await nn.getManager(a).removeModel(l);let p=await i.save(c);return r&&!u&&await nn.getManager(a).removeModel(l),p.modelArtifactsInfo}async function kP(){let t=nn.getSchemes(),e={};for(let r of t){let n=await nn.getManager(r).listModels();for(let o in n){let s=r+_m+o;e[s]=n[o]}}return e}async function TP(t){let e=h1(t);return nn.getManager(e.scheme).removeModel(e.path)}async function NP(t,e){return SP(t,e,!1)}async function IP(t,e){return SP(t,e,!0)}var JI=class{constructor(){this.messageName="setTimeoutCustom",this.functionRefs=[],this.handledMessageCount=0,this.hasEventListener=!1}fetch(e,r){return fetch(e,r)}now(){return performance.now()}encode(e,r){if(r!=="utf-8"&&r!=="utf8")throw new Error(`Browser's encoder only supports utf-8, but got ${r}`);return this.textEncoder==null&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}decode(e,r){return new TextDecoder(r).decode(e)}setTimeoutCustom(e,r){if(typeof window>"u"||!B().getBool("USE_SETTIMEOUTCUSTOM")){setTimeout(e,r);return}this.functionRefs.push(e),setTimeout(()=>{window.postMessage({name:this.messageName,index:this.functionRefs.length-1},"*")},r),this.hasEventListener||(this.hasEventListener=!0,window.addEventListener("message",n=>{if(n.source===window&&n.data.name===this.messageName){n.stopPropagation();let o=this.functionRefs[n.data.index];o(),this.handledMessageCount++,this.handledMessageCount===this.functionRefs.length&&(this.functionRefs=[],this.handledMessageCount=0)}},!0))}};if(B().get("IS_BROWSER")){B().setPlatform("browser",new JI);try{nn.registerManager(Vi.URL_SCHEME,new m1)}catch{}try{nn.registerManager(Bi.URL_SCHEME,new d1)}catch{}}var CZ={importFetch:()=>EP()},e2;var t2=class{constructor(){this.util=_P(),this.textEncoder=new this.util.TextEncoder}fetch(e,r){return B().global.fetch!=null?B().global.fetch(e,r):(e2==null&&(e2=CZ.importFetch()),e2(e,r))}now(){let e=process.hrtime();return e[0]*1e3+e[1]/1e6}encode(e,r){if(r!=="utf-8"&&r!=="utf8")throw new Error(`Node built-in encoder only supports utf-8, but got ${r}`);return this.textEncoder.encode(e)}decode(e,r){return e.length===0?"":new this.util.TextDecoder(r).decode(e)}};B().get("IS_NODE")&&!B().get("IS_BROWSER")&&B().setPlatform("node",new t2);function Ee(t,e="float32",r){return e=e||"float32",tn(t),new vt(t,e,r)}function SZ(t,e){let r=I(t,"x","cast");if(!kI(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if(e==="string"&&r.dtype!=="string"||e!=="string"&&r.dtype==="string")throw new Error("Only strings can be casted to strings");let n={x:r},o={dtype:e};return E.runKernel(Ri,n,o)}var oe=_({cast_:SZ});function kZ(t){let r={x:I(t,"x","clone","string_or_numeric")};return E.runKernel(Oi,r)}var To=_({clone_:kZ});function AP(t,e=!1){console.log(t.toString(e))}UI();var TZ={buffer:Ee,cast:oe,clone:To,print:AP};oP(TZ);var gl={};Ho(gl,{browserFiles:()=>$P,browserHTTPRequest:()=>FP,concatenateArrayBuffers:()=>Nm,copyModel:()=>NP,decodeWeights:()=>c1,encodeWeights:()=>cP,fromMemory:()=>PP,fromMemorySync:()=>a2,getLoadHandlers:()=>gP,getModelArtifactsForJSON:()=>Im,getModelArtifactsForJSONSync:()=>XI,getModelArtifactsInfoForJSON:()=>zi,getSaveHandlers:()=>hP,getWeightSpecs:()=>f1,http:()=>x1,isHTTPScheme:()=>g1,listModels:()=>kP,loadWeights:()=>RP,moveModel:()=>IP,registerLoadRouter:()=>mP,registerSaveRouter:()=>dP,removeModel:()=>TP,weightsLoaderFactory:()=>s2,withSaveHandler:()=>LP,withSaveHandlerSync:()=>MP});var NZ="model",IZ=".json",EZ=".weights.bin";function DP(t){return new Promise(e=>setTimeout(e)).then(t)}var hl=class{constructor(e){if(!B().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");e.startsWith(hl.URL_SCHEME)&&(e=e.slice(hl.URL_SCHEME.length)),(e==null||e.length===0)&&(e=NZ),this.modelJsonFileName=e+IZ,this.weightDataFileName=e+EZ}async save(e){if(typeof document>"u")throw new Error("Browser downloads are not supported in this environment since `document` is not present");let r=window.URL.createObjectURL(new Blob([e.weightData],{type:"application/octet-stream"}));if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{let n=[{paths:["./"+this.weightDataFileName],weights:e.weightSpecs}],o=p1(e,n),s=window.URL.createObjectURL(new Blob([JSON.stringify(o)],{type:"application/json"})),i=this.modelJsonAnchor==null?document.createElement("a"):this.modelJsonAnchor;if(i.download=this.modelJsonFileName,i.href=s,await DP(()=>i.dispatchEvent(new MouseEvent("click"))),e.weightData!=null){let a=this.weightDataAnchor==null?document.createElement("a"):this.weightDataAnchor;a.download=this.weightDataFileName,a.href=r,await DP(()=>a.dispatchEvent(new MouseEvent("click")))}return{modelArtifactsInfo:zi(e)}}}};hl.URL_SCHEME="downloads://";var r2=class{constructor(e){if(e==null||e.length<1)throw new Error(`When calling browserFiles, at least 1 file is required, but received ${e}`);this.jsonFile=e[0],this.weightsFiles=e.slice(1)}async load(){return new Promise((e,r)=>{let n=new FileReader;n.onload=o=>{let s=JSON.parse(o.target.result),i=s.modelTopology;if(i==null){r(new Error(`modelTopology field is missing from file ${this.jsonFile.name}`));return}if(s.weightsManifest==null){r(new Error(`weightManifest field is missing from file ${this.jsonFile.name}`));return}if(this.weightsFiles.length===0){e({modelTopology:i});return}let l=Im(s,u=>this.loadWeights(u));e(l)},n.onerror=o=>r(`Failed to read model topology and weights manifest JSON from file '${this.jsonFile.name}'. BrowserFiles supports loading Keras-style tf.Model artifacts only.`),n.readAsText(this.jsonFile)})}loadWeights(e){let r=[],n=[];for(let i of e)r.push(...i.weights),n.push(...i.paths);let o=this.checkManifestAndWeightFiles(e),s=n.map(i=>this.loadWeightsFile(i,o[i]));return Promise.all(s).then(i=>[r,Nm(i)])}loadWeightsFile(e,r){return new Promise((n,o)=>{let s=new FileReader;s.onload=i=>{let a=i.target.result;n(a)},s.onerror=i=>o(`Failed to weights data from file of path '${e}'.`),s.readAsArrayBuffer(r)})}checkManifestAndWeightFiles(e){let r=[],n=this.weightsFiles.map(s=>KI(s.name)),o={};for(let s of e)s.paths.forEach(i=>{let a=KI(i);if(r.indexOf(a)!==-1)throw new Error(`Duplicate file basename found in weights manifest: '${a}'`);if(r.push(a),n.indexOf(a)===-1)throw new Error(`Weight file with basename '${a}' is not provided.`);o[i]=this.weightsFiles[n.indexOf(a)]});if(r.length!==this.weightsFiles.length)throw new Error(`Mismatch in the number of files in weights manifest (${r.length}) and the number of weight files provided (${this.weightsFiles.length}).`);return o}},_Z=t=>B().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(hl.URL_SCHEME)?AZ(t.slice(hl.URL_SCHEME.length)):null;Nt.registerSaveRouter(_Z);function AZ(t="model"){return new hl(t)}function $P(t){return new r2(t)}function n2(t,e,r,n){i(t),r=r??0,n=n??1,a(r,n);let o=0,s=l=>(l.then(u=>{let c=r+ ++o/t.length*(n-r);return e(c),u}),l);function i(l){A(l!=null&&Array.isArray(l)&&l.length>0,()=>"promises must be a none empty array")}function a(l,u){A(l>=0&&l<=1,()=>`Progress fraction must be in range [0, 1], but got startFraction ${l}`),A(u>=0&&u<=1,()=>`Progress fraction must be in range [0, 1], but got endFraction ${u}`),A(u>=l,()=>`startFraction must be no more than endFraction, but got startFraction ${l} and endFraction ${u}`)}return Promise.all(t.map(s))}async function o2(t,e){e==null&&(e={});let r=e.fetchFunc==null?B().platform.fetch:e.fetchFunc,n=t.map(p=>r(p,e.requestInit,{isBinary:!0})),o=0,s=.5,a=(e.onProgress==null?await Promise.all(n):await n2(n,e.onProgress,o,s)).map(p=>p.arrayBuffer()),l=.5,u=1;return e.onProgress==null?await Promise.all(a):await n2(a,e.onProgress,l,u)}async function RP(t,e="",r,n){return s2(i=>o2(i,{requestInit:n}))(t,e,r)}function s2(t){return async(e,r="",n)=>{let o=e.map(()=>!1),s={},i=n!=null?n.map(()=>!1):[],a=[];if(e.forEach((d,m)=>{let h=0;d.weights.forEach(g=>{let x="quantization"in g?g.quantization.dtype:g.dtype,y=kx[x]*lt(g.shape),b=()=>{o[m]=!0,s[m]==null&&(s[m]=[]),s[m].push({manifestEntry:g,groupOffset:h,sizeBytes:y})};n!=null?n.forEach((v,C)=>{v===g.name&&(b(),i[C]=!0)}):b(),a.push(g.name),h+=y})}),!i.every(d=>d)){let d=n.filter((m,h)=>!i[h]);throw new Error(`Could not find weights in manifest with names: ${d.join(", ")}. 
Manifest JSON has weights with names: ${a.join(", ")}.`)}let l=o.reduce((d,m,h)=>(m&&d.push(h),d),[]),u=[];l.forEach(d=>{e[d].paths.forEach(m=>{let h=r+(r.endsWith("/")?"":"/")+m;u.push(h)})});let c=await t(u),p={},f=0;return l.forEach(d=>{let m=e[d].paths.length,h=0;for(let v=0;v<m;v++)h+=c[f+v].byteLength;let g=new ArrayBuffer(h),x=new Uint8Array(g),y=0;for(let v=0;v<m;v++){let C=new Uint8Array(c[f+v]);x.set(C,y),y+=C.byteLength}s[d].forEach(v=>{let C=g.slice(v.groupOffset,v.groupOffset+v.sizeBytes),S=c1(C,[v.manifestEntry]);for(let k in S)p[k]=S[k]}),f+=m}),p}}var DZ="application/octet-stream",$Z="application/json",Tx=class{constructor(e,r){if(this.DEFAULT_METHOD="POST",r==null&&(r={}),this.weightPathPrefix=r.weightPathPrefix,this.onProgress=r.onProgress,this.weightUrlConverter=r.weightUrlConverter,r.fetchFunc!=null?(A(typeof r.fetchFunc=="function",()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"),this.fetch=r.fetchFunc):this.fetch=B().platform.fetch,A(e!=null&&e.length>0,()=>"URL path for http must not be null, undefined or empty."),Array.isArray(e)&&A(e.length===2,()=>`URL paths for http must have a length of 2, (actual length is ${e.length}).`),this.path=e,r.requestInit!=null&&r.requestInit.body!=null)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=r.requestInit||{}}async save(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");let r=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);r.body=new FormData;let n=[{paths:["./model.weights.bin"],weights:e.weightSpecs}],o=p1(e,n);r.body.append("model.json",new Blob([JSON.stringify(o)],{type:$Z}),"model.json"),e.weightData!=null&&r.body.append("model.weights.bin",new Blob([e.weightData],{type:DZ}),"model.weights.bin");let s=await this.fetch(this.path,r);if(s.ok)return{modelArtifactsInfo:zi(e),responses:[s]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${s.status}.`)}async load(){let e=await this.fetch(this.path,this.requestInit);if(!e.ok)throw new Error(`Request to ${this.path} failed with status code ${e.status}. Please verify this URL points to the model JSON of the model to load.`);let r;try{r=await e.json()}catch{let i=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?i+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":i+=" Please make sure the server is serving valid JSON for this request.",new Error(i)}let n=r.modelTopology,o=r.weightsManifest;if(n==null&&o==null)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);return Im(r,s=>this.loadWeights(s))}async loadWeights(e){let r=Array.isArray(this.path)?this.path[1]:this.path,[n,o]=RZ(r),s=this.weightPathPrefix||n,i=f1(e),a=[],l=[];for(let c of e)for(let p of c.paths)this.weightUrlConverter!=null?l.push(this.weightUrlConverter(p)):a.push(s+p+o);this.weightUrlConverter&&a.push(...await Promise.all(l));let u=await o2(a,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});return[i,Nm(u)]}};Tx.URL_SCHEME_REGEX=/^https?:\/\//;function RZ(t){let e=t.lastIndexOf("/"),r=t.lastIndexOf("?"),n=t.substring(0,e),o=r>e?t.substring(r):"";return[n+"/",o]}function g1(t){return t.match(Tx.URL_SCHEME_REGEX)!=null}var OP=(t,e)=>{if(typeof fetch>"u"&&(e==null||e.fetchFunc==null))return null;{let r=!0;if(Array.isArray(t)?r=t.every(n=>g1(n)):r=g1(t),r)return x1(t,e)}return null};Nt.registerSaveRouter(OP);Nt.registerLoadRouter(OP);function x1(t,e){return new Tx(t,e)}function FP(t,e){return x1(t,e)}var Nx=class{constructor(e){this.modelArtifacts=e}load(){return this.modelArtifacts}},y1=class{constructor(e){this.saveHandler=e}save(e){return this.saveHandler(e)}},i2=class{constructor(e){e.load&&(this.load=()=>Promise.resolve(e.load())),e.save&&(this.save=r=>Promise.resolve(e.save(r)))}};function PP(t,e,r,n){let o=arguments;return new i2(a2(...o))}function a2(t,e,r,n){return arguments.length===1?t.modelTopology!=null||t.weightSpecs!=null?new Nx(t):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Nx({modelTopology:t})):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new Nx({modelTopology:t,weightSpecs:e,weightData:r,trainingConfig:n}))}function LP(t){return new y1(t)}function MP(t){return new y1(t)}function OZ(t,e,r=!1,n=!1){let o=I(t,"a","matMul"),s=I(e,"b","matMul");[o,s]=Xe(o,s);let i={a:o,b:s},a={transposeA:r,transposeB:n};return E.runKernel(ku,i,a)}var nt=_({matMul_:OZ});function FZ(t,e,r=1,n=0,o="int32"){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);let i={indices:I(t,"indices","oneHot","int32")},a={dtype:o,depth:e,onValue:r,offValue:n};return E.runKernel(ju,i,a)}var Am=_({oneHot_:FZ});function PZ(t){B().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(t+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}sP(PZ);function gs(){return E}function Ix(){return E.memory()}function U(t,e){return E.tidy(t,e)}function Me(t){Sx(t).forEach(r=>r.dispose())}function Gr(t){return E.keep(t)}function b1(t,e,r=1){return E.registerBackend(t,e,r)}function zP(){return E.backend}function LZ(t){let r={input:I(t,"input","imag")};return E.runKernel(nm,r)}var Dm=_({imag_:LZ});function MZ(t){let r={x:I(t,"x","neg")};return E.runKernel(Hu,r)}var ot=_({neg_:MZ});function zZ(t){let r={input:I(t,"input","real")};return E.runKernel(pm,r)}var qp=_({real_:zZ});function BZ(t,e,r){let n=I(t,"x","transpose");if(e==null&&(e=n.shape.map((i,a)=>a).reverse()),A(n.rank===e.length,()=>`Error in transpose: rank of input ${n.rank} must match length of perm ${e}.`),e.forEach(i=>{A(i>=0&&i<n.rank,()=>`All entries in 'perm' must be between 0 and ${n.rank-1} but got ${e}`)}),n.rank<=1)return n.clone();let o={x:n},s={perm:e};return n.dtype==="complex64"?U(()=>{let i=qp(n),a=Dm(n);return i=E.runKernel(Pi,{x:i},s),a=E.runKernel(Pi,{x:a},s),r&&(a=ot(a)),jo(i,a)}):E.runKernel(Pi,o,s)}var Ge=_({transpose_:BZ});var No={};Ho(No,{assertAndGetBroadcastShape:()=>Be,getBroadcastDims:()=>BP,getReductionAxes:()=>wt});function BP(t,e){let r=t.length,n=[];for(let o=0;o<r;o++){let s=r-1-o,i=t[s]||1;(e[e.length-1-o]||1)>1&&i===1&&n.unshift(s)}return n}function wt(t,e){let r=[];for(let n=0;n<e.length;n++){let o=t[t.length-n-1],s=e.length-n-1,i=e[s];(o==null||o===1&&i>1)&&r.unshift(s)}return r}function Be(t,e){let r=[],n=Math.max(t.length,e.length);for(let o=0;o<n;o++){let s=t[t.length-o-1];s==null&&(s=1);let i=e[e.length-o-1];if(i==null&&(i=1),s===1)r.unshift(i);else if(i===1)r.unshift(s);else if(s!==i){let a=`Operands could not be broadcast together with shapes ${t} and ${e}.`;throw Error(a)}else r.unshift(s)}return r}var Ex={};Ho(Ex,{fromPixels:()=>jZ,fromPixelsAsync:()=>HZ,toPixels:()=>qZ});function VP(t,e,r){if(Np(t),e!=null&&e.length!==3)throw new Error("tensor3d() requires shape to have three numbers");let n=dl(t,r);if(n.length!==3&&n.length!==1)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Mi(t,e,n,r)}var jp;function WP(t,e=3){if(e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(t==null)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let r=!1,n=!1,o=!1,s=!1,i=!1,a=!1;if(t.data instanceof Uint8Array)r=!0;else if(typeof ImageData<"u"&&t instanceof ImageData)n=!0;else if(typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement)o=!0;else if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement)s=!0;else if(t.getContext!=null)i=!0;else if(typeof ImageBitmap<"u"&&t instanceof ImageBitmap)a=!0;else throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${t.constructor.name}`);if(yx(xx,E.backendName)!=null){let m={pixels:t},h={numChannels:e};return E.runKernel(xx,m,h)}let[u,c]=o?[t.videoWidth,t.videoHeight]:[t.width,t.height],p;if(i)p=t.getContext("2d").getImageData(0,0,u,c).data;else if(n||r)p=t.data;else if(s||o||a){if(jp==null)if(typeof document>"u")if(typeof OffscreenCanvas<"u"&&typeof OffscreenCanvasRenderingContext2D<"u")jp=new OffscreenCanvas(1,1).getContext("2d");else throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");else jp=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});jp.canvas.width=u,jp.canvas.height=c,jp.drawImage(t,0,0,u,c),p=jp.getImageData(0,0,u,c).data}let f;if(e===4)f=new Int32Array(p);else{let m=u*c;f=new Int32Array(m*e);for(let h=0;h<m;h++)for(let g=0;g<e;++g)f[h*e+g]=p[h*4+g]}return VP(f,[c,u,e],"int32")}function VZ(t){return t!=null&&t.data instanceof Uint8Array}function WZ(){return typeof window<"u"&&typeof ImageBitmap<"u"&&window.hasOwnProperty("createImageBitmap")}function GZ(t){return t!=null&&t.width!==0&&t.height!==0}function UZ(t){return WZ()&&!(t instanceof ImageBitmap)&&GZ(t)&&!VZ(t)}async function HZ(t,e=3){let r=null;if(B().getBool("WRAP_TO_IMAGEBITMAP")&&UZ(t)){let n;try{n=await createImageBitmap(t,{premultiplyAlpha:"none"})}catch{n=null}n!=null&&n.width===t.width&&n.height===t.height?r=n:r=t}else r=t;return WP(r,e)}async function qZ(t,e){let r=I(t,"img","toPixels");if(!(t instanceof Ze)){let u=r;r=oe(u,"int32"),u.dispose()}if(r.rank!==2&&r.rank!==3)throw new Error(`toPixels only supports rank 2 or 3 tensors, got rank ${r.rank}.`);let[n,o]=r.shape.slice(0,2),s=r.rank===2?1:r.shape[2];if(s>4||s===2)throw new Error(`toPixels only supports depth of size 1, 3 or 4 but got ${s}`);if(r.dtype!=="float32"&&r.dtype!=="int32")throw new Error(`Unsupported type for toPixels: ${r.dtype}. Please use float32 or int32 tensors.`);let i=await r.data(),a=r.dtype==="float32"?255:1,l=new Uint8ClampedArray(o*n*4);for(let u=0;u<n*o;++u){let c=[0,0,0,255];for(let f=0;f<s;f++){let d=i[u*s+f];if(r.dtype==="float32"){if(d<0||d>1)throw new Error(`Tensor values for a float32 Tensor must be in the range [0 - 1] but encountered ${d}.`)}else if(r.dtype==="int32"&&(d<0||d>255))throw new Error(`Tensor values for a int32 Tensor must be in the range [0 - 255] but encountered ${d}.`);s===1?(c[0]=d*a,c[1]=d*a,c[2]=d*a):c[f]=d*a}let p=u*4;l[p+0]=Math.round(c[0]),l[p+1]=Math.round(c[1]),l[p+2]=Math.round(c[2]),l[p+3]=Math.round(c[3])}if(e!=null){e.width=o,e.height=n;let u=e.getContext("2d"),c=new ImageData(l,o,n);u.putImageData(c,0,0)}return r!==t&&r.dispose(),l}var jZ=_({fromPixels_:WP});function KZ(t,e){let r=t.shape.length,n=e.shape.length;if(r<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${r}.`);if(n<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${n}.`);if(e.dtype!=="int32")throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[n-1]>r)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[n-1]} vs. ${r}`);if(lt(t.shape)===0)throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${t.shape}.`);let o=e.shape,s=o[o.length-1],i=1;for(let p=0;p<o.length-1;++p)i*=o[p];let a=t.shape,l=o.slice();l.pop();let u=1;for(let p=s;p<r;++p)u*=a[p],l.push(a[p]);let c=[...$i(t.shape).map(p=>p/u),1].slice(0,s);return[l,i,u,c]}function GP(t,e,r){let n=e.rank>1?e.shape[e.rank-1]:1,o=e.rank>1?e.rank-1:1,s=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${r.shape}, indices.shape: ${e.shape}, shape: ${t}, sliceDim: ${n}, and batchDim: ${o}.`;if(r.rank<o)throw new Error(s+` update.rank < ${o}. `);if(t.length<n+(r.rank-o))throw new Error(s+` Output shape length < ${n+(r.rank-o)}`);if(r.rank!==o+t.length-n)throw new Error(s+` update.rank != ${o+t.length-n}`);for(let i=0;i<o;++i)if(r.shape[i]!==e.shape[i])throw new Error(s+` updates.shape[${i}] (${r.shape[i]}) != indices.shape[${i}] (${e.shape[i]}).`);for(let i=0;i<r.rank-o;++i)if(r.shape[i+o]!==t[i+n])throw new Error(s+` updates.shape[${i+o}] (${r.shape[i+o]}) != shape[${i+o}] (${t[i+o]})`)}function XZ(t,e,r){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${t.rank}.`);if(e.dtype!=="int32")throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(r.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${r}`);if(r.length===0){if(e.size===0)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(t.size===0)throw new Error(`Updates specified for empty output. updates shape: ${t.shape}`)}GP(r,e,t)}function YZ(t,e,r){let n=e.shape.length,o=n>1?e.shape[n-1]:1,s=r.length,i=1;for(let p=o;p<s;++p)i*=r[p];let a=o<1?1:o,l=lt(e.shape)/a,u=[...$i(r.slice(0,o)),1],c=lt(r);return{sliceRank:o,numUpdates:l,sliceSize:i,strides:u,outputSize:c}}var Ur={};Ho(Ur,{assertParamsValid:()=>ZZ,computeFlatOffset:()=>nJ,computeOutShape:()=>eJ,getNormalizedAxes:()=>tJ,isSliceContinous:()=>rJ,maskToAxes:()=>JZ,parseSliceParams:()=>u2,sliceInfo:()=>oJ,startForAxis:()=>QP,startIndicesWithElidedDims:()=>KP,stopForAxis:()=>ZP,stopIndicesWithElidedDims:()=>XP,stridesForAxis:()=>YP,stridesWithElidedDims:()=>HP});var l2=-2,QZ=-1;function ZZ(t,e,r){let n=t.shape.length;A(n===e.length,()=>`Error in slice${n}D: Length of begin ${e} must match the rank of the array (${n}).`),A(n===r.length,()=>`Error in slice${n}D: Length of size ${r} must match the rank of the array (${n}).`);for(let o=0;o<n;++o)A(e[o]+r[o]<=t.shape[o],()=>`Error in slice${n}D: begin[${o}] + size[${o}] (${e[o]+r[o]}) would overflow input.shape[${o}] (${t.shape[o]})`)}function JZ(t){let e=[],r=0;for(;t>0;)t&1&&e.push(r),t/=2,r++;return e}function eJ(t,e,r){let n=[];for(let o=0;o<t.length;o++)n[o]=Math.ceil((e[o]-t[o])/r[o]);return n}function HP(t,e,r,n){let o=[...t];for(let s=o.length;s<n.length;s++)o.push(1);for(let s=0;s<r;s++)s===0?o[e]=1:(o.splice(e,0,1),o.pop());return o}function qP(t,e,r){return r<=t?r:r-(e-1)}function jP(t,e){let r=[];for(let n=0;n<t;n++)r.push(e+n);return r}function tJ(t,e,r,n,o,s,i,a,l){let u=t.length,c=new Array(u),p=new Array(u),f=new Array(u);if(e.length&&r>0){let d=e[0],m=r+1;c=KP(i,d,m,n,t),p=XP(a,d,m,o,t),f=HP(s,d,m,t)}else for(let d=0;d<u;d++)c[d]=QP(i,n,s,t,d,l),p[d]=ZP(a,o,s,t,d,l),f[d]=YP(s,d,l);return{begin:c,end:p,strides:f}}function KP(t,e,r,n,o){let s=[...o],i=jP(r,e);for(let a=0;a<s.length;a++)if(i.indexOf(a)>-1)s[a]=0;else{let l=qP(e,r,a),u=n[l];t&1<<l&&(u=0),s[a]=u}return s}function XP(t,e,r,n,o){let s=[...o],i=jP(r,e);for(let a=0;a<s.length;a++)if(i.indexOf(a)>-1)s[a]=Number.MAX_SAFE_INTEGER;else{let l=qP(e,r,a),u=n[l];t&1<<l&&(u=Number.MAX_SAFE_INTEGER),s[a]=u}for(let a=0;a<s.length;a++){let l=o[a];s[a]<0&&(s[a]+=l),s[a]=_d(0,s[a],o[a])}return s}function YP(t,e,r){let n=t[e];return(r&1<<e||n==null)&&(n=1),n}function QP(t,e,r,n,o,s){let i=e[o],a=r[o]||1;(t&1<<o||s&1<<o||i==null)&&(a>0?i=Number.MIN_SAFE_INTEGER:i=Number.MAX_SAFE_INTEGER);let l=n[o];return i<0&&(i+=l),i=_d(0,i,l-1),i}function ZP(t,e,r,n,o,s){let i=e[o],a=r[o]||1;(t&1<<o||s&1<<o||i==null)&&(a>0?i=Number.MAX_SAFE_INTEGER:i=Number.MIN_SAFE_INTEGER);let l=n[o];return i<0&&(i+=l),a>0?i=_d(0,i,l):i=_d(-1,i,l-1),i}function rJ(t,e,r){let n=r.length;for(let o=0;o<r.length;o++)if(r[o]>1){n=o;break}for(let o=n+1;o<r.length;o++)if(e[o]>0||r[o]!==t[o])return!1;return!0}function nJ(t,e){let r=t.length>0?t[t.length-1]:1;for(let n=0;n<t.length-1;n++)r+=t[n]*e[n];return r}function u2(t,e,r){let n,o=t.shape.length;typeof e=="number"?n=[e,...new Array(o-1).fill(0)]:e.length<o?n=e.concat(new Array(o-e.length).fill(0)):n=e.slice(),n.forEach(i=>{A(i!==-1,()=>"slice() does not support negative begin indexing.")});let s;return r==null?s=new Array(o).fill(-1):typeof r=="number"?s=[r,...new Array(o-1).fill(-1)]:r.length<o?s=r.concat(new Array(o-r.length).fill(-1)):s=r,s=s.map((i,a)=>i>=0?i:(A(i===-1,()=>`Negative size values should be exactly -1 but got ${i} for the slice() size at index ${a}.`),t.shape[a]-n[a])),[n,s]}function oJ(t,e,r,n,o,s,i,a,l){let u;if(n==null?(u=new Array(e.length),u.fill(1)):u=n,i!=null&&(i&i-1)!==0)throw new Error("Multiple ellipses in slice is not allowed.");let c=!1,p={dims:u.length,numAddAxisAfterEllipsis:0,begin:e.slice(),end:r.slice(),strides:u.slice(),beginMask:o,endMask:s,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:l};for(let b=0;b<p.dims;b++)c&&(1<<b&a)!==0&&p.numAddAxisAfterEllipsis++,1<<b&i&&(c=!0);c||(p.ellipsisMask|=1<<p.dims,p.dims++);let f={dims:t.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};sJ(p,f);let d=!0,m=!0,h=!0,g=[],x=[];for(let b=0;b<t.length;++b){if(f.strides[b]===0)throw Error(`strides[${b}] must be non-zero`);let v=!!(f.shrinkAxisMask&1<<b),C=t[b];if(C===-1){g.push(v?1:-1);continue}let S=[f.beginMask&1<<b,f.endMask&1<<b],k=[f.strides[b]>0?0:-1,f.strides[b]>0?C:C-1];if(v&&f.strides[b]<=0)throw Error("only stride 1 allowed on non-range indexing.");h=h&&f.strides[b]===1;let N=!!(f.beginMask&1<<b&&f.endMask&1<<b);if(f.beginValid&&f.endValid){if(v){let V=f.begin[b]<0?C+f.begin[b]:f.begin[b];if(f.begin[b]=V,f.end[b]=f.begin[b]+1,V<0||V>=C)throw Error(`slice index ${f.begin[b]} of dimension ${b} out of bounds.`)}else f.begin[b]=UP(f.begin[b],0,f.strides[b],C,S,k),f.end[b]=UP(f.end[b],1,f.strides[b],C,S,k);let O=f.strides[b]===1&&f.begin[b]===0&&f.end[b]===C;d=d&&O,m=m&&(b===0&&f.strides[b]===1||O)}else d=d&&f.strides[b]===1&&N,m=m&&(b===0&&f.strides[b]===1||N);let D,$=!1;if(f.beginValid&&f.endValid?(D=f.end[b]-f.begin[b],$=!0):v?(D=1,$=!0):N&&C>=0&&(f.strides[b]<0?D=-C:D=C,$=!0),$){let O;D===0||D<0!=f.strides[b]<0?O=0:O=Math.trunc(D/f.strides[b])+(D%f.strides[b]!==0?1:0),g.push(O)}else g.push(-1)}for(let b=0;b<f.finalShapeGatherIndices.length;++b){let v=f.finalShapeGatherIndices[b];v>=0?x.push(g[v]):v===l2&&x.push(1)}return{finalShapeSparse:x.filter((b,v)=>f.finalShapeGatherIndices[v]!==l2),finalShape:x,isIdentity:d,sliceDim0:m,isSimpleSlice:h,begin:f.begin,end:f.end,strides:f.strides}}function sJ(t,e){e.beginMask=0,e.endMask=0,e.shrinkAxisMask=0;let r=0;e.beginValid=t.begin!=null,e.endValid=t.end!=null,e.begin=new Array(e.dims),e.end=new Array(e.dims),e.strides=new Array(e.dims),e.finalShapeGatherIndices=[],e.finalShapeGatherIndicesSparse=[],e.inputShapeGatherIndicesSparse=new Array(e.dims);for(let n=0;n<t.dims;n++)if(1<<n&t.ellipsisMask){let o=Math.min(e.dims-(t.dims-n)+1+t.numAddAxisAfterEllipsis,e.dims);for(;r<o;r++)e.begin[r]=0,e.end[r]=0,e.strides[r]=1,e.beginMask|=1<<r,e.endMask|=1<<r,e.finalShapeGatherIndices.push(r),e.finalShapeGatherIndicesSparse.push(-1),e.inputShapeGatherIndicesSparse[r]=n}else if(1<<n&t.newAxisMask)e.finalShapeGatherIndices.push(l2),e.finalShapeGatherIndicesSparse.push(-1);else{if(r===e.begin.length)throw Error(`Index out of range using input dim ${r}; input has only ${e.dims} dims, ${e.begin.length}.`);t.begin!=null&&(e.begin[r]=t.begin[n]),t.end!=null&&(e.end[r]=t.end[n]),e.strides[r]=t.strides[n],t.beginMask&1<<n&&(e.beginMask|=1<<r),t.endMask&1<<n&&(e.endMask|=1<<r),t.shrinkAxisMask&1<<n?(e.finalShapeGatherIndices.push(QZ),e.finalShapeGatherIndicesSparse.push(-1),e.shrinkAxisMask|=1<<r):(e.finalShapeGatherIndices.push(r),e.finalShapeGatherIndicesSparse.push(n)),e.inputShapeGatherIndicesSparse[r]=n,r++}}function UP(t,e,r,n,o,s){if(o[e])return r>0?s[e]:s[e+1&1];{let i=t<0?n+t:t;return i<s[0]?s[0]:i>s[1]?s[1]:i}}var J={};Ho(J,{Serializable:()=>_x,SerializationMap:()=>Wi,registerClass:()=>so});var _x=class{getClassName(){return this.constructor.className}static fromConfig(e,r){return new e(r)}},Wi=class{constructor(){this.classNameMap={}}static getMap(){return Wi.instance==null&&(Wi.instance=new Wi),Wi.instance}static register(e){Wi.getMap().classNameMap[e.className]=[e,e.fromConfig]}};function so(t){A(t.className!=null,()=>"Class being registered does not have the static className property defined."),A(typeof t.className=="string",()=>"className is required to be a string, but got type "+typeof t.className),A(t.className.length>0,()=>"Class being registered has an empty-string as its className, which is disallowed."),Wi.register(t)}function iJ(t,e){let r=I(t,"a","add"),n=I(e,"b","add");[r,n]=Xe(r,n);let o={a:r,b:n};return E.runKernel(ti,o)}var te=_({add_:iJ});function aJ(t,e){let r=I(t,"a","floorDiv"),n=I(e,"b","floorDiv");[r,n]=Xe(r,n);let o={a:r,b:n};return E.runKernel(La,o)}var v1=_({floorDiv_:aJ});function lJ(t,e){let r=I(t,"a","div"),n=I(e,"b","div");if([r,n]=Xe(r,n),r.dtype==="int32"&&n.dtype==="int32")return v1(r,n);let o={a:r,b:n},s={};return E.runKernel(Da,o,s)}var xe=_({div_:lJ});function uJ(t,e){let r=I(t,"a","mul"),n=I(e,"b","mul");[r,n]=Xe(r,n);let o={a:r,b:n};return E.runKernel(ja,o)}var L=_({mul_:uJ});function cJ(t){let e=I(t,"x","abs");if(e.dtype==="complex64"){let r={x:e};return E.runKernel(Nu,r)}else{let r={x:e};return E.runKernel(bu,r)}}var Sr=_({abs_:cJ});function pJ(t){let r={x:I(t,"x","acos")};return E.runKernel(va,r)}var c2=_({acos_:pJ});function fJ(t){let r={x:I(t,"x","acosh")};return E.runKernel(wa,r)}var p2=_({acosh_:fJ});function dJ(t,e=null,r=!1){let o={x:I(t,"x","all","bool")},s={axis:e,keepDims:r};return E.runKernel(Pd,o,s)}var Ax=_({all_:dJ});function mJ(t,e=null,r=!1){let o={x:I(t,"x","any","bool")},s={axis:e,keepDims:r};return E.runKernel(Ld,o,s)}var $m=_({any_:mJ});function hJ(t,e=0){let n={x:I(t,"x","argMax")},o={axis:e};return E.runKernel(vu,n,o)}var xl=_({argMax_:hJ});function gJ(t,e=0){let n={x:I(t,"x","argMin")},o={axis:e};return E.runKernel(wu,n,o)}var JP=_({argMin_:gJ});function xJ(t){let r={x:I(t,"x","asin")};return E.runKernel(Ca,r)}var f2=_({asin_:xJ});function yJ(t){let r={x:I(t,"x","asinh")};return E.runKernel(Sa,r)}var d2=_({asinh_:yJ});function bJ(t){let r={x:I(t,"x","atan")};return E.runKernel(ka,r)}var m2=_({atan_:bJ});function vJ(t,e){let r=I(t,"a","atan2"),n=I(e,"b","atan2");[r,n]=Xe(r,n);let o={a:r,b:n};return E.runKernel(Na,o)}var eL=_({atan2_:vJ});function wJ(t){let r={x:I(t,"x","atanh")};return E.runKernel(Ta,r)}var h2=_({atanh_:wJ});function CJ(t,e,r,n,o="NHWC",s){let i=t[3],a=[...e,i],l=rL(o);return Xp(t,a,r,s,n,null,null,l)}function x2(t,e,r,n,o,s,i="channelsLast"){let[a,l]=w1(e),u;if(i==="channelsLast")u=[a,l,t[3],t[3]];else if(i==="channelsFirst")u=[a,l,t[1],t[1]];else throw new Error(`Unknown dataFormat ${i}`);return Xp(t,u,r,n,o,s,!1,i)}function SJ(t,e,r,n,o,s,i="NDHWC"){let[a,l,u]=g2(e),c,p;if(i==="NDHWC")p="channelsLast",c=[a,l,u,t[4],t[4]];else if(i==="NCDHW")p="channelsFirst",c=[a,l,u,t[1],t[1]];else throw new Error(`Unknown dataFormat ${i}`);return tL(t,c,r,n,o,!1,p,s)}function Xp(t,e,r,n,o,s,i=!1,a="channelsLast"){let[l,u,c,p]=[-1,-1,-1,-1];if(a==="channelsLast")[l,u,c,p]=t;else if(a==="channelsFirst")[l,p,u,c]=t;else throw new Error(`Unknown dataFormat ${a}`);let[f,d,,m]=e,[h,g]=w1(r),[x,y]=w1(n),b=Rm(f,x),v=Rm(d,y),{padInfo:C,outHeight:S,outWidth:k}=NJ(o,u,c,h,g,b,v,s,a),N=i?m*p:m,D;return a==="channelsFirst"?D=[l,N,S,k]:a==="channelsLast"&&(D=[l,S,k,N]),{batchSize:l,dataFormat:a,inHeight:u,inWidth:c,inChannels:p,outHeight:S,outWidth:k,outChannels:N,padInfo:C,strideHeight:h,strideWidth:g,filterHeight:f,filterWidth:d,effectiveFilterHeight:b,effectiveFilterWidth:v,dilationHeight:x,dilationWidth:y,inShape:t,outShape:D,filterShape:e}}function tL(t,e,r,n,o,s=!1,i="channelsLast",a){let[l,u,c,p,f]=[-1,-1,-1,-1,-1];if(i==="channelsLast")[l,u,c,p,f]=t;else if(i==="channelsFirst")[l,f,u,c,p]=t;else throw new Error(`Unknown dataFormat ${i}`);let[d,m,h,,g]=e,[x,y,b]=g2(r),[v,C,S]=g2(n),k=Rm(d,v),N=Rm(m,C),D=Rm(h,S),{padInfo:$,outDepth:O,outHeight:V,outWidth:K}=IJ(o,u,c,p,x,y,b,k,N,D,a),X=s?g*f:g,W;return i==="channelsFirst"?W=[l,X,O,V,K]:i==="channelsLast"&&(W=[l,O,V,K,X]),{batchSize:l,dataFormat:i,inDepth:u,inHeight:c,inWidth:p,inChannels:f,outDepth:O,outHeight:V,outWidth:K,outChannels:X,padInfo:$,strideDepth:x,strideHeight:y,strideWidth:b,filterDepth:d,filterHeight:m,filterWidth:h,effectiveFilterDepth:k,effectiveFilterHeight:N,effectiveFilterWidth:D,dilationDepth:v,dilationHeight:C,dilationWidth:S,inShape:t,outShape:W,filterShape:e}}function kJ(t,e,r,n,o){n==null&&(n=y2(t,e,r));let s=t[0],i=t[1],a=Kp((s-e+2*n)/r+1,o),l=Kp((i-e+2*n)/r+1,o);return[a,l]}function TJ(t,e,r,n,o,s){o==null&&(o=y2(t,e,n));let i=t[0],a=t[1],l=t[2],u=Kp((i-e+2*o)/n+1,s),c=Kp((a-e+2*o)/n+1,s),p=Kp((l-e+2*o)/n+1,s);return[u,c,p,r]}function y2(t,e,r,n=1){let o=Rm(e,n);return Math.floor((t[0]*(r-1)-r+o)/2)}function w1(t){return typeof t=="number"?[t,t,t]:t.length===2?[t[0],t[1],1]:t}function g2(t){return typeof t=="number"?[t,t,t]:t}function Rm(t,e){return e<=1?t:t+(t-1)*(e-1)}function NJ(t,e,r,n,o,s,i,a,l){let u,c,p;if(typeof t=="number"){u={top:t,bottom:t,left:t,right:t,type:t===0?"VALID":"NUMBER"};let d=kJ([e,r],s,n,t,a);c=d[0],p=d[1]}else if(t==="same"){c=Math.ceil(e/n),p=Math.ceil(r/o);let f=Math.max(0,(c-1)*n+s-e),d=Math.max(0,(p-1)*o+i-r),m=Math.floor(f/2),h=f-m,g=Math.floor(d/2),x=d-g;u={top:m,bottom:h,left:g,right:x,type:"SAME"}}else if(t==="valid")u={top:0,bottom:0,left:0,right:0,type:"VALID"},c=Math.ceil((e-s+1)/n),p=Math.ceil((r-i+1)/o);else if(typeof t=="object"){let f=l==="channelsLast"?t[1][0]:t[2][0],d=l==="channelsLast"?t[1][1]:t[2][1],m=l==="channelsLast"?t[2][0]:t[3][0],h=l==="channelsLast"?t[2][1]:t[3][1];u={top:f,bottom:d,left:m,right:h,type:f===0&&d===0&&m===0&&h===0?"VALID":"EXPLICIT"},c=Kp((e-s+f+d)/n+1,a),p=Kp((r-i+m+h)/o+1,a)}else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:u,outHeight:c,outWidth:p}}function IJ(t,e,r,n,o,s,i,a,l,u,c){let p,f,d,m;if(typeof t=="number"){p={top:t,bottom:t,left:t,right:t,front:t,back:t,type:t===0?"VALID":"NUMBER"};let g=TJ([e,r,n,1],a,1,o,t,c);f=g[0],d=g[1],m=g[2]}else if(t==="same"){f=Math.ceil(e/o),d=Math.ceil(r/s),m=Math.ceil(n/i);let h=(f-1)*o+a-e,g=(d-1)*s+l-r,x=(m-1)*i+u-n,y=Math.floor(h/2),b=h-y,v=Math.floor(g/2),C=g-v,S=Math.floor(x/2),k=x-S;p={top:v,bottom:C,left:S,right:k,front:y,back:b,type:"SAME"}}else if(t==="valid")p={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},f=Math.ceil((e-a+1)/o),d=Math.ceil((r-l+1)/s),m=Math.ceil((n-u+1)/i);else throw Error(`Unknown padding parameter: ${t}`);return{padInfo:p,outDepth:f,outHeight:d,outWidth:m}}function Kp(t,e){if(!e)return Math.trunc(t);switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error(`Unknown roundingMode ${e}`)}}function Ko(t){let[e,r,n]=w1(t);return e===1&&r===1&&n===1}function on(t,e){return Ko(t)||Ko(e)}function rL(t){if(t==="NHWC")return"channelsLast";if(t==="NCHW")return"channelsFirst";throw new Error(`Unknown dataFormat ${t}`)}function It(t,e,r){if(r!=null){if(typeof e=="string")throw Error(`Error in ${t}: pad must be an integer when using dimRoundingMode ${r} but got pad ${e}.`);if(typeof e=="number")A(ba(e),()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${r} but got pad ${e}.`);else if(typeof e=="object")e.forEach(n=>{n.forEach(o=>{A(ba(o),()=>`Error in ${t}: pad must be an integer when using dimRoundingMode ${r} but got pad ${o}.`)})});else throw Error(`Error in ${t}: Unknown padding parameter: ${e}`)}}function EJ(t,e){let n={x:I(t,"x","reshape","string_or_numeric")},o={shape:e};return E.runKernel(Zu,n,o)}var M=_({reshape_:EJ});function _J(t,e,r,n,o){let s=I(t,"x","avgPool","float32"),i=1;A(on(r,i),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${r} and dilations '${i}'`);let a=s,l=!1;s.rank===3&&(l=!0,a=M(s,[1,s.shape[0],s.shape[1],s.shape[2]])),A(a.rank===4,()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`),It("avgPool",n,o);let u={x:a},c={filterSize:e,strides:r,pad:n,dimRoundingMode:o},p=E.runKernel(Cu,u,c);return p=oe(p,s.dtype),l?M(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var Yp=_({avgPool_:_J});function AJ(t,e,r,n,o,s="NDHWC"){let i=I(t,"x","avgPool3d","float32"),a=i,l=!1;i.rank===4&&(l=!0,a=M(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),A(a.rank===5,()=>`Error in avgPool3d: x must be rank 5 but got rank ${a.rank}.`),A(s==="NDHWC",()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${s}`),It("avgPool3d",n,o);let u={x:a},c={filterSize:e,strides:r,pad:n,dimRoundingMode:o,dataFormat:s},p=E.runKernel(Su,u,c);return p=oe(p,a.dtype),l?M(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}var b2=_({avgPool3d_:AJ});function DJ(t,e=0){A(t.length>=1,()=>"Pass at least one tensor to concat");let r=l1(t,"tensors","concat","string_or_numeric");if(r[0].dtype==="complex64"&&r.forEach(s=>{if(s.dtype!=="complex64")throw new Error(`Cannot concatenate complex64 tensors with a tensor
          with dtype ${s.dtype}. `)}),r.length===1)return To(r[0]);let n=r,o={axis:e};return E.runKernel(Iu,n,o)}var $t=_({concat_:DJ});function $J(t){let r={x:I(t,"x","sigmoid","float32")};return E.runKernel(ol,r)}var xs=_({sigmoid_:$J});function RJ(t,e,r){let n=I(t,"x","slice","string_or_numeric");if(n.rank===0)throw new Error("Slicing scalar is not possible");let o={x:n},s={begin:e,size:r};return E.runKernel(nc,o,s)}var et=_({slice_:RJ});function OJ(t){let r={x:I(t,"x","tanh","float32")};return E.runKernel(cl,r)}var Om=_({tanh_:OJ});function FJ(t,e,r){let n=I(t,"x","batchToSpaceND"),o=e.reduce((a,l)=>a*l);A(n.rank>=1+e.length,()=>`input rank is ${n.rank} but should be > than blockShape.length ${e.length}`),A(r.length===e.length,()=>`crops.length is ${r.length} but should be equal to blockShape.length  ${e.length}`),A(n.shape[0]%o===0,()=>`input tensor batch is ${n.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${o}`);let s={x:n},i={blockShape:e,crops:r};return E.runKernel(Tu,s,i)}var Fm=_({batchToSpaceND_:FJ});function nL(t){let e;return t.rank===0||t.rank===1?e=M(t,[1,1,1,t.size]):t.rank===2?e=M(t,[1,1,t.shape[0],t.shape[1]]):t.rank===3?e=M(t,[1,t.shape[0],t.shape[1],t.shape[2]]):e=t,e}function PJ(t,e,r,n,o,s){s==null&&(s=.001);let i=I(t,"x","batchNorm"),a=I(e,"mean","batchNorm"),l=I(r,"variance","batchNorm"),u;o!=null&&(u=I(o,"scale","batchNorm"));let c;n!=null&&(c=I(n,"offset","batchNorm")),A(a.rank===l.rank,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),A(c==null||a.rank===c.rank,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),A(u==null||a.rank===u.rank,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let f={x:nL(i),scale:u,offset:c,mean:a,variance:l},d={varianceEpsilon:s},m=E.runKernel(Fu,f,d);return M(m,i.shape)}var hc=_({batchNorm_:PJ});function LJ(t,e,r,n,o,s){let i=I(t,"x","batchNorm"),a=I(e,"mean","batchNorm"),l=I(r,"variance","batchNorm"),u;o!=null&&(u=I(o,"scale","batchNorm"));let c;return n!=null&&(c=I(n,"offset","batchNorm")),A(i.rank===2,()=>`Error in batchNorm2D: x must be rank 2 but got rank ${i.rank}.`),A(a.rank===2||a.rank===1,()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`),A(l.rank===2||l.rank===1,()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${l.rank}.`),u!=null&&A(u.rank===2||u.rank===1,()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${u.rank}.`),c!=null&&A(c.rank===2||c.rank===1,()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${c.rank}.`),hc(i,a,l,c,u,s)}var v2=_({batchNorm2d_:LJ});function MJ(t,e,r,n,o,s){let i=I(t,"x","batchNorm"),a=I(e,"mean","batchNorm"),l=I(r,"variance","batchNorm"),u;o!=null&&(u=I(o,"scale","batchNorm"));let c;return n!=null&&(c=I(n,"offset","batchNorm")),A(i.rank===3,()=>`Error in batchNorm3D: x must be rank 3 but got rank ${i.rank}.`),A(a.rank===3||a.rank===1,()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`),A(l.rank===3||l.rank===1,()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${l.rank}.`),u!=null&&A(u.rank===3||u.rank===1,()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${u.rank}.`),c!=null&&A(c.rank===3||c.rank===1,()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${c.rank}.`),hc(i,a,l,c,u,s)}var w2=_({batchNorm3d_:MJ});function zJ(t,e,r,n,o,s){let i=I(t,"x","batchNorm"),a=I(e,"mean","batchNorm"),l=I(r,"variance","batchNorm"),u;o!=null&&(u=I(o,"scale","batchNorm"));let c;return n!=null&&(c=I(n,"offset","batchNorm")),A(i.rank===4,()=>`Error in batchNorm4D: x must be rank 4 but got rank ${i.rank}.`),A(a.rank===4||a.rank===1,()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`),A(l.rank===4||l.rank===1,()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${l.rank}.`),u!=null&&A(u.rank===4||u.rank===1,()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${u.rank}.`),c!=null&&A(c.rank===4||c.rank===1,()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${c.rank}.`),hc(i,a,l,c,u,s)}var C2=_({batchNorm4d_:zJ});function BJ(t,e,r){let n=I(t,"x","bincount"),o=I(e,"weights","bincount");A(n.dtype==="int32",()=>`Error in bincount: input dtype must be int32, but got ${n.dtype}`),A(r>=0,()=>`size must be non-negative, but got ${r}.`),A(o.size===n.size||o.size===0,()=>`Error in bincount: weights must have the same size as input or0-length, but got input shape: ${n.shape}, weights shape: ${o.shape}.`);let s={x:n,weights:o},i={size:r};return E.runKernel(Bd,s,i)}var oL=_({bincount_:BJ});function VJ(t,e){let r=I(t,"broadcastTo","x"),n=r.shape;if(tn(e),e.length<r.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${r.rank}.`);if(e.length>r.rank){let u=r.shape.slice();for(;u.length<e.length;)u.unshift(1);r=M(r,u)}let o=r.shape,s=Array.from(e);for(let u=e.length-1;u>=0;u--)if(o[u]===e[u])s[u]=1;else if(r.shape[u]!==1)throw new Error(`broadcastTo(): [${n}] cannot be broadcast to [${e}].`);if(s.map((u,c)=>u>1?c:-1).filter(u=>u>=0).length===0)return To(r);let a={x:r},l={reps:s};return E.runKernel(Fi,a,l)}var yl=_({broadcastTo_:VJ});function WJ(t){let r={x:I(t,"x","ceil","float32")};return E.runKernel(Ia,r)}var S2=_({ceil_:WJ});function bl(t,e,r){tn(t);let n={shape:t,value:e,dtype:r};return E.runKernel(em,{},n)}function GJ(t,e,r){let n=I(t,"x","clipByValue");if(A(e<=r,()=>`Error in clip: min (${e}) must be less than or equal to max (${r}).`),e===r)return bl(n.shape,e,n.dtype);let o={x:n},s={clipValueMin:e,clipValueMax:r};return E.runKernel(Ea,o,s)}var sn=_({clipByValue_:GJ});function UJ(t){return $t(t,0)}var k2=_({concat1d_:UJ});function HJ(t,e){return $t(t,e)}var T2=_({concat2d_:HJ});function qJ(t,e){return $t(t,e)}var N2=_({concat3d_:qJ});function jJ(t,e){return $t(t,e)}var I2=_({concat4d_:jJ});function KJ(t,e,r,n,o="NHWC",s=[1,1],i){let a=I(t,"x","conv2d","float32"),l=I(e,"filter","conv2d","float32"),u=a,c=!1;a.rank===3&&(c=!0,u=M(a,[1,a.shape[0],a.shape[1],a.shape[2]])),A(u.rank===4,()=>`Error in conv2d: input must be rank 4, but got rank ${u.rank}.`),A(l.rank===4,()=>`Error in conv2d: filter must be rank 4, but got rank ${l.rank}.`),It("conv2d",n,i);let p=o==="NHWC"?u.shape[3]:u.shape[1];A(p===l.shape[2],()=>`Error in conv2d: depth of input (${p}) must match input depth for filter ${l.shape[2]}.`),A(on(r,s),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${r} and dilations '${s}'`);let f={x:u,filter:l},d={strides:r,pad:n,dataFormat:o,dilations:s,dimRoundingMode:i},m=E.runKernel(Eu,f,d);return c?M(m,[m.shape[1],m.shape[2],m.shape[3]]):m}var Io=_({conv2d_:KJ});function XJ(t,e,r,n,o="NWC",s=1,i){let a=I(t,"x","conv1d"),l=I(e,"filter","conv1d"),u=a,c=!1;a.rank===2&&(c=!0,u=M(a,[1,a.shape[0],a.shape[1]])),A(u.rank===3,()=>`Error in conv1d: input must be rank 3, but got rank ${u.rank}.`),A(l.rank===3,()=>`Error in conv1d: filter must be rank 3, but got rank ${l.rank}.`),It("conv1d",n,i),A(u.shape[2]===l.shape[1],()=>`Error in conv1d: depth of input (${u.shape[2]}) must match input depth for filter ${l.shape[1]}.`),A(on(r,s),()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${r} and dilation '${s}'`),A(o==="NWC",()=>`Error in conv1d: got dataFormat of ${o} but only NWC is currently supported.`);let p=M(l,[1,l.shape[0],l.shape[1],l.shape[2]]),f=M(u,[u.shape[0],1,u.shape[1],u.shape[2]]),g=Io(f,p,[1,r],n,"NHWC",[1,s],i);return c?M(g,[g.shape[2],g.shape[3]]):M(g,[g.shape[0],g.shape[2],g.shape[3]])}var Dx=_({conv1d_:XJ});function YJ(t,e,r,n,o,s="NHWC",i){A(t.length===e.rank,()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`);let a=t,l=e,u=!1;e.rank===3&&(u=!0,l=M(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,t[0],t[1],t[2]]),A(a.length===4,()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`),A(l.rank===4,()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${l.rank}`),A(r.rank===4,()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${r.rank}`);let c=s==="NHWC"?a[3]:a[1],p=s==="NHWC"?l.shape[3]:l.shape[1];A(c===r.shape[2],()=>`Error in conv2dDerInput: depth of input (${c}) must match input depth for filter ${r.shape[2]}.`),A(p===r.shape[3],()=>`Error in conv2dDerInput: depth of output (${p}) must match output depth for filter ${r.shape[3]}.`),It("conv2dDerInput",o,i);let f={dy:l,filter:r},d={strides:n,pad:o,dataFormat:s,dimRoundingMode:i,inputShape:a},m=E.runKernel(_u,f,d);return u?M(m,[m.shape[1],m.shape[2],m.shape[3]]):m}var Pm=_({conv2DBackpropInput_:YJ});function QJ(t,e,r,n,o,s){let i=I(t,"x","conv2dTranspose"),a=I(e,"filter","conv2dTranspose");return Pm(r,i,a,n,o,"NHWC",s)}var $x=_({conv2dTranspose_:QJ});function ZJ(t,e,r,n,o="NDHWC",s=[1,1,1]){let i=I(t,"x","conv3d"),a=I(e,"filter","conv3d"),l=i,u=!1;i.rank===4&&(u=!0,l=M(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),A(l.rank===5,()=>`Error in conv3d: input must be rank 5, but got rank ${l.rank}.`),A(a.rank===5,()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`),A(l.shape[4]===a.shape[3],()=>`Error in conv3d: depth of input (${l.shape[4]}) must match input depth for filter ${a.shape[3]}.`),A(on(r,s),()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${r} and dilations '${s}'`),A(o==="NDHWC",()=>`Error in conv3d: got dataFormat of ${o} but only NDHWC is currently supported.`);let c={x:l,filter:a},p={strides:r,pad:n,dataFormat:o,dilations:s},f=E.runKernel(Au,c,p);return u?M(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var E2=_({conv3d_:ZJ});function JJ(t,e,r,n,o){A(t.length===e.rank,()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`);let s=t,i=e,a=!1;e.rank===4&&(a=!0,i=M(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),s=[1,t[0],t[1],t[2],t[3]]);let l=s[4],u=i.shape[4];A(s.length===5,()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${s.length}.`),A(i.rank===5,()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${i.rank}`),A(r.rank===5,()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${r.rank}`),A(l===r.shape[3],()=>`Error in conv3dDerInput: depth of input (${l}) must match input depth for filter ${r.shape[3]}.`),A(u===r.shape[4],()=>`Error in conv3dDerInput: depth of output (${u}) must match output depth for filter ${r.shape[4]}.`);let c={dy:i,filter:r},p={pad:o,strides:n,inputShape:s},f=E.runKernel(Ud,c,p);return a?M(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}var C1=_({conv3DBackpropInput_:JJ});function eee(t,e,r,n,o){let s=I(t,"x","conv3dTranspose"),i=I(e,"filter","conv3dTranspose");return C1(r,s,i,n,o)}var _2=_({conv3dTranspose_:eee});function tee(t){let r={x:I(t,"x","cos","float32")};return E.runKernel(_a,r)}var Qp=_({cos_:tee});function ree(t){let r={x:I(t,"x","cosh","float32")};return E.runKernel(Aa,r)}var Rx=_({cosh_:ree});function nee(t,e=0,r=!1,n=!1){let s={x:I(t,"x","cumprod")},i={axis:e,exclusive:r,reverse:n};return E.runKernel(Hd,s,i)}var Ox=_({cumprod_:nee});function oee(t,e=0,r=!1,n=!1){let s={x:I(t,"x","cumsum")},i={axis:e,exclusive:r,reverse:n};return E.runKernel(Du,s,i)}var S1=_({cumsum_:oee});function see(t,e,r,n=!1){let o=I(t,"x","denseBincount"),s=I(e,"weights","denseBincount");A(o.dtype==="int32",()=>`Error in denseBincount: input dtype must be int32, but got ${o.dtype}`),A(o.rank<=2,()=>`Error in denseBincount: input must be at most rank 2, but got rank ${o.rank}.`),A(r>=0,()=>`size must be non-negative, but got ${r}.`),A(s.size===o.size||s.size===0,()=>`Error in denseBincount: weights must have the same shape as x or 0-length, but got x shape: ${o.shape}, weights shape: ${s.shape}.`);let i={x:o,weights:s},a={size:r,binaryOutput:n};return E.runKernel(jd,i,a)}var k1=_({denseBincount_:see});function iee(t,e,r="NHWC"){let n=I(t,"x","depthToSpace","float32"),o=r==="NHWC"?n.shape[1]:n.shape[2],s=r==="NHWC"?n.shape[2]:n.shape[3],i=r==="NHWC"?n.shape[3]:n.shape[1];A(e>1,()=>`blockSize should be > 1 for depthToSpace, but was: ${e}`),A(o*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${o} and ${e}  for depthToSpace with input shape
    ${n.shape}`),A(s*e>=0,()=>`Negative dimension size caused by overflow when multiplying
    ${s} and ${e} for depthToSpace with input shape
        ${n.shape}`),A(i%(e*e)===0,()=>`Dimension size must be evenly divisible by ${e*e} but is ${i} for depthToSpace with input shape ${n.shape}`);let a={x:n},l={blockSize:e,dataFormat:r};return E.runKernel(Kd,a,l)}var sL=_({depthToSpace_:iee});function aee(t,e,r,n,o="NHWC",s=[1,1],i){let a=I(t,"x","depthwiseConv2d","float32"),l=I(e,"filter","depthwiseConv2d","float32"),u=a,c=!1;a.rank===3&&(c=!0,u=M(a,[1,a.shape[0],a.shape[1],a.shape[2]])),A(u.rank===4,()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${u.rank}.`),A(l.rank===4,()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${l.rank}.`);let p=o==="NHWC"?u.shape[3]:u.shape[1];A(p===l.shape[2],()=>`Error in depthwiseConv2d: number of input channels (${p}) must match the inChannels dimension in filter ${l.shape[2]}.`),It("depthwiseConv2d",n,i);let f={x:u,filter:l},d={strides:r,pad:n,dataFormat:o,dilations:s,dimRoundingMode:i},m=E.runKernel($u,f,d);return c?M(m,[m.shape[1],m.shape[2],m.shape[3]]):m}var vl=_({depthwiseConv2d_:aee});function lee(t,e,r,n,o=[1,1],s="NHWC"){let i=I(t,"x","dilation2d"),a=I(e,"filter","dilation2d");A(i.rank===3||i.rank===4,()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${i.rank}.`),A(a.rank===3,()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`),A(s==="NHWC",()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${s}`);let l=i,u=!1;i.rank===3&&(l=M(i,[1,i.shape[0],i.shape[1],i.shape[2]]),u=!0);let c={x:l,filter:a},p={strides:r,pad:n,dilations:o},f=E.runKernel(Ru,c,p);return u?M(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var iL=_({dilation2d_:lee});function uee(t,e){let r=I(t,"a","equal","string_or_numeric"),n=I(e,"b","equal","string_or_numeric");[r,n]=Xe(r,n),Be(r.shape,n.shape);let o={a:r,b:n};return E.runKernel(Ep,o)}var Hn=_({equal_:uee});function cee(t,e,r){let n=I(e,"a","where"),o=I(r,"b","where"),s=I(t,"condition","where","bool"),i=Be(Be(s.shape,n.shape),o.shape),a=yl(s,i),l=yl(n,i),u=yl(o,i),c={condition:a,t:l,e:u};return E.runKernel(rc,c)}var Bt=_({where_:cee});function pee(t){let r={x:I(t,"x","zerosLike")};return E.runKernel(cc,r)}var _e=_({zerosLike_:pee});function fee(t,e){let r=I(t,"a","div"),n=I(e,"b","div");[r,n]=Xe(r,n);let o=xe(r,n),s=_e(o),i=Hn(n,s);return Bt(i,s,o)}var aL=_({divNoNan_:fee});function dee(t,e){let r=I(t,"t1","dot"),n=I(e,"t2","dot");A((r.rank===1||r.rank===2)&&(n.rank===1||n.rank===2),()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${r.rank} and ${n.rank}.`);let o=r.rank===1?r.size:r.shape[1],s=n.rank===1?n.size:n.shape[0];if(A(o===s,()=>`Error in dot: inner dimensions of inputs must match, but got ${o} and ${s}.`),r.rank===1&&n.rank===1){let i=M(r,[1,-1]),a=M(n,[-1,1]),l=nt(i,a);return M(l,[])}else if(r.rank===1&&n.rank===2){let i=M(r,[1,-1]),a=M(n,[n.shape[0],n.shape[1]]),l=nt(i,a);return M(l,[l.size])}else if(r.rank===2&&n.rank===1){let i=M(n,[-1,1]),a=nt(r,i);return M(a,[a.size])}else{let i=M(n,[n.shape[0],n.shape[1]]);return nt(r,i)}}var lL=_({dot_:dee});function mee(t,...e){let r=e.map((o,s)=>I(o,`tensors${s}`,"einsum")),n={equation:t};return E.runKernel(Qd,r,n)}var Fx=_({einsum_:mee});function hee(t){let r={x:I(t,"x","elu","float32")};return E.runKernel($a,r)}var wl=_({elu_:hee});function gee(t){let e=I(t,"x","erf");A(e.dtype==="int32"||e.dtype==="float32",()=>"Input dtype must be `int32` or `float32`."),e.dtype==="int32"&&(e=oe(e,"float32"));let r={x:e};return E.runKernel(Ra,r)}var A2=_({erf_:gee});function D2(t,e){for(let r=0;r<t.length;++r)if(t[t.length-r-1]!==e-1-r)return!1;return!0}function uL(t,e,r){let n=t.length+e.length,o=[],s=0,i=0;for(let a=0;a<n;a++)r.indexOf(a)===-1?o.push(t[s++]):o.push(e[i++]);return o}function $2(t,e){let r=[],n=t.length;for(let s=0;s<n;s++)e.indexOf(s)===-1&&r.push(t[s]);let o=e.map(s=>t[s]);return[r,o]}function Gi(t,e){let r=e.map(n=>1);return uL(t,r,e)}function xee(t,e,r){A(D2(e,r),()=>`${t} supports only inner-most axes for now. Got axes ${e} and rank-${r} input.`)}function R2(t,e){if(D2(t,e))return null;let r=[];for(let n=0;n<e;++n)t.indexOf(n)===-1&&r.push(n);return t.forEach(n=>r.push(n)),r}function Px(t){return t.map((e,r)=>[r,e]).sort((e,r)=>e[1]-r[1]).map(e=>e[0])}function yee(t,e){let r=[];for(let n=e-t;n<e;++n)r.push(n);return r}function bee(t,e=null,r=!1){let o={x:I(t,"x","max")},s={reductionIndices:e,keepDims:r};return E.runKernel(zu,o,s)}var an=_({max_:bee});function vee(t,e=null,r=!1){let o={x:I(t,"x","min")},s={axis:e,keepDims:r};return E.runKernel(Gu,o,s)}var gc=_({min_:vee});function wee(t,e){let r=I(t,"base","pow"),n=I(e,"exp","pow");[r,n]=Xe(r,n);let o={a:r,b:n};return E.runKernel(Ka,o)}var ys=_({pow_:wee});function Fe(t,e){if((Co(t)&&e!=="string"||Array.isArray(t))&&e!=="complex64")throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if(e==="string"&&Co(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Mi(t,[],[],e)}function Cee(t){let r={x:I(t,"x","sqrt","float32")};return E.runKernel(il,r)}var Rt=_({sqrt_:Cee});function See(t){let e=I(t,"x","square"),r={};return E.runKernel("Square",{x:e},r)}var je=_({square_:See});function kee(t,e=null,r=!1){let n=I(t,"x","sum");n.dtype==="bool"&&(n=oe(n,"int32"));let o={x:n},s={axis:e,keepDims:r};return E.runKernel(oc,o,s)}var ye=_({sum_:kee});function Tee(t,e="euclidean",r=null,n=!1){t=I(t,"x","norm");let o=cL(t,e,r),s=o.shape;if(n){let i=Ar(r,t.shape);s=Gi(o.shape,i)}return M(o,s)}function cL(t,e,r=null){if(t.rank===0)return Sr(t);if(t.rank!==1&&r===null)return cL(M(t,[-1]),e,r);if(t.rank===1||typeof r=="number"||Array.isArray(r)&&r.length===1){if(e===1)return ye(Sr(t),r);if(e===1/0)return an(Sr(t),r);if(e===-1/0)return gc(Sr(t),r);if(e==="euclidean"||e===2)return Rt(ye(ys(Sr(t),Fe(2,"int32")),r));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(r)&&r.length===2){if(e===1)return an(ye(Sr(t),r[0]),r[1]-1);if(e===1/0)return an(ye(Sr(t),r[1]),r[0]);if(e===-1/0)return gc(ye(Sr(t),r[1]),r[0]);if(e==="fro"||e==="euclidean")return Rt(ye(je(t),r));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${r}`)}var xc=_({norm_:Tee});function Nee(t,e=null,r=!1){return xc(t,"euclidean",e,r)}var pL=_({euclideanNorm_:Nee});function Iee(t){let r={x:I(t,"x","exp")};return E.runKernel(Oa,r)}var xn=_({exp_:Iee});function Eee(t,e=0){let r=I(t,"x","expandDims","string_or_numeric");A(e<=r.rank,()=>"Axis must be <= rank of the tensor");let n={input:r},o={dim:e};return E.runKernel(Ou,n,o)}var Dr=_({expandDims_:Eee});function _ee(t){let r={x:I(t,"x","expm1")};return E.runKernel(Fa,r)}var F2=_({expm1_:_ee});function Aee(t,e){let r=I(t,"x","tile","string_or_numeric");A(r.rank===e.length,()=>`Error in transpose: rank of input ${r.rank} must match length of reps ${e}.`);let n={x:r},o={reps:e};return E.runKernel(Fi,n,o)}var yn=_({tile_:Aee});function Dee(t,e,r,n="float32"){e==null&&(e=t);let o=Ee([t,e],n),s=t<=e?t:e;for(let a=0;a<s;++a)o.set(1,a,a);let i=M(o.toTensor(),[t,e]);if(r==null)return i;if(r.length===1)return yn(Dr(i,0),[r[0],1,1]);if(r.length===2)return yn(Dr(Dr(i,0),0),[r[0],r[1],1,1]);if(r.length===3)return yn(Dr(Dr(Dr(i,0),0),0),[r[0],r[1],r[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${r.length}D.`)}var Lm=_({eye_:Dee});function $ee(t){let r={x:I(t,"x","floor","float32")};return E.runKernel(Pa,r)}var Cl=_({floor_:$ee});function Ree(t,e,r=0,n=0){let o=I(t,"x","gather"),s=I(e,"indices","gather","int32"),i={x:o,indices:s},a={axis:r,batchDims:n};return E.runKernel(Pu,i,a)}var Zp=_({gather_:Ree});function Oee(t,e){let r=I(t,"a","greater","string_or_numeric"),n=I(e,"b","greater","string_or_numeric");[r,n]=Xe(r,n),Be(r.shape,n.shape);let o={a:r,b:n};return E.runKernel(_p,o)}var er=_({greater_:Oee});function Fee(t,e){let r=I(t,"a","greaterEqual","string_or_numeric"),n=I(e,"b","greaterEqual","string_or_numeric");[r,n]=Xe(r,n),Be(r.shape,n.shape);let o={a:r,b:n};return E.runKernel(Ma,o)}var io=_({greaterEqual_:Fee});function Pee(t){let r={x:I(t,"x","isFinite")};return E.runKernel(za,r)}var P2=_({isFinite_:Pee});function Lee(t){let r={x:I(t,"x","isInf")};return E.runKernel(Ba,r)}var L2=_({isInf_:Lee});function Mee(t){let r={x:I(t,"x","isNaN")};return E.runKernel(Va,r)}var M2=_({isNaN_:Mee});function zee(t,e=.2){let n={x:I(t,"x","leakyRelu")},o={alpha:e};return E.runKernel(Lu,n,o)}var Jp=_({leakyRelu_:zee});function Bee(t,e){let r=I(t,"a","less","string_or_numeric"),n=I(e,"b","less","string_or_numeric");[r,n]=Xe(r,n),Be(r.shape,n.shape);let o={a:r,b:n};return E.runKernel(Ap,o)}var T1=_({less_:Bee});function Vee(t,e){let r=I(t,"a","lessEqual","string_or_numeric"),n=I(e,"b","lessEqual","string_or_numeric");[r,n]=Xe(r,n),Be(r.shape,n.shape);let o={a:r,b:n};return E.runKernel(Dp,o)}var bs=_({lessEqual_:Vee});function Wee(t,e=5,r=1,n=1,o=.5){let s=I(t,"x","localResponseNormalization");A(s.rank===4||s.rank===3,()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got
               rank ${s.rank}.`),A(ba(e),()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`);let i=s,a=!1;s.rank===3&&(a=!0,i=M(s,[1,s.shape[0],s.shape[1],s.shape[2]]));let l={x:i},u={depthRadius:e,bias:r,alpha:n,beta:o},c=E.runKernel(Mu,l,u);return a?M(c,[c.shape[1],c.shape[2],c.shape[3]]):c}var fL=_({localResponseNormalization_:Wee});function Gee(t){let r={x:I(t,"x","log","float32")};return E.runKernel(Wa,r)}var qn=_({log_:Gee});function Uee(t){let r={x:I(t,"x","log1p")};return E.runKernel(Ga,r)}var Lx=_({log1p_:Uee});function z2(t,e){A($d(t),()=>"The f passed in variableGrads(f) must be a function"),A(e==null||Array.isArray(e)&&e.every(u=>u instanceof fl),()=>"The varList passed in variableGrads(f, varList) must be an array of variables");let r=e!=null;if(!r){e=[];for(let u in E.registeredVariables)e.push(E.registeredVariables[u])}let n=r?e.filter(u=>!u.trainable):null,o=e.length;e=e.filter(u=>u.trainable),A(e.length>0,()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${o} variables is trainable.`);let s=!0,{value:i,grads:a}=E.gradients(t,e,null,s);A(a.some(u=>u!=null),()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."),A(i.rank===0,()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${i.rank} tensor`);let l={};return e.forEach((u,c)=>{a[c]!=null&&(l[u.name]=a[c])}),n?.forEach(u=>l[u.name]=null),{value:i,grads:l}}function Yo(t){return E.customGrad(t)}function Hee(t){let r={x:I(t,"x","softplus")};return E.runKernel(sl,r)}var Ui=_({softplus_:Hee});function qee(t){let e=I(t,"x","logSigmoid");return Yo(n=>({value:ot(Ui(ot(n))),gradFunc:i=>L(i,xs(ot(n)))}))(e)}var B2=_({logSigmoid_:qee});function jee(t,e){let r=I(t,"a","sub"),n=I(e,"b","sub");[r,n]=Xe(r,n);let o={a:r,b:n};return E.runKernel(ll,o)}var Ce=_({sub_:jee});function Kee(t,e=-1){let r=I(t,"logits","logSoftmax");if(e===-1&&(e=r.rank-1),e!==r.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${r.rank} and axis was ${e}`);return Yo((o,s)=>{let a=an(o,e,!0),l=Ce(o,a),u=Ce(oe(l,"float32"),qn(ye(xn(l),e,!0)));return s([u]),{value:u,gradFunc:(p,f)=>{let[d]=f,m=!0,h=xn(d);return Ce(p,L(ye(p,e,m),h))}}})(r)}var Mx=_({logSoftmax_:Kee});function Xee(t,e=null,r=!1){let n=I(t,"x","logSumExp"),o=Ar(e,n.shape),s=an(n,o,!0),i=Ce(n,s),a=xn(i),l=ye(a,o),u=qn(l),c=te(M(s,u.shape),u);if(r){let p=Gi(c.shape,o);return M(c,p)}return c}var dL=_({logSumExp_:Xee});function Yee(t,e){let r=I(t,"a","logicalAnd","bool"),n=I(e,"b","logicalAnd","bool");Be(r.shape,n.shape);let o={a:r,b:n};return E.runKernel($p,o)}var An=_({logicalAnd_:Yee});function Qee(t){let r={x:I(t,"x","logicalNot","bool")};return E.runKernel(Rp,r)}var Mm=_({logicalNot_:Qee});function Zee(t,e){let r=I(t,"a","logicalOr","bool"),n=I(e,"b","logicalOr","bool");Be(r.shape,n.shape);let o={a:r,b:n};return E.runKernel(Op,o)}var N1=_({logicalOr_:Zee});function Jee(t,e){let r=I(t,"a","logicalXor","bool"),n=I(e,"b","logicalXor","bool");return Be(r.shape,n.shape),An(N1(t,e),Mm(An(t,e)))}var mL=_({logicalXor_:Jee});function ete(t,e,r,n,o){let s=I(t,"x","maxPool"),i=1,a=s,l=!1;s.rank===3&&(l=!0,a=M(s,[1,s.shape[0],s.shape[1],s.shape[2]])),A(a.rank===4,()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`),A(on(r,i),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${r} and dilations '${i}'`),It("maxPool",n,o);let u={x:a},c={filterSize:e,strides:r,pad:n,dimRoundingMode:o},p=E.runKernel(Bu,u,c);return l?M(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var ef=_({maxPool_:ete});function tte(t,e=[1,1,1],r,n,o,s="NDHWC"){let i=I(t,"x","maxPool3d"),a=i,l=!1;i.rank===4&&(l=!0,a=M(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]])),A(a.rank===5,()=>`Error in maxPool3d: x must be rank 5 but got rank ${a.rank}.`),A(s==="NDHWC",()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${s}`),It("maxPool3d",n,o);let u={x:a},c={filterSize:e,strides:r,pad:n,dimRoundingMode:o,dataFormat:s},p=E.runKernel(Vu,u,c);return l?M(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}var V2=_({maxPool3d_:tte});function rte(t,e){let r=I(t,"a","maximum"),n=I(e,"b","maximum");[r,n]=Xe(r,n),r.dtype==="bool"&&(r=oe(r,"int32"),n=oe(n,"int32")),Be(r.shape,n.shape);let o={a:r,b:n};return E.runKernel(Ua,o)}var Eo=_({maximum_:rte});function nte(t,e=null,r=!1){let o={x:I(t,"x","mean")},s={axis:e,keepDims:r};return E.runKernel(Wu,o,s)}var Vt=_({mean_:nte});function Ot(t,e="float32"){if(tn(t),e==="complex64"){let n=Ot(t,"float32"),o=Ot(t,"float32");return jo(n,o)}let r=Od(lt(t),e);return E.makeTensor(r,t,e)}function _o(t,e="float32"){if(tn(t),e==="complex64"){let n=_o(t,"float32"),o=Ot(t,"float32");return jo(n,o)}let r=px(lt(t),e);return E.makeTensor(r,t,e)}function ote(t,e){let r=I(t,"a","minimum"),n=I(e,"b","minimum");[r,n]=Xe(r,n),r.dtype==="bool"&&(r=oe(r,"int32"),n=oe(n,"int32")),Be(r.shape,n.shape);let o={a:r,b:n};return E.runKernel(Ha,o)}var tf=_({minimum_:ote});function ste(t,e,r){A(r==="reflect"||r==="symmetric",()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${r}.`);let n=I(t,"x","mirrorPad");if(n.rank===0)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");A(e.length===n.rank,()=>`Padding doesn't match input. Must be ${n.rank}. Got ${e.length}.`);let o=r==="reflect"?1:0;for(let a=0;a<n.rank;a++)A(e[a].length===2,()=>"Invalid number of paddings. Must be length of 2 each."),A(e[a][0]>=0&&e[a][0]<=n.shape[a]-o&&e[a][1]>=0&&e[a][1]<=n.shape[a]-o,()=>`Padding in dimension ${a} cannot be greater than or equal to ${n.shape[a]-o} or less than 0 for input of shape ${n.shape}`);let s={paddings:e,mode:r},i={x:n};return E.runKernel(Uu,i,s)}var hL=_({mirrorPad_:ste});function ite(t,e){let r=I(t,"a","mod"),n=I(e,"b","mod");[r,n]=Xe(r,n);let o={a:r,b:n};return E.runKernel(qa,o)}var gL=_({mod_:ite});function ate(t,e=null,r=!1){t=I(t,"x","moments");let n=Ar(e,t.shape),o=Vt(t,n,r),s=o.shape;r||(s=Gi(o.shape,n));let i=je(Ce(oe(t,"float32"),M(o,s))),a=Vt(i,n,r);return{mean:o,variance:a}}var zm=_({moments_:ate});function lte(t,e){let r=I(t,"a","notEqual","string_or_numeric"),n=I(e,"b","notEqual","string_or_numeric");[r,n]=Xe(r,n),Be(r.shape,n.shape);let o={a:r,b:n};return E.runKernel(Fp,o)}var yc=_({notEqual_:lte});function ute(t){let r={x:I(t,"x","onesLike")};return E.runKernel(qu,r)}var Hr=_({onesLike_:ute});function cte(t,e,r=0){let n=I(t,"x","pad");if(n.rank===0)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");let o={paddings:e,constantValue:r},s={x:n};return E.runKernel(Xu,s,o)}var rf=_({pad_:cte});function pte(t,e,r){let n=I(t,"x","spaceToBatchND");A(n.rank>=1+e.length,()=>`input rank ${n.rank} should be > than [blockShape] ${e.length}`),A(r.length===e.length,()=>`paddings.shape[0] ${r.length} must be equal to [blockShape] ${e.length}`),A(n.shape.reduce((i,a,l)=>l>0&&l<=e.length?i&&(a+r[l-1][0]+r[l-1][1])%e[l-1]===0:i,!0),()=>`input spatial dimensions ${n.shape.slice(1)} with paddings ${r.toString()} must be divisible by blockShapes ${e.toString()}`);let o={x:n},s={blockShape:e,paddings:r};return E.runKernel(sc,o,s)}var Bm=_({spaceToBatchND_:pte});function fte(t,e,r,n,o,s,i){o==null&&(o=[1,1]),s==null&&(s=1),n===0&&(n="valid");let a=I(t,"x","maxPool"),l=a,u=!1;a.rank===3&&(u=!0,l=M(a,[1,a.shape[0],a.shape[1],a.shape[2]])),A(on(s,o),()=>`Error in pool: Either strides or dilations must be 1. Got strides ${s} and dilations '${o}'`);let c=x2(l.shape,e,s,o,n),p=[c.dilationHeight,c.dilationWidth],f;n==="same"?f=mte([c.filterHeight,c.filterWidth],p):f=[[0,0],[0,0]];let d=p[0]===1&&p[1]===1,[m,h]=dte([c.inHeight,c.inWidth],p,f),g=d?n:"valid",x=d?l:Bm(l,p,m),b=(r==="avg"?()=>Yp(x,e,s,g,i):()=>ef(x,e,s,g,i))(),v=d?b:Fm(b,p,h);return u?M(v,[v.shape[1],v.shape[2],v.shape[3]]):v}function dte(t,e,r){let n=r.map(c=>c[0]),o=r.map(c=>c[1]),s=t.concat(n,o),i=e.map((c,p)=>(c-s[p]%c)%c),a=o.map((c,p)=>c+i[p]),l=e.map((c,p)=>[n[p],a[p]]),u=e.map((c,p)=>[0,i[p]]);return[l,u]}function mte(t,e){let n=t.map((i,a)=>i+(i-1)*(e[a]-1)).map(i=>i-1),o=n.map(i=>Math.floor(i/2)),s=n.map((i,a)=>i-o[a]);return n.map((i,a)=>[o[a],s[a]])}var xL=_({pool_:fte});function hte(t,e){let r=I(t,"x","prelu"),n=I(e,"alpha","prelu"),o={x:r,alpha:n};return E.runKernel(Yu,o)}var nf=_({prelu_:hte});function gte(t,e=null,r=!1){let n=I(t,"x","prod");n.dtype==="bool"&&(n=oe(n,"int32"));let o={x:n},s={axis:e,keepDims:r};return E.runKernel(Qu,o,s)}var yL=_({prod_:gte});var K2=rt(zx());var Vm=class{constructor(e,r,n,o,s){this.mean=e,this.stdDev=r,this.dtype=n,this.nextVal=NaN,this.truncated=o,this.truncated&&(this.upper=this.mean+this.stdDev*2,this.lower=this.mean-this.stdDev*2);let i=s||Math.random();this.random=K2.alea(i.toString())}nextValue(){if(!isNaN(this.nextVal)){let o=this.nextVal;return this.nextVal=NaN,o}let e,r,n=!1;for(;!n;){let o,s,i;do o=2*this.random()-1,s=2*this.random()-1,i=o*o+s*s;while(i>=1||i===0);let a=Math.sqrt(-2*Math.log(i)/i);e=this.mean+this.stdDev*o*a,r=this.mean+this.stdDev*s*a,(!this.truncated||this.isValidTruncated(e))&&(n=!0)}return(!this.truncated||this.isValidTruncated(r))&&(this.nextVal=this.convertValue(r)),this.convertValue(e)}convertValue(e){return this.dtype==null||this.dtype==="float32"?e:Math.round(e)}isValidTruncated(e){return e<=this.upper&&e>=this.lower}};var E1=class{constructor(e=0,r=1,n,o){if(this.canReturnFloat=()=>this.dtype==null||this.dtype==="float32",this.min=e,this.range=r-e,this.dtype=n,o==null&&(o=Math.random()),typeof o=="number"&&(o=o.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${e} - ${r} <= 1 and dtype is not float`);this.random=K2.alea(o)}convertValue(e){return this.canReturnFloat()?e:Math.round(e)}nextValue(){return this.convertValue(this.min+this.range*this.random())}};function Ste(t,e=0,r=1,n,o){if(tn(t),n!=null&&n==="bool")throw new Error(`Unsupported data type ${n}`);let s=new Vm(e,r,n,!1,o),i=Ee(t,n);for(let a=0;a<i.values.length;a++)i.values[a]=s.nextValue();return i.toTensor()}var _1=_({randomNormal_:Ste});function kte(t,e=0,r=1,n="float32",o){tn(t);let s=Ee(t,n),i=new E1(e,r,null,o);for(let a=0;a<s.values.length;a++)s.values[a]=i.nextValue();return s.toTensor()}var Sl=_({randomUniform_:kte});function kl(t,e,r=1,n="float32"){if(r===0)throw new Error("Cannot have a step of zero");let o={start:t,stop:e,step:r,dtype:n};return E.runKernel(cm,{},o)}function Tte(t){let r={x:I(t,"x","reciprocal")};return E.runKernel(Xa,r)}var X2=_({reciprocal_:Tte});function Nte(t){let r={x:I(t,"x","relu")};return E.runKernel(Ya,r)}var Ao=_({relu_:Nte});function Ite(t){let r={x:I(t,"x","relu6")};return E.runKernel(Qa,r)}var A1=_({relu6_:Ite});function Ete(t,e){let n={x:I(t,"x","reverse")},o={dims:e};return E.runKernel(tc,n,o)}var Qo=_({reverse_:Ete});function _te(t){let r={x:I(t,"x","round")};return E.runKernel(Za,r)}var Bx=_({round_:_te});function Ate(t){let r={x:I(t,"x","rsqrt","float32")};return E.runKernel(Ja,r)}var Vx=_({rsqrt_:Ate});function Dte(t){let r={x:I(t,"x","selu")};return E.runKernel(el,r)}var Wx=_({selu_:Dte});function $te(t,e,r,n,o,s=[1,1],i="NHWC"){let a=I(t,"x","separableConv2d"),l=I(e,"depthwiseFilter","separableConv2d"),u=I(r,"pointwiseFilter","separableConv2d"),c=a,p=!1;if(a.rank===3&&(p=!0,c=M(a,[1,a.shape[0],a.shape[1],a.shape[2]])),i==="NCHW")throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");A(c.rank===4,()=>`Error in separableConv2d: input must be rank 4, but got rank ${c.rank}.`),A(l.rank===4,()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${l.rank}.`),A(u.rank===4,()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${l.rank}.`),A(u.shape[0]===1,()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${u.shape[0]}.`),A(u.shape[1]===1,()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${u.shape[1]}.`);let f=l.shape[2],d=l.shape[3];A(u.shape[2]===f*d,()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${f*d}, but got ${u.shape[2]}.`);let m=vl(c,l,n,o,i,s),g=Io(m,u,1,"valid",i);return p?M(g,[g.shape[1],g.shape[2],g.shape[3]]):g}var Gx=_({separableConv2d_:$te});function Rte(t){let r={x:I(t,"x","sign")};return E.runKernel(nl,r)}var Y2=_({sign_:Rte});function Ote(t){let r={x:I(t,"x","sin","float32")};return E.runKernel(tl,r)}var Ux=_({sin_:Ote});function Fte(t){let r={x:I(t,"x","sinh")};return E.runKernel(rl,r)}var Hx=_({sinh_:Fte});function Pte(t,e,r){let n=I(t,"x","slice1d");return A(n.rank===1,()=>`slice1d expects a rank-1 tensor, but got a rank-${n.rank} tensor`),et(n,[e],[r])}var qx=_({slice1d_:Pte});function Lte(t,e,r){let n=I(t,"x","slice2d");return A(n.rank===2,()=>`slice2d expects a rank-2 tensor, but got a rank-${n.rank} tensor`),et(n,e,r)}var D1=_({slice2d_:Lte});function Mte(t,e,r){let n=I(t,"x","slice3d");return A(n.rank===3,()=>`slice3d expects a rank-3 tensor, but got a rank-${n.rank} tensor`),et(n,e,r)}var jx=_({slice3d_:Mte});function zte(t,e,r){let n=I(t,"x","slice4d");return A(n.rank===4,()=>`slice4d expects a rank-4 tensor, but got a rank-${n.rank} tensor`),et(n,e,r)}var Wm=_({slice4d_:zte});function Bte(t,e=-1){let r=I(t,"logits","softmax","float32");if(e===-1&&(e=r.rank-1),e!==r.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${r.rank} and dim was ${e}`);let n={logits:r},o={dim:e};return E.runKernel(ac,n,o)}var sf=_({softmax_:Bte});function Vte(t){A(t.dtype==="complex64",()=>`The dtype for tf.spectral.fft() must be complex64 but got ${t.dtype}.`);let e={input:t};return E.runKernel(Jd,e)}var Kx=_({fft_:Vte});function Wte(t){A(t.dtype==="complex64",()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${t.dtype}.`);let e={input:t};return E.runKernel(rm,e)}var Gm=_({ifft_:Wte});function Gte(t){let e=t.shape[t.shape.length-1],r=t.size/e,n;if(e<=2){let o=M(t,[r,e]);n=Gm(o)}else{let o=[r,2*(e-1)],s=M(qp(t),[r,e]),i=M(Dm(t),[r,e]),a=Qo(et(s,[0,1],[r,e-2]),1),l=L(Qo(et(i,[0,1],[r,e-2]),1),Fe(-1)),u=$t([s,a],1),c=$t([i,l],1),p=M(jo(u,c),[o[0],o[1]]);n=Gm(p)}if(n=qp(n),t.rank===3&&t.shape[0]!==0){let o=n,s=t.shape[0];n=M(n,[s,n.shape[0]/s,n.shape[1]]),o.dispose()}return n}var Q2=_({irfft_:Gte});function Ute(t,e,r=0){let o={x:I(t,"x","split")},s={numOrSizeSplits:e,axis:r};return E.runKernel(ic,o,s)}var Pr=_({split_:Ute});function Hte(t,e){A(t.dtype==="float32",()=>`The dtype for rfft() must be real value but got ${t.dtype}`);let r=t.shape[t.shape.length-1],n=t.size/r,o;if(e!=null&&e<r){let m=t.shape.map(g=>0),h=t.shape.map(g=>g);h[t.shape.length-1]=e,o=et(t,m,h),r=e}else if(e!=null&&e>r){let m=t.shape.map(h=>h);m[t.shape.length-1]=e-r,o=$t([t,Ot(m)],t.shape.length-1),r=e}else o=t;let s=_e(o),i=M(jo(o,s),[n,r]),a=Kx(i),l=Math.floor(r/2)+1,u=qp(a),c=Dm(a),p=Pr(u,[l,r-l],u.shape.length-1),f=Pr(c,[l,r-l],c.shape.length-1),d=o.shape.slice();return d[o.shape.length-1]=l,M(jo(p[0],f[0]),d)}var Z2=_({rfft_:Hte});function qte(t,e){let r=I(t,"a","squaredDifference"),n=I(e,"b","squaredDifference");[r,n]=Xe(r,n),Be(r.shape,n.shape);let o={a:r,b:n},s={};return E.runKernel(al,o,s)}var FL=_({squaredDifference_:qte});function jte(t,e){let r=I(t,"x","squeeze","string_or_numeric");return M(r,wI(r.shape,e).newShape)}var oi=_({squeeze_:jte});function Kte(t,e=0){let r=l1(t,"tensors","stack","string_or_numeric");A(r.length>=1,()=>"Pass at least one tensor to tf.stack"),r.length>0&&A(e<=r[0].rank,()=>"Axis must be <= rank of the tensor");let n=r,o={axis:e};return E.runKernel(Ku,n,o)}var Lr=_({stack_:Kte});function Xte(t,e=0){let n={x:I(t,"x","step")},o={alpha:e};return E.runKernel(pl,n,o)}var si=_({step_:Xte});function Yte(t,e,r,n,o=0,s=0,i=0,a=0,l=0){let c={x:I(t,"x","stridedSlice","string_or_numeric")},p={begin:e,end:r,strides:n,beginMask:o,endMask:s,ellipsisMask:i,newAxisMask:a,shrinkAxisMask:l};return E.runKernel(hm,c,p)}var J2=_({stridedSlice_:Yte});function Qte(t){let r={x:I(t,"x","tan","float32")};return E.runKernel(ul,r)}var eE=_({tan_:Qte});function $r(t,e){Np(t);let r=dl(t,e);if(r.length!==1)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Mi(t,null,r,e)}function Xx(t,e,r){if(Np(t),e!=null&&e.length!==2)throw new Error("tensor2d() requires shape to have two numbers");let n=dl(t,r);if(n.length!==2&&n.length!==1)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(n.length===1&&e==null)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Mi(t,e,n,r)}function Zte(t,e=1,r=!0){let n=I(t,"x","topk");if(n.rank===0)throw new Error("topk() expects the input to be of rank 1 or higher");let o=n.shape[n.shape.length-1];if(e<0)throw new Error(`'k' passed to topk() must be >= 0 but got ${e}`);if(e>o)throw new Error(`'k' passed to topk() must be <= the last dimension (${o}) but got ${e}`);let s={x:n},i={k:e,sorted:r},[a,l]=E.runKernel(gm,s,i);return{values:a,indices:l}}var PL=_({topk_:Zte});function Jte(t,e=0,r=1,n,o){if(tn(t),n!=null&&n==="bool")throw new Error("Unsupported data type $ { dtype }");let s=new Vm(e,r,n,!0,o),i=Ee(t,n);for(let a=0;a<i.values.length;a++)i.values[a]=s.nextValue();return i.toTensor()}var Yx=_({truncatedNormal_:Jte});function ere(t,e=0){let r=I(t,"x","unique","string_or_numeric");A(r.rank>0,()=>"The input tensor must be at least 1D");let n={x:r},o={axis:e},[s,i]=E.runKernel(ym,n,o);return{values:s,indices:i}}var LL=_({unique_:ere});function tre(t,e,r){let n=I(t,"x","unsortedSegmentSum"),o=I(e,"segmentIds","unsortedSegmentSum","int32");A(ba(r),()=>"numSegments must be of dtype int");let s={x:n,segmentIds:o},i={numSegments:r};return E.runKernel(uc,s,i)}var $1=_({unsortedSegmentSum_:tre});function rre(t,e=0){let r=I(t,"x","unstack","string_or_numeric");A(e>=-r.shape.length&&e<r.shape.length,()=>`Axis = ${e} is not in [-${r.shape.length}, ${r.shape.length})`);let n={value:r},o={axis:e};return E.runKernel(lc,n,o)}var Dn=_({unstack_:rre});function tE(t,e=!0,r,n){return E.makeVariable(t,e,r,n)}function ML(t,e){let r=[];for(let s=0;s<e.length;s++)e[s]&&r.push(s);let n=Ee(t,"int32"),o=Ee([r.length,t.length],"int32");for(let s=0;s<r.length;s++){let i=n.indexToLoc(r[s]),a=s*t.length;o.values.set(i,a)}return o.toTensor()}function zL(t,e){if(e==null)return t.shape.slice();if(yu(t.shape,e))return e;if(t.shape.length===e.length){let r=[];for(let n=0;n<t.shape.length;n++)e[n]==null&&t.shape[n]!=null?r.push(t.shape[n]):r.push(e[n]);return r}return e}function nre(t,e,r,n){let o=I(t,"x","dropout");if(A(o.dtype==="float32",()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${o.dtype} tensor instead.`),A(e>=0&&e<1,()=>`rate must be a float in the range [0, 1), but got ${e}.`),e===0)return t instanceof Ze?o.clone():o;let s=zL(o,r),i=1-e,a=xe(Cl(te(Sl(s,0,1,"float32",n),i)),i);return L(o,a)}var BL=_({dropout_:nre});var pf={};Ho(pf,{conv2d:()=>VL,depthwiseConv2d:()=>WL,matMul:()=>GL});function ore(t,e,r,n,o,s="NHWC",i){let a=t;t.rank===3&&(a=M(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=e;l.rank===3&&(l=M(e,[1,e.shape[0],e.shape[1],e.shape[2]])),A(a.rank===4,()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`),A(l.rank===4,()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${l.shape}.`),A(r.length===4,()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${r}.`);let u=s==="NHWC"?a.shape[3]:a.shape[1],c=s==="NHWC"?l.shape[3]:l.shape[1];A(u===r[2],()=>`Error in conv2dDerFilter: depth of input ${u}) must match input depth in filter (${r[2]}.`),A(c===r[3],()=>`Error in conv2dDerFilter: depth of dy (${c}) must match output depth for filter (${r[3]}).`),It("conv2dDerFilter",o,i);let p={x:a,dy:l},f={strides:n,pad:o,dataFormat:s,dimRoundingMode:i,filterShape:r};return E.runKernel(Wd,p,f)}var Um=_({conv2DBackpropFilter_:ore});function af(t,e,r){if(r==null||r==="linear")return t;if(r==="relu")return L(t,si(e));throw new Error(`Cannot compute gradient for fused activation ${r}.`)}function lf(t,e){let r=e,n=wt(t.shape,e.shape);return n.length>0&&(r=ye(r,n)),M(r,t.shape)}function uf(t,e,r,n){if(e==="linear")return t;if(e==="relu")return Ao(t);if(e==="elu")return wl(t);if(e==="relu6")return A1(t);if(e==="prelu")return nf(t,r);if(e==="leakyrelu")return Jp(t,n);if(e==="sigmoid")return xs(t);throw new Error(`Unknown fused activation ${e}.`)}var cf=(t,e)=>!(t>0)||e==="linear";function sre({x:t,filter:e,strides:r,pad:n,dataFormat:o="NHWC",dilations:s=[1,1],dimRoundingMode:i,bias:a,activation:l="linear",preluActivationWeights:u,leakyreluAlpha:c}){if(l=l||"linear",cf(E.state.gradientDepth,l)===!1){A(o==="NHWC",()=>`Error in fused conv2d: got dataFormat of ${o} but only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear.`);let S=Io(t,e,r,n,o,s,i);return a!=null&&(S=te(S,a)),uf(S,l,u,c)}let p=I(t,"x","conv2d","float32"),f=I(e,"filter","conv2d","float32"),d=p,m=!1;p.rank===3&&(m=!0,d=M(p,[1,p.shape[0],p.shape[1],p.shape[2]])),A(d.rank===4,()=>`Error in fused conv2d: input must be rank 4, but got rank ${d.rank}.`),A(f.rank===4,()=>`Error in fused conv2d: filter must be rank 4, but got rank ${f.rank}.`),It("fused conv2d",n,i);let h=o==="NHWC"?d.shape[3]:d.shape[1];A(f.shape[2]===h,()=>`Error in conv2d: depth of input (${h}) must match input depth for filter ${f.shape[2]}.`),A(on(r,s),()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${r} and dilations '${s}'`);let g=Xp(d.shape,f.shape,r,s,n,i),x;a!=null&&(x=I(a,"bias","fused conv2d"),[x]=Xe(x,p),o==="NHWC"?Be(g.outShape,x.shape):(A(x.shape.length<=1,()=>`Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of rank-${x.shape.length}.`),A(x.shape.length===0||x.shape[0]===g.outChannels||x.shape[0]===1,()=>`Error in fused conv2d: bias shape (${x.shape}) is not compatible with the number of output channels (${g.outChannels})`)));let y;if(u!=null){let S=u.shape;if(A(S.length<=1||S.length===3,()=>`Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of rank-${S.length}.`),S.length===1)A(S[0]===1||S[0]===g.outChannels,()=>`Error in fused conv2d: PReLU activation weights (${S}) is not compatible with the number of output channels (${g.outChannels}).`);else if(S.length===3)try{Be(S,g.outShape)}catch{let N=`Error in fused conv2d: PReLU activation weights (${S}) is not compatible with the output shape of the conv2d (${g.outShape}).`;throw Error(N)}y=I(u,"prelu weights","fused conv2d")}let b=(S,k)=>{A(o==="NHWC",()=>`Error in gradient of fused conv2D: got dataFormat of ${o} but only NHWC is currently supported.`);let[N,D,$,O]=k,V=af(S,$,l);A(Ko(s),()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`);let K=Pm(D.shape,V,N,r,n),X=Um(D,V,N.shape,r,n),W=[K,X];if(O!=null){let H=lf(O,V);W.push(H)}return W},v={x:d,filter:f,bias:x,preluActivationWeights:y},C={strides:r,pad:n,dataFormat:o,dilations:s,dimRoundingMode:i,activation:l,leakyreluAlpha:c};return a==null?Yo((k,N,D)=>{let $=E.runKernel(Lp,v,C);return D([N,k,$]),m&&($=M($,[$.shape[1],$.shape[2],$.shape[3]])),{value:$,gradFunc:b}})(d,f):Yo((k,N,D,$)=>{let O=E.runKernel(Lp,v,C);return $([N,k,O,D]),m&&(O=M(O,[O.shape[1],O.shape[2],O.shape[3]])),{value:O,gradFunc:b}})(d,f,x)}var VL=_({fusedConv2d_:sre});function ire(t,e,r,n,o,s=[1,1],i){let a=t;t.rank===3&&(a=M(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let l=e;l.rank===3&&(l=M(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let u={x:a,dy:l},c={strides:n,pad:o,dimRoundingMode:i,dilations:s,filterShape:r};return E.runKernel(Xd,u,c)}var R1=_({depthwiseConv2dNativeBackpropFilter_:ire});function are(t,e,r,n,o,s=[1,1],i){let a=e,l=!1;e.rank===3&&(l=!0,a=M(e,[1,e.shape[0],e.shape[1],e.shape[2]]));let u={dy:a,filter:r},c={strides:n,pad:o,dimRoundingMode:i,dilations:s,inputShape:t},p=E.runKernel(Yd,u,c);return l?M(p,[p.shape[1],p.shape[2],p.shape[3]]):p}var O1=_({depthwiseConv2dNativeBackpropInput_:are});function lre({x:t,filter:e,strides:r,pad:n,dataFormat:o="NHWC",dilations:s=[1,1],dimRoundingMode:i,bias:a,activation:l="linear",preluActivationWeights:u,leakyreluAlpha:c}){if(cf(E.state.gradientDepth,l)===!1){let C=vl(t,e,r,n,o,s,i);return a!=null&&(C=te(C,a)),uf(C,l,u,c)}let p=I(t,"x","depthwiseConv2d","float32"),f=I(e,"filter","depthwiseConv2d","float32"),d=p,m=!1;p.rank===3&&(m=!0,d=M(p,[1,p.shape[0],p.shape[1],p.shape[2]])),A(d.rank===4,()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${d.rank}.`),A(f.rank===4,()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${f.rank}.`),A(d.shape[3]===f.shape[2],()=>`Error in fused depthwiseConv2d: number of input channels (${d.shape[3]}) must match the inChannels dimension in filter ${f.shape[2]}.`),s==null&&(s=[1,1]),A(on(r,s),()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${r} and dilations '${s}'`),It("fused depthwiseConv2d",n,i);let h=Xp(d.shape,f.shape,r,s,n,i,!0),g;a!=null&&(g=I(a,"bias","fused conv2d"),[g]=Xe(g,p),Be(h.outShape,g.shape));let x;u!=null&&(x=I(u,"prelu weights","fused depthwiseConv2d"));let y=(C,S)=>{A(Ko(s),()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${s}'`);let[k,N,D,$]=S,O=af(C,D,l),V=O1(N.shape,O,k,r,n,s,i),K=R1(N,O,k.shape,r,n,s,i);if($!=null){let X=lf(g,O);return[V,K,X]}return[V,K]},b={x:d,filter:f,bias:g,preluActivationWeights:x},v={strides:r,pad:n,dataFormat:o,dilations:s,dimRoundingMode:i,activation:l,leakyreluAlpha:c};return a==null?Yo((S,k,N)=>{let D=E.runKernel(Mp,b,v);return N([k,S,D]),m&&(D=M(D,[D.shape[1],D.shape[2],D.shape[3]])),{value:D,gradFunc:y}})(d,f):Yo((S,k,N,D)=>{let $=E.runKernel(Mp,b,v);return D([k,S,$,N]),m&&($=M($,[$.shape[1],$.shape[2],$.shape[3]])),{value:$,gradFunc:y}})(d,f,g)}var WL=_({fusedDepthwiseConv2d_:lre});function ure({a:t,b:e,transposeA:r=!1,transposeB:n=!1,bias:o,activation:s="linear",preluActivationWeights:i,leakyreluAlpha:a=.2}){if(cf(E.state.gradientDepth,s)===!1){let O=nt(t,e,r,n);return o!=null&&(O=te(O,o)),uf(O,s,i,a)}let l=I(t,"a","fused matMul"),u=I(e,"b","fused matMul");[l,u]=Xe(l,u);let c=r?l.shape[l.rank-2]:l.shape[l.rank-1],p=n?u.shape[u.rank-1]:u.shape[u.rank-2],f=r?l.shape[l.rank-1]:l.shape[l.rank-2],d=n?u.shape[u.rank-2]:u.shape[u.rank-1],m=l.shape.slice(0,-2),h=u.shape.slice(0,-2),g=lt(m),x=lt(h);A(c===p,()=>`Error in fused matMul: inner shapes (${c}) and (${p}) of Tensors with shapes ${l.shape} and ${u.shape} and transposeA=${r} and transposeB=${n} must match.`);let b=Be(l.shape.slice(0,-2),u.shape.slice(0,-2)).concat([f,d]),v=r?M(l,[g,c,f]):M(l,[g,f,c]),C=n?M(u,[x,d,p]):M(u,[x,p,d]),S;o!=null&&(S=I(o,"bias","fused matMul"),[S]=Xe(S,l),Be(b,S.shape));let k;i!=null&&(k=I(i,"prelu weights","fused matMul"));let N=(O,V)=>{let[K,X,W,H]=V,Y=af(M(O,W.shape),W,s),Z,Q;if(!r&&!n?(Z=nt(Y,X,!1,!0),Q=nt(K,Y,!0,!1)):!r&&n?(Z=nt(Y,X,!1,!1),Q=nt(Y,K,!0,!1)):r&&!n?(Z=nt(X,Y,!1,!0),Q=nt(K,Y,!1,!1)):(Z=nt(X,Y,!0,!0),Q=nt(Y,K,!0,!0)),o!=null){let se=lf(H,Y);return[Z,Q,se]}else return[Z,Q]},D={a:v,b:C,bias:S,preluActivationWeights:k},$={transposeA:r,transposeB:n,activation:s,leakyreluAlpha:a};return o==null?Yo((V,K,X)=>{let W=E.runKernel(Pp,D,$);return X([V,K,W]),{value:M(W,b),gradFunc:N}})(v,C):Yo((V,K,X,W)=>{let H=E.runKernel(Pp,D,$);return W([V,K,H,X]),{value:M(H,b),gradFunc:N}})(v,C,S)}var GL=_({fusedMatMul_:ure});function cre(t,e,r,n,o="bilinear",s=0){let i=I(t,"image","cropAndResize"),a=I(e,"boxes","cropAndResize","float32"),l=I(r,"boxInd","cropAndResize","int32"),u=a.shape[0];A(i.rank===4,()=>`Error in cropAndResize: image must be rank 4,but got rank ${i.rank}.`),A(a.rank===2&&a.shape[1]===4,()=>`Error in cropAndResize: boxes must be have size [${u},4] but had shape ${a.shape}.`),A(l.rank===1&&l.shape[0]===u,()=>`Error in cropAndResize: boxInd must be have size [${u}] but had shape ${a.shape}.`),A(n.length===2,()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${n.length}.`),A(n[0]>=1&&n[1]>=1,()=>`cropSize must be atleast [1,1], but was ${n}`),A(o==="bilinear"||o==="nearest",()=>`method must be bilinear or nearest, but was ${o}`);let c={image:i,boxes:a,boxInd:l},p={method:o,extrapolationValue:s,cropSize:n};return E.runKernel(qd,c,p)}var UL=_({cropAndResize_:cre});function pre(t){let e=I(t,"image","flipLeftRight","float32");A(e.rank===4,()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`);let r={image:e};return E.runKernel(tm,r,{})}var HL=_({flipLeftRight_:pre});function fre(t){let e=I(t,"image","grayscaleToRGB"),r=e.rank-1,n=e.shape[r];A(e.rank>=2,()=>`Error in grayscaleToRGB: images must be at least rank 2, but got rank ${e.rank}.`),A(n===1,()=>`Error in grayscaleToRGB: last dimension of a grayscale image should be size 1, but got size ${n}.`);let o=new Array(e.rank);return o.fill(1,0,r),o[r]=3,yn(e,o)}var qL=_({grayscaleToRGB_:fre});function dre(t,e,r=0,n=.5){let o=I(t,"image","rotateWithOffset","float32");A(o.rank===4,()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${o.rank}.`);let s={image:o},i={radians:e,fillValue:r,center:n};return E.runKernel(bm,s,i)}var jL=_({rotateWithOffset_:dre});function vs(t,e,r,n,o,s){n==null&&(n=.5),o==null&&(o=Number.NEGATIVE_INFINITY),s==null&&(s=0);let i=t.shape[0];return r=Math.min(r,i),A(0<=n&&n<=1,()=>`iouThreshold must be in [0, 1], but was '${n}'`),A(t.rank===2,()=>`boxes must be a 2D tensor, but was of rank '${t.rank}'`),A(t.shape[1]===4,()=>`boxes must have 4 columns, but 2nd dimension was ${t.shape[1]}`),A(e.rank===1,()=>"scores must be a 1D tensor"),A(e.shape[0]===i,()=>`scores has incompatible shape with boxes. Expected ${i}, but was ${e.shape[0]}`),A(0<=s&&s<=1,()=>`softNmsSigma must be in [0, 1], but was '${s}'`),{maxOutputSize:r,iouThreshold:n,scoreThreshold:o,softNmsSigma:s}}function mre(t,e,r,n=.5,o=Number.NEGATIVE_INFINITY){let s=I(t,"boxes","nonMaxSuppression","float32"),i=I(e,"scores","nonMaxSuppression","float32"),a=vs(s,i,r,n,o);r=a.maxOutputSize,n=a.iouThreshold,o=a.scoreThreshold;let l={maxOutputSize:r,iouThreshold:n,scoreThreshold:o};return E.runKernel(am,{boxes:s,scores:i},l)}var KL=_({nonMaxSuppression_:mre});function XL(t,e,r){let n=hre(t,e,r),o=n<0?-(n+1):n;t.splice(o,0,e)}function hre(t,e,r){return xre(t,e,r||gre)}function gre(t,e){return t>e?1:t<e?-1:0}function xre(t,e,r){let n=0,o=t.length,s=0,i=!1;for(;n<o;){s=n+(o-n>>>1);let a=r(e,t[s]);a>0?n=s+1:(o=s,i=!a)}return i?n:-n-1}function F1(t,e,r,n,o){return rE(t,e,r,n,o,0)}function P1(t,e,r,n,o,s){return rE(t,e,r,n,o,0,!1,s,!0)}function L1(t,e,r,n,o,s){return rE(t,e,r,n,o,s,!0)}function rE(t,e,r,n,o,s,i=!1,a=!1,l=!1){let u=[];for(let g=0;g<e.length;g++)e[g]>o&&u.push({score:e[g],boxIndex:g,suppressBeginIndex:0});u.sort(YL);let c=s>0?-.5/s:0,p=[],f=[];for(;p.length<r&&u.length>0;){let g=u.pop(),{score:x,boxIndex:y,suppressBeginIndex:b}=g;if(x<o)break;let v=!1;for(let C=p.length-1;C>=b;--C){let S=yre(t,y,p[C]);if(S>=n){v=!0;break}if(g.score=g.score*bre(n,c,S),g.score<=o)break}g.suppressBeginIndex=p.length,v||(g.score===x?(p.push(y),f.push(g.score)):g.score>o&&XL(u,g,YL))}let d=p.length,m=r-d;a&&m>0&&(p.push(...new Array(m).fill(0)),f.push(...new Array(m).fill(0)));let h={selectedIndices:p};return i&&(h.selectedScores=f),l&&(h.validOutputs=d),h}function yre(t,e,r){let n=t.subarray(e*4,e*4+4),o=t.subarray(r*4,r*4+4),s=Math.min(n[0],n[2]),i=Math.min(n[1],n[3]),a=Math.max(n[0],n[2]),l=Math.max(n[1],n[3]),u=Math.min(o[0],o[2]),c=Math.min(o[1],o[3]),p=Math.max(o[0],o[2]),f=Math.max(o[1],o[3]),d=(a-s)*(l-i),m=(p-u)*(f-c);if(d<=0||m<=0)return 0;let h=Math.max(s,u),g=Math.max(i,c),x=Math.min(a,p),y=Math.min(l,f),b=Math.max(x-h,0)*Math.max(y-g,0);return b/(d+m-b)}function bre(t,e,r){let n=Math.exp(e*r*r);return r<=t?n:0}function YL(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}async function vre(t,e,r,n=.5,o=Number.NEGATIVE_INFINITY){let s=I(t,"boxes","nonMaxSuppressionAsync"),i=I(e,"scores","nonMaxSuppressionAsync"),a=vs(s,i,r,n,o);r=a.maxOutputSize,n=a.iouThreshold,o=a.scoreThreshold;let l=await Promise.all([s.data(),i.data()]),u=l[0],c=l[1],{selectedIndices:p}=F1(u,c,r,n,o);return s!==t&&s.dispose(),i!==e&&i.dispose(),$r(p,"int32")}var QL=vre;function wre(t,e,r,n=.5,o=Number.NEGATIVE_INFINITY,s=0){let i=I(t,"boxes","nonMaxSuppression"),a=I(e,"scores","nonMaxSuppression"),l=vs(i,a,r,n,o,s);r=l.maxOutputSize,n=l.iouThreshold,o=l.scoreThreshold,s=l.softNmsSigma;let u={boxes:i,scores:a},c={maxOutputSize:r,iouThreshold:n,scoreThreshold:o,softNmsSigma:s},p=E.runKernel(um,u,c);return{selectedIndices:p[0],selectedScores:p[1]}}var ZL=_({nonMaxSuppressionWithScore_:wre});async function Cre(t,e,r,n=.5,o=Number.NEGATIVE_INFINITY,s=0){let i=I(t,"boxes","nonMaxSuppressionAsync"),a=I(e,"scores","nonMaxSuppressionAsync"),l=vs(i,a,r,n,o,s);r=l.maxOutputSize,n=l.iouThreshold,o=l.scoreThreshold,s=l.softNmsSigma;let u=await Promise.all([i.data(),a.data()]),c=u[0],p=u[1],{selectedIndices:f,selectedScores:d}=L1(c,p,r,n,o,s);return i!==t&&i.dispose(),a!==e&&a.dispose(),{selectedIndices:$r(f,"int32"),selectedScores:$r(d)}}var JL=Cre;function Sre(t,e,r,n=.5,o=Number.NEGATIVE_INFINITY,s=!1){let i=I(t,"boxes","nonMaxSuppression"),a=I(e,"scores","nonMaxSuppression"),l=vs(i,a,r,n,o,null),u=l.maxOutputSize,c=l.iouThreshold,p=l.scoreThreshold,f={boxes:i,scores:a},d={maxOutputSize:u,iouThreshold:c,scoreThreshold:p,padToMaxOutputSize:s},m=E.runKernel(lm,f,d);return{selectedIndices:m[0],validOutputs:m[1]}}var eM=_({nonMaxSuppressionPadded_:Sre});async function kre(t,e,r,n=.5,o=Number.NEGATIVE_INFINITY,s=!1){let i=I(t,"boxes","nonMaxSuppressionAsync"),a=I(e,"scores","nonMaxSuppressionAsync"),l=vs(i,a,r,n,o,null),u=l.maxOutputSize,c=l.iouThreshold,p=l.scoreThreshold,[f,d]=await Promise.all([i.data(),a.data()]),{selectedIndices:m,validOutputs:h}=P1(f,d,u,c,p,s);return i!==t&&i.dispose(),a!==e&&a.dispose(),{selectedIndices:$r(m,"int32"),validOutputs:Fe(h,"int32")}}var tM=kre;function Tre(t,e,r=!1,n=!1){let o=I(t,"images","resizeBilinear");A(o.rank===3||o.rank===4,()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${o.rank}.`),A(e.length===2,()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`),A(n===!1||r===!1,()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false.");let s=o,i=!1;o.rank===3&&(i=!0,s=M(o,[1,o.shape[0],o.shape[1],o.shape[2]]));let[]=e,a={images:s},l={alignCorners:r,halfPixelCenters:n,size:e},u=E.runKernel(ec,a,l);return i?M(u,[u.shape[1],u.shape[2],u.shape[3]]):u}var M1=_({resizeBilinear_:Tre});function Nre(t,e,r=!1,n=!1){let o=I(t,"images","resizeNearestNeighbor");A(o.rank===3||o.rank===4,()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${o.rank}.`),A(e.length===2,()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`),A(o.dtype==="float32"||o.dtype==="int32",()=>"`images` must have `int32` or `float32` as dtype"),A(n===!1||r===!1,()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false.");let s=o,i=!1;o.rank===3&&(i=!0,s=M(o,[1,o.shape[0],o.shape[1],o.shape[2]]));let[]=e,a={images:s},l={alignCorners:r,halfPixelCenters:n,size:e},u=E.runKernel(Ju,a,l);return i?M(u,[u.shape[1],u.shape[2],u.shape[3]]):u}var z1=_({resizeNearestNeighbor_:Nre});function Ire(t,e="binary",r=!1,n=.5){let o=I(t,"image","threshold"),s=.2989,i=.587,a=.114,l=o.shape[0]*o.shape[1],u=L($r([n]),255),c,p,f,d;if(A(o.rank===3,()=>`Error in threshold: image must be rank 3,but got rank ${o.rank}.`),A(o.shape[2]===3||o.shape[2]===1,()=>`Error in threshold: image color channel must be equal to 3 or 1but got ${o.shape[2]}.`),A(o.dtype==="int32"||o.dtype==="float32",()=>`Error in dtype: image dtype must be int32 or float32,but got dtype ${o.dtype}.`),A(e==="otsu"||e==="binary",()=>`Method must be binary or otsu, but was ${e}`),o.shape[2]===3){[c,p,f]=Pr(o,[1,1,1],-1);let g=L(c,s),x=L(p,i),y=L(f,a);d=te(te(g,x),y)}else d=t;if(e==="otsu"){let g=oL(oe(Bx(d),"int32"),Cr([]),256);u=Ere(g,l)}let m=r?bs(d,u):er(d,u);return oe(L(m,255),"int32")}function Ere(t,e){let r=$r([-1]),n=$r([0]),o=$r([0]),s,i,a,l,u,c;for(let p=0;p<t.size-1;p++){s=et(t,0,p+1),i=et(t,p+1),u=xe(ye(s),e),c=xe(ye(i),e);let f=ye(L(s,kl(0,s.size)));a=xe(f,ye(s));let d=bl(i.shape,s.size),m=te(kl(0,i.size),d),h=L(i,m);l=xe(ye(h),ye(i));let g=Ce(a,l),x=Ce(a,l),y=L(u,c);o=L(L(y,g),x);let b=er(o,n);n=Bt(b,o,n),r=Bt(b,$r([p]),r)}return r}var rM=_({threshold_:Ire});function _re(t,e,r="nearest",n="constant",o=0,s){let i=I(t,"image","transform","float32"),a=I(e,"transforms","transform","float32");A(i.rank===4,()=>`Error in transform: image must be rank 4,but got rank ${i.rank}.`),A(a.rank===2&&(a.shape[0]===i.shape[0]||a.shape[0]===1)&&a.shape[1]===8,()=>"Error in transform: Input transform should be batch x 8 or 1 x 8"),A(s==null||s.length===2,()=>`Error in transform: outputShape must be [height, width] or null, but got ${s}.`);let l={image:i,transforms:a},u={interpolation:r,fillMode:n,fillValue:o,outputShape:s};return E.runKernel(xm,l,u)}var nM=_({transform_:_re});function Are(t,e,r){A(e%1===0,()=>`bandPart(): numLower must be an integer, got ${e}.`),A(r%1===0,()=>`bandPart(): numUpper must be an integer, got ${r}.`);let n=I(t,"a","bandPart");A(n.rank>=2,()=>`bandPart(): Rank must be at least 2, got ${n.rank}.`);let o=n.shape,[s,i]=n.shape.slice(-2);if(!(e<=s))throw new Error(`bandPart(): numLower (${e}) must not be greater than the number of rows (${s}).`);if(!(r<=i))throw new Error(`bandPart(): numUpper (${r}) must not be greater than the number of columns (${i}).`);e<0&&(e=s),r<0&&(r=i);let a=M(kl(0,s,1,"int32"),[-1,1]),l=kl(0,i,1,"int32"),u=Ce(a,l),c=An(bs(u,Fe(+e,"int32")),io(u,Fe(-r,"int32"))),p=Ot([s,i],n.dtype);return M(Lr(Dn(M(n,[-1,s,i])).map(f=>Bt(c,f,p))),o)}var oM=_({bandPart_:Are});function Dre(t){let e;if(Array.isArray(t)){e=!1,A(t!=null&&t.length>0,()=>"Gram-Schmidt process: input must not be null, undefined, or empty");let o=t[0].shape[0];for(let s=1;s<t.length;++s)A(t[s].shape[0]===o,()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${t[s].shape[0]} vs. ${o})`)}else e=!0,t=Pr(t,t.shape[0],0).map(o=>oi(o,[0]));A(t.length<=t[0].shape[0],()=>`Gram-Schmidt: Number of vectors (${t.length}) exceeds number of dimensions (${t[0].shape[0]}).`);let r=[],n=t;for(let o=0;o<t.length;++o)r.push(E.tidy(()=>{let s=n[o];if(o>0)for(let i=0;i<o;++i){let a=L(ye(L(r[i],s)),r[i]);s=Ce(s,a)}return xe(s,xc(s,"euclidean"))}));return e?Lr(r,0):r}var sM=_({gramSchmidt_:Dre});function $re(t,e=!1){if(A(t.rank>=2,()=>`qr() requires input tensor to have a rank >= 2, but got rank ${t.rank}`),t.rank===2)return iM(t,e);{let r=t.shape.slice(0,t.shape.length-2).reduce((l,u)=>l*u),n=Dn(M(t,[r,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),o=[],s=[];n.forEach(l=>{let[u,c]=iM(l,e);o.push(u),s.push(c)});let i=M(Lr(o,0),t.shape),a=M(Lr(s,0),t.shape);return[i,a]}}function iM(t,e=!1){return E.tidy(()=>{A(t.shape.length===2,()=>`qr2d() requires a 2D Tensor, but got a ${t.shape.length}D Tensor.`);let r=t.shape[0],n=t.shape[1],o=Lm(r),s=To(t),i=Xx([[1]],[1,1]),a=To(i),l=r>=n?n:r;for(let u=0;u<l;++u){let c=s,p=a,f=o;[a,s,o]=E.tidy(()=>{let d=et(s,[u,u],[r-u,1]),m=xc(d),h=et(s,[u,u],[1,1]),g=Bt(er(h,0),Xx([[-1]]),Xx([[1]])),x=Ce(h,L(g,m)),y=xe(d,x);y.shape[0]===1?a=To(i):a=$t([i,et(y,[1,0],[y.shape[0]-1,y.shape[1]])],0);let b=ot(xe(nt(g,x),m)),v=et(s,[u,0],[r-u,n]),C=L(b,a),S=Ge(a);if(u===0)s=Ce(v,nt(C,nt(S,v)));else{let D=Ce(v,nt(C,nt(S,v)));s=$t([et(s,[0,0],[u,n]),D],0)}let k=Ge(C),N=et(o,[0,u],[r,o.shape[1]-u]);if(u===0)o=Ce(N,nt(nt(N,a),k));else{let D=Ce(N,nt(nt(N,a),k));o=$t([et(o,[0,0],[r,u]),D],1)}return[a,s,o]}),Me([c,p,f])}return!e&&r>n&&(o=et(o,[0,0],[r,n]),s=et(s,[0,0],[n,n])),[o,s]})}var aM=_({qr_:$re});var ii={flipLeftRight:HL,grayscaleToRGB:qL,resizeNearestNeighbor:z1,resizeBilinear:M1,rotateWithOffset:jL,cropAndResize:UL,nonMaxSuppression:KL,nonMaxSuppressionAsync:QL,nonMaxSuppressionWithScore:ZL,nonMaxSuppressionWithScoreAsync:JL,nonMaxSuppressionPadded:eM,nonMaxSuppressionPaddedAsync:tM,threshold:rM,transform:nM},lM={bandPart:oM,gramSchmidt:sM,qr:aM};var bn=class extends _x{minimize(e,r=!1,n){let{value:o,grads:s}=this.computeGradients(e,n);if(n!=null){let i=n.map(a=>({name:a.name,tensor:s[a.name]}));this.applyGradients(i)}else this.applyGradients(s);return Me(s),r?o:(o.dispose(),null)}get iterations(){return this.iterations_==null&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(e,r){return z2(e,r)}dispose(){this.iterations_!=null&&Me(this.iterations_)}async saveIterations(){return this.iterations_==null&&(this.iterations_=0),{name:"iter",tensor:Fe(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(e){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(e){return this.iterations_=(await e[0].tensor.data())[0],e.slice(1)}};Object.defineProperty(bn,Symbol.hasInstance,{value:t=>t.minimize!=null&&t.computeGradients!=null&&t.applyGradients!=null});var Hm=class extends bn{constructor(e,r,n=null){super(),this.learningRate=e,this.rho=r,this.epsilon=n,this.accumulatedGrads=[],this.accumulatedUpdates=[],n==null&&(this.epsilon=E.backend.epsilon())}applyGradients(e){(Array.isArray(e)?e.map(n=>n.name):Object.keys(e)).forEach((n,o)=>{let s=E.registeredVariables[n],i=!1;this.accumulatedGrads[o]==null&&(this.accumulatedGrads[o]={originalName:`${n}/accum_grad`,variable:U(()=>_e(s).variable(i))}),this.accumulatedUpdates[o]==null&&(this.accumulatedUpdates[o]={originalName:`${n}/accum_var`,variable:U(()=>_e(s).variable(i))});let a=Array.isArray(e)?e[o].tensor:e[n];if(a==null)return;let l=this.accumulatedGrads[o].variable,u=this.accumulatedUpdates[o].variable;U(()=>{let c=te(L(l,this.rho),L(je(a),1-this.rho)),p=L(xe(Rt(te(u,this.epsilon)),Rt(te(l,this.epsilon))),a),f=te(L(u,this.rho),L(je(p),1-this.rho));l.assign(c),u.assign(f);let d=te(L(p,-this.learningRate),s);s.assign(d)})}),this.incrementIterations()}dispose(){this.accumulatedUpdates!=null&&(Me(this.accumulatedGrads.map(e=>e.variable)),Me(this.accumulatedUpdates.map(e=>e.variable)))}async getWeights(){let e=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(e.map(r=>({name:r.originalName,tensor:r.variable})))}async setWeights(e){e=await this.extractIterations(e);let r=e.length/2,n=!1;this.accumulatedGrads=e.slice(0,r).map(o=>({originalName:o.name,variable:o.tensor.variable(n)})),this.accumulatedUpdates=e.slice(r,r*2).map(o=>({originalName:o.name,variable:o.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(e,r){return new e(r.learningRate,r.rho,r.epsilon)}};Hm.className="Adadelta";so(Hm);var qm=class extends bn{constructor(e,r=.1){super(),this.learningRate=e,this.initialAccumulatorValue=r,this.accumulatedGrads=[]}applyGradients(e){(Array.isArray(e)?e.map(n=>n.name):Object.keys(e)).forEach((n,o)=>{let s=E.registeredVariables[n];this.accumulatedGrads[o]==null&&(this.accumulatedGrads[o]={originalName:`${n}/accumulator`,variable:U(()=>bl(s.shape,this.initialAccumulatorValue).variable(!1))});let i=Array.isArray(e)?e[o].tensor:e[n];if(i==null)return;let a=this.accumulatedGrads[o].variable;U(()=>{let l=te(a,je(i));a.assign(l);let u=te(L(xe(i,Rt(te(l,E.backend.epsilon()))),-this.learningRate),s);s.assign(u)})}),this.incrementIterations()}dispose(){this.accumulatedGrads!=null&&Me(this.accumulatedGrads.map(e=>e.variable))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);let r=!1;this.accumulatedGrads=e.map(n=>({originalName:n.name,variable:n.tensor.variable(r)}))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(e,r){return new e(r.learningRate,r.initialAccumulatorValue)}};qm.className="Adagrad";so(qm);var jm=class extends bn{constructor(e,r,n,o=null){super(),this.learningRate=e,this.beta1=r,this.beta2=n,this.epsilon=o,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],U(()=>{this.accBeta1=Fe(r).variable(),this.accBeta2=Fe(n).variable()}),o==null&&(this.epsilon=E.backend.epsilon())}applyGradients(e){let r=Array.isArray(e)?e.map(n=>n.name):Object.keys(e);U(()=>{let n=Ce(1,this.accBeta1),o=Ce(1,this.accBeta2);r.forEach((s,i)=>{let a=E.registeredVariables[s],l=!1;this.accumulatedFirstMoment[i]==null&&(this.accumulatedFirstMoment[i]={originalName:`${s}/m`,variable:U(()=>_e(a).variable(l))}),this.accumulatedSecondMoment[i]==null&&(this.accumulatedSecondMoment[i]={originalName:`${s}/v`,variable:U(()=>_e(a).variable(l))});let u=Array.isArray(e)?e[i].tensor:e[s];if(u==null)return;let c=this.accumulatedFirstMoment[i].variable,p=this.accumulatedSecondMoment[i].variable,f=te(L(c,this.beta1),L(u,1-this.beta1)),d=te(L(p,this.beta2),L(je(u),1-this.beta2)),m=xe(f,n),h=xe(d,o);c.assign(f),p.assign(d);let g=te(L(xe(m,te(Rt(h),this.epsilon)),-this.learningRate),a);a.assign(g)}),this.accBeta1.assign(L(this.accBeta1,this.beta1)),this.accBeta2.assign(L(this.accBeta2,this.beta2))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),this.accumulatedFirstMoment!=null&&Me(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedSecondMoment!=null&&Me(this.accumulatedSecondMoment.map(e=>e.variable))}async getWeights(){let e=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(e.map(r=>({name:r.originalName,tensor:r.variable})))}async setWeights(e){e=await this.extractIterations(e),U(()=>{this.accBeta1.assign(ys(this.beta1,this.iterations_+1)),this.accBeta2.assign(ys(this.beta2,this.iterations_+1))});let r=e.length/2,n=!1;this.accumulatedFirstMoment=e.slice(0,r).map(o=>({originalName:o.name,variable:o.tensor.variable(n)})),this.accumulatedSecondMoment=e.slice(r,r*2).map(o=>({originalName:o.name,variable:o.tensor.variable(n)}))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(e,r){return new e(r.learningRate,r.beta1,r.beta2,r.epsilon)}};jm.className="Adam";so(jm);var Km=class extends bn{constructor(e,r,n,o=null,s=0){super(),this.learningRate=e,this.beta1=r,this.beta2=n,this.epsilon=o,this.decay=s,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],U(()=>{this.iteration=Fe(0).variable(),this.accBeta1=Fe(r).variable()}),o==null&&(this.epsilon=E.backend.epsilon())}applyGradients(e){let r=Array.isArray(e)?e.map(n=>n.name):Object.keys(e);U(()=>{let n=Ce(1,this.accBeta1),o=xe(-this.learningRate,te(L(this.iteration,this.decay),1));r.forEach((s,i)=>{let a=E.registeredVariables[s],l=!1;this.accumulatedFirstMoment[i]==null&&(this.accumulatedFirstMoment[i]={originalName:`${s}/m`,variable:_e(a).variable(l)}),this.accumulatedWeightedInfNorm[i]==null&&(this.accumulatedWeightedInfNorm[i]={originalName:`${s}/v`,variable:_e(a).variable(l)});let u=Array.isArray(e)?e[i].tensor:e[s];if(u==null)return;let c=this.accumulatedFirstMoment[i].variable,p=this.accumulatedWeightedInfNorm[i].variable,f=te(L(c,this.beta1),L(u,1-this.beta1)),d=L(p,this.beta2),m=Sr(u),h=Eo(d,m);c.assign(f),p.assign(h);let g=te(L(xe(o,n),xe(f,te(h,this.epsilon))),a);a.assign(g)}),this.iteration.assign(te(this.iteration,1)),this.accBeta1.assign(L(this.accBeta1,this.beta1))}),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),this.accumulatedFirstMoment!=null&&Me(this.accumulatedFirstMoment.map(e=>e.variable)),this.accumulatedWeightedInfNorm!=null&&Me(this.accumulatedWeightedInfNorm.map(e=>e.variable))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(e){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(e,r){return new e(r.learningRate,r.beta1,r.beta2,r.epsilon,r.decay)}};Km.className="Adamax";so(Km);var bc=class extends bn{constructor(e){super(),this.learningRate=e,this.setLearningRate(e)}applyGradients(e){(Array.isArray(e)?e.map(n=>n.name):Object.keys(e)).forEach((n,o)=>{let s=Array.isArray(e)?e[o].tensor:e[n];if(s==null)return;let i=E.registeredVariables[n];U(()=>{let a=te(L(this.c,s),i);i.assign(a)})}),this.incrementIterations()}setLearningRate(e){this.learningRate=e,this.c!=null&&this.c.dispose(),this.c=Gr(Fe(-e))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(e){if(e=await this.extractIterations(e),e.length!==0)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(e,r){return new e(r.learningRate)}};bc.className="SGD";so(bc);var Xm=class extends bc{constructor(e,r,n=!1){super(e),this.learningRate=e,this.momentum=r,this.useNesterov=n,this.accumulations=[],this.m=Fe(this.momentum)}applyGradients(e){(Array.isArray(e)?e.map(n=>n.name):Object.keys(e)).forEach((n,o)=>{let s=E.registeredVariables[n];this.accumulations[o]==null&&(this.accumulations[o]={originalName:`${n}/momentum`,variable:U(()=>_e(s).variable(!1))});let i=this.accumulations[o].variable,a=Array.isArray(e)?e[o].tensor:e[n];a!=null&&U(()=>{let l,u=te(L(this.m,i),a);this.useNesterov?l=te(L(this.c,te(a,L(u,this.m))),s):l=te(L(this.c,u),s),i.assign(u),s.assign(l)})}),this.incrementIterations()}dispose(){this.m.dispose(),this.accumulations!=null&&Me(this.accumulations.map(e=>e.variable))}setMomentum(e){this.momentum=e}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map(e=>({name:e.originalName,tensor:e.variable})))}async setWeights(e){e=await this.extractIterations(e);let r=!1;this.accumulations=e.map(n=>({originalName:n.name,variable:n.tensor.variable(r)}))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(e,r){return new e(r.learningRate,r.momentum,r.useNesterov)}};Xm.className="Momentum";so(Xm);var Ym=class extends bn{constructor(e,r=.9,n=0,o=null,s=!1){if(super(),this.learningRate=e,this.decay=r,this.momentum=n,this.epsilon=o,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=s,o==null&&(this.epsilon=E.backend.epsilon()),e==null)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(e){(Array.isArray(e)?e.map(n=>n.name):Object.keys(e)).forEach((n,o)=>{let s=E.registeredVariables[n],i=!1;this.accumulatedMeanSquares[o]==null&&(this.accumulatedMeanSquares[o]={originalName:`${n}/rms`,variable:U(()=>_e(s).variable(i))}),this.accumulatedMoments[o]==null&&(this.accumulatedMoments[o]={originalName:`${n}/momentum`,variable:U(()=>_e(s).variable(i))}),this.accumulatedMeanGrads[o]==null&&this.centered&&(this.accumulatedMeanGrads[o]={originalName:`${n}/mg`,variable:U(()=>_e(s).variable(i))});let a=Array.isArray(e)?e[o].tensor:e[n];if(a==null)return;let l=this.accumulatedMeanSquares[o].variable,u=this.accumulatedMoments[o].variable;U(()=>{let c=te(L(l,this.decay),L(je(a),1-this.decay));if(this.centered){let p=this.accumulatedMeanGrads[o].variable,f=te(L(p,this.decay),L(a,1-this.decay)),d=xe(L(a,this.learningRate),Rt(Ce(c,te(je(f),this.epsilon)))),m=te(L(u,this.momentum),d);l.assign(c),p.assign(f),u.assign(m);let h=Ce(s,m);s.assign(h)}else{let p=te(L(l,this.decay),L(je(a),1-this.decay)),f=te(L(u,this.momentum),xe(L(a,this.learningRate),Rt(te(p,this.epsilon))));l.assign(p),u.assign(f);let d=Ce(s,f);s.assign(d)}})}),this.incrementIterations()}dispose(){this.accumulatedMeanSquares!=null&&Me(this.accumulatedMeanSquares.map(e=>e.variable)),this.accumulatedMeanGrads!=null&&this.centered&&Me(this.accumulatedMeanGrads.map(e=>e.variable)),this.accumulatedMoments!=null&&Me(this.accumulatedMoments.map(e=>e.variable))}async getWeights(){let e=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&e.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(e.map(r=>({name:r.originalName,tensor:r.variable})))}async setWeights(e){e=await this.extractIterations(e);let r=this.centered?e.length/3:e.length/2,n=!1;this.accumulatedMeanSquares=e.slice(0,r).map(o=>({originalName:o.name,variable:o.tensor.variable(n)})),this.accumulatedMoments=e.slice(r,r*2).map(o=>({originalName:o.name,variable:o.tensor.variable(n)})),this.centered&&(this.accumulatedMeanGrads=e.slice(r*2,r*3).map(o=>({originalName:o.name,variable:o.tensor.variable(n)})))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(e,r){return new e(r.learningRate,r.decay,r.momentum,r.epsilon,r.centered)}};Ym.className="RMSProp";so(Ym);var Hi=class{static sgd(e){return new bc(e)}static momentum(e,r,n=!1){return new Xm(e,r,n)}static rmsprop(e,r=.9,n=0,o=null,s=!1){return new Ym(e,r,n,o,s)}static adam(e=.001,r=.9,n=.999,o=null){return new jm(e,r,n,o)}static adadelta(e=.001,r=.95,n=null){return new Hm(e,r,n)}static adamax(e=.002,r=.9,n=.999,o=null,s=0){return new Km(e,r,n,o,s)}static adagrad(e,r=.1){return new qm(e,r)}};var ff={sgd:Hi.sgd,momentum:Hi.momentum,adadelta:Hi.adadelta,adagrad:Hi.adagrad,rmsprop:Hi.rmsprop,adamax:Hi.adamax,adam:Hi.adam};var Rre=(()=>typeof requestAnimationFrame<"u"?requestAnimationFrame:typeof setImmediate<"u"?setImmediate:t=>t())();function Qx(){return new Promise(t=>Rre(()=>t()))}var T={};Ho(T,{ERF_A1:()=>Kre,ERF_A2:()=>Xre,ERF_A3:()=>Yre,ERF_A4:()=>Qre,ERF_A5:()=>Zre,ERF_P:()=>jre,PARALLELIZE_THRESHOLD:()=>B1,RowPartitionType:()=>qi,SELU_SCALE:()=>oE,SELU_SCALEALPHA:()=>nE,applyActivation:()=>uf,assertAndGetBroadcastShape:()=>Be,assertAxesAreInnerMostDims:()=>xee,assertParamsConsistent:()=>Ore,assignToTypedArray:()=>one,axesAreInnerMostDims:()=>D2,calculateShapes:()=>YZ,checkEinsumDimSizes:()=>cne,checkPadOnDimRoundingMode:()=>It,combineLocations:()=>uL,combineRaggedTensorToTensorShapes:()=>Pre,complexWithEvenIndex:()=>tne,complexWithOddIndex:()=>rne,computeConv2DInfo:()=>Xp,computeConv3DInfo:()=>tL,computeDefaultPad:()=>y2,computeDilation2DInfo:()=>CJ,computeOptimalWindowSize:()=>Bre,computeOutAndReduceShapes:()=>$2,computeOutShape:()=>Fre,computePool2DInfo:()=>x2,computePool3DInfo:()=>SJ,convertConv2DDataFormat:()=>rL,decodeEinsumEquation:()=>lne,eitherStridesOrDilationsAreOne:()=>on,expandShapeToKeepDim:()=>Gi,exponent:()=>ine,exponents:()=>sne,fromStringArrayToUint8:()=>Dne,fromUint8ToStringArray:()=>Ane,getAxesPermutation:()=>R2,getBroadcastDims:()=>BP,getComplexWithIndex:()=>nne,getEinsumComputePath:()=>pne,getEinsumPermutation:()=>une,getFusedBiasGradient:()=>lf,getFusedDyActivation:()=>af,getImageCenter:()=>Vre,getInnerMostAxes:()=>yee,getPermuted:()=>Gre,getRaggedRank:()=>Mre,getReductionAxes:()=>wt,getReshaped:()=>Wre,getReshapedPermuted:()=>Ure,getRowPartitionTypesHelper:()=>Lre,getSliceBeginCoords:()=>Hre,getSliceSize:()=>qre,getSparseFillEmptyRowsIndicesDenseShapeMismatch:()=>hne,getSparseFillEmptyRowsNegativeIndexErrorMessage:()=>gne,getSparseFillEmptyRowsOutOfRangeIndexErrorMessage:()=>xne,getSparseReshapeEmptyTensorZeroOutputDimErrorMessage:()=>vne,getSparseReshapeInputOutputMismatchErrorMessage:()=>Cne,getSparseReshapeInputOutputMultipleErrorMessage:()=>wne,getSparseReshapeMultipleNegativeOneOutputDimErrorMessage:()=>yne,getSparseReshapeNegativeOutputDimErrorMessage:()=>bne,getSparseSegmentReductionIndicesOutOfRangeErrorMessage:()=>Nne,getSparseSegmentReductionNegativeSegmentIdsErrorMessage:()=>Sne,getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage:()=>kne,getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage:()=>Tne,getUndoAxesPermutation:()=>Px,isIdentityPermutation:()=>fne,log:()=>MQ,mergeRealAndImagArrays:()=>Jre,prepareAndValidate:()=>KZ,prepareSplitSize:()=>mne,segment_util:()=>iE,shouldFuse:()=>cf,slice_util:()=>Ur,splitRealAndImagArrays:()=>ene,tupleValuesAreOne:()=>Ko,upcastType:()=>wr,validateDefaultValueShape:()=>zre,validateInput:()=>XZ,validateUpdateShape:()=>GP,warn:()=>Li});function Ore(t,e){let r=t[0].length;t.forEach((o,s)=>{A(o.length===r,()=>`Error in concat${r}D: rank of tensors[${s}] must be the same as the rank of the rest (${r})`)}),A(e>=0&&e<r,()=>`Error in concat${r}D: axis must be between 0 and ${r-1}.`);let n=t[0];t.forEach((o,s)=>{for(let i=0;i<r;i++)A(i===e||o[i]===n[i],()=>`Error in concat${r}D: Shape of tensors[${s}] (${o}) does not match the shape of the rest (${n}) along the non-concatenated axis ${s}.`)})}function Fre(t,e){let r=t[0].slice();for(let n=1;n<t.length;n++)r[e]+=t[n][e];return r}var qi;(function(t){t[t.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",t[t.VALUE_ROWIDS=1]="VALUE_ROWIDS",t[t.ROW_LENGTHS=2]="ROW_LENGTHS",t[t.ROW_SPLITS=3]="ROW_SPLITS",t[t.ROW_LIMITS=4]="ROW_LIMITS",t[t.ROW_STARTS=5]="ROW_STARTS"})(qi||(qi={}));function Pre(t,e,r){let n=new Array;if(r==null&&e==null)return n;if(e==null)for(;n.length<t+r.length;)n.push(-1);else n=e.slice();if(r==null)return n;if(t+r.length!==n.length)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.rank = ${t+r.length}, but shape.rank = ${n.length}`);for(let o=1;o<r.length;++o){let s=r[o],i=n[n.length-r.length+o],a=n[i];if(s>=0)if(a>=0){if(a!==s)throw new Error(`rt input.shape and shape=${e} are incompatible: rt input.shape[${o+t}] = ${s} but shape[${o+t}] = ${a}`)}else n[i]=s}return n}function Lre(t){let e={FIRST_DIM_SIZE:qi.FIRST_DIM_SIZE,VALUE_ROWIDS:qi.VALUE_ROWIDS,ROW_LENGTHS:qi.ROW_LENGTHS,ROW_SPLITS:qi.ROW_SPLITS,ROW_LIMITS:qi.ROW_LIMITS,ROW_STARTS:qi.ROW_STARTS},r=[];for(let n of t)if(n in e)r.push(e[n]);else break;return r}function Mre(t){return t.length===0?0:t[0]===qi.FIRST_DIM_SIZE?t.length-1:t.length}function zre(t,e){if(t==null||e==null)return;let r=t.length,n=e.length;if(r>=n)throw new Error(`defaultValue.shape=${t} and ragged tensor flatValues.shape=${e}, are incompatible: defaultValue.rank = ${r} must be less than ragged tensor input flatValues.rank = ${n})`);for(let o=0;o<Math.min(r,n-1);++o){let s=t[o],i=e[o+1];if(s>=0&&i>=0&&s!==1&&s!==i)throw new Error(`defaultValue.shape=${t}, and ragged tensor input flatValues.shape=${e} are incompatible: defaultValue.shape[${o-t.length}] = ${s} but ragged tensor input.flatValues.shape[${o-t.length}] = ${i}`)}}var B1=30;function Bre(t){return t<=B1?t:Rd(t,Math.floor(Math.sqrt(t)))}function Vre(t,e,r){let n=r*(typeof t=="number"?t:t[0]),o=e*(typeof t=="number"?t:t[1]);return[n,o]}function Wre(t,e,r,n=!0){let o=[];if(n)o=o.concat(e.slice(0)),o.push(t[0]/r),o=o.concat(t.slice(1));else{o=o.concat(t[0]);let s=e.length;for(let i=0;i<s;++i)o=o.concat([t[i+1]/e[i],e[i]]);o=o.concat(t.slice(s+1))}return o}function Gre(t,e,r=!0){let n=[];if(r){n.push(e);for(let o=e+1;o<t;++o)o<=2*e?(n.push(o),n.push(o-(e+1))):n.push(o)}else{let o=[],s=[];for(let i=1;i<t;++i)i>=e*2+1||i%2===1?s.push(i):o.push(i);n.push(...o),n.push(0),n.push(...s)}return n}function Ure(t,e,r,n=!0){let o=[];n?o.push(t[0]/r):o.push(t[0]*r);for(let s=1;s<t.length;++s)s<=e.length?n?o.push(e[s-1]*t[s]):o.push(t[s]/e[s-1]):o.push(t[s]);return o}function Hre(t,e){let r=[0];for(let n=0;n<e;++n)r.push(t[n][0]);return r}function qre(t,e,r){let n=t.slice(0,1);for(let o=0;o<r;++o)n.push(t[o+1]-e[o][0]-e[o][1]);return n}var nE=1.7580993408473768,oE=1.0507009873554805;var jre=.3275911,Kre=.254829592,Xre=-.284496736,Yre=1.421413741,Qre=-1.453152027,Zre=1.061405429;function Jre(t,e){if(t.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${t.length}, imag: ${e.length}.`);let r=new Float32Array(t.length*2);for(let n=0;n<r.length;n+=2)r[n]=t[n/2],r[n+1]=e[n/2];return r}function ene(t){let e=new Float32Array(t.length/2),r=new Float32Array(t.length/2);for(let n=0;n<t.length;n+=2)e[n/2]=t[n],r[n/2]=t[n+1];return{real:e,imag:r}}function tne(t){let e=Math.ceil(t.length/4),r=new Float32Array(e),n=new Float32Array(e);for(let o=0;o<t.length;o+=4)r[Math.floor(o/4)]=t[o],n[Math.floor(o/4)]=t[o+1];return{real:r,imag:n}}function rne(t){let e=Math.floor(t.length/4),r=new Float32Array(e),n=new Float32Array(e);for(let o=2;o<t.length;o+=4)r[Math.floor(o/4)]=t[o],n[Math.floor(o/4)]=t[o+1];return{real:r,imag:n}}function nne(t,e){let r=t[e*2],n=t[e*2+1];return{real:r,imag:n}}function one(t,e,r,n){t[n*2]=e,t[n*2+1]=r}function sne(t,e){let r=new Float32Array(t/2),n=new Float32Array(t/2);for(let o=0;o<Math.ceil(t/2);o++){let s=(e?2:-2)*Math.PI*(o/t);r[o]=Math.cos(s),n[o]=Math.sin(s)}return{real:r,imag:n}}function ine(t,e,r){let n=(r?2:-2)*Math.PI*(t/e),o=Math.cos(n),s=Math.sin(n);return{real:o,imag:s}}var sE="->",ane=/->/g,uM=",",cM="...";function lne(t,e){t=t.replace(/\s/g,"");let r=(t.length-t.replace(ane,"").length)/sE.length;if(r<1)throw new Error("Equations without an arrow are not supported.");if(r>1)throw new Error(`Equation must contain exactly one arrow ("${sE}").`);let[n,o]=t.split(sE);A(n.indexOf(cM)===-1,()=>`The ellipsis notation ("${cM}") is not supported yet.`);let s=n.split(uM),i=s.length;if(e!==i)throw new Error(`Expected ${i} input tensors, received ${e}`);if(i>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");let a=[];for(let f=0;f<o.length;++f){let d=o[f];if(!s.some(m=>m.indexOf(d)!==-1))throw new Error(`Output subscripts contain the label ${d} not present in the input subscripts.`);a.indexOf(d)===-1&&a.push(d)}for(let f=0;f<n.length;++f){let d=n[f];a.indexOf(d)===-1&&d!==uM&&a.push(d)}let l=new Array(s.length);for(let f=0;f<i;++f){if(new Set(s[f].split("")).size!==s[f].length)throw new Error(`Found duplicate axes in input component ${s[f]}. Support for duplicate axes in input is not implemented yet.`);l[f]=[];for(let d=0;d<s[f].length;++d)l[f].push(a.indexOf(s[f][d]))}let u=a.length,c=o.length,p=[];for(let f=c;f<u;++f)p.push(f);return{allDims:a,summedDims:p,idDims:l}}function une(t,e){let r=new Array(t);r.fill(-1);for(let o=0;o<e.length;++o)r[e[o]]=o;let n=[];for(let o=0;o<t;++o)r[o]===-1&&n.push(o);return r=r.filter(o=>o!==-1),{permutationIndices:r,expandDims:n}}function cne(t,e,r){let n=new Array(t);for(let o=0;o<r.length;++o){let s=r[o].shape;for(let i=0;i<e[o].length;++i)n[e[o][i]]===void 0?n[e[o][i]]=s[i]:A(n[e[o][i]]===s[i],()=>`Expected dimension ${n[e[o][i]]} at axis ${i} of input shaped ${JSON.stringify(s)}, but got dimension ${s[i]}`)}}function pne(t,e){let r=t,n=[],o=0;t.length===0&&r.push(-1),o=t.length+1;for(let i=0;i<o;++i)n.push([]);let s=[];for(let i=0;i<r.length;++i){let a=r[i],l=dne(e,a);for(let u of l)s.indexOf(u)===-1&&(n[i].push(u),s.push(u))}return{path:r,steps:n}}function fne(t){return t.every((e,r)=>e===r)}function dne(t,e){let r=[];for(let n=0;n<t.length;++n)(t[n].length===0||t[n].indexOf(e)!==-1||e===-1)&&r.push(n);return r}function mne(t,e,r=0){let n=[];if(typeof e=="number")A(t.shape[r]%e===0,()=>"Number of splits must evenly divide the axis."),n=new Array(e).fill(t.shape[r]/e);else{let o=e.reduce((i,a)=>(a===-1&&(i+=1),i),0);A(o<=1,()=>"There should be only one negative value in split array.");let s=e.indexOf(-1);if(s!==-1){let i=e.reduce((a,l)=>l>0?a+l:a);e[s]=t.shape[r]-i}A(t.shape[r]===e.reduce((i,a)=>i+a),()=>"The sum of sizes must match the size of the axis dimension."),n=e}return n}function hne(t){return`Received SparseTensor with denseShape[0] = 0 but
  indices.shape[0] = ${t}`}function gne(t,e){return`indices(${t}, 0) is invalid: ${e} < 0`}function xne(t,e,r){return`indices(${t}, 0) is invalid: ${e} >= ${r}`}function yne(t,e){return`only one output dimension may be -1, not both ${t} and ${e}`}function bne(t,e){return`size ${t} must be non-negative, not ${e}`}function vne(){return"reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero"}function wne(t,e){let r=lt(t),n=lt(e);return`Input to reshape is a SparseTensor with ${r}
  dense values, but the requested shape requires a multiple of ${n}. inputShape=${t} outputShape= ${e}`}function Cne(t,e){let r=lt(t),n=lt(e);return`Input to reshape is a tensor with ${r} dense values, but the requested shape has ${n}. inputShape=${t} outputShape=${e}`}function Sne(){return"segment ids must be >= 0"}function kne(){return"segment ids are not increasing"}function Tne(t,e){return`Segment id ${t} out of range [0, ${e}), possibly because segmentIds input is not sorted.`}function Nne(t,e,r){return`Bad: indices[${t}] == ${e} out of range [0, ${r})`}var iE={};Ho(iE,{collectGatherOpShapeInfo:()=>_ne,computeOutShape:()=>Ene,segOpComputeOptimalWindowSize:()=>Ine});function Ine(t,e){let r=!1,n;for(t<=B1?(n=t,r=!0):n=Rd(t,Math.floor(Math.sqrt(t)));!r;)n>e||n===t?r=!0:n=Rd(t,n+1);return n}function Ene(t,e,r){let n=[],o=t.length;for(let s=0;s<o;s++)s!==e?n.push(t[s]):n.push(r);return n}function _ne(t,e,r,n){let o=e.shape.length,s=t.shape.length;if(n!==0&&(n<-o||n>o))throw new Error(`Expect batchDims in the range of [-${o}, ${o}], but got ${n}`);if(n<0&&(n+=o),n>s)throw new Error(`batchDims (${n}) must be less than rank(x) (
    ${s}).`);if(r<n)throw new Error(`batchDims (${n}) must be less than or equal to axis (${r}).`);for(let p=0;p<n;++p)if(t.shape[p]!==e.shape[p])throw new Error(`x.shape[${p}]: ${t.shape[p]} should be equal to indices.shape[${p}]: ${e.shape[p]}.`);let i=t.shape[r],a=[],l=1,u=1,c=1;for(let p=0;p<n;++p)a.push(t.shape[p]),l*=t.shape[p];for(let p=n;p<r;p++)a.push(t.shape[p]),u*=t.shape[p];for(let p=n;p<o;p++)a.push(e.shape[p]);for(let p=r+1;p<s;p++)a.push(t.shape[p]),c*=t.shape[p];return{batchSize:l,sliceSize:c,outerSize:u,dimSize:i,outputShape:a}}function Ane(t){try{return t.map(e=>km(e))}catch(e){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${e}`)}}function Dne(t){return t.map(e=>Sm(e))}var vn={};Ho(vn,{nonMaxSuppressionV3Impl:()=>F1,nonMaxSuppressionV4Impl:()=>P1,nonMaxSuppressionV5Impl:()=>L1,whereImpl:()=>ML});var V1={kernelName:bu,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>L(t,si(oe(r,"float32"),-1))}}};var pM={kernelName:va,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>{let n=je(oe(r,"float32")),o=Rt(Ce(Fe(1),n));return ot(xe(t,o))}}}};var fM={kernelName:wa,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>{let n=Rt(Ce(je(oe(r,"float32")),1));return xe(t,n)}}}};var dM={kernelName:ti,inputsToSave:["a","b"],gradFunc:(t,e)=>{let[r,n]=e,o=Be(r.shape,n.shape);return{a:()=>{let a=t,l=wt(r.shape,o);return l.length>0&&(a=ye(a,l)),M(a,r.shape)},b:()=>{let a=t,l=wt(n.shape,o);return l.length>0&&(a=ye(a,l)),M(a,n.shape)}}}};var mM={kernelName:Fd,saveAllInputs:!0,gradFunc:(t,e)=>{let r={};return e.forEach((n,o)=>{r[o]=()=>t.clone()}),r}};var hM={kernelName:vu,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>_e(r)}}};var gM={kernelName:wu,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>_e(r)}}};var xM={kernelName:Ca,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>xe(t,Rt(Ce(Fe(1),je(oe(r,"float32")))))}}};var yM={kernelName:Sa,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>{let n=Rt(te(Fe(1),je(oe(r,"float32"))));return xe(t,n)}}}};var bM={kernelName:Na,inputsToSave:["a","b"],gradFunc:(t,e)=>{let[r,n]=e,o=Be(r.shape,n.shape);return{a:()=>{let a=te(je(r),je(n)),l=L(t,xe(n,a)),u=wt(r.shape,o);return u.length>0&&(l=ye(l,u)),M(l,r.shape)},b:()=>{let a=te(je(r),je(n)),l=ot(L(t,xe(r,a))),u=wt(n.shape,o);return u.length>0&&(l=ye(l,u)),M(l,n.shape)}}}};var vM={kernelName:ka,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>xe(t,te(je(oe(r,"float32")),1))}}};var wM={kernelName:Ta,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>xe(t,Ce(Fe(1),je(oe(r,"float32"))))}}};function $ne(t,e,r,n,o,s){let i=I(t,"dy","avgPool3dGrad"),a=I(e,"input","avgPool3dGrad"),l=i,u=a,c=!1;a.rank===4&&(c=!0,l=M(i,[1,i.shape[0],i.shape[1],i.shape[2],i.shape[3]]),u=M(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),A(l.rank===5,()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${l.rank}.`),A(u.rank===5,()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${u.rank}.`),It("avgPool3dGrad",o,s);let p={dy:l,input:u},f={filterSize:r,strides:n,pad:o,dimRoundingMode:s},d=E.runKernel(zd,p,f);return c?M(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}var CM=_({avgPool3dGrad_:$ne});var SM={kernelName:Su,inputsToSave:["x"],gradFunc:(t,e,r)=>{let[n]=e,{filterSize:o,strides:s,pad:i,dimRoundingMode:a}=r;return{x:()=>CM(t,n,o,s,i,a)}}};function Rne(t,e,r,n,o){let s=I(t,"dy","avgPoolGrad"),i=I(e,"input","avgPoolGrad");A(i.rank===s.rank,()=>`Rank of input (${i.rank}) does not match rank of dy (${s.rank})`);let a=i,l=s,u=!1;i.rank===3&&(u=!0,a=M(i,[1,i.shape[0],i.shape[1],i.shape[2]]),l=M(s,[1,s.shape[0],s.shape[1],s.shape[2]])),A(l.rank===4,()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${l.rank}.`),A(a.rank===4,()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`);let c={dy:l,input:a},p={filterSize:r,strides:n,pad:o},f=E.runKernel(Md,c,p);return u?M(f,[f.shape[1],f.shape[2],f.shape[3]]):f}var kM=_({avgPoolGrad_:Rne});var TM={kernelName:Cu,inputsToSave:["x"],gradFunc:(t,e,r)=>{let[n]=e,{filterSize:o,strides:s,pad:i}=r;return{x:()=>kM(t,n,o,s,i)}}};var NM={kernelName:ku,inputsToSave:["a","b"],gradFunc:(t,e,r)=>{let[n,o]=e,{transposeA:s,transposeB:i}=r;return!s&&!i?{a:()=>nt(t,o,!1,!0),b:()=>nt(n,t,!0,!1)}:!s&&i?{a:()=>nt(t,o,!1,!1),b:()=>nt(t,n,!0,!1)}:s&&!i?{a:()=>nt(o,t,!1,!0),b:()=>nt(n,t,!1,!1)}:{a:()=>nt(o,t,!0,!0),b:()=>nt(t,n,!0,!0)}}};var IM={kernelName:Tu,gradFunc:(t,e,r)=>{let{blockShape:n,crops:o}=r;return{x:()=>Bm(t,n,o)}}};var EM={kernelName:RF,gradFunc:(t,e,r)=>{let n=r,o=n.inputShape,s=n.shape,i=Array.from(s);for(let l=o.length-1;l>=0;l--)if(o[l]===s[l])i[l]=1;else if(o[l]!==1)throw new Error(`broadcastTo(): [${o}] cannot be broadcast to [${s}].`);let a=[];for(let l=0;l<i.length;l++)i[l]>1&&a.push(l);return{x:()=>ye(t,a,!0)}}};var _M={kernelName:Ri,gradFunc:t=>({x:()=>t.clone()})};var AM={kernelName:Ia,gradFunc:t=>({x:()=>_e(t)})};var DM={kernelName:Ea,inputsToSave:["x"],gradFunc:(t,e,r)=>{let[n]=e,{clipValueMin:o,clipValueMax:s}=r;return{x:()=>Bt(An(io(n,o),bs(n,s)),t,_e(t))}}};var $M={kernelName:Nu,inputsToSave:["x"],gradFunc:V1.gradFunc};var RM={kernelName:Iu,saveAllInputs:!0,gradFunc:(t,e,r)=>{let n=e.map(l=>l.shape),{axis:o}=r,s=Ar(o,e[0].shape)[0],i=n.map(l=>l[s]);return Pr(t,i,s).map(l=>()=>l)}};var OM={kernelName:Eu,inputsToSave:["x","filter"],gradFunc:(t,e,r)=>{let[n,o]=e,{dilations:s,strides:i,pad:a,dataFormat:l}=r;return A(Ko(s),()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`),{x:()=>Pm(n.shape,t,o,i,a,l),filter:()=>Um(n,t,o.shape,i,a,l)}}};var FM={kernelName:_u,inputsToSave:["dy","filter"],gradFunc:(t,e,r)=>{let[n,o]=e,{strides:s,pad:i,dataFormat:a,dimRoundingMode:l}=r;return{dy:()=>Io(t,o,s,i,a,1,l),filter:()=>Um(t,n,o.shape,s,i,a,l)}}};function One(t,e,r,n,o){let s=t;t.rank===4&&(s=M(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]));let i=e;i.rank===4&&(i=M(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),A(s.rank===5,()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${s.shape}.`),A(i.rank===5,()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${i.shape}.`),A(r.length===5,()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${r}.`),A(s.shape[4]===r[3],()=>`Error in conv3dDerFilter: depth of input ${s.shape[4]}) must match input depth in filter (${r[3]}.`),A(i.shape[4]===r[4],()=>`Error in conv3dDerFilter: depth of dy (${i.shape[4]}) must match output depth for filter (${r[4]}).`);let a={x:s,dy:i},l={strides:n,pad:o,filterShape:r};return E.runKernel(Gd,a,l)}var PM=_({conv3DBackpropFilter_:One});var LM={kernelName:Au,inputsToSave:["x","filter"],gradFunc:(t,e,r)=>{let{dilations:n,strides:o,pad:s}=r;A(Ko(n),()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${n}'`);let[i,a]=e;return{x:()=>C1(i.shape,t,a,o,s),filter:()=>PM(i,t,a.shape,o,s)}}};var MM={kernelName:_a,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>L(ot(Ux(oe(r,"float32"))),t)}}};var zM={kernelName:Aa,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>L(Hx(oe(r,"float32")),t)}}};var BM={kernelName:Du,inputsToSave:["x"],gradFunc:(t,e,r)=>{let[n]=e,{axis:o,exclusive:s,reverse:i}=r;return{x:()=>{let a=R2([o],n.rank),l=S1(t,o,s,!i);return a!=null&&(l=Ge(l,a)),l}}}};var VM={kernelName:$u,inputsToSave:["x","filter"],gradFunc:(t,e,r)=>{let{dilations:n,strides:o,pad:s,dimRoundingMode:i}=r,a=n??[1,1];A(Ko(a),()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`);let[l,u]=e;return A(l.rank===4,()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${l.rank}.`),A(u.rank===4,()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${u.rank}.`),A(l.shape[3]===u.shape[2],()=>`Error in gradient of depthwiseConv2d: number of input channels (${l.shape[3]}) must match the inChannels dimension in filter ${u.shape[2]}.`),A(on(o,a),()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${o} and dilations '${a}'.`),It("depthwiseConv2d",s,i),{x:()=>O1(l.shape,t,u,o,s,a,i),filter:()=>R1(l,t,u.shape,o,s,a,i)}}};var WM={kernelName:Ru,inputsToSave:["x","filter"],gradFunc:(t,e,r)=>{let[n,o]=e,s={x:n,filter:o,dy:t},i={x:n,filter:o,dy:t};return{x:()=>E.runKernel(hx,s,r),filter:()=>E.runKernel(gx,i,r)}}};var GM={kernelName:$a,outputsToSave:[!0],gradFunc:(t,e)=>{let[r]=e,n={dy:t,y:r};return{x:()=>E.runKernel(Zd,n)}}};var UM={kernelName:Ra,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e,n=L(xn(ot(je(r))),2/Math.sqrt(Math.PI));return{x:()=>L(t,n)}}};var HM={kernelName:Oa,outputsToSave:[!0],gradFunc:(t,e)=>{let[r]=e;return{x:()=>L(t,r)}}};var qM={kernelName:Ou,inputsToSave:["input"],gradFunc:(t,e)=>{let[r]=e;return{input:()=>M(t,r.shape)}}};var jM={kernelName:Fa,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>L(t,xn(r))}}};var KM={kernelName:Pa,gradFunc:t=>({x:()=>_e(t)})};var XM={kernelName:La,inputsToSave:["a","b"],gradFunc:(t,e)=>{let[r,n]=e,o=Be(r.shape,n.shape);return{a:()=>{let a=xe(t,oe(n,"float32")),l=wt(r.shape,o);return l.length>0?M(ye(a,l),r.shape):a},b:()=>{let a=L(t,oe(r,"float32")),l=wt(n.shape,o);l.length>0&&(a=M(ye(a,l),n.shape));let u=je(n);return ot(xe(a,oe(u,"float32")))}}}};var YM={kernelName:Fu,inputsToSave:["x","mean","variance","scale"],gradFunc:(t,e,r)=>{let{varianceEpsilon:n}=r,[o,s,i,a]=e,l=a??Fe(1),u=wt(s.shape,o.shape),c=[];if(s.rank===1){for(let v=0;v<o.shape.length-1;++v)c.push(o.shape[v]);c.push(1)}let p=Ce(o,s),f=L(t,l),d=Vx(te(i,Fe(n))),m=L(L(L(d,d),d),Fe(-.5));return{x:()=>s.rank===1?M(L(L(t,yn(M(d,[1,1,1,s.shape[0]]),c)),l),o.shape):M(L(L(t,d),l),o.shape),mean:()=>{let v=L(L(d,Fe(-1)),f);return s.rank===1&&(v=ye(v,u)),M(v,s.shape)},variance:()=>{let v=L(L(m,p),f);return s.rank===1&&(v=ye(v,u)),M(v,s.shape)},scale:()=>{let v=L(p,d),C=L(t,v);return s.rank===1&&(C=ye(C,u)),M(C,s.shape)},offset:()=>{let v=t;return s.rank===1&&(v=ye(v,u)),M(v,s.shape)}}}};var JM={kernelName:Pu,inputsToSave:["x","indices"],gradFunc:(t,e,r)=>{let[n,o]=e,{axis:s}=r,i=Ar(s,n.shape)[0];return{x:()=>{let l=n.shape,u=o.size,c=l.slice(0,i),p=c.length,f=l.slice(s,l.length).slice(1),d=f.length,m=QM(0,p),h=QM(p+1,p+1+d),g=ZM([c,[u],f]),x=M(t,g),y=M(o,[u]),b=ZM([[p],m,h]),v=Ge(x,b),C=$1(v,y,n.shape[i]),S=Px(b);return C=Ge(C,S),C},indices:()=>o}}};function QM(t,e){let r=[];for(let n=t;n<e;++n)r.push(n);return r}function ZM(t){let e=[];for(let r=0;r<t.length;++r)for(let n=0;n<t[r].length;++n)e.push(t[r][n]);return e}var e3={kernelName:Ma,inputsToSave:["a","b"],gradFunc:(t,e)=>{let[r,n]=e;return{a:()=>_e(r),b:()=>_e(n)}}};var t3={kernelName:Oi,gradFunc:t=>({x:()=>oe(t,"float32")})};var r3={kernelName:za,gradFunc:t=>({x:()=>_e(t)})};var n3={kernelName:Ba,gradFunc:t=>({x:()=>_e(t)})};var o3={kernelName:Va,gradFunc:t=>({x:()=>_e(t)})};var s3={kernelName:Lu,inputsToSave:["x"],gradFunc:(t,e,r)=>{let[n]=e,{alpha:o}=r,s=er(n,0);return{x:()=>Bt(s,t,L(t,o))}}};var i3={kernelName:Ga,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>xe(t,te(r,1))}}};var a3={kernelName:Wa,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>xe(t,oe(r,"float32"))}}};var l3={kernelName:OF,inputsToSave:[],outputsToSave:[!0],gradFunc:(t,e,r)=>{let[n]=e,{axis:o}=r;return{logits:()=>{let i=xn(n);return Ce(t,L(ye(t,o,!0),i))}}}};function Fne(t,e,r,n=5,o=1,s=1,i=.5){let a={x:t,y:e,dy:r},l={depthRadius:n,bias:o,alpha:s,beta:i};return E.runKernel(om,a,l)}var u3=_({localResponseNormalizationBackprop_:Fne});var c3={kernelName:Mu,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,r)=>{let[n,o]=e,{depthRadius:s,bias:i,alpha:a,beta:l}=r;return{x:()=>u3(n,o,t,s,i,a,l)}}};function W1(t,e,r,n){return e.rank<r.rank&&(e=M(e,Gi(e.shape,n))),t.rank<r.rank&&(t=M(t,Gi(t.shape,n))),{x:()=>L(t,oe(Hn(r,e),t.dtype))}}var aE={kernelName:zu,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,r)=>{let n=r,{reductionIndices:o}=n,s=e[0],i=e[1],a=Ar(o,s.shape),l=W1(t,i,s,a);return{x:()=>l.x()}}};var p3={kernelName:Ua,inputsToSave:["a","b"],gradFunc:(t,e)=>{let[r,n]=e;return{a:()=>L(t,oe(io(r,n),"float32")),b:()=>L(t,oe(T1(r,n),"float32"))}}};function Pne(t,e,r,n,o,s,i){let a=I(t,"dy","maxPool3dGrad"),l=I(e,"input","maxPool3dGrad"),u=I(r,"output","maxPool3dGrad"),c=a,p=l,f=u,d=!1;l.rank===4&&(d=!0,c=M(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),p=M(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]]),f=M(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]])),A(c.rank===5,()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${c.rank}.`),A(p.rank===5,()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${p.rank}.`),A(f.rank===5,()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${f.rank}.`),It("maxPool3dGrad",s,i);let m={dy:c,input:p,output:f},h={filterSize:n,strides:o,pad:s,dimRoundingMode:i},g=E.runKernel(im,m,h);return d?M(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}var f3=_({maxPool3dGrad_:Pne});var d3={kernelName:Vu,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,r)=>{let[n,o]=e,{filterSize:s,strides:i,pad:a,dimRoundingMode:l}=r;return{x:()=>f3(t,n,o,s,i,a,l)}}};function Lne(t,e,r,n,o,s,i){let a=I(t,"dy","maxPoolGrad"),l=I(e,"input","maxPoolGrad"),u=I(r,"output","maxPoolGrad");A(l.rank===a.rank,()=>`Rank of input (${l.rank}) does not match rank of dy (${a.rank})`),A(a.rank===4,()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`),A(l.rank===4,()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${l.rank}.`),It("maxPoolGrad",s,i);let c={dy:a,input:l,output:u},p={filterSize:n,strides:o,pad:s,dimRoundingMode:i};return E.runKernel(sm,c,p)}var m3=_({maxPoolGrad_:Lne});var h3={kernelName:Bu,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,r)=>{let[n,o]=e,{filterSize:s,strides:i,pad:a}=r;return{x:()=>m3(t,n,o,s,i,a)}}};var g3={kernelName:Wu,inputsToSave:["x"],gradFunc:(t,e,r)=>{let[n]=e,{axis:o}=r,s=Ar(o,n.shape),a=$2(n.shape,s)[1],l=lt(a);return{x:()=>{let c=n.shape.slice();s.forEach(d=>{c[d]=1});let p=M(t,c);return xe(L(p,_o(n.shape,"float32")),l)}}}};var x3={kernelName:Gu,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,r)=>{let n=r,{axis:o}=n,[s,i]=e,a=Ar(o,s.shape),l=W1(t,i,s,a);return{x:()=>l.x()}}};var y3={kernelName:Ha,inputsToSave:["a","b"],gradFunc:(t,e)=>{let[r,n]=e;return{a:()=>L(t,oe(bs(r,n),"float32")),b:()=>L(t,oe(er(r,n),"float32"))}}};var b3={kernelName:Uu,inputsToSave:["x"],gradFunc:(t,e,r)=>{let n=e[0],{paddings:o}=r,s=o.map(i=>i[0]);return{x:()=>et(t,s,n.shape)}}};var v3={kernelName:qa,inputsToSave:["a","b"],gradFunc:(t,e)=>{let[r,n]=e,o=Be(r.shape,n.shape);return{a:()=>{let a=wt(r.shape,o);return a.length>0?M(ye(t,a),r.shape):t},b:()=>{let a=L(t,ot(Cl(xe(r,n)))),l=wt(n.shape,o);return l.length>0?M(ye(a,l),n.shape):a}}}};var w3={kernelName:ja,inputsToSave:["a","b"],gradFunc:(t,e)=>{let[r,n]=e,o=Be(r.shape,n.shape);return{a:()=>{let a=L(t,oe(n,"float32")),l=wt(r.shape,o);return l.length>0?M(ye(a,l),r.shape):a},b:()=>{let a=L(t,oe(r,"float32")),l=wt(n.shape,o);return l.length>0?M(ye(a,l),n.shape):a}}}};var C3={kernelName:Hu,gradFunc:t=>({x:()=>ot(t)})};var S3={kernelName:ju,inputsToSave:["indices"],gradFunc:(t,e)=>{let r=e[0];return{indices:()=>Ot(r.shape,"float32")}}};var k3={kernelName:qu,gradFunc:t=>({x:()=>_e(t)})};var T3={kernelName:Ku,saveAllInputs:!0,gradFunc:(t,e,r)=>{let{axis:n}=r;return Dn(t,n).map(s=>()=>s)}};var lE={kernelName:Xu,inputsToSave:["x"],gradFunc:(t,e,r)=>{let n=e[0],{paddings:o}=r,s=o.map(i=>i[0]);return{x:()=>et(t,s,n.shape)}}};var N3={kernelName:Ka,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(t,e)=>{let[r,n,o]=e,s=r,i=n,a=Be(s.shape,i.shape);return{a:()=>{let c=oe(i,"float32"),p=L(t,L(c,ys(s,Ce(c,Fe(1))))),f=wt(s.shape,a);return f.length>0&&(p=ye(p,f)),M(p,s.shape)},b:()=>{let c=er(s,0),p=Bt(c,qn(s),_e(s)),f=L(t,L(o,p)),d=wt(i.shape,a);return d.length>0&&(f=ye(f,d)),M(f,i.shape)}}}};var I3={kernelName:Yu,inputsToSave:["x","alpha"],gradFunc:(t,e)=>{let[r,n]=e,o=er(r,0);return{x:()=>Bt(o,t,L(t,n)),alpha:()=>{let s=Bt(o,_e(t),L(t,r)),i=wt(n.shape,t.shape);return i.length>0&&(s=ye(s,i)),M(s,n.shape)}}}};function Mne(t,e,r){let n=t.shape.slice();n[r]=1;let o=M(e,n),s=Ox(t,r,!0,!1),i=Ox(t,r,!0,!0),a=L(s,i);return L(o,a)}function zne(t,e,r){let n=t.shape.length,o=n-r.length,s=T.getAxesPermutation(r,n),i=t;s!=null&&(i=Ge(t,s));let a=i.shape.slice(),u=a.splice(n-r.length,r.length).reduce((f,d)=>f*d,1);a.push(u);let c=i.reshape(a),p=Mne(c,e,o);if(p=p.reshape(i.shape),s!=null){let f=T.getUndoAxesPermutation(s);p=Ge(p,f)}return p}var E3={kernelName:Qu,inputsToSave:["x"],gradFunc:(t,e,r)=>{let[n]=e,{axis:o}=r,s=[];return o==null?s=n.shape.map((i,a)=>a):typeof o=="number"?s=[o]:s=o,{x:()=>zne(n,t,s)}}};var _3={kernelName:Da,inputsToSave:["a","b"],gradFunc:(t,e)=>{let[r,n]=e,o=Be(r.shape,n.shape);return{a:()=>{let a=xe(t,oe(n,"float32")),l=wt(r.shape,o);return l.length>0?M(ye(a,l),r.shape):a},b:()=>{let a=L(t,oe(r,"float32")),l=wt(n.shape,o);l.length>0&&(a=M(ye(a,l),n.shape));let u=je(n);return ot(xe(a,oe(u,"float32")))}}}};var A3={kernelName:Xa,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>xe(t,ot(je(r)))}}};var D3={kernelName:Qa,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e,n=L(bs(r,6),si(r));return{x:()=>L(t,oe(n,"float32"))}}};var $3={kernelName:Ya,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>L(t,oe(si(r),"float32"))}}};var R3={kernelName:Zu,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>M(t,r.shape)}}};var O3={kernelName:ec,inputsToSave:["images"],gradFunc:(t,e,r)=>{let[n]=e,o={dy:t,images:n};return{images:()=>E.runKernel(dm,o,r)}}};var F3={kernelName:Ju,inputsToSave:["images"],gradFunc:(t,e,r)=>{let[n]=e,o={dy:t,images:n};return{images:()=>E.runKernel(fm,o,r)}}};var P3={kernelName:tc,gradFunc:(t,e,r)=>{let{dims:n}=r,o=Ar(n,t.shape);return{x:()=>Qo(t,o)}}};var L3={kernelName:Za,gradFunc:t=>({x:()=>_e(t)})};var M3={kernelName:Ja,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>ot(xe(t,L(ys(r,1.5),2)))}}};var z3={kernelName:rc,inputsToSave:["condition"],gradFunc:(t,e)=>{let[r]=e;return{condition:()=>oe(_e(r),"float32"),t:()=>L(t,oe(r,t.dtype)),e:()=>L(t,oe(Mm(r),t.dtype))}}};var B3={kernelName:el,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>{let n=er(r,Fe(0)),o=Fe(nE),s=Fe(oE),i=L(t,s),a=L(L(t,o),xn(oe(r,"float32")));return Bt(n,i,a)}}}};var V3={kernelName:ol,outputsToSave:[!0],gradFunc:(t,e)=>{let[r]=e;return{x:()=>L(t,L(r,Ce(Fe(1),r)))}}};var W3={kernelName:nl,gradFunc:t=>({x:()=>_e(t)})};var G3={kernelName:tl,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>L(Qp(oe(r,"float32")),t)}}};var U3={kernelName:rl,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>L(Rx(oe(r,"float32")),t)}}};var H3={kernelName:nc,inputsToSave:["x"],gradFunc:(t,e,r)=>{let[n]=e,{begin:o,size:s}=r,i=n.shape,[a,l]=u2(n,o,s),u=[];for(let c=0;c<t.rank;c++)u.push([a[c],i[c]-a[c]-l[c]]);return{x:()=>rf(t,u)}}};var q3={kernelName:ac,outputsToSave:[!0],gradFunc:(t,e,r)=>{let[n]=e,{dim:o}=r,s=!0,i=L(t,n);return{logits:()=>Ce(i,L(ye(i,[o],s),n))}}};var j3={kernelName:sl,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>L(t,xs(r))}}};var uE={kernelName:sc,gradFunc:(t,e,r)=>{let{blockShape:n,paddings:o}=r;return{x:()=>Fm(t,n,o)}}};var cE={kernelName:ic,gradFunc:(t,e,r)=>{let{axis:n}=r;return{x:()=>$t(t,n)}}};var K3={kernelName:il,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>xe(t,L(Rt(oe(r,"float32")),2))}}};var X3={kernelName:mm,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>L(t,L(oe(r,"float32"),2))}}};var Y3={kernelName:al,inputsToSave:["a","b"],gradFunc:(t,e)=>{let[r,n]=e,o=Fe(2);return{a:()=>L(t,L(o,Ce(r,n))),b:()=>L(t,L(o,Ce(n,r)))}}};var Q3={kernelName:pl,gradFunc:t=>({x:()=>_e(t)})};var Z3={kernelName:ll,inputsToSave:["a","b"],gradFunc:(t,e)=>{let[r,n]=e,o=Be(r.shape,n.shape);return{a:()=>{let a=t,l=wt(r.shape,o);return l.length>0&&(a=ye(a,l)),M(a,r.shape)},b:()=>{let a=t,l=wt(n.shape,o);return l.length>0&&(a=ye(a,l)),M(ot(a),n.shape)}}}};var J3={kernelName:oc,inputsToSave:["x"],gradFunc:(t,e,r)=>{let[n]=e,o=n.shape.slice(),{axis:s}=r;Ar(s,n.shape).forEach(u=>{o[u]=1});let a=M(t,o),l=L(a,_o(n.shape,"float32"));return{x:()=>l}}};var ez={kernelName:ul,inputsToSave:["x"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>xe(t,je(Qp(r)))}}};var tz={kernelName:cl,outputsToSave:[!0],gradFunc:(t,e)=>{let[r]=e;return{x:()=>L(Ce(Fe(1),je(r)),t)}}};var rz={kernelName:Fi,inputsToSave:["x"],gradFunc:(t,e,r)=>{let[n]=e,{reps:o}=r;return{x:()=>{let i=_e(n);if(n.rank===1)for(let a=0;a<o[0];++a)i=te(i,et(t,[a*n.shape[0]],[n.shape[0]]));else if(n.rank===2)for(let a=0;a<o[0];++a)for(let l=0;l<o[1];++l)i=te(i,et(t,[a*n.shape[0],l*n.shape[1]],[n.shape[0],n.shape[1]]));else if(n.rank===3)for(let a=0;a<o[0];++a)for(let l=0;l<o[1];++l)for(let u=0;u<o[2];++u)i=te(i,et(t,[a*n.shape[0],l*n.shape[1],u*n.shape[2]],[n.shape[0],n.shape[1],n.shape[2]]));else if(n.rank===4)for(let a=0;a<o[0];++a)for(let l=0;l<o[1];++l)for(let u=0;u<o[2];++u)for(let c=0;c<o[3];++c)i=te(i,et(t,[a*n.shape[0],l*n.shape[1],u*n.shape[2],c*n.shape[3]],[n.shape[0],n.shape[1],n.shape[2],n.shape[3]]));else throw new Error(`Gradient for tile operation is not implemented for rank-${n.rank} tensors yet.`);return i}}}};var nz={kernelName:Pi,gradFunc:(t,e,r)=>{let n=r,{perm:o}=n,s=Px(o);return{x:()=>Ge(t,s)}}};var oz={kernelName:lc,gradFunc:(t,e,r)=>{let n=r,{axis:o}=n;return{value:()=>Lr(t,o)}}};var sz={kernelName:uc,inputsToSave:["segmentIds"],gradFunc:(t,e)=>{let[r]=e;return{x:()=>Bne(t,r)}}};function Bne(t,e){let r=Eo(e,_e(e)),n=Zp(t,r),o=io(e,Fe(0,"int32")),s=n.rank-o.rank;for(let a=0;a<s;++a)o=Dr(o,a+1);o=An(o,_o(n.shape,"bool"));let i=_e(n);return Bt(o,n,i)}var iz={kernelName:cc,gradFunc:t=>({x:()=>_e(t)})};var Vne=[V1,pM,fM,dM,mM,hM,gM,xM,yM,bM,vM,wM,SM,TM,NM,IM,EM,_M,AM,DM,$M,RM,FM,OM,LM,MM,zM,BM,VM,WM,_3,GM,UM,HM,qM,jM,XM,KM,YM,JM,e3,t3,r3,n3,o3,s3,i3,a3,l3,c3,aE,aE,p3,d3,h3,g3,x3,y3,b3,v3,w3,C3,S3,k3,T3,lE,lE,N3,I3,E3,A3,D3,$3,R3,O3,F3,P3,L3,M3,z3,B3,V3,W3,G3,U3,H3,q3,j3,uE,uE,cE,cE,K3,Y3,X3,Q3,Z3,J3,ez,tz,rz,nz,oz,sz,iz];for(let t of Vne)PF(t);F().prototype.abs=function(){return this.throwIfDisposed(),Sr(this)};F().prototype.acos=function(){return this.throwIfDisposed(),c2(this)};F().prototype.acosh=function(){return this.throwIfDisposed(),p2(this)};F().prototype.add=function(t){return this.throwIfDisposed(),te(this,t)};F().prototype.all=function(t,e){return this.throwIfDisposed(),Ax(this,t,e)};F().prototype.any=function(t,e){return this.throwIfDisposed(),$m(this,t,e)};F().prototype.argMax=function(t){return this.throwIfDisposed(),xl(this,t)};F().prototype.argMin=function(t){return this.throwIfDisposed(),JP(this,t)};F().prototype.asScalar=function(){return this.throwIfDisposed(),A(this.size===1,()=>"The array must have only 1 element."),M(this,[])};F().prototype.asType=function(t){return this.throwIfDisposed(),oe(this,t)};F().prototype.as1D=function(){return this.throwIfDisposed(),M(this,[this.size])};F().prototype.as2D=function(t,e){return this.throwIfDisposed(),M(this,[t,e])};F().prototype.as3D=function(t,e,r){return this.throwIfDisposed(),M(this,[t,e,r])};F().prototype.as4D=function(t,e,r,n){return this.throwIfDisposed(),M(this,[t,e,r,n])};F().prototype.as5D=function(t,e,r,n,o){return this.throwIfDisposed(),M(this,[t,e,r,n,o])};F().prototype.asin=function(){return this.throwIfDisposed(),f2(this)};F().prototype.asinh=function(){return this.throwIfDisposed(),d2(this)};F().prototype.atan=function(){return this.throwIfDisposed(),m2(this)};F().prototype.atan2=function(t){return this.throwIfDisposed(),eL(this,t)};F().prototype.atanh=function(){return this.throwIfDisposed(),h2(this)};F().prototype.avgPool=function(t,e,r,n){return this.throwIfDisposed(),Yp(this,t,e,r,n)};F().prototype.batchToSpaceND=function(t,e){return this.throwIfDisposed(),Fm(this,t,e)};F().prototype.batchNorm=function(t,e,r,n,o){return this.throwIfDisposed(),hc(this,t,e,r,n,o)};F().prototype.broadcastTo=function(t){return this.throwIfDisposed(),yl(this,t)};F().prototype.cast=function(t){return this.throwIfDisposed(),oe(this,t)};F().prototype.ceil=function(){return this.throwIfDisposed(),S2(this)};F().prototype.clipByValue=function(t,e){return this.throwIfDisposed(),sn(this,t,e)};F().prototype.concat=function(t,e){return this.throwIfDisposed(),t instanceof Ze&&(t=[t]),$t([this,...t],e)};F().prototype.conv1d=function(t,e,r,n,o,s){return this.throwIfDisposed(),Dx(this,t,e,r,n,o,s)};F().prototype.conv2dTranspose=function(t,e,r,n,o){return this.throwIfDisposed(),$x(this,t,e,r,n,o)};F().prototype.conv2d=function(t,e,r,n,o,s){return this.throwIfDisposed(),Io(this,t,e,r,n,o,s)};F().prototype.cos=function(){return this.throwIfDisposed(),Qp(this)};F().prototype.cosh=function(){return this.throwIfDisposed(),Rx(this)};F().prototype.cumprod=function(t,e,r){return this.throwIfDisposed(),Ox(this,t,e,r)};F().prototype.cumsum=function(t,e,r){return this.throwIfDisposed(),S1(this,t,e,r)};F().prototype.depthToSpace=function(t,e){return this.throwIfDisposed(),sL(this,t,e)};F().prototype.depthwiseConv2d=function(t,e,r,n,o,s){return this.throwIfDisposed(),vl(this,t,e,r,n,o,s)};F().prototype.dilation2d=function(t,e,r,n,o){return this.throwIfDisposed(),iL(this,t,e,r,n,o)};F().prototype.divNoNan=function(t){return this.throwIfDisposed(),aL(this,t)};F().prototype.div=function(t){return this.throwIfDisposed(),xe(this,t)};F().prototype.dot=function(t){return this.throwIfDisposed(),lL(this,t)};F().prototype.elu=function(){return this.throwIfDisposed(),wl(this)};F().prototype.equal=function(t){return this.throwIfDisposed(),Hn(this,t)};F().prototype.erf=function(){return this.throwIfDisposed(),A2(this)};F().prototype.euclideanNorm=function(t,e){return this.throwIfDisposed(),pL(this,t,e)};F().prototype.exp=function(){return this.throwIfDisposed(),xn(this)};F().prototype.expandDims=function(t){return this.throwIfDisposed(),Dr(this,t)};F().prototype.expm1=function(){return this.throwIfDisposed(),F2(this)};F().prototype.fft=function(){return this.throwIfDisposed(),Kx(this)};F().prototype.flatten=function(){return this.throwIfDisposed(),M(this,[this.size])};F().prototype.floor=function(){return this.throwIfDisposed(),Cl(this)};F().prototype.floorDiv=function(t){return this.throwIfDisposed(),v1(this,t)};F().prototype.gather=function(t,e){return this.throwIfDisposed(),Zp(this,t,e)};F().prototype.greaterEqual=function(t){return this.throwIfDisposed(),io(this,t)};F().prototype.greater=function(t){return this.throwIfDisposed(),er(this,t)};F().prototype.ifft=function(){return this.throwIfDisposed(),Gm(this)};F().prototype.irfft=function(){return this.throwIfDisposed(),Q2(this)};F().prototype.isFinite=function(){return this.throwIfDisposed(),P2(this)};F().prototype.isInf=function(){return this.throwIfDisposed(),L2(this)};F().prototype.isNaN=function(){return this.throwIfDisposed(),M2(this)};F().prototype.leakyRelu=function(t){return this.throwIfDisposed(),Jp(this,t)};F().prototype.lessEqual=function(t){return this.throwIfDisposed(),bs(this,t)};F().prototype.less=function(t){return this.throwIfDisposed(),T1(this,t)};F().prototype.localResponseNormalization=function(t,e,r,n){return this.throwIfDisposed(),fL(this,t,e,r,n)};F().prototype.logSigmoid=function(){return this.throwIfDisposed(),B2(this)};F().prototype.logSoftmax=function(t){return this.throwIfDisposed(),Mx(this,t)};F().prototype.logSumExp=function(t,e){return this.throwIfDisposed(),dL(this,t,e)};F().prototype.log=function(){return this.throwIfDisposed(),qn(this)};F().prototype.log1p=function(){return this.throwIfDisposed(),Lx(this)};F().prototype.logicalAnd=function(t){return this.throwIfDisposed(),An(this,t)};F().prototype.logicalNot=function(){return this.throwIfDisposed(),Mm(this)};F().prototype.logicalOr=function(t){return this.throwIfDisposed(),N1(this,t)};F().prototype.logicalXor=function(t){return this.throwIfDisposed(),mL(this,t)};F().prototype.matMul=function(t,e,r){return this.throwIfDisposed(),nt(this,t,e,r)};F().prototype.maxPool=function(t,e,r,n){return this.throwIfDisposed(),ef(this,t,e,r,n)};F().prototype.max=function(t,e){return this.throwIfDisposed(),an(this,t,e)};F().prototype.maximum=function(t){return this.throwIfDisposed(),Eo(this,t)};F().prototype.mean=function(t,e){return this.throwIfDisposed(),Vt(this,t,e)};F().prototype.min=function(t,e){return this.throwIfDisposed(),gc(this,t,e)};F().prototype.minimum=function(t){return this.throwIfDisposed(),tf(this,t)};F().prototype.mirrorPad=function(t,e){return this.throwIfDisposed(),hL(this,t,e)};F().prototype.mod=function(t){return this.throwIfDisposed(),gL(this,t)};F().prototype.mul=function(t){return this.throwIfDisposed(),L(this,t)};F().prototype.neg=function(){return this.throwIfDisposed(),ot(this)};F().prototype.norm=function(t,e,r){return this.throwIfDisposed(),xc(this,t,e,r)};F().prototype.notEqual=function(t){return this.throwIfDisposed(),yc(this,t)};F().prototype.oneHot=function(t,e=1,r=0){return this.throwIfDisposed(),Am(this,t,e,r)};F().prototype.onesLike=function(){return this.throwIfDisposed(),Hr(this)};F().prototype.pad=function(t,e){return this.throwIfDisposed(),rf(this,t,e)};F().prototype.pool=function(t,e,r,n,o,s){return this.throwIfDisposed(),xL(this,t,e,r,n,o,s)};F().prototype.pow=function(t){return this.throwIfDisposed(),ys(this,t)};F().prototype.prelu=function(t){return this.throwIfDisposed(),nf(this,t)};F().prototype.prod=function(t,e){return this.throwIfDisposed(),yL(this,t,e)};F().prototype.reciprocal=function(){return this.throwIfDisposed(),X2(this)};F().prototype.relu=function(){return this.throwIfDisposed(),Ao(this)};F().prototype.relu6=function(){return this.throwIfDisposed(),A1(this)};F().prototype.reshapeAs=function(t){return this.throwIfDisposed(),M(this,t.shape)};F().prototype.reshape=function(t){return this.throwIfDisposed(),M(this,t)};F().prototype.resizeBilinear=function(t,e,r){return this.throwIfDisposed(),M1(this,t,e,r)};F().prototype.resizeNearestNeighbor=function(t,e,r){return this.throwIfDisposed(),z1(this,t,e,r)};F().prototype.reverse=function(t){return this.throwIfDisposed(),Qo(this,t)};F().prototype.rfft=function(){return this.throwIfDisposed(),Z2(this)};F().prototype.round=function(){return this.throwIfDisposed(),Bx(this)};F().prototype.rsqrt=function(){return this.throwIfDisposed(),Vx(this)};F().prototype.selu=function(){return this.throwIfDisposed(),Wx(this)};F().prototype.separableConv2d=function(t,e,r,n,o,s){return this.throwIfDisposed(),Gx(this,t,e,r,n,o,s)};F().prototype.sigmoid=function(){return this.throwIfDisposed(),xs(this)};F().prototype.sign=function(){return this.throwIfDisposed(),Y2(this)};F().prototype.sin=function(){return this.throwIfDisposed(),Ux(this)};F().prototype.sinh=function(){return this.throwIfDisposed(),Hx(this)};F().prototype.slice=function(t,e){return this.throwIfDisposed(),et(this,t,e)};F().prototype.softmax=function(t){return this.throwIfDisposed(),sf(this,t)};F().prototype.softplus=function(){return this.throwIfDisposed(),Ui(this)};F().prototype.spaceToBatchND=function(t,e){return this.throwIfDisposed(),Bm(this,t,e)};F().prototype.split=function(t,e){return this.throwIfDisposed(),Pr(this,t,e)};F().prototype.sqrt=function(){return this.throwIfDisposed(),Rt(this)};F().prototype.square=function(){return this.throwIfDisposed(),je(this)};F().prototype.squaredDifference=function(t){return this.throwIfDisposed(),FL(this,t)};F().prototype.squeeze=function(t){return this.throwIfDisposed(),oi(this,t)};F().prototype.stack=function(t,e){this.throwIfDisposed();let r=t instanceof Ze?[this,t]:[this,...t];return Lr(r,e)};F().prototype.step=function(t){return this.throwIfDisposed(),si(this,t)};F().prototype.stridedSlice=function(t,e,r,n,o,s,i,a){return this.throwIfDisposed(),J2(this,t,e,r,n,o,s,i,a)};F().prototype.sub=function(t){return this.throwIfDisposed(),Ce(this,t)};F().prototype.sum=function(t,e){return this.throwIfDisposed(),ye(this,t,e)};F().prototype.tan=function(){return this.throwIfDisposed(),eE(this)};F().prototype.tanh=function(){return this.throwIfDisposed(),Om(this)};F().prototype.tile=function(t){return this.throwIfDisposed(),yn(this,t)};F().prototype.toBool=function(){return this.throwIfDisposed(),oe(this,"bool")};F().prototype.toFloat=function(){return this.throwIfDisposed(),oe(this,"float32")};F().prototype.toInt=function(){return this.throwIfDisposed(),oe(this,"int32")};F().prototype.topk=function(t,e){return this.throwIfDisposed(),PL(this,t,e)};F().prototype.transpose=function(t){return this.throwIfDisposed(),Ge(this,t)};F().prototype.unique=function(t){return this.throwIfDisposed(),LL(this,t)};F().prototype.unsortedSegmentSum=function(t,e){return this.throwIfDisposed(),$1(this,t,e)};F().prototype.unstack=function(t){return this.throwIfDisposed(),Dn(this,t)};F().prototype.where=function(t,e){return this.throwIfDisposed(),Bt(t,this,e)};F().prototype.zerosLike=function(){return this.throwIfDisposed(),_e(this)};var ao=class extends Error{constructor(e){super(e),Object.setPrototypeOf(this,ao.prototype)}},wn=class extends Error{constructor(e){super(e),Object.setPrototypeOf(this,wn.prototype)}},z=class extends Error{constructor(e){super(e),Object.setPrototypeOf(this,z.prototype)}},$e=class extends Error{constructor(e){super(e),Object.setPrototypeOf(this,$e.prototype)}},Qm=class extends Error{constructor(e){super(e),Object.setPrototypeOf(this,Qm.prototype)}};var Zx=class{constructor(e){this.maxEntries=e||100,this.cache=new Map}get(e){let r;return this.cache.has(e)&&(r=this.cache.get(e),this.cache.delete(e),this.cache.set(e,r)),r}put(e,r){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){let n=this.cache.keys().next().value;this.cache.delete(n)}this.cache.set(e,r)}getMaxEntries(){return this.maxEntries}setMaxEntries(e){if(e<0)throw new Error(`The maxEntries of LRU caches must be at least 0, but got ${e}.`);if(this.maxEntries>e)for(let r=0;r<this.maxEntries-e;r++){let n=this.cache.keys().next().value;this.cache.delete(n)}this.maxEntries=e}};function Cs(t,e){if(Array.isArray(t)){let r=[];for(let n=0;n<e;n++)r=r.concat(t);return r}else{let r=new Array(e);return r.fill(t),r}}function Zo(t,e){if(!t)throw new Qm(e)}function fE(t,e){let r=0;for(let n of t)n===e&&r++;return r}function qr(t){return t.length===1?t[0]:t}function Ct(t){return Array.isArray(t)?t:[t]}function Ss(t){let r=t.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return r[0]!=="_"?r:"private"+r}function Tl(t){return t.length<=1||t.indexOf("_")===-1?t:t.replace(/[_]+(\w|$)/g,(e,r)=>r.toUpperCase())}var ws={};function Zm(t){if(t==null)return null;let e={};return e.className=t.getClassName(),e.config=t.getConfig(),e}function pE(t){if(!(t==null||typeof t!="object"))if(Array.isArray(t))t.forEach(e=>pE(e));else{let e=Object.keys(t);for(let r of e){let n=t[r];n!=null&&typeof n=="object"&&(!Array.isArray(n)&&n.type==="ndarray"&&typeof n.value=="number"?t[r]=n.value:pE(n))}}}function ji(t,e={},r={},n="object",o=!1){if(typeof t=="string"){let s=t,i;if(s in r)i=r[s];else if(s in ws)i=ws[s];else if(i=e[s],i==null)throw new z(`Unknown ${n}: ${t}. This may be due to one of the following reasons:
1. The ${n} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${n} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return i}else{let s=t;if(s.className==null||s.config==null)throw new z(`${n}: Improper config format: ${JSON.stringify(s)}.
'className' and 'config' must set.`);let i=s.className,a,l;if(i in r?[a,l]=r[i]:i in ws?[a,l]=ws.className:i in e&&([a,l]=e[i]),a==null)throw new z(`Unknown ${n}: ${i}. This may be due to one of the following reasons:
1. The ${n} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.
2. The custom ${n} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(l!=null){let u={};for(let d of Object.keys(ws))u[d]=ws[d];for(let d of Object.keys(r))u[d]=r[d];let c=s.config;c.customObjects=u;let p=Object.assign({},ws);for(let d of Object.keys(r))ws[d]=r[d];pE(s.config);let f=l(a,s.config,r,o);return ws=Object.assign({},p),f}else{let u=Object.assign({},ws);for(let p of Object.keys(r))ws[p]=r[p];let c=new a(s.config);return ws=Object.assign({},u),c}}}function Wne(t,e){return t<e?-1:t>e?1:0}function Jx(t,e){return-1*Wne(t,e)}function ks(t){if(t==null)return t;let e=[];for(let r of t)e.indexOf(r)===-1&&e.push(r);return e}function az(t){if(t==null)throw new z(`Invalid value in obj: ${JSON.stringify(t)}`);for(let e in t)if(t.hasOwnProperty(e))return!1;return!0}function Ki(t,e,r){if(r!=null&&t.indexOf(r)<0)throw new z(`${r} is not a valid ${e}.  Valid values are ${t} or null/undefined.`)}function G1(t,e,r=0,n=1/0){return Zo(r>=0),Zo(n>=r),Array.isArray(t)&&t.length>=r&&t.length<=n&&t.every(o=>typeof o===e)}function ir(t,e){Array.isArray(t)?(w.assert(t.length>0,()=>`${e} is unexpectedly an empty array.`),t.forEach((r,n)=>ir(r,`element ${n+1} of ${e}`))):w.assert(Number.isInteger(t)&&t>0,()=>`Expected ${e} to be a positive integer, but got ${lz(t)}.`)}function lz(t){return t===null?"null":Array.isArray(t)?"["+t.map(e=>lz(e)).join(",")+"]":typeof t=="string"?`"${t}"`:`${t}`}function uz(t,e,r){let n=r!=null?r():w.now(),o;return(...i)=>{let a=r!=null?r():w.now();return a-n<e||(n=a,o=t(...i)),o}}function U1(t){return t==="relu"?"relu":t==="linear"?"linear":t==="elu"?"elu":null}var Gne=0;function q1(){return Gne++}var H1={};function vc(t=""){return t in H1||(H1[t]=0),H1[t]+=1,t+H1[t].toString()}var cz=["channelsFirst","channelsLast"],pz=["nearest","bilinear"],fz=["valid","same","causal"],dz=["max","avg"],mz=["sum","mul","concat","ave"];var Jm=new Map;function Wt(t){Ki(cz,"DataFormat",t)}function gz(t){Ki(pz,"InterpolationFormat",t)}function jn(t){Ki(fz,"PaddingMode",t)}function dE(t){Ki(dz,"PoolMode",t)}var ey=[],hz="/";function li(t,e){ey.push(t);try{let r=e();return ey.pop(),r}catch(r){throw ey.pop(),r}}function Une(){return ey.length===0?"":ey.join(hz)+hz}function j1(t){if(!xz(t))throw new Error("Not a valid tensor name: '"+t+"'");return Une()+t}function K1(t){if(!xz(t))throw new Error("Not a valid tensor name: '"+t+"'");Jm.has(t)||Jm.set(t,0);let e=Jm.get(t);if(Jm.set(t,Jm.get(t)+1),e>0){let r=`${t}_${e}`;return Jm.set(r,1),r}else return t}var Hne=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function xz(t){return!!t.match(Hne)}function yz(t){return t===parseInt(t.toString(),10)}function Ts(t,e,r){e==null&&(e=0),r==null&&(r=t.length);let n=1;for(let o=e;o<r;++o)n*=t[o];return n}function df(t){if(t.length===0)return Number.NaN;let e=Number.POSITIVE_INFINITY;for(let r=0;r<t.length;r++){let n=t[r];n<e&&(e=n)}return e}function ui(t){if(t.length===0)return Number.NaN;let e=Number.NEGATIVE_INFINITY;for(let r=0;r<t.length;r++){let n=t[r];n>e&&(e=n)}return e}function Kn(t,e){if(e<t)throw new z(`end (${e}) < begin (${t}) is forbidden.`);let r=[];for(let n=t;n<e;++n)r.push(n);return r}var mE;function kr(){return mE==null&&(mE=zP().epsilon()),mE}function Xn(){return"channelsLast"}function $n(t,e){return oe(t,e)}function Il(t,e=-1){let r=t.shape.slice();return e<0&&(e=r.length+e+1),r.splice(e,0,1),M(t,r)}function bz(t,e){return U(()=>{if(t.shape.length!==2)throw new z(`repeat() expects a rank-2 tensor, but received a rank-${t.shape.length} tensor.`);let r=Il(t,1);return Y1(r,[1,e,1])})}function vz(t){let e=[Ts(t.shape)];return M(t,e)}function wz(t){if(t.rank<=1)throw new z(`batchFlatten requires a minimum rank of 2. Got rank: ${t.rank}.`);let e=[t.shape[0],Ts(t.shape,1)];return M(t,e)}function Nl(t,e,r){return U(()=>{switch(t.rank){case 1:return qx(t,e,r);case 2:return D1(t,[e,0],[r,t.shape[1]]);case 3:return jx(t,[e,0,0],[r,t.shape[1],t.shape[2]]);case 4:return Wm(t,[e,0,0,0],[r,t.shape[1],t.shape[2],t.shape[3]]);case 5:return et(t,[e,0,0,0,0],[r,t.shape[1],t.shape[2],t.shape[3],t.shape[4]]);case 6:return et(t,[e,0,0,0,0,0],[r,t.shape[1],t.shape[2],t.shape[3],t.shape[4],t.shape[5]]);default:throw new z(`sliceAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}})}function hE(t,e,r){return U(()=>{switch(t.rank){case 1:return qx(t,e,r);case 2:return D1(t,[0,e],[t.shape[0],r]);case 3:return jx(t,[0,0,e],[t.shape[0],t.shape[1],r]);case 4:return Wm(t,[0,0,0,e],[t.shape[0],t.shape[1],t.shape[2],r]);default:throw new z(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}})}function ty(t,e,r,n){return U(()=>{switch(t.rank){case 1:return qx(t,e,r);case 2:switch(n){case 1:return Nl(t,e,r);case 2:return hE(t,e,r);default:throw new z(`The axis is not within the rank of the tensor ${n}`)}case 3:switch(n){case 1:return Nl(t,e,r);case 2:return jx(t,[0,e,0],[t.shape[0],r,t.shape[2]]);case 3:return hE(t,e,r);default:throw new z(`The axis is not within the rank of the tensor ${n}`)}case 4:switch(n){case 1:return Nl(t,e,r);case 2:return Wm(t,[0,e,0,0],[t.shape[0],r,t.shape[2],t.shape[3]]);case 3:return Wm(t,[0,0,e,0],[t.shape[0],t.shape[1],r,t.shape[3]]);case 4:return hE(t,e,r);default:throw new z(`The axis is not within the rank of the tensor ${n}`)}default:throw new z(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}})}function eh(t,e=-1){let r;return e<0&&(r=t[0].rank,r!==0?e=r:e=0),e===t[0].rank&&(e=-1),$t(t,e)}function xE(t,e){switch(t.rank){case 1:return k2([t,e]);case 2:return T2([t,e],0);case 3:return N2([t,e],0);case 4:return I2([t,e],0);default:throw new z(`concatAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}}function Y1(t,e){if(Array.isArray(e)||(e=[e]),t.rank!==e.length)throw new z(`The length of input n (${e.length}) does not match the number of dimensions in input x (${t.rank})`);return yn(t,e)}function th(t,e=0,r=1,n,o){return _1(t,e,r,n,o)}function Ns(t,e,r,n){if(t.rank<2||e.rank<2)throw new $e(`dot requires both inputs to be rank >= 2 but got x shape = ${t.shape} and y shape = ${e.shape}`);if(e.rank>=3){let o=t.shape.slice(-1)[0],s=e.shape.slice(-2)[0];if(o!==s)throw new $e(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${t.shape} and  y shape = ${e.shape}`)}if(t.rank===2&&e.rank===2)return pf.matMul({a:t,b:e,transposeA:!1,transposeB:!1,bias:n?gE(t.rank,n,Xn()):null,activation:r});{let o=t.shape.slice(),s=o.pop();t=M(t,[-1,s]);let i=e.shape.slice(),a=i.pop(),l=i.pop(),u=[...i,a],c=Array.from({length:e.rank},(m,h)=>h===0?e.rank-2:h<=e.rank-2?h-1:h);e=M(Ge(e,c),[l,-1]);let p=[...o,...u],f=!1,d=!1;return M(pf.matMul({a:t,b:e,transposeA:f,transposeB:d,bias:n?gE(t.rank,n,Xn()):null,activation:r}),p)}}function Q1(t,e,r){return U(()=>(Array.isArray(e)?e=$r(e,"int32"):e=oe(e,"int32"),Zp(t,e,r)))}function mf(t){return L(t,t)}function gE(t,e,r){let n=e.shape;if(e.rank!==1&&e.rank!==t)throw new z(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${t}`);if(t===5){if(r==="channelsFirst")return n.length===1?M(e,[1,n[0],1,1,1]):M(e,[1,n[3],n[0],n[1],n[2]]);if(r==="channelsLast")return n.length===1?M(e,[1,1,1,1,n[0]]):M(e,[1].concat(n))}else if(t===4){if(r==="channelsFirst")return n.length===1?M(e,[1,n[0],1,1]):M(e,[1,n[2],n[0],n[1]]);if(r==="channelsLast")return n.length===1?M(e,[1,1,1,n[0]]):M(e,[1].concat(n))}else if(t===3){if(r==="channelsFirst")return n.length===1?M(e,[1,n[0],1]):M(e,[1,n[1],n[0]]);if(r==="channelsLast")return n.length===1?M(e,[1,1,n[0]]):M(e,[1].concat(n))}else if(t<3)return e;throw new z(`Unsupported input rank by biasAdd: ${e.rank}`)}function Yn(t,e,r){return U(()=>(r==null&&(r=Xn()),Wt(r),te(t,gE(t.rank,e,r))))}function Cz(t,e=1){if(e!==1)throw new $e(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return wl(t)}function Sz(t){return U(()=>xe(t,te(Sr(t),1)))}function Z1(t,e,r,n){return U(()=>BL(t,e,r,n))}function kz(t){return U(()=>{let e=te(.5,L(.2,t));return sn(e,0,1)})}function wc(t,e,r=!1){return r?t():e()}var Tz=["fanIn","fanOut","fanAvg"],Nz=["normal","uniform","truncatedNormal"];function qne(t){Ki(Tz,"FanMode",t)}function jne(t){Ki(Nz,"Distribution",t)}var Qn=class extends J.Serializable{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}},ry=class extends Qn{apply(e,r){return Ot(e,r)}};ry.className="Zeros";J.registerClass(ry);var hf=class extends Qn{apply(e,r){return _o(e,r)}};hf.className="Ones";J.registerClass(hf);var ny=class extends Qn{constructor(e){if(super(),typeof e!="object")throw new z(`Expected argument of type ConstantConfig but got ${e}`);if(e.value===void 0)throw new z(`config must have value set but got ${e}`);this.value=e.value}apply(e,r){return U(()=>L(Fe(this.value),_o(e,r)))}getConfig(){return{value:this.value}}};ny.className="Constant";J.registerClass(ny);var oy=class extends Qn{constructor(e){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=e.minval||this.DEFAULT_MINVAL,this.maxval=e.maxval||this.DEFAULT_MAXVAL,this.seed=e.seed}apply(e,r){return Sl(e,this.minval,this.maxval,r)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}};oy.className="RandomUniform";J.registerClass(oy);var sy=class extends Qn{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,r){if(r=r||"float32",r!=="float32"&&r!=="int32")throw new $e(`randomNormal does not support dType ${r}.`);return th(e,this.mean,this.stddev,r,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}};sy.className="RandomNormal";J.registerClass(sy);var iy=class extends Qn{constructor(e){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=e.mean||this.DEFAULT_MEAN,this.stddev=e.stddev||this.DEFAULT_STDDEV,this.seed=e.seed}apply(e,r){if(r=r||"float32",r!=="float32"&&r!=="int32")throw new $e(`truncatedNormal does not support dType ${r}.`);return Yx(e,this.mean,this.stddev,r,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}};iy.className="TruncatedNormal";J.registerClass(iy);var ay=class extends Qn{constructor(e){super(),this.gain=e.gain!=null?e.gain:1}apply(e,r){return U(()=>{if(e.length!==2||e[0]!==e[1])throw new z("Identity matrix initializer can only be used for 2D square matrices.");return L(this.gain,Lm(e[0]))})}getConfig(){return{gain:this.gain}}};ay.className="Identity";J.registerClass(ay);function Kne(t,e="channelsLast"){let r,n;if(Wt(e),t.length===2)r=t[0],n=t[1];else if([3,4,5].indexOf(t.length)!==-1){if(e==="channelsFirst"){let o=Ts(t,2);r=t[1]*o,n=t[0]*o}else if(e==="channelsLast"){let o=Ts(t,0,t.length-2);r=t[t.length-2]*o,n=t[t.length-1]*o}}else{let o=Ts(t);r=Math.sqrt(o),n=Math.sqrt(o)}return[r,n]}var Rn=class extends Qn{constructor(e){if(super(),e.scale<0)throw new z(`scale must be a positive float. Got: ${e.scale}`);this.scale=e.scale==null?1:e.scale,this.mode=e.mode==null?"fanIn":e.mode,qne(this.mode),this.distribution=e.distribution==null?"normal":e.distribution,jne(this.distribution),this.seed=e.seed}apply(e,r){let n=Kne(e),o=n[0],s=n[1],i=this.scale;if(this.mode==="fanIn"?i/=Math.max(1,o):this.mode==="fanOut"?i/=Math.max(1,s):i/=Math.max(1,(o+s)/2),this.distribution==="normal"){let a=Math.sqrt(i);if(r=r||"float32",r!=="float32"&&r!=="int32")throw new $e(`${this.getClassName()} does not support dType ${r}.`);return Yx(e,0,a,r,this.seed)}else{let a=Math.sqrt(3*i);return Sl(e,-a,a,r)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}};Rn.className="VarianceScaling";J.registerClass(Rn);var rh=class extends Rn{constructor(e){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Rn.className}};rh.className="GlorotUniform";J.registerClass(rh);var nh=class extends Rn{constructor(e){super({scale:1,mode:"fanAvg",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Rn.className}};nh.className="GlorotNormal";J.registerClass(nh);var oh=class extends Rn{constructor(e){super({scale:2,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Rn.className}};oh.className="HeNormal";J.registerClass(oh);var sh=class extends Rn{constructor(e){super({scale:2,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Rn.className}};sh.className="HeUniform";J.registerClass(sh);var ih=class extends Rn{constructor(e){super({scale:1,mode:"fanIn",distribution:"normal",seed:e==null?null:e.seed})}getClassName(){return Rn.className}};ih.className="LeCunNormal";J.registerClass(ih);var ah=class extends Rn{constructor(e){super({scale:1,mode:"fanIn",distribution:"uniform",seed:e==null?null:e.seed})}getClassName(){return Rn.className}};ah.className="LeCunNormal";J.registerClass(ah);var ly=class extends Qn{constructor(e){if(super(),this.DEFAULT_GAIN=1,this.gain=e.gain==null?this.DEFAULT_GAIN:e.gain,this.seed=e.seed,this.seed!=null)throw new $e("Random seed is not implemented for Orthogonal Initializer yet.")}apply(e,r){return U(()=>{if(e.length<2)throw new $e("Shape must be at least 2D.");e[0]*e[1]>2e3&&console.warn(`Orthogonal initializer is being called on a matrix with more than 2000 (${e[0]*e[1]}) elements: Slowness may result.`);let n=e[0]>e[1]?[e[1],e[0]]:e,o=th(n,0,1,"float32"),s=lM.gramSchmidt(o);return e[0]>e[1]&&(s=Ge(s)),L(this.gain,s)})}getConfig(){return{gain:this.gain,seed:this.seed}}};ly.className="Orthogonal";J.registerClass(ly);var Iz={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function Ez(t,e={}){return ji(t,J.SerializationMap.getMap().classNameMap,e,"initializer")}function Et(t){return Zm(t)}function xt(t){if(typeof t=="string"){let e=t in Iz?Iz[t]:t;if(e==="GlorotNormal")return new nh;if(e==="GlorotUniform")return new rh;if(e==="HeNormal")return new oh;if(e==="HeUniform")return new sh;if(e==="LeCunNormal")return new ih;if(e==="LeCunUniform")return new ah;{let r={};return r.className=e,r.config={},Ez(r)}}else return t instanceof Qn?t:Ez(t)}function J1(t){return Array.isArray(t)&&Array.isArray(t[0])}function lh(t){return t.length===0?[]:Array.isArray(t[0])?t:[t]}function Re(t){let e;if(Array.isArray(t)){if(t.length!==1)throw new z(`Expected Tensor length to be 1; got ${t.length}`);e=t[0]}else e=t;return e}function Ue(t){if(Array.isArray(t)&&Array.isArray(t[0])){if(t.length===1)return t=t,t[0];throw new z(`Expected exactly 1 Shape; got ${t.length}`)}else return t}function uh(t){let e=0;for(let r of t)r.shape.length===0?e+=1:e+=r.shape.reduce((n,o)=>n*o);return e}var Az="Variable",uy=class{constructor(e,r="float32",n=Az,o=!0,s=null){this.dtype=r??"float32",this.shape=e.shape,this.id=q1(),n=n??Az,this.originalName=j1(n),this.name=K1(this.originalName),this.trainable_=o,this.constraint=s,this.val=tE(e,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(e){return this.assertNotDisposed(),Yne(this.val,e),this.val.id!==e.id&&(this.val.assign(e),this.constraint!=null&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(e){this.trainable_=e,this.val.trainable=e}};function Yne(t,e){if(t.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(t.shape)+" vs. "+JSON.stringify(e.shape))}function cy(t){return t.map(e=>e.read())}function ch(t){t.forEach(e=>{e[0].write(e[1])})}var St=class{constructor(e){this.dtype=e.dtype,this.shape=e.shape,e.shape!=null?this.ndim=e.shape.length:this.ndim=e.ndim,this.maxNDim=e.maxNDim,this.minNDim=e.minNDim,this.axes=e.axes||{}}},On=class{constructor(e,r,n,o,s,i,a){this.dtype=e,this.shape=r,this.sourceLayer=n,this.inputs=o,this.callArgs=s,this.outputTensorIndex=a,this.id=q1(),i!=null&&(this.originalName=j1(i),this.name=K1(this.originalName)),this.rank=r.length}},Qne=0,El=class{constructor(e,r){this.callArgs=r,this.id=Qne++,this.outboundLayer=e.outboundLayer,this.inboundLayers=e.inboundLayers,this.nodeIndices=e.nodeIndices,this.tensorIndices=e.tensorIndices,this.inputTensors=e.inputTensors,this.outputTensors=e.outputTensors,this.inputMasks=e.inputMasks,this.outputMasks=e.outputMasks,this.inputShapes=e.inputShapes,this.outputShapes=e.outputShapes;for(let n of e.inboundLayers)n?.outboundNodes.push(this);e.outboundLayer.inboundNodes.push(this)}getConfig(){let e=[];for(let r of this.inboundLayers)r!=null?e.push(r.name):e.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:e,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}},Zne=0,ze=class extends J.Serializable{constructor(e={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=Zne++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let r=e.name;if(!r){let n=this.getClassName();r=Ss(n)+"_"+vc(n)}if(this.name=r,this.trainable_=e.trainable==null?!0:e.trainable,e.inputShape!=null||e.batchInputShape!=null){let n;if(e.batchInputShape!=null)n=e.batchInputShape;else if(e.inputShape!=null){let s=null;e.batchSize!=null&&(s=e.batchSize),n=[s].concat(e.inputShape)}this.batchInputShape=n;let o=e.dtype;o==null&&(o=e.inputDType),o==null&&(o="float32"),this.dtype=o}e.weights!=null?this.initialWeights=e.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(e,r){return e.name+"_ib-"+r.toString()}getNodeAtIndex(e,r){if(this.inboundNodes.length===0)throw new wn(`The layer has never been called and thus has no defined ${r}.`);if(this.inboundNodes.length<=e)throw new z(`Asked to get ${r} at node ${e}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[e]}getInputAt(e){return qr(this.getNodeAtIndex(e,"input").inputTensors)}getOutputAt(e){return qr(this.getNodeAtIndex(e,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new ao(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(this.inboundNodes.length===0)throw new ao(`Layer ${this.name} is not connected, no input to return.`);return qr(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(this.inboundNodes.length===0)throw new ao(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new ao(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return qr(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map(e=>e())}get updates(){return this._updates}get built(){return this._built}set built(e){this._built=e}get trainable(){return this.trainable_}set trainable(e){this._trainableWeights.forEach(r=>r.trainable=e),this.trainable_=e}get trainableWeights(){return this.trainable_?this._trainableWeights.filter(e=>e.trainable):[]}set trainableWeights(e){this._trainableWeights=e}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter(e=>!e.trainable).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(e){this._nonTrainableWeights=e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(e){if(e=Ct(e),this.inputSpec==null||this.inputSpec.length===0)return;let r=Ct(this.inputSpec);if(e.length!==r.length)throw new z(`Layer ${this.name} expects ${r.length} inputs, but it received ${e.length} input tensors. Input received: ${e}`);for(let n=0;n<e.length;n++){let o=e[n],s=r[n];if(s==null)continue;let i=o.rank;if(s.ndim!=null&&i!==s.ndim)throw new z(`Input ${n} is incompatible with layer ${this.name}: expected ndim=${s.ndim}, found ndim=${i}`);if(s.maxNDim!=null&&i>s.maxNDim)throw new z(`Input ${n} is incompatible with layer ${this.name}: expected max_ndim=${s.maxNDim}, found ndim=${i}`);if(s.minNDim!=null&&i<s.minNDim)throw new z(`Input ${n} is incompatible with layer ${this.name}: expected min_ndim=${s.minNDim}, found ndim=${i}.`);if(s.dtype!=null&&o.dtype!==s.dtype)throw new z(`Input ${n} is incompatible with layer ${this.name} : expected dtype=${s.dtype}, found dtype=${o.dtype}.`);if(s.axes){let a=o.shape;for(let l in s.axes){let u=Number(l),c=s.axes[l],p=u>=0?a[u]:a[a.length+u];if(c!=null&&[c,null].indexOf(p)===-1)throw new z(`Input ${n} is incompatible with layer ${this.name}: expected axis ${u} of input shape to have value ${c} but got shape ${a}.`)}}if(s.shape!=null)for(let a=0;a<s.shape.length;++a){let l=s.shape[a],u=o.shape[a];if(l!=null&&u!=null&&l!==u)throw new z(`Input ${n} is incompatible with layer ${this.name}: expected shape=${s.shape}, found shape=${o.shape}.`)}}}call(e,r){return e}invokeCallHook(e,r){this._callHook!=null&&this._callHook(e,r)}setCallHook(e){this._callHook=e}clearCallHook(){this._callHook=null}apply(e,r){r=r||{},this.assertNotDisposed();let n=Ct(e),o=!0;for(let i of n)if(!(i instanceof On)){o=!1;break}let s=!0;for(let i of n)if(i instanceof On){s=!1;break}if(o===s)throw new z("Arguments to apply() must be all SymbolicTensors or all Tensors");return li(this.name,()=>{if(!this.built){this.assertInputCompatibility(e);let i=[];for(let a of Ct(e))i.push(a.shape);this.build(qr(i)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),this._refCount===null&&s&&(this._refCount=1)}if(this.assertInputCompatibility(e),s){let i=this.call(e,r),a=Ct(i),l=[];for(let u of a)n.indexOf(u)!==-1&&(u=u.clone()),l.push(u);if(i=qr(l),this.activityRegularizer!=null)throw new $e("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return i}else{let i=Jne(e),a=this.computeOutputShape(i),l,u=eoe(e);if(this.warnOnIncompatibleInputShape(Array.isArray(e)?i[0]:i),a!=null&&a.length>0&&Array.isArray(a[0])?l=a.map((c,p)=>new On(u,c,this,Ct(e),r,this.name,p)):l=new On(u,a,this,Ct(e),r,this.name),this.addInboundNode(e,l,null,null,i,a,r),this._refCount++,this.activityRegularizer!=null)throw new $e("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}})}warnOnIncompatibleInputShape(e){if(this.batchInputShape!=null)if(e.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(e)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let r=!1;this.batchInputShape.forEach((n,o)=>{n!=null&&e[o]!=null&&e[o]!==n&&(r=!0)}),r&&console.warn(`The shape of the input tensor (${JSON.stringify(e)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(this.inboundNodes==null||this.inboundNodes.length===0)throw new ao(`The layer ${this.name} has never been called and thus has no defined output shape.`);let e=[];for(let r of this.inboundNodes){let n=JSON.stringify(r.outputShapes);e.indexOf(n)===-1&&e.push(n)}if(e.length===1){let r=this.inboundNodes[0].outputShapes;return Array.isArray(r)&&Array.isArray(r[0])&&r.length===1?r[0]:r}else throw new ao(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new wn(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return uh(this.weights)}build(e){this.built=!0}getWeights(e=!1){return cy(e?this.trainableWeights:this.weights)}setWeights(e){U(()=>{let r=this.weights;if(r.length!==e.length)throw new z(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${e.length}, but the layer was expecting ${r.length} weights. Provided weights: ${e}...`);if(r.length===0)return;let n=[],o=cy(r);for(let s=0;s<o.length;++s){let i=o[s],a=r[s],l=e[s];if(!w.arraysEqual(i.shape,l.shape))throw new z(`Layer weight shape ${i.shape} not compatible with provided weight shape ${l.shape}`);n.push([a,l])}ch(n)})}addWeight(e,r,n,o,s,i,a,l){if(this._addedWeightNames.indexOf(e)!==-1)throw new z(`Duplicate weight name ${e} for layer ${this.name}`);this._addedWeightNames.push(e),n==null&&(n="float32"),this.fastWeightInitDuringBuild&&(o=l!=null?l():xt("zeros"));let u=o.apply(r,n),c=new uy(u,n,e,i,a);return u.dispose(),s!=null&&this.addLoss(()=>s.apply(c.read())),i==null&&(i=!0),i?this._trainableWeights.push(c):this._nonTrainableWeights.push(c),c}setFastWeightInitDuringBuild(e){this.fastWeightInitDuringBuild=e}addLoss(e){e==null||Array.isArray(e)&&e.length===0||(e=Ct(e),this._losses!==void 0&&this._losses!==null&&this.losses.push(...e))}computeOutputShape(e){return e}computeMask(e,r){if(!this.supportsMasking){if(r!=null)if(Array.isArray(r))r.forEach(n=>{if(n!=null)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)});else throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);return null}return r}addInboundNode(e,r,n,o,s,i,a=null){let l=Ct(e);r=Ct(r),n=Ct(n),o=Ct(o),s=lh(s),i=lh(i);let u=[],c=[],p=[];for(let f of l)u.push(f.sourceLayer),c.push(f.nodeIndex),p.push(f.tensorIndex);new El({outboundLayer:this,inboundLayers:u,nodeIndices:c,tensorIndices:p,inputTensors:l,outputTensors:r,inputMasks:n,outputMasks:o,inputShapes:s,outputShapes:i},a);for(let f=0;f<r.length;f++)r[f].sourceLayer=this,r[f].nodeIndex=this.inboundNodes.length-1,r[f].tensorIndex=f}getConfig(){let e={name:this.name,trainable:this.trainable};return this.batchInputShape!=null&&(e.batchInputShape=this.batchInputShape),this.dtype!=null&&(e.dtype=this.dtype),e}disposeWeights(){return this.weights.forEach(e=>e.dispose()),this.weights.length}assertNotDisposed(){if(this._refCount===0)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(this._refCount===null)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let e=0;return--this._refCount===0&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}};function Jne(t){t=Ct(t);let e=[];for(let r of t)e.push(r.shape);return qr(e)}function eoe(t){return"float32"}function yE(t,e,r){if((e==null||r!=null&&r>0)&&(e=t.sourceLayer,r=t.nodeIndex),e.inboundNodes.length===0)return[t];{let n=e.inboundNodes[r];if(n.inboundLayers.length===0)return n.inputTensors;{let o=[];for(let s=0;s<n.inboundLayers.length;s++){let i=n.inputTensors[s],a=n.inboundLayers[s],l=n.nodeIndices[s],u=yE(i,a,l);for(let c of u)o.indexOf(c)===-1&&o.push(c)}return o}}}var Xi=class extends ze{constructor(e){if(super({dtype:e.dtype,name:e.name!=null?e.name:vc("input").toString()}),e.batchSize==null&&(e.batchSize=null),e.sparse==null&&(e.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=e.sparse,e.inputShape!=null&&e.batchInputShape!=null)throw new z("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let r=e.batchInputShape;if(r==null){if(e.inputShape==null)throw new z("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");r=[e.batchSize].concat(e.inputShape)}else if(e.batchSize!=null)throw new z("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");let n=e.dtype||"float32";this.batchInputShape=r,this.dtype=n,this.inputSpec=[{shape:r}];let o=new On(this.dtype,this.batchInputShape,this,[],{},this.name);o.nodeIndex=0,o.tensorIndex=0,new El({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[o],outputTensors:[o],inputMasks:[null],outputMasks:[null],inputShapes:[r],outputShapes:[r]})}apply(e,r){throw new z(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}};Xi.className="InputLayer";J.registerClass(Xi);function bE(t){if(t.batchShape==null&&t.shape==null)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(t.batchShape!=null&&t.shape!=null)throw new z("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=t.batchShape;t.shape!=null&&e==null&&(e=[null].concat(t.shape));let r=t.dtype;return r==null&&(r="float32"),new Xi({batchInputShape:e,name:t.name,dtype:r,sparse:t.sparse}).inboundNodes[0].outputTensors[0]}function toe(t,e){if(t.dtype==null||t.dtype===e.dtype)return e;try{return oe(e,t.dtype)}catch{throw new z(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${t.name}' (${t.dtype}).`)}}var Is=class{constructor(e){if(this.id2Value={},this.id2Mask={},this.name2Id={},e instanceof Is)for(let r in e.id2Value)this.id2Value[r]=e.id2Value[r],r in e.id2Mask&&(this.id2Mask[r]=e.id2Mask[r]);else{if(e==null)return;for(let r of e)this.add(r.key,r.value)}}add(e,r,n){if(this.id2Value[e.id]==null)this.id2Value[e.id]=toe(e,r),this.name2Id[e.name]=e.id,n!=null&&(this.id2Mask[e.id]=n);else throw new z(`Duplicate key: name=${e.name}, id=${e.id}`);return this}addFeed(e){this.add(e.key,e.value)}hasKey(e){return this.id2Value[e.id]!=null}names(){return Object.keys(this.name2Id)}getValue(e){if(e instanceof On){if(this.id2Value[e.id]==null)throw new z(`Nonexistent key: ${e.name}`);return this.id2Value[e.id]}else{let r=this.name2Id[e];if(r==null)throw new z(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Value[r]}}getMask(e){if(e instanceof On){if(this.id2Value[e.id]==null)throw new z(`Nonexistent key: ${e.name}`);return this.id2Mask[e.id]}else{let r=this.name2Id[e];if(r==null)throw new z(`Feed dict has no SymbolicTensor name: ${e}`);return this.id2Mask[r]}}disposeMasks(){this.id2Mask!=null&&Me(this.id2Mask)}},ew=new Zx,tw=new Zx;function $z(t){ew?.setMaxEntries(t),tw?.setMaxEntries(t)}function gf(t,e,r,n){let o=r==null?!1:r.training,s=Array.isArray(t),i=s?t:[t],a=i.map(m=>m.name),l=[],u=e.names();for(let m of a)u.indexOf(m)!==-1?l.push(e.getValue(m)):l.push(null);n!=null&&(n.maxNumTensors=-1/0,n.minNumTensors=1/0);let c=a.join(",")+"|"+e.names().sort().join(","),p=ew.get(c),f;if(p==null){let m=roe(i,e);p=m.sorted,f=m.recipientCounts,ew.put(c,p),tw.put(c,f)}f={},o||Object.assign(f,tw.get(c));let d=new Is(e);for(let m=0;m<p.length;++m){if(n!=null){let D=Ix().numTensors;D>n.maxNumTensors&&(n.maxNumTensors=D),D<n.minNumTensors&&(n.minNumTensors=D)}let h=p[m],g=h.sourceLayer;if(g instanceof Xi)continue;let x=[],y=[],b=[],v=!1;for(let D of h.inputs){let $=d.getValue(D),O=d.getMask(D);x.push($),y.push(O),O!=null&&(v=!0),o||(f[D.name]--,f[D.name]===0&&!e.hasKey(D)&&a.indexOf(D.name)===-1&&!$.isDisposed&&D.sourceLayer.stateful!==!0&&b.push($))}v&&(r=r||{},r.mask=y[0]);let C=Ct(g.apply(x,r)),S=null;g.supportsMasking&&(S=g.computeMask(x,y));let k=ooe(h),N=Array.isArray(k)?k:[k];for(let D=0;D<N.length;++D){d.hasKey(N[D])||d.add(N[D],C[D],Array.isArray(S)?S[0]:S);let $=a.indexOf(N[D].name);$!==-1&&(l[$]=C[D])}o||Me(b)}return d.disposeMasks(),s?l:l[0]}function roe(t,e){w.assert(t!=null&&t.length>0,()=>"Expected at least one fetch, got none");let r=[],n={};if(t.length===1){let o=Dz(t[0],e);r=o.sorted,n=o.recipientMap}else{let o=new Set;for(let s of t){let{sorted:i,recipientMap:a}=Dz(s,e);for(let l of i)o.has(l.name)||(r.push(l),o.add(l.name));for(let l in a)n[l]==null&&(n[l]=new Set),a[l].forEach(u=>n[l].add(u))}}return{sorted:r,recipientCounts:noe(n)}}function noe(t){let e={};for(let r in t)e[r]=t[r].size;return e}function Dz(t,e){let r=new Set,n=[],o={};for(let a of e.names())r.add(a);let s=[],i=[];for(s.push(t);s.length>0;){let a=s[s.length-1];if(r.has(a.name)){s.pop();continue}let l=i[i.length-1]===s.length-1;if(a.inputs.length===0||l)s.pop(),n.push(a),r.add(a.name),l&&i.pop();else{i.push(s.length-1);for(let u of a.inputs)o[u.name]==null&&(o[u.name]=new Set),o[u.name].add(a.name),!r.has(u.name)&&s.push(u)}}return{sorted:n,recipientMap:o}}function ooe(t){let e;if(t.sourceLayer.inboundNodes.length===1)e=t.sourceLayer.output;else{let r=null;for(let n=0;n<t.sourceLayer.inboundNodes.length;++n)for(let o of t.sourceLayer.inboundNodes[n].outputTensors)if(o.id===t.id){r=n;break}e=t.sourceLayer.getOutputAt(r)}return e}var soe=B();soe.registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",()=>100,$z);function vE(t,e){return U(()=>Rt(ye(L(t,t),e,!0)))}var xf=class extends J.Serializable{getConfig(){return{}}},py=class extends xf{constructor(e){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return U(()=>{let r=vE(e,this.axis),n=sn(r,0,this.maxValue);return L(e,xe(n,te(kr(),r)))})}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}};py.className="MaxNorm";J.registerClass(py);var fy=class extends xf{constructor(e){super(),this.defaultAxis=0,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return U(()=>xe(e,te(kr(),vE(e,this.axis))))}getConfig(){return{axis:this.axis}}};fy.className="UnitNorm";J.registerClass(fy);var dy=class extends xf{apply(e){return Ao(e)}};dy.className="NonNeg";J.registerClass(dy);var my=class extends xf{constructor(e){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=e.minValue!=null?e.minValue:this.defaultMinValue,this.maxValue=e.maxValue!=null?e.maxValue:this.defaultMaxValue,this.rate=e.rate!=null?e.rate:this.defaultRate,this.axis=e.axis!=null?e.axis:this.defaultAxis}apply(e){return U(()=>{let r=vE(e,this.axis),n=te(L(this.rate,sn(r,this.minValue,this.maxValue)),L(1-this.rate,r));return L(e,xe(n,te(kr(),r)))})}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}};my.className="MinMaxNorm";J.registerClass(my);var Rz={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Kt(t){return Zm(t)}function Oz(t,e={}){return ji(t,J.SerializationMap.getMap().classNameMap,e,"constraint")}function Xt(t){if(t==null)return null;if(typeof t=="string"){let r={className:t in Rz?Rz[t]:t,config:{}};return Oz(r)}else return t instanceof xf?t:Oz(t)}async function _l(t){if(t==null)return;let e=[],r=[],n=[];for(let o in t){let s=t[o];if(typeof s!="number"){let i=s;e.push(i.data()),r.push(o),n.push(i)}}if(e.length>0){let o=await Promise.all(e);for(let s=0;s<o.length;++s)t[r[s]]=o[s][0];Me(n)}}function rw(t){if(t!=null)for(let e in t){let r=t[e];typeof r!="number"&&r.dispose()}}var Fz;(function(t){t[t.SILENT=0]="SILENT",t[t.VERBOSE=1]="VERBOSE"})(Fz||(Fz={}));var loe=125,Cc=class{constructor(){this.validationData=null}setParams(e){this.params=e}async onEpochBegin(e,r){}async onEpochEnd(e,r){}async onBatchBegin(e,r){}async onBatchEnd(e,r){}async onTrainBegin(e){}async onTrainEnd(e){}setModel(e){}},nw=class{constructor(e,r=10){e==null&&(e=[]),this.callbacks=e,this.queueLength=r}append(e){this.callbacks.push(e)}setParams(e){for(let r of this.callbacks)r.setParams(e)}setModel(e){for(let r of this.callbacks)r.setModel(e)}async onEpochBegin(e,r){r==null&&(r={});for(let n of this.callbacks)await n.onEpochBegin(e,r)}async onEpochEnd(e,r){r==null&&(r={});for(let n of this.callbacks)await n.onEpochEnd(e,r)}async onBatchBegin(e,r){r==null&&(r={});for(let n of this.callbacks)await n.onBatchBegin(e,r)}async onBatchEnd(e,r){r==null&&(r={});for(let n of this.callbacks)await n.onBatchEnd(e,r)}async onTrainBegin(e){e==null&&(e={});for(let r of this.callbacks)await r.onTrainBegin(e)}async onTrainEnd(e){e==null&&(e={});for(let r of this.callbacks)await r.onTrainEnd(e)}},wE=class extends Cc{constructor(){super()}async onEpochBegin(e){this.seen=0,this.totals={}}async onBatchEnd(e,r){r==null&&(r={});let n=r.size==null?0:r.size;this.seen+=n;for(let o in r){let s=r[o];if(typeof s=="number")this.totals.hasOwnProperty(o)||(this.totals[o]=0),this.totals[o]=this.totals[o]+s*n;else{let i;o in this.totals?i=this.totals[o]:this.totals[o]=0;let a=U(()=>te(this.totals[o],L(s,n)));this.totals[o]=a,i?.dispose()}}}async onEpochEnd(e,r){if(r!=null)for(let n of this.params.metrics)this.totals[n]!=null&&(typeof this.totals[n]=="number"?r[n]=this.totals[n]/this.seen:U(()=>{let o=L(xe(1,this.seen),this.totals[n]);r[n]=o,this.totals[n].dispose(),Gr(r[n])}))}},ow=class extends Cc{async onTrainBegin(e){this.epoch=[],this.history={}}async onEpochEnd(e,r){r==null&&(r={}),this.epoch.push(e);for(let n in r)this.history[n]==null&&(this.history[n]=[]),this.history[n].push(r[n])}async syncData(){let e=[],r=[],n=[];for(let s in this.history){let i=this.history[s];for(let a=0;a<i.length;++a)if(typeof i[a]!="number"){let l=i[a];e.push(l.data()),r.push(s),n.push(a)}}let o=await Promise.all(e);for(let s=0;s<o.length;++s)this.history[r[s]][n[s]].dispose(),this.history[r[s]][n[s]]=o[s][0]}},sw=class extends Cc{constructor(e,r){if(super(),this.currentEpoch=0,this.nowFunc=e.nowFunc,this.nextFrameFunc=e.nextFrameFunc||Qx,this.yieldEvery=r||"auto",this.yieldEvery==="auto"&&(this.yieldEvery=loe),this.yieldEvery==="never"&&e.onYield!=null)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");w.isNumber(this.yieldEvery)&&(this.maybeWait=uz(this.maybeWait.bind(this),this.yieldEvery,this.nowFunc)),this.trainBegin=e.onTrainBegin,this.trainEnd=e.onTrainEnd,this.epochBegin=e.onEpochBegin,this.epochEnd=e.onEpochEnd,this.batchBegin=e.onBatchBegin,this.batchEnd=e.onBatchEnd,this.yield=e.onYield}async maybeWait(e,r,n){let o=[];this.yield!=null&&(await _l(n),o.push(this.yield(e,r,n))),o.push(this.nextFrameFunc()),await Promise.all(o)}async onEpochBegin(e,r){this.currentEpoch=e,this.epochBegin!=null&&(await _l(r),await this.epochBegin(e,r))}async onEpochEnd(e,r){let n=[];this.epochEnd!=null&&(await _l(r),n.push(this.epochEnd(e,r))),this.yieldEvery==="epoch"&&n.push(this.nextFrameFunc()),await Promise.all(n)}async onBatchBegin(e,r){this.batchBegin!=null&&(await _l(r),await this.batchBegin(e,r))}async onBatchEnd(e,r){let n=[];this.batchEnd!=null&&(await _l(r),n.push(this.batchEnd(e,r))),this.yieldEvery==="batch"?n.push(this.nextFrameFunc()):w.isNumber(this.yieldEvery)&&n.push(this.maybeWait(this.currentEpoch,e,r)),await Promise.all(n)}async onTrainBegin(e){this.trainBegin!=null&&(await _l(e),await this.trainBegin(e))}async onTrainEnd(e){this.trainEnd!=null&&(await _l(e),await this.trainEnd(e))}};function iw(t,e){return t==null&&(t={}),t instanceof Cc?[t]:Array.isArray(t)&&t[0]instanceof Cc?t:Ct(t).map(n=>new sw(n,e))}var lo=class{constructor(){}static registerCallbackConstructor(e,r){w.assert(e>=0&&Number.isInteger(e),()=>`Verbosity level is expected to be an integer >= 0, but got ${e}`),lo.checkForDuplicate(r),lo.constructors[e]==null&&(lo.constructors[e]=[]),lo.constructors[e].push(r)}static checkForDuplicate(e){for(let r in lo.constructors)lo.constructors[+r].forEach(o=>{if(o===e)throw new z("Duplicate callback constructor.")})}static clear(){lo.constructors={}}static createCallbacks(e){let r=[];for(let n in lo.constructors){let o=+n;e>=o&&r.push(...lo.constructors[o])}return r.map(n=>new n)}};lo.constructors={};function aw(t,e,r,n,o,s,i,a,l){let u=new ow,c=[new wE,...lo.createCallbacks(e)];t!=null&&c.push(...t),c.push(u);let p=new nw(c);return p.setParams({epochs:r,initialEpoch:n,samples:o,steps:s,batchSize:i,verbose:e,doValidation:a,metrics:l}),{callbackList:p,history:u}}function Do(t,e={},r=!1){return ji(t,J.SerializationMap.getMap().classNameMap,e,"layer",r)}function hy(t,e){return U(()=>{t.dtype!=="float32"&&(t=oe(t,"float32"));let r=ye(mf(t),e,!0),n=bl(r.shape,kr()),o=Rt(Eo(r,n));return xe(t,o)})}function yf(t,e){return U(()=>Vt(mf(Ce(e,t)),-1))}function xy(t,e){return U(()=>Vt(Sr(Ce(e,t)),-1))}function yy(t,e){return U(()=>{let r=Ce(t,e),n=sn(Sr(t),kr(),Number.MAX_VALUE),o=Sr(xe(r,n));return L(100,Vt(o,-1))})}function uoe(t,e){return U(()=>{let r=sn(e,kr(),Number.MAX_VALUE),n=qn(te(1,r)),o=sn(t,kr(),Number.MAX_VALUE),s=qn(te(1,o));return Vt(mf(Ce(n,s)),-1)})}function coe(t,e){return U(()=>{let r=Eo(0,Ce(1,L(t,e)));return Vt(mf(r),-1)})}function poe(t,e){return U(()=>{let r=Eo(0,Ce(1,L(t,e)));return Vt(r,-1)})}function foe(t,e){return U(()=>{let r=ye(L(t,e),-1),n=an(L(Ce(1,t),e),-1);return Eo(0,te(1,Ce(n,r)))})}function doe(t,e){return U(()=>{let r=Math.log(2),n=Ce(e,t),o=Ce(te(n,Ui(L(-2,n))),r);return Vt(o,-1)})}function bf(t,e,r=!1){return U(()=>{if(r)e=sf(e);else{let n=ye(e,e.shape.length-1,!0);e=xe(e,n)}return e=sn(e,kr(),1-kr()),ot(ye(L(oe(t,"float32"),qn(e)),e.shape.length-1))})}function ph(t,e,r=!1){return U(()=>{let n=oe(Cl(vz(t)),"int32");e=sn(e,kr(),1-kr());let o=e.shape,s=M(Am(n,o[o.length-1]),o);return bf(s,e,r)})}function moe(t,e){if(!w.arraysEqual(t.shape,e.shape))throw new z(`logits and labels must have the same shape, but got shapes ${JSON.stringify(t.shape)} and ${JSON.stringify(e.shape)}`);return U(()=>{let r=Ao(e),n=ot(Sr(e));return te(Ce(r,L(e,t)),Lx(xn(n)))})}function fh(t,e){return U(()=>{let r;return r=sn(e,kr(),1-kr()),r=qn(xe(r,Ce(1,r))),Vt(moe(t,r),-1)})}function hoe(t,e){return U(()=>{let r=sn(t,kr(),1),n=sn(e,kr(),1);return ye(L(t,qn(xe(r,n))),-1)})}function goe(t,e){return U(()=>{let r=qn(te(kr(),e));return Vt(Ce(e,L(t,r)),-1)})}function lw(t,e){return U(()=>{let r=hy(t,-1),n=hy(e,-1),o=L(r,n);return ot(ye(o,-1))})}var gy={meanSquaredError:yf,meanAbsoluteError:xy,meanAbsolutePercentageError:yy,meanSquaredLogarithmicError:uoe,squaredHinge:coe,hinge:poe,categoricalHinge:foe,logcosh:doe,categoricalCrossentropy:bf,sparseCategoricalCrossentropy:ph,binaryCrossentropy:fh,kullbackLeiblerDivergence:hoe,poisson:goe,cosineProximity:lw};function uw(t){if(typeof t=="string"){if(t in gy)return gy[t];let e=`Unknown loss ${t}`;throw t.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${t}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new z(e)}else return t}function pw(t,e){return U(()=>{let r=L(.5,Hr(e)),n=$n(er(e,r),t.dtype);return Vt(Hn(t,n),-1)})}function fw(t,e){return U(()=>$n(Hn(xl(t,-1),xl(e,-1)),"float32"))}function xoe(t,e){return U(()=>oe(ye(An(Hn(t,1),Hn(e,1))),"float32"))}function yoe(t,e){return U(()=>oe(ye(An(Hn(t,0),Hn(e,1))),"float32"))}function Lz(t,e){return U(()=>{let r=xoe(t,e),n=yoe(t,e),o=te(r,n);return oe(Bt(er(o,0),xe(r,o),0),"float32")})}function CE(t,e){return fh(t,e)}function SE(t,e){return t.rank===e.rank&&(t=oi(t,[t.rank-1])),e=xl(e,-1),e.dtype!==t.dtype&&(e=oe(e,t.dtype)),oe(Hn(t,e),"float32")}var boe=yf,voe=yf,woe=xy,Coe=xy,Soe=yy,koe=yy,dw=bf,Toe=lw,kE=ph,cw={binaryAccuracy:pw,categoricalAccuracy:fw,precision:Lz,categoricalCrossentropy:dw,sparseCategoricalCrossentropy:kE,mse:boe,MSE:voe,mae:woe,MAE:Coe,mape:Soe,MAPE:koe,cosine:Toe};function Mz(t){if(typeof t=="string"&&t in cw)return cw[t];if(typeof t!="string"&&t!=null)return t;throw new z(`Unknown metric ${t}`)}function by(t){if(Zo(t!==null,`Unknown LossOrMetricFn ${t}`),typeof t=="string")return t;{let e;for(let r of Object.keys(gy))if(gy[r]===t){e=r;break}if(e!==void 0)return e;for(let r of Object.keys(cw))if(cw[r]===t){e=r;break}return e!==void 0?e:t.name}}function Bz(t){let e={Adagrad:()=>ff.adagrad(.01),Adadelta:()=>ff.adadelta(1,.95,kr()),Adam:()=>ff.adam(.001,.9,.999,kr()),Adamax:()=>ff.adamax(.002,.9,.999,kr(),0),RMSProp:()=>ff.rmsprop(.001,.9,0,kr()),SGD:()=>ff.sgd(.01)};if(e.adagrad=e.Adagrad,e.adadelta=e.Adadelta,e.adam=e.Adam,e.adamax=e.Adamax,e.rmsprop=e.RMSProp,e.sgd=e.SGD,t in e)return e[t]();throw new z(`Unknown Optimizer ${t}`)}function NE(t,e,r=!1){if(t==null||typeof t!="object"||Object.getPrototypeOf(t)!==Object.prototype||!TE(t))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(r){let n=JSON.stringify(t);n.length>1048576&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${n.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${1048576}.`)}}function TE(t){if(t===null)return!0;if(typeof t=="object")if(Object.getPrototypeOf(t)===Object.prototype){let e=Object.keys(t);for(let r of e)if(typeof r!="string"||!TE(t[r]))return!1;return!0}else if(Array.isArray(t)){for(let e of t)if(!TE(e))return!1;return!0}else return!1;else{let e=typeof t;return e==="string"||e==="number"||e==="boolean"}}function Vz(t,e,r,n=console.log){let o=Eoe(t),s=["Layer (type)","Input Shape","Output shape","Param #"];o?(e=e||90,r=r||[.32,.61,.89,1]):(e=e||115,r=r||[.24,.48,.7,.8,1]),r[r.length-1]<=1&&(r=r.map(c=>Math.floor(e*c)));let i;if(!o){s.push("Receives inputs"),i=[];for(let c in t.nodesByDepth)i.push(...t.nodesByDepth[c])}n("_".repeat(e)),mw(s,r,n),n("=".repeat(e));let a=t.layers;for(let c=0;c<a.length;++c)o?_oe(a[c],r,n):Aoe(a[c],r,i,n),n((c===a.length-1?"=":"_").repeat(e));t.checkTrainableWeightsConsistency();let l=Ioe(t),u=uh(t.nonTrainableWeights);n(`Total params: ${l+u}`),n(`Trainable params: ${l}`),n(`Non-trainable params: ${u}`),n("_".repeat(e))}function Ioe(t){let e;return t.collectedTrainableWeights!=null?e=uh(t.collectedTrainableWeights):e=uh(t.trainableWeights),e}function Eoe(t){let e=!0,r=[],n=[];for(let o in t.nodesByDepth)r.push(t.nodesByDepth[o]);for(let o of r){if(o.length>1||o.length===1&&o[0].inboundLayers.length>1){e=!1;break}n.push(...o)}if(e)for(let o of t.layers){let s=!1;for(let i of o.inboundNodes)if(n.indexOf(i)!==-1)if(s){e=!1;break}else s=!0;if(!e)break}return e}function mw(t,e,r=console.log){let n="";for(let o=0;o<t.length;++o)o>0&&(n=n.slice(0,n.length-1)+" "),n+=t[o],n=n.slice(0,e[o]),n+=" ".repeat(e[o]-n.length);r(n)}function _oe(t,e,r){let n,o;try{o=t.inboundNodes.map(l=>JSON.stringify(l.inputShapes)).join(",")}catch{o="multiple"}try{n=JSON.stringify(t.outputShape)}catch{n="multiple"}let s=t.name,i=t.getClassName(),a=[`${s} (${i})`,o,n,t.countParams().toString()];mw(a,e,r)}function Aoe(t,e,r,n){let o,s;try{s=t.inboundNodes.map(p=>JSON.stringify(p.inputShapes)).join(",")}catch{s="multiple"}try{o=JSON.stringify(t.outputShape)}catch{o="multiple"}let i=[];for(let p of t.inboundNodes)if(!(r!=null&&r.length>0&&r.indexOf(p)===-1))for(let f=0;f<p.inboundLayers.length;++f){let d=p.inboundLayers[f].name,m=p.nodeIndices[f],h=p.tensorIndices[f];i.push(`${d}[${m}][${h}]`)}let a=t.name,l=t.getClassName(),u=i.length===0?"":i[0],c=[`${a} (${l})`,s,o,t.countParams().toString(),u];mw(c,e,n);for(let p=1;p<i.length;++p)mw(["","","","",i[p]],e,n)}function Wz(t,e,r){return(t==="inboundNodes"||t==="outputLayers"||t==="inputLayers")&&e===0&&typeof r=="string"}function vy(t,e){if(t===null)return null;if(typeof t=="string")return Tl(t);if(typeof t=="number"||typeof t=="boolean")return t;if(t instanceof Array){let r=[],n=t.length;for(let o=0;o<n;++o){let s=t[o];Wz(e,o,s)?r.push(s):r.push(vy(s,e))}return r}else{let r={};for(let n of Object.keys(t)){let o=t[n];if(n==="name"&&typeof o=="string")r[n]=o;else{let s=Tl(n);r[s]=vy(o,s)}}return r}}function hw(t,e){if(t==null)return null;if(typeof t=="string")return Ss(t);if(typeof t=="number"||typeof t=="boolean")return t;if(t instanceof Array){let r=[],n=t.length;for(let o=0;o<n;++o){let s=t[o];Wz(e,o,s)?r.push(s):r.push(hw(s,e))}return r}else{let r={};for(let n of Object.keys(t)){let o=t[n],s=Ss(n);(n==="name"||n==="className")&&typeof o=="string"?r[s]=o:r[s]=hw(o,n)}return r}}var dh="4.1.0";var $o=class extends ze{constructor(e){if(super({}),this.containerNodes=new Set,this.name=e.name,this.name==null){let y=this.getClassName().toLowerCase();this.name=vc(y)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(e.inputs)?this.inputs=e.inputs.slice():this.inputs=[e.inputs],Array.isArray(e.outputs)?this.outputs=e.outputs.slice():this.outputs=[e.outputs],ks(this.inputs).length!==this.inputs.length)throw new z(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map(y=>y.name)}`);ks(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map(y=>y.name)}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(let y of this.outputs){let b=y.sourceLayer,v=y.nodeIndex,C=y.tensorIndex;this.outputLayers.push(b),this.outputLayersNodeIndices.push(v),this.outputLayersTensorIndices.push(C)}for(let y of this.inputs){let b=y.sourceLayer,v=y.nodeIndex,C=y.tensorIndex;Zo(v===0,"input layer has >1 nodes"),Zo(C===0,"input layer has >1 tensors"),this.inputLayers.push(b),this.inputLayersNodeIndices.push(v),this.inputLayersTensorIndices.push(C)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let y=0;y<this.inputLayers.length;y++){let b=this.inputLayers[y];if(!(b instanceof Xi))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${e.inputs}. Input ${y} (0-based) originates from layer type ${b.getClassName()}.`);this.inputNames.push(b.name),this.feedInputShapes.push(b.batchInputShape),this.feedInputNames.push(b.name)}for(let y of this.outputLayers)this.outputNames.push(y.name);this.internalInputShapes=this.inputs.map(y=>y.shape),this.internalOutputShapes=this.outputs.map(y=>y.shape);let r={},n={},o={},s={},i={},a=[],l=(y,b,v,C,S,k)=>{(C==null||S==null||k==null)&&(C=y.sourceLayer,S=y.nodeIndex,k=y.tensorIndex);let N=C.inboundNodes[S];if(v.indexOf(N)!==-1)throw new wn(`The tensor ${y.name} at layer "${C.name}" is part of a cycle.`);if(b.indexOf(N)!==-1)return;this.containerNodes.add($o.nodeKey(C,S)),C.id in i||(i[C.id]=Object.keys(i).length),v.indexOf(N)===-1&&v.push(N);let D=N.inboundLayers.length;for(let $=0;$<D;$++){let O=N.inputTensors[$],V=N.inboundLayers[$],K=N.nodeIndices[$],X=N.tensorIndices[$];l(O,b,v,V,K,X)}for(b.push(N);v.indexOf(N)>=0;)v.splice(v.indexOf(N),1);a.push(N)},u=[],c=[];for(let y of this.outputs)l(y,u,c);let p=a.slice().reverse();for(let y of p){n[y.id]=y,y.id in r||(r[y.id]=0);let b=r[y.id],v=o[y.outboundLayer.id]==null?0:o[y.outboundLayer.id];b=Math.max(b,v),o[y.outboundLayer.id]=b,s[y.outboundLayer.id]=y.outboundLayer,r[y.id]=b;for(let C=0;C<y.inboundLayers.length;C++){let S=y.inboundLayers[C],k=y.nodeIndices[C],N=S.inboundNodes[k],D=r[N.id]==null?0:r[N.id];r[N.id]=Math.max(b+1,D),n[N.id]=N}}let f={};for(let y in r){let b=r[y];b in f||(f[b]=[]),f[b].push(n[y])}let d={};for(let y in o){let b=o[y];b in d||(d[b]=[]),d[b].push(s[y])}let m=Object.keys(d).map(y=>parseInt(y,10)).sort(Jx);this.layers=[];for(let y of m){let b=d[y];b.sort((v,C)=>{let S=i[v.id],k=i[C.id];return S<k?-1:S>k?1:0});for(let v of b)v instanceof $o&&this.internalContainerRefs.push(v),this.layers.push(v)}this.layersByDepth=d,m=Object.keys(f).map(y=>parseInt(y,10)).sort(Jx);let h=this.inputs.slice(),g=[];for(let y of m)for(let b of f[y]){let v=b.outboundLayer;if(v!=null){for(let C of b.inputTensors)if(h.indexOf(C)===-1)throw new wn(`Graph disconnected: cannot obtain value for tensor ${C} at layer "${v.name}". The following previous layers were accessed without issue: ${g}`);for(let C of b.outputTensors)h.push(C);g.push(v.name)}}this.nodesByDepth=f;let x=this.layers.map(y=>y.name);for(let y of x){let b=x.filter(v=>v===y).length;if(b!==1)throw new wn(`The name "${y}" is used ${b} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(x))}this.outboundNodes=[],this.inboundNodes=[],new El({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map(y=>null),outputMasks:this.outputs.map(y=>null),inputShapes:this.inputs.map(y=>y.shape),outputShapes:this.outputs.map(y=>y.shape)}),this.built=!0,this._refCount=1}assertNotDisposed(){if(this._refCount===0)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();let e={refCountAfterDispose:null,numDisposedVariables:0};if(--this._refCount===0){for(let r of this.layers)e.numDisposedVariables+=r.dispose().numDisposedVariables;for(let r of this.internalContainerRefs)e.numDisposedVariables+=r.dispose().numDisposedVariables}return e.refCountAfterDispose=this._refCount,e}get trainable(){return this.trainable_}set trainable(e){this.layers.forEach(r=>{r._trainableWeights.forEach(n=>n.trainable=e)}),this.trainable_=e}get trainableWeights(){if(this._trainableWeights.length>0)throw new z("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let e=[];for(let r of this.layers)e=e.concat(r.trainableWeights);return e}get nonTrainableWeights(){let e=[];for(let r of this.layers)e.push(...r.nonTrainableWeights);if(!this.trainable){let r=[];for(let n of this.layers)r.push(...n.trainableWeights);return r.concat(e)}return e}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(e,r=!0){let n={},o=0;for(let i of this.layers)for(let a of i.weights){if(n[a.originalName]!=null)throw new z(`Duplicate weight name: ${a.originalName}`);n[a.originalName]=a,o++}let s=[];for(let i in e){let a=i;if(n[i]==null){let l=i.split("/");a=l.slice(0,-2).concat([l[l.length-1]]).join("/")}if(n[a]!=null)s.push([n[a],e[i]]);else if(r)throw new z(`Provided weight data has no target variable: ${i}`);delete n[a]}if(r){let i=[];for(let a in n)i.push(a);if(i.length>0)throw new z(`${i.length} of ${o} weights are not set: ${i}`)}ch(s)}updatedConfig(){let e=this.getConfig(),r={};return r.className=this.getClassName(),r.config=e,r.kerasVersion=`tfjs-layers ${dh}`,r.backend="TensorFlow.js",r}toJSON(e,r=!0){let n=hw(this.updatedConfig());return r?JSON.stringify(n):n}call(e,r){return U(()=>{e=Ct(e);let n=new Is;for(let o=0;o<this.inputs.length;++o)n.add(this.inputs[o],e[o]);return gf(this.outputs,n,r)})}computeMask(e,r){return U(()=>{e=Ct(e);let n;return r==null?n=Cs(null,e.length):n=Ct(r),this.runInternalGraph(e,n)[1]})}computeOutputShape(e){let r=lh(e);if(r.length!==this.inputLayers.length)throw new z(`Invalid inputShape argument ${e}: model has ${this.inputLayers.length} tensor inputs.`);let n={};for(let a=0;a<r.length;a++){let l=this.inputLayers[a],u=r[a],c=l.name+"_0_0";n[c]=u}let o=Object.keys(this.nodesByDepth).map(a=>parseInt(a,10)).sort(Jx);if(o.length>1)for(let a of o){let l=this.nodesByDepth[a];for(let u of l){let c=u.outboundLayer;if(this.inputLayers.map(h=>h.id).indexOf(c.id)!==-1)continue;let p=[];for(let h=0;h<u.inboundLayers.length;h++){let g=u.inboundLayers[h],x=u.nodeIndices[h],y=u.tensorIndices[h],b=`${g.name}_${x}_${y}`,v=n[b];p.push(v)}let f=c.computeOutputShape(qr(p)),d=lh(f),m=c.inboundNodes.indexOf(u);for(let h=0;h<d.length;h++){let g=`${c.name}_${m}_${h}`;n[g]=d[h]}}}let s=[],i=[];for(let a=0;a<this.outputLayers.length;a++){let l=this.outputLayers[a],u=this.outputLayersNodeIndices[a],c=this.outputLayersTensorIndices[a],p=`${l.name}_${u}_${c}`;i.push(p)}for(let a=0;a<i.length;a++){let l=i[a];Zo(l in n),s.push(n[l])}return qr(s)}runInternalGraph(e,r){r==null&&(r=Cs(null,e.length));let n={};for(let l=0;l<this.inputs.length;++l){let u=this.inputs[l],c=e[l],p=r[l];n[u.id]=[c,p]}let o=Object.keys(this.nodesByDepth).map(l=>parseInt(l,10)).sort(Jx);for(let l of o){let u=this.nodesByDepth[l];for(let c of u){let p=c.outboundLayer,f=c.inputTensors,d=c.outputTensors,m=new Array;for(let h of f)h.id in n&&m.push(n[h.id]);if(m.length===f.length){let h={},g,x,y,b;if(c.callArgs!=null&&(h=c.callArgs),m.length===1){let[v,C]=m[0];h.mask==null&&(h.mask=C),y=Ct(p.call(v,h)),b=Ct(p.computeMask(v,C)),g=[v],x=[C]}else g=m.map(v=>v[0]),x=m.map(v=>v[1]),h.mask==null&&(h.mask=x),y=Ct(p.call(g,h)),b=Ct(p.computeMask(g,x));if(p.activityRegularizer)throw new $e("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let v=0;v<d.length;++v){let C=d[v],S=y[v],k=b[v];n[C.id]=[S,k]}}}}let s=[],i=[],a=[];for(let l of this.outputs){Zo(l.id in n,`Could not compute output ${l.name} : ${l.id}`);let[u,c]=n[l.id];a.push(u.shape),s.push(u),i.push(c)}return[s,i,a]}buildNodeConversionMap(e){let r={},n;for(let o of this.layers){n=o instanceof $o?1:0;for(let s=0;s<o.inboundNodes.length;s++){let i=$o.nodeKey(o,s);this.containerNodes.has(i)&&(r[i]=n,n+=1)}}return r}getLayer(e,r){if(r!=null){if(this.layers.length<=r)throw new z(`Was asked to retrieve layer at index ${r}, but model only has ${this.layers.length} layer(s).`);return this.layers[r]}else if(e==null)throw new z("Provide either a layer name or layer index");for(let n of this.layers)if(n.name===e)return n;throw new z(`No such layer: ${e}`)}calculateLosses(){return U(()=>{let e=[];for(let r of this.layers)for(let n=0;n<r.inboundNodes.length;++n){let o=$o.nodeKey(r,n);this.containerNodes.has(o)&&e.push(...r.calculateLosses())}return e})}getConfig(){let e={name:this.name},r=this.buildNodeConversionMap(this.layers),n=[];for(let i of this.layers){let a=i.getClassName(),l=i.getConfig(),u=[];for(let p=0;p<i.inboundNodes.length;p++){let f=i.inboundNodes[p],d=$o.nodeKey(i,p),m={};if(this.containerNodes.has(d)){if(f.callArgs)try{JSON.stringify(f.callArgs),m=f.callArgs}catch{console.warn(`Layer ${i.name} was passed non-serializable keyword arguments: ${f.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),m={}}if(f.inboundLayers.length>0){let h=[];for(let g=0;g<f.inboundLayers.length;g++){let x=f.inboundLayers[g],y=f.nodeIndices[g],b=f.tensorIndices[g],v=$o.nodeKey(x,y),C=r[v];C==null&&(C=0),h.push([x.name,C,b,m])}u.push(h)}}}let c={};c.name=i.name,c.className=a,c.config=l,c.inboundNodes=u,n.push(c)}e.layers=n;let o=[];for(let i=0;i<this.inputLayers.length;i++){let a=this.inputLayers[i],l=this.inputLayersNodeIndices[i],u=$o.nodeKey(a,l);if(!this.containerNodes.has(u))continue;let c=r[u];c==null&&(c=0);let p=this.inputLayersTensorIndices[i];o.push([a.name,c,p])}e.inputLayers=o;let s=[];for(let i=0;i<this.outputLayers.length;i++){let a=this.outputLayers[i],l=this.outputLayersNodeIndices[i],u=$o.nodeKey(a,l);if(!this.containerNodes.has(u))continue;let c=r[u];c==null&&(c=0);let p=this.outputLayersTensorIndices[i];s.push([a.name,c,p])}return e.outputLayers=s,e}static fromConfig(e,r,n={},o=!1){let s={},i={};function a(g,x){g.name in i?i[g.name].push(x):i[g.name]=[x]}function l(g,x){let y=[],b;for(let v of x){let C=v[0],S=v[1],k=v[2];if(b=v[3]==null?{}:v[3],!(C in s)){a(g,x);return}let N=s[C];if(N.inboundNodes.length<=S){a(g,x);return}let D=N.inboundNodes[S];y.push(D.outputTensors[k])}y.length>0&&g.apply(qr(y),b)}function u(g){let x=g.name,y=Do(g,r.customObjects!=null?r.customObjects:{});y.setFastWeightInitDuringBuild(o),s[x]=y,g.inboundNodes.forEach(v=>{if(!(v instanceof Array))throw new z(`Corrupted configuration, expected array for nodeData: ${v}`);a(y,v)})}let c=r.name,p=r.layers;for(let g of p)u(g);for(;!az(i);)for(let g of p){let x=s[g.name];if(x.name in i){let y=i[x.name];delete i[x.name];for(let b of y)l(x,b)}}let f=[],d=[],m=r.inputLayers;for(let g of m){let x=g[0],y=g[1],b=g[2];Zo(x in s);let C=s[x].inboundNodes[y].outputTensors;f.push(C[b])}let h=r.outputLayers;for(let g of h){let x=g[0],y=g[1],b=g[2];Zo(x in s);let C=s[x].inboundNodes[y].outputTensors;d.push(C[b])}return new e({inputs:f,outputs:d,name:c})}get stateful(){if(this._stateful)throw new z("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(let e of this.layers)if(e.stateful)return!0;return!1}resetStates(){U(()=>{this.layers.forEach(e=>{e.stateful&&e.resetStates()})})}};function Doe(t,e,r){let n=e.length;if(t==null||Array.isArray(t)&&t.length===0)return e.map(o=>null);if(n===1)return Array.isArray(t)&&t.length===1?t:typeof t=="object"&&e[0]in t?[t[e[0]]]:[t];if(Array.isArray(t)){if(t.length!==n)throw new Error(`Provided ${r} is an array of ${t.length} element(s), but the model has ${n} outputs. Make sure a set of weights is provided for each model output.`);return t}else if(typeof t=="object"&&Object.keys(t).length>0&&typeof t[Object.keys(t)[0]]=="object"){let o=[];return e.forEach(s=>{s in t?o.push(t[s]):o.push(null)}),o}else throw new Error(`The model has multiple (${n}) outputs, so ${r} must be either an array with ${n} elements or an object with ${e} keys. Provided ${r} not understood: ${JSON.stringify(t)}`)}function gw(t,e){return Doe(t,e,"classWeight")}async function xw(t,e,r,n){if(e!=null||n!=null)throw new Error("Support sampleWeight is not implemented yet");if(r!=null){let o=U(()=>{if(t.shape.length===1)return To(t);if(t.shape.length===2){if(t.shape[1]>1)return xl(t,1);if(t.shape[1]===1)return M(t,[t.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${t.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}else throw new Error(`Unexpected rank of target (y) tensor (${t.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)}),s=Array.from(await o.data());Me(o);let i=[];return s.forEach(a=>{if(r[a]==null)throw new Error(`classWeight must contain all classes in the training data. The class ${a} exists in the data but not in classWeight`);i.push(r[a])}),$r(i,"float32")}else return null}function Gz(t,e){return L(t,e)}var $oe=32;function qz(t,e){let r,n,o=e;r=o.xs,n=o.ys,w.assert(r!=null&&n!=null,()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`);let s=Uz("input",t.inputNames,r),i=Uz("output",t.outputNames,n),a=s[0].shape[0];w.assert(s.length===t.inputs.length,()=>`LayersModel has ${t.inputs.length} inputs, but the dataset provides ${s.length} inputs.  (Expected input keys: ${JSON.stringify(t.inputNames)})`),w.assert(i.length===t.outputs.length,()=>`LayersModel has ${t.outputs.length} outputs, but the dataset provides ${i.length} outputs.  (Expected output keys: ${JSON.stringify(t.outputNames)})`);for(let l=0;l<s.length;l++)w.assert(s[l].shape[0]===a,()=>`Batch size mismatch: input ${t.inputNames[l]} has ${s[l].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`);for(let l=0;l<i.length;l++)w.assert(i[l].shape[0]===a,()=>`Batch size mismatch: output ${t.outputNames[l]} has ${i[l].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`);return{xs:s,ys:i}}function Uz(t,e,r){if(r instanceof Ze)return[r];if(Array.isArray(r))return w.assert(r.length===e.length,()=>`Received an array of ${r.length} Tensors, but expected ${e.length} to match the ${t} keys ${e}.`),r;{let n=[];for(let o of e){if(r[o]==null)throw new z(`The feature data generated by the dataset lacks the required ${t} key '${o}'.`);n.push(r[o])}return n}}function Roe(t){if(t.length===3)throw new $e("Validation with sample weights is not implemented yet.");return{xs:t[0],ys:t[1]}}async function jz(t,e,r){let n=r.batchesPerEpoch!=null;if(w.assert(t.optimizer!=null,()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."),w.assert(r!=null,()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."),w.assert(r.epochs!=null&&r.epochs>0&&Number.isInteger(r.epochs),()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${r.epochs}`),w.assert(!n||r.batchesPerEpoch>0&&Number.isInteger(r.batchesPerEpoch),()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${r.batchesPerEpoch}`),w.assert(r.validationSplit==null,()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."),t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");t.isTraining=!0;try{let o=r.validationData!=null,s,i;if(o)if(Hz(r.validationData))w.assert(r.validationBatches==null||r.validationBatches>0&&Number.isInteger(r.validationBatches),()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${r.validationBatches}`);else{let g=Roe(r.validationData);s=g.xs,i=g.ys}let a=t.makeTrainFunction(),l=t.getDedupedMetricsNames(),u;o?u=l.slice().concat(l.map(g=>"val_"+g)):u=l.slice();let c=iw(r.callbacks,r.yieldEvery),p=r.verbose==null?1:r.verbose,{callbackList:f,history:d}=aw(c,p,r.epochs,null,null,Ooe(e,r),null,o,u);f.setModel(t),t.history=d,await f.onTrainBegin(),t.stopTraining_=!1;let m=r.initialEpoch==null?0:r.initialEpoch,h=await e.iterator();for(;m<r.epochs;){let g={};await f.onEpochBegin(m);let x=0,y=0;for(n||(h=await e.iterator());!n||x<r.batchesPerEpoch;){let b=await h.next();if(n&&b.done){console.warn(`You provided \`batchesPerEpoch\` as ${r.batchesPerEpoch}, but your dataset iterator ran out of data after ${x} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, ${r.batchesPerEpoch*r.epochs} batches). You may need to use the repeat() function when building your dataset.`);break}if(b.value!=null){let{xs:v,ys:C}=qz(t,b.value),S={};S.batch=y,S.size=v[0].shape[0],await f.onBatchBegin(y,S);let k=[];if(r.classWeight!=null){let $=gw(r.classWeight,t.outputNames);for(let O=0;O<$.length;++O)k.push(await xw(C[O],null,$[O]))}let N=v.concat(C).concat(k),D=a(N);Me(N);for(let $=0;$<l.length;++$){let O=l[$],V=D[$];S[O]=V,Gr(V)}await f.onBatchEnd(y,S),rw(S),y++,x++}if(n?x>=r.batchesPerEpoch:b.done){if(o){let v;Hz(r.validationData)?v=Ct(await t.evaluateDataset(r.validationData,{batches:r.validationBatches})):v=Ct(t.evaluate(s,i,{batchSize:r.validationBatchSize==null?$oe:r.validationBatchSize,verbose:0}));for(let C=0;C<t.metricsNames.length;++C)g[`val_${t.metricsNames[C]}`]=v[C]}break}if(t.stopTraining_)break}if(await f.onEpochEnd(m,g),m++,t.stopTraining_)break}return await f.onTrainEnd(),await t.history.syncData(),t.history}finally{t.isTraining=!1}}function Ooe(t,e){let r=null;return e.batchesPerEpoch!=null?r=e.batchesPerEpoch:Number.isFinite(t.size)&&(r=t.size),r}function Hz(t){return typeof t.iterator=="function"}function Foe(t){return typeof t.next=="function"}async function Kz(t,e,r){r=r||{};let n=r.batches!=null,o=t.testFunction,s=[];if(r.verbose>0)throw new $e("Verbose mode is not implemented yet.");w.assert(!n||r.batches>0&&Number.isInteger(r.batches),()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(r.batches)}`);let i=Foe(e)?e:await e.iterator(),a=0,l=0;for(;!n||l<r.batches;){let u=await i.next();if(s=U(()=>{if(u.value){let{xs:c,ys:p}=qz(t,u.value),f=c.concat(p),d=U(()=>o(f));if(Me(f),l===0)for(let h=0;h<d.length;++h)s.push(Fe(0));let m=f[0].shape[0];for(let h=0;h<d.length;++h){let g=d[h],x=s[h];s[h]=U(()=>te(s[h],L(m,g))),l>0&&Me(x)}Me(d),a+=m,++l}return s}),u.done){n&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${r.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let u=0;u<s.length;++u){let c=s[u];s[u]=xe(s[u],a),Me(c)}return qr(s)}function yw(t){w.assert(t>0&&Number.isInteger(t),()=>`batchSize is required to be a positive integer, but got ${t}`)}function mh(t,e,r){return t==null?[null]:Array.isArray(t)?t.map(n=>Nl(n,e,r-e)):Nl(t,e,r-e)}function bw(t,e){return U(()=>t==null?null:Array.isArray(t)?t.map(r=>bw(r,e)):Q1(t,e.dtype==="int32"?e:oe(e,"int32")))}function vw(t,e){let r=[],n=0,o=null;for(;n<t;)o=n+e,o>=t&&(o=t),r.push([n,o]),n=o;return r}function IE(t){let e=[];t instanceof Ze&&(t=[t]);for(let r=0;r<t.length;++r){let n=t[r];if(n.rank===1)e.push(Il(n,1));else{if(n.rank===0)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(n)}}return e}function Es(t,e){if(t==null)return;let r=[];if(e instanceof Ze)r.push(e.id);else if(Array.isArray(e))e.forEach(o=>r.push(o.id));else if(e!=null)for(let o in e){let s=e[o];r.push(s.id)}let n=[];if(t instanceof Ze)r.indexOf(t.id)===-1&&n.push(t);else if(Array.isArray(t))t.forEach(o=>{r.indexOf(o.id)===-1&&n.push(o)});else if(t!=null)for(let o in t){let s=t[o];r.indexOf(s.id)===-1&&n.push(s)}n.forEach(o=>{o.isDisposed||o.dispose()})}function Poe(t){return t instanceof Ze}function EE(t){return Array.isArray(t)}function Xz(t){return!Poe(t)&&!EE(t)}function Yz(t,e,r,n=!0,o=""){if(e==null||e.length===0){if(t!=null){let i=!1;if(EE(t)&&t.length>0)i=!0;else if(Xz(t)){for(let a in t)if(t.hasOwnProperty(a)){i=!0;break}}else i=!0;if(i)throw new z(`Error when checking model ${o} expected no data, but got ${t}`)}return[]}if(t==null)return e.map(i=>null);let s;if(Xz(t)){t=t,s=[];for(let i of e){if(t[i]==null)throw new z(`No data provided for "${i}". Need data for each key in: ${e}`);s.push(t[i])}}else if(EE(t)){if(t=t,t.length!==e.length)throw new z(`Error when checking model ${o}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${t}`);s=t}else{if(t=t,e.length>1)throw new z(`The model ${o} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${t.shape}`);s=[t]}if(s=IE(s),r!=null)for(let i=0;i<e.length;++i){if(r[i]==null)continue;let a=s[i];if(a.shape.length!==r[i].length)throw new z(`Error when checking ${o}: expected ${e[i]} to have ${r[i].length} dimension(s). but got array with shape ${a.shape}`);for(let l=0;l<r[i].length;++l){if(l===0&&!n)continue;let u=a.shape[l],c=r[i][l];if(c!=null&&c>=0&&u!==c)throw new z(`${o} expected a batch of elements where each example has shape [${r[i].slice(1,r[i].length)}] (i.e.,tensor shape [*,${r[i].slice(1,r[i].length)}]) but the ${o} received an input with ${a.shape[0]} examples, each with shape [${a.shape.slice(1,a.shape.length)}] (tensor shape [${a.shape}])`)}}return s}function Loe(t,e,r){let n=ks(t.map(s=>s.shape[0]));n.sort();let o=ks(e.map(s=>s.shape[0]));if(o.sort(),n.length>1)throw new z(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map(s=>s.shape))}`);if(o.length>1)throw new z(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map(s=>s.shape))}`);if(n.length>0&&o.length>0&&!w.arraysEqual(n,o))throw new z(`Input Tensors should have the same number of samples as target Tensors. Found ${n[0]} input sample(s) and ${o[0]} target sample(s).`)}function Moe(t,e,r){let n=[yf,fh,bf];for(let o=0;o<t.length;++o){let s=t[o],i=e[o],a=r[o];if(i!=null){if(i===bf&&s.shape[s.shape.length-1]===1)throw new z(`You are passing a target array of shape ${s.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(n.indexOf(i)!==-1){let l=s.shape.slice(1),u=a.slice(1);for(let c=0;c<l.length;++c){let p=l[c],f=u[c];if(f!=null&&p!==f)throw new z(`A target Tensor with shape ${s.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function Qz(t,e,r,n=!0,o=""){let s;if(Array.isArray(t)){if(t.length!==e.length)throw new z(`Error when checking model ${o}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${t.length} Tensors(s).`);s=t}else{if(e.length>1)throw new z(`The model expects ${e.length} ${o} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(t.shape)}.`);s=[t]}if(r!=null)for(let i=0;i<e.length;++i){if(r[i]==null)continue;let a=s[i];if(a.shape.length!==r[i].length)throw new z(`Error when checking ${o}: expected ${e[i]} to have ${r[i].length} dimension(s), but got array with shape ${JSON.stringify(a.shape)}`);for(let l=0;l<r[i].length;++l){if(l===0&&!n)continue;let u=a.shape[l],c=r[i][l];if(c!=null&&c!==u)throw new z(`Error when checking ${o}: expected ${e[i]} to have shape ${JSON.stringify(r[i])} but got array with shape ${JSON.stringify(a.shape)}.`)}}}function zoe(t,e){if(t==null||Array.isArray(t)&&t.length===0)return e.map(n=>[]);let r;if(typeof t=="string"||typeof t=="function")r=[t];else if(Array.isArray(t)||typeof t=="object")r=t;else throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${t}`);if(Array.isArray(r))return e.map(n=>r);{let n=[];for(let o of e){let s=r.hasOwnProperty(o)?r[o]:[];Array.isArray(s)||(s=[s]),n.push(s)}return n}}var Boe="layers-model",_s=class extends $o{constructor(e){super(e),this.isTraining=!1}summary(e,r,n=console.log){if(!this.built)throw new z("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");Vz(this,e,r,n)}compile(e){if(e.loss==null&&(e.loss=[]),this.loss=e.loss,typeof e.optimizer=="string")this.optimizer_=Bz(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof bn))throw new z("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}let r=[];if(!Array.isArray(e.loss)&&typeof e.loss!="string"&&typeof e.loss!="function"){e.loss=e.loss;for(let i in e.loss)if(this.outputNames.indexOf(i)===-1)throw new z(`Unknown entry in loss dictionary: "${i}". Only expected the following keys: ${this.outputNames}`);for(let i of this.outputNames)e.loss[i]==null&&console.warn(`Output "${i}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${i} during training`),r.push(uw(e.loss[i]))}else if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new z(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${e.loss}.`);r=e.loss.map(a=>uw(a))}else{let i=uw(e.loss);this.outputs.forEach(a=>{r.push(i)})}this.lossFunctions=r,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let i=0;i<this.outputs.length;++i){let a=this.internalOutputShapes[i],l=this.outputNames[i];this.feedOutputNames.push(l),this.feedOutputShapes.push(a),this.feedLossFns.push(this.lossFunctions[i])}let n=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],li("loss",()=>{for(let i=0;i<this.outputs.length;++i){if(n.indexOf(i)!==-1)continue;let a=this.lossFunctions[i];this.outputs.length>1&&(this.metricsTensors.push([a,i]),this.metricsNames.push(this.outputNames[i]+"_loss"))}});let o=zoe(e.metrics,this.outputNames),s=(i,a,l)=>{this.outputNames.length>1&&(a=this.outputNames[i]+"_"+a),this.metricsNames.push(a),this.metricsTensors.push([l,i])};li("metric",()=>{for(let i=0;i<this.outputs.length;++i){if(n.indexOf(i)!==-1)continue;let a=o[i];(u=>{let c="",p,f,d;for(let m of u){if(typeof m=="string"&&["accuracy","acc","crossentropy","ce"].indexOf(m)!==-1){let g=this.internalOutputShapes[i];g[g.length-1]===1||this.lossFunctions[i]===fh?["accuracy","acc"].indexOf(m)!==-1?f=pw:["crossentropy","ce"].indexOf(m)!==-1&&(f=CE):this.lossFunctions[i]===ph?["accuracy","acc"].indexOf(m)!==-1?f=SE:["crossentropy","ce"].indexOf(m)!==-1&&(f=kE):["accuracy","acc"].indexOf(m)!==-1?f=fw:["crossentropy","ce"].indexOf(m)!==-1&&(f=dw);let x;["accuracy","acc"].indexOf(m)!==-1?x="acc":["crossentropy","ce"].indexOf(m)!==-1&&(x="ce"),d=f,p=c+x}else d=Mz(m),p=c+by(m);let h;li(p,()=>{h=d}),s(i,p,h)}})(a)}}),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){this.collectedTrainableWeights!=null&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(e,r,n={}){let o=n.batchSize==null?32:n.batchSize;yw(o);let s=!0,i=this.standardizeUserDataXY(e,r,s,o);try{let a=i[0].concat(i[1]);this.makeTestFunction();let l=this.testFunction,u=this.testLoop(l,a,o,n.verbose,n.steps);return qr(u)}finally{Es(i[0],e),Es(i[1],r)}}async evaluateDataset(e,r){return this.makeTestFunction(),Kz(this,e,r)}checkNumSamples(e,r,n,o="steps"){let s;if(n!=null){if(s=null,r!=null)throw new z(`If ${o} is set, batchSize must be null or undefined.Got batchSize = ${r}`)}else if(e!=null)Array.isArray(e)?s=e[0].shape[0]:s=e.shape[0];else throw new z(`Either the input data should have a defined shape, or ${o} shoud be specified.`);return s}execute(e,r){if(Array.isArray(r)&&r.length===0)throw new z("`outputs` is an empty Array, which is not allowed.");let n=Array.isArray(r),o=n?r:[r],s=this.retrieveSymbolicTensors(o),i=new Is;if(e instanceof Ze&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new z(`The number of inputs provided (${e.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let l=0;l<this.inputs.length;++l)i.add(this.inputs[l],e[l])}else for(let l of this.inputs){let u=e[l.name];if(u==null)throw new z(`No value is provided for the model's input ${l.name}`);i.add(l,u)}let a=gf(s,i);return n?a:a[0]}retrieveSymbolicTensors(e){let r=Cs(null,e.length),n=e.length;for(let o of this.layers){let s=Array.isArray(o.output)?o.output:[o.output],i=s.map(a=>a.name);for(let a=0;a<e.length;++a){let l=i.indexOf(e[a]);if(l!==-1&&(r[a]=s[l],n--),n===0)break}if(n===0)break}if(n>0){let o=[];throw r.forEach((s,i)=>{s==null&&o.push(e[i])}),new z(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(o)}`)}return r}predictLoop(e,r=32,n=!1){return U(()=>{let o=this.checkNumSamples(e);if(n)throw new $e("Verbose predictLoop() is not implemented yet.");let s=vw(o,r),i=this.outputs.map(a=>[]);for(let a=0;a<s.length;++a)U(()=>{let u=s[a][0],c=s[a][1],p=mh(e,u,c),f=[];if(Array.isArray(p))for(let m=0;m<p.length;++m)f.push({key:this.inputs[m],value:p[m]});else f.push({key:this.inputs[0],value:p});let d=new Is(f);return gf(this.outputs,d)}).forEach((u,c)=>i[c].push(u));return qr(i.map(a=>$t(a,0)))})}predict(e,r={}){let n=IE(e);Qz(n,this.inputNames,this.feedInputShapes,!1);try{let o=r.batchSize==null?32:r.batchSize;return yw(o),this.predictLoop(n,o)}finally{Es(n,e)}}predictOnBatch(e){Qz(e,this.inputNames,this.feedInputShapes,!0);let r=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,r)}standardizeUserDataXY(e,r,n=!0,o){if(this.optimizer_==null)throw new wn("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");let s=[];for(let i=0;i<this.feedOutputShapes.length;++i){let a=this.feedOutputShapes[i];this.feedLossFns[i]===ph?s.push(a.slice(0,a.length-1).concat([1])):s.push(a)}if(e=Yz(e,this.feedInputNames,this.feedInputShapes,!1,"input"),r=Yz(r,this.feedOutputNames,s,!1,"target"),Loe(e,r,null),Moe(r,this.feedLossFns,this.feedOutputShapes),this.stateful&&o!=null&&o>0&&e[0].shape[0]%o!==0)throw new z(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${o}. Found: ${e[0].shape[0]} sample(s).`);return[e,r]}async standardizeUserData(e,r,n,o,s=!0,i){let[a,l]=this.standardizeUserDataXY(e,r,s,i);if(n!=null)throw new Error("sample weight is not supported yet.");let u=null;if(o!=null){let c=gw(o,this.outputNames);u=[];for(let p=0;p<c.length;++p)u.push(await xw(l[p],null,c[p]))}return[a,l,u]}testLoop(e,r,n,o=0,s){return U(()=>{let i=this.checkNumSamples(r,n,s,"steps"),a=[];if(o>0)throw new $e("Verbose mode is not implemented yet.");if(s!=null)throw new $e("steps mode in testLoop() is not implemented yet");{let l=vw(i,n),u=$r(Kn(0,i));for(let c=0;c<l.length;++c){let p=l[c][0],f=l[c][1],d=Nl(u,p,f-p),m=bw(r,d),h=e(m);if(c===0)for(let g=0;g<h.length;++g)a.push(Fe(0));for(let g=0;g<h.length;++g){let x=h[g];a[g]=te(a[g],L(f-p,x))}}for(let c=0;c<a.length;++c)a[c]=xe(a[c],i)}return a})}getDedupedMetricsNames(){let e=this.metricsNames,r=[];for(let n=0;n<e.length;++n){let o=e[n],s=o;if(fE(e,o)>1){let i=fE(e.slice(0,n),o);s+=`_${i}`}r.push(s)}return r}makeTrainFunction(){return e=>{let r=[],n=e.slice(0,this.inputs.length),o=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),s=e.slice(this.inputs.length+this.outputs.length,this.inputs.length+this.outputs.length*2),i=[],a=()=>{let p=[];for(let h=0;h<this.inputs.length;++h)p.push({key:this.inputs[h],value:n[h]});let f=new Is(p),d=gf(this.outputs,f,{training:!0}),m;for(let h=0;h<this.lossFunctions.length;++h){let g=this.lossFunctions[h],x=g(o[h],d[h]);s[h]!=null&&(x=Gz(x,s[h]));let y=Vt(x);r.push(y),h===0?m=x:m=te(m,x)}for(let h=0;h<this.metricsTensors.length;++h){let g;if(this.outputs.length>1&&h<this.outputs.length)g=r[h];else{let x=this.metricsTensors[h][0],y=this.metricsTensors[h][1];g=Vt(x(o[y],d[y]))}Gr(g),i.push(g)}return m=Vt(m),this.calculateLosses().forEach(h=>{m=te(m,h)}),m},l=this.collectedTrainableWeights.map(p=>p.read()),u=!0;return[this.optimizer_.minimize(a,u,l)].concat(i)}}makeTestFunction(){this.testFunction=e=>U(()=>{let r=[],n,o=e.slice(0,this.inputs.length),s=e.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=[];for(let u=0;u<this.inputs.length;++u)i.push({key:this.inputs[u],value:o[u]});let a=new Is(i),l=gf(this.outputs,a);for(let u=0;u<this.lossFunctions.length;++u){let c=this.lossFunctions[u],p=Vt(c(s[u],l[u]));u===0?n=p:n=te(n,p),r.push(n)}for(let u=0;u<this.metricsTensors.length;++u){let c=this.metricsTensors[u][0],p=this.metricsTensors[u][1],f=Vt(c(s[p],l[p]));r.push(f)}return r})}async fit(e,r,n={}){if(this.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");this.isTraining=!0;let o,s,i,a,l,u,c,p,f;try{let d=n.batchSize==null?32:n.batchSize;yw(d);let m=!1,h=await this.standardizeUserData(e,r,n.sampleWeight,n.classWeight,m,d);o=h[0],s=h[1],f=h[2];let g=!1,x;if(n.validationData!=null&&n.validationData.length>0){if(g=!0,n.validationData.length===2)l=n.validationData[0],u=n.validationData[1];else throw n.validationData.length===3?new $e("validationData including sample weights is not supported yet."):new z(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${n.validationData} is invalid.`);let D=!0,$=await this.standardizeUserData(l,u,null,null,D,d);c=$[0],p=$[1],x=c.concat(p)}else if(n.validationSplit!=null&&n.validationSplit>0&&n.validationSplit<1){g=!0;let D=Math.floor(o[0].shape[0]*(1-n.validationSplit)),$=o[0].shape[0];c=mh(o,D,$),i=o,o=mh(o,0,D),p=mh(s,D,$),a=s,s=mh(s,0,D),x=c.concat(p)}else n.validationSteps!=null&&(g=!0);let y=o.concat(s).concat(f);this.checkTrainableWeightsConsistency();let b=this.makeTrainFunction(),v=this.getDedupedMetricsNames(),C,S;g?(this.makeTestFunction(),C=this.testFunction,S=v.slice().concat(v.map(D=>"val_"+D))):(C=null,x=[],S=v.slice());let k=iw(n.callbacks,n.yieldEvery);return await this.fitLoop(b,y,v,d,n.epochs,n.verbose,k,C,x,n.shuffle,S,n.initialEpoch,null,null)}finally{this.isTraining=!1,Es(o,e),Es(s,r),Es(i,e),Es(a,r),Es(c,l),Es(p,u),f!=null&&Me(f)}}async fitLoop(e,r,n,o,s,i,a,l,u,c,p,f,d,m){o==null&&(o=32),s==null&&(s=1),c==null&&(c=!0),f==null&&(f=0);let h=!1;if(l!=null&&u!=null&&(h=!0),m!=null&&(h=!0,d==null))throw new z("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");let g=this.checkNumSamples(r,o,d,"steps_per_epoch"),x;g!=null&&(x=Kn(0,g)),i==null&&(i=1);let{callbackList:y,history:b}=aw(a,i,s,f,g,d,o,h,p);y.setModel(this),this.history=b,await y.onTrainBegin(),this.stopTraining_=!1;for(let v=f;v<s;++v){await y.onEpochBegin(v);let C={};if(d!=null)throw new $e("stepsPerEpoch mode is not implemented yet.");{if(c==="batch")throw new $e("batch shuffling is not implemneted yet");c&&w.shuffle(x);let S=$r(x),k=vw(g,o);for(let N=0;N<k.length;++N){let D={};if(await y.onBatchBegin(N,D),U(()=>{let $=k[N][0],O=k[N][1],V=Nl(S,$,O-$);D.batch=N,D.size=O-$;let K=bw(r,V),X=e(K);for(let W=0;W<n.length;++W){let H=n[W],Y=X[W];D[H]=Y,Gr(Y)}if(N===k.length-1&&h){let W=this.testLoop(l,u,o);for(let H=0;H<n.length;++H){let Y=n[H],Z=W[H];Gr(Z),C["val_"+Y]=Z}}}),await y.onBatchEnd(N,D),rw(D),this.stopTraining_)break}S.dispose()}if(await y.onEpochEnd(v,C),this.stopTraining_)break}return await y.onTrainEnd(),await this.history.syncData(),this.history}async fitDataset(e,r){return jz(this,e,r)}async trainOnBatch(e,r){let n=await this.standardizeUserData(e,r),o=n[0],s=n[1],a=this.makeTrainFunction()(o.concat(s)),l=[];for(let u of a){let c=await u.data();l.push(c[0])}return Me(a),Es(n[0],e),Es(n[1],r),qr(l)}getNamedWeights(e){let r=[],n=e!=null&&e.trainableOnly,o=n?this.trainableWeights:this.weights,s=this.getWeights(n);for(let i=0;i<o.length;++i)n&&!o[i].trainable||r.push({name:o[i].originalName,tensor:s[i]});return r}set stopTraining(e){this.stopTraining_=e}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}dispose(){let e=super.dispose();if(e.refCountAfterDispose===0&&this.optimizer!=null&&this.isOptimizerOwned){let r=Ix().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=r-Ix().numTensors}return e}getLossIdentifiers(){let e;if(typeof this.loss=="string")e=Ss(this.loss);else if(Array.isArray(this.loss)){for(let r of this.loss)if(typeof r!="string")throw new Error("Serialization of non-string loss is not supported.");e=this.loss.map(r=>Ss(r))}else{let r=Object.keys(this.loss);e={};let n=this.loss;for(let o of r)if(typeof n[o]=="string")e[o]=Ss(n[o]);else throw new Error("Serialization of non-string loss is not supported.")}return e}getMetricIdentifiers(){if(typeof this.metrics=="string"||typeof this.metrics=="function")return[Ss(by(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map(e=>Ss(by(e)));{let e={};for(let r in this.metrics)e[r]=Ss(by(this.metrics[r]));return e}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(e){if(e.weighted_metrics!=null)throw new Error("Loading weight_metrics is not supported yet.");if(e.loss_weights!=null)throw new Error("Loading loss_weights is not supported yet.");if(e.sample_weight_mode!=null)throw new Error("Loading sample_weight_mode is not supported yet.");let r=vy(e.optimizer_config),n=Do(r),o;if(typeof e.loss=="string")o=Tl(e.loss);else if(Array.isArray(e.loss))o=e.loss.map(i=>Tl(i));else if(e.loss!=null){o={};for(let i in e.loss)o[i]=Tl(e.loss[i])}let s;if(Array.isArray(e.metrics))s=e.metrics.map(i=>Tl(i));else if(e.metrics!=null){s={};for(let i in e.metrics)s[i]=Tl(e.metrics[i])}this.compile({loss:o,metrics:s,optimizer:n})}async save(e,r){if(typeof e=="string"){let u=gl.getSaveHandlers(e);if(u.length===0)throw new z(`Cannot find any save handlers for URL '${e}'`);if(u.length>1)throw new z(`Found more than one (${u.length}) save handlers for URL '${e}'`);e=u[0]}if(e.save==null)throw new z("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");let n=await gl.encodeWeights(this.getNamedWeights(r)),o=!1,s=null,a={modelTopology:this.toJSON(s,o),format:Boe,generatedBy:`TensorFlow.js tfjs-layers v${dh}`,convertedBy:null};if((r==null?!1:r.includeOptimizer)&&this.optimizer!=null){a.trainingConfig=this.getTrainingConfig();let u="optimizer",{data:c,specs:p}=await gl.encodeWeights(await this.optimizer.getWeights(),u);n.specs.push(...p),n.data=gl.concatenateArrayBuffers([n.data,c])}return this.userDefinedMetadata!=null&&(NE(this.userDefinedMetadata,this.name,!0),a.userDefinedMetadata=this.userDefinedMetadata),a.weightData=n.data,a.weightSpecs=n.specs,e.save(a)}setUserDefinedMetadata(e){NE(e,this.name),this.userDefinedMetadata=e}getUserDefinedMetadata(){return this.userDefinedMetadata}};_s.className="Model";J.registerClass(_s);var ww=class extends _s{};ww.className="Functional";J.registerClass(ww);var Al=class extends _s{constructor(e){if(super({inputs:[],outputs:[]}),e=e||{},this.trainable=!0,this.built=!1,this.name=e.name!=null?e.name:vc("sequential_"),e.layers!=null)for(let r of e.layers)this.add(r)}checkShape(e){if(e.inboundNodes[0].outputTensors[0].shape.some(n=>n<0))throw new z(`Negative dimension size caused by adding layer ${e.name} with input shape [${e.inboundNodes[0].inputTensors[0].shape}]`)}add(e){let r=e instanceof Al||e instanceof _s,n;if(r){if(n=e,n.outputs.length!==1)throw new z("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(n.inputs.length!==1)throw new z("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(this.outputs.length===0){if(e.inboundNodes.length===0){if(e.batchInputShape==null)throw new z("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");let o=bE({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(o)}if(r)this.outputs=n.outputs,this.inputs=n.inputs;else{if(e.inboundNodes.length!==1)throw new z(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${e.name} which has ${e.inboundNodes.length} pre-existing inbound connections.`);if(e.inboundNodes[0].outputTensors.length!==1)throw new z("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=yE(this.outputs[0])}this.inboundNodes=[],new El({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Cs(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map(o=>o.shape),outputShapes:this.outputs[0].shape})}else{let o=e.apply(this.outputs[0]);if(Array.isArray(o))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[o],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}pop(){if(this.layers.length===0)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),this.layers.length===0)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{let e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(e,r){return this.model==null&&this.build(),this.model.call(e,r)}build(e){if(Ue(e),this.inputs.length===0||this.outputs.length===0)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new _s({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(e,r,n=console.log){this.built||this.build(),super.summary(e,r,n)}setWeights(e){this.model==null&&this.build(),this.model.setWeights(e)}evaluate(e,r,n={}){if(!this.built)throw new wn("The model needs to be compiled before being used.");return this.model.evaluate(e,r,n)}async evaluateDataset(e,r){if(!this.built)throw new wn("The model needs to be compiled before being used.");return this.model.evaluateDataset(e,r)}predict(e,r={}){return this.model==null&&this.build(),this.model.predict(e,r)}predictOnBatch(e){return this.model==null&&this.build(),this.model.predictOnBatch(e)}compile(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return this.model==null?void 0:this.model.optimizer}set optimizer(e){this.model.optimizer=e}async fit(e,r,n={}){if(!this.built)throw new wn("The model needs to be compiled before being used.");return this.model.fit(e,r,n)}async fitDataset(e,r){if(!this.built)throw new wn("The model needs to be compiled before being used.");return this.model.fitDataset(e,r)}async trainOnBatch(e,r){return this.model.trainOnBatch(e,r)}static fromConfig(e,r,n={},o=!1){let s,i={};if(r instanceof Array){if(r[0].className==null||r[0].className==="Merge")throw new z("Legacy serialization format not supported yet.");s=r}else w.assert(r.layers!=null,()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."),s=r.layers,delete r.layers,i=r;let a=new e(i);if(!(a instanceof Al))throw new $e(`Sequential.fromConfig called on non-Sequential input: ${a}`);for(let l of s){let c=Do(l,void 0,o);o&&c.setFastWeightInitDuringBuild(!0),a.add(c)}return a}set stopTraining(e){if(this.model==null)throw new z("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}get stopTraining(){if(this.model==null)throw new z("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){let e=[];for(let r of this.layers){let n={};n.className=r.getClassName(),n.config=r.getConfig(),e.push(n)}return{name:this.name,layers:e}}};Al.className="Sequential";J.registerClass(Al);var Fn=class extends J.Serializable{getConfig(){return{}}},Cw=class extends Fn{apply(e,r=1){return Cz(e,r)}};Cw.className="elu";J.registerClass(Cw);var Sw=class extends Fn{apply(e){return Wx(e)}};Sw.className="selu";J.registerClass(Sw);var kw=class extends Fn{apply(e){return Ao(e)}};kw.className="relu";J.registerClass(kw);var Tw=class extends Fn{apply(e){return U(()=>tf(6,Ao(e)))}};Tw.className="relu6";J.registerClass(Tw);var Nw=class extends Fn{apply(e){return e}};Nw.className="linear";J.registerClass(Nw);var Iw=class extends Fn{apply(e){return xs(e)}};Iw.className="sigmoid";J.registerClass(Iw);var Ew=class extends Fn{apply(e){return kz(e)}};Ew.className="hardSigmoid";J.registerClass(Ew);var _w=class extends Fn{apply(e){return Ui(e)}};_w.className="softplus";J.registerClass(_w);var Aw=class extends Fn{apply(e){return Sz(e)}};Aw.className="softsign";J.registerClass(Aw);var Dw=class extends Fn{apply(e){return Om(e)}};Dw.className="tanh";J.registerClass(Dw);var hh=class extends Fn{apply(e,r=-1){return sf(e,r)}};hh.className="softmax";J.registerClass(hh);var $w=class extends Fn{apply(e,r=-1){return Mx(e,r)}};$w.className="logSoftmax";J.registerClass($w);var Rw=class extends Fn{apply(e,r=1){return U(()=>L(xs(L(e,r)),e))}};Rw.className="swish";J.registerClass(Rw);var Ow=class extends Fn{apply(e){return U(()=>L(e,Om(Ui(e))))}};Ow.className="mish";J.registerClass(Ow);function ci(t){return t.getClassName()}function _E(t,e={}){return ji(t,J.SerializationMap.getMap().classNameMap,e,"activation")}function pi(t){if(t==null){let e={};return e.className="linear",e.config={},_E(e)}if(typeof t=="string"){let e={};return e.className=t,e.config={},_E(e)}else return t instanceof Fn?t:_E(t)}function Woe(t){if(t!=null&&typeof t!="object")throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${t}`)}var Fw=class extends J.Serializable{},wy=class extends Fw{constructor(e){super(),Woe(e),this.l1=e==null||e.l1==null?.01:e.l1,this.l2=e==null||e.l2==null?.01:e.l2,this.hasL1=this.l1!==0,this.hasL2=this.l2!==0}apply(e){return U(()=>{let r=Ot([1]);return this.hasL1&&(r=te(r,ye(L(this.l1,Sr(e))))),this.hasL2&&(r=te(r,ye(L(this.l2,mf(e))))),M(r,[])})}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(e,r){return new e({l1:r.l1,l2:r.l2})}};wy.className="L1L2";J.registerClass(wy);var Zz={l1l2:"L1L2"};function ft(t){return Zm(t)}function Jz(t,e={}){return ji(t,J.SerializationMap.getMap().classNameMap,e,"regularizer")}function kt(t){if(t==null)return null;if(typeof t=="string"){let r={className:t in Zz?Zz[t]:t,config:{}};return Jz(r)}else return t instanceof Fw?t:Jz(t)}var Cy=class extends ze{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null&&(this.maxValue=e.maxValue)}call(e,r){e=Re(e);let n=Ao(e);return this.maxValue!=null&&(n=sn(n,0,this.maxValue)),n}computeOutputShape(e){return e}getConfig(){let e={maxValue:this.maxValue},r=super.getConfig();return Object.assign(e,r),e}};Cy.className="ReLU";J.registerClass(Cy);var Sy=class extends ze{constructor(e){super(e??{}),this.DEFAULT_ALPHA=.3,e==null&&(e={}),this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,r){let n=Re(e);return Jp(n,this.alpha)}computeOutputShape(e){return e}getConfig(){let e={alpha:this.alpha},r=super.getConfig();return Object.assign(e,r),e}};Sy.className="LeakyReLU";J.registerClass(Sy);var ky=class extends ze{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA_INITIALIZER="zeros",e==null&&(e={}),this.supportsMasking=!0,this.alphaInitializer=xt(e.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=kt(e.alphaRegularizer),this.alphaConstraint=Xt(e.alphaConstraint),e.sharedAxes==null)this.sharedAxes=null;else if(Array.isArray(e.sharedAxes))this.sharedAxes=e.sharedAxes;else if(typeof e.sharedAxes=="number")this.sharedAxes=[e.sharedAxes];else throw new z(`Expected sharedAxes to be a number or an array of numbers, but got ${e.sharedAxes}`)}build(e){e=Ue(e);let r=e.slice(1);if(this.sharedAxes!=null)for(let o of this.sharedAxes)r[o-1]=1;this.alpha=this.addWeight("alpha",r,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);let n={};if(this.sharedAxes!=null)for(let o=1;o<e.length;++o)n[o]=e[o];this.inputSpec=[new St({ndim:e.length,axes:n})],this.built=!0}call(e,r){return e=Re(e),nf(e,this.alpha.read())}getConfig(){let e={alphaInitializer:Et(this.alphaInitializer),alphaRegularizer:ft(this.alphaRegularizer),alphaConstraint:Kt(this.alphaConstraint),sharedAxes:this.sharedAxes},r=super.getConfig();return Object.assign(e,r),e}};ky.className="PReLU";J.registerClass(ky);var Ty=class extends ze{constructor(e){if(super(e??{}),this.DEFAULT_ALPHA=1,e==null&&(e={}),e.alpha!=null&&e.alpha!==this.DEFAULT_ALPHA)throw new $e(`Non-default alpha value (${e.alpha}) is not supported by the ELU layer yet.`);this.alpha=e.alpha==null?this.DEFAULT_ALPHA:e.alpha}call(e,r){let n=Re(e);return wl(n)}computeOutputShape(e){return e}getConfig(){let e={alpha:this.alpha},r=super.getConfig();return Object.assign(e,r),e}};Ty.className="ELU";J.registerClass(Ty);var Ny=class extends ze{constructor(e){super(e??{}),this.DEFAULT_THETA=1,e==null&&(e={}),this.theta=e.theta==null?this.DEFAULT_THETA:e.theta}call(e,r){let n=Re(e);return L(n,oe(er(n,this.theta),"float32"))}computeOutputShape(e){return e}getConfig(){let e={theta:this.theta},r=super.getConfig();return Object.assign(e,r),e}};Ny.className="ThresholdedReLU";J.registerClass(Ny);var Iy=class extends ze{constructor(e){super(e??{}),this.DEFAULT_AXIS=1,e==null&&(e={}),this.softmax=new hh().apply,this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis}call(e,r){let n=Re(e);return this.softmax(n,this.axis)}computeOutputShape(e){return e}getConfig(){let e={axis:this.axis},r=super.getConfig();return Object.assign(e,r),e}};Iy.className="Softmax";J.registerClass(Iy);function Sc(t,e,r){if(typeof t=="number")return Cs(t,e);if(t.length!==e)throw new z(`The ${r} argument must be an integer or tuple of ${e} integers. Received: ${t.length} elements.`);for(let n=0;n<e;++n){let o=t[n];if(!yz(o))throw new z(`The ${r} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(t)} including a non-integer number ${o}`)}return t}function uo(t,e,r,n,o=1){if(t==null)return t;let s=e+(e-1)*(o-1),i;return r==="same"?i=t:i=t-s+1,Math.floor((i+n-1)/n)}function fi(t,e,r,n){if(t==null)return null;if(n==="valid")t=t*e+ui([r-e,0]);else if(n==="same")t=t*e;else throw new z(`Unsupport padding mode: ${n}.`);return t}function Ry(t,e){return U(()=>(Wt(e),e==="channelsFirst"?Ge(t,[0,2,3,1]):t))}function AE(t,e){return U(()=>(Wt(e),e==="channelsFirst"?Ge(t,[0,2,3,4,1]):t))}function Uoe(t,e,r,n=1,o="valid",s,i=1){return U(()=>{if(s==null&&(s=Xn()),Wt(s),t.shape.length!==3)throw new z(`The input of a conv1dWithBias operation should be 3, but is ${t.shape.length} instead.`);if(e.shape.length!==3)throw new z(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(r!=null&&r.shape.length!==1)throw new z(`The bias for a conv1dWithBias operation should be 1, but is ${e.shape.length} instead`);if(s==="channelsFirst"&&(t=Ge(t,[0,2,1])),o==="causal")throw new $e("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=Dx(t,e,n,o==="same"?"same":"valid","NWC",i);return r!=null&&(a=Yn(a,r)),a})}function eB(t,e,r,n=[1,1],o="valid",s,i,a=null){return U(()=>{if(s==null&&(s=Xn()),Wt(s),t.rank!==3&&t.rank!==4)throw new z(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${t.rank}.`);if(e.rank!==3&&e.rank!==4)throw new z(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${t.rank}.`);let l=Ry(t,s);if(o==="causal")throw new $e("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return l=pf.conv2d({x:l,filter:e,strides:n,pad:o==="same"?"same":"valid",dilations:i,dataFormat:"NHWC",bias:r,activation:a}),s==="channelsFirst"&&(l=Ge(l,[0,3,1,2])),l})}function Hoe(t,e,r,n=[1,1,1],o="valid",s,i){return U(()=>{if(s==null&&(s=Xn()),Wt(s),t.rank!==4&&t.rank!==5)throw new z(`conv3dWithBias expects input to be of rank 4 or 5, but received ${t.rank}.`);if(e.rank!==4&&e.rank!==5)throw new z(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${t.rank}.`);let a=AE(t,s);if(o==="causal")throw new $e("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=E2(a,e,n,o==="same"?"same":"valid","NDHWC",i),r!=null&&(a=Yn(a,r)),s==="channelsFirst"&&(a=Ge(a,[0,4,1,2,3])),a})}var vf=class extends ze{constructor(e,r){if(super(r),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",vf.verifyArgs(r),this.rank=e,ir(this.rank,"rank"),this.rank!==1&&this.rank!==2&&this.rank!==3)throw new $e(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=Sc(r.kernelSize,e,"kernelSize"),this.strides=Sc(r.strides==null?1:r.strides,e,"strides"),this.padding=r.padding==null?"valid":r.padding,jn(this.padding),this.dataFormat=r.dataFormat==null?"channelsLast":r.dataFormat,Wt(this.dataFormat),this.activation=pi(r.activation),this.useBias=r.useBias==null?!0:r.useBias,this.biasInitializer=xt(r.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=Xt(r.biasConstraint),this.biasRegularizer=kt(r.biasRegularizer),this.activityRegularizer=kt(r.activityRegularizer),this.dilationRate=Sc(r.dilationRate==null?1:r.dilationRate,e,"dilationRate"),this.rank===1&&Array.isArray(this.dilationRate)&&this.dilationRate.length!==1)throw new z(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(this.rank===2){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==2)throw new z(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(this.rank===3){if(typeof this.dilationRate=="number")this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(this.dilationRate.length!==3)throw new z(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}}static verifyArgs(e){if(Zo("kernelSize"in e,"required key 'kernelSize' not in config"),typeof e.kernelSize!="number"&&!G1(e.kernelSize,"number",1,3))throw new z(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(e.kernelSize)}.`)}getConfig(){let e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:ci(this.activation),useBias:this.useBias,biasInitializer:Et(this.biasInitializer),biasRegularizer:ft(this.biasRegularizer),activityRegularizer:ft(this.activityRegularizer),biasConstraint:Kt(this.biasConstraint)},r=super.getConfig();return Object.assign(e,r),e}},kc=class extends vf{constructor(e,r){super(e,r),this.kernel=null,kc.verifyArgs(r),this.filters=r.filters,ir(this.filters,"filters"),this.kernelInitializer=xt(r.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=Xt(r.kernelConstraint),this.kernelRegularizer=kt(r.kernelRegularizer)}build(e){e=Ue(e);let r=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[r]==null)throw new z(`The channel dimension of the input should be defined. Found ${e[r]}`);let n=e[r],o=this.kernelSize.concat([n,this.filters]);this.kernel=this.addWeight("kernel",o,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[r]:n}}],this.built=!0}call(e,r){return U(()=>{e=Re(e);let n,o=this.bias==null?null:this.bias.read(),s=U1(this.activation.getClassName());if(s!=null&&this.rank===2)n=eB(e,this.kernel.read(),o,this.strides,this.padding,this.dataFormat,this.dilationRate,s);else{if(this.rank===1)n=Uoe(e,this.kernel.read(),o,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(this.rank===2)n=eB(e,this.kernel.read(),o,this.strides,this.padding,this.dataFormat,this.dilationRate);else if(this.rank===3)n=Hoe(e,this.kernel.read(),o,this.strides,this.padding,this.dataFormat,this.dilationRate);else throw new $e("convolutions greater than 3D are not implemented yet.");this.activation!=null&&(n=this.activation.apply(n))}return n})}computeOutputShape(e){e=Ue(e);let r=[],n=this.dataFormat==="channelsLast"?e.slice(1,e.length-1):e.slice(2);for(let s=0;s<n.length;++s){let i=uo(n[s],this.kernelSize[s],this.padding,this.strides[s],typeof this.dilationRate=="number"?this.dilationRate:this.dilationRate[s]);r.push(i)}let o=[e[0]];return this.dataFormat==="channelsLast"?(o=o.concat(r),o.push(this.filters)):(o.push(this.filters),o=o.concat(r)),o}getConfig(){let e={filters:this.filters,kernelInitializer:Et(this.kernelInitializer),kernelRegularizer:ft(this.kernelRegularizer),kernelConstraint:Kt(this.kernelConstraint)},r=super.getConfig();return Object.assign(e,r),e}static verifyArgs(e){if(!("filters"in e)||typeof e.filters!="number"||e.filters<1)throw new z(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(e.filters)}`)}},Tc=class extends kc{constructor(e){super(2,e),Tc.verifyArgs(e)}getConfig(){let e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!G1(e.kernelSize,"number",1,2))throw new z(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(e.kernelSize)}.`)}};Tc.className="Conv2D";J.registerClass(Tc);var Nc=class extends kc{constructor(e){super(3,e),Nc.verifyArgs(e)}getConfig(){let e=super.getConfig();return delete e.rank,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!(Array.isArray(e.kernelSize)&&(e.kernelSize.length===1||e.kernelSize.length===3)))throw new z(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(e.kernelSize)}.`)}};Nc.className="Conv3D";J.registerClass(Nc);var Ey=class extends Tc{constructor(e){if(super(e),this.inputSpec=[new St({ndim:4})],this.padding!=="same"&&this.padding!=="valid")throw new z(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Ue(e),e.length!==4)throw new z("Input should have rank 4; Received input shape: "+JSON.stringify(e));let r=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[r]==null)throw new z("The channel dimension of the inputs should be defined. Found `None`.");let n=e[r],o=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",o,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new St({ndim:4,axes:{[r]:n}})],this.built=!0}call(e,r){return U(()=>{let n=Re(e);if(n.shape.length!==4)throw new z(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${n.shape.length}`);let o=n.shape,s=o[0],i,a;this.dataFormat==="channelsFirst"?(i=2,a=3):(i=1,a=2);let l=o[i],u=o[a],c=this.kernelSize[0],p=this.kernelSize[1],f=this.strides[0],d=this.strides[1],m=fi(l,f,c,this.padding),h=fi(u,d,p,this.padding),g=[s,m,h,this.filters];this.dataFormat!=="channelsLast"&&(n=Ge(n,[0,2,3,1]));let x=$x(n,this.kernel.read(),g,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(x=Ge(x,[0,3,1,2])),this.bias!=null&&(x=Yn(x,this.bias.read(),this.dataFormat)),this.activation!=null&&(x=this.activation.apply(x)),x})}computeOutputShape(e){e=Ue(e);let r=e.slice(),n,o,s;this.dataFormat==="channelsFirst"?(n=1,o=2,s=3):(n=3,o=1,s=2);let i=this.kernelSize[0],a=this.kernelSize[1],l=this.strides[0],u=this.strides[1];return r[n]=this.filters,r[o]=fi(r[o],l,i,this.padding),r[s]=fi(r[s],u,a,this.padding),r}getConfig(){let e=super.getConfig();return delete e.dilationRate,e}};Ey.className="Conv2DTranspose";J.registerClass(Ey);var _y=class extends Nc{constructor(e){if(super(e),this.inputSpec=[new St({ndim:5})],this.padding!=="same"&&this.padding!=="valid")throw new z(`Conv3DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(e){if(e=Ue(e),e.length!==5)throw new z("Input should have rank 5; Received input shape: "+JSON.stringify(e));let r=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[r]==null)throw new z("The channel dimension of the inputs should be defined. Found `None`.");let n=e[r],o=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",o,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new St({ndim:5,axes:{[r]:n}})],this.built=!0}call(e,r){return U(()=>{let n=Re(e);if(n.shape.length!==5)throw new z(`Conv3DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${n.shape.length}`);let o=n.shape,s=o[0],i,a,l;this.dataFormat==="channelsFirst"?(l=2,i=3,a=4):(l=1,i=2,a=3);let u=o[l],c=o[i],p=o[a],f=this.kernelSize[0],d=this.kernelSize[1],m=this.kernelSize[2],h=this.strides[0],g=this.strides[1],x=this.strides[2],y=fi(u,h,f,this.padding),b=fi(c,g,d,this.padding),v=fi(p,x,m,this.padding),C=[s,y,b,v,this.filters];this.dataFormat!=="channelsLast"&&(n=Ge(n,[0,2,3,4,1]));let S=_2(n,this.kernel.read(),C,this.strides,this.padding);return this.dataFormat!=="channelsLast"&&(S=Ge(S,[0,4,1,2,3])),this.bias!==null&&(S=Yn(S,this.bias.read(),this.dataFormat)),this.activation!==null&&(S=this.activation.apply(S)),S})}computeOutputShape(e){e=Ue(e);let r=e.slice(),n,o,s,i;this.dataFormat==="channelsFirst"?(n=1,o=2,s=3,i=4):(n=4,o=1,s=2,i=3);let a=this.kernelSize[0],l=this.kernelSize[1],u=this.kernelSize[2],c=this.strides[0],p=this.strides[1],f=this.strides[2];return r[n]=this.filters,r[o]=fi(r[o],c,a,this.padding),r[s]=fi(r[s],p,l,this.padding),r[i]=fi(r[i],f,u,this.padding),r}getConfig(){let e=super.getConfig();return delete e.dilationRate,e}};_y.className="Conv3DTranspose";J.registerClass(_y);var Pw=class extends kc{constructor(e,r){if(super(e,r),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,r.filters==null)throw new z("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(r.kernelInitializer!=null||r.kernelRegularizer!=null||r.kernelConstraint!=null)throw new z("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(r.padding!=null&&r.padding!=="same"&&r.padding!=="valid")throw new z(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(r.padding)}`);this.depthMultiplier=r.depthMultiplier==null?1:r.depthMultiplier,this.depthwiseInitializer=xt(r.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=kt(r.depthwiseRegularizer),this.depthwiseConstraint=Xt(r.depthwiseConstraint),this.pointwiseInitializer=xt(r.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=kt(r.pointwiseRegularizer),this.pointwiseConstraint=Xt(r.pointwiseConstraint)}build(e){if(e=Ue(e),e.length<this.rank+2)throw new z(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(e)}`);let r=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[r]==null||e[r]<0)throw new z(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(e[r])}`);let n=e[r],o=this.kernelSize.concat([n,this.depthMultiplier]),s=[];for(let a=0;a<this.rank;++a)s.push(1);s.push(n*this.depthMultiplier,this.filters);let i=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",o,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,i,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",s,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,i,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,i,this.biasConstraint):this.bias=null,this.inputSpec=[new St({ndim:this.rank+2,axes:{[r]:n}})],this.built=!0}call(e,r){return U(()=>{e=Re(e);let n;if(this.rank===1)throw new $e("1D separable convolution is not implemented yet.");return this.rank===2&&(this.dataFormat==="channelsFirst"&&(e=Ge(e,[0,2,3,1])),n=Gx(e,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(n=Yn(n,this.bias.read(),this.dataFormat)),this.activation!=null&&(n=this.activation.apply(n)),this.dataFormat==="channelsFirst"&&(n=Ge(n,[0,3,1,2])),n})}getConfig(){let e=super.getConfig();return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=Et(this.depthwiseInitializer),e.pointwiseInitializer=Et(this.pointwiseInitializer),e.depthwiseRegularizer=ft(this.depthwiseRegularizer),e.pointwiseRegularizer=ft(this.pointwiseRegularizer),e.depthwiseConstraint=Kt(this.depthwiseConstraint),e.pointwiseConstraint=Kt(this.pointwiseConstraint),e}};Pw.className="SeparableConv";var Ay=class extends Pw{constructor(e){super(2,e)}};Ay.className="SeparableConv2D";J.registerClass(Ay);var wf=class extends kc{constructor(e){super(1,e),wf.verifyArgs(e),this.inputSpec=[{ndim:3}]}getConfig(){let e=super.getConfig();return delete e.rank,delete e.dataFormat,e}static verifyArgs(e){if(typeof e.kernelSize!="number"&&!G1(e.kernelSize,"number",1,1))throw new z(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(e.kernelSize)}.`)}};wf.className="Conv1D";J.registerClass(wf);var Dy=class extends ze{constructor(e){super(e),typeof e.cropping=="number"?this.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:typeof e.cropping[0]=="number"?this.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:this.cropping=e.cropping,this.dataFormat=e.dataFormat===void 0?"channelsLast":e.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(e){return this.dataFormat==="channelsFirst"?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}call(e,r){return U(()=>{if(e=Re(e),this.dataFormat==="channelsLast"){let n=ty(e,this.cropping[0][0],e.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return ty(n,this.cropping[1][0],e.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}else{let n=ty(e,this.cropping[0][0],e.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return ty(n,this.cropping[1][0],e.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}})}getConfig(){let e={cropping:this.cropping,dataFormat:this.dataFormat},r=super.getConfig();return Object.assign(e,r),e}};Dy.className="Cropping2D";J.registerClass(Dy);var $y=class extends ze{constructor(e){super(e),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=e.size==null?this.DEFAULT_SIZE:e.size,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Wt(this.dataFormat),this.interpolation=e.interpolation==null?"nearest":e.interpolation,gz(this.interpolation)}computeOutputShape(e){if(this.dataFormat==="channelsFirst"){let r=e[2]==null?null:this.size[0]*e[2],n=e[3]==null?null:this.size[1]*e[3];return[e[0],e[1],r,n]}else{let r=e[1]==null?null:this.size[0]*e[1],n=e[2]==null?null:this.size[1]*e[2];return[e[0],r,n,e[3]]}}call(e,r){return U(()=>{let n=Re(e),o=n.shape;if(this.dataFormat==="channelsFirst"){n=Ge(n,[0,2,3,1]);let s=this.size[0]*o[2],i=this.size[1]*o[3],a=this.interpolation==="nearest"?ii.resizeNearestNeighbor(n,[s,i]):ii.resizeBilinear(n,[s,i]);return Ge(a,[0,3,1,2])}else{let s=this.size[0]*o[1],i=this.size[1]*o[2];return this.interpolation==="nearest"?ii.resizeNearestNeighbor(n,[s,i]):ii.resizeBilinear(n,[s,i])}})}getConfig(){let e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},r=super.getConfig();return Object.assign(e,r),e}};$y.className="UpSampling2D";J.registerClass($y);function qoe(t,e,r=[1,1],n="valid",o,s){return U(()=>{o==null&&(o=Xn()),Wt(o);let i=Ry(t,o);if(t.rank!==4)throw new z(`Input for depthwiseConv2d is required to be 4-D, but is instead ${t.rank}-D`);if(e.rank!==4)throw new z(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return i=vl(i,e,r,n==="same"?"same":"valid","NHWC",s),o==="channelsFirst"&&(i=Ge(i,[0,3,1,2])),i})}var Oy=class extends vf{constructor(e){super(2,e),this.depthwiseKernel=null,this.depthMultiplier=e.depthMultiplier==null?1:e.depthMultiplier,this.depthwiseInitializer=xt(e.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=Xt(e.depthwiseConstraint),this.depthwiseRegularizer=kt(e.depthwiseRegularizer)}build(e){if(e=Ue(e),e.length<4)throw new z(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(e)}.`);let r=this.dataFormat==="channelsFirst"?1:3;if(e[r]==null||e[r]<0)throw new z(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${e[r]}).`);let n=e[r],o=[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",o,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,r){return U(()=>{e=Re(e);let n=qoe(e,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(n=Yn(n,this.bias.read(),this.dataFormat)),this.activation!=null&&(n=this.activation.apply(n)),n})}computeOutputShape(e){e=Ue(e);let r=this.dataFormat==="channelsFirst"?e[2]:e[1],n=this.dataFormat==="channelsFirst"?e[3]:e[2],o=this.dataFormat==="channelsFirst"?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,s=uo(r,this.kernelSize[0],this.padding,this.strides[0]),i=uo(n,this.kernelSize[1],this.padding,this.strides[1]);return this.dataFormat==="channelsFirst"?[e[0],o,s,i]:[e[0],s,i,o]}getConfig(){let e=super.getConfig();return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=Et(this.depthwiseInitializer),e.depthwiseRegularizer=ft(this.depthwiseRegularizer),e.depthwiseConstraint=Kt(this.depthwiseRegularizer),e}};Oy.className="DepthwiseConv2D";J.registerClass(Oy);function DE(t,e,r,n){if(Array.isArray(t)){if(e!=null||r!=null)throw new z("When inputs is an array, neither initialState or constants should be provided");n!=null&&(r=t.slice(t.length-n,t.length),t=t.slice(0,t.length-n)),t.length>1&&(e=t.slice(1,t.length)),t=t[0]}function o(s){return s==null||Array.isArray(s)?s:[s]}return e=o(e),r=o(r),{inputs:t,initialState:e,constants:r}}function $E(t,e,r,n=!1,o,s,i=!1,a=!1){return U(()=>{let l=e.shape.length;if(l<3)throw new z(`Input should be at least 3D, but is ${l}D.`);let u=[1,0].concat(Kn(2,l));if(e=Ge(e,u),s!=null)throw new $e("The rnn() functoin of the deeplearn.js backend does not support constants yet.");i&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),o!=null&&(o=oe(oe(o,"bool"),"float32"),o.rank===l-1&&(o=Dr(o,-1)),o=Ge(o,u)),n&&(e=Qo(e,0),o!=null&&(o=Qo(o,0)));let c=[],p,f=r,d=e.shape[0],m=Dn(e),h;o!=null&&(h=Dn(o));for(let x=0;x<d;++x){let y=m[x],b=U(()=>t(y,f));if(o==null)p=b[0],f=b[1];else{let v=U(()=>{let C=h[x],S=Ce(Hr(C),C),k=te(L(b[0],C),L(f[0],S)),N=f.map((D,$)=>te(L(b[1][$],C),L(D,S)));return{output:k,newStates:N}});p=v.output,f=v.newStates}a&&c.push(p)}let g;return a&&(g=Lr(c,1)),[p,g,f]})}var Jo=class extends ze{constructor(e){super(e);let r;if(e.cell==null)throw new z("cell property is missing for the constructor of RNN.");if(Array.isArray(e.cell)?r=new yh({cells:e.cell}):r=e.cell,r.stateSize==null)throw new z("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=r,this.returnSequences=e.returnSequences==null?!1:e.returnSequences,this.returnState=e.returnState==null?!1:e.returnState,this.goBackwards=e.goBackwards==null?!1:e.goBackwards,this._stateful=e.stateful==null?!1:e.stateful,this.unroll=e.unroll==null?!1:e.unroll,this.supportsMasking=!0,this.inputSpec=[new St({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(this.states_==null){let e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return Kn(0,e).map(r=>null)}else return this.states_}setStates(e){this.states_=e}computeOutputShape(e){J1(e)&&(e=e[0]),e=e;let r=this.cell.stateSize;Array.isArray(r)||(r=[r]);let n=r[0],o;if(this.returnSequences?o=[e[0],e[1],n]:o=[e[0],n],this.returnState){let s=[];for(let i of r)s.push([e[0],i]);return[o].concat(s)}else return o}computeMask(e,r){return U(()=>{Array.isArray(r)&&(r=r[0]);let n=this.returnSequences?r:null;if(this.returnState){let o=this.states.map(s=>null);return[n].concat(o)}else return n})}get states(){if(this.states_==null){let e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,r=[];for(let n=0;n<e;++n)r.push(null);return r}else return this.states_}set states(e){this.states_=e}build(e){if(this.numConstants!=null)throw new $e("Constants support is not implemented in RNN yet.");J1(e)&&(e=e[0]),e=e;let n=this.stateful?e[0]:null,o=e.slice(2);this.inputSpec[0]=new St({shape:[n,null,...o]});let s=[e[0]].concat(e.slice(2));this.cell.build(s);let i;if(Array.isArray(this.cell.stateSize)?i=this.cell.stateSize:i=[this.cell.stateSize],this.stateSpec!=null){if(!w.arraysEqual(this.stateSpec.map(a=>a.shape[a.shape.length-1]),i))throw new z(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=i.map(a=>new St({shape:[null,a]}));this.stateful&&this.resetStates()}resetStates(e,r=!1){U(()=>{if(!this.stateful)throw new ao("Cannot call resetStates() on an RNN Layer that is not stateful.");let n=this.inputSpec[0].shape[0];if(n==null)throw new z("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.states_==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(o=>Ot([n,o])):this.states_=[Ot([n,this.cell.stateSize])];else if(e==null)Me(this.states_),this.keptStates!=null&&(Me(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(o=>Ot([n,o])):this.states_[0]=Ot([n,this.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new z(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);r===!0?this.keptStates.push(this.states_.slice()):Me(this.states_);for(let o=0;o<this.states_.length;++o){let s=e[o],i=Array.isArray(this.cell.stateSize)?this.cell.stateSize[o]:this.cell.stateSize,a=[n,i];if(!w.arraysEqual(s.shape,a))throw new z(`State ${o} is incompatible with layer ${this.name}: expected shape=${a}, received shape=${s.shape}`);this.states_[o]=s}}this.states_=this.states_.map(o=>Gr(o.clone()))})}apply(e,r){let n=r==null?null:r.initialState,o=r==null?null:r.constants;r==null&&(r={});let s=DE(e,n,o,this.numConstants);e=s.inputs,n=s.initialState,o=s.constants;let i=[],a=[];if(n!=null){r.initialState=n,i=i.concat(n),this.stateSpec=[];for(let u of n)this.stateSpec.push(new St({shape:u.shape}));a=a.concat(this.stateSpec)}if(o!=null&&(r.constants=o,i=i.concat(o),this.numConstants=o.length),i[0]instanceof On){let u=[e].concat(i),c=this.inputSpec.concat(a),p=this.inputSpec;this.inputSpec=c;let f=super.apply(u,r);return this.inputSpec=p,f}else return super.apply(e,r)}call(e,r){return U(()=>{let n=r==null?null:r.mask,o=r==null?null:r.training,s=r==null?null:r.initialState;e=Re(e),s==null&&(this.stateful?s=this.states_:s=this.getInitialState(e));let i=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(s.length!==i)throw new z(`RNN Layer has ${i} state(s) but was passed ${s.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");let a={training:o},u=$E((m,h)=>{let g=this.cell.call([m].concat(h),a);return[g[0],g.slice(1)]},e,s,this.goBackwards,n,null,this.unroll,this.returnSequences),c=u[0],p=u[1],f=u[2];this.stateful&&this.resetStates(f,o);let d=this.returnSequences?p:c;return this.returnState?[d].concat(f):d})}getInitialState(e){return U(()=>{let r=Ot(e.shape);return r=ye(r,[1,2]),r=Il(r),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map(n=>n>1?Y1(r,[1,n]):r):this.cell.stateSize>1?[Y1(r,[1,this.cell.stateSize])]:[r]})}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.cell!=null&&this.cell.setFastWeightInitDuringBuild(e)}getConfig(){let e=super.getConfig(),r={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};this.numConstants!=null&&(r.numConstants=this.numConstants);let n=this.cell.getConfig();return this.getClassName()===Jo.className&&(r.cell={className:this.cell.getClassName(),config:n}),Object.assign(Object.assign(Object.assign({},n),e),r)}static fromConfig(e,r,n={}){let o=r.cell,s=Do(o,n);return new e(Object.assign(r,{cell:s}))}};Jo.className="RNN";J.registerClass(Jo);var Ic=class extends ze{},gh=class extends Ic{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,ir(this.units,"units"),this.activation=pi(e.activation==null?this.DEFAULT_ACTIVATION:e.activation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=xt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=xt(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=xt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=kt(e.kernelRegularizer),this.recurrentRegularizer=kt(e.recurrentRegularizer),this.biasRegularizer=kt(e.biasRegularizer),this.kernelConstraint=Xt(e.kernelConstraint),this.recurrentConstraint=Xt(e.recurrentConstraint),this.biasConstraint=Xt(e.biasConstraint),this.dropout=df([1,ui([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=df([1,ui([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Ue(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,r){return U(()=>{if(e=e,e.length!==2)throw new z(`SimpleRNNCell expects 2 input Tensors, got ${e.length}.`);let n=e[1];e=e[0];let o=r.training==null?!1:r.training;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Dl({ones:()=>Hr(e),rate:this.dropout,training:o,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Dl({ones:()=>Hr(n),rate:this.recurrentDropout,training:o,dropoutFunc:this.dropoutFunc}));let s,i=this.dropoutMask,a=this.recurrentDropoutMask;i!=null?s=Ns(L(e,i),this.kernel.read()):s=Ns(e,this.kernel.read()),this.bias!=null&&(s=Yn(s,this.bias.read())),a!=null&&(n=L(n,a));let l=te(s,Ns(n,this.recurrentKernel.read()));return this.activation!=null&&(l=this.activation.apply(l)),[l,l]})}getConfig(){let e=super.getConfig(),r={units:this.units,activation:ci(this.activation),useBias:this.useBias,kernelInitializer:Et(this.kernelInitializer),recurrentInitializer:Et(this.recurrentInitializer),biasInitializer:Et(this.biasInitializer),kernelRegularizer:ft(this.kernelRegularizer),recurrentRegularizer:ft(this.recurrentRegularizer),biasRegularizer:ft(this.biasRegularizer),activityRegularizer:ft(this.activityRegularizer),kernelConstraint:Kt(this.kernelConstraint),recurrentConstraint:Kt(this.recurrentConstraint),biasConstraint:Kt(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign(Object.assign({},e),r)}};gh.className="SimpleRNNCell";J.registerClass(gh);var Fy=class extends Jo{constructor(e){e.cell=new gh(e),super(e)}call(e,r){return U(()=>{this.cell.dropoutMask!=null&&(Me(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Me(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);let n=r==null?null:r.mask,o=r==null?null:r.training,s=r==null?null:r.initialState;return super.call(e,{mask:n,training:o,initialState:s})})}static fromConfig(e,r){return new e(r)}};Fy.className="SimpleRNN";J.registerClass(Fy);var xh=class extends Ic{constructor(e){if(super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new z("GRUCell does not support reset_after parameter set to true.");this.units=e.units,ir(this.units,"units"),this.activation=pi(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=pi(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=xt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=xt(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=xt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=kt(e.kernelRegularizer),this.recurrentRegularizer=kt(e.recurrentRegularizer),this.biasRegularizer=kt(e.biasRegularizer),this.kernelConstraint=Xt(e.kernelConstraint),this.recurrentConstraint=Xt(e.recurrentConstraint),this.biasConstraint=Xt(e.biasConstraint),this.dropout=df([1,ui([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=df([1,ui([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){e=Ue(e);let r=e[e.length-1];this.kernel=this.addWeight("kernel",[r,this.units*3],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*3],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units*3],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(e,r){return U(()=>{if(e=e,e.length!==2)throw new z(`GRUCell expects 2 input Tensors (inputs, h, c), got ${e.length}.`);let n=r.training==null?!1:r.training,o=e[1];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Dl({ones:()=>Hr(e),rate:this.dropout,training:n,count:3,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Dl({ones:()=>Hr(o),rate:this.recurrentDropout,training:n,count:3,dropoutFunc:this.dropoutFunc}));let s=this.dropoutMask,i=this.recurrentDropoutMask,a,l,u;0<this.dropout&&this.dropout<1&&(e=L(e,s[0]));let c=Ns(e,this.kernel.read());this.useBias&&(c=Yn(c,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(o=L(o,i[0]));let p=this.recurrentKernel.read(),[f,d]=Pr(p,[2*this.units,this.units],p.rank-1),m=Ns(o,f),[h,g,x]=Pr(c,3,c.rank-1),[y,b]=Pr(m,2,m.rank-1);a=this.recurrentActivation.apply(te(h,y)),l=this.recurrentActivation.apply(te(g,b));let v=Ns(L(l,o),d);u=this.activation.apply(te(x,v));let C=te(L(a,o),L(te(1,ot(a)),u));return[C,C]})}getConfig(){let e=super.getConfig(),r={units:this.units,activation:ci(this.activation),recurrentActivation:ci(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Et(this.kernelInitializer),recurrentInitializer:Et(this.recurrentInitializer),biasInitializer:Et(this.biasInitializer),kernelRegularizer:ft(this.kernelRegularizer),recurrentRegularizer:ft(this.recurrentRegularizer),biasRegularizer:ft(this.biasRegularizer),activityRegularizer:ft(this.activityRegularizer),kernelConstraint:Kt(this.kernelConstraint),recurrentConstraint:Kt(this.recurrentConstraint),biasConstraint:Kt(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign(Object.assign({},e),r)}};xh.className="GRUCell";J.registerClass(xh);var Py=class extends Jo{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new xh(e),super(e)}call(e,r){return U(()=>{this.cell.dropoutMask!=null&&(Me(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Me(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);let n=r==null?null:r.mask,o=r==null?null:r.training,s=r==null?null:r.initialState;return super.call(e,{mask:n,training:o,initialState:s})})}static fromConfig(e,r){return r.implmentation===0&&(r.implementation=1),new e(r)}};Py.className="GRU";J.registerClass(Py);var Ec=class extends Ic{constructor(e){super(e),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=e.units,ir(this.units,"units"),this.activation=pi(e.activation===void 0?this.DEFAULT_ACTIVATION:e.activation),this.recurrentActivation=pi(e.recurrentActivation===void 0?this.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),this.useBias=e.useBias==null?!0:e.useBias,this.kernelInitializer=xt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=xt(e.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=xt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=e.unitForgetBias,this.kernelRegularizer=kt(e.kernelRegularizer),this.recurrentRegularizer=kt(e.recurrentRegularizer),this.biasRegularizer=kt(e.biasRegularizer),this.kernelConstraint=Xt(e.kernelConstraint),this.recurrentConstraint=Xt(e.recurrentConstraint),this.biasConstraint=Xt(e.biasConstraint),this.dropout=df([1,ui([0,e.dropout==null?0:e.dropout])]),this.recurrentDropout=df([1,ui([0,e.recurrentDropout==null?0:e.recurrentDropout])]),this.dropoutFunc=e.dropoutFunc,this.implementation=e.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(e){var r;e=Ue(e);let n=e[e.length-1];this.kernel=this.addWeight("kernel",[n,this.units*4],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units*4],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint);let o;if(this.useBias){if(this.unitForgetBias){let s=this.biasInitializer,i=this.units;o=new(r=class extends Qn{apply(l,u){let c=s.apply([i]),p=new hf().apply([i]),f=s.apply([i*2]);return xE(xE(c,p),f)}},r.className="CustomInit",r)}else o=this.biasInitializer;this.bias=this.addWeight("bias",[this.units*4],null,o,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(e,r){return U(()=>{let n=r.training==null?!1:r.training;if(e=e,e.length!==3)throw new z(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let o=e[1],s=e[2];e=e[0],0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Dl({ones:()=>Hr(e),rate:this.dropout,training:n,count:4,dropoutFunc:this.dropoutFunc})),0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Dl({ones:()=>Hr(o),rate:this.recurrentDropout,training:n,count:4,dropoutFunc:this.dropoutFunc}));let i=this.dropoutMask,a=this.recurrentDropoutMask,l,u,c,p;0<this.dropout&&this.dropout<1&&(e=L(e,i[0]));let f=Ns(e,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(o=L(o,a[0])),f=te(f,Ns(o,this.recurrentKernel.read())),this.useBias&&(f=Yn(f,this.bias.read()));let[d,m,h,g]=Pr(f,4,f.rank-1);l=this.recurrentActivation.apply(d),u=this.recurrentActivation.apply(m),c=te(L(u,s),L(l,this.activation.apply(h))),p=this.recurrentActivation.apply(g);let x=L(p,this.activation.apply(c));return[x,x,c]})}getConfig(){let e=super.getConfig(),r={units:this.units,activation:ci(this.activation),recurrentActivation:ci(this.recurrentActivation),useBias:this.useBias,kernelInitializer:Et(this.kernelInitializer),recurrentInitializer:Et(this.recurrentInitializer),biasInitializer:Et(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:ft(this.kernelRegularizer),recurrentRegularizer:ft(this.recurrentRegularizer),biasRegularizer:ft(this.biasRegularizer),activityRegularizer:ft(this.activityRegularizer),kernelConstraint:Kt(this.kernelConstraint),recurrentConstraint:Kt(this.recurrentConstraint),biasConstraint:Kt(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign(Object.assign({},e),r)}};Ec.className="LSTMCell";J.registerClass(Ec);var Ly=class extends Jo{constructor(e){e.implementation===0&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new Ec(e),super(e)}call(e,r){return U(()=>{this.cell.dropoutMask!=null&&(Me(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Me(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);let n=r==null?null:r.mask,o=r==null?null:r.training,s=r==null?null:r.initialState;return super.call(e,{mask:n,training:o,initialState:s})})}static fromConfig(e,r){return r.implmentation===0&&(r.implementation=1),new e(r)}};Ly.className="LSTM";J.registerClass(Ly);var yh=class extends Ic{constructor(e){super(e),this.cells=e.cells}get stateSize(){let e=[];for(let r of this.cells.slice().reverse())Array.isArray(r.stateSize)?e.push(...r.stateSize):e.push(r.stateSize);return e}call(e,r){return U(()=>{e=e;let n=e.slice(1),o=[];for(let a of this.cells.slice().reverse())Array.isArray(a.stateSize)?o.push(n.splice(0,a.stateSize.length)):o.push(n.splice(0,1));o.reverse();let s=[],i;for(let a=0;a<this.cells.length;++a){let l=this.cells[a];n=o[a],a===0?i=[e[0]].concat(n):i=[i[0]].concat(n),i=l.call(i,r),s.push(i.slice(1))}n=[];for(let a of s.slice().reverse())n.push(...a);return[i[0]].concat(n)})}build(e){J1(e)&&(e=e[0]),e=e;let r;this.cells.forEach((n,o)=>{li(`RNNCell_${o}`,()=>{n.build(e),Array.isArray(n.stateSize)?r=n.stateSize[0]:r=n.stateSize,e=[e[0],r]})}),this.built=!0}getConfig(){let e=super.getConfig(),r=s=>({className:s.getClassName(),config:s.getConfig()}),o={cells:this.cells.map(r)};return Object.assign(Object.assign({},e),o)}static fromConfig(e,r,n={}){let o=[];for(let s of r.cells)o.push(Do(s,n));return new e({cells:o})}get trainableWeights(){if(!this.trainable)return[];let e=[];for(let r of this.cells)e.push(...r.trainableWeights);return e}get nonTrainableWeights(){let e=[];for(let r of this.cells)e.push(...r.nonTrainableWeights);if(!this.trainable){let r=[];for(let n of this.cells)r.push(...n.trainableWeights);return r.concat(e)}return e}getWeights(){let e=[];for(let r of this.cells)e.push(...r.weights);return cy(e)}setWeights(e){let r=[];for(let n of this.cells){let o=n.weights.length,s=e.splice(o);for(let i=0;i<n.weights.length;++i)r.push([n.weights[i],s[i]])}ch(r)}};yh.className="StackedRNNCells";J.registerClass(yh);function Dl(t){let{ones:e,rate:r,training:n=!1,count:o=1,dropoutFunc:s}=t,i=()=>s!=null?s(e(),r):Z1(e(),r),a=()=>wc(i,e,n);return!o||o<=1?Gr(a().clone()):Array(o).fill(void 0).map(a).map(u=>Gr(u.clone()))}var joe=function(t,e){var r={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(r[n]=t[n]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(t);o<n.length;o++)e.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(t,n[o])&&(r[n[o]]=t[n[o]]);return r};var Lw=class extends Jo{constructor(e){if(e.unroll)throw new $e("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new $e("It is not possible at the moment to stack convolutional cells.");super(e),this.inputSpec=[new St({ndim:5})]}call(e,r){return U(()=>{if(this.cell.dropoutMask!=null&&(Me(this.cell.dropoutMask),this.cell.dropoutMask=null),this.cell.recurrentDropoutMask!=null&&(Me(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),r&&r.constants)throw new z("ConvRNN2D cell does not support constants");let n=r==null?null:r.mask,o=r==null?null:r.training,s=r==null?null:r.initialState;return super.call(e,{mask:n,training:o,initialState:s})})}computeOutputShape(e){let r=this.computeSingleOutputShape(e);return this.returnSequences||(r=[r[0],...r.slice(2)]),this.returnState&&(r=[r,...Array(2).fill([e[0],...r.slice(-3)])]),r}getInitialState(e){return U(()=>{let{stateSize:r}=this.cell,n=e.shape,o=this.computeSingleOutputShape(n),s=[o[0],...o.slice(2)],i=Ot(s);return Array.isArray(r)?Array(r.length).fill(i):[i]})}resetStates(e,r=!1){U(()=>{if(!this.stateful)throw new ao("Cannot call resetStates() on an RNN Layer that is not stateful.");let n=this.inputSpec[0].shape,o=this.computeSingleOutputShape(n),s=[o[0],...o.slice(2)];if(n[0]==null)throw new z("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(this.getStates()==null)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Ot(s)):this.states_=[Ot(s)];else if(e==null)Me(this.states_),this.keptStates!=null&&(Me(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map(()=>Ot(s)):this.states_[0]=Ot(s);else{if(Array.isArray(e)||(e=[e]),e.length!==this.states_.length)throw new z(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${e.length} state value(s). Input received: ${e}`);r?this.keptStates.push(this.states_.slice()):Me(this.states_);for(let a=0;a<this.states_.length;++a){let l=e[a],u=s;if(!w.arraysEqual(l.shape,u))throw new z(`State ${a} is incompatible with layer ${this.name}: expected shape=${u}, received shape=${l.shape}`);this.states_[a]=l}}this.states_=this.states_.map(a=>Gr(a.clone()))})}computeSingleOutputShape(e){let{dataFormat:r,filters:n,kernelSize:o,padding:s,strides:i,dilationRate:a}=this.cell,l=r==="channelsFirst",u=e[l?3:2],c=e[l?4:3],p=uo(u,o[0],s,i[0],a[0]),f=uo(c,o[1],s,i[1],a[1]);return[...e.slice(0,2),...l?[n,p,f]:[p,f,n]]}};Lw.className="ConvRNN2D";var bh=class extends Ec{constructor(e){let{filters:r,kernelSize:n,strides:o,padding:s,dataFormat:i,dilationRate:a}=e;super(Object.assign(Object.assign({},e),{units:r})),this.filters=r,ir(this.filters,"filters"),this.kernelSize=Sc(n,2,"kernelSize"),this.kernelSize.forEach(l=>ir(l,"kernelSize")),this.strides=Sc(o||1,2,"strides"),this.strides.forEach(l=>ir(l,"strides")),this.padding=s||"valid",jn(this.padding),this.dataFormat=i||"channelsLast",Wt(this.dataFormat),this.dilationRate=Sc(a||1,2,"dilationRate"),this.dilationRate.forEach(l=>ir(l,"dilationRate"))}build(e){var r;e=Ue(e);let n=this.dataFormat==="channelsFirst"?1:e.length-1;if(e[n]==null)throw new z(`The channel dimension of the input should be defined. Found ${e[n]}`);let o=e[n],s=4,i=this.kernelSize.concat([o,this.filters*s]);this.kernel=this.addWeight("kernel",i,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);let a=this.kernelSize.concat([this.filters,this.filters*s]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",a,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let l;if(this.unitForgetBias){let u=this.biasInitializer,c=this.filters;l=new(r=class extends Qn{apply(f,d){let m=u.apply([c]),h=_o([c]),g=u.apply([c*2]);return eh([m,h,g])}},r.className="CustomInit",r)}else l=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*s],null,l,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(e,r){return U(()=>{if(e.length!==3)throw new z(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${e.length}.`);let n=r.training||!1,o=e[0],s=e[1],i=e[2],a=4;0<this.dropout&&this.dropout<1&&this.dropoutMask==null&&(this.dropoutMask=Dl({ones:()=>Hr(o),rate:this.dropout,training:n,count:a,dropoutFunc:this.dropoutFunc}));let l=this.dropoutMask,u=(se,ne,re)=>!ne||!ne[re]?se:L(ne[re],se),c=u(o,l,0),p=u(o,l,1),f=u(o,l,2),d=u(o,l,3);0<this.recurrentDropout&&this.recurrentDropout<1&&this.recurrentDropoutMask==null&&(this.recurrentDropoutMask=Dl({ones:()=>Hr(s),rate:this.recurrentDropout,training:n,count:a,dropoutFunc:this.dropoutFunc}));let m=this.recurrentDropoutMask,h=u(s,m,0),g=u(s,m,1),x=u(s,m,2),y=u(s,m,3),b=3,[v,C,S,k]=Pr(this.kernel.read(),a,b),[N,D,$,O]=this.useBias?Pr(this.bias.read(),a):[null,null,null,null];c=this.inputConv(c,v,N,this.padding),p=this.inputConv(p,C,D,this.padding),f=this.inputConv(f,S,$,this.padding),d=this.inputConv(d,k,O,this.padding);let[V,K,X,W]=Pr(this.recurrentKernel.read(),a,b);h=this.recurrentConv(h,V),g=this.recurrentConv(g,K),x=this.recurrentConv(x,X),y=this.recurrentConv(y,W);let H=this.recurrentActivation.apply(te(c,h)),Y=this.recurrentActivation.apply(te(p,g)),Z=te(L(Y,i),L(H,this.activation.apply(te(f,x)))),Q=L(this.recurrentActivation.apply(te(d,y)),this.activation.apply(Z));return[Q,Q,Z]})}getConfig(){let e=super.getConfig(),{units:r}=e,n=joe(e,["units"]),o={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign(Object.assign({},n),o)}inputConv(e,r,n,o){let s=Io(e,r,this.strides,o||"valid",this.dataFormat==="channelsFirst"?"NCHW":"NHWC",this.dilationRate);return n?Yn(s,n,this.dataFormat):s}recurrentConv(e,r){return Io(e,r,1,"same",this.dataFormat==="channelsFirst"?"NCHW":"NHWC")}};bh.className="ConvLSTM2DCell";J.registerClass(bh);var My=class extends Lw{constructor(e){let r=new bh(e);super(Object.assign(Object.assign({},e),{cell:r}))}static fromConfig(e,r){return new e(r)}};My.className="ConvLSTM2D";J.registerClass(My);var vh=class extends ze{constructor(e){super(e),this.rate=Math.max(Math.min(e.rate,1),0),this.noiseShape=e.noiseShape,this.seed=e.seed,this.supportsMasking=!0}getNoiseShape(e){if(this.noiseShape==null)return this.noiseShape;let r=e.shape,n=[];for(let o=0;o<this.noiseShape.length;++o)n.push(this.noiseShape[o]==null?r[o]:this.noiseShape[o]);return n}call(e,r){return U(()=>{this.invokeCallHook(e,r);let n=Re(e);if(0<this.rate&&this.rate<1){let o=r.training==null?!1:r.training,s=this.getNoiseShape(n);return wc(()=>Z1(n,this.rate,s,this.seed),()=>n,o)}return e})}getConfig(){let e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},r=super.getConfig();return Object.assign(e,r),e}dispose(){return super.dispose()}};vh.className="Dropout";J.registerClass(vh);var zy=class extends vh{constructor(e){super(e),this.inputSpec=[{ndim:3}]}getNoiseShape(e){let r=e.shape;return[r[0],1,r[2]]}};zy.className="SpatialDropout1D";J.registerClass(zy);var By=class extends ze{constructor(e){if(super(e),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",e.batchInputShape==null&&e.inputShape==null&&e.inputDim!=null){let r=null;e.batchSize!=null&&(r=e.batchSize),this.batchInputShape=[r,e.inputDim]}this.units=e.units,ir(this.units,"units"),this.activation=pi(e.activation),e.useBias!=null&&(this.useBias=e.useBias),this.kernelInitializer=xt(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=xt(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=Xt(e.kernelConstraint),this.biasConstraint=Xt(e.biasConstraint),this.kernelRegularizer=kt(e.kernelRegularizer),this.biasRegularizer=kt(e.biasRegularizer),this.activityRegularizer=kt(e.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(e){e=Ue(e);let r=e[e.length-1];this.kernel==null&&(this.kernel=this.addWeight("kernel",[r,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:r}}],this.built=!0}computeOutputShape(e){e=Ue(e);let r=e.slice();return r[r.length-1]=this.units,r}call(e,r){return U(()=>{this.invokeCallHook(e,r);let n=Re(e),o=U1(this.activation.getClassName()),s;return o!=null?s=Ns(n,this.kernel.read(),o,this.bias?this.bias.read():null):(s=Ns(n,this.kernel.read()),this.bias!=null&&(s=Yn(s,this.bias.read())),this.activation!=null&&(s=this.activation.apply(s))),s})}getConfig(){let e={units:this.units,activation:ci(this.activation),useBias:this.useBias,kernelInitializer:Et(this.kernelInitializer),biasInitializer:Et(this.biasInitializer),kernelRegularizer:ft(this.kernelRegularizer),biasRegularizer:ft(this.biasRegularizer),activityRegularizer:ft(this.activityRegularizer),kernelConstraint:Kt(this.kernelConstraint),biasConstraint:Kt(this.biasConstraint)},r=super.getConfig();return Object.assign(e,r),e}};By.className="Dense";J.registerClass(By);var Vy=class extends ze{constructor(e){e=e||{},super(e),this.inputSpec=[{minNDim:3}],this.dataFormat=e.dataFormat}computeOutputShape(e){e=Ue(e);for(let r of e.slice(1))if(r==null)throw new z(`The shape of the input to "Flatten" is not fully defined (got ${e.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[e[0],Ts(e,1)]}call(e,r){return U(()=>{this.invokeCallHook(e,r);let n=Re(e);if(this.dataFormat==="channelsFirst"&&n.rank>1){let o=[0];for(let s=2;s<n.rank;++s)o.push(s);o.push(1),n=Ge(n,o)}return wz(n)})}getConfig(){let e={};this.dataFormat!=null&&(e.dataFormat=this.dataFormat);let r=super.getConfig();return Object.assign(e,r),e}};Vy.className="Flatten";J.registerClass(Vy);var Wy=class extends ze{constructor(e){super(e),this.supportsMasking=!0,this.activation=pi(e.activation)}call(e,r){return U(()=>{this.invokeCallHook(e,r);let n=Re(e);return this.activation.apply(n)})}getConfig(){let e={activation:ci(this.activation)},r=super.getConfig();return Object.assign(e,r),e}};Wy.className="Activation";J.registerClass(Wy);var Gy=class extends ze{constructor(e){super(e),this.n=e.n,this.inputSpec=[{ndim:2}]}computeOutputShape(e){return[e[0],this.n,e[1]]}call(e,r){return U(()=>(e=Re(e),bz(e,this.n)))}getConfig(){let e={n:this.n},r=super.getConfig();return Object.assign(e,r),e}};Gy.className="RepeatVector";J.registerClass(Gy);var Uy=class extends ze{constructor(e){super(e),this.targetShape=e.targetShape;for(let r=0;r<this.targetShape.length;++r)this.isUnknown(this.targetShape[r])&&(this.targetShape[r]=null)}isUnknown(e){return e<0||e==null}fixUnknownDimension(e,r){let n="Total size of new array must be unchanged.",o=r.slice(),s=1,i=null;for(let l=0;l<o.length;++l){let u=o[l];if(this.isUnknown(u))if(i===null)i=l;else throw new z("Can only specifiy one unknown dimension.");else s*=u}let a=Ts(e);if(i!==null){if(s===0||a%s!==0)throw new z(n);o[i]=a/s}else if(a!==s)throw new z(n);return o}computeOutputShape(e){let r=!1;for(let n=0;n<e.length;++n)if(this.isUnknown(e[n])){r=!0;break}return r?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}call(e,r){return U(()=>{this.invokeCallHook(e,r);let n=Re(e),o=n.shape,s=o.slice(0,1).concat(this.fixUnknownDimension(o.slice(1),this.targetShape));return M(n,s)})}getConfig(){let e={targetShape:this.targetShape},r=super.getConfig();return Object.assign(e,r),e}};Uy.className="Reshape";J.registerClass(Uy);var Hy=class extends ze{constructor(e){if(super(e),e.dims==null)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${e.dims} instead.`);let r=Kn(1,e.dims.length+1);if(!w.arraysEqual(e.dims.slice().sort(),r))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=e.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new St({ndim:this.dims.length+1})]}computeOutputShape(e){e=Ue(e);let r=e.slice();return this.dims.forEach((n,o)=>{r[o+1]=e[n]}),r}call(e,r){return Ge(Re(e),this.dimsIncludingBatch)}getConfig(){let e={dims:this.dims},r=super.getConfig();return Object.assign(e,r),e}};Hy.className="Permute";J.registerClass(Hy);var qy=class extends ze{constructor(e){super(e??{}),this.supportsMasking=!0,e!=null?this.maskValue=e.maskValue==null?0:e.maskValue:this.maskValue=0}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),r={maskValue:this.maskValue};return Object.assign(r,e),r}computeMask(e,r){let n=Re(e),o=-1;return $m(yc(n,this.maskValue),o)}call(e,r){return U(()=>{this.invokeCallHook(e,r);let n=Re(e),o=-1,s=!0,i=$m(yc(n,this.maskValue),o,s);return L(n,oe(i,n.dtype))})}};qy.className="Masking";J.registerClass(qy);var jy=class extends ze{constructor(e){if(super(e),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",e.batchInputShape==null&&e.inputShape==null){let r=null;e.batchSize!=null&&(r=e.batchSize),e.inputLength==null?this.batchInputShape=[r,null]:this.batchInputShape=[r].concat(Ct(e.inputLength))}this.inputDim=e.inputDim,ir(this.inputDim,"inputDim"),this.outputDim=e.outputDim,ir(this.outputDim,"outputDim"),this.embeddingsInitializer=xt(e.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=kt(e.embeddingsRegularizer),this.activityRegularizer=kt(e.activityRegularizer),this.embeddingsConstraint=Xt(e.embeddingsConstraint),this.maskZero=e.maskZero,this.supportsMasking=e.maskZero,this.inputLength=e.inputLength}build(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(e){}computeMask(e,r){return U(()=>this.maskZero?(e=Re(e),yc(e,_e(e))):null)}computeOutputShape(e){if(e=Ue(e),this.inputLength==null)return[...e,this.outputDim];let r=Ct(this.inputLength);if(r.length!==e.length-1)throw new z(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);{let n=0;for(let o=0;o<r.length;++o){let s=r[o],i=e[o+1];if(s!=null&&i!=null&&s!==i)throw new z(`"inputLength" is ${this.inputLength}, but received input shape has shape ${e}`);s==null&&(r[n]=i),n++}}return[e[0],...r,this.outputDim]}call(e,r){return U(()=>{this.invokeCallHook(e,r);let n=Re(e);n.dtype!=="int32"&&(n=$n(n,"int32"));let o=Q1(this.embeddings.read(),M(n,[n.size]));return M(o,Ue(this.computeOutputShape(n.shape)))})}getConfig(){let e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:Et(this.embeddingsInitializer),embeddingsRegularizer:ft(this.embeddingsRegularizer),activityRegularizer:ft(this.activityRegularizer),embeddingsConstraint:Kt(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},r=super.getConfig();return Object.assign(e,r),e}};jy.className="Embedding";J.registerClass(jy);var $l=class extends ze{constructor(e){super(e||{}),this.supportsMasking=!0}mergeFunction(e){throw new $e}computeElementwiseOpOutputShape(e,r){if(e==null||r==null)return null;if(e.length<r.length)return this.computeElementwiseOpOutputShape(r,e);if(r.length===0)return e;let n=e.slice(0,e.length-r.length);for(let o=0;o<r.length;++o){let s=e[e.length-r.length+o],i=r[o];if(s==null||i==null||s<0||i<0)n.push(null);else if(s===1)n.push(i);else if(i===1)n.push(s);else{if(s!==i)throw new z("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(r));n.push(s)}}return n}build(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[Ue(e)]),e=e,e.length<2)throw new z(`A merge layer should be called on an Array of at least 2 inputs. Got ${e.length} input(s).`);let r=[];for(let s of e)s!=null&&s[0]!==null&&r.push(s[0]);if(r=ks(r),r.length>1)throw new z(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(e)}.`);let n=e[0]==null?null:e[0].slice(1);for(let s=1;s<e.length;++s){let i=e[s]==null?null:e[s].slice(1);n=this.computeElementwiseOpOutputShape(n,i)}let o=e.map(s=>s.length);e.indexOf(null)===-1&&ks(o).length===1?this.reshapeRequired=!1:this.reshapeRequired=!0}call(e,r){return U(()=>{if(e=e,this.reshapeRequired){let n=[],o=e.map(s=>s.rank);if(o.indexOf(null)===-1){let s=ui(o);for(let i of e){let a=i.rank;for(let l=0;l<s-a;++l)i=Il(i,1);n.push(i)}return this.mergeFunction(n)}else{let s=!1;for(let l of e){let u=l.rank;if(u==null){let c=l.shape,p=c[0],f=c.slice(1).concat([p]),d=M(l,[p].concat(Ts(c.slice(1))));d=Ge(d,[1,0]),d=M(d,f),n.push(d),s=!0}else if(u>1){let c=Kn(1,u).concat([0]);n.push(Ge(l,c)),s=!0}else n.push(l)}let i=this.mergeFunction(n),a=i.rank;if(s){if(a==null){let l=i.shape,u=l.length,c=l[u-1],p=[c].concat(l.slice(0,l.length-1));i=M(Ge(M(i,[-1,c]),[1,0]),p)}else if(a>1){let l=[a-1].concat(Kn(0,a-1));i=Ge(i,l)}}return i}}else return this.mergeFunction(e)})}computeOutputShape(e){e=e;let r;e[0]==null?r=null:r=e[0].slice(1);for(let o=1;o<e.length;++o){let s=e[o]==null?null:e[o].slice(1);r=this.computeElementwiseOpOutputShape(r,s)}let n=[];for(let o of e)o!=null&&o[0]!==null&&n.push(o[0]);return n=ks(n),n.length===1?r=n.concat(r):r=[null].concat(r),r}computeMask(e,r){return U(()=>{if(r==null)return null;if(!Array.isArray(r))throw new z("`mask` should be an Array");if(!Array.isArray(e))throw new z("`inputs` should be an Array");if(r.length!==e.length)throw new z(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${e.length} vs ${r.length})`);if(r.every(o=>o==null))return null;r=r.map(o=>o==null?o:Dr(o,0));let n=r[0];for(let o=1;o<r.length-1;++o)n=An(n,r[o]);return n})}},Xy=class extends $l{constructor(e){super(e)}mergeFunction(e){return U(()=>{let r=e[0].clone();for(let n=1;n<e.length;++n)r=te(r,e[n]);return r})}};Xy.className="Add";J.registerClass(Xy);var Yy=class extends $l{constructor(e){super(e)}mergeFunction(e){return U(()=>{let r=e[0].clone();for(let n=1;n<e.length;++n)r=L(r,e[n]);return r})}};Yy.className="Multiply";J.registerClass(Yy);var Qy=class extends $l{constructor(e){super(e)}mergeFunction(e){return U(()=>{let r=e[0].clone();for(let n=1;n<e.length;++n)r=te(r,e[n]);return L(1/e.length,r)})}};Qy.className="Average";J.registerClass(Qy);var Zy=class extends $l{constructor(e){super(e)}mergeFunction(e){return U(()=>{let r=e[0];for(let n=1;n<e.length;++n)r=Eo(r,e[n]);return r})}};Zy.className="Maximum";J.registerClass(Zy);var Jy=class extends $l{constructor(e){super(e)}mergeFunction(e){return U(()=>{let r=e[0];for(let n=1;n<e.length;++n)r=tf(r,e[n]);return r})}};Jy.className="Minimum";J.registerClass(Jy);var e0=class extends $l{constructor(e){super(e),this.DEFAULT_AXIS=-1,e==null&&(e={}),this.axis=e.axis==null?this.DEFAULT_AXIS:e.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){if(!(Array.isArray(e)&&Array.isArray(e[0]))||e.length===1)throw new z("A `Concatenate` layer should be called on a list of at least 2 inputs");e=e;let r=!0;for(let o of e)if(o!=null){r=!1;break}if(r)return;let n=[];for(let o=0;o<e.length;++o){let s=e[o].slice();s.splice(this.axis,1);let i=!1;for(let a of n)if(w.arraysEqual(a,s)){i=!0;break}i||n.push(s)}if(n.length>1)throw new z("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}mergeFunction(e){return U(()=>eh(e,this.axis))}computeOutputShape(e){if(!(Array.isArray(e)&&Array.isArray(e[0])))throw new z("A `Concatenate` layer should be called on a list of inputs.");let r=e,n=r[0].slice(),o=this.axis<0?n.length+this.axis:this.axis;for(let s of r.slice(1)){if(n[o]==null||s[o]==null){n[o]=null;break}n[o]+=s[o]}return n}computeMask(e,r){if(r==null)return null;if(!Array.isArray(r))throw new z("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new z("`inputs` should be an array for Concatenate");if(r.length!==e.length)throw new z(`Mismatch in the length of mask (${r.length}) and the legnth of inputs (${e.length})`);return U(()=>{let n=!0;if(r.forEach(i=>{if(i!=null){n=!1;return}}),n)return null;let o=[];for(let i=0;i<e.length;++i)r[i]==null?o.push(oe(Hr(e[i]),"bool")):r[i].rank<e[i].rank?o.push(Dr(r[i],-1)):o.push(r[i]);let s=$t(o,this.axis);return Ax(s,-1,!1)})}getConfig(){let e={axis:this.axis},r=super.getConfig();return Object.assign(e,r),e}};e0.className="Concatenate";J.registerClass(e0);function Ky(t,e){for(;t<0;)t+=e;return t}function Koe(t,e,r){if(t.shape.length>3||e.shape.length>3)throw new $e("batchDot is not implemented for tensors of 4D or higher rank yet");if(w.assert(t.shape.length>=2,()=>`batchDot requires the rank of x to be >= 2, but got ${t.shape.length}`),w.assert(t.shape.length>=2,()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`),typeof r=="number"&&(r=[r,r]),t.dtype==="complex64"||e.dtype==="complex64")throw new $e("batchDot is not implemented for complex64-type Tensors yet.");let n=t.shape.length,o=e.shape.length;r==null&&(r=[n-1,o-2]);let s=r;return U(()=>{let i;if(n>o){i=n-o;let l=[];for(let u=0;u<i;++u)l.push(1);e=M(e,e.shape.concat(l))}else if(o>n){i=o-n;let l=[];for(let u=0;u<i;++u)l.push(1);t=M(t,t.shape.concat(l))}else i=0;let a;if(t.shape.length===2&&e.shape.length===2)s[0]===s[1]?a=ye(L(t,e),s[0]):a=ye(L(Ge(t,[1,0]),e),s[1]);else{let l=s[0]!==t.shape.length-1,u=s[1]===e.shape.length-1;a=nt(t,e,l,u)}if(i>0){let l;n>o?l=n+o-3:l=n-1;let u=[];for(let c=l;c<l+i;++c)u.push(c);a=oi(a,u)}return a.shape.length===1&&(a=Dr(a,1)),a})}var t0=class extends $l{constructor(e){super(e),this.axes=e.axes,this.normalize=e.normalize==null?!1:e.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(e){w.assert(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");let r=e[0],n=e[1];if(r.length>3||n.length>3)throw new $e("Dot layer does not support tensors of 4D or higher rank yet.");let o=this.interpretAxes(r,n);if(r[o[0]]!==n[o[1]])throw new z(`Dimension incompatibility: ${r[o[0]]} !== ${n[o[1]]}`)}mergeFunction(e){if(e.length!==2)throw new z(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${e.length} input(s).`);let r=e[0],n=e[1],o;return Array.isArray(this.axes)?o=this.axes.map((s,i)=>Ky(s,e[i].shape.length)):o=[Ky(this.axes,r.shape.length),Ky(this.axes,n.shape.length)],this.normalize&&(r=hy(r,o[0]),n=hy(n,o[1])),Koe(r,n,o)}interpretAxes(e,r){let n;return Array.isArray(this.axes)?n=this.axes:n=[Ky(this.axes,e.length),Ky(this.axes,r.length)],n}computeOutputShape(e){w.assert(Array.isArray(e)&&e.length===2&&Array.isArray(e[0])&&Array.isArray(e[1]),()=>"A `Dot` layer should be called on a list of exactly 2 inputs.");let r=e[0].slice(),n=e[1].slice();if(r.length>3||n.length>3)throw new $e("Dot layer does not support tensors of 4D or higher rank yet.");let o=this.interpretAxes(r,n);r.splice(o[0],1),n.splice(o[1],1),n.splice(0,1);let s=r.concat(n);return s.length===1&&s.push(1),s}computeMask(e,r){return null}getConfig(){let e={axes:this.axes,normalize:this.normalize},r=super.getConfig();return Object.assign(e,r),e}};t0.className="Dot";J.registerClass(t0);var r0=class extends ze{constructor(e){super(e),this.supportsMasking=!0,this.stddev=e.stddev}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),r={stddev:this.stddev};return Object.assign(r,e),r}call(e,r){return U(()=>{this.invokeCallHook(e,r);let n=Re(e);return wc(()=>te(th(n.shape,0,this.stddev),n),()=>n,r.training||!1)})}};r0.className="GaussianNoise";J.registerClass(r0);var n0=class extends ze{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),r={rate:this.rate};return Object.assign(r,e),r}call(e,r){return U(()=>{this.invokeCallHook(e,r);let n=Re(e);return this.rate>0&&this.rate<1?wc(()=>{let s=Math.sqrt(this.rate/(1-this.rate));return L(n,th(n.shape,1,s))},()=>n,r.training||!1):n})}};n0.className="GaussianDropout";J.registerClass(n0);var o0=class extends ze{constructor(e){super(e),this.supportsMasking=!0,this.rate=e.rate,this.noiseShape=e.noiseShape}_getNoiseShape(e){return this.noiseShape||Re(e).shape}computeOutputShape(e){return e}getConfig(){let e=super.getConfig(),r={rate:this.rate};return Object.assign(r,e),r}call(e,r){return U(()=>{if(this.rate<1&&this.rate>0){let n=this._getNoiseShape(e);return wc(()=>{let s=Re(e),i=1.6732632423543772,a=1.0507009873554805,l=-i*a,u=io(Sl(n),this.rate);u=$n(u,"float32");let c=((1-this.rate)*(1+this.rate*l**2))**-.5,p=-c*l*this.rate,f=te(L(s,u),L(te(u,-1),l));return te(L(f,c),p)},()=>Re(e),r.training||!1)}return e})}};o0.className="AlphaDropout";J.registerClass(o0);function s0(t,e,r,n,o,s=.001){let i;if(t.rank===2)i=v2(t,e,r,n,o,s);else if(t.rank===3)i=w2(t,e,r,n,o,s);else if(t.rank===4)i=C2(t,e,r,n,o,s);else throw new $e(`batchNormalization is not implemented for array of rank ${t.rank} yet`);return i}function Xoe(t,e,r,n,o=.001){return U(()=>{let s=zm(t,n),i=s.mean,a=s.variance;return[s0(t,i,a,r,e,o),i,a]})}function Yoe(t,e,r,n,o=.001){return U(()=>{let s=zm(t,n),i=s.mean,a=s.variance,l=[];for(let m of Kn(0,t.rank))n.indexOf(m)!==-1?l.push(1):l.push(t.shape[m]);let u=M(i,l),c=M(a,l),p=e==null?null:M(e,l),f=r==null?null:M(r,l);return[s0(t,u,c,f,p,o),i,a]})}function Qoe(t,e,r,n,o=.001){return w.arraysEqual(n.slice().sort(),Kn(0,t.rank-1))?Xoe(t,e,r,n,o):Yoe(t,e,r,n,o)}var i0=class extends ze{constructor(e){e==null&&(e={}),super(e),this.supportsMasking=!0,this.axis=e.axis==null?-1:e.axis,this.momentum=e.momentum==null?.99:e.momentum,this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=xt(e.betaInitializer||"zeros"),this.gammaInitializer=xt(e.gammaInitializer||"ones"),this.movingMeanInitializer=xt(e.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=xt(e.movingVarianceInitializer||"ones"),this.betaConstraint=Xt(e.betaConstraint),this.gammaConstraint=Xt(e.gammaConstraint),this.betaRegularizer=kt(e.betaRegularizer),this.gammaRegularizer=kt(e.gammaRegularizer)}build(e){e=Ue(e);let r=this.axis>=0?this.axis:this.axis+e.length,n=e[r];if(n==null)throw new z(`Axis ${r} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(e)}.`);this.inputSpec=[new St({ndim:e.length,axes:{[r]:n}})];let o=[n];this.scale&&(this.gamma=this.addWeight("gamma",o,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",o,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",o,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",o,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(e,r){return U(()=>{let n=r.training==null?!1:r.training,o=Re(e),s=o.shape,i=s.length,a=Kn(0,i),l=this.axis>=0?this.axis:this.axis+i;a.splice(l,1);let u=Cs(1,i);u[l]=s[l];let c=a.slice();c.sort();let p=!w.arraysEqual(c,Kn(0,i).slice(0,i-1)),f=()=>{if(p){let y=M(this.movingMean.read(),u),b=M(this.movingVariance.read(),u),v=this.center?M(this.beta.read(),u):null,C=this.scale?M(this.gamma.read(),u):null;return s0(o,y,b,v,C,this.epsilon)}else return s0(o,this.movingMean.read(),this.movingVariance.read(),this.beta==null?null:this.beta.read(),this.gamma==null?null:this.gamma.read(),this.epsilon)};if(!n)return f();let[d,m,h]=Qoe(o,this.gamma.read(),this.beta.read(),a,this.epsilon),g=(y,b,v)=>{U(()=>{let C=1-v,S=y.read(),k=L(Ce(S,b),C);y.write(Ce(S,k))})};return(()=>{g(this.movingMean,m,this.momentum),g(this.movingVariance,h,this.momentum)})(),d})}getConfig(){let e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Et(this.betaInitializer),gammaInitializer:Et(this.gammaInitializer),movingMeanInitializer:Et(this.movingMeanInitializer),movingVarianceInitializer:Et(this.movingVarianceInitializer),betaRegularizer:ft(this.betaRegularizer),gammaRegularizer:ft(this.gammaRegularizer),betaConstraint:Kt(this.betaConstraint),gammaConstraint:Kt(this.gammaConstraint)},r=super.getConfig();return Object.assign(e,r),e}};i0.className="BatchNormalization";J.registerClass(i0);var a0=class extends ze{constructor(e){if(e==null&&(e={}),super(e),this.axis=e.axis==null?-1:e.axis,typeof this.axis=="number"){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else if(Array.isArray(this.axis)){for(let r of this.axis)if(!Number.isInteger(r))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}else throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);this.epsilon=e.epsilon==null?.001:e.epsilon,this.center=e.center==null?!0:e.center,this.scale=e.scale==null?!0:e.scale,this.betaInitializer=xt(e.betaInitializer||"zeros"),this.gammaInitializer=xt(e.gammaInitializer||"ones"),this.betaRegularizer=kt(e.betaRegularizer),this.gammaRegularizer=kt(e.gammaRegularizer),this.supportsMasking=!0}build(e){e=Ue(e);let r=e.length;typeof this.axis=="number"&&(this.axis=[this.axis]);for(let s=0;s<this.axis.length;++s)this.axis[s]<0&&(this.axis[s]+=r);for(let s of this.axis)if(s<0||s>=r)throw new Error(`Invalid axis: ${s}`);if(this.axis.length!==ks(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);let n=this.axis.map(s=>e[s]),o=!0;this.scale?this.gamma=this.addWeight("gamma",n,"float32",this.gammaInitializer,this.gammaRegularizer,o):this.gamma=null,this.center?this.beta=this.addWeight("beta",n,"float32",this.betaInitializer,this.betaRegularizer,o):this.beta=null,this.built=!0}call(e,r){let n=Re(e),o=n.shape,s=o.length;return U(()=>{let{mean:a,variance:l}=zm(n,this.axis,!0),u=Cs(1,s);for(let h of this.axis)u[h]=o[h];let c=h=>h!=null&&h.shape.length!==s?M(h,u):h,p=this.scale?c(this.gamma.read()):null,f=this.center?c(this.beta.read()):null,d=[],m=[];for(let h=0;h<s;++h)this.axis.indexOf(h)!==-1?(d.push(o[h]),m.push(1)):(d.push(1),m.push(o[h]));return a=yn(a,d),l=yn(l,d),p!=null&&(p=yn(p,m)),f!=null&&(f=yn(f,m)),s0(n,a,l,f,p,this.epsilon)})}getConfig(){let e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:Et(this.betaInitializer),gammaInitializer:Et(this.gammaInitializer),betaRegularizer:ft(this.betaRegularizer),gammaRegularizer:ft(this.gammaRegularizer)},r=super.getConfig();return Object.assign(e,r),e}};a0.className="LayerNormalization";J.registerClass(a0);function Zoe(t,e,r){return U(()=>{if(t.rank!==4)throw new z(`temporalPadding expects input tensor to be 4-D, but received a ${t.rank}-D tensor.`);if(e==null&&(e=[[1,1],[1,1]]),e.length!==2||e[0].length!==2||e[1].length!==2)throw new z("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(r==null&&(r=Xn()),r!=="channelsLast"&&r!=="channelsFirst")throw new z(`Unknown data format: ${r}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let n;return r==="channelsFirst"?n=[[0,0],[0,0],e[0],e[1]]:n=[[0,0],e[0],e[1],[0,0]],rf(t,n)})}var l0=class extends ze{constructor(e){if(e==null&&(e={}),super(e),this.dataFormat=e.dataFormat==null?Xn():e.dataFormat,e.padding==null)this.padding=[[1,1],[1,1]];else if(typeof e.padding=="number")this.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,e.padding.length!==2)throw new z(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${e.padding.length} array.`);let r,n;if(typeof e.padding[0]=="number")r=[e.padding[0],e.padding[0]],n=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,e.padding[0].length!==2)throw new z(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${e.padding[0].length} array.`);if(r=e.padding[0],e.padding[1].length!==2)throw new z(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${e.padding[1].length} array.`);n=e.padding[1]}this.padding=[r,n]}this.inputSpec=[new St({ndim:4})]}computeOutputShape(e){e=Ue(e);let r,n;return this.dataFormat==="channelsFirst"?(e[2]!=null&&e[2]>=0?r=e[2]+this.padding[0][0]+this.padding[0][1]:r=null,e[3]!=null&&e[3]>=0?n=e[3]+this.padding[1][0]+this.padding[1][1]:n=null,[e[0],e[1],r,n]):(e[1]!=null&&e[1]>=0?r=e[1]+this.padding[0][0]+this.padding[0][1]:r=null,e[2]!=null&&e[2]>=0?n=e[2]+this.padding[1][0]+this.padding[1][1]:n=null,[e[0],r,n,e[3]])}call(e,r){return U(()=>Zoe(Re(e),this.padding,this.dataFormat))}getConfig(){let e={padding:this.padding,dataFormat:this.dataFormat},r=super.getConfig();return Object.assign(e,r),e}};l0.className="ZeroPadding2D";J.registerClass(l0);function Gw(t,e,r,n,o,s){return U(()=>{Wt(o),dE(s),jn(n),r==null&&(r=[1,1]),n==null&&(n="valid"),o==null&&(o=Xn()),s==null&&(s="max"),t=Ry(t,o);let i,a=n==="same"?"same":"valid";return s==="max"?i=ef(t,e,r,a):i=Yp(t,e,r,a),o==="channelsFirst"&&(i=Ge(i,[0,3,1,2])),i})}function tB(t,e,r,n,o,s){return U(()=>{Wt(o),dE(s),jn(n),r==null&&(r=[1,1,1]),n==null&&(n="valid"),o==null&&(o=Xn()),s==null&&(s="max"),t=AE(t,o);let i,a=n==="same"?"same":"valid";return s==="max"?i=V2(t,e,r,a):i=b2(t,e,r,a),o==="channelsFirst"&&(i=Ge(i,[0,4,1,2,3])),i})}var Mw=class extends ze{constructor(e){if(e.poolSize==null&&(e.poolSize=2),super(e),typeof e.poolSize=="number")this.poolSize=[e.poolSize];else if(Array.isArray(e.poolSize)&&e.poolSize.length===1&&typeof e.poolSize[0]=="number")this.poolSize=e.poolSize;else throw new z(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.poolSize)}`);if(ir(this.poolSize,"poolSize"),e.strides==null)this.strides=this.poolSize;else if(typeof e.strides=="number")this.strides=[e.strides];else if(Array.isArray(e.strides)&&e.strides.length===1&&typeof e.strides[0]=="number")this.strides=e.strides;else throw new z(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(e.strides)}`);ir(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,jn(this.padding),this.inputSpec=[new St({ndim:3})]}computeOutputShape(e){e=Ue(e);let r=uo(e[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],r,e[2]]}call(e,r){return U(()=>{this.invokeCallHook(e,r),e=Il(Re(e),2);let n=this.poolingFunction(Re(e),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return oi(n,[2])})}getConfig(){let e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},r=super.getConfig();return Object.assign(e,r),e}},u0=class extends Mw{constructor(e){super(e)}poolingFunction(e,r,n,o,s){return Wt(s),jn(o),Gw(e,r,n,o,s,"max")}};u0.className="MaxPooling1D";J.registerClass(u0);var c0=class extends Mw{constructor(e){super(e)}poolingFunction(e,r,n,o,s){return Wt(s),jn(o),Gw(e,r,n,o,s,"avg")}};c0.className="AveragePooling1D";J.registerClass(c0);var zw=class extends ze{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==2)throw new z(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides];ir(this.poolSize,"poolSize"),ir(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Wt(this.dataFormat),jn(this.padding),this.inputSpec=[new St({ndim:4})]}computeOutputShape(e){e=Ue(e);let r=this.dataFormat==="channelsFirst"?e[2]:e[1],n=this.dataFormat==="channelsFirst"?e[3]:e[2];return r=uo(r,this.poolSize[0],this.padding,this.strides[0]),n=uo(n,this.poolSize[1],this.padding,this.strides[1]),this.dataFormat==="channelsFirst"?[e[0],e[1],r,n]:[e[0],r,n,e[3]]}call(e,r){return U(()=>(this.invokeCallHook(e,r),this.poolingFunction(Re(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){let e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},r=super.getConfig();return Object.assign(e,r),e}},p0=class extends zw{constructor(e){super(e)}poolingFunction(e,r,n,o,s){return Wt(s),jn(o),Gw(e,r,n,o,s,"max")}};p0.className="MaxPooling2D";J.registerClass(p0);var f0=class extends zw{constructor(e){super(e)}poolingFunction(e,r,n,o,s){return Wt(s),jn(o),Gw(e,r,n,o,s,"avg")}};f0.className="AveragePooling2D";J.registerClass(f0);var Bw=class extends ze{constructor(e){if(e.poolSize==null&&(e.poolSize=[2,2,2]),super(e),this.poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],e.strides==null)this.strides=this.poolSize;else if(Array.isArray(e.strides)){if(e.strides.length!==3)throw new z(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${e.strides.length}.`);this.strides=e.strides}else this.strides=[e.strides,e.strides,e.strides];ir(this.poolSize,"poolSize"),ir(this.strides,"strides"),this.padding=e.padding==null?"valid":e.padding,this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Wt(this.dataFormat),jn(this.padding),this.inputSpec=[new St({ndim:5})]}computeOutputShape(e){e=Ue(e);let r=this.dataFormat==="channelsFirst"?e[2]:e[1],n=this.dataFormat==="channelsFirst"?e[3]:e[2],o=this.dataFormat==="channelsFirst"?e[4]:e[3];return r=uo(r,this.poolSize[0],this.padding,this.strides[0]),n=uo(n,this.poolSize[1],this.padding,this.strides[1]),o=uo(o,this.poolSize[2],this.padding,this.strides[2]),this.dataFormat==="channelsFirst"?[e[0],e[1],r,n,o]:[e[0],r,n,o,e[4]]}call(e,r){return U(()=>(this.invokeCallHook(e,r),this.poolingFunction(Re(e),this.poolSize,this.strides,this.padding,this.dataFormat)))}getConfig(){let e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},r=super.getConfig();return Object.assign(e,r),e}},d0=class extends Bw{constructor(e){super(e)}poolingFunction(e,r,n,o,s){return Wt(s),jn(o),tB(e,r,n,o,s,"max")}};d0.className="MaxPooling3D";J.registerClass(d0);var m0=class extends Bw{constructor(e){super(e)}poolingFunction(e,r,n,o,s){return Wt(s),jn(o),tB(e,r,n,o,s,"avg")}};m0.className="AveragePooling3D";J.registerClass(m0);var Vw=class extends ze{constructor(e){super(e),this.inputSpec=[new St({ndim:3})]}computeOutputShape(e){return[e[0],e[2]]}call(e,r){throw new $e}},h0=class extends Vw{constructor(e){super(e||{})}call(e,r){return U(()=>{let n=Re(e);return Vt(n,1)})}};h0.className="GlobalAveragePooling1D";J.registerClass(h0);var g0=class extends Vw{constructor(e){super(e||{})}call(e,r){return U(()=>{let n=Re(e);return an(n,1)})}};g0.className="GlobalMaxPooling1D";J.registerClass(g0);var Ww=class extends ze{constructor(e){super(e),this.dataFormat=e.dataFormat==null?"channelsLast":e.dataFormat,Wt(this.dataFormat),this.inputSpec=[new St({ndim:4})]}computeOutputShape(e){return e=e,this.dataFormat==="channelsLast"?[e[0],e[3]]:[e[0],e[1]]}call(e,r){throw new $e}getConfig(){let e={dataFormat:this.dataFormat},r=super.getConfig();return Object.assign(e,r),e}},x0=class extends Ww{call(e,r){return U(()=>{let n=Re(e);return this.dataFormat==="channelsLast"?Vt(n,[1,2]):Vt(n,[2,3])})}};x0.className="GlobalAveragePooling2D";J.registerClass(x0);var y0=class extends Ww{call(e,r){return U(()=>{let n=Re(e);return this.dataFormat==="channelsLast"?an(n,[1,2]):an(n,[2,3])})}};y0.className="GlobalMaxPooling2D";J.registerClass(y0);var Uw=class extends ze{constructor(e){super(e),this.layer=e.layer}build(e){this.built=!0}get trainable(){return this.layer!=null?this.layer.trainable:!1}set trainable(e){this.layer!=null&&(this.layer.trainable=e)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(e){this.layer.setWeights(e)}getConfig(){let e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},r=super.getConfig();return Object.assign(e,r),e}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.layer!=null&&this.layer.setFastWeightInitDuringBuild(e)}static fromConfig(e,r,n={}){let o=r.layer,s=Do(o,n);delete r.layer;let i={layer:s};return Object.assign(i,r),new e(i)}},b0=class extends Uw{constructor(e){super(e),this.supportsMasking=!0}build(e){if(e=Ue(e),e.length<3)throw new z(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(e)}`);this.inputSpec=[{shape:e}];let r=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(r),this.layer.built=!0),super.build(e)}computeOutputShape(e){e=Ue(e);let r=[e[0]].concat(e.slice(2)),n=this.layer.computeOutputShape(r),o=e[1];return[n[0],o].concat(n.slice(1))}call(e,r){return U(()=>(e=Re(e),$E((i,a)=>[Re(this.layer.call(i,r)),[]],e,[],!1,null,null,!1,!0)[1]))}};b0.className="TimeDistributed";J.registerClass(b0);function Joe(t){Ki(mz,"BidirectionalMergeMode",t)}var ese="concat",v0=class extends Uw{constructor(e){super(e);let r=e.layer.getConfig(),n={};n.className=e.layer.getClassName(),n.config=r,this.forwardLayer=Do(n),r.goBackwards=r.goBackwards!==!0;let o={};if(o.className=e.layer.getClassName(),o.config=r,this.backwardLayer=Do(o),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=e.mergeMode===void 0?ese:e.mergeMode,Joe(this.mergeMode),e.weights)throw new $e("weights support is not implemented for Bidirectional layer yet.");this._stateful=e.layer.stateful,this.returnSequences=e.layer.returnSequences,this.returnState=e.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=e.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(e){this._trainable=e,this.forwardLayer!=null&&(this.forwardLayer.trainable=e),this.backwardLayer!=null&&(this.backwardLayer.trainable=e)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(e){let r=e.length,n=Math.floor(r/2);this.forwardLayer.setWeights(e.slice(0,n)),this.backwardLayer.setWeights(e.slice(n))}computeOutputShape(e){let r=this.forwardLayer.computeOutputShape(e);Array.isArray(r)&&Array.isArray(r[0])||(r=[r]),r=r;let n,o,s;return this.returnState&&(s=r.slice(1)),n=r[0],n=n,this.mergeMode==="concat"?(n[n.length-1]*=2,o=[n]):this.mergeMode==null?o=[n,n.slice()]:o=[n],this.returnState?this.mergeMode==null?o.concat(s).concat(s.slice()):[n].concat(s).concat(s.slice()):qr(o)}apply(e,r){let n=r==null?null:r.initialState,o=r==null?null:r.constants;r==null&&(r={});let s=DE(e,n,o,this.numConstants);if(e=s.inputs,n=s.initialState,o=s.constants,Array.isArray(e)&&(n=e.slice(1),e=e[0]),(n==null||n.length===0)&&o==null)return super.apply(e,r);let i=[],a=[];if(n!=null){let u=n.length;if(u%2>0)throw new z("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");r.initialState=n,i.push(...n);let c=n.map(p=>new St({shape:p.shape}));this.forwardLayer.stateSpec=c.slice(0,u/2),this.backwardLayer.stateSpec=c.slice(u/2),a.push(...c)}if(o!=null)throw new $e("Support for constants in Bidirectional layers is not implemented yet.");let l=i[0]instanceof On;for(let u of i)if(u instanceof On!==l)throw new z("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(l){let u=[e].concat(i),c=this.inputSpec.concat(a),p=this.inputSpec;this.inputSpec=c;let f=super.apply(u,r);return this.inputSpec=p,f}else return super.apply(e,r)}call(e,r){return U(()=>{let n=r.initialState,o,s;if(n==null)o=this.forwardLayer.call(e,r),s=this.backwardLayer.call(e,r);else{let l=n.slice(0,n.length/2),u=n.slice(n.length/2);o=this.forwardLayer.call(e,Object.assign(r,{initialState:l})),s=this.backwardLayer.call(e,Object.assign(r,{initialState:u}))}let i;this.returnState&&(Array.isArray(o)&&(i=o.slice(1).concat(s.slice(1))),o=o[0],s=s[0]),this.returnSequences&&(s=Qo(s,1));let a;return this.mergeMode==="concat"?a=eh([o,s]):this.mergeMode==="sum"?a=te(o,s):this.mergeMode==="ave"?a=L(.5,te(o,s)):this.mergeMode==="mul"?a=L(o,s):this.mergeMode==null&&(a=[o,s]),this.returnState?this.mergeMode==null?a.concat(i):[a].concat(i):a})}resetStates(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(e){li(this.forwardLayer.name,()=>{this.forwardLayer.build(e)}),li(this.backwardLayer.name,()=>{this.backwardLayer.build(e)}),this.built=!0}computeMask(e,r){Array.isArray(r)&&(r=r[0]);let n;if(this.returnSequences?this.mergeMode==null?n=[r,r]:n=r:this.mergeMode==null?n=[null,null]:n=null,this.returnState){let s=this.forwardLayer.states.map(i=>null);return Array.isArray(n)?n.concat(s).concat(s):[n].concat(s).concat(s)}else return n}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(e){super.setFastWeightInitDuringBuild(e),this.forwardLayer!=null&&this.forwardLayer.setFastWeightInitDuringBuild(e),this.backwardLayer!=null&&this.backwardLayer.setFastWeightInitDuringBuild(e)}getConfig(){let e={mergeMode:this.mergeMode},r=super.getConfig();return Object.assign(e,r),e}static fromConfig(e,r){let n=Do(r.layer);if(delete r.layer,r.numConstants!=null)throw new $e("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");let o=r;return o.layer=n,new e(o)}};v0.className="Bidirectional";J.registerClass(v0);var w0=class extends ze{constructor(e){super(e),this.scale=e.scale,e.offset?this.offset=e.offset:this.offset=0}getConfig(){let e={scale:this.scale,offset:this.offset},r=super.getConfig();return Object.assign(e,r),e}call(e,r){return U(()=>(e=Re(e),e.dtype!=="float32"&&(e=$n(e,"float32")),te(L(e,this.scale),this.offset)))}};w0.className="Rescaling";J.registerClass(w0);var{resizeBilinear:tse,cropAndResize:rse}=ii,C0=class extends ze{constructor(e){super(e),this.height=e.height,this.width=e.width}centerCrop(e,r,n,o,s,i,a,l){return U(()=>{let u,c=!1,p=r/i,f=n/a,d=(o+r)/i,m=(s+n)/a,h=[p,f,d,m],g=[];e.rank===3?(c=!0,u=Lr([e])):u=e;for(let C=0;C<u.shape[0];C++)g.push(h);let x=Cr(g,[g.length,4]),y=kl(0,g.length,1,"int32"),v=rse(u,x,y,[o,s],"nearest");return c?$n(Re(Dn(v)),l):$n(v,l)})}upsize(e,r,n,o){return U(()=>{let s=tse(e,[r,n]);return $n(s,o)})}call(e,r){return U(()=>{let n=Re(e),o=n.dtype,s=n.shape,i=s[s.length-3],a=s[s.length-2],l=0;i!==this.height&&(l=Math.floor((i-this.height)/2));let u=0;return a!==this.width&&(u=Math.floor((a-this.width)/2),u===0&&(u=1)),l>=0&&u>=0?this.centerCrop(n,l,u,this.height,this.width,i,a,o):this.upsize(e,this.height,this.width,o)})}getConfig(){let e={height:this.height,width:this.width},r=super.getConfig();return Object.assign(e,r),e}computeOutputShape(e){e=Ue(e);let r=e.length-3,n=e.length-2;return e[r]=this.height,e[n]=this.width,e}};C0.className="CenterCrop";J.registerClass(C0);function rB(t,e,r,n){let o=Re(t);if(o.dtype!=="int32"&&(o=$n(o,"int32")),e==="int")return o;let s=o.shape;if(o.rank===0&&(o=Dr(o,-1)),e==="oneHot"&&o.shape[o.shape.length-1]!==1&&(o=Dr(o,-1)),o.rank>2)throw new z(`When outputMode is not int, maximum output rank is 2 Received outputMode ${e} and input shape ${s} which would result in output rank ${o.rank}.`);let i=["multiHot","oneHot"].includes(e),a=o,l;if(typeof n<"u"&&e==="count"?l=k1(a,n,r,i):l=k1(a,[],r,i),e!=="tfIdf")return l;if(n)return L(l,n);throw new z("When outputMode is 'tfIdf', weights must be provided.")}var S0=class extends ze{constructor(e){super(e),this.numTokens=e.numTokens,e.outputMode?this.outputMode=e.outputMode:this.outputMode="multiHot"}getConfig(){let e={numTokens:this.numTokens,outputMode:this.outputMode},r=super.getConfig();return Object.assign(e,r),e}computeOutputShape(e){return e=Ue(e),e==null?[this.numTokens]:this.outputMode==="oneHot"&&e[e.length-1]!==1?(e.push(this.numTokens),e):(e[e.length-1]=this.numTokens,e)}call(e,r){return U(()=>{e=Re(e),e.dtype!=="int32"&&(e=$n(e,"int32"));let n;if(typeof r.countWeights<"u"){if(this.outputMode!=="count")throw new z(`countWeights is not used when outputMode !== count.
              Received countWeights=${r.countWeights}`);n=Re(r.countWeights)}let o=an(e),s=gc(e),i=er(this.numTokens,o).bufferSync().get(0),a=io(s,0).bufferSync().get(0);if(!(i&&a))throw new z(`Input values must be between 0 < values <= numTokens with numTokens=${this.numTokens}`);return rB(e,this.outputMode,this.numTokens,n)})}};S0.className="CategoryEncoding";J.registerClass(S0);var ose=["bilinear","nearest"],nB=new Set(ose),k0=class extends ze{constructor(e){if(super(e),this.height=e.height,this.width=e.width,e.interpolation)if(nB.has(e.interpolation))this.interpolation=e.interpolation;else throw new z(`Invalid interpolation parameter: ${e.interpolation} is not implemented`);else this.interpolation="bilinear";this.cropToAspectRatio=Boolean(e.cropToAspectRatio)}computeOutputShape(e){e=Ue(e);let r=e[2];return[this.height,this.width,r]}getConfig(){let e={height:this.height,width:this.width,interpolation:this.interpolation,cropToAspectRatio:this.cropToAspectRatio},r=super.getConfig();return Object.assign(e,r),e}call(e,r){return U(()=>{let n=[this.height,this.width];if(this.interpolation==="bilinear")return ii.resizeBilinear(e,n,!this.cropToAspectRatio);if(this.interpolation==="nearest")return ii.resizeNearestNeighbor(e,n,!this.cropToAspectRatio);throw new Error(`Interpolation is ${this.interpolation} but only ${[...nB]} are supported`)})}};k0.className="Resizing";J.registerClass(k0);var cse=B();cse.registerFlag("KEEP_INTERMEDIATE_TENSORS",()=>!1,t=>{t&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")});var RE;(function(t){t[t.DT_INVALID=0]="DT_INVALID",t[t.DT_FLOAT=1]="DT_FLOAT",t[t.DT_DOUBLE=2]="DT_DOUBLE",t[t.DT_INT32=3]="DT_INT32",t[t.DT_UINT8=4]="DT_UINT8",t[t.DT_INT16=5]="DT_INT16",t[t.DT_INT8=6]="DT_INT8",t[t.DT_STRING=7]="DT_STRING",t[t.DT_COMPLEX64=8]="DT_COMPLEX64",t[t.DT_INT64=9]="DT_INT64",t[t.DT_BOOL=10]="DT_BOOL",t[t.DT_QINT8=11]="DT_QINT8",t[t.DT_QUINT8=12]="DT_QUINT8",t[t.DT_QINT32=13]="DT_QINT32",t[t.DT_BFLOAT16=14]="DT_BFLOAT16",t[t.DT_QINT16=15]="DT_QINT16",t[t.DT_QUINT16=16]="DT_QUINT16",t[t.DT_UINT16=17]="DT_UINT16",t[t.DT_COMPLEX128=18]="DT_COMPLEX128",t[t.DT_HALF=19]="DT_HALF",t[t.DT_RESOURCE=20]="DT_RESOURCE",t[t.DT_VARIANT=21]="DT_VARIANT",t[t.DT_UINT32=22]="DT_UINT32",t[t.DT_UINT64=23]="DT_UINT64",t[t.DT_FLOAT_REF=101]="DT_FLOAT_REF",t[t.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",t[t.DT_INT32_REF=103]="DT_INT32_REF",t[t.DT_UINT8_REF=104]="DT_UINT8_REF",t[t.DT_INT16_REF=105]="DT_INT16_REF",t[t.DT_INT8_REF=106]="DT_INT8_REF",t[t.DT_STRING_REF=107]="DT_STRING_REF",t[t.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",t[t.DT_INT64_REF=109]="DT_INT64_REF",t[t.DT_BOOL_REF=110]="DT_BOOL_REF",t[t.DT_QINT8_REF=111]="DT_QINT8_REF",t[t.DT_QUINT8_REF=112]="DT_QUINT8_REF",t[t.DT_QINT32_REF=113]="DT_QINT32_REF",t[t.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",t[t.DT_QINT16_REF=115]="DT_QINT16_REF",t[t.DT_QUINT16_REF=116]="DT_QUINT16_REF",t[t.DT_UINT16_REF=117]="DT_UINT16_REF",t[t.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",t[t.DT_HALF_REF=119]="DT_HALF_REF",t[t.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",t[t.DT_VARIANT_REF=121]="DT_VARIANT_REF",t[t.DT_UINT32_REF=122]="DT_UINT32_REF",t[t.DT_UINT64_REF=123]="DT_UINT64_REF"})(RE||(RE={}));var oB;(function(t){let e;(function(r){r[r.LEGACY=0]="LEGACY",r[r.V1=1]="V1",r[r.V2=2]="V2"})(e=t.CheckpointFormatVersion||(t.CheckpointFormatVersion={}))})(oB||(oB={}));var hB=rt(zx());var fB=rt(zx());function iB(t,e){return aB(t,e)}function aB(t,e,r=new Map,n=new Set){if(t==null)return null;if(typeof Blob=="function"&&t instanceof Blob)return t.slice();if(n.has(t))throw new Error("Circular references are not supported.");if(r.has(t))return r.get(t);let o=e(t);if(o.recurse&&o.value!==null)throw new Error("A deep map function may not return both a value and recurse=true.");if(o.recurse)if(wh(t)){let s=Array.isArray(t)?[]:{};n.add(t);for(let i in t){let a=t[i],l=aB(a,e,r,n);s[i]=l}return n.delete(t),t.__proto__&&(s.__proto__=t.__proto__),s}else throw new Error(`Can't recurse into non-iterable type: ${t}`);else return r.set(t,o.value),o.value}function lB(t,e=OE){return uB(t,e)}function uB(t,e,r=new Set){let n=t[0];if(r.has(n))throw new Error("Circular references are not supported.");let o=e(t);if(o.recurse&&o.value!==null)throw new Error("A deep zip function may not return both a value and recurse=true.");if(o.recurse)if(wh(n)){let s=Array.isArray(n)?[]:{};r.add(n);for(let i in n){let a=t.map(u=>u[i]),l=uB(a,e,r);s[i]=l}return r.delete(n),s}else throw new Error(`Can't recurse into non-iterable type: ${n}`);else return o.value}function OE(t){return t===null?null:wh(t[0])?{value:null,recurse:!0}:{value:t,recurse:!1}}function wh(t){let e=!1;if(B().get("IS_BROWSER"))e=t instanceof TextDecoder;else{let{StringDecoder:r}=sB();e=t instanceof r}return t!=null&&!ArrayBuffer.isView(t)&&(Array.isArray(t)||typeof t=="object"&&!(t instanceof Ze)&&!(t instanceof Promise)&&!e)}function cB(t){return t==null||nie(t)||Array.isArray(t)||typeof t=="object"&&t instanceof Ze||w.isTypedArray(t)}function nie(t){return t===null||typeof t!="object"&&typeof t!="function"}function pB(t){return iB(t,oie)}function oie(t){return t instanceof Ze?{value:t.clone(),recurse:!1}:wh(t)?{value:null,recurse:!0}:{value:t,recurse:!1}}var Ch=class{constructor(e){if(this.capacity=e,this.begin=0,this.end=0,e==null)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(e<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(e),this.doubledCapacity=2*e}wrap(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity}get(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]}set(e,r){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=r}length(){let e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e}isFull(){return this.length()===this.capacity}isEmpty(){return this.length()===0}push(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)}pushAll(e){for(let r of e)this.push(r)}pop(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);let e=this.get(this.end);return this.set(this.end,void 0),e}unshift(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)}shift(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");let e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e}shuffleExcise(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");let r=this.wrap(this.begin+e),n=this.get(r);return this.set(r,this.pop()),n}};var Cf=class extends Ch{constructor(){super(Cf.INITIAL_CAPACITY)}isFull(){return!1}push(e){super.isFull()&&this.expand(),super.push(e)}unshift(e){super.isFull()&&this.expand(),super.unshift(e)}expand(){let e=this.capacity*2,r=new Array(e),n=this.length();for(let o=0;o<n;o++)r[o]=this.get(this.wrap(this.begin+o));this.data=r,this.capacity=e,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=n}};Cf.INITIAL_CAPACITY=32;function dB(t){return new FE(t)}function jE(t){return new PE(t)}function mB(t,e){return new jw(t,e)}var ln=class{async toArray(){let e=[],r=await this.next();for(;!r.done;)e.push(r.value),r=await this.next();return e}async toArrayForTest(){let e=this.prefetch(100),r=[],n=await e.next();for(;!n.done;)r.push(n.value),n=await e.next();return r}async resolveFully(){let e=await this.next();for(;!e.done;)e=await this.next()}async resolveWhile(e){let r=await this.next(),n=e(r.value);for(;!r.done&&n;)r=await this.next(),n=e(r.value)}handleErrors(e){return new GE(this,e)}filter(e){return new VE(this,e)}map(e){return new WE(this,e)}mapAsync(e){return new qw(this,e)}serialMapAsync(e){return new qw(this,e).serial()}flatmap(e){return new UE(this,e)}async forEachAsync(e){return this.map(e).resolveFully()}async serialForEach(e){return this.serialMapAsync(e).resolveWhile(r=>r===!0)}rowMajorBatch(e,r=!0){return new BE(this,e,r)}columnMajorBatch(e,r=!0,n=OE){return this.rowMajorBatch(e,r).map(s=>lB(s,n))}concatenate(e,r){return new jw(dB([this,e]),r)}take(e){return e<0||e==null?this:new zE(this,e)}skip(e){return e<0||e==null?this:new ME(this,e)}prefetch(e){return new Kw(this,e)}shuffle(e,r){return new qE(this,e,r)}serial(){return new LE(this)}},FE=class extends ln{constructor(e){super(),this.items=e,this.trav=0}summary(){return`Array of ${this.items.length} items`}async next(){if(this.trav>=this.items.length)return{value:null,done:!0};let e=this.items[this.trav];return this.trav++,{value:pB(e),done:!1}}},PE=class extends ln{constructor(e){super(),this.nextFn=e}summary(){return"Function call"}async next(){try{return this.nextFn()}catch(e){throw e.message=`Error thrown while iterating through a dataset: ${e.message}`,e}}},LE=class extends ln{constructor(e){super(),this.upstream=e,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Serial`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){return this.upstream.next()}},ME=class extends ln{constructor(e,r){super(),this.upstream=e,this.maxCount=r,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Skip`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;this.count++<this.maxCount;){let e=await this.upstream.next();if(e.done)return e;Me(e.value)}return this.upstream.next()}},zE=class extends ln{constructor(e,r){super(),this.upstream=e,this.maxCount=r,this.count=0}summary(){return`${this.upstream.summary()} -> Take`}async next(){return this.count++>=this.maxCount?{value:null,done:!0}:this.upstream.next()}},BE=class extends ln{constructor(e,r,n=!0){super(),this.upstream=e,this.batchSize=r,this.enableSmallLastBatch=n,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> RowMajorBatch`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){let e=[];for(;e.length<this.batchSize;){let r=await this.upstream.next();if(r.done)return this.enableSmallLastBatch&&e.length>0?{value:e,done:!1}:{value:null,done:!0};e.push(r.value)}return{value:e,done:!1}}},VE=class extends ln{constructor(e,r){super(),this.upstream=e,this.predicate=r,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Filter`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;;){let e=await this.upstream.next();if(e.done||this.predicate(e.value))return e;Me(e.value)}}},WE=class extends ln{constructor(e,r){super(),this.upstream=e,this.transform=r}summary(){return`${this.upstream.summary()} -> Map`}async next(){let e=await this.upstream.next();if(e.done)return{value:null,done:!0};let r=hs.getTensorsInContainer(e.value),n=this.transform(e.value),o=hs.getTensorsInContainer(n);for(let s of r)hs.isTensorInList(s,o)||s.dispose();return{value:n,done:!1}}},GE=class extends ln{constructor(e,r){super(),this.upstream=e,this.handler=r,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> handleErrors`}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;;)try{return await this.upstream.next()}catch(e){if(!this.handler(e))return{value:null,done:!0}}}},qw=class extends ln{constructor(e,r){super(),this.upstream=e,this.transform=r}summary(){return`${this.upstream.summary()} -> AsyncMap`}async next(){let e=await this.upstream.next();if(e.done)return{value:null,done:!0};let r=hs.getTensorsInContainer(e.value),n=await this.transform(e.value),o=hs.getTensorsInContainer(n);for(let s of r)hs.isTensorInList(s,o)||s.dispose();return{value:n,done:!1}}},T0=class extends ln{constructor(){super(),this.outputQueue=new Cf,this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}async serialNext(){for(;this.outputQueue.length()===0;)if(!await this.pump())return{value:null,done:!0};return{value:this.outputQueue.shift(),done:!1}}},UE=class extends T0{constructor(e,r){super(),this.upstream=e,this.transform=r}summary(){return`${this.upstream.summary()} -> Flatmap`}async pump(){let e=await this.upstream.next();if(e.done)return!1;let r=hs.getTensorsInContainer(e.value),n=this.transform(e.value),o=hs.getTensorsInContainer(n);this.outputQueue.pushAll(n);for(let s of r)hs.isTensorInList(s,o)||s.dispose();return!0}},jw=class extends ln{constructor(e,r){super(),this.baseErrorHandler=r,this.lastRead=null,this.iterator=null,this.moreIterators=e}summary(){return"TODO: fill in upstream of chained summaries -> Chained"}async next(){return this.lastRead=this.readFromChain(this.lastRead),this.lastRead}async readFromChain(e){if(await e,this.iterator==null){let n=await this.moreIterators.next();if(n.done)return{value:null,done:!0};this.iterator=n.value,this.baseErrorHandler!=null&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler))}let r=await this.iterator.next();return r.done?(this.iterator=null,this.readFromChain(e)):r}},HE;(function(t){t[t.FAIL=0]="FAIL",t[t.SHORTEST=1]="SHORTEST",t[t.LONGEST=2]="LONGEST"})(HE||(HE={}));var Kw=class extends ln{constructor(e,r){super(),this.upstream=e,this.bufferSize=r,this.buffer=new Ch(r)}summary(){return`${this.upstream.summary()} -> Prefetch`}refill(){for(;!this.buffer.isFull();){let e=this.upstream.next();this.buffer.push(e)}}next(){return this.refill(),this.buffer.shift()}},qE=class extends Kw{constructor(e,r,n){super(e,r),this.upstream=e,this.windowSize=r,this.upstreamExhausted=!1,this.random=fB.alea(n||w.now().toString()),this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then(()=>this.serialNext()),this.lastRead}randomInt(e){return Math.floor(this.random()*e)}chooseIndex(){return this.randomInt(this.buffer.length())}async serialNext(){for(this.upstreamExhausted||this.refill();!this.buffer.isEmpty();){let e=this.chooseIndex(),r=await this.buffer.shuffleExcise(e);if(r.done)this.upstreamExhausted=!0;else return this.refill(),r}return{value:null,done:!0}}};var Sf=class{constructor(){this.size=null}batch(e,r=!0){let n=this;w.assert(e>0,()=>`batchSize needs to be positive, but it is
      ${e}`);let o;return this.size===1/0||this.size==null?o=this.size:r?o=Math.ceil(this.size/e):o=Math.floor(this.size/e),di(async()=>(await n.iterator()).columnMajorBatch(e,r,iie),o)}concatenate(e){let r=this,n;return this.size===1/0||e.size===1/0?n=1/0:this.size!=null&&e.size!=null?n=this.size+e.size:n=null,di(async()=>(await r.iterator()).concatenate(await e.iterator()),n)}filter(e){let r=this,n;return this.size===1/0?n=1/0:n=null,di(async()=>(await r.iterator()).filter(o=>U(()=>e(o))),n)}async forEachAsync(e){return(await this.iterator()).forEachAsync(e)}map(e){let r=this;return di(async()=>(await r.iterator()).map(n=>U(()=>e(n))),this.size)}mapAsync(e){let r=this;return di(async()=>(await r.iterator()).mapAsync(e),this.size)}prefetch(e){if(e==null)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");let r=this;return di(async()=>(await r.iterator()).prefetch(e),this.size)}repeat(e){let r=this,n;return this.size!=null&&e>0?n=this.size*e:e===0?n=0:this.size!=null&&(e===void 0||e<0)?n=1/0:n=null,di(async()=>{let o=jE(async()=>({value:await r.iterator(),done:!1}));return mB(o.take(e))},n)}skip(e){let r=this,n;return this.size!=null&&e>=0&&this.size>=e?n=this.size-e:this.size!=null&&(this.size<e||e===void 0||e<0)?n=0:n=null,di(async()=>(await r.iterator()).skip(e),n)}shuffle(e,r,n=!0){if(e==null||e<0)throw this.size==null?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError(`\`Dataset.shuffle()\` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for \`tf.Tensor\`s), consider setting bufferSize to the dataset size (${this.size} elements)`);let o=this,s=hB.alea(r||w.now().toString());return di(async()=>{let i=s.int32();return n&&(i+=s.int32()),(await o.iterator()).shuffle(e,i.toString())},this.size)}take(e){let r=this,n;return this.size!=null&&this.size>e?n=e:this.size!=null&&this.size<=e?n=this.size:n=null,di(async()=>(await r.iterator()).take(e),n)}async toArray(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArray()}async toArrayForTest(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArrayForTest()}};Sf.MAX_BUFFER_SIZE=1e4;function di(t,e=null){return new class extends Sf{constructor(){super(...arguments),this.size=e}async iterator(){return t()}}}function iie(t){if(t===null)return null;let e=t[0];return cB(e)?{value:aie(t),recurse:!1}:{value:null,recurse:!0}}function aie(t){if(t.length===0)throw new Error("Can't make a batch of zero elements.");return t[0]instanceof Ze?Lr(t):Cr(t)}var axt=Symbol("out"),lxt=Symbol("field"),uxt=Symbol("quote"),cxt=Symbol("quoteafterquote"),pxt=Symbol("quoteinquote");function ee(t,e){Array.isArray(t)||(t=[t]),t.forEach(r=>{r!=null&&w.assert(r.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the CPU backend.`)})}var xie=vn.whereImpl,kf=class extends ya{constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new kp(this,gs())}nextDataId(){return kf.nextDataId++}write(e,r,n){this.firstUse&&(this.firstUse=!1,B().get("IS_NODE")&&T.warn(`
============================
Hi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. 
============================`));let o={id:this.nextDataId()};return this.data.set(o,{values:e,dtype:n,refCount:1}),o}makeTensorInfo(e,r,n){let o;if(r==="string"&&n!=null&&n.length>0&&w.isString(n[0])){let s=n.map(i=>w.encodeString(i));o=this.write(s,e,r)}else o=this.write(n,e,r);return{dataId:o,shape:e,dtype:r}}refCount(e){return this.data.has(e)?this.data.get(e).refCount:0}incRef(e){let r=this.data.get(e);r.refCount++}decRef(e){if(this.data.has(e)){let r=this.data.get(e);r.refCount--}}move(e,r,n,o,s){this.data.set(e,{values:r,dtype:o,refCount:s})}numDataIds(){return this.data.numDataIds()}async read(e){return this.readSync(e)}readSync(e){let{dtype:r,complexTensorInfos:n}=this.data.get(e);if(r==="complex64"){let o=this.readSync(n.real.dataId),s=this.readSync(n.imag.dataId);return T.mergeRealAndImagArrays(o,s)}return this.data.get(e).values}bufferSync(e){let r=this.readSync(e.dataId);if(e.dtype==="string")try{let n=r.map(o=>w.decodeString(o));return Ee(e.shape,e.dtype,n)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Ee(e.shape,e.dtype,r)}makeOutput(e,r,n){return gs().makeTensorFromTensorInfo(this.makeTensorInfo(r,n,e),this)}disposeData(e,r=!1){if(this.data.has(e)){if(this.data.get(e).refCount--,!r&&this.data.get(e).refCount>0)return!1;let{complexTensorInfos:n}=this.data.get(e);n!=null&&(this.disposeData(n.real.dataId,!0),this.disposeData(n.imag.dataId,!0)),this.data.delete(e)}return!0}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}async time(e){let r=w.now();return e(),{kernelMs:w.now()-r}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(e){ee([e],"where");let r=this.readSync(e.dataId);return xie(e.shape,r)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}};kf.nextDataId=0;var v_={};Ho(v_,{addImpl:()=>YE,bincountImpl:()=>Th,bincountReduceImpl:()=>Xw,castImpl:()=>XE,ceilImpl:()=>QE,concatImpl:()=>Yw,equalImpl:()=>ZE,expImpl:()=>e_,expm1Impl:()=>r_,floorImpl:()=>n_,gatherNdImpl:()=>Qw,gatherV2Impl:()=>Zw,greaterEqualImpl:()=>s_,greaterImpl:()=>o_,lessEqualImpl:()=>a_,lessImpl:()=>i_,linSpaceImpl:()=>Jw,logImpl:()=>l_,maxImpl:()=>eC,maximumImpl:()=>u_,minimumImpl:()=>c_,multiplyImpl:()=>N0,negImpl:()=>p_,notEqualImpl:()=>f_,prodImpl:()=>d_,raggedGatherImpl:()=>tC,raggedRangeImpl:()=>rC,raggedTensorToTensorImpl:()=>nC,rangeImpl:()=>oC,rsqrtImpl:()=>m_,scatterImpl:()=>Rl,sigmoidImpl:()=>UB,simpleAbsImpl:()=>KE,sliceImpl:()=>g_,sparseFillEmptyRowsImpl:()=>sC,sparseReshapeImpl:()=>iC,sparseSegmentReductionImpl:()=>Eh,sqrtImpl:()=>jB,squaredDifferenceImpl:()=>x_,stridedSliceImpl:()=>aC,stringNGramsImpl:()=>lC,stringSplitImpl:()=>uC,stringToHashBucketFastImpl:()=>cC,subImpl:()=>b_,tileImpl:()=>pC,topKImpl:()=>fC,transposeImpl:()=>Nh,uniqueImpl:()=>dC});function KE(t){let e=new Float32Array(t.length);for(let r=0;r<t.length;++r)e[r]=Math.abs(t[r]);return e}var yie=t=>{let{x:e}=t.inputs,r=t.backend;ee(e,"abs");let n=new Float32Array(w.sizeFromShape(e.shape)),o=r.data.get(e.dataId).values;return n=KE(o),r.makeOutput(n,e.shape,e.dtype)},gB={kernelName:bu,backendName:"cpu",kernelFunc:yie};function tt(t){return(e,r,n,o,s)=>{let i=T.assertAndGetBroadcastShape(e,r),a=i.length,l=w.computeStrides(i),u=w.sizeFromShape(i),c=w.getTypedArrayFromDType(s,u),p=e.length,f=r.length,d=w.computeStrides(e),m=w.computeStrides(r),h=T.getBroadcastDims(e,i),g=T.getBroadcastDims(r,i);if(h.length+g.length===0)for(let x=0;x<c.length;++x)c[x]=t(n[x%n.length],o[x%o.length]);else for(let x=0;x<c.length;++x){let y=w.indexToLoc(x,a,l),b=y.slice(-p);h.forEach(k=>b[k]=0);let v=w.locToIndex(b,p,d),C=y.slice(-f);g.forEach(k=>C[k]=0);let S=w.locToIndex(C,f,m);c[x]=t(n[v],o[S])}return[c,i]}}function Mr(t){let{inputs:e,backend:r}=t,{real:n,imag:o}=e,s=r.data.get(n.dataId).values,i=r.data.get(o.dataId).values,a=r.makeTensorInfo(n.shape,"complex64"),l=r.data.get(a.dataId);return l.complexTensorInfos={real:r.makeTensorInfo(n.shape,"float32",s),imag:r.makeTensorInfo(o.shape,"float32",i)},a}var xB={kernelName:Vd,backendName:"cpu",kernelFunc:Mr};function Sh(t,e,r="float32"){if(r==="complex64"){let o=Sh(t,e,"float32"),s=Sh(t,e,"float32");return Mr({inputs:{real:o,imag:s},backend:t})}let n=w.makeZerosTypedArray(w.sizeFromShape(e),r);return t.makeTensorInfo(e,r,n)}function Cn(t){let{inputs:e,backend:r}=t,{x:n}=e;return r.incRef(n.dataId),{dataId:n.dataId,shape:n.shape,dtype:n.dtype}}var yB={kernelName:Oi,backendName:"cpu",kernelFunc:Cn};function As(t){let{inputs:e,backend:r}=t,{input:n}=e,o=r.data.get(n.dataId).complexTensorInfos.real,s=r.data.get(o.dataId).values;return r.makeTensorInfo(o.shape,o.dtype,s)}var bB={kernelName:pm,backendName:"cpu",kernelFunc:As};function XE(t,e,r,n){if(n==="int32"){let o=Int32Array.from(t);return[e,"int32",o]}if(n==="bool"){let o=w.toTypedArray([0],r),[s,i]=tt((a,l)=>a!==l?1:0)(e,[],t,o,"bool");return[i,"bool",s]}throw new Error(`Error in Cast: failed to cast ${r} to ${n}`)}function Ds(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{dtype:s}=n;if(s==="complex64"){if(o.dtype==="complex64")return Cn({inputs:{x:o},backend:r});let c=Sh(r,o.shape,o.dtype),p=Ds({inputs:{x:o},backend:r,attrs:{dtype:"float32"}}),f=Mr({inputs:{real:p,imag:c},backend:r});return r.disposeIntermediateTensorInfo(c),r.disposeIntermediateTensorInfo(p),f}if(o.dtype==="complex64"){let c=As({inputs:{input:o},backend:r}),p=Ds({inputs:{x:c},backend:r,attrs:{dtype:s}});return r.disposeIntermediateTensorInfo(c),p}if(!w.hasEncodingLoss(o.dtype,s)){let c=Cn({inputs:{x:o},backend:r});return{dataId:c.dataId,shape:c.shape,dtype:s}}let i=r.data.get(o.dataId).values,[a,l,u]=XE(i,o.shape,o.dtype,s);return r.makeTensorInfo(a,l,u)}var vB={kernelName:Ri,backendName:"cpu",kernelFunc:Ds};function it(t,e,r,n){return r==null?({inputs:o,backend:s})=>{let{a:i,b:a}=o,l=s;ee([i,a],t);let u=l.data.get(i.dataId).values,c=l.data.get(a.dataId).values,p=i.dtype==="string"?T.fromUint8ToStringArray(u):u,f=i.dtype==="string"?T.fromUint8ToStringArray(c):c,d=n||i.dtype,[m,h]=e(i.shape,a.shape,p,f,d);return l.makeTensorInfo(h,d,m)}:({inputs:o,backend:s})=>{let{a:i,b:a}=o,l=s;if(i.dtype==="complex64"||a.dtype==="complex64"){let u=Ds({inputs:{x:i},backend:l,attrs:{dtype:"complex64"}}),c=l.data.get(u.dataId),p=c.complexTensorInfos.real,f=c.complexTensorInfos.imag,d=l.data.get(p.dataId).values,m=l.data.get(f.dataId).values,h=Ds({inputs:{x:a},backend:l,attrs:{dtype:"complex64"}}),g=l.data.get(h.dataId),x=g.complexTensorInfos.real,y=g.complexTensorInfos.imag,b=l.data.get(x.dataId).values,v=l.data.get(y.dataId).values,[C,S,k]=r(i.shape,a.shape,d,m,b,v),N=l.makeTensorInfo(k,"float32",C),D=l.makeTensorInfo(k,"float32",S),$=Mr({inputs:{real:N,imag:D},backend:l});return l.disposeIntermediateTensorInfo(u),l.disposeIntermediateTensorInfo(h),l.disposeIntermediateTensorInfo(N),l.disposeIntermediateTensorInfo(D),$}else{let u=l.data.get(i.dataId).values,c=l.data.get(a.dataId).values,p=n||i.dtype,[f,d]=e(i.shape,a.shape,u,c,p);return l.makeTensorInfo(d,p,f)}}}function kh(t){return(e,r,n,o,s,i)=>{let a=T.assertAndGetBroadcastShape(e,r),l=w.sizeFromShape(a),u=a.length,c=w.computeStrides(a),p=w.getTypedArrayFromDType("float32",l),f=w.getTypedArrayFromDType("float32",l),d=T.getBroadcastDims(e,a),m=T.getBroadcastDims(r,a),h=T.mergeRealAndImagArrays(n,o),g=T.mergeRealAndImagArrays(s,i),x=e.length,y=w.computeStrides(e),b=r.length,v=w.computeStrides(r);if(d.length+m.length===0)for(let C=0;C<p.length;C++){let S=C%h.length,k=C%g.length,N=t(h[S*2],h[S*2+1],g[k*2],g[k*2+1]);p[C]=N.real,f[C]=N.imag}else for(let C=0;C<p.length;C++){let S=w.indexToLoc(C,u,c),k=S.slice(-x);d.forEach(V=>k[V]=0);let N=w.locToIndex(k,x,y),D=S.slice(-b);m.forEach(V=>D[V]=0);let $=w.locToIndex(D,b,v),O=t(h[N*2],h[N*2+1],g[$*2],g[$*2+1]);p[C]=O.real,f[C]=O.imag}return[p,f,a]}}var YE=tt((t,e)=>t+e),bie=kh((t,e,r,n)=>({real:t+r,imag:e+n})),Yi=it(ti,YE,bie),wB={kernelName:ti,backendName:"cpu",kernelFunc:Yi};function Th(t,e,r,n,o){let s=w.sizeFromShape(n),i=w.makeZerosTypedArray(o,r);for(let a=0;a<t.length;a++){let l=t[a];if(l<0)throw new Error("Input x must be non-negative!");l>=o||(s>0?i[l]+=e[a]:i[l]+=1)}return i}function Xw(t,e,r,n=!1){let o=t.shape[0],s=t.shape[1],i=Ee([o,r],e.dtype);for(let a=0;a<o;a++)for(let l=0;l<s;l++){let u=t.get(a,l);if(u<0)throw new Error("Input x must be non-negative!");u>=r||(n?i.set(1,a,u):e.size>0?i.set(i.get(a,u)+e.get(a,l),a,u):i.set(i.get(a,u)+1,a,u))}return i}function Zn(t){return(e,r,n)=>{let o=w.getTypedArrayFromDType(r,e.length);for(let s=0;s<e.length;++s)o[s]=t(e[s],n);return o}}function Le(t,e,r){return({inputs:n,attrs:o,backend:s})=>{let{x:i}=n;if(ee(i,t),i.dtype==="string"||r==="string")throw new Error("unaryKernelFunc does not support string input/output");let a=s,l=a.data.get(i.dataId).values,u=w.sizeFromShape(i.shape),c=r||i.dtype,p=w.getArrayFromDType(c,u);for(let f=0;f<u;++f)p[f]=e(l[f],o);return a.makeTensorInfo(i.shape,c,p)}}function $s(t,e,r){return({inputs:n,attrs:o,backend:s})=>{let{x:i}=n;if(ee(i,t),i.dtype==="string"||r==="string")throw new Error("unaryKernelFunc does not support string input/output");let a=s,l=a.data.get(i.dataId).values,u=r||i.dtype,c=e(l,u,o);return a.makeTensorInfo(i.shape,u,c)}}var QE=Zn(t=>Math.ceil(t)),vie=$s(Ia,QE),CB={kernelName:Ia,backendName:"cpu",kernelFunc:vie};function Yw(t,e,r,n){let o=w.getArrayFromDType(r,w.sizeFromShape(e));if(n&&r!=="string"){let s=0;t.forEach(i=>{let a=w.sizeFromShape(i.shape);o.set(i.vals,s),s+=a})}else{let s=0;t.forEach(i=>{let a=r==="string"?T.fromUint8ToStringArray(i.vals):i.vals,l=0;for(let u=0;u<i.shape[0];++u){let c=u*e[1]+s;for(let p=0;p<i.shape[1];++p)o[c+p]=a[l++]}s+=i.shape[1]})}return o}var ZE=tt((t,e)=>t===e?1:0),JE=it(Ep,ZE,null,"bool"),SB={kernelName:Ep,backendName:"cpu",kernelFunc:JE};var e_=Zn(t=>Math.exp(t)),t_=$s(Oa,e_,"float32"),kB={kernelName:Oa,backendName:"cpu",kernelFunc:t_};var r_=Zn(t=>Math.expm1(t)),wie=$s(Fa,r_),TB={kernelName:Fa,backendName:"cpu",kernelFunc:wie};var n_=Zn(t=>Math.floor(t)),Cie=$s(Pa,n_),NB={kernelName:Pa,backendName:"cpu",kernelFunc:Cie};function Qw(t,e,r,n,o,s,i,a,l){let u=Ee([n,s],r);for(let c=0;c<n;c++){let p=[],f=0;for(let d=0;d<o;d++){let m=t[c*o+d];f+=m*i[d],p.push(m)}if(f<0||f>=l/s)throw new Error(`Invalid indices: ${p} does not index into ${a}`);for(let d=0;d<s;d++)u.values[c*s+d]=e.get(...e.indexToLoc(f*s+d))}return u}function Zw(t,e,r){let n=Ee(r,t.dtype);for(let o=0;o<n.size;++o){let i=n.indexToLoc(o).slice(),a=i[0],l=i[2],u=e.locToIndex([a,l]);i[2]=e.values[u];let c=t.locToIndex(i);0<=c&&c<t.values.length&&(n.values[o]=t.values[c])}return n}var o_=tt((t,e)=>t>e?1:0),Sie=it(_p,o_,null,"bool"),IB={kernelName:_p,backendName:"cpu",kernelFunc:Sie};var s_=tt((t,e)=>t>=e?1:0),kie=it(Ma,s_,null,"bool"),EB={kernelName:Ma,backendName:"cpu",kernelFunc:kie};var i_=tt((t,e)=>t<e?1:0),Tie=it(Ap,i_,null,"bool"),_B={kernelName:Ap,backendName:"cpu",kernelFunc:Tie};var a_=tt((t,e)=>t<=e?1:0),Nie=it(Dp,a_,null,"bool"),AB={kernelName:Dp,backendName:"cpu",kernelFunc:Nie};function Jw(t,e,r){let n=(e-t)/(r-1),o=w.makeZerosTypedArray(r,"float32");o[0]=t;for(let s=1;s<o.length;s++)o[s]=o[s-1]+n;return o}var l_=Zn(t=>Math.log(t)),Iie=$s(Wa,l_),DB={kernelName:Wa,backendName:"cpu",kernelFunc:Iie};function eC(t,e,r,n){let o=w.getTypedArrayFromDType(n,w.sizeFromShape(r));for(let s=0;s<o.length;++s){let i=s*e,a=t[i];for(let l=0;l<e;++l){let u=t[i+l];(Number.isNaN(u)||u>a)&&(a=u)}o[s]=a}return o}var u_=tt((t,e)=>Math.max(t,e)),Eie=it(Ua,u_),$B={kernelName:Ua,backendName:"cpu",kernelFunc:Eie};var c_=tt((t,e)=>Math.min(t,e)),_ie=it(Ha,c_),RB={kernelName:Ha,backendName:"cpu",kernelFunc:_ie};var N0=tt((t,e)=>t*e),Aie=kh((t,e,r,n)=>({real:t*r-e*n,imag:t*n+e*r})),Tf=it(ja,N0,Aie),OB={kernelName:ja,backendName:"cpu",kernelFunc:Tf};function p_(t,e,r){let n=w.createScalarValue(-1,r);return N0([],e,n,t,r)}function Die(t){let{inputs:e,backend:r}=t,{x:n}=e;ee(n,"neg");let o=r.data.get(n.dataId).values,[s,i]=p_(o,n.shape,n.dtype);return r.makeTensorInfo(i,n.dtype,s)}var FB={kernelName:Hu,backendName:"cpu",kernelFunc:Die};var f_=tt((t,e)=>t!==e?1:0),$ie=it(Fp,f_,null,"bool"),PB={kernelName:Fp,backendName:"cpu",kernelFunc:$ie};function Nh(t,e,r,n,o){let s=e.length,i=w.sizeFromShape(e),a=w.computeStrides(e),l=w.computeStrides(o),u=w.getTypedArrayFromDType(r,w.sizeFromShape(o));for(let c=0;c<i;++c){let p=w.indexToLoc(c,s,a),f=new Array(p.length);for(let m=0;m<f.length;m++)f[m]=p[n[m]];let d=w.locToIndex(f,s,l);u[d]=t[c]}return u}function Yt(t){let{inputs:e,attrs:r,backend:n}=t,{x:o}=e,{perm:s}=r;ee(o,"transpose");let i=o.shape.length,a=new Array(i);for(let p=0;p<a.length;p++)a[p]=o.shape[s[p]];let l=n.data.get(o.dataId).values,u=Nh(l,o.shape,o.dtype,s,a);return{dataId:n.write(u,a,o.dtype),shape:a,dtype:o.dtype}}var LB={kernelName:Pi,backendName:"cpu",kernelFunc:Yt};function d_(t,e,r,n){let[o,s]=T.computeOutAndReduceShapes(t,n),i=wr(e,"int32"),a=w.makeZerosTypedArray(w.sizeFromShape(o),i),l=w.sizeFromShape(s);for(let u=0;u<a.length;++u){let c=u*l,p=1;for(let f=0;f<l;++f)p*=r[c+f];a[u]=p}return{outVals:a,outShape:o,outDtype:i}}function Rie(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{axis:s,keepDims:i}=n;ee(o,"prod");let a=o.shape.length,l=w.parseAxisParam(s,o.shape),u=T.getAxesPermutation(l,a),c=l,p=o,f=[];u!=null&&(p=Yt({inputs:{x:o},backend:r,attrs:{perm:u}}),f.push(p),c=T.getInnerMostAxes(c.length,a));let d=r.data.get(p.dataId).values,{outVals:m,outShape:h,outDtype:g}=d_(p.shape,p.dtype,d,c),x=h;return i&&(x=T.expandShapeToKeepDim(h,l)),f.forEach(y=>r.disposeIntermediateTensorInfo(y)),r.makeTensorInfo(x,g,m)}var MB={kernelName:Qu,backendName:"cpu",kernelFunc:Rie};function Oie(t,e,r){t.forEach((n,o)=>{if(n<0||n>=r){let s=w.indexToLoc(o,e.length,w.computeStrides(e)).join(",");throw new Error(`indices[${s}] = ${n} is not in [0, ${r})`)}})}function Fie(t,e){for(let r=0;r<t.length;++r){let n=t[r],o=r===t.length-1?e:t[r+1].length;if(n.length===0)throw new Error("Ragged splits may not be empty");if(n[0]<0)throw new Error("Ragged splits must be non-negative");if(n[n.length-1]>o)throw new Error("Ragged splits must not point past values");for(let s=1;s<n.length;++s)if(n[s-1]>n[s])throw new Error("Ragged splits must be sorted in ascending order")}}function Pie(t,e,r,n){let o=[],s=0,i=e.length-1+r.length,a=new Array(i).fill(null).map(()=>[0]);Fie(r,n);let l=1;for(let u=0;u<e.length-1;++u){l*=e[u];let c=e[u+1];for(let p=1;p<l+1;++p)a[u].push(p*c)}for(let u=0;u<t.length;++u){let c=t[u],p=t[u]+1;for(let f=0;f<r.length;++f){let d=r[f],m=f+e.length-1;if(m>=0){let h=a[m],g=h[h.length-1]-d[c];for(let x=c;x<p;++x)a[m].push(d[x+1]+g)}c=d[c],p=d[p]}p!==c&&(o.push([c,p]),s+=p-c)}return{outSplits:a,valueSlices:o,numValues:s}}function Lie(t){let e=[];for(let r=0;r<t.length;++r){let n=t[r].length,o=w.getArrayFromDType("int32",n);e.push(o),t[r].forEach((s,i)=>o[i]=s)}return e}function zB(t,e){let r=t.slice(0,e);for(;r.length<e;)r.push(1);for(let n=e;n<t.length;n++)r[e-1]*=t[n];return r}function Mie(t,e,r,n,o,s){let i=zB(e,2)[1],a=zB(s,2)[1],l=0;for(let u of r)for(let c=u[0];c<u[1];++c){for(let p=0;p<n;++p)o[l*a+p]=t[c*i+p];++l}}function zie(t,e,r,n,o){let s=e.slice();s[0]=o;let i=w.getArrayFromDType(r,w.sizeFromShape(s)),a=t.length,l=a===0?0:a/e[0];return Mie(t,e,n,l,i,s),[i,s]}function tC(t,e,r,n,o,s,i,a){if(t.length===0)throw new Error("paramsNestedSplits must be non empty");if(e[0].length===0)throw new Error("Split tensors must not be scalars");let l=e[0][0]-1;if(Oie(s,i,l),n.length===0)throw new Error("params.rank must be nonzero");let u=n[0],{outSplits:c,valueSlices:p,numValues:f}=Pie(s,i,t,u),d=Lie(c),m=zie(r,n,o,p,f);return[d,m[0],m[1]]}var BB=2147483647;function rC(t,e,r,n,o,s,i){if(e.length>1)throw new Error("starts must be a scalar or vector");if(o.length>1)throw new Error("limits must be a scalar or vector");if(i.length>1)throw new Error("deltas must be a scalar or vector");let a=e.length===0,l=o.length===0,u=i.length===0,c=[];a||c.push(e[0]),l||c.push(o[0]),u||c.push(i[0]);for(let g=1;g<c.length;++g)if(c[g]!==c[g-1])throw new Error("starts, limits, and deltas must have the same shape");let p=c.length===0?1:c[0],f=w.getArrayFromDType("int32",p+1);f[0]=0;for(let g=0;g<p;++g){let x=a?t[0]:t[g],y=l?n[0]:n[g],b=u?s[0]:s[g];if(b===0)throw new Error("Requires delta != 0");let v;if(b>0&&y<x||b<0&&y>x)v=0;else if(v=Math.ceil(Math.abs((y-x)/b)),v>BB)throw new Error(`Requires ((limit - start) / delta) <= ${BB}`);f[g+1]=f[g]+v}let d=f[p],m=w.getArrayFromDType(r,d),h=0;for(let g=0;g<p;++g){let x=f[g+1]-f[g],y=a?t[0]:t[g],b=u?s[0]:s[g];for(let v=0;v<x;++v)m[h++]=y,y+=b}return[f,m]}var Rs=T.RowPartitionType,Ih=class{constructor(e,r,n,o,s,i,a,l,u,c){this.shape=e,this.shapeShape=r,this.values=n,this.valuesShape=o,this.valuesDType=s,this.defaultValue=i,this.defaultValueShape=a,this.rowPartitionValues=l,this.rowPartitionValuesShapes=u,this.rowPartitionTypes=T.getRowPartitionTypesHelper(c),this.raggedRank=T.getRaggedRank(this.rowPartitionTypes)}getRowPartitionTypeByDimension(e){return this.rowPartitionTypes[0]===Rs.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}getRowPartitionTensor(e){return this.rowPartitionTypes[0]===Rs.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}getMaxWidth(e){let r=this.getRowPartitionTensor(e-1);switch(this.getRowPartitionTypeByDimension(e-1)){case Rs.VALUE_ROWIDS:return Ih.getMaxWidthValueRowID(r);case Rs.ROW_SPLITS:return Ih.getMaxWidthRowSplit(r);default:throw new Error(`Cannot handle partition type ${Rs[this.getRowPartitionTypeByDimension(e-1)]}`)}}static getMaxWidthRowSplit(e){let r=e.length;if(r===0||r===1)return 0;let n=0;for(let o=0;o<r-1;++o){let s=e[o+1]-e[o];s>n&&(n=s)}return n}static getMaxWidthValueRowID(e){let r=e.length;if(r===0)return 0;let n=0,o=e[0],s=0;for(let i=1;i<r;++i){let a=e[i];a!==o&&(o=a,s=Math.max(i-n,s),n=i)}return Math.max(r-n,s)}tensorShapeFromTensor(e,r,n=!0){if(r.length===0){if(e[0]===-1)return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return WB(e,n)}calculateOutputSize(e){let r=this.valuesShape,n=this.defaultValueShape;T.validateDefaultValueShape(n,r);let o=this.tensorShapeFromTensor(this.shape,this.shapeShape),i=T.combineRaggedTensorToTensorShapes(this.raggedRank,o,r);i[0]<0&&(i[0]=e);for(let a=1;a<=this.raggedRank;++a)i[a]<0&&(i[a]=this.getMaxWidth(a));return i}calculateFirstParentOutputIndex(e,r,n){let o=Math.min(e,n),s=[],i=0;for(let a=0;a<o;++a,i+=r)s.push(i);for(let a=o;a<e;++a)s.push(-1);return w.assert(s.length===e,()=>"Final length of result must be equal to firstDimension."),s}calculateOutputIndexRowSplit(e,r,n,o){let s=e.length,i=[];for(let a=0;a<s-1;++a){let l=e[a+1]-e[a],u=Math.min(o,l),c=r[a];c===-1&&(u=0);for(let p=0;p<u;++p)i.push(c),c+=n;for(let p=0;p<l-u;++p)i.push(-1)}if(s>0&&i.length!==e[s-1])throw new Error("Invalid row split size.");return i}calculateOutputIndexValueRowID(e,r,n,o){let s=e.length,i=[];if(s===0)return[];let a=0,l=e[0];if(l>=r.length)throw new Error(`Got currentValueRowId=${l}, which is not less than ${r.length}`);let u=r[l];i.push(u);for(let c=1;c<s;++c){let p=e[c];if(p===l)u>=0&&(++a,a<o?u+=n:u=-1);else{if(a=0,l=p,p>=r.length)throw new Error(`Got nextValueRowId=${p} which is not less than ${r.length}`);u=r[p]}i.push(u)}if(i.length!==e.length)throw new Error("Invalid row ids.");return i}calculateOutputIndex(e,r,n,o){let s=this.getRowPartitionTensor(e),i=this.getRowPartitionTypeByDimension(e);switch(i){case Rs.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(s,r,n,o);case Rs.ROW_SPLITS:if(s.length-1>r.length)throw new Error(`Row partition size is greater than output size: ${s.length-1} > ${r.length}`);return this.calculateOutputIndexRowSplit(s,r,n,o);default:throw new Error(`Unsupported partition type: ${Rs[i]}`)}}getFirstDimensionSize(){let e=this.rowPartitionValues[0];if(this.rowPartitionTypes.length===0)throw new Error("No row_partition_types given.");let r=this.rowPartitionTypes[0];switch(r){case Rs.FIRST_DIM_SIZE:return e[0];case Rs.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case Rs.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error(`Cannot handle type ${Rs[r]}`)}}compute(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");let r=this.getFirstDimensionSize(),n=this.calculateOutputSize(r),o=new Array(this.raggedRank+1);o[o.length-1]=1;for(let l=o.length-2;l>=0;--l)o[l]=o[l+1]*n[l+1];let s=WB(n,!1),i=w.getArrayFromDType(this.valuesDType,w.sizeFromShape(s));if(o[0]*n[0]>0){let l=this.calculateFirstParentOutputIndex(r,o[0],n[0]);for(let u=1;u<=this.raggedRank;++u)l=this.calculateOutputIndex(u-1,l,o[u],n[u]);this.setOutput(this.raggedRank,l,i,s)}return[s,i]}setOutput(e,r,n,o){if(n.length===0)return;let s=this.values,i=n,a=o.slice();a=a.slice(e+1);let l=w.sizeFromShape(a),u=r.length,c=this.defaultValue;if(c.length!==l&&c.length!==1){let m=this.defaultValueShape;U(()=>{let h=M(c,m);c=yl(h,a).dataSync()})}let p=0,f=0,d=0;for(let m=0;m<=u;++m){let h=m<u?r[m]:-1;if(h===d){++d;continue}if(f<d){let g=s.subarray(p*l),x=i.subarray(f*l),y=(d-f)*l;VB(x,g,y)}if(m>=u){let g=n.length;h=Math.floor(g/l)}if(h>d)if(this.defaultValue.length===1)i.subarray(d*l,h*l).fill(this.defaultValue[0]),d=h;else for(;h>d;){let g=i.slice(d*l);VB(g,c,l),++d}h<0?(p=m+1,f=d):(p=m,f=d,d=f+1)}}};function VB(t,e,r){for(let n=0;n<r;n++)t[n]=e[n]}function WB(t,e){let r=[];for(let n of t){if(n<0){if(!e)throw new Error(`Dimension ${n} must be >= 0`);if(n<-1)throw new Error(`Dimension ${n} must be >= -1`);n=-1}r.push(n)}return r}function nC(t,e,r,n,o,s,i,a,l,u){return new Ih(t,e,r,n,o,s,i,a,l,u).compute()}function oC(t,e,r,n){let o=t===e,s=t<e&&r<0,i=e<t&&r>1;if(o||s||i)return w.makeZerosTypedArray(0,n);let a=Math.abs(Math.ceil((e-t)/r)),l=w.makeZerosTypedArray(a,n);e<t&&r===1&&(r=-1),l[0]=t;for(let u=1;u<l.length;u++)l[u]=l[u-1]+r;return l}var m_=Zn(t=>1/Math.sqrt(t)),Bie=$s(Ja,m_),GB={kernelName:Ja,backendName:"cpu",kernelFunc:Bie};function Rl(t,e,r,n,o,s,i,a,l,u){let c=[n/o,o],p=t.values,f=e.values;if(n===0)return Ee(r,e.dtype);let d=Ee(c,e.dtype);typeof l=="string"||typeof l=="number"?d.values.fill(l):typeof l=="boolean"&&d.values.fill(+l);for(let m=0;m<s;m++){let h=[],g=0;for(let x=0;x<i;x++){let y=p[m*i+x];h.push(y),g+=y*a[x]}if(g<0||g>=n/o)throw new Error(`Invalid indices: ${h} does not index into ${r}`);for(let x=0;x<o;x++)u?d.values[g*o+x]+=f[m*o+x]:d.values[g*o+x]=e.rank===0?f[0]:f[m*o+x]}return d}var UB=Zn(t=>1/(1+Math.exp(-t))),h_=Le(ol,t=>1/(1+Math.exp(-t))),HB={kernelName:ol,backendName:"cpu",kernelFunc:h_};function g_(t,e,r,n,o){let s=Ur.isSliceContinous(n,e,r),i=w.sizeFromShape(r),a=w.computeStrides(n);if(s){let p=Ur.computeFlatOffset(e,a);return o==="string"?t.slice(p,p+i):t.subarray(p,p+i)}let l=o==="string"?T.fromUint8ToStringArray(t):t,u=Ee(n,o,l),c=Ee(r,o);for(let p=0;p<c.size;++p){let f=c.indexToLoc(p),d=f.map((m,h)=>m+e[h]);c.set(u.get(...d),...f)}return o==="string"?T.fromStringArrayToUint8(c.values):c.values}function Os(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{begin:s,size:i}=n;ee(o,"slice");let[a,l]=Ur.parseSliceParams(o,s,i);Ur.assertParamsValid(o,a,l);let u=r.data.get(o.dataId).values,c=g_(u,a,l,o.shape,o.dtype);return r.makeTensorInfo(l,o.dtype,c)}var qB={kernelName:nc,backendName:"cpu",kernelFunc:Os};function sC(t,e,r,n,o,s,i){let a=e[0],l=s[0],u=new Array(l),c=new Array(a),p=e[1];if(l===0){if(a!==0)throw new Error(T.getSparseFillEmptyRowsIndicesDenseShapeMismatch(a));let g=w.getArrayFromDType(r,0),x=w.getArrayFromDType(o,0);return[g,[0,p],x,u,c]}let f=!0,d=0,m=new Array(l).fill(0);for(let g=0;g<a;++g){let x=t[g*p];if(x<0)throw new Error(T.getSparseFillEmptyRowsNegativeIndexErrorMessage(g,x));if(x>=l)throw new Error(T.getSparseFillEmptyRowsOutOfRangeIndexErrorMessage(g,x,l));++m[x],f=f&&x>=d,d=x}let h=!0;for(let g=0;g<l;++g){let x=m[g]===0;u[g]=x,h=h&&!x,m[g]=Math.max(m[g],1),g>0&&(m[g]+=m[g-1])}if(h&&f){let g=t,x=n;for(let y=0;y<a;++y)c[y]=y;return[g,[a,p],x,u,c]}else{let g=m[l-1],x=w.getArrayFromDType(r,g*p),y=w.getArrayFromDType(o,g),b=new Array(l).fill(0);for(let v=0;v<a;++v){let C=t[v*p],S=b[C],k=(C===0?0:m[C-1])+S;b[C]++;for(let N=0;N<p;++N)x[k*p+N]=t[v*p+N];y[k]=n[v],c[v]=k}for(let v=0;v<l;++v)if(b[v]===0){let S=v===0?0:m[v-1];x[S*p+0]=v;for(let k=1;k<p;++k)x[S*p+k]=0;y[S]=i}return[x,[g,p],y,u,c]}}function iC(t,e,r,n,o){let s=w.sizeFromShape(n),i=e[0],a=o.length,l=[],u=1,c=-1;for(let g=0;g<a;++g){let x=o[g];if(x===-1){if(c!==-1)throw new Error(T.getSparseReshapeMultipleNegativeOneOutputDimErrorMessage(c,g));c=g,l.push(1)}else{if(x<0)throw new Error(T.getSparseReshapeNegativeOutputDimErrorMessage(g,x));u*=x,l.push(x)}}if(c!==-1){if(u<=0)throw new Error(T.getSparseReshapeEmptyTensorZeroOutputDimErrorMessage());let g=Math.trunc(s/u);if(u*g!==s)throw new Error(T.getSparseReshapeInputOutputMultipleErrorMessage(n,l));l[c]=g}if(w.sizeFromShape(l)!==s)throw new Error(T.getSparseReshapeInputOutputMismatchErrorMessage(n,l));let f=n.length,d=[];if(f>0){d[f-1]=1;for(let g=f-2;g>=0;--g)d[g]=d[g+1]*n[g+1]}let m=[];if(a>0){m[a-1]=1;for(let g=a-2;g>=0;--g)m[g]=m[g+1]*l[g+1]}let h=w.getArrayFromDType(r,i*a);for(let g=0;g<i;++g){let x=0;for(let y=0;y<f;++y)x+=t[g*f+y]*d[y];for(let y=0;y<a;++y)h[g*a+y]=Math.trunc(x/m[y]),x%=m[y]}return[h,[i,a],l]}function Eh(t,e,r,n,o,s=!1,i=0){let a=n.length,l=[e[0],t.length/e[0]],u=l[1],p=a>0?o[a-1]+1:0;if(p<0)throw new Error(T.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());let f=e.slice();f[0]=p;let d=f.reduce((b,v)=>b*v,1),m=w.getArrayFromDType(r,d);if(a===0)return p>0&&m.fill(i),[m,f];if(p<=0)throw new Error(T.getSparseSegmentReductionNegativeSegmentIdsErrorMessage());let h=0,g=1,x=0,y=o[h];for(;;){let b=0;if(g<a){if(b=o[g],y===b){++g;continue}if(y>=b)throw new Error(T.getSparseSegmentReductionNonIncreasingSegmentIdsErrorMessage())}if(y<0||y>=p)throw new Error(T.getSparseSegmentReductionSegmentIdOutOfRangeErrorMessage(y,p));y>x&&m.fill(i,x*u,y*u);for(let v=h;v<g;++v){let C=n[v];if(C<0||C>=l[0])throw new Error(T.getSparseSegmentReductionIndicesOutOfRangeErrorMessage(v,n[v],l[0]));for(let S=0;S<u;S++)m[y*u+S]+=t[C*u+S]}if(s)for(let v=0;v<u;v++)m[y*u+v]/=g-h;if(h=g,++g,x=y+1,y=b,g>a)break}return x<p&&m.fill(i,x*u,p*u),[m,f]}var jB=Zn(t=>Math.sqrt(t)),Vie=Le(il,t=>Math.sqrt(t)),KB={kernelName:il,backendName:"cpu",kernelFunc:Vie};var x_=tt((t,e)=>{let r=t-e;return r*r}),Wie=it(al,x_),XB={kernelName:al,backendName:"cpu",kernelFunc:Wie};function aC(t,e,r,n){let o=Ee(t,e.dtype);for(let s=0;s<o.size;s++){let i=o.indexToLoc(s),a=new Array(i.length);for(let l=0;l<a.length;l++)a[l]=i[l]*r[l]+n[l];o.set(e.get(...a),...i)}return o}var y_=class{constructor(e,r,n,o,s,i){this.separator=w.encodeString(e),this.nGramWidths=r,this.leftPad=w.encodeString(n),this.rightPad=w.encodeString(o),this.padWidth=s,this.preserveShort=i}getPadWidth(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}getNumNGrams(e,r){let n=this.getPadWidth(r);return Math.max(0,e+2*n-r+1)}createNGrams(e,r,n,o,s,i){for(let a=0;a<s;++a){let l=this.getPadWidth(i),u=Math.max(0,l-a),c=Math.max(0,l-(s-(a+1))),p=i-(u+c),f=r+(u>0?0:a-l),d=0;d+=u*this.leftPad.length;for(let y=0;y<p;++y)d+=e[f+y].length;d+=c*this.rightPad.length;let m=u+c+p-1;d+=m*this.separator.length,n[o+a]=new Uint8Array(d);let h=n[o+a],g=0,x=y=>y.forEach(b=>h[g++]=b);for(let y=0;y<u;++y)x(this.leftPad),x(this.separator);for(let y=0;y<p-1;++y)x(e[f+y]),x(this.separator);if(p>0){x(e[f+p-1]);for(let y=0;y<c;++y)x(this.separator),x(this.rightPad)}else{for(let y=0;y<c-1;++y)x(this.rightPad),x(this.separator);x(this.rightPad)}}}compute(e,r){let n=e.length,o=r.length;if(o>0){let l=r[0];if(l!==0)throw new Error(`First split value must be 0, got ${l}`);for(let u=1;u<o;++u){let c=r[u]>=l;if(c=c&&r[u]<=n,!c)throw new Error(`Invalid split value ${r[u]}, must be in [${l}, ${n}]`);l=r[u]}if(l!==n)throw new Error(`Last split value must be data size. Expected ${n}, got ${l}`)}let s=o-1,i=w.getArrayFromDType("int32",o);if(n===0||o===0){let l=new Array(n);for(let u=0;u<=s;++u)i[u]=0;return[l,i]}i[0]=0;for(let l=1;l<=s;++l){let u=r[l]-r[l-1],c=0;this.nGramWidths.forEach(p=>{c+=this.getNumNGrams(u,p)}),this.preserveShort&&u>0&&c===0&&(c=1),i[l]=i[l-1]+c}let a=new Array(i[s]);for(let l=0;l<s;++l){let u=r[l],c=i[l];if(this.nGramWidths.forEach(p=>{let f=r[l+1]-r[l],d=this.getNumNGrams(f,p);this.createNGrams(e,u,a,c,d,p),c+=d}),this.preserveShort&&c===i[l]){let p=r[l+1]-r[l];if(p===0)continue;let f=p+2*this.padWidth,d=1;this.createNGrams(e,u,a,c,d,f)}}return[a,i]}};function lC(t,e,r,n,o,s,i,a){return new y_(r,n,o,s,i,a).compute(t,e)}function Gie(t,e,r,n){if(!t.length)return;if(e.length===0){for(let s=0;s<t.length;++s)n.push(t.subarray(s,s+1));return}if(e.length===1){let s=e[0],i=t.indexOf(s);for(;i!==-1;){let a=t.subarray(0,i);(!r||a.length!==0)&&n.push(a),t=t.subarray(i+1),i=t.indexOf(s)}(!r||t.length!==0)&&n.push(t);return}let o=0;for(let s=0;s<t.length+1;s++)if(s===t.length||e.indexOf(t[s])!==-1){let i=t.subarray(o,s);(!r||i.length!==0)&&n.push(i),o=s+1}}function uC(t,e,r){let n=t.length,o=[],s=0,i=0,a=new Array(n);for(let f=0;f<n;++f){let d=o.length;Gie(t[f],e,r,o);let m=o.length-d;a[f]=m,s+=m,i=Math.max(i,m)}let l=w.getArrayFromDType("int32",s*2),u=new Array(s),c=[n,i],p=0;for(let f=0;f<n;++f)for(let d=0;d<a[f];++d)l[p*2]=f,l[p*2+1]=d,u[p]=o[p],++p;return[l,u,c]}function cC(t,e){let r=w.getArrayFromDType("int32",t.length);for(let n=0;n<t.length;++n)r[n]=w.fingerPrint64(t[n]).modulo(e).getLowBitsUnsigned();return r}var b_=tt((t,e)=>t-e),Uie=kh((t,e,r,n)=>({real:t-r,imag:e-n})),I0=it(ll,b_,Uie),YB={kernelName:ll,backendName:"cpu",kernelFunc:I0};function pC(t,e){let r=new Array(t.rank);for(let o=0;o<r.length;o++)r[o]=t.shape[o]*e[o];let n=Ee(r,t.dtype);for(let o=0;o<n.values.length;++o){let s=n.indexToLoc(o),i=new Array(t.rank);for(let l=0;l<i.length;l++)i[l]=s[l]%t.shape[l];let a=t.locToIndex(i);n.values[o]=t.values[a]}return n}var E0=(t,e)=>{let r=e.value-t.value;return r===0?t.index-e.index:r};function QB(t,e,r=0,n=t.length-1){for(;n>r;){if(n-r>600){let a=n-r+1,l=e-r+1,u=Math.log(a),c=.5*Math.exp(2*u/3),p=.5*Math.sqrt(u*c*(a-c)/a)*Math.sign(l-a/2),f=Math.max(r,Math.floor(e-l*c/a+p)),d=Math.min(n,Math.floor(e+(a-l)*c/a+p));QB(t,e,f,d)}let o=t[e],s=r,i=n;for(w.swap(t,r,e),E0(t[n],o)>0&&w.swap(t,r,n);s<i;){for(w.swap(t,s,i),s++,i--;E0(t[s],o)<0;)s=s+1;for(;E0(t[i],o)>0;)i=i-1}E0(t[r],o)===0?w.swap(t,r,i):(i=i+1,w.swap(t,i,n)),i<=e&&(r=i+1),e<=i&&(n=i-1)}}function fC(t,e,r,n,o){let s=e[e.length-1],[i,a]=[t.length/s,s],l=w.getTypedArrayFromDType(r,i*n),u=w.getTypedArrayFromDType("int32",i*n);for(let p=0;p<i;p++){let f=p*a,d=t.subarray(f,f+a),m=new Array(d.length);d.forEach((y,b)=>m[b]={value:y,index:b}),n<m.length&&(QB(m,n),m=m.slice(0,n)),o&&m.sort(E0);let h=p*n,g=l.subarray(h,h+n),x=u.subarray(h,h+n);for(let y=0;y<n;y++)g[y]=m[y].value,x[y]=m[y].index}let c=e.slice();return c[c.length-1]=n,[Ee(c,r,l),Ee(c,"int32",u)]}function dC(t,e,r,n){let o=w.parseAxisParam(e,r)[0],s=[1,r[0],1];for(let m=0;m<o;m++)s[0]*=r[m];s[1]=r[o];for(let m=o+1;m<r.length;m++)s[2]*=r[m];let i={},a=new Int32Array(r[o]),l=new vt(s,n,t),u=[],c=s[0]===1&&s[2]===1;for(let m=0;m<r[o];m++){let h;if(c)h=t[m].toString();else{let g=[];for(let x=0;x<s[0];x++)for(let y=0;y<s[2];y++)g.push(l.get(x,m,y));h=g.join(",")}if(i[h]!==void 0)a[m]=i[h];else{let g=Object.keys(i).length;i[h]=g,a[m]=g,u.push(m)}}let p=s.slice();p[1]=Object.keys(i).length;let f=new vt(p,n);u.forEach((m,h)=>{for(let g=0;g<s[0];g++)for(let x=0;x<s[2];x++)f.set(l.get(g,m,x),g,h,x)});let d=r.slice();return d[o]=p[1],{outputValues:f.values,outputShape:d,indices:a}}b1("cpu",()=>new kf,1);var w_=Le($a,t=>t>=0?t:Math.exp(t)-1),ZB={kernelName:$a,backendName:"cpu",kernelFunc:w_};function C_(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{alpha:s}=n;ee([o],"leakyRelu");let i=w.sizeFromShape(o.shape),a=r.data.get(o.dataId).values,l=w.getTypedArrayFromDType("float32",i);for(let u=0;u<a.length;u++)l[u]=a[u]<0?s*a[u]:a[u];return r.makeTensorInfo(o.shape,"float32",l)}var JB={kernelName:Lu,backendName:"cpu",kernelFunc:C_};var Hie=tt((t,e)=>t<0?e*t:t);function S_(t){let{inputs:e,backend:r}=t,{x:n,alpha:o}=e;ee([n,o],"prelu");let s=r.data.get(n.dataId).values,i=r.data.get(o.dataId).values,[a,l]=Hie(n.shape,o.shape,s,i,"float32");return r.makeTensorInfo(l,"float32",a)}var e4={kernelName:Yu,backendName:"cpu",kernelFunc:S_};var k_=Le(Ya,t=>Math.max(0,t)),t4={kernelName:Ya,backendName:"cpu",kernelFunc:k_};var T_=Le(Qa,t=>Math.min(Math.max(0,t),6)),r4={kernelName:Qa,backendName:"cpu",kernelFunc:T_};function Nf(t,e,r,n,o){if(r==="linear")return Cn({inputs:{x:e},backend:t});if(r==="relu")return k_({inputs:{x:e},backend:t});if(r==="elu")return w_({inputs:{x:e},backend:t});if(r==="relu6")return T_({inputs:{x:e},backend:t});if(r==="prelu")return S_({inputs:{x:e,alpha:n},backend:t});if(r==="leakyrelu")return C_({inputs:{x:e},backend:t,attrs:{alpha:o}});if(r==="sigmoid")return h_({inputs:{x:e},backend:t});throw new Error(`Activation ${r} has not been implemented for the CPU backend.`)}function Je(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{shape:s}=n,i=w.sizeFromShape(o.shape),a=w.inferFromImplicitShape(s,i),l=w.sizeFromShape(a);w.assert(i===l,()=>`The new shape (${a}) has ${l} elements and the old shape (${o.shape}) has ${i} elements. The new shape and old shape must have the same number of elements.`),r.incRef(o.dataId);let u=r.data.get(o.dataId);if(u.complexTensorInfos!=null){let c=u.complexTensorInfos.real,p=u.complexTensorInfos.imag;c.shape=a,p.shape=a}return{dataId:o.dataId,shape:a,dtype:o.dtype}}var n4={kernelName:Zu,backendName:"cpu",kernelFunc:Je};function N_(t){let{inputs:e,backend:r,attrs:n}=t,{a:o,b:s}=e,{transposeA:i,transposeB:a}=n;ee([o,s],"matMul");let l=o.shape.length,u=s.shape.length,c=i?o.shape[l-2]:o.shape[l-1],p=a?s.shape[u-1]:s.shape[u-2],f=i?o.shape[l-1]:o.shape[l-2],d=a?s.shape[u-2]:s.shape[u-1],m=o.shape.slice(0,-2),h=s.shape.slice(0,-2),g=w.sizeFromShape(m),x=w.sizeFromShape(h),b=No.assertAndGetBroadcastShape(o.shape.slice(0,-2),s.shape.slice(0,-2)).concat([f,d]);w.assert(c===p,()=>`Error in matMul: inner shapes (${c}) and (${p}) of Tensors with shapes ${o.shape} and ${s.shape} and transposeA=${i} and transposeB=${a} must match.`);let v=i?[g,c,f]:[g,f,c],C=a?[x,d,p]:[x,p,d],S=Je({inputs:{x:o},backend:r,attrs:{shape:v}}),k=Je({inputs:{x:s},backend:r,attrs:{shape:C}}),N=i?S.shape[1]:S.shape[2],D=i?S.shape[2]:S.shape[1],$=a?k.shape[1]:k.shape[2],O=Math.max(g,x),V=r.data.get(S.dataId).values,K=r.data.get(k.dataId).values,X=w.computeStrides(S.shape),W=w.computeStrides(k.shape),[H,Y,Z]=i?[X[0],1,X[1]]:[X[0],X[1],1],[Q,se,ne]=a?[1,W[1],W[0]]:[W[1],1,W[0]],re=D*$,ue=Ee([O,D,$],S.dtype),ae=ue.values,le=r.blockSize;for(let me=0;me<O;me++)for(let ke=0;ke<D;ke+=le)for(let ve=0;ve<$;ve+=le)for(let Te=0;Te<N;Te+=le){let Ve=Math.min(ke+le,D),qe=Math.min(ve+le,$),R=Math.min(Te+le,N);for(let q=ke;q<Ve;q++)for(let P=ve;P<qe;P++){let ie=0;for(let pe=Te;pe<R;pe++){let fe=Math.min(me,g-1)*H,Se=Math.min(me,x-1)*ne,at=V[fe+q*Y+pe*Z],We=K[pe*Q+P*se+Se];ie+=at*We}ae[me*re+(q*$+P)]+=ie}}return r.disposeIntermediateTensorInfo(S),r.disposeIntermediateTensorInfo(k),r.makeTensorInfo(b,ue.dtype,ue.values)}var o4={kernelName:ku,backendName:"cpu",kernelFunc:N_};function qie(t){let{inputs:e,backend:r,attrs:n}=t,{a:o,b:s,bias:i,preluActivationWeights:a}=e,{transposeA:l,transposeB:u,activation:c,leakyreluAlpha:p}=n,f,d,m,h=[];f=N_({inputs:{a:o,b:s},attrs:{transposeA:l,transposeB:u},backend:r}),i&&(d=Yi({inputs:{a:f,b:i},backend:r}),h.push(f),f=d),c&&(m=Nf(r,f,c,a,p),h.push(f),f=m);for(let x of h)r.disposeIntermediateTensorInfo(x);return f}var s4={kernelName:Pp,backendName:"cpu",kernelFunc:qie};var jie=Le(va,t=>Math.acos(t)),i4={kernelName:va,backendName:"cpu",kernelFunc:jie};var Kie=Le(wa,t=>Math.acosh(t)),a4={kernelName:wa,backendName:"cpu",kernelFunc:Kie};function Xie(t){let{inputs:e,backend:r}=t,n=e;ee(e,"addN");let o=n.map(a=>r.data.get(a.dataId).values),s=Ee(n[0].shape,n[0].dtype),i=s.values;for(let a=0;a<n.length;a++){let l=o[a];for(let u=0;u<i.length;u++)i[u]+=l[u]}return r.makeTensorInfo(s.shape,s.dtype,s.values)}var l4={kernelName:Fd,backendName:"cpu",kernelFunc:Xie};function Yie(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{axis:s,keepDims:i}=n;ee(o,"all");let a=w.parseAxisParam(s,o.shape),l=a,u=T.getAxesPermutation(l,o.shape.length),c=o;u!=null&&(c=Yt({inputs:{x:o},backend:r,attrs:{perm:u}}),l=T.getInnerMostAxes(l.length,o.shape.length)),T.assertAxesAreInnerMostDims("all",l,c.shape.length);let[p,f]=T.computeOutAndReduceShapes(c.shape,l),d=w.sizeFromShape(f),m=w.makeZerosTypedArray(w.sizeFromShape(p),c.dtype),h=r.data.get(c.dataId).values;for(let x=0;x<m.length;++x){let y=x*d,b=h[y];for(let v=0;v<d;++v){let C=h[y+v];b=b&&C}m[x]=b}u!=null&&r.disposeIntermediateTensorInfo(c);let g=r.makeTensorInfo(p,c.dtype,m);if(i){let x=T.expandShapeToKeepDim(p,a),y=Je({inputs:{x:g},backend:r,attrs:{shape:x}});return r.disposeIntermediateTensorInfo(g),y}return g}var u4={kernelName:Pd,backendName:"cpu",kernelFunc:Yie};function Qie(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{axis:s,keepDims:i}=n;ee(o,"any");let a=w.parseAxisParam(s,o.shape),l=a,u=T.getAxesPermutation(l,o.shape.length),c=o;u!=null&&(c=Yt({inputs:{x:o},backend:r,attrs:{perm:u}}),l=T.getInnerMostAxes(l.length,o.shape.length)),T.assertAxesAreInnerMostDims("any",l,c.shape.length);let[p,f]=T.computeOutAndReduceShapes(c.shape,l),d=w.sizeFromShape(f),m=w.makeZerosTypedArray(w.sizeFromShape(p),c.dtype),h=r.data.get(c.dataId).values;for(let x=0;x<m.length;++x){let y=x*d,b=h[y];for(let v=0;v<d;++v){let C=h[y+v];b=b||C}m[x]=b}u!=null&&r.disposeIntermediateTensorInfo(c);let g=r.makeTensorInfo(p,c.dtype,m);if(i){let x=T.expandShapeToKeepDim(p,a),y=Je({inputs:{x:g},backend:r,attrs:{shape:x}});return r.disposeIntermediateTensorInfo(g),y}return g}var c4={kernelName:Ld,backendName:"cpu",kernelFunc:Qie};function Zie(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{axis:s}=n;ee(o,"argMax");let i=w.parseAxisParam(s,o.shape),a=T.getAxesPermutation(i,o.shape.length),l=o,u=[];a!=null&&(l=Yt({inputs:{x:o},backend:r,attrs:{perm:a}}),u.push(l),i=T.getInnerMostAxes(i.length,l.shape.length)),i=[i[0]],T.assertAxesAreInnerMostDims("argMax",i,l.shape.length);let[c,p]=T.computeOutAndReduceShapes(l.shape,i),f=w.sizeFromShape(c),d=w.makeZerosTypedArray(f,"int32"),m=w.sizeFromShape(p),h=r.data.get(l.dataId).values;for(let g=0;g<d.length;++g){let x=g*m,y=h[x],b=0;for(let v=0;v<m;++v){let C=h[x+v];C>y&&(y=C,b=v)}d[g]=b}return u.forEach(g=>r.disposeIntermediateTensorInfo(g)),r.makeTensorInfo(c,"int32",d)}var p4={kernelName:vu,backendName:"cpu",kernelFunc:Zie};function Jie(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{axis:s}=n;ee(o,"argMin");let i=w.parseAxisParam(s,o.shape),a=T.getAxesPermutation(i,o.shape.length),l=o,u=[];a!=null&&(l=Yt({inputs:{x:o},backend:r,attrs:{perm:a}}),u.push(l),i=T.getInnerMostAxes(i.length,l.shape.length)),i=[i[0]],T.assertAxesAreInnerMostDims("argMin",i,l.shape.length);let[c,p]=T.computeOutAndReduceShapes(l.shape,i),f=w.sizeFromShape(c),d=w.makeZerosTypedArray(f,"int32"),m=w.sizeFromShape(p),h=r.data.get(l.dataId).values;for(let g=0;g<d.length;++g){let x=g*m,y=h[x],b=0;for(let v=0;v<m;++v){let C=h[x+v];C<y&&(y=C,b=v)}d[g]=b}return u.forEach(g=>r.disposeIntermediateTensorInfo(g)),r.makeTensorInfo(c,"int32",d)}var f4={kernelName:wu,backendName:"cpu",kernelFunc:Jie};var eae=Le(Ca,t=>Math.asin(t)),d4={kernelName:Ca,backendName:"cpu",kernelFunc:eae};var tae=Le(Sa,t=>Math.asinh(t)),m4={kernelName:Sa,backendName:"cpu",kernelFunc:tae};var rae=Le(ka,t=>Math.atan(t)),h4={kernelName:ka,backendName:"cpu",kernelFunc:rae};var nae=tt((t,e)=>Math.atan2(t,e)),oae=it(Na,nae),g4={kernelName:Na,backendName:"cpu",kernelFunc:oae};var sae=Le(Ta,t=>Math.atanh(t)),x4={kernelName:Ta,backendName:"cpu",kernelFunc:sae};function _h(t,e,r,n,o,s){let i=o.strideHeight,a=o.strideWidth,l=o.dilationHeight,u=o.dilationWidth,c=o.effectiveFilterHeight,p=o.effectiveFilterWidth,f=o.padInfo.top,d=o.padInfo.left,m=s==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,h=Ee(o.outShape,r),g=h.values,x=o.outShape[1]*o.outShape[2]*o.outShape[3],y=o.outShape[2]*o.outShape[3],b=o.outShape[3];for(let v=0;v<o.batchSize;++v){let C=v*x,S=v*n[0];for(let k=0;k<o.inChannels;++k)for(let N=0;N<o.outHeight;++N){let D=N*i-f,$=Math.max(0,D),O=Math.min(o.inHeight,c+D),V=C+N*y;for(let K=0;K<o.outWidth;++K){let X=K*a-d,W=Math.max(0,X),H=Math.min(o.inWidth,p+X),Y=m,Z=0,Q=0;for(let ne=$;ne<O;ne+=l){let re=S+ne*n[1];for(let ue=W;ue<H;ue+=u){let ae=re+ue*n[2],le=t[ae+k];s==="max"&&le>Y?Y=le:s==="avg"&&(Z+=le,Q++)}if(isNaN(Y))break}let se=V+K*b+k;g[se]=s==="avg"?Z/Q:Y}}}return h}function mC(t,e,r,n,o=!1,s=!1){let i=Ee(n.outShape,"int32"),a=n.strideHeight,l=n.strideWidth,u=n.dilationHeight,c=n.dilationWidth,p=n.effectiveFilterHeight,f=n.effectiveFilterWidth,d=n.padInfo.top,m=n.padInfo.left,h=Ee(e,r,t);for(let g=0;g<n.batchSize;++g)for(let x=0;x<n.inChannels;++x)for(let y=0;y<n.outHeight;++y){let b=y*a-d,v=b;for(;v<0;)v+=u;let C=Math.min(n.inHeight,p+b);for(let S=0;S<n.outWidth;++S){let k=S*l-m,N=k;for(;N<0;)N+=c;let D=Math.min(n.inWidth,f+k),$=Number.NEGATIVE_INFINITY,O=-1;for(let V=v;V<C;V+=u){let K=V-b;for(let X=N;X<D;X+=c){let W=X-k,H=h.get(g,V,X,x);H>$&&($=H,o?O=s?((g*n.inHeight+V)*n.inWidth+X)*n.inChannels+x:(V*n.inWidth+X)*n.inChannels+x:O=K*f+W)}}i.set(O,g,y,S,x)}}return i}function hC(t,e,r,n,o,s){let i=o.strideDepth,a=o.strideHeight,l=o.strideWidth,u=o.dilationDepth,c=o.dilationHeight,p=o.dilationWidth,f=o.effectiveFilterDepth,d=o.effectiveFilterHeight,m=o.effectiveFilterWidth,h=o.padInfo.front,g=o.padInfo.top,x=o.padInfo.left,y=s==="max"?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,b=Ee(o.outShape,r),v=b.values,C=o.outShape[1]*o.outShape[2]*o.outShape[3]*o.outShape[4],S=o.outShape[2]*o.outShape[3]*o.outShape[4],k=o.outShape[3]*o.outShape[4],N=o.outShape[4];for(let D=0;D<o.batchSize;++D){let $=D*C,O=D*n[0];for(let V=0;V<o.inChannels;++V)for(let K=0;K<o.outDepth;++K){let X=K*i-h,W=X;for(;W<0;)W+=u;let H=Math.min(o.inDepth,f+X),Y=$+K*S;for(let Z=0;Z<o.outHeight;++Z){let Q=Z*a-g,se=Q;for(;se<0;)se+=c;let ne=Math.min(o.inHeight,d+Q),re=Y+Z*k;for(let ue=0;ue<o.outWidth;++ue){let ae=ue*l-x,le=ae;for(;le<0;)le+=p;let me=Math.min(o.inWidth,m+ae),ke=re+ue*N,ve=y,Te=0,Ve=0;for(let R=W;R<H;R+=u){let q=O+R*n[1];for(let P=se;P<ne;P+=c){let ie=q+P*n[2];for(let pe=le;pe<me;pe+=p){let fe=ie+pe*n[3],Se=t[fe+V];if(s==="max"&&Se>ve?ve=Se:s==="avg"&&(Te+=Se,Ve++),isNaN(ve))break}if(isNaN(ve))break}if(isNaN(ve))break}let qe=ke+V;v[qe]=s==="avg"?Te/Ve:ve}}}}return b}function y4(t,e){let r=Ee(e.outShape,"int32"),n=e.strideDepth,o=e.strideHeight,s=e.strideWidth,i=e.dilationDepth,a=e.dilationHeight,l=e.dilationWidth,u=e.effectiveFilterDepth,c=e.effectiveFilterHeight,p=e.effectiveFilterWidth,f=e.padInfo.front,d=e.padInfo.top,m=e.padInfo.left;for(let h=0;h<e.batchSize;++h)for(let g=0;g<e.inChannels;++g)for(let x=0;x<e.outDepth;++x){let y=x*n-f,b=y;for(;b<0;)b+=i;let v=Math.min(e.inDepth,u+y);for(let C=0;C<e.outHeight;++C){let S=C*o-d,k=S;for(;k<0;)k+=a;let N=Math.min(e.inHeight,c+S);for(let D=0;D<e.outWidth;++D){let $=D*s-m,O=$;for(;O<0;)O+=l;let V=Math.min(e.inWidth,p+$),K=Number.NEGATIVE_INFINITY,X=-1;for(let W=b;W<v;W+=i){let H=W-y;for(let Y=k;Y<N;Y+=a){let Z=Y-S;for(let Q=O;Q<V;Q+=l){let se=Q-$,ne=t.get(h,W,Y,Q,g);ne>=K&&(K=ne,X=H*c*p+Z*c+se)}}}r.set(X,h,x,C,D,g)}}}return r}function iae(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e;ee(o,"avgPool");let{filterSize:s,strides:i,pad:a,dimRoundingMode:l}=n,u=1;w.assert(T.eitherStridesOrDilationsAreOne(i,u),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);let c=T.computePool2DInfo(o.shape,s,i,u,a,l),p;if(c.filterWidth===1&&c.filterHeight===1&&w.arraysEqual(c.inShape,c.outShape))p=Cn({inputs:{x:o},backend:r});else{let f=r.data.get(o.dataId).values,d=w.computeStrides(o.shape),m=_h(f,o.shape,o.dtype,d,c,"avg");p=r.makeTensorInfo(c.outShape,o.dtype,m.values)}return p}var b4={kernelName:Cu,backendName:"cpu",kernelFunc:iae};function aae(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{filterSize:s,strides:i,pad:a,dimRoundingMode:l,dataFormat:u}=n;ee(o,"avgPool3d");let c=T.computePool3DInfo(o.shape,s,i,1,a,l,u),p=r.data.get(o.dataId).values,f=hC(p,o.shape,o.dtype,w.computeStrides(o.shape),c,"avg");return r.makeTensorInfo(f.shape,"float32",f.values)}var v4={kernelName:Su,backendName:"cpu",kernelFunc:aae};function lae(t){let{inputs:e,backend:r,attrs:n}=t,{dy:o,input:s}=e,{filterSize:i,strides:a,pad:l,dimRoundingMode:u}=n;ee([o,s],"avgPool3DGrad");let c=T.computePool3DInfo(s.shape,i,a,1,l,u),p=c.strideDepth,f=c.strideHeight,d=c.strideWidth,m=c.filterDepth,h=c.filterHeight,g=c.filterWidth,x=c.dilationDepth,y=c.dilationHeight,b=c.dilationWidth,v=c.effectiveFilterDepth,C=c.effectiveFilterHeight,S=c.effectiveFilterWidth,k=v-1-c.padInfo.front,N=S-1-c.padInfo.left,D=C-1-c.padInfo.top,$=Ee(s.shape,"float32"),O=1/(m*h*g),V=r.bufferSync(o);for(let K=0;K<c.batchSize;++K)for(let X=0;X<c.inChannels;++X)for(let W=0;W<c.inDepth;++W)for(let H=0;H<c.inHeight;++H)for(let Y=0;Y<c.inWidth;++Y){let Z=W-k,Q=H-D,se=Y-N,ne=0;for(let re=0;re<v;re+=x){let ue=(Z+re)/p;if(!(ue<0||ue>=c.outDepth||Math.floor(ue)!==ue))for(let ae=0;ae<C;ae+=y){let le=(Q+ae)/f;if(!(le<0||le>=c.outHeight||Math.floor(le)!==le))for(let me=0;me<S;me+=b){let ke=(se+me)/d;if(ke<0||ke>=c.outWidth||Math.floor(ke)!==ke)continue;let ve=V.get(K,ue,le,ke,X);ne+=ve}}}$.set(ne*O,K,W,H,Y,X)}return r.makeTensorInfo($.shape,$.dtype,$.values)}var w4={kernelName:zd,backendName:"cpu",kernelFunc:lae};function uae(t){let{inputs:e,backend:r,attrs:n}=t,{dy:o,input:s}=e,i=s;ee([o,s],"avgPoolGrad");let{filterSize:a,strides:l,pad:u}=n,c=T.computePool2DInfo(i.shape,a,l,1,u),p=c.strideHeight,f=c.strideWidth,d=c.filterHeight,m=c.filterWidth,h=c.dilationHeight,g=c.dilationWidth,x=c.effectiveFilterHeight,y=c.effectiveFilterWidth,b=y-1-c.padInfo.left,v=x-1-c.padInfo.top,C=Ee(i.shape,"float32"),S=1/(d*m),k=r.data.get(o.dataId).values,N=Ee(o.shape,"float32",k);for(let D=0;D<c.batchSize;++D)for(let $=0;$<c.inChannels;++$)for(let O=0;O<c.inHeight;++O)for(let V=0;V<c.inWidth;++V){let K=O-v,X=V-b,W=0;for(let H=0;H<x;H+=h){let Y=(K+H)/p;if(!(Y<0||Y>=c.outHeight||Math.floor(Y)!==Y))for(let Z=0;Z<y;Z+=g){let Q=(X+Z)/f;if(Q<0||Q>=c.outWidth||Math.floor(Q)!==Q)continue;let se=N.get(D,Y,Q,$);W+=se}}C.set(W*S,D,O,V,$)}return r.makeTensorInfo(C.shape,C.dtype,C.values)}var C4={kernelName:Md,backendName:"cpu",kernelFunc:uae};function cae(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,scale:s,offset:i,mean:a,variance:l}=e;w.assert(a.shape.length===l.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),w.assert(i==null||a.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),w.assert(s==null||a.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks."),ee([o,a,l,s,i],"batchNorm");let{varianceEpsilon:u}=n;u==null&&(u=.001);let c=r.data.get(o.dataId).values,p=r.data.get(a.dataId).values,f=r.data.get(l.dataId).values,d=s?r.data.get(s.dataId).values:new Float32Array([1]),m=i?r.data.get(i.dataId).values:new Float32Array([0]),h=new Float32Array(c.length),g=m.length,x=d.length,y=f.length,b=p.length,v=0,C=0,S=0,k=0;for(let N=0;N<c.length;++N)h[N]=m[v++]+(c[N]-p[C++])*d[S++]/Math.sqrt(f[k++]+u),v>=g&&(v=0),C>=b&&(C=0),S>=x&&(S=0),k>=y&&(k=0);return r.makeTensorInfo(o.shape,o.dtype,h)}var S4={kernelName:Fu,backendName:"cpu",kernelFunc:cae};function pae(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{blockShape:s,crops:i}=n;ee([o],"batchToSpaceND");let a=s.reduce((x,y)=>x*y),l=T.getReshaped(o.shape,s,a),u=T.getPermuted(l.length,s.length),c=T.getReshapedPermuted(o.shape,s,a),p=T.getSliceBeginCoords(i,s.length),f=T.getSliceSize(c,i,s.length),d=Je({inputs:{x:o},backend:r,attrs:{shape:l}}),m=Yt({inputs:{x:d},backend:r,attrs:{perm:u}}),h=Je({inputs:{x:m},backend:r,attrs:{shape:c}}),g=Os({inputs:{x:h},backend:r,attrs:{begin:p,size:f}});return r.disposeIntermediateTensorInfo(d),r.disposeIntermediateTensorInfo(m),r.disposeIntermediateTensorInfo(h),g}var k4={kernelName:Tu,backendName:"cpu",kernelFunc:pae};function fae(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,weights:s}=e,{size:i}=n,a=r.data.get(o.dataId).values,l=r.data.get(s.dataId).values,u=Th(a,l,s.dtype,s.shape,i);return r.makeTensorInfo([i],s.dtype,u)}var T4={kernelName:Bd,backendName:"cpu",kernelFunc:fae};function dae(t){let{inputs:e,backend:r}=t,{s0:n,s1:o}=e,s=r.data.get(n.dataId).values,i=r.data.get(o.dataId).values,a=T.assertAndGetBroadcastShape(Array.from(s),Array.from(i));return r.makeTensorInfo([a.length],"int32",Int32Array.from(a))}var N4={kernelName:Pv,backendName:"cpu",kernelFunc:dae};var mae=Le(Ea,(t,e)=>{let r=e;return t>r.clipValueMax?r.clipValueMax:t<r.clipValueMin?r.clipValueMin:t}),I4={kernelName:Ea,backendName:"cpu",kernelFunc:mae};var hae=t=>{let{x:e}=t.inputs,r=t.backend,n=new Float32Array(w.sizeFromShape(e.shape)),o=r.data.get(e.dataId),s=o.complexTensorInfos.real,i=o.complexTensorInfos.imag,a=r.data.get(s.dataId).values,l=r.data.get(i.dataId).values;for(let u=0;u<a.length;u++){let c=a[u],p=l[u];n[u]=Math.hypot(c,p)}return r.makeOutput(n,e.shape,"float32")},E4={kernelName:Nu,backendName:"cpu",kernelFunc:hae};function Qi(t){let{inputs:e,backend:r}=t,{input:n}=e,o=r.data.get(n.dataId).complexTensorInfos.imag,s=r.data.get(o.dataId).values;return r.makeTensorInfo(o.shape,o.dtype,s)}var _4={kernelName:nm,backendName:"cpu",kernelFunc:Qi};function _c(t){let{inputs:e,backend:r,attrs:n}=t,{axis:o}=n,s=w.parseAxisParam(o,e[0].shape)[0],i=e.map(h=>h.shape);T.assertParamsConsistent(i,s);let a=T.computeOutShape(e.map(h=>h.shape),s);if(w.sizeFromShape(a)===0)return r.makeTensorInfo(a,e[0].dtype,[]);let l=e.filter(h=>w.sizeFromShape(h.shape)>0);if(l.length===1)return Cn({inputs:{x:l[0]},backend:r});if(l[0].dtype==="complex64"){let h=l.map(v=>As({inputs:{input:v},backend:r})),g=l.map(v=>Qi({inputs:{input:v},backend:r})),x=_c({inputs:h,backend:r,attrs:{axis:s}}),y=_c({inputs:g,backend:r,attrs:{axis:s}}),b=Mr({inputs:{real:x,imag:y},backend:r});return h.forEach(v=>r.disposeIntermediateTensorInfo(v)),g.forEach(v=>r.disposeIntermediateTensorInfo(v)),r.disposeIntermediateTensorInfo(x),r.disposeIntermediateTensorInfo(y),b}let u=l.map(h=>{let x=[-1,w.sizeFromShape(h.shape.slice(s))];return Je({inputs:{x:h},backend:r,attrs:{shape:x}})}),c=u.map(h=>({vals:r.data.get(h.dataId).values,shape:h.shape}));a=T.computeOutShape(u.map(h=>h.shape),1);let p=u[0].shape[0]===1,f=Yw(c,a,e[0].dtype,p),d=T.computeOutShape(l.map(h=>h.shape),s),m=r.makeTensorInfo(d,e[0].dtype,f);return u.forEach(h=>r.disposeIntermediateTensorInfo(h)),m}var A4={kernelName:Iu,backendName:"cpu",kernelFunc:_c};function I_(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,filter:s}=e,{strides:i,pad:a,dataFormat:l,dilations:u,dimRoundingMode:c}=n;ee([o,s],"conv2d");let p=T.convertConv2DDataFormat(l),f=T.computeConv2DInfo(o.shape,s.shape,i,u,a,c,!1,p),d=f.filterHeight,m=f.filterWidth,h=f.dilationHeight,g=f.dilationWidth,x=f.padInfo.left,y=f.padInfo.top,b=f.dataFormat==="channelsLast",v=new vt(f.outShape,o.dtype),C=w.computeStrides(o.shape),S=w.computeStrides(s.shape),k=C[0],N=b?C[1]:C[2],D=b?C[2]:1,$=b?1:C[1],O=v.strides[0],V=b?v.strides[1]:v.strides[2],K=b?v.strides[2]:1,X=b?1:v.strides[1],W=r.data.get(o.dataId).values,H=r.data.get(s.dataId).values,Y=v.values;for(let Z=0;Z<f.batchSize;++Z){let Q=Z*k,se=Z*O;for(let ne=0;ne<f.outHeight;++ne){let re=se+ne*V,ue=ne*f.strideHeight-y;for(let ae=0;ae<d;++ae){let le=ue+ae*h;if(le<0||le>=f.inHeight)continue;let me=ae*S[0],ke=Q+le*N;for(let ve=0;ve<f.outWidth;++ve){let Te=re+ve*K,Ve=ve*f.strideWidth-x;for(let qe=0;qe<m;++qe){let R=Ve+qe*g;if(R<0||R>=f.inWidth)continue;let q=me+qe*S[1],P=ke+R*D,ie=q;for(let pe=0;pe<f.inChannels;++pe){let fe=W[P+pe*$];for(let Se=0;Se<f.outChannels;++Se)Y[Te+Se*X]+=fe*H[ie+Se];ie+=f.outChannels}}}}}}return r.makeTensorInfo(v.shape,v.dtype,Y)}var D4={kernelName:Eu,backendName:"cpu",kernelFunc:I_};function gae(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,dy:s}=e,{strides:i,pad:a,dataFormat:l,dimRoundingMode:u,filterShape:c}=n;ee([o,s],"conv2dBackpropFilter");let p=T.convertConv2DDataFormat(l),f=T.computeConv2DInfo(o.shape,c,i,1,a,u,!1,p),{strideHeight:d,strideWidth:m,filterHeight:h,filterWidth:g}=f,x=f.dataFormat==="channelsLast",y=new vt(f.filterShape,"float32"),b=f.padInfo.left,v=f.padInfo.top,C=r.data.get(o.dataId).values,S=r.data.get(s.dataId).values,k=new vt(o.shape,o.dtype,C),N=new vt(s.shape,s.dtype,S);for(let D=0;D<h;++D){let $=Math.max(0,Math.ceil((v-D)/d)),O=Math.min(f.outHeight,(f.inHeight+v-D)/d);for(let V=0;V<g;++V){let K=Math.max(0,Math.ceil((b-V)/m)),X=Math.min(f.outWidth,(f.inWidth+b-V)/m);for(let W=0;W<f.inChannels;++W)for(let H=0;H<f.outChannels;++H){let Y=0;for(let Z=0;Z<f.batchSize;++Z)for(let Q=$;Q<O;++Q){let se=D+Q*d-v;for(let ne=K;ne<X;++ne){let re=V+ne*m-b;x?Y+=k.get(Z,se,re,W)*N.get(Z,Q,ne,H):Y+=k.get(Z,W,se,re)*N.get(Z,H,Q,ne)}}y.set(Y,D,V,W,H)}}}return r.makeTensorInfo(y.shape,y.dtype,y.values)}var $4={kernelName:Wd,backendName:"cpu",kernelFunc:gae};function xae(t){let{inputs:e,backend:r,attrs:n}=t,{dy:o,filter:s}=e,{inputShape:i,strides:a,pad:l,dataFormat:u,dimRoundingMode:c}=n;ee([o,s],"conv2dBackpropInput");let p=w.computeStrides(s.shape),f=w.computeStrides(o.shape),d=T.convertConv2DDataFormat(u),m=T.computeConv2DInfo(i,s.shape,a,1,l,c,!1,d),h=new vt(m.inShape,"float32"),g=h.values,x=r.data.get(o.dataId).values,y=r.data.get(s.dataId).values,[b,v,C]=p,{batchSize:S,filterHeight:k,filterWidth:N,inChannels:D,inHeight:$,inWidth:O,outChannels:V,outHeight:K,outWidth:X,strideHeight:W,strideWidth:H}=m;d=m.dataFormat;let Y=k-1-m.padInfo.top,Z=N-1-m.padInfo.left,Q=d==="channelsLast",se=h.strides[0],ne=Q?h.strides[1]:h.strides[2],re=Q?h.strides[2]:1,ue=Q?1:h.strides[1],ae=f[0],le=Q?f[1]:f[2],me=Q?f[2]:1,ke=Q?1:f[1];for(let ve=0;ve<S;++ve)for(let Te=0;Te<D;++Te)for(let Ve=0;Ve<$;++Ve){let qe=Ve-Y,R=Math.max(0,Math.ceil(qe/W)),q=Math.min(K,(k+qe)/W);for(let P=0;P<O;++P){let ie=P-Z,pe=Math.max(0,Math.ceil(ie/H)),fe=Math.min(X,(N+ie)/H),Se=0;for(let We=R;We<q;++We){let Mt=We*W-qe;for(let mt=pe;mt<fe;++mt){let he=mt*H-ie,st=ae*ve+le*We+me*mt,ht=b*(k-1-Mt)+v*(N-1-he)+C*Te;for(let vo=0;vo<V;++vo){let _r=x[st+ke*vo],gn=y[ht+vo];Se+=_r*gn}}}let at=se*ve+ne*Ve+re*P+ue*Te;g[at]=Se}}return r.makeTensorInfo(h.shape,h.dtype,h.values)}var R4={kernelName:_u,backendName:"cpu",kernelFunc:xae};function yae(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,filter:s}=e,{strides:i,pad:a,dilations:l}=n;ee([o,s],"conv3d");let u=T.computeConv3DInfo(o.shape,s.shape,i,l,a),{filterDepth:c,filterHeight:p,filterWidth:f,dilationDepth:d,dilationHeight:m,dilationWidth:h,padInfo:g}=u,x=g.front,y=g.left,b=g.top,v=new vt(u.outShape,o.dtype),C=r.data.get(o.dataId).values,S=r.data.get(s.dataId).values,k=v.values,N=w.computeStrides(o.shape),D=w.computeStrides(s.shape);for(let $=0;$<u.batchSize;++$){let O=$*N[0],V=$*v.strides[0];for(let K=0;K<u.outDepth;++K){let X=V+K*v.strides[1],W=K*u.strideDepth-x;for(let H=0;H<c;++H){let Y=W+H*d;if(Y<0||Y>=u.inDepth)continue;let Z=H*D[0],Q=O+Y*N[1];for(let se=0;se<u.outHeight;++se){let ne=X+se*v.strides[2],re=se*u.strideHeight-b;for(let ue=0;ue<p;++ue){let ae=re+ue*m;if(ae<0||ae>=u.inHeight)continue;let le=Z+ue*D[1],me=Q+ae*N[2];for(let ke=0;ke<u.outWidth;++ke){let ve=ne+ke*u.outChannels,Te=ke*u.strideWidth-y;for(let Ve=0;Ve<f;++Ve){let qe=Te+Ve*h;if(qe<0||qe>=u.inWidth)continue;let R=le+Ve*D[2],q=me+qe*u.inChannels,P=R;for(let ie=0;ie<u.inChannels;++ie){let pe=C[q+ie];for(let fe=0;fe<u.outChannels;++fe)k[ve+fe]+=pe*S[P+fe];P+=u.outChannels}}}}}}}}return r.makeTensorInfo(v.shape,v.dtype,v.values)}var O4={kernelName:Au,backendName:"cpu",kernelFunc:yae};function bae(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,dy:s}=e,{strides:i,pad:a,filterShape:l}=n;ee([o,s],"conv3dBackpropFilterV2");let u=w.computeStrides(o.shape),c=w.computeStrides(s.shape),p=T.computeConv3DInfo(o.shape,l,i,1,a),f=p.strideDepth,d=p.strideHeight,m=p.strideWidth,h=p.filterDepth,g=p.filterHeight,x=p.filterWidth,y=new vt(p.filterShape,"float32"),b=y.values,[v,C,S,k]=y.strides,N=r.data.get(s.dataId).values,[D,$,O,V]=c,K=r.data.get(o.dataId).values,[X,W,H,Y]=u,Z=p.padInfo.front,Q=p.padInfo.left,se=p.padInfo.top;for(let ne=0;ne<h;++ne){let re=Math.max(0,Math.ceil((Z-ne)/f)),ue=Math.min(p.outDepth,(p.inDepth+Z-ne)/f),ae=ne*v;for(let le=0;le<g;++le){let me=Math.max(0,Math.ceil((se-le)/d)),ke=Math.min(p.outHeight,(p.inHeight+se-le)/d),ve=le*C+ae;for(let Te=0;Te<x;++Te){let Ve=Math.max(0,Math.ceil((Q-Te)/m)),qe=Math.min(p.outWidth,(p.inWidth+Q-Te)/m),R=Te*S+ve;for(let q=0;q<p.inChannels;++q){let P=q*k+R;for(let ie=0;ie<p.outChannels;++ie){let pe=0;for(let fe=0;fe<p.batchSize;++fe){let Se=fe*X,at=fe*D;for(let We=re;We<ue;++We){let mt=(ne+We*f-Z)*W+Se,he=We*$+at;for(let st=me;st<ke;++st){let vo=(le+st*d-se)*H+mt,_r=st*O+he;for(let gn=Ve;gn<qe;++gn){let Js=(Te+gn*m-Q)*Y+vo,cx=gn*V+_r;pe+=K[Js+q]*N[cx+ie]}}}}b[P+ie]=pe}}}}}return r.makeTensorInfo(y.shape,y.dtype,y.values)}var F4={kernelName:Gd,backendName:"cpu",kernelFunc:bae};function vae(t){let{inputs:e,backend:r,attrs:n}=t,{dy:o,filter:s}=e,{pad:i,strides:a,inputShape:l}=n;ee([o],"conv3dBackpropInputV2");let u=w.computeStrides(o.shape),c=w.computeStrides(s.shape),p=T.computeConv3DInfo(l,s.shape,a,1,i),f=new vt(p.inShape,"float32"),d=f.values,[m,h,g,x]=f.strides,y=r.data.get(o.dataId).values,[b,v,C,S]=u,k=r.data.get(s.dataId).values,[N,D,$,O]=c,{batchSize:V,filterDepth:K,filterHeight:X,filterWidth:W,inChannels:H,inDepth:Y,inHeight:Z,inWidth:Q,outChannels:se,outDepth:ne,outHeight:re,outWidth:ue,strideDepth:ae,strideHeight:le,strideWidth:me}=p,ke=K-1-p.padInfo.front,ve=X-1-p.padInfo.top,Te=W-1-p.padInfo.left;for(let Ve=0;Ve<V;++Ve)for(let qe=0;qe<H;++qe)for(let R=0;R<Y;++R){let q=R-ke,P=Math.max(0,Math.ceil(q/ae)),ie=Math.min(ne,(K+q)/ae);for(let pe=0;pe<Z;++pe){let fe=pe-ve,Se=Math.max(0,Math.ceil(fe/le)),at=Math.min(re,(X+fe)/le);for(let We=0;We<Q;++We){let Mt=We-Te,mt=Math.max(0,Math.ceil(Mt/me)),he=Math.min(ue,(W+Mt)/me),st=0;for(let ht=P;ht<ie;++ht){let vo=ht*ae-q;for(let _r=Se;_r<at;++_r){let gn=_r*le-fe;for(let xa=mt;xa<he;++xa){let Js=xa*me-Mt,cx=b*Ve+v*ht+C*_r+S*xa,xI=N*(K-1-vo)+D*(X-1-gn)+$*(W-1-Js)+O*qe;for(let Sp=0;Sp<se;++Sp){let Nd=y[cx+Sp],Dv=k[xI+Sp];st+=Nd*Dv}}}}d[m*Ve+h*R+g*pe+x*We+qe]=st}}}return r.makeTensorInfo(f.shape,f.dtype,f.values)}var P4={kernelName:Ud,backendName:"cpu",kernelFunc:vae};var wae=Le(_a,t=>Math.cos(t)),L4={kernelName:_a,backendName:"cpu",kernelFunc:wae};var Cae=Le(Aa,t=>Math.cosh(t)),M4={kernelName:Aa,backendName:"cpu",kernelFunc:Cae};function Sae(t){let{inputs:e,backend:r,attrs:n}=t,{image:o,boxes:s,boxInd:i}=e,{cropSize:a,method:l,extrapolationValue:u}=n,[c,p,f,d]=o.shape,m=s.shape[0],[h,g]=a,x=Ee([m,h,g,d],"float32"),y=r.data.get(s.dataId).values,b=r.data.get(i.dataId).values,v=r.data.get(o.dataId).values,C=w.computeStrides(o.shape),S=w.computeStrides(x.shape);for(let k=0;k<m;k++){let N=k*4,D=y[N],$=y[N+1],O=y[N+2],V=y[N+3],K=b[k];if(K>=c)continue;let X=h>1?(O-D)*(p-1)/(h-1):0,W=g>1?(V-$)*(f-1)/(g-1):0;for(let H=0;H<h;H++){let Y=h>1?D*(p-1)+H*X:.5*(D+O)*(p-1);if(Y<0||Y>p-1){for(let Z=0;Z<g;Z++)for(let Q=0;Q<d;Q++){let se=Q+Z*S[2]+H*S[1]+k*S[0];x.values[se]=u}continue}if(l==="bilinear"){let Z=Math.floor(Y),Q=Math.ceil(Y),se=Y-Z;for(let ne=0;ne<g;ne++){let re=g>1?$*(f-1)+ne*W:.5*($+V)*(f-1);if(re<0||re>f-1){for(let me=0;me<d;me++){let ke=me+ne*S[2]+H*S[1]+k*S[0];x.values[ke]=u}continue}let ue=Math.floor(re),ae=Math.ceil(re),le=re-ue;for(let me=0;me<d;me++){let ke=me+ue*C[2]+Z*C[1]+K*C[0],ve=v[ke];ke=me+ae*C[2]+Z*C[1]+K*C[0];let Te=v[ke];ke=me+ue*C[2]+Q*C[1]+K*C[0];let Ve=v[ke];ke=me+ae*C[2]+Q*C[1]+K*C[0];let qe=v[ke],R=ve+(Te-ve)*le,q=Ve+(qe-Ve)*le;ke=me+ne*S[2]+H*S[1]+k*S[0],x.values[ke]=R+(q-R)*se}}}else for(let Z=0;Z<g;++Z){let Q=g>1?$*(f-1)+Z*W:.5*($+V)*(f-1);if(Q<0||Q>f-1){for(let re=0;re<d;re++){let ue=re+Z*S[2]+H*S[1]+k*S[0];x.values[ue]=u}continue}let se=Math.round(Q),ne=Math.round(Y);for(let re=0;re<d;re++){let ue=re+se*C[2]+ne*C[1]+K*C[0],ae=re+Z*S[2]+H*S[1]+k*S[0];x.values[ae]=v[ue]}}}}return r.makeTensorInfo(x.shape,x.dtype,x.values)}var z4={kernelName:qd,backendName:"cpu",kernelFunc:Sae};function kae(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{axis:s,exclusive:i,reverse:a}=n;ee(o,"cumprod");let l=T.getAxesPermutation([s],o.shape.length),u=o;l!=null&&(u=Yt({inputs:{x:o},backend:r,attrs:{perm:l}}));let c=T.getInnerMostAxes(1,o.shape.length)[0];if(c!==u.shape.length-1)throw new Error(`backend.cumprod in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${c}`);let p=wr(u.dtype,"int32"),f=w.makeOnesTypedArray(w.sizeFromShape(u.shape),p),d=r.data.get(u.dataId).values,m=u.shape[u.shape.length-1],h=a?(x,y)=>x+m-y-1:(x,y)=>x+y;for(let x=0;x<d.length;x+=m)for(let y=0;y<m;y++){let b=h(x,y);if(y===0)f[b]=i?1:d[b];else{let v=h(x,y-1);f[b]=i?d[v]*f[v]:d[b]*f[v]}}let g=r.makeTensorInfo(u.shape,p,f);if(l!=null){let x=T.getUndoAxesPermutation(l),y=Yt({inputs:{x:g},backend:r,attrs:{perm:x}});return r.disposeIntermediateTensorInfo(g),r.disposeIntermediateTensorInfo(u),y}return g}var B4={kernelName:Hd,backendName:"cpu",kernelFunc:kae};function Tae(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{axis:s,exclusive:i,reverse:a}=n;ee(o,"cumsum");let l=T.getAxesPermutation([s],o.shape.length),u=o;l!=null&&(u=Yt({inputs:{x:o},backend:r,attrs:{perm:l}}));let c=T.getInnerMostAxes(1,o.shape.length)[0];if(c!==u.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${u.shape.length-1} but got axis=${c}`);let p=wr(u.dtype,"int32"),f=w.makeZerosTypedArray(w.sizeFromShape(u.shape),p),d=r.data.get(u.dataId).values,m=u.shape[u.shape.length-1],h=a?(x,y)=>x+m-y-1:(x,y)=>x+y;for(let x=0;x<d.length;x+=m)for(let y=0;y<m;y++){let b=h(x,y);if(y===0)f[b]=i?0:d[b];else{let v=h(x,y-1);f[b]=i?d[v]+f[v]:d[b]+f[v]}}let g=r.makeTensorInfo(u.shape,p,f);if(l!=null){let x=T.getUndoAxesPermutation(l),y=Yt({inputs:{x:g},backend:r,attrs:{perm:x}});return r.disposeIntermediateTensorInfo(g),r.disposeIntermediateTensorInfo(u),y}return g}var V4={kernelName:Du,backendName:"cpu",kernelFunc:Tae};function Nae(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,weights:s}=e,{size:i,binaryOutput:a}=n;if(o.shape.length===1){let l=r.data.get(o.dataId).values,u=r.data.get(s.dataId).values,c=Th(l,u,s.dtype,s.shape,i);return r.makeTensorInfo([i],s.dtype,c)}else if(o.shape.length===2){let l=r.bufferSync(o),u=r.bufferSync(s),c=Xw(l,u,i,a);return r.makeTensorInfo(c.shape,s.dtype,c.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${o.shape.length}.`)}var W4={kernelName:jd,backendName:"cpu",kernelFunc:Nae};function Iae(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{blockSize:s,dataFormat:i}=n;w.assert(i==="NHWC",()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${i}`);let a=o.shape[0],l=o.shape[1],u=o.shape[2],c=o.shape[3],p=l*s,f=u*s,d=c/(s*s),m=r.data.get(o.dataId).values,h=new Float32Array(a*p*f*d),g=0;for(let x=0;x<a;++x)for(let y=0;y<p;++y){let b=Math.floor(y/s),v=y%s;for(let C=0;C<f;++C){let S=Math.floor(C/s),k=C%s,N=(v*s+k)*d;for(let D=0;D<d;++D){let O=D+N+c*(S+u*(b+l*x));h[g++]=m[O]}}}return r.makeTensorInfo([a,p,f,d],o.dtype,h)}var G4={kernelName:Kd,backendName:"cpu",kernelFunc:Iae};function E_(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,filter:s}=e,{strides:i,pad:a,dilations:l,dimRoundingMode:u}=n;ee([o,s],"depthwiseConv2DNative");let c=w.computeStrides(o.shape),p=w.computeStrides(s.shape),f=l;f==null&&(f=[1,1]),w.assert(T.eitherStridesOrDilationsAreOne(i,f),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${f}'`);let d=T.computeConv2DInfo(o.shape,s.shape,i,f,a,u,!0),{filterHeight:m,filterWidth:h,dilationHeight:g,dilationWidth:x,padInfo:y}=d,b=y.left,v=y.top,C=d.outChannels/d.inChannels,S=new vt(d.outShape,o.dtype),k=r.data.get(o.dataId).values,N=r.data.get(s.dataId).values,D=S.values;for(let $=0;$<d.batchSize;++$){let O=$*c[0],V=$*S.strides[0];for(let K=0;K<d.outHeight;++K){let X=V+K*S.strides[1],W=K*d.strideHeight-v;for(let H=0;H<m;++H){let Y=W+H*g;if(Y<0||Y>=d.inHeight)continue;let Z=H*p[0],Q=O+Y*c[1];for(let se=0;se<d.outWidth;++se){let ne=X+se*S.strides[2],re=se*d.strideWidth-b;for(let ue=0;ue<h;++ue){let ae=re+ue*x;if(ae<0||ae>=d.inWidth)continue;let le=Z+ue*p[1],me=Q+ae*d.inChannels,ke=ne,ve=le;for(let Te=0;Te<d.inChannels;++Te){let Ve=k[me+Te];for(let qe=0;qe<C;++qe)D[ke+qe]+=Ve*N[ve+qe];ke+=C,ve+=C}}}}}}return r.makeTensorInfo(S.shape,S.dtype,S.values)}var U4={kernelName:$u,backendName:"cpu",kernelFunc:E_};function Eae(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,dy:s}=e,{strides:i,dilations:a,pad:l,dimRoundingMode:u,filterShape:c}=n;ee([o,s],"depthwiseConv2dNativeBackpropFilter");let p=T.computeConv2DInfo(o.shape,c,i,a,l,u,!0),{strideHeight:f,strideWidth:d,filterHeight:m,filterWidth:h}=p,g=new vt(p.filterShape,"float32"),x=p.padInfo.left,y=p.padInfo.top,b=p.outChannels/p.inChannels,v=r.data.get(o.dataId).values,C=new vt(o.shape,o.dtype,v),S=r.data.get(s.dataId).values,k=new vt(s.shape,s.dtype,S);for(let N=0;N<m;++N){let D=Math.max(0,Math.ceil((y-N)/f)),$=Math.min(p.outHeight,(p.inHeight+y-N)/f);for(let O=0;O<h;++O){let V=Math.max(0,Math.ceil((x-O)/d)),K=Math.min(p.outWidth,(p.inWidth+x-O)/d);for(let X=0;X<p.outChannels;++X){let W=Math.trunc(X/b),H=X%b,Y=0;for(let Z=0;Z<p.batchSize;++Z)for(let Q=D;Q<$;++Q){let se=N+Q*f-y;for(let ne=V;ne<K;++ne){let re=O+ne*d-x;Y+=C.get(Z,se,re,W)*k.get(Z,Q,ne,X)}}g.set(Y,N,O,W,H)}}}return r.makeTensorInfo(g.shape,g.dtype,g.values)}var H4={kernelName:Xd,backendName:"cpu",kernelFunc:Eae};function _ae(t){let{inputs:e,backend:r,attrs:n}=t,{dy:o,filter:s}=e,{strides:i,dilations:a,pad:l,dimRoundingMode:u,inputShape:c}=n;ee([o,s],"depthwiseConv2DNativeBackpropInput");let p=w.computeStrides(o.shape),f=w.computeStrides(s.shape),d=T.computeConv2DInfo(c,s.shape,i,a,l,u,!0),m=new vt(d.inShape,"float32"),h=m.values,[g,x,y]=m.strides,b=r.data.get(o.dataId).values,[v,C,S]=p,k=r.data.get(s.dataId).values,[N,D,$]=f,{batchSize:O,filterHeight:V,filterWidth:K,inChannels:X,inHeight:W,inWidth:H,outChannels:Y,outHeight:Z,outWidth:Q,strideHeight:se,strideWidth:ne}=d,re=V-1-d.padInfo.top,ue=K-1-d.padInfo.left,ae=Y/X;for(let le=0;le<O;++le)for(let me=0;me<X;++me)for(let ke=0;ke<W;++ke){let ve=ke-re,Te=Math.max(0,Math.ceil(ve/se)),Ve=Math.min(Z,(V+ve)/se);for(let qe=0;qe<H;++qe){let R=qe-ue,q=Math.max(0,Math.ceil(R/ne)),P=Math.min(Q,(K+R)/ne),ie=0;for(let pe=Te;pe<Ve;++pe){let fe=pe*se-ve;for(let Se=q;Se<P;++Se){let at=Se*ne-R,We=v*le+C*pe+S*Se,Mt=N*(V-1-fe)+D*(K-1-at)+$*me;for(let mt=0;mt<ae;++mt){let he=me*ae+mt,st=b[We+he],ht=k[Mt+mt];ie+=st*ht}}}h[g*le+x*ke+y*qe+me]=ie}}return r.makeTensorInfo(m.shape,m.dtype,m.values)}var q4={kernelName:Yd,backendName:"cpu",kernelFunc:_ae};function Aae(t){let{inputs:e,backend:r}=t,{x:n}=e,o=w.sizeFromShape(n.shape),s=r.data.get(n.dataId).values,i=Ee([o,o],n.dtype),a=i.values;for(let u=0;u<s.length;u++)a[u*o+u]=s[u];let l=[...n.shape,...n.shape];return r.makeTensorInfo(l,i.dtype,i.values)}var j4={kernelName:Lv,backendName:"cpu",kernelFunc:Aae};var K4={kernelName:Ru,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:r})=>{let{x:n,filter:o}=t,{strides:s,pad:i,dilations:a}=r,l=e,u=l.data.get(n.dataId).values,c=n.shape.length,p=l.data.get(o.dataId).values,f=o.shape.length,{batchSize:d,inHeight:m,inWidth:h,inChannels:g,outHeight:x,outWidth:y,padInfo:b,strideHeight:v,strideWidth:C,filterHeight:S,filterWidth:k,dilationHeight:N,dilationWidth:D,outShape:$}=T.computeDilation2DInfo(n.shape,o.shape,s,i,"NHWC",a),O=w.sizeFromShape($),V=$.length,K=w.getArrayFromDType(n.dtype,O);for(let W=0;W<d;++W)for(let H=0;H<x;++H){let Y=H*v-b.top;for(let Z=0;Z<y;++Z){let Q=Z*C-b.left;for(let se=0;se<g;++se){let ne=Number.MIN_SAFE_INTEGER;for(let ue=0;ue<S;++ue){let ae=Y+ue*N;if(ae>=0&&ae<m)for(let le=0;le<k;++le){let me=Q+le*D;if(me>=0&&me<h){let ke=w.locToIndex([W,ae,me,se],c,w.computeStrides(n.shape)),ve=w.locToIndex([ue,le,se],f,w.computeStrides(o.shape)),Te=u[ke]+p[ve];Te>ne&&(ne=Te)}}}let re=w.locToIndex([W,H,Z,se],V,w.computeStrides($));K[re]=ne}}}return{dataId:l.write(w.toTypedArray(K,n.dtype),$,n.dtype),shape:$,dtype:n.dtype}}};var X4={kernelName:gx,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:r})=>{let{x:n,filter:o,dy:s}=t,{strides:i,pad:a,dilations:l}=r,u=e,c=w.toNestedArray(n.shape,u.data.get(n.dataId).values),p=w.toNestedArray(o.shape,u.data.get(o.dataId).values),{batchSize:f,inHeight:d,inWidth:m,inChannels:h,outHeight:g,outWidth:x,padInfo:y,strideHeight:b,strideWidth:v,filterHeight:C,filterWidth:S,dilationHeight:k,dilationWidth:N,outShape:D}=T.computeDilation2DInfo(n.shape,o.shape,i,a,"NHWC",l);w.assert(s.rank===D.length,()=>`Error in ${gx}, dy must have the same rank as output ${D.length}, but got ${s.rank}`);let $=w.toNestedArray(D,u.data.get(s.dataId).values),O=w.makeZerosNestedTypedArray(o.shape,o.dtype);for(let K=0;K<f;++K)for(let X=0;X<g;++X){let W=X*b-y.top;for(let H=0;H<x;++H){let Y=H*v-y.left;for(let Z=0;Z<h;++Z){let Q=Number.MIN_SAFE_INTEGER,se=0,ne=0;for(let re=0;re<C;++re){let ue=W+re*k;if(ue>=0&&ue<d)for(let ae=0;ae<S;++ae){let le=Y+ae*N;if(le>=0&&le<m){let me=c[K][ue][le][Z]+p[re][ae][Z];me>Q&&(Q=me,se=re,ne=ae)}}}O[se][ne][Z]+=$[K][X][H][Z]}}}return{dataId:u.write(w.toTypedArray(O,n.dtype),o.shape,o.dtype),shape:o.shape,dtype:o.dtype}}};var Y4={kernelName:hx,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:r})=>{let{x:n,filter:o,dy:s}=t,{strides:i,pad:a,dilations:l}=r,u=e,c=w.toNestedArray(n.shape,u.data.get(n.dataId).values),p=w.toNestedArray(o.shape,u.data.get(o.dataId).values),{batchSize:f,inHeight:d,inWidth:m,inChannels:h,outHeight:g,outWidth:x,padInfo:y,strideHeight:b,strideWidth:v,filterHeight:C,filterWidth:S,dilationHeight:k,dilationWidth:N,outShape:D}=T.computeDilation2DInfo(n.shape,o.shape,i,a,"NHWC",l);w.assert(s.rank===D.length,()=>`Error in ${hx}, dy must have the same rank as output ${D.length}, but got ${s.rank}`);let $=w.toNestedArray(D,u.data.get(s.dataId).values),O=w.makeZerosNestedTypedArray(n.shape,n.dtype);for(let K=0;K<f;++K)for(let X=0;X<g;++X){let W=X*b-y.top;for(let H=0;H<x;++H){let Y=H*v-y.left;for(let Z=0;Z<h;++Z){let Q=Number.MIN_SAFE_INTEGER,se=W<0?0:W,ne=Y<0?0:Y;for(let re=0;re<C;++re){let ue=W+re*k;if(ue>=0&&ue<d)for(let ae=0;ae<S;++ae){let le=Y+ae*N;if(le>=0&&le<m){let me=c[K][ue][le][Z]+p[re][ae][Z];me>Q&&(Q=me,se=ue,ne=le)}}}O[K][se][ne][Z]+=$[K][X][H][Z]}}}return{dataId:u.write(w.toTypedArray(O,n.dtype),n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}};function Ol(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{axis:s,keepDims:i}=n;ee(o,"sum");let a;o.dtype==="bool"?a=Ds({inputs:{x:o},backend:r,attrs:{dtype:"int32"}}):a=Cn({inputs:{x:o},backend:r});let l=a.shape.length,u=w.parseAxisParam(s,a.shape),c=T.getAxesPermutation(u,l),p=u,f=a;c!=null&&(f=Yt({inputs:{x:a},backend:r,attrs:{perm:c}}),p=T.getInnerMostAxes(p.length,l)),T.assertAxesAreInnerMostDims("sum",p,f.shape.length);let[d,m]=T.computeOutAndReduceShapes(f.shape,p),h=T.upcastType(f.dtype,"int32"),g=Sh(r,d,h),x=w.sizeFromShape(m),y=r.data.get(g.dataId).values,b=r.data.get(f.dataId).values;for(let v=0;v<y.length;++v){let C=v*x,S=0;for(let k=0;k<x;++k)S+=b[C+k];y[v]=S}if(i){let v=T.expandShapeToKeepDim(g.shape,u),C=g;g=Je({inputs:{x:g},backend:r,attrs:{shape:v}}),r.disposeIntermediateTensorInfo(C)}return r.disposeIntermediateTensorInfo(a),c!=null&&r.disposeIntermediateTensorInfo(f),g}var Q4={kernelName:oc,backendName:"cpu",kernelFunc:Ol};function Dae(t){let{inputs:e,backend:r,attrs:n}=t,{equation:o}=n,s=e,{allDims:i,summedDims:a,idDims:l}=T.decodeEinsumEquation(o,s.length);T.checkEinsumDimSizes(i.length,l,s);let{path:u,steps:c}=T.getEinsumComputePath(a,l),p=c.length,f=null,d=i.length,m=[];for(let h=0;h<p;++h){for(let g of c[h]){let{permutationIndices:x,expandDims:y}=T.getEinsumPermutation(d,l[g]),b;T.isIdentityPermutation(x)?b=s[g]:(b=Yt({inputs:{x:s[g]},backend:r,attrs:{perm:x}}),m.push(b));let v=b.shape.slice();for(let C=0;C<y.length;++C)v.splice(y[C],0,1);w.arraysEqual(b.shape,v)||(b=Je({inputs:{x:b},backend:r,attrs:{shape:v}}),m.push(b)),f===null?f=b:(f=Tf({inputs:{a:b,b:f},backend:r}),m.push(f))}h<p-1&&(u[h]>=0&&(f=Ol({inputs:{x:f},backend:r,attrs:{axis:u[h]-(i.length-d),keepDims:!1}}),m.push(f)),d--)}for(let h of m)h!==f&&r.disposeIntermediateTensorInfo(h);return f}var Z4={kernelName:Qd,backendName:"cpu",kernelFunc:Dae};function $ae(t){let{inputs:e,backend:r}=t,{dy:n,y:o}=e;ee([n,o],"eluGrad");let s=new Float32Array(w.sizeFromShape(o.shape)),i=r.data.get(o.dataId).values,a=r.data.get(n.dataId).values;for(let l=0;l<i.length;++l){let u=i[l];u>=1?s[l]=a[l]:s[l]=a[l]*(u+1)}return r.makeTensorInfo(o.shape,"float32",s)}var J4={kernelName:Zd,backendName:"cpu",kernelFunc:$ae};var Rae=T.ERF_P,Oae=T.ERF_A1,Fae=T.ERF_A2,Pae=T.ERF_A3,Lae=T.ERF_A4,Mae=T.ERF_A5,zae=Le(Ra,t=>{let e=Math.sign(t),r=Math.abs(t),n=1/(1+Rae*r);return e*(1-((((Mae*n+Lae)*n+Pae)*n+Fae)*n+Oae)*n*Math.exp(-r*r))}),eV={kernelName:Ra,backendName:"cpu",kernelFunc:zae};function Ah(t){let{inputs:e,backend:r,attrs:n}=t,{input:o}=e,{dim:s}=n,i=o.shape.length,a=o.shape.slice(),l=s;return s<0&&(w.assert(-(i+1)<=s,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),l=i+s+1),a.splice(l,0,1),Je({inputs:{x:o},backend:r,attrs:{shape:a}})}var tV={kernelName:Ou,backendName:"cpu",kernelFunc:Ah};var Bae=tt((t,e)=>t/e),_0=it(Da,Bae),A0={kernelName:Da,backendName:"cpu",kernelFunc:_0};function gC(t,e,r){let n=t.shape,o=n[0],s=n[1],i=r.data.get(t.dataId),a=i.complexTensorInfos.real,l=i.complexTensorInfos.imag,u=[o,s],c=w.sizeFromShape(u),p=w.getTypedArrayFromDType("float32",c),f=w.getTypedArrayFromDType("float32",c);for(let g=0;g<o;g++){let x=Os({inputs:{x:a},backend:r,attrs:{begin:[g,0],size:[1,s]}}),y=Os({inputs:{x:l},backend:r,attrs:{begin:[g,0],size:[1,s]}}),b=Mr({inputs:{real:x,imag:y},backend:r}),{real:v,imag:C}=Vae(b,e,r),S=T.mergeRealAndImagArrays(v,C);for(let k=0;k<s;k++){let N=T.getComplexWithIndex(S,k);p[g*s+k]=N.real,f[g*s+k]=N.imag}r.disposeIntermediateTensorInfo(x),r.disposeIntermediateTensorInfo(y),r.disposeIntermediateTensorInfo(b)}let d=r.makeTensorInfo(u,"float32",p),m=r.makeTensorInfo(u,"float32",f),h=Mr({inputs:{real:d,imag:m},backend:r});return r.disposeIntermediateTensorInfo(d),r.disposeIntermediateTensorInfo(m),h}function Vae(t,e,r){let n=w.sizeFromShape(t.shape),o=r.data.get(t.dataId),s=r.data.get(o.complexTensorInfos.real.dataId).values,i=r.data.get(o.complexTensorInfos.imag.dataId).values;if(Wae(n)){let a=__(s,i,n,e,r),l=[t.shape[0],t.shape[1]];if(e){let u=r.makeTensorInfo(l,"float32",a.real),c=r.makeTensorInfo(l,"float32",a.imag),p=r.makeTensorInfo([],"float32",w.createScalarValue(n,"float32")),f=Cn({inputs:{x:p},backend:r}),d=A0.kernelFunc({inputs:{a:u,b:p},backend:r}),m=A0.kernelFunc({inputs:{a:c,b:f},backend:r}),h=r.data.get(d.dataId).values,g=r.data.get(m.dataId).values;return r.disposeIntermediateTensorInfo(u),r.disposeIntermediateTensorInfo(c),r.disposeIntermediateTensorInfo(p),r.disposeIntermediateTensorInfo(f),r.disposeIntermediateTensorInfo(d),r.disposeIntermediateTensorInfo(m),{real:h,imag:g}}return a}else{let a=T.mergeRealAndImagArrays(s,i),l=Gae(a,n,e);return T.splitRealAndImagArrays(l)}}function Wae(t){return(t&t-1)===0}function __(t,e,r,n,o){if(r===1)return{real:t,imag:e};let s=T.mergeRealAndImagArrays(t,e),i=r/2,a=T.complexWithEvenIndex(s),l=a.real,u=a.imag,c=[l.length],p=o.makeTensorInfo(c,"float32",l),f=o.makeTensorInfo(c,"float32",u),d=Mr({inputs:{real:p,imag:f},backend:o}),m=T.complexWithOddIndex(s),h=m.real,g=m.imag,x=[h.length],y=o.makeTensorInfo(x,"float32",h),b=o.makeTensorInfo(x,"float32",g),v=Mr({inputs:{real:y,imag:b},backend:o}),C=__(l,u,i,n,o),S=C.real,k=C.imag,N=[S.length],D=o.makeTensorInfo(N,"float32",S),$=o.makeTensorInfo(N,"float32",k),O=Mr({inputs:{real:D,imag:$},backend:o}),V=__(h,g,i,n,o),K=V.real,X=V.imag,W=[K.length],H=o.makeTensorInfo(W,"float32",K),Y=o.makeTensorInfo(W,"float32",X),Z=Mr({inputs:{real:H,imag:Y},backend:o}),Q=T.exponents(r,n),se=[Q.real.length],ne=o.makeTensorInfo(se,"float32",Q.real),re=o.makeTensorInfo(se,"float32",Q.imag),ue=Mr({inputs:{real:ne,imag:re},backend:o}),ae=Tf({inputs:{a:ue,b:Z},backend:o}),le=Yi({inputs:{a:O,b:ae},backend:o}),me=I0({inputs:{a:O,b:ae},backend:o}),ke=As({inputs:{input:le},backend:o}),ve=As({inputs:{input:me},backend:o}),Te=Qi({inputs:{input:le},backend:o}),Ve=Qi({inputs:{input:me},backend:o}),qe=_c({inputs:[ke,ve],backend:o,attrs:{axis:0}}),R=_c({inputs:[Te,Ve],backend:o,attrs:{axis:0}}),q=o.data.get(qe.dataId).values,P=o.data.get(R.dataId).values;return o.disposeIntermediateTensorInfo(p),o.disposeIntermediateTensorInfo(f),o.disposeIntermediateTensorInfo(d),o.disposeIntermediateTensorInfo(y),o.disposeIntermediateTensorInfo(b),o.disposeIntermediateTensorInfo(v),o.disposeIntermediateTensorInfo(D),o.disposeIntermediateTensorInfo($),o.disposeIntermediateTensorInfo(O),o.disposeIntermediateTensorInfo(H),o.disposeIntermediateTensorInfo(Y),o.disposeIntermediateTensorInfo(Z),o.disposeIntermediateTensorInfo(ne),o.disposeIntermediateTensorInfo(re),o.disposeIntermediateTensorInfo(ue),o.disposeIntermediateTensorInfo(ae),o.disposeIntermediateTensorInfo(le),o.disposeIntermediateTensorInfo(me),o.disposeIntermediateTensorInfo(ke),o.disposeIntermediateTensorInfo(Te),o.disposeIntermediateTensorInfo(ve),o.disposeIntermediateTensorInfo(Ve),o.disposeIntermediateTensorInfo(qe),o.disposeIntermediateTensorInfo(R),{real:q,imag:P}}function Gae(t,e,r){let n=new Float32Array(e*2);for(let o=0;o<e;o++){let s=0,i=0;for(let a=0;a<e;a++){let l=T.exponent(o*a,e,r),u=T.getComplexWithIndex(t,a);s+=u.real*l.real-u.imag*l.imag,i+=u.real*l.imag+u.imag*l.real}r&&(s/=e,i/=e),T.assignToTypedArray(n,s,i,o)}return n}function Uae(t){let{inputs:e,backend:r}=t,{input:n}=e,o=w.sizeFromShape(n.shape),s=n.shape[n.shape.length-1],i=o/s,a=Je({inputs:{x:n},backend:r,attrs:{shape:[i,s]}}),l=gC(a,!1,r),u=Je({inputs:{x:l},backend:r,attrs:{shape:n.shape}});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(l),u}var rV={kernelName:Jd,backendName:"cpu",kernelFunc:Uae};function D0(t){let{backend:e,attrs:r}=t,{shape:n,value:o,dtype:s}=r,i=s||w.inferDtype(o),a=w.getArrayFromDType(i,w.sizeFromShape(n));return Hae(a,o,i),e.makeTensorInfo(n,i,a)}var nV={kernelName:em,backendName:"cpu",kernelFunc:D0};function Hae(t,e,r){t.fill(e)}var oV={kernelName:tm,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:r})=>{let{image:n}=t,o=r,s=w.getTypedArrayFromDType(n.dtype,w.sizeFromShape(n.shape)),[i,a,l,u]=n.shape,c=o.data.get(n.dataId).values;for(let f=0;f<i;f++){let d=f*l*a*u;for(let m=0;m<a;m++){let h=m*(l*u);for(let g=0;g<l;g++){let x=g*u;for(let y=0;y<u;y++){let b=Math.round(l-g-1),v=d+h+x+y,C=c[v];if(b>=0&&b<l){let S=b*u,k=d+h+S+y;C=c[k]}s[v]=C}}}}return{dataId:o.write(s,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}};var qae=tt((t,e)=>Math.floor(t/e)),jae=it(La,qae,null,"int32"),sV={kernelName:La,backendName:"cpu",kernelFunc:jae};function Kae(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,filter:s,bias:i,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:c,dilations:p,dimRoundingMode:f,activation:d,leakyreluAlpha:m}=n,h=I_({inputs:{x:o,filter:s},backend:r,attrs:{strides:l,pad:u,dataFormat:c,dilations:p,dimRoundingMode:f}});if(i){let g=h;if(c==="NCHW"&&i.shape.length===1&&i.shape[0]!==1){let x=Je({inputs:{x:i},backend:r,attrs:{shape:[i.shape[0],1,1]}});h=Yi({inputs:{a:h,b:x},backend:r}),r.disposeIntermediateTensorInfo(x)}else h=Yi({inputs:{a:h,b:i},backend:r});r.disposeIntermediateTensorInfo(g)}if(d){let g=h;if(c==="NCHW"&&d==="prelu"&&a.shape.length===1&&a.shape[0]!==1){let x=Je({inputs:{x:a},backend:r,attrs:{shape:[a.shape[0],1,1]}});h=Nf(r,h,d,x,m),r.disposeIntermediateTensorInfo(x)}else h=Nf(r,h,d,a,m);r.disposeIntermediateTensorInfo(g)}return h}var iV={kernelName:Lp,backendName:"cpu",kernelFunc:Kae};function Xae(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,filter:s,bias:i,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:c,dilations:p,dimRoundingMode:f,activation:d,leakyreluAlpha:m}=n,h=E_({inputs:{x:o,filter:s},backend:r,attrs:{strides:l,pad:u,dataFormat:c,dilations:p,dimRoundingMode:f}});if(i){let g=h;h=Yi({inputs:{a:h,b:i},backend:r}),r.disposeIntermediateTensorInfo(g)}if(d){let g=h;h=Nf(r,h,d,a,m),r.disposeIntermediateTensorInfo(g)}return h}var aV={kernelName:Mp,backendName:"cpu",kernelFunc:Xae};function Yae(t){let{inputs:e,backend:r}=t,{params:n,indices:o}=e,s=w.sizeFromShape(n.shape),i=o.shape,a=i[i.length-1],[l,u,c,p]=T.prepareAndValidate(n,o);if(u===0)return r.makeTensorInfo(l,n.dtype,[]);let f=r.data.get(o.dataId).values,d=r.bufferSync(n),m=Qw(f,d,n.dtype,u,a,c,p,n.shape,s);return r.makeTensorInfo(l,n.dtype,m.values)}var lV={kernelName:Mv,backendName:"cpu",kernelFunc:Yae};function Qae(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,indices:s}=e,{axis:i,batchDims:a}=n;ee([o,s],"gatherV2");let l=w.parseAxisParam(i,o.shape)[0],u=r.data.get(s.dataId).values,c=o.shape[l];for(let v=0;v<u.length;++v){let C=u[v];w.assert(C<=c-1&&C>=0,()=>`GatherV2: the index value ${C} is not in [0, ${c-1}]`)}let p=a;a==null&&(p=0);let f=w.sizeFromShape(s.shape),d=T.segment_util.collectGatherOpShapeInfo(o,s,l,p),m=Je({inputs:{x:o},backend:r,attrs:{shape:[d.batchSize,d.outerSize,d.dimSize,d.sliceSize]}}),h=Je({inputs:{x:s},backend:r,attrs:{shape:[d.batchSize,f/d.batchSize]}}),g=[d.batchSize,d.outerSize,f/d.batchSize,d.sliceSize],x=r.bufferSync(h),y=r.bufferSync(m),b=Zw(y,x,g);return r.disposeIntermediateTensorInfo(m),r.disposeIntermediateTensorInfo(h),r.makeTensorInfo(d.outputShape,b.dtype,b.values)}var uV={kernelName:Pu,backendName:"cpu",kernelFunc:Qae};function Zae(t){let{inputs:e,backend:r}=t,{input:n}=e,o=w.sizeFromShape(n.shape),s=n.shape[n.shape.length-1],i=o/s,a=Je({inputs:{x:n},backend:r,attrs:{shape:[i,s]}}),l=gC(a,!0,r),u=Je({inputs:{x:l},backend:r,attrs:{shape:n.shape}});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(l),u}var cV={kernelName:rm,backendName:"cpu",kernelFunc:Zae};var Jae=Le(za,t=>Number.isFinite(t)?1:0,"bool"),pV={kernelName:za,backendName:"cpu",kernelFunc:Jae};var ele=Le(Ba,t=>Math.abs(t)===1/0?1:0,"bool"),fV={kernelName:Ba,backendName:"cpu",kernelFunc:ele};var tle=Le(Va,t=>Number.isNaN(t)?1:0,"bool"),dV={kernelName:Va,backendName:"cpu",kernelFunc:tle};function rle(t){let{backend:e,attrs:r}=t,{start:n,stop:o,num:s}=r,i=Jw(n,o,s);return e.makeTensorInfo([i.length],"float32",i)}var mV={kernelName:zv,backendName:"cpu",kernelFunc:rle};var nle=Le(Ga,t=>Math.log1p(t)),hV={kernelName:Ga,backendName:"cpu",kernelFunc:nle};var ole=tt((t,e)=>t&&e),sle=it($p,ole,null,"bool"),gV={kernelName:$p,backendName:"cpu",kernelFunc:sle};var ile=Le(Rp,t=>t?0:1,"bool"),xV={kernelName:Rp,backendName:"cpu",kernelFunc:ile};var ale=tt((t,e)=>t||e),lle=it(Op,ale,null,"bool"),yV={kernelName:Op,backendName:"cpu",kernelFunc:lle};function ule(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{depthRadius:s,bias:i,alpha:a,beta:l}=n;ee(o,"LRN");let u=o.shape[3],c=u-1,p=r.data.get(o.dataId).values,f=w.sizeFromShape(o.shape),d=new Float32Array(f);function m(h){let g=h%u,x=h-g+Math.max(0,g-s),y=h-g+Math.min(g+s,c),b=0;for(;x<=y;x++){let v=p[x];b+=v*v}return b}for(let h=0;h<f;h++){let g=m(h),x=p[h]*Math.pow(i+a*g,-l);d[h]=x}return r.makeTensorInfo(o.shape,o.dtype,d)}var bV={kernelName:Mu,backendName:"cpu",kernelFunc:ule};function cle(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,y:s,dy:i}=e,{depthRadius:a,bias:l,alpha:u,beta:c}=n;ee(i,"LRNGrad");let p=w.sizeFromShape(i.shape),f=i.shape[3],d=r.data.get(i.dataId).values,m=r.data.get(o.dataId).values,h=r.data.get(s.dataId).values,g=new Float32Array(p),x=p;for(let y=0;y<x;y++){let b=y%f,v=y-b+Math.max(0,b-a),C=y-b+Math.min(f,b+a+1),S=0;for(let k=v;k<C;k++)S+=Math.pow(m[k],2);S=u*S+l;for(let k=v;k<C;k++){let N=-2*u*c*m[k]*h[y]/S;y===k&&(N+=Math.pow(S,-c)),N*=d[y],g[k]+=N}}return r.makeTensorInfo(i.shape,o.dtype,g)}var vV={kernelName:om,backendName:"cpu",kernelFunc:cle};function A_(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{reductionIndices:s,keepDims:i}=n,a=r,l=o.shape,u=l.length,c=w.parseAxisParam(s,l),p=c,f=T.getAxesPermutation(p,u),d=a.data.get(o.dataId).values;if(f!=null){let v=new Array(u);for(let C=0;C<v.length;C++)v[C]=l[f[C]];d=Nh(d,l,o.dtype,f,v),p=T.getInnerMostAxes(p.length,u),l=v}ee(o,"max"),T.assertAxesAreInnerMostDims("max",p,u);let[m,h]=T.computeOutAndReduceShapes(l,p),g=w.sizeFromShape(h),x=eC(d,g,m,o.dtype),y=a.write(x,m,o.dtype),b=m;return i&&(b=T.expandShapeToKeepDim(m,c)),{dataId:y,shape:b,dtype:o.dtype}}var wV={kernelName:zu,backendName:"cpu",kernelFunc:A_};function ple(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e;ee(o,"maxPool");let{filterSize:s,strides:i,pad:a,dimRoundingMode:l}=n,u=1;w.assert(T.eitherStridesOrDilationsAreOne(i,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);let c=T.computePool2DInfo(o.shape,s,i,u,a,l),p;if(c.filterWidth===1&&c.filterHeight===1&&w.arraysEqual(c.inShape,c.outShape))p=Cn({inputs:{x:o},backend:r});else{let f=r.data.get(o.dataId).values,d=w.computeStrides(o.shape),m=_h(f,o.shape,o.dtype,d,c,"max");p=r.makeTensorInfo(c.outShape,o.dtype,m.values)}return p}var CV={kernelName:Bu,backendName:"cpu",kernelFunc:ple};function fle(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{filterSize:s,strides:i,pad:a,dimRoundingMode:l,dataFormat:u}=n;ee(o,"maxPool3d");let c=T.computePool3DInfo(o.shape,s,i,1,a,l,u),p=r.data.get(o.dataId).values,f=hC(p,o.shape,o.dtype,w.computeStrides(o.shape),c,"max");return r.makeTensorInfo(f.shape,"float32",f.values)}var SV={kernelName:Vu,backendName:"cpu",kernelFunc:fle};function dle(t){let{inputs:e,backend:r,attrs:n}=t,{dy:o,input:s}=e,{filterSize:i,strides:a,pad:l,dimRoundingMode:u}=n;ee([o,s],"maxPool3DGrad");let c=T.computePool3DInfo(s.shape,i,a,1,l,u),p=r.bufferSync(s),f=y4(p,c),d=c.strideDepth,m=c.strideHeight,h=c.strideWidth,g=c.dilationDepth,x=c.dilationHeight,y=c.dilationWidth,b=c.effectiveFilterDepth,v=c.effectiveFilterHeight,C=c.effectiveFilterWidth,S=b-1-c.padInfo.front,k=C-1-c.padInfo.left,N=v-1-c.padInfo.top,D=Ee(s.shape,"float32"),$=r.bufferSync(o);for(let O=0;O<c.batchSize;++O)for(let V=0;V<c.inChannels;++V)for(let K=0;K<c.inDepth;++K)for(let X=0;X<c.inHeight;++X)for(let W=0;W<c.inWidth;++W){let H=K-S,Y=X-N,Z=W-k,Q=0;for(let se=0;se<b;se+=g){let ne=(H+se)/d;if(!(ne<0||ne>=c.outDepth||Math.floor(ne)!==ne))for(let re=0;re<v;re+=x){let ue=(Y+re)/m;if(!(ue<0||ue>=c.outHeight||Math.floor(ue)!==ue))for(let ae=0;ae<C;ae+=y){let le=(Z+ae)/h;if(le<0||le>=c.outWidth||Math.floor(le)!==le)continue;let me=b*v*C-1-f.get(O,ne,ue,le,V),ke=se*v*C+re*C+ae,ve=me===ke?1:0;if(ve===0)continue;let Te=$.get(O,ne,ue,le,V);Q+=Te*ve}}}D.set(Q,O,K,X,W,V)}return r.makeTensorInfo(D.shape,D.dtype,D.values)}var kV={kernelName:im,backendName:"cpu",kernelFunc:dle};function mle(t){let{inputs:e,backend:r,attrs:n}=t,{dy:o,input:s,output:i}=e,a=s;ee([s,i],"maxPoolGrad");let{filterSize:l,strides:u,pad:c,dimRoundingMode:p}=n,f=T.computePool2DInfo(a.shape,l,u,1,c,p),d=r.data.get(a.dataId).values,m=Ee(f.outShape,a.dtype,mC(d,a.shape,a.dtype,f).values),h=f.strideHeight,g=f.strideWidth,x=f.dilationHeight,y=f.dilationWidth,b=f.effectiveFilterHeight,v=f.effectiveFilterWidth,C=v-1-f.padInfo.left,S=b-1-f.padInfo.top,k=Ee(a.shape,"float32"),N=r.data.get(o.dataId).values,D=Ee(o.shape,"float32",N);for(let $=0;$<f.batchSize;++$)for(let O=0;O<f.inChannels;++O)for(let V=0;V<f.inHeight;++V)for(let K=0;K<f.inWidth;++K){let X=V-S,W=K-C,H=0;for(let Y=0;Y<b;Y+=x){let Z=(X+Y)/h;if(!(Z<0||Z>=f.outHeight||Math.floor(Z)!==Z))for(let Q=0;Q<v;Q+=y){let se=(W+Q)/g;if(se<0||se>=f.outWidth||Math.floor(se)!==se)continue;let ne=b*v-1-m.get($,Z,se,O),re=Y*v+Q,ue=ne===re?1:0;if(ue===0)continue;let ae=D.get($,Z,se,O);H+=ae*ue}}k.set(H,$,V,K,O)}return r.makeTensorInfo(k.shape,k.dtype,k.values)}var TV={kernelName:sm,backendName:"cpu",kernelFunc:mle};function NV(t,e,r,n,o){let s=w.computeStrides(e),i=_h(t,e,r,s,o,"max"),a=mC(t,e,r,o,!0,n);return[i.values,a.values]}var IV={kernelName:Bv,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:r})=>{let{x:n}=t,{filterSize:o,strides:s,pad:i,includeBatchInIndex:a}=e,l=r;ee(n,"MaxPoolWithArgmax");let u=l.data.get(n.dataId).values,c=T.computePool2DInfo(n.shape,o,s,[1,1],i),[p,f]=NV(u,n.shape,n.dtype,a,c),d=l.write(p,c.outShape,n.dtype),m=l.write(f,c.outShape,n.dtype);return[{dataId:d,shape:c.outShape,dtype:n.dtype},{dataId:m,shape:c.outShape,dtype:"int32"}]}};function hle(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{axis:s,keepDims:i}=n,a=w.parseAxisParam(s,o.shape),u=T.computeOutAndReduceShapes(o.shape,a)[1],c=w.sizeFromShape(u),p=[],f=r.makeTensorInfo([],"float32",new Float32Array([c]));p.push(f);let d=Ds({inputs:{x:o},backend:r,attrs:{dtype:"float32"}});p.push(d);let m=_0({inputs:{a:d,b:f},backend:r});p.push(m);let h=Ol({inputs:{x:m},backend:r,attrs:{axis:s,keepDims:i}});return p.forEach(g=>r.disposeIntermediateTensorInfo(g)),h}var EV={kernelName:Wu,backendName:"cpu",kernelFunc:hle};function gle(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{axis:s,keepDims:i}=n;ee(o,"min");let a=w.parseAxisParam(s,o.shape),l=a,u=T.getAxesPermutation(l,o.shape.length),c=o;u!=null&&(c=Yt({inputs:{x:o},backend:r,attrs:{perm:u}}),l=T.getInnerMostAxes(l.length,o.shape.length)),T.assertAxesAreInnerMostDims("min",l,c.shape.length);let[p,f]=T.computeOutAndReduceShapes(c.shape,l),d=w.sizeFromShape(f),m=w.makeZerosTypedArray(w.sizeFromShape(p),c.dtype),h=r.data.get(c.dataId).values;for(let x=0;x<m.length;++x){let y=x*d,b=h[y];for(let v=0;v<d;++v){let C=h[y+v];(Number.isNaN(C)||C<b)&&(b=C)}m[x]=b}u!=null&&r.disposeIntermediateTensorInfo(c);let g=r.makeTensorInfo(p,c.dtype,m);if(i){let x=T.expandShapeToKeepDim(p,a),y=Je({inputs:{x:g},backend:r,attrs:{shape:x}});return r.disposeIntermediateTensorInfo(g),y}return g}var _V={kernelName:Gu,backendName:"cpu",kernelFunc:gle};function xle(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{paddings:s,mode:i}=n;ee(o,"mirrorPad");let a=s.map((b,v)=>b[0]+o.shape[v]+b[1]),l=s.map(b=>b[0]),u=s.map((b,v)=>b[0]+o.shape[v]),c=i==="reflect"?0:1,p=r.data.get(o.dataId).values,f=o.shape.length,d=w.computeStrides(o.shape),m=w.sizeFromShape(a),h=a.length,g=w.computeStrides(a),x=w.getTypedArrayFromDType(o.dtype,m);for(let b=0;b<m;b++){let v=w.indexToLoc(b,h,g);for(let S=0;S<h;S++)v[S]<l[S]?v[S]=l[S]*2-v[S]-c:v[S]>=u[S]&&(v[S]=(u[S]-1)*2-v[S]+c);v=v.map((S,k)=>S-l[k]);let C=w.locToIndex(v,f,d);x[b]=p[C]}return{dataId:r.write(x,a,o.dtype),shape:a,dtype:o.dtype}}var AV={kernelName:Uu,backendName:"cpu",kernelFunc:xle};var yle=tt((t,e)=>{let r=t%e;return t<0&&e<0||t>=0&&e>=0?r:(r+e)%e}),ble=it(qa,yle),DV={kernelName:qa,backendName:"cpu",kernelFunc:ble};var RV=rt(zx());function D_(t){let{inputs:e,backend:r,attrs:n}=t,{logits:o}=e,{dim:s}=n,i=o.shape.length,a=s;if(a===-1&&(a=i-1),a!==i-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${i} and dim was ${a}`);let l=w.parseAxisParam([a],o.shape),u=A_({inputs:{x:o},backend:r,attrs:{reductionIndices:l,keepDims:!1}}),c=T.expandShapeToKeepDim(u.shape,l),p=Je({inputs:{x:u},backend:r,attrs:{shape:c}}),f=I0({inputs:{a:o,b:p},backend:r}),d=t_({inputs:{x:f},backend:r}),m=Ol({inputs:{x:d},backend:r,attrs:{axis:l,keepDims:!1}}),h=Je({inputs:{x:m},backend:r,attrs:{shape:c}}),g=_0({inputs:{a:d,b:h},backend:r});return r.disposeIntermediateTensorInfo(u),r.disposeIntermediateTensorInfo(p),r.disposeIntermediateTensorInfo(f),r.disposeIntermediateTensorInfo(d),r.disposeIntermediateTensorInfo(m),r.disposeIntermediateTensorInfo(h),g}var $V={kernelName:ac,backendName:"cpu",kernelFunc:D_};function vle(t){let{inputs:e,backend:r,attrs:n}=t,{logits:o}=e,{numSamples:s,seed:i,normalized:a}=n;ee(o,"multinomial");let l=a?o:D_({inputs:{logits:o},backend:r,attrs:{dim:-1}}),u=l.shape[0],c=l.shape[1],p=r.data.get(l.dataId).values,f=[u,s],d=w.makeZerosTypedArray(w.sizeFromShape(f),"int32");for(let m=0;m<u;++m){let h=m*c,g=new Float32Array(c-1);g[0]=p[h];for(let b=1;b<g.length;++b)g[b]=g[b-1]+p[h+b];let x=RV.alea(i.toString()),y=m*s;for(let b=0;b<s;++b){let v=x();d[y+b]=g.length;for(let C=0;C<g.length;C++)if(v<g[C]){d[y+b]=C;break}}}return a||r.disposeIntermediateTensorInfo(l),r.makeTensorInfo(f,"int32",d)}var OV={kernelName:Vv,backendName:"cpu",kernelFunc:vle};var wle=vn.nonMaxSuppressionV3Impl;function Cle(t){let{inputs:e,backend:r,attrs:n}=t,{boxes:o,scores:s}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l}=n;ee(o,"NonMaxSuppression");let u=r.data.get(o.dataId).values,c=r.data.get(s.dataId).values,{selectedIndices:p}=wle(u,c,i,a,l);return r.makeTensorInfo([p.length],"int32",new Int32Array(p))}var FV={kernelName:am,backendName:"cpu",kernelFunc:Cle};var Sle=vn.nonMaxSuppressionV4Impl;function kle(t){let{inputs:e,backend:r,attrs:n}=t,{boxes:o,scores:s}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:u}=n;ee(o,"NonMaxSuppressionPadded");let c=r.data.get(o.dataId).values,p=r.data.get(s.dataId).values,{selectedIndices:f,validOutputs:d}=Sle(c,p,i,a,l,u);return[r.makeTensorInfo([f.length],"int32",new Int32Array(f)),r.makeTensorInfo([],"int32",new Int32Array([d]))]}var PV={kernelName:lm,backendName:"cpu",kernelFunc:kle};var Tle=vn.nonMaxSuppressionV5Impl;function Nle(t){let{inputs:e,backend:r,attrs:n}=t,{boxes:o,scores:s}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,softNmsSigma:u}=n;ee(o,"NonMaxSuppressionWithScore");let c=r.data.get(o.dataId).values,p=r.data.get(s.dataId).values,f=i,d=a,m=l,h=u,{selectedIndices:g,selectedScores:x}=Tle(c,p,f,d,m,h);return[r.makeTensorInfo([g.length],"int32",new Int32Array(g)),r.makeTensorInfo([x.length],"float32",new Float32Array(x))]}var LV={kernelName:um,backendName:"cpu",kernelFunc:Nle};function Ile(t){let{inputs:e,backend:r,attrs:n}=t,{indices:o}=e,{dtype:s,depth:i,onValue:a,offValue:l}=n;ee(o,"oneHot");let u=w.sizeFromShape(o.shape),c=new Float32Array(u*i);c.fill(l);let p=r.data.get(o.dataId).values;for(let f=0;f<u;++f)p[f]>=0&&p[f]<i&&(c[f*i+p[f]]=a);return r.makeTensorInfo([...o.shape,i],s,c)}var MV={kernelName:ju,backendName:"cpu",kernelFunc:Ile};function $0(t){let{inputs:e,backend:r}=t,{x:n}=e;if(n.dtype==="string")throw new Error("zerosLike is not supported for string tensors");if(n.dtype==="complex64"){let o=As({inputs:{input:n},backend:r}),s=$0({inputs:{x:o},backend:r}),i=Qi({inputs:{input:n},backend:r}),a=$0({inputs:{x:i},backend:r}),l=Mr({inputs:{real:s,imag:a},backend:r});return r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(a),l}else return D0({backend:r,attrs:{shape:n.shape,value:0,dtype:n.dtype}})}var zV={kernelName:cc,backendName:"cpu",kernelFunc:$0};function BV(t){let{inputs:e,backend:r}=t,{x:n}=e;if(n.dtype==="string")throw new Error("onesLike is not supported for string tensors");if(n.dtype==="complex64"){let o=As({inputs:{input:n},backend:r}),s=BV({inputs:{x:o},backend:r}),i=Qi({inputs:{input:n},backend:r}),a=$0({inputs:{x:i},backend:r}),l=Mr({inputs:{real:s,imag:a},backend:r});return r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(a),l}else return D0({backend:r,attrs:{shape:n.shape,value:1,dtype:n.dtype}})}var VV={kernelName:qu,backendName:"cpu",kernelFunc:BV};function $_(t){let{inputs:e,backend:r,attrs:n}=t,{axis:o}=n;if(e.length===1)return Ah({inputs:{input:e[0]},backend:r,attrs:{dim:o}});let s=e[0].shape,i=e[0].dtype;e.forEach(c=>{w.assertShapesMatch(s,c.shape,"All tensors passed to stack must have matching shapes"),w.assert(i===c.dtype,()=>"All tensors passed to stack must have matching dtypes")});let a=[],l=e.map(c=>{let p=Ah({inputs:{input:c},backend:r,attrs:{dim:o}});return a.push(p),p}),u=_c({inputs:l,backend:r,attrs:{axis:o}});return a.forEach(c=>r.disposeIntermediateTensorInfo(c)),u}var WV={kernelName:Ku,backendName:"cpu",kernelFunc:$_};function Ele(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{paddings:s,constantValue:i}=n;ee(o,"pad");let a=s.map((y,b)=>y[0]+o.shape[b]+y[1]),l=s.map(y=>y[0]),u=r.data.get(o.dataId).values,c=w.sizeFromShape(o.shape),p=o.shape.length,f=w.computeStrides(o.shape),d=w.sizeFromShape(a),m=a.length,h=w.computeStrides(a),g=w.getTypedArrayFromDType(o.dtype,d);i!==0&&g.fill(i);for(let y=0;y<c;y++){let v=w.indexToLoc(y,p,f).map((S,k)=>S+l[k]),C=w.locToIndex(v,m,h);g[C]=u[y]}return{dataId:r.write(g,a,o.dtype),shape:a,dtype:o.dtype}}var xC={kernelName:Xu,backendName:"cpu",kernelFunc:Ele};var _le=tt((t,e)=>Math.pow(t,e)),Ale=it(Ka,_le),GV={kernelName:Ka,backendName:"cpu",kernelFunc:Ale};function Dle(t){let{inputs:e,backend:r,attrs:n}=t,{paramsNestedSplits:o,paramsDenseValues:s,indices:i}=e,{outputRaggedRank:a}=n,l=o.map(x=>r.data.get(x.dataId).values),u=o.map(x=>x.shape),c=r.data.get(s.dataId).values,p=r.data.get(i.dataId).values,[f,d,m]=tC(l,u,c,s.shape,s.dtype,p,i.shape,a),h=f.map(x=>r.makeTensorInfo([x.length],"int32",x)),g=r.makeTensorInfo(m,s.dtype,d);return h.concat([g])}var UV={kernelName:Wv,backendName:"cpu",kernelFunc:Dle};function $le(t){let{inputs:e,backend:r}=t,{starts:n,limits:o,deltas:s}=e,i=r.data.get(n.dataId).values,a=r.data.get(o.dataId).values,l=r.data.get(s.dataId).values,[u,c]=rC(i,n.shape,n.dtype,a,o.shape,l,s.shape),p=r.makeTensorInfo([u.length],"int32",u),f=r.makeTensorInfo([c.length],n.dtype,c);return[p,f]}var HV={kernelName:Gv,backendName:"cpu",kernelFunc:$le};function Rle(t){let{inputs:e,backend:r,attrs:n}=t,{shape:o,values:s,defaultValue:i,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=n,u=r.data.get(o.dataId).values,c=r.data.get(s.dataId).values,p=r.data.get(i.dataId).values,f=a.map(g=>r.data.get(g.dataId).values),d=a.map(g=>g.shape),[m,h]=nC(u,o.shape,c,s.shape,s.dtype,p,i.shape,f,d,l);return r.makeTensorInfo(m,s.dtype,h)}var qV={kernelName:Uv,backendName:"cpu",kernelFunc:Rle};function Ole(t){let{backend:e,attrs:r}=t,{start:n,stop:o,dtype:s,step:i}=r,a=oC(n,o,i,s);return e.makeTensorInfo([a.length],s,a)}var jV={kernelName:cm,backendName:"cpu",kernelFunc:Ole};var Fle=Le(Xa,t=>1/t),KV={kernelName:Xa,backendName:"cpu",kernelFunc:Fle};function Ple(t){let{inputs:e,backend:r,attrs:n}=t,{images:o}=e,{alignCorners:s,halfPixelCenters:i,size:a}=n;ee(o,"resizeBilinear");let l=w.computeStrides(o.shape),[u,c]=a,[p,f,d,m]=o.shape,h=r.data.get(o.dataId).values,g=new Float32Array(w.sizeFromShape([p,u,c,m])),x=[s&&u>1?f-1:f,s&&c>1?d-1:d],y=[s&&u>1?u-1:u,s&&c>1?c-1:c],b=0,v=x[0]/y[0],C=x[1]/y[1];for(let S=0;S<p;S++)for(let k=0;k<u;k++){let N;i?N=v*(k+.5)-.5:N=v*k;let D=Math.max(0,Math.floor(N)),$=N-D,O=Math.min(f-1,Math.ceil(N)),V=S*l[0]+D*l[1],K=S*l[0]+O*l[1];for(let X=0;X<c;X++){let W;i?W=C*(X+.5)-.5:W=C*X;let H=Math.max(0,Math.floor(W)),Y=W-H,Z=Math.min(d-1,Math.ceil(W)),Q=V+H*l[2],se=K+H*l[2],ne=V+Z*l[2],re=K+Z*l[2];for(let ue=0;ue<m;ue++){let ae=h[Q+ue],le=h[se+ue],me=h[ne+ue],ke=h[re+ue],ve=ae+(me-ae)*Y,Te=le+(ke-le)*Y,Ve=ve+(Te-ve)*$;g[b++]=Ve}}}return r.makeTensorInfo([p,u,c,m],"float32",g)}var XV={kernelName:ec,backendName:"cpu",kernelFunc:Ple};function Lle(t){let{inputs:e,backend:r,attrs:n}=t,{images:o,dy:s}=e,{alignCorners:i}=n;ee([s,o],"resizeBilinearGrad");let a=w.computeStrides(o.shape),[l,u,c,p]=o.shape,[,f,d]=s.shape,m=new Float32Array(l*u*c*p),h=[i&&f>1?u-1:u,i&&d>1?c-1:c],g=[i&&f>1?f-1:f,i&&d>1?d-1:d],x=h[0]/g[0],y=h[1]/g[1],b=r.data.get(s.dataId).values,v=0;for(let C=0;C<l;C++){let S=C*a[0];for(let k=0;k<f;k++){let N=k*x,D=Math.floor(N),$=Math.min(Math.ceil(N),u-1),O=S+D*a[1],V=S+$*a[1],K=N-D,X=1-K;for(let W=0;W<d;W++){let H=W*y,Y=Math.floor(H),Z=Math.min(Math.ceil(H),c-1),Q=H-Y,se=1-Q,ne=O+Y*a[2],re=O+Z*a[2],ue=V+Y*a[2],ae=V+Z*a[2],le=X*se,me=X*Q,ke=K*se,ve=K*Q;for(let Te=0;Te<p;Te++){let Ve=b[v++];m[ne+Te]+=Ve*le,m[re+Te]+=Ve*me,m[ue+Te]+=Ve*ke,m[ae+Te]+=Ve*ve}}}}return r.makeTensorInfo([l,c,u,p],"float32",m)}var YV={kernelName:dm,backendName:"cpu",kernelFunc:Lle};function Mle(t){let{inputs:e,backend:r,attrs:n}=t,{images:o}=e,{alignCorners:s,halfPixelCenters:i,size:a}=n;ee(o,"resizeNearestNeighbor");let l=w.computeStrides(o.shape),[u,c]=a,[p,f,d,m]=o.shape,h=r.data.get(o.dataId).values,g=new Float32Array(p*u*c*m),x=[s&&u>1?f-1:f,s&&c>1?d-1:d],y=[s&&u>1?u-1:u,s&&c>1?c-1:c],b=x[0]/y[0],v=x[1]/y[1],C=0;for(let S=0;S<p;S++){let k=S*l[0];for(let N=0;N<u;N++){let D=i?b*(N+.5):b*N,$=Math.min(f-1,s?Math.round(D):Math.floor(D));i&&($=Math.max(0,$));let O=k+$*l[1];for(let V=0;V<c;V++){let K=i?v*(V+.5):v*V,X=Math.min(d-1,s?Math.round(K):Math.floor(K));i&&(X=Math.max(0,X));let W=O+X*l[2];for(let H=0;H<m;H++){let Y=h[W+H];g[C++]=Y}}}}return r.makeTensorInfo([p,u,c,m],o.dtype,g)}var QV={kernelName:Ju,backendName:"cpu",kernelFunc:Mle};function zle(t){let{inputs:e,backend:r,attrs:n}=t,{images:o,dy:s}=e,{alignCorners:i}=n;ee([s,o],"resizeNearestNeighborGrad");let a=w.computeStrides(o.shape),l=w.computeStrides(s.shape),[u,c,p,f]=o.shape,[,d,m]=s.shape,h=new Float32Array(u*c*p*f),g=r.data.get(s.dataId).values,x=[i&&d>1?c-1:c,i&&m>1?p-1:p],y=[i&&d>1?d-1:d,i&&m>1?m-1:m],b=x[0]/y[0],v=x[1]/y[1],C=1/b,S=1/v,k=Math.ceil(C)*2+2,N=Math.ceil(S)*2+2;for(let D=0;D<u;D++){let $=D*a[0];for(let O=0;O<c;O++){let V=$+O*a[1],K=Math.floor(O*C),X=Math.floor(K-k/2);for(let W=0;W<p;W++){let H=V+W*a[2],Y=Math.floor(W*S),Z=Math.floor(Y-N/2);for(let Q=0;Q<f;Q++){let se=0;for(let ne=0;ne<k;ne++){let re=ne+X;if(re<0||re>=d)continue;let ue=$+re*l[1],ae=re*b,le=Math.min(c-1,i?Math.round(ae):Math.floor(ae));if(O===le)for(let me=0;me<N;me++){let ke=me+Z;if(ke<0||ke>=m)continue;let ve=ue+ke*l[2],Te=ke*v,Ve=Math.min(p-1,i?Math.round(Te):Math.floor(Te));W===Ve&&(se+=g[ve+Q])}}h[H+Q]=se}}}}return r.makeTensorInfo(o.shape,o.dtype,h)}var ZV={kernelName:fm,backendName:"cpu",kernelFunc:zle};function Ble(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{dims:s}=n;ee(o,"reverse");let i=o.shape.length,a=w.parseAxisParam(s,o.shape);if(i===0)return Cn({inputs:{x:o},backend:r});let l=new vt(o.shape,o.dtype),u=r.bufferSync(o);for(let c=0;c<l.size;c++){let p=l.indexToLoc(c),f=p.slice();a.forEach(d=>f[d]=o.shape[d]-1-f[d]),l.set(u.get(...f),...p)}return r.makeTensorInfo(l.shape,l.dtype,l.values)}var JV={kernelName:tc,backendName:"cpu",kernelFunc:Ble};var e5={kernelName:bm,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:r})=>{let{image:n}=t,{radians:o,fillValue:s,center:i}=e,a=r,l=w.getTypedArrayFromDType(n.dtype,w.sizeFromShape(n.shape)),[u,c,p,f]=n.shape,[d,m]=T.getImageCenter(i,c,p),h=255,g=Math.sin(o),x=Math.cos(o),y=a.data.get(n.dataId).values;for(let v=0;v<u;v++){let C=v*p*c*f;for(let S=0;S<c;S++){let k=S*(p*f);for(let N=0;N<p;N++){let D=N*f;for(let $=0;$<f;$++){let O=[u,S,N,$],V=O[2],K=O[1],X=(V-d)*x-(K-m)*g,W=(V-d)*g+(K-m)*x;X=Math.round(X+d),W=Math.round(W+m);let H=s;if(typeof s!="number"&&($===3?H=h:H=s[$]),X>=0&&X<p&&W>=0&&W<c){let Z=W*(p*f),Q=X*f,se=C+Z+Q+$;H=y[se]}let Y=C+k+D+$;l[Y]=H}}}}return{dataId:a.write(l,n.shape,n.dtype),shape:n.shape,dtype:n.dtype}}};var Vle=Le(Za,t=>{let e=Math.floor(t);return t-e<.5?Math.floor(t):t-e>.5?Math.ceil(t):e%2===0?e:e+1}),t5={kernelName:Za,backendName:"cpu",kernelFunc:Vle};function Wle(t){let{inputs:e,backend:r,attrs:n}=t,{indices:o,updates:s}=e,{shape:i}=n,{sliceRank:a,numUpdates:l,sliceSize:u,strides:c,outputSize:p}=T.calculateShapes(s,o,i),f=!0,d=r.bufferSync(o),m=r.bufferSync(s),h=Rl(d,m,i,p,u,l,a,c,0,f);return r.makeTensorInfo(i,h.dtype,h.values)}var r5={kernelName:Hv,backendName:"cpu",kernelFunc:Wle};function Gle(t,e){let r=0,n=t.length,o=0;for(;r<n;)o=Math.floor((r+n)/2),t[o]<e?r=o+1:n=o;return n}function Ule(t,e){let r=0,n=t.length,o=0;for(;r<n;)o=Math.floor((r+n)/2),t[o]<=e?r=o+1:n=o;return n}function n5(t,e,r,n,o,s){let i=w.getArrayFromDType("int32",r*o);for(let a=0;a<r;++a){let l=t.slice(a*n,(a+1)*n),u=a*o;for(let c=0;c<o;++c)i[u+c]=s==="left"?Gle(l,e[c+u]):Ule(l,e[c+u])}return i}function Hle(t){let{inputs:e,backend:r,attrs:n}=t,{sortedSequence:o,values:s}=e,{side:i}=n,a=r.data.get(o.dataId).values,l=r.data.get(s.dataId).values,u=n5(a,l,o.shape[0],o.shape[1],s.shape[1],i);return r.makeTensorInfo(s.shape,"int32",u)}var o5={kernelName:qv,backendName:"cpu",kernelFunc:Hle};function qle(t){let{inputs:e,backend:r}=t,{condition:n,t:o,e:s}=e;ee([n,o,s],"select");let i=n.shape.length,a=r.data.get(n.dataId).values,l=r.data.get(o.dataId).values,u=r.data.get(s.dataId).values,c=wr(o.dtype,s.dtype),p=w.makeZerosTypedArray(w.sizeFromShape(o.shape),c),f=0,d=i===0||i>1||o.shape.length===1?1:w.sizeFromShape(o.shape.slice(1));for(let m=0;m<a.length;m++)for(let h=0;h<d;h++)a[m]===1?p[f++]=l[m]:p[f++]=u[m];return r.makeTensorInfo(o.shape,c,p)}var s5={kernelName:rc,backendName:"cpu",kernelFunc:qle};var jle=T.SELU_SCALEALPHA,Kle=T.SELU_SCALE,Xle=Le(el,t=>t>=0?Kle*t:jle*(Math.exp(t)-1)),i5={kernelName:el,backendName:"cpu",kernelFunc:Xle};var Yle=Le(nl,t=>t<0?-1:t>0?1:0),a5={kernelName:nl,backendName:"cpu",kernelFunc:Yle};var Qle=Le(tl,t=>Math.sin(t)),l5={kernelName:tl,backendName:"cpu",kernelFunc:Qle};var Zle=Le(rl,t=>Math.sinh(t)),u5={kernelName:rl,backendName:"cpu",kernelFunc:Zle};var Jle=11920928955078125e-23,c5=Math.log(Jle)+2,eue=Le(sl,t=>{let e=t>-c5,r=t<c5,n=Math.exp(t),o;return r?o=n:e?o=t:o=Math.log(1+n),o}),p5={kernelName:sl,backendName:"cpu",kernelFunc:eue};function tue(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{blockShape:s,paddings:i}=n;ee([o],"spaceToBatchND");let a=w.sizeFromShape(s),l=[[0,0]];l.push(...i);for(let S=1+s.length;S<o.shape.length;++S)l.push([0,0]);let u=xC.kernelFunc({inputs:{x:o},backend:r,attrs:{paddings:l,constantValue:0}}),c=T.getReshaped(u.shape,s,a,!1),p=T.getPermuted(c.length,s.length,!1),f=T.getReshapedPermuted(u.shape,s,a,!1),h=Je({inputs:{x:u},backend:r,attrs:{shape:c}}),y=Yt({inputs:{x:h},backend:r,attrs:{perm:p}}),C=Je({inputs:{x:y},backend:r,attrs:{shape:f}});return r.disposeIntermediateTensorInfo(u),r.disposeIntermediateTensorInfo(h),r.disposeIntermediateTensorInfo(y),C}var f5={kernelName:sc,backendName:"cpu",kernelFunc:tue};function rue(t){let{inputs:e,backend:r}=t,{indices:n,values:o,denseShape:s,defaultValue:i}=e;if(s.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
        ${s.shape}`);if(n.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
        ${n.shape}`);if(o.shape.length!==1)throw new Error(`Values must be a vector, saw:
        ${o.shape}`);if(i.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${i.shape}`);let a=r.data.get(n.dataId).values,l=r.data.get(o.dataId).values,u=r.data.get(s.dataId).values,c=r.data.get(i.dataId).values[0],[p,f,d,m,h]=sC(a,n.shape,n.dtype,l,o.dtype,u,c);return[r.makeTensorInfo(f,n.dtype,p),r.makeTensorInfo([f[0]],o.dtype,d),r.makeTensorInfo([m.length],"bool",new Uint8Array(m.map(g=>Number(g)))),r.makeTensorInfo([h.length],n.dtype,new Int32Array(h))]}var d5={kernelName:jv,backendName:"cpu",kernelFunc:rue};function nue(t){let{inputs:e,backend:r}=t,{inputIndices:n,inputShape:o,newShape:s}=e;if(n.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape
        ${n.shape}`);if(o.shape.length!==1)throw new Error(`Input shape should be a vector but received shape
        ${o.shape}`);if(s.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${s.shape}`);let i=Array.from(r.data.get(o.dataId).values),a=r.data.get(n.dataId).values,l=Array.from(r.data.get(s.dataId).values),[u,c,p]=iC(a,n.shape,n.dtype,i,l);return[r.makeTensorInfo(c,n.dtype,u),r.makeTensorInfo([p.length],s.dtype,new Int32Array(p))]}var m5={kernelName:Kv,backendName:"cpu",kernelFunc:nue};function oue(t){let{inputs:e,backend:r}=t,{data:n,indices:o,segmentIds:s}=e;if(n.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.shape.length!==1)throw new Error(`Indices should be a vector but received shape
          ${o.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
          ${s.shape}`);if(o.shape[0]!==s.shape[0])throw new Error("segmentIds and indices should have same size.");let i=r.data.get(n.dataId).values,a=r.data.get(o.dataId).values,l=r.data.get(s.dataId).values,[u,c]=Eh(i,n.shape,n.dtype,a,l,!0);return r.makeTensorInfo(c,n.dtype,u)}var h5={kernelName:Xv,backendName:"cpu",kernelFunc:oue};function sue(t){let{inputs:e,backend:r}=t,{data:n,indices:o,segmentIds:s}=e;if(n.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.shape.length!==1)throw new Error(`Indices should be a vector but received shape
         ${o.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
         ${s.shape}`);if(o.shape[0]!==s.shape[0])throw new Error("segmentIds and indices should have same size.");let i=r.data.get(n.dataId).values,a=r.data.get(o.dataId).values,l=r.data.get(s.dataId).values,[u,c]=Eh(i,n.shape,n.dtype,a,l);return r.makeTensorInfo(c,n.dtype,u)}var g5={kernelName:Yv,backendName:"cpu",kernelFunc:sue};function iue(t){let{inputs:e,backend:r,attrs:n}=t,{sparseIndices:o,sparseValues:s,defaultValue:i}=e,{outputShape:a}=n,{sliceRank:l,numUpdates:u,sliceSize:c,strides:p,outputSize:f}=T.calculateShapes(s,o,a),d=!1,m=r.bufferSync(o),h;switch(s.dtype){case"bool":{let g=r.bufferSync(s),x=Boolean(r.data.get(i.dataId).values[0]);h=Rl(m,g,a,f,c,u,l,p,x,d);break}case"float32":{let g=r.bufferSync(s),x=r.data.get(i.dataId).values[0];h=Rl(m,g,a,f,c,u,l,p,x,d);break}case"int32":{let g=r.bufferSync(s),x=r.data.get(i.dataId).values[0];h=Rl(m,g,a,f,c,u,l,p,x,d);break}case"string":{let g=r.bufferSync(s),x=w.decodeString(r.data.get(i.dataId).values[0]);h=Rl(m,g,a,f,c,u,l,p,x,d);break}default:throw new Error(`Unsupported type ${s.dtype}`)}return r.makeTensorInfo(a,h.dtype,h.values)}var x5={kernelName:Qv,backendName:"cpu",kernelFunc:iue};function aue(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{numOrSizeSplits:s,axis:i}=n,a=w.parseAxisParam(i,o.shape)[0],l=T.prepareSplitSize(o,s,a),u=new Array(o.shape.length).fill(0),c=o.shape.slice();return l.map(p=>{let f=[...c];f[a]=p;let d=Os({inputs:{x:o},backend:r,attrs:{begin:u,size:f}});return u[a]+=p,d})}var y5={kernelName:ic,backendName:"cpu",kernelFunc:aue};var b5={kernelName:mm,backendName:"cpu",kernelFunc:({inputs:t,backend:e})=>{let{x:r}=t,n=e;ee(r,"square");let o=n.data.get(r.dataId).values,s=new Float32Array(o.length);for(let a=0;a<o.length;++a){let l=o[a];s[a]=l*l}return{dataId:n.write(s,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}};var lue=Le(pl,(t,e)=>{let r=e;return isNaN(t)?NaN:t>0?1:r.alpha}),v5={kernelName:pl,backendName:"cpu",kernelFunc:lue};function uue(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{begin:s,end:i,strides:a,beginMask:l,endMask:u,ellipsisMask:c,newAxisMask:p,shrinkAxisMask:f}=n;ee(o,"stridedSlice");let{finalShapeSparse:d,finalShape:m,isIdentity:h,sliceDim0:g,isSimpleSlice:x,begin:y,end:b,strides:v}=Ur.sliceInfo(o.shape,s,i,a,l,u,c,p,f),C;if(h)C=Je({inputs:{x:o},backend:r,attrs:{shape:m}});else if(g||x){w.assert(o.shape.length>=1,()=>`Input must have rank at least 1, got: ${o.shape.length}`);let S=Ur.computeOutShape(y,b,v),k=Os({inputs:{x:o},backend:r,attrs:{begin:y,size:S}});C=Je({inputs:{x:k},backend:r,attrs:{shape:m}}),r.disposeIntermediateTensorInfo(k)}else{let S=r.bufferSync(o),k=aC(d,S,v,y);C=r.makeTensorInfo(m,k.dtype,k.values)}return C}var w5={kernelName:hm,backendName:"cpu",kernelFunc:uue};function cue(t){let{inputs:e,backend:r,attrs:n}=t,{separator:o,nGramWidths:s,leftPad:i,rightPad:a,padWidth:l,preserveShortSequences:u}=n,{data:c,dataSplits:p}=e,f=r.data.get(c.dataId).values,d=r.data.get(p.dataId).values,[m,h]=lC(f,d,o,s,i,a,l,u);return[r.makeTensorInfo([m.length],"string",m),r.makeTensorInfo(p.shape,"int32",h)]}var C5={kernelName:Zv,backendName:"cpu",kernelFunc:cue};function pue(t){let{inputs:e,backend:r,attrs:n}=t,{skipEmpty:o}=n,{input:s,delimiter:i}=e;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(s.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${s.shape}`);if(i.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${i.shape}`);let a=r.data.get(s.dataId).values,l=r.data.get(i.dataId).values[0],[u,c,p]=uC(a,l,o),f=c.length;return[r.makeTensorInfo([f,2],"int32",u),r.makeTensorInfo([f],"string",c),r.makeTensorInfo([2],"int32",new Int32Array(p))]}var S5={kernelName:Jv,backendName:"cpu",kernelFunc:pue};function fue(t){let{inputs:e,backend:r,attrs:n}=t,{numBuckets:o}=n,{input:s}=e;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(o<=0)throw new Error("Number of buckets must be at least 1");let i=r.data.get(s.dataId).values,a=cC(i,o);return r.makeTensorInfo(s.shape,"int32",a)}var k5={kernelName:e1,backendName:"cpu",kernelFunc:fue};var due=Le(ul,t=>Math.tan(t)),T5={kernelName:ul,backendName:"cpu",kernelFunc:due};var mue=Le(cl,t=>Math.tanh(t)),N5={kernelName:cl,backendName:"cpu",kernelFunc:mue};function hue(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{reps:s}=n;ee(o,"tile");let i=pC(r.bufferSync(o),s);return r.makeTensorInfo(i.shape,i.dtype,i.values)}var I5={kernelName:Fi,backendName:"cpu",kernelFunc:hue};function gue(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{k:s,sorted:i}=n;ee(o,"topk");let a=r.data.get(o.dataId).values,[l,u]=fC(a,o.shape,o.dtype,s,i);return[r.makeTensorInfo(l.shape,l.dtype,l.values),r.makeTensorInfo(u.shape,u.dtype,u.values)]}var E5={kernelName:gm,backendName:"cpu",kernelFunc:gue};function xue(t){let{inputs:e,attrs:r,backend:n}=t,{image:o,transforms:s}=e,{interpolation:i,fillMode:a,fillValue:l,outputShape:u}=r,[c,p,f,d]=o.shape,[m,h]=u??[p,f],g=[c,m,h,d],x=w.computeStrides(o.shape),y=x[0],b=x[1],v=x[2],C=w.computeStrides(g),S=C[0],k=C[1],N=C[2],D=w.getTypedArrayFromDType(o.dtype,w.sizeFromShape(g));D.fill(l);let $=n.data.get(o.dataId).values,O=n.data.get(s.dataId).values;for(let K=0;K<c;++K){let X=s.shape[0]===1?O:O.subarray(K*8,K*8+8);for(let W=0;W<m;++W)for(let H=0;H<h;++H)for(let Y=0;Y<d;++Y){let Z,Q=X[6]*H+X[7]*W+1;if(Q===0)continue;let se=(X[0]*H+X[1]*W+X[2])/Q,ne=(X[3]*H+X[4]*W+X[5])/Q,re=_5(se,f,a),ue=_5(ne,p,a);switch(i){case"nearest":Z=Cue($,p,f,y,b,v,K,ue,re,Y,l);break;case"bilinear":Z=Sue($,p,f,y,b,v,K,ue,re,Y,l);break;default:throw new Error(`Error in Transform: Expect 'nearest' or 'bilinear', but got ${i}`)}let ae=K*S+W*k+H*N+Y;D[ae]=Z}return n.makeTensorInfo(g,o.dtype,D)}return{dataId:n.write(D,g,o.dtype),shape:o.shape,dtype:o.dtype}}var A5={kernelName:xm,backendName:"cpu",kernelFunc:xue};function _5(t,e,r){switch(r){case"reflect":return yue(t,e);case"wrap":return bue(t,e);case"nearest":return wue(t,e);case"constant":default:return vue(t,e)}}function yue(t,e){let r=t;if(r<0)if(e<=1)r=0;else{let n=2*e;r<n&&(r=n*Math.trunc(-r/n)+r),r=r<-e?r+n:-r-1}else if(r>e-1)if(e<=1)r=0;else{let n=2*e;r-=n*Math.trunc(r/n),r>=e&&(r=n-r-1)}return w.clamp(0,r,e-1)}function bue(t,e){let r=t;if(r<0)if(e<=1)r=0;else{let n=e-1;r+=e*(Math.trunc(-r/n)+1)}else if(r>e-1)if(e<=1)r=0;else{let n=e-1;r-=e*Math.trunc(r/n)}return w.clamp(0,r,e-1)}function vue(t,e){return t}function wue(t,e){return w.clamp(0,t,e-1)}function R0(t,e,r,n,o,s,i,a,l,u,c){let p=i*n+a*o+l*s+u;return 0<=a&&a<e&&0<=l&&l<r?t[p]:c}function Cue(t,e,r,n,o,s,i,a,l,u,c){let p=Math.round(a),f=Math.round(l);return R0(t,e,r,n,o,s,i,p,f,u,c)}function Sue(t,e,r,n,o,s,i,a,l,u,c){let p=Math.floor(a),f=Math.floor(l),d=p+1,m=f+1,h=(m-l)*R0(t,e,r,n,o,s,i,p,f,u,c)+(l-f)*R0(t,e,r,n,o,s,i,p,m,u,c),g=(m-l)*R0(t,e,r,n,o,s,i,d,f,u,c)+(l-f)*R0(t,e,r,n,o,s,i,d,m,u,c);return(d-a)*h+(a-p)*g}function kue(t){let{inputs:e,attrs:r,backend:n}=t,{axis:o}=r,{x:s}=e;ee(s,"unique");let i=n.data.get(s.dataId).values,{outputValues:a,outputShape:l,indices:u}=dC(i,o,s.shape,s.dtype);return[n.makeTensorInfo(l,s.dtype,a),n.makeTensorInfo([u.length],"int32",u)]}var D5={kernelName:ym,backendName:"cpu",kernelFunc:kue};function Tue(t){let{inputs:e,backend:r,attrs:n}=t,{value:o}=e,{axis:s}=n;s<0&&(s+=o.shape.length);let i=o.shape.length,a=o.shape[s],l=new Array(i-1),u=0;for(let d=0;d<i;d++)d!==s&&(l[u++]=o.shape[d]);let c=new Array(i).fill(0),p=o.shape.slice();p[s]=1;let f=new Array(a);for(let d=0;d<f.length;d++){c[s]=d;let m=Os({inputs:{x:o},backend:r,attrs:{begin:c,size:p}});f[d]=Je({inputs:{x:m},backend:r,attrs:{shape:l}}),r.disposeIntermediateTensorInfo(m)}return f}var $5={kernelName:lc,backendName:"cpu",kernelFunc:Tue};function Nue(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,segmentIds:s}=e,{numSegments:i}=n;ee(o,"unsortedSegmentSum");let a=o.shape.length,l=s.shape.length,u=[],c=[],p=a-l,f=s;for(let m=0;m<p;++m){let h=Ah({inputs:{input:f},backend:r,attrs:{dim:m+1}});f=h,c.push(h)}for(let m=0;m<i;++m){let h=w.createScalarValue(m,"int32"),g=r.makeTensorInfo([],"int32",h),x=JE({inputs:{a:g,b:f},backend:r}),y=Ds({inputs:{x},backend:r,attrs:{dtype:"float32"}}),b=Tf({inputs:{a:y,b:o},backend:r}),v=Ol({inputs:{x:b},backend:r,attrs:{axis:0,keepDims:!1}});u.push(v),c.push(g),c.push(x),c.push(y),c.push(b),c.push(v)}let d=$_({inputs:u,backend:r,attrs:{axis:0}});return c.forEach(m=>r.disposeIntermediateTensorInfo(m)),d}var R5={kernelName:uc,backendName:"cpu",kernelFunc:Nue};var Iue=[s4,gB,i4,a4,wB,l4,u4,c4,p4,f4,d4,m4,h4,g4,x4,b4,v4,w4,C4,o4,S4,k4,T4,N4,vB,CB,I4,xB,E4,A4,D4,$4,R4,O4,F4,P4,L4,M4,z4,B4,V4,W4,G4,U4,H4,q4,j4,K4,X4,Y4,Z4,ZB,J4,SB,eV,kB,tV,TB,rV,nV,oV,NB,sV,iV,aV,lV,uV,IB,EB,yB,cV,_4,pV,fV,dV,JB,_B,AB,mV,DB,hV,gV,xV,yV,bV,vV,wV,$B,CV,SV,kV,TV,IV,EV,_V,RB,AV,DV,OV,OB,FB,FV,PV,LV,PB,MV,VV,WV,xC,GV,e4,MB,UV,HV,qV,jV,bB,A0,KV,t4,r4,n4,XV,YV,QV,ZV,JV,e5,t5,GB,r5,o5,s5,i5,HB,a5,l5,u5,qB,$V,p5,f5,d5,m5,h5,g5,x5,y5,KB,b5,XB,v5,w5,C5,S5,k5,YB,Q4,T5,N5,I5,E5,A5,LB,D5,$5,R5,zV];for(let t of Iue)r1(t);var If={},yC={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function O5(t,e){If[t]=e}function Ro(t,e){if(!(t in If)||e!=null){let n=_ue(t,e);if(n!==null)If[t]=n;else return console.log("Could not get context for WebGL version",t),null}let r=If[t];return r==null||r.isContextLost()?(delete If[t],Ro(t)):(r.disable(r.DEPTH_TEST),r.disable(r.STENCIL_TEST),r.disable(r.BLEND),r.disable(r.DITHER),r.disable(r.POLYGON_OFFSET_FILL),r.disable(r.SAMPLE_COVERAGE),r.enable(r.SCISSOR_TEST),r.enable(r.CULL_FACE),r.cullFace(r.BACK),If[t])}function Eue(t){if(typeof OffscreenCanvas<"u"&&t===2)return new OffscreenCanvas(300,150);if(typeof document<"u")return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function _ue(t,e){if(t!==1&&t!==2)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");let r=e??Eue(t);return r.addEventListener("webglcontextlost",n=>{n.preventDefault(),delete If[t]},!1),B().getBool("SOFTWARE_WEBGL_ENABLED")&&(yC.failIfMajorPerformanceCaveat=!1),t===1?r.getContext("webgl",yC)||r.getContext("experimental-webgl",yC):r.getContext("webgl2",yC)}var Ac;(function(t){t[t.DENSE=0]="DENSE",t[t.SHARED_BATCH=1]="SHARED_BATCH"})(Ac||(Ac={}));var Sn;(function(t){t[t.RENDER=0]="RENDER",t[t.UPLOAD=1]="UPLOAD",t[t.PIXELS=2]="PIXELS",t[t.DOWNLOAD=3]="DOWNLOAD"})(Sn||(Sn={}));var un;(function(t){t[t.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",t[t.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",t[t.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",t[t.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",t[t.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"})(un||(un={}));function Ef(t,e){return[e,t]}function F5(t,e){return t*e}function O0(t){let e=w.sizeFromShape(t),r=Math.ceil(e/4);return w.sizeToSquarishShape(r)}function Zi(t,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(t/2))]}function P5(t,e){let[r,n]=Zi(t,e);return r*n*4}function F0(t,e){let r=t,n,o,s,i,a,l,u,c,p,f;return B().getNumber("WEBGL_VERSION")===2?(n=r.R32F,o=r.R16F,s=r.RGBA16F,i=r.RGBA32F,a=r.RED,u=4,c=1,p=r.HALF_FLOAT,f=r.FLOAT,l=r.RGBA8):(n=t.RGBA,o=t.RGBA,s=t.RGBA,i=r.RGBA,a=t.RGBA,u=4,c=4,p=e!=null?e.HALF_FLOAT_OES:null,f=t.FLOAT,l=t.RGBA),{internalFormatFloat:n,internalFormatHalfFloat:o,internalFormatPackedHalfFloat:s,internalFormatPackedFloat:i,textureFormatFloat:a,downloadTextureFormat:l,downloadUnpackNumChannels:u,defaultNumChannels:c,textureTypeHalfFloat:p,textureTypeFloat:f}}function we(t,e){let r=e();return B().getBool("DEBUG")&&Aue(t),r}function Aue(t){let e=t.getError();if(e!==t.NO_ERROR)throw new Error("WebGL Error: "+Rue(t,e))}var Due=596e-10,$ue=65504;function L5(t){return!!(B().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||t===0||Due<Math.abs(t)&&Math.abs(t)<$ue)}function Rue(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function P0(t,e){return Fl(t,()=>t.getExtension(e),'Extension "'+e+'" not supported on this browser.')}function M5(t,e){let r=Fl(t,()=>t.createShader(t.VERTEX_SHADER),"Unable to create vertex WebGLShader.");if(we(t,()=>t.shaderSource(r,e)),we(t,()=>t.compileShader(r)),t.getShaderParameter(r,t.COMPILE_STATUS)===!1)throw console.log(t.getShaderInfoLog(r)),new Error("Failed to compile vertex shader.");return r}function z5(t,e){let r=Fl(t,()=>t.createShader(t.FRAGMENT_SHADER),"Unable to create fragment WebGLShader.");if(we(t,()=>t.shaderSource(r,e)),we(t,()=>t.compileShader(r)),B().get("ENGINE_COMPILE_ONLY"))return r;if(t.getShaderParameter(r,t.COMPILE_STATUS)===!1)throw L_(e,t.getShaderInfoLog(r)),new Error("Failed to compile fragment shader.");return r}var Oue=/ERROR: [0-9]+:([0-9]+):/g;function L_(t,e){let r=Oue.exec(e);if(r==null){console.log(`Couldn't parse line number in error: ${e}`),console.log(t);return}let n=+r[1],o=t.split(`
`),s=o.length.toString().length+2,i=o.map((p,f)=>w.rightPad((f+1).toString(),s)+p),a=0;for(let p=0;p<i.length;p++)a=Math.max(i[p].length,a);let l=i.slice(0,n-1),u=i.slice(n-1,n),c=i.slice(n);console.log(l.join(`
`)),console.log(e.split(`
`)[0]),console.log(`%c ${w.rightPad(u[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(c.join(`
`))}function B5(t){return Fl(t,()=>t.createProgram(),"Unable to create WebGLProgram.")}function V5(t,e){if(we(t,()=>t.linkProgram(e)),!B().get("ENGINE_COMPILE_ONLY")&&t.getProgramParameter(e,t.LINK_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function vC(t,e){if(we(t,()=>t.validateProgram(e)),t.getProgramParameter(e,t.VALIDATE_STATUS)===!1)throw console.log(t.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function W5(t,e){let r=Fl(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return we(t,()=>t.bindBuffer(t.ARRAY_BUFFER,r)),we(t,()=>t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW)),r}function G5(t,e){let r=Fl(t,()=>t.createBuffer(),"Unable to create WebGLBuffer");return we(t,()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r)),we(t,()=>t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW)),r}function U5(t){return Fl(t,()=>t.createTexture(),"Unable to create WebGLTexture.")}function H5(t,e){let r=B().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||e<=0){let n=`[${t}x${e}]`;throw new Error("Requested texture size "+n+" is invalid.")}if(t>r||e>r){let n=`[${t}x${e}]`,o=`[${r}x${r}]`;throw new Error("Requested texture size "+n+" greater than WebGL maximum on this browser / GPU "+o+".")}}function q5(t){return Fl(t,()=>t.createFramebuffer(),"Unable to create WebGLFramebuffer.")}function M_(t,e,r,n,o,s,i){let a=t.getAttribLocation(e,r);return a===-1?!1:(we(t,()=>t.bindBuffer(t.ARRAY_BUFFER,n)),we(t,()=>t.vertexAttribPointer(a,o,t.FLOAT,!1,s,i)),we(t,()=>t.enableVertexAttribArray(a)),!0)}function Fue(t,e,r){Lue(t,r),we(t,()=>t.activeTexture(t.TEXTURE0+r)),we(t,()=>t.bindTexture(t.TEXTURE_2D,e))}function j5(t,e,r){return Fl(t,()=>t.getUniformLocation(e,r),'uniform "'+r+'" not present in program.')}function K5(t,e,r){return t.getUniformLocation(e,r)}function X5(t,e,r,n){we(t,()=>Fue(t,e,n)),we(t,()=>t.uniform1i(r,n))}function wC(t,e,r){we(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,r)),we(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0))}function z_(t,e){we(t,()=>t.bindFramebuffer(t.FRAMEBUFFER,e)),we(t,()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0))}function L0(t){let e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+Pue(t,e))}function Pue(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function Fl(t,e,r){let n=we(t,()=>e());if(n==null)throw new Error(r);return n}function Lue(t,e){let r=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,n=e+t.TEXTURE0;if(n<t.TEXTURE0||n>r){let o=`[gl.TEXTURE0, gl.TEXTURE${r}]`;throw new Error(`textureUnit must be in ${o}.`)}}function Dc(t,e=2){return w.sizeFromShape(t.slice(0,t.length-e))}function $c(t){if(t.length===0)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function M0(t){let e=[1,1,1];return t.length===0||t.length===1&&t[0]===1||(e=[Dc(t),...$c(t)]),e}function Y5(t,e=!1){let r=B().getNumber("WEBGL_MAX_TEXTURE_SIZE"),n=B().getNumber("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE");n===1/0&&B().getBool("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE")&&(n=r/2),e&&(r=r*2,n=n*2,t=t.map((a,l)=>l>=t.length-2?w.nearestLargerEven(t[l]):t[l]),t.length===1&&(t=[2,t[0]])),t.length!==2&&(t=w.squeezeShape(t).newShape);let o=w.sizeFromShape(t),s=null;t.length<=1&&o<=r?s=[1,o]:t.length===2&&t[0]<=r&&t[1]<=r?s=t:t.length===3&&t[0]*t[1]<=r&&t[2]<=r?s=[t[0]*t[1],t[2]]:t.length===3&&t[0]<=r&&t[1]*t[2]<=r?s=[t[0],t[1]*t[2]]:t.length===4&&t[0]*t[1]*t[2]<=r&&t[3]<=r?s=[t[0]*t[1]*t[2],t[3]]:t.length===4&&t[0]<=r&&t[1]*t[2]*t[3]<=r&&(s=[t[0],t[1]*t[2]*t[3]]);let i=s!=null&&Math.max(...s)>n&&Math.min(...s)<=(e?2:1)&&Math.min(...s)>0;if(s==null||i)if(e){let a=Dc(t),l=2,u=2;t.length&&([l,u]=$c(t)),o=a*(l/2)*(u/2),s=w.sizeToSquarishShape(o).map(c=>c*2)}else s=w.sizeToSquarishShape(o);return s}function bC(t){return t%2===0}function _f(t,e){if(t=t.slice(-2),e=e.slice(-2),w.arraysEqual(t,e)||!t.length||!e.length||t[0]===0||t[1]===0||e[0]===0||e[1]===0)return!0;if(t.length!==e.length){let r=t.slice(-1)[0],n=e.slice(-1)[0];if(r===n||bC(r)&&bC(n)&&(t[0]===1||e[0]===1))return!0}return t[1]===e[1]&&bC(t[0])&&bC(e[0])}var O_,F_;function Q5(t){if(O_==null){let e=Ro(t);O_=e.getParameter(e.MAX_TEXTURE_SIZE)}return O_}function Z5(t){if(F_==null){let e=Ro(t);F_=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,F_)}function J5(t){if(t===0)return 0;let e,r=Ro(t);return es(r,"EXT_disjoint_timer_query_webgl2")&&t===2?e=2:es(r,"EXT_disjoint_timer_query")?e=1:e=0,e}function es(t,e){return t.getExtension(e)!=null}function B_(t){try{if(Ro(t)!=null)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function eW(t){if(t===0)return!1;let e=Ro(t);if(t===1){if(!es(e,"OES_texture_float"))return!1}else if(!es(e,"EXT_color_buffer_float"))return!1;return P_(e)}function tW(t){if(t===0)return!1;let e=Ro(t);if(t===1){if(!es(e,"OES_texture_float")||!es(e,"WEBGL_color_buffer_float"))return!1}else{if(es(e,"EXT_color_buffer_float"))return P_(e);let n="EXT_color_buffer_half_float";if(es(e,n)){let o=e.getExtension(n);return Mue(e,o)}return!1}return P_(e)}function P_(t){let e=F0(t),r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r);let n=1,o=1;t.texImage2D(t.TEXTURE_2D,0,e.internalFormatFloat,n,o,0,e.textureFormatFloat,e.textureTypeFloat,null);let s=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,s),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0);let i=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(r),t.deleteFramebuffer(s),i}function Mue(t,e){let r=F0(t,e),n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n);let o=1,s=1;t.texImage2D(t.TEXTURE_2D,0,r.internalFormatHalfFloat,o,s,0,r.textureFormatFloat,r.textureTypeHalfFloat,null);let i=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);let a=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(n),t.deleteFramebuffer(i),a}function rW(t){return t!==2?!1:Ro(t).fenceSync!=null}function Ji(t,e){Array.isArray(t)||(t=[t]),t.forEach(r=>{r!=null&&w.assert(r.dtype!=="complex64",()=>`${e} does not support complex64 tensors in the WebGL backend.`)})}var Pe=B();Pe.registerFlag("HAS_WEBGL",()=>Pe.getNumber("WEBGL_VERSION")>0);Pe.registerFlag("WEBGL_VERSION",()=>B_(2)?2:B_(1)?1:0);Pe.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",()=>!1);Pe.registerFlag("WEBGL_BUFFER_SUPPORTED",()=>Pe.get("WEBGL_VERSION")===2);Pe.registerFlag("WEBGL_CPU_FORWARD",()=>!0);Pe.registerFlag("WEBGL_FORCE_F16_TEXTURES",()=>!1);Pe.registerFlag("WEBGL_PACK",()=>Pe.getBool("HAS_WEBGL"));Pe.registerFlag("WEBGL_PACK_NORMALIZATION",()=>Pe.getBool("WEBGL_PACK"));Pe.registerFlag("WEBGL_PACK_CLIP",()=>Pe.getBool("WEBGL_PACK"));Pe.registerFlag("WEBGL_PACK_DEPTHWISECONV",()=>Pe.getBool("WEBGL_PACK"));Pe.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",()=>Pe.getBool("WEBGL_PACK"));Pe.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",()=>Pe.getBool("WEBGL_PACK"));Pe.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",()=>Pe.getBool("WEBGL_PACK"));Pe.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",()=>Pe.getBool("WEBGL_PACK"));Pe.registerFlag("WEBGL_PACK_REDUCE",()=>Pe.getBool("WEBGL_PACK"));Pe.registerFlag("WEBGL_LAZILY_UNPACK",()=>Pe.getBool("WEBGL_PACK"));Pe.registerFlag("WEBGL_CONV_IM2COL",()=>Pe.getBool("WEBGL_PACK"));Pe.registerFlag("WEBGL_MAX_TEXTURE_SIZE",()=>Q5(Pe.getNumber("WEBGL_VERSION")));Pe.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",()=>Z5(Pe.getNumber("WEBGL_VERSION")));Pe.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",()=>{let t=Pe.getNumber("WEBGL_VERSION");return t===0?0:J5(t)});Pe.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",()=>Pe.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!dc.isMobile());Pe.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",()=>eW(Pe.getNumber("WEBGL_VERSION")));Pe.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",()=>Pe.getBool("WEBGL_FORCE_F16_TEXTURES")?!1:Pe.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"));Pe.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",()=>tW(Pe.getNumber("WEBGL_VERSION")));Pe.registerFlag("WEBGL_FENCE_API_ENABLED",()=>rW(Pe.getNumber("WEBGL_VERSION")));Pe.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",()=>Pe.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0);Pe.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",()=>-1,t=>{if(t<0&&t!==-1)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${t}.`)});Pe.registerFlag("WEBGL_FLUSH_THRESHOLD",()=>dc.isMobile()?1:-1,t=>{if(t<0&&t!==-1)throw new Error(`WEBGL_FLUSH_THRESHOLD must be -1 (indicating never manual flush) or at least 0, but got ${t}.`)});Pe.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",()=>128);Pe.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",()=>!1);Pe.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",()=>1e5);Pe.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",()=>128);Pe.registerFlag("WEBGL_EXP_CONV",()=>!1);Pe.registerFlag("SOFTWARE_WEBGL_ENABLED",()=>Pe.getBool("IS_TEST"));Pe.registerFlag("WEBGL_MAX_SIZE_FOR_NARROW_TEXTURE",()=>1/0);Pe.registerFlag("WEBGL_AUTO_SQUARIFY_NARROW_TEXTURE_SHAPE",()=>!1);Pe.registerFlag("WEBGL2_ISNAN_CUSTOM",()=>!1);Pe.registerFlag("ENGINE_COMPILE_ONLY",()=>!1);function Qt(){let t,e,r,n,o,s,i,a,l,u;return B().getNumber("WEBGL_VERSION")===2?(t="#version 300 es",e="in",r="out",n="in",o="texture",s="outputColor",i="out vec4 outputColor;",a=B().getBool("WEBGL2_ISNAN_CUSTOM")?`
      bool isnan_custom(float val) {
        uint floatToUint = floatBitsToUint(val);
        return (floatToUint & 0x7fffffffu) > 0x7f800000u;
      }

      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan_custom(val.x),
          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));
      }

      #define isnan(value) isnan_custom(value)
    `:"",l="",u=`
      #define round(value) newRound(value)
      int newRound(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 newRound(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `):(t="",e="attribute",r="varying",n="varying",o="texture2D",s="gl_FragColor",i="",a=`
      #define isnan(value) isnan_custom(value)
      bool isnan_custom(float val) {
        return (val > 0. || val < 1. || val == 0.) ? false : true;
      }
      bvec4 isnan_custom(vec4 val) {
        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));
      }
    `,l=`
      uniform float INFINITY;

      bool isinf(float val) {
        return abs(val) == INFINITY;
      }
      bvec4 isinf(vec4 val) {
        return equal(abs(val), vec4(INFINITY));
      }
    `,u=`
      int round(float value) {
        return int(floor(value + 0.5));
      }

      ivec4 round(vec4 value) {
        return ivec4(floor(value + vec4(0.5)));
      }
    `),{version:t,attribute:e,varyingVs:r,varyingFs:n,texture2D:o,output:s,defineOutput:i,defineSpecialNaN:a,defineSpecialInf:l,defineRound:u}}function mi(t,e,r="index"){let n=w.computeStrides(e);return n.map((o,s)=>{let i=`int ${t[s]} = ${r} / ${o}`,a=s===n.length-1?`int ${t[s+1]} = ${r} - ${t[s]} * ${o}`:`index -= ${t[s]} * ${o}`;return`${i}; ${a};`}).join("")}function Af(t,e,r="index"){let n=w.computeStrides(e);return n.map((o,s)=>{let i=`int ${t[s]} = ${r} / outShapeStrides[${s}]`,a=s===n.length-1?`int ${t[s+1]} = ${r} - ${t[s]} * outShapeStrides[${s}]`:`index -= ${t[s]} * outShapeStrides[${s}]`;return`${i}; ${a};`}).join("")}function zue(t,e){let r=t.length,n=t.map(s=>`${e}[${s}]`),o=new Array(r-1);o[r-2]=n[r-1];for(let s=r-3;s>=0;--s)o[s]=`(${o[s+1]} * ${n[s+1]})`;return o}function nW(t,e,r="index"){let n=t.map((s,i)=>i),o=zue(n,e);return o.map((s,i)=>{let a=`int ${t[i]} = ${r} / ${o[i]}`,l=i===o.length-1?`int ${t[i+1]} = ${r} - ${t[i]} * ${o[i]}`:`index -= ${t[i]} * ${o[i]}`;return`${a}; ${l};`}).join("")}function Dh(t){let e=w.computeStrides(t).map(r=>r.toString());return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;
  }
`}function $h(){return`
  int getFlatIndex(ivec3 coords) {
    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;
  }
`}var SC=`
  const float FLOAT_MAX = 1.70141184e38;
  const float FLOAT_MIN = 1.17549435e-38;

  lowp vec4 encode_float(highp float v) {
    if (isnan(v)) {
      return vec4(255, 255, 255, 255);
    }

    highp float av = abs(v);

    if(av < FLOAT_MIN) {
      return vec4(0.0, 0.0, 0.0, 0.0);
    } else if(v > FLOAT_MAX) {
      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;
    } else if(v < -FLOAT_MAX) {
      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;
    }

    highp vec4 c = vec4(0,0,0,0);

    highp float e = floor(log2(av));
    highp float m = exp2(fract(log2(av))) - 1.0;

    c[2] = floor(128.0 * m);
    m -= c[2] / 128.0;
    c[1] = floor(32768.0 * m);
    m -= c[1] / 32768.0;
    c[0] = floor(8388608.0 * m);

    highp float ebias = e + 127.0;
    c[3] = floor(ebias / 2.0);
    ebias -= c[3] * 2.0;
    c[2] += floor(ebias) * 128.0;

    c[3] += 128.0 * step(0.0, -v);

    return c / 255.0;
  }
`;var{getBroadcastDims:oW}=T;function sW(t,e,r){let n=[];if(t.forEach(d=>{let m=w.sizeFromShape(d.shapeInfo.logicalShape);if(d.shapeInfo.isUniform?n.push(`uniform float ${d.name}${m>1?`[${m}]`:""};`):(n.push(`uniform sampler2D ${d.name};`),n.push(`uniform int offset${d.name};`)),r.enableShapeUniforms){let{uniformShape:h}=kC(r.packedInputs,d.shapeInfo.logicalShape,d.shapeInfo.texShape);switch(h.length){case 1:n.push(`uniform int ${d.name}Shape;`);break;case 2:n.push(`uniform ivec2 ${d.name}Shape;`);break;case 3:n.push(`uniform ivec3 ${d.name}Shape;`);break;case 4:n.push(`uniform ivec4 ${d.name}Shape;`);break;default:break}n.push(`uniform ivec2 ${d.name}TexShape;`)}}),r.enableShapeUniforms){switch(e.logicalShape.length){case 1:n.push("uniform int outShape;");break;case 2:n.push("uniform ivec2 outShape;"),n.push("uniform int outShapeStrides;");break;case 3:n.push("uniform ivec3 outShape;"),n.push("uniform ivec2 outShapeStrides;");break;case 4:n.push("uniform ivec4 outShape;"),n.push("uniform ivec3 outShapeStrides;");break;default:break}n.push("uniform ivec2 outTexShape;")}r.customUniforms&&r.customUniforms.forEach(d=>{n.push(`uniform ${d.type} ${d.name}${d.arrayIndex?`[${d.arrayIndex}]`:""};`)});let o=n.join(`
`),s=t.map(d=>Bue(d,e,r.packedInputs,r.enableShapeUniforms)).join(`
`),i=e.texShape,a=Qt(),l=Gue(a),u,c,p=que(a);return e.isPacked?(u=Vue(e.logicalShape,i,r.enableShapeUniforms),c=Hue(a)):(u=Wue(e.logicalShape,i,r.enableShapeUniforms),c=Uue(a)),r.packedInputs&&(p+=Yue),[p,l,c,o,u,s,r.userCode].join(`
`)}function Oh(t,e=!1){let r=t.shapeInfo.logicalShape;switch(r.length){case 0:return lce(t,e);case 1:return cce(t,e);case 2:return fce(t,e);case 3:return mce(t,e);case 4:return gce(t,e);case 5:return xce(t);case 6:return yce(t);default:throw new Error(`${r.length}-D input sampling is not yet supported`)}}function iW(t,e){switch(t.shapeInfo.logicalShape.length){case 0:return ace(t);case 1:return uce(t,e);case 2:return pce(t,e);case 3:return dce(t,e);default:return hce(t,e)}}function Bue(t,e,r=!1,n){let o="";r?o+=iW(t,n):o+=Oh(t,n);let s=t.shapeInfo.logicalShape,i=e.logicalShape;return s.length<=i.length&&(r?o+=bce(t,e):o+=vce(t,e)),o}function Vue(t,e,r){switch(t.length){case 0:return aW();case 1:return Que(t,e,r);case 2:return sce(t,e,r);case 3:return Jue(t,e,r);default:return tce(t,e,r)}}function Wue(t,e,r){switch(t.length){case 0:return aW();case 1:return Zue(t,e,r);case 2:return ice(t,e,r);case 3:return ece(t,e,r);case 4:return rce(t,e,r);case 5:return nce(t,e);case 6:return oce(t,e);default:throw new Error(`${t.length}-D output sampling is not yet supported`)}}function Gue(t){return`
    float sampleTexture(sampler2D textureSampler, vec2 uv) {
      return ${t.texture2D}(textureSampler, uv).r;
    }
  `}function Uue(t){return`
    void setOutput(float val) {
      ${t.output} = vec4(val, 0, 0, 0);
    }
  `}function Hue(t){return`
    void setOutput(vec4 val) {
      ${t.output} = val;
    }
  `}function que(t){return`${t.version}
    precision highp float;
    precision highp int;
    precision highp sampler2D;
    ${t.varyingFs} vec2 resultUV;
    ${t.defineOutput}
    const vec2 halfCR = vec2(0.5, 0.5);

    struct ivec5
    {
      int x;
      int y;
      int z;
      int w;
      int u;
    };

    struct ivec6
    {
      int x;
      int y;
      int z;
      int w;
      int u;
      int v;
    };

    uniform float NAN;
    ${t.defineSpecialNaN}
    ${t.defineSpecialInf}
    ${t.defineRound}

    int imod(int x, int y) {
      return x - y * (x / y);
    }

    int idiv(int a, int b, float sign) {
      int res = a / b;
      int mod = imod(a, b);
      if (sign < 0. && mod != 0) {
        res -= 1;
      }
      return res;
    }

    //Based on the work of Dave Hoskins
    //https://www.shadertoy.com/view/4djSRW
    #define HASHSCALE1 443.8975
    float random(float seed){
      vec2 p = resultUV * seed;
      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);
      p3 += dot(p3, p3.yzx + 19.19);
      return fract((p3.x + p3.y) * p3.z);
    }

    ${jue}
    ${Kue}
    ${Xue}
  `}var jue=`
vec2 uvFromFlat(int texNumR, int texNumC, int index) {
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
vec2 packedUVfrom1D(int texNumR, int texNumC, int index) {
  int texelIndex = index / 2;
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Kue=`
vec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,
  int texNumC, int row, int col) {
  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = texelIndex / texNumC;
  int texC = texelIndex - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Xue=`
vec2 packedUVfrom3D(int texNumR, int texNumC,
    int texelsInBatch, int texelsInLogicalRow, int b,
    int row, int col) {
  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);
  int texR = index / texNumC;
  int texC = index - texR * texNumC;
  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);
}
`,Yue=`
  float getChannel(vec4 frag, vec2 innerDims) {
    vec2 modCoord = mod(innerDims, 2.);
    return modCoord.x == 0. ?
      (modCoord.y == 0. ? frag.r : frag.g) :
      (modCoord.y == 0. ? frag.b : frag.a);
  }
  float getChannel(vec4 frag, int dim) {
    float modCoord = mod(float(dim), 2.);
    return modCoord == 0. ? frag.r : frag.g;
  }
`;function aW(){return`
    int getOutputCoords() {
      return 0;
    }
  `}function Que(t,e,r){let n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return n[0]===1?r?`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.x * ${n[1]}.0);
      }
    `:n[1]===1?r?`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));
      }
    `:`
      int getOutputCoords() {
        return 2 * int(resultUV.y * ${n[0]}.0);
      }
    `:r?`
    int getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${n[0]}, ${n[1]}));
      return 2 * (resTexRC.x * ${n[1]} + resTexRC.y);
    }
  `}function Zue(t,e,r){return e[0]===1?r?`
      int getOutputCoords() {
        return int(resultUV.x * float(outTexShape[1]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.x * ${e[1]}.0);
      }
    `:e[1]===1?r?`
      int getOutputCoords() {
        return int(resultUV.y * float(outTexShape[0]));
      }
    `:`
      int getOutputCoords() {
        return int(resultUV.y * ${e[0]}.0);
      }
    `:r?`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      return resTexRC.x * outTexShape[1] + resTexRC.y;
    }
  `:`
    int getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      return resTexRC.x * ${e[1]} + resTexRC.y;
    }
  `}function Jue(t,e,r){if(r)return`
    ivec3 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec3(b, r, c);
    }
  `;let n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],o=Math.ceil(t[2]/2),s=o*Math.ceil(t[1]/2);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${n[0]}, ${n[1]}));
      int index = resTexRC.x * ${n[1]} + resTexRC.y;

      int b = index / ${s};
      index -= b * ${s};

      int r = 2 * (index / ${o});
      int c = imod(index, ${o}) * 2;

      return ivec3(b, r, c);
    }
  `}function ece(t,e,r){if(r)return`
  ivec3 getOutputCoords() {
    ivec2 resTexRC = ivec2(resultUV.yx *
                           vec2(outTexShape[0], outTexShape[1]));
    int index = resTexRC.x * outTexShape[1] + resTexRC.y;
    ${Af(["r","c","d"],t)}
    return ivec3(r, c, d);
  }
`;let n=mi(["r","c","d"],t);return`
    ivec3 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${n}
      return ivec3(r, c, d);
    }
  `}function tce(t,e,r){if(r)return`
    ivec4 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));
      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;

      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));
      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));
      int texelsInBatchN = texelsInBatch * outShape[1];

      int b2 = index / texelsInBatchN;
      index -= b2 * texelsInBatchN;

      int b = index / texelsInBatch;
      index -= b * texelsInBatch;

      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec4(b2, b, r, c);
    }
  `;let n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],o=Math.ceil(t[t.length-1]/2),s=o*Math.ceil(t[t.length-2]/2),i=s,a="",l="b, r, c";for(let u=2;u<t.length-1;u++)i*=t[t.length-u-1],a=`
      int b${u} = index / ${i};
      index -= b${u} * ${i};
    `+a,l=`b${u}, `+l;return`
    ivec${t.length} getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${n[0]}, ${n[1]}));
      int index = resTexRC.x * ${n[1]} + resTexRC.y;

      ${a}

      int b = index / ${s};
      index -= b * ${s};

      int r = 2 * (index / ${o});
      int c = imod(index, ${o}) * 2;

      return ivec${t.length}(${l});
    }
  `}function rce(t,e,r){if(r)return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      ${Af(["r","c","d","d2"],t)}
      return ivec4(r, c, d, d2);
    }
  `;let n=mi(["r","c","d","d2"],t);return`
    ivec4 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      ${n}
      return ivec4(r, c, d, d2);
    }
  `}function nce(t,e){let r=mi(["r","c","d","d2","d3"],t);return`
    ivec5 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},
                             ${e[1]}));

      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${r}

      ivec5 outShape = ivec5(r, c, d, d2, d3);
      return outShape;
    }
  `}function oce(t,e){let r=mi(["r","c","d","d2","d3","d4"],t);return`
    ivec6 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
        vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;

      ${r}

      ivec6 result = ivec6(r, c, d, d2, d3, d4);
      return result;
    }
  `}function sce(t,e,r){let n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(w.arraysEqual(t,e))return r?`
      ivec2 getOutputCoords() {
        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return 2 * ivec2(resultUV.yx * vec2(${n[0]}, ${n[1]}));
      }
    `;let o=Math.ceil(t[1]/2);return r?`
    ivec2 getOutputCoords() {
      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));
      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(packedTexShape[0], packedTexShape[1]));

      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;
      int r = 2 * (index / texelsInLogicalRow);
      int c = imod(index, texelsInLogicalRow) * 2;

      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${n[0]}, ${n[1]}));

      int index = resTexRC.x * ${n[1]} + resTexRC.y;
      int r = 2 * (index / ${o});
      int c = imod(index, ${o}) * 2;

      return ivec2(r, c);
    }
  `}function ice(t,e,r){return w.arraysEqual(t,e)?r?`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));
      }
    `:`
      ivec2 getOutputCoords() {
        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));
      }
    `:t[1]===1?r?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(index, 0);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(index, 0);
      }
    `:t[0]===1?r?`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(outTexShape[0], outTexShape[1]));
        int index = resTexRC.x * outTexShape[1] + resTexRC.y;
        return ivec2(0, index);
      }
    `:`
      ivec2 getOutputCoords() {
        ivec2 resTexRC = ivec2(resultUV.yx *
                               vec2(${e[0]}, ${e[1]}));
        int index = resTexRC.x * ${e[1]} + resTexRC.y;
        return ivec2(0, index);
      }
    `:r?`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(outTexShape[0], outTexShape[1]));
      int index = resTexRC.x * outTexShape[1] + resTexRC.y;
      int r = index / outShape[1];
      int c = index - r * outShape[1];
      return ivec2(r, c);
    }
  `:`
    ivec2 getOutputCoords() {
      ivec2 resTexRC = ivec2(resultUV.yx *
                             vec2(${e[0]}, ${e[1]}));
      int index = resTexRC.x * ${e[1]} + resTexRC.y;
      int r = index / ${t[1]};
      int c = index - r * ${t[1]};
      return ivec2(r, c);
    }
  `}function Df(t){return`offset${t}`}function ace(t){let e=t.name,r="get"+e.charAt(0).toUpperCase()+e.slice(1),n=Qt();return`
    vec4 ${r}() {
      return ${n.texture2D}(${e}, halfCR);
    }
  `}function lce(t,e){let r=t.name,n="get"+r.charAt(0).toUpperCase()+r.slice(1);if(t.shapeInfo.isUniform)return`float ${n}() {return ${r};}`;let[o,s]=t.shapeInfo.texShape;if(o===1&&s===1)return`
      float ${n}() {
        return sampleTexture(${r}, halfCR);
      }
    `;let i=Df(r);if(e)return`
    float ${n}() {
      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], ${i});
      return sampleTexture(${r}, uv);
    }
  `;let[a,l]=t.shapeInfo.texShape;return`
    float ${n}() {
      vec2 uv = uvFromFlat(${a}, ${l}, ${i});
      return sampleTexture(${r}, uv);
    }
  `}function uce(t,e){let r=t.name,n="get"+r.charAt(0).toUpperCase()+r.slice(1),o=t.shapeInfo.texShape,s=Qt();if(e)return`
    vec4 ${n}(int index) {
      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));
      vec2 uv = packedUVfrom1D(
        packedTexShape[0], packedTexShape[1], index);
      return ${s.texture2D}(${r}, uv);
    }
  `;let i=[Math.ceil(o[0]/2),Math.ceil(o[1]/2)];return`
    vec4 ${n}(int index) {
      vec2 uv = packedUVfrom1D(
        ${i[0]}, ${i[1]}, index);
      return ${s.texture2D}(${r}, uv);
    }
  `}function cce(t,e){let r=t.name,n="get"+r.charAt(0).toUpperCase()+r.slice(1);if(t.shapeInfo.isUniform)return`
      float ${n}(int index) {
        ${Fh(t)}
      }
    `;let o=t.shapeInfo.texShape,s=o[0],i=o[1];if(i===1&&s===1)return`
      float ${n}(int index) {
        return sampleTexture(${r}, halfCR);
      }
    `;let a=Df(r);return i===1?e?`
      float ${n}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / float(${r}TexShape[0]));
        return sampleTexture(${r}, uv);
      }
    `:`
      float ${n}(int index) {
        vec2 uv = vec2(0.5, (float(index + ${a}) + 0.5) / ${s}.0);
        return sampleTexture(${r}, uv);
      }
    `:s===1?e?`
      float ${n}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / float(${r}TexShape[1]), 0.5);
        return sampleTexture(${r}, uv);
      }
    `:`
      float ${n}(int index) {
        vec2 uv = vec2((float(index + ${a}) + 0.5) / ${i}.0, 0.5);
        return sampleTexture(${r}, uv);
      }
    `:e?`
    float ${n}(int index) {
      vec2 uv = uvFromFlat(${r}TexShape[0], ${r}TexShape[1], index + ${a});
      return sampleTexture(${r}, uv);
    }
  `:`
    float ${n}(int index) {
      vec2 uv = uvFromFlat(${s}, ${i}, index + ${a});
      return sampleTexture(${r}, uv);
    }
  `}function pce(t,e){let r=t.shapeInfo.logicalShape,n=t.name,o="get"+n.charAt(0).toUpperCase()+n.slice(1),s=t.shapeInfo.texShape,i=s[0],a=s[1],l=Qt();if(s!=null&&w.arraysEqual(r,s))return e?`
      vec4 ${o}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${n}TexShape[1], ${n}TexShape[0]);

        return ${l.texture2D}(${n}, uv);
      }
    `:`
      vec4 ${o}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${a}.0, ${i}.0);

        return ${l.texture2D}(${n}, uv);
      }
    `;if(e)return`
    vec4 ${o}(int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${n}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);
      return ${l.texture2D}(${n}, uv);
    }
  `;let u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],c=Math.ceil(r[1]/2);return`
    vec4 ${o}(int row, int col) {
      vec2 uv = packedUVfrom2D(${c}, ${u[0]}, ${u[1]}, row, col);
      return ${l.texture2D}(${n}, uv);
    }
  `}function fce(t,e){let r=t.shapeInfo.logicalShape,n=t.name,o="get"+n.charAt(0).toUpperCase()+n.slice(1),s=t.shapeInfo.texShape;if(s!=null&&w.arraysEqual(r,s)){if(e)return`
      float ${o}(int row, int col) {
        vec2 uv = (vec2(col, row) + halfCR) / vec2(${n}TexShape[1], ${n}TexShape[0]);
        return sampleTexture(${n}, uv);
      }
    `;let f=s[0],d=s[1];return`
    float ${o}(int row, int col) {
      vec2 uv = (vec2(col, row) + halfCR) / vec2(${d}.0, ${f}.0);
      return sampleTexture(${n}, uv);
    }
  `}let{newShape:i,keptDims:a}=w.squeezeShape(r),l=i;if(l.length<r.length){let f=Ph(t,l),d=["row","col"];return`
      ${Oh(f,e)}
      float ${o}(int row, int col) {
        return ${o}(${Lh(d,a)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${o}(int row, int col) {
        int index = round(dot(vec2(row, col), vec2(${r[1]}, 1)));
        ${Fh(t)}
      }
    `;let u=s[0],c=s[1],p=Df(n);return c===1?e?`
      float ${o}(int row, int col) {
        float index = dot(vec3(row, col, ${p}), vec3(${n}Shape[1], 1, 1));
        vec2 uv = vec2(0.5, (index + 0.5) / float(${n}TexShape[0]));
        return sampleTexture(${n}, uv);
      }
    `:`
    float ${o}(int row, int col) {
      float index = dot(vec3(row, col, ${p}), vec3(${r[1]}, 1, 1));
      vec2 uv = vec2(0.5, (index + 0.5) / ${u}.0);
      return sampleTexture(${n}, uv);
    }
  `:u===1?e?`
      float ${o}(int row, int col) {
        float index = dot(vec3(row, col, ${p}), vec3(${n}Shape[1], 1, 1));
        vec2 uv = vec2((index + 0.5) / float(${n}TexShape[1]), 0.5);
        return sampleTexture(${n}, uv);
      }
    `:`
    float ${o}(int row, int col) {
      float index = dot(vec3(row, col, ${p}), vec3(${r[1]}, 1, 1));
      vec2 uv = vec2((index + 0.5) / ${c}.0, 0.5);
      return sampleTexture(${n}, uv);
    }
  `:e?`
      float ${o}(int row, int col) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${n}Shape[1] + col + ${p};
        vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index);
        return sampleTexture(${n}, uv);
      }
    `:`
  float ${o}(int row, int col) {
    // Explicitly use integer operations as dot() only works on floats.
    int index = row * ${r[1]} + col + ${p};
    vec2 uv = uvFromFlat(${u}, ${c}, index);
    return sampleTexture(${n}, uv);
  }
`}function dce(t,e){let r=t.shapeInfo.logicalShape,n=t.name,o="get"+n.charAt(0).toUpperCase()+n.slice(1),s=t.shapeInfo.texShape,i=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)];if(r[0]===1){let f=r.slice(1),d=[1,2],m=Ph(t,f),h=["b","row","col"];return`
        ${iW(m,e)}
        vec4 ${o}(int b, int row, int col) {
          return ${o}(${Lh(h,d)});
        }
      `}let a=Qt();if(e)return`
    vec4 ${o}(int b, int row, int col) {
      ivec2 packedTexShape = ivec2(ceil(float(${n}TexShape[0]) / 2.0), ceil(float(${n}TexShape[1]) / 2.0));
      int valuesPerRow = int(ceil(float(${n}Shape[2]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${n}Shape[1]) / 2.0));
      vec2 uv = packedUVfrom3D(
        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);
      return ${a.texture2D}(${n}, uv);
    }
  `;let l=i[0],u=i[1],c=Math.ceil(r[2]/2),p=c*Math.ceil(r[1]/2);return`
    vec4 ${o}(int b, int row, int col) {
      vec2 uv = packedUVfrom3D(
        ${l}, ${u}, ${p}, ${c}, b, row, col);
      return ${a.texture2D}(${n}, uv);
    }
  `}function mce(t,e){let r=t.shapeInfo.logicalShape,n=t.name,o="get"+n.charAt(0).toUpperCase()+n.slice(1),s=r[1]*r[2],i=r[2],{newShape:a,keptDims:l}=w.squeezeShape(r),u=a;if(u.length<r.length){let h=Ph(t,u),g=["row","col","depth"];return`
        ${Oh(h,e)}
        float ${o}(int row, int col, int depth) {
          return ${o}(${Lh(g,l)});
        }
      `}if(t.shapeInfo.isUniform)return`
      float ${o}(int row, int col, int depth) {
        int index = round(dot(vec3(row, col, depth),
                          vec3(${s}, ${i}, 1)));
        ${Fh(t)}
      }
    `;let c=t.shapeInfo.texShape,p=c[0],f=c[1],d=t.shapeInfo.flatOffset;if(f===s&&d==null)return e?`
      float ${o}(int row, int col, int depth) {
        int stride1 = ${n}Shape[2];
        float texR = float(row);
        float texC = dot(vec2(col, depth), vec2(stride1, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${n}TexShape[1], ${n}TexShape[0]);
        return sampleTexture(${n}, uv);
      }
    `:`
        float ${o}(int row, int col, int depth) {
          float texR = float(row);
          float texC = dot(vec2(col, depth), vec2(${i}, 1));
          vec2 uv = (vec2(texC, texR) + halfCR) /
                     vec2(${f}.0, ${p}.0);
          return sampleTexture(${n}, uv);
        }
      `;if(f===i&&d==null)return e?`
      float ${o}(int row, int col, int depth) {
        float texR = dot(vec2(row, col), vec2(${n}Shape[1], 1));
        float texC = float(depth);
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${n}TexShape[1], ${n}TexShape[0]);
        return sampleTexture(${n}, uv);
      }
    `:`
    float ${o}(int row, int col, int depth) {
      float texR = dot(vec2(row, col), vec2(${r[1]}, 1));
      float texC = float(depth);
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${f}.0, ${p}.0);
      return sampleTexture(${n}, uv);
    }
  `;let m=Df(n);return e?`
    float ${o}(int row, int col, int depth) {
      // Explicitly use integer operations as dot() only works on floats.
      int stride0 = ${n}Shape[1] * ${n}Shape[2];
      int stride1 = ${n}Shape[2];
      int index = row * stride0 + col * stride1 + depth + ${m};
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index);
      return sampleTexture(${n}, uv);
    }
    `:`
      float ${o}(int row, int col, int depth) {
        // Explicitly use integer operations as dot() only works on floats.
        int index = row * ${s} + col * ${i} + depth + ${m};
        vec2 uv = uvFromFlat(${p}, ${f}, index);
        return sampleTexture(${n}, uv);
      }
  `}function hce(t,e){let r=t.name,n="get"+r.charAt(0).toUpperCase()+r.slice(1),o=Qt();if(e)return`
    vec4 ${n}(int b2, int b, int row, int col) {
      int valuesPerRow = int(ceil(float(${r}Shape[3]) / 2.0));
      int texelsInBatch = valuesPerRow * int(ceil(float(${r}Shape[2]) / 2.0));
      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);
      texelsInBatch *= ${r}Shape[1];
      index = b2 * texelsInBatch + index;
      ivec2 packedTexShape = ivec2(ceil(float(${r}TexShape[0]) / 2.0), ceil(float(${r}TexShape[1]) / 2.0));
      int texR = index / packedTexShape[1];
      int texC = index - texR * packedTexShape[1];
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ${o.texture2D}(${r}, uv);
    }
  `;let s=t.shapeInfo.logicalShape,i=s.length,a=t.shapeInfo.texShape,l=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],u=l[0],c=l[1],p=Math.ceil(s[i-1]/2),f=p*Math.ceil(s[i-2]/2),d="int b, int row, int col",m=`b * ${f} + (row / 2) * ${p} + (col / 2)`;for(let h=2;h<i-1;h++)d=`int b${h}, `+d,f*=s[i-h-1],m=`b${h} * ${f} + `+m;return`
    vec4 ${n}(${d}) {
      int index = ${m};
      int texR = index / ${c};
      int texC = index - texR * ${c};
      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${c}, ${u});
      return ${o.texture2D}(${r}, uv);
    }
  `}function gce(t,e){let r=t.shapeInfo.logicalShape,n=t.name,o="get"+n.charAt(0).toUpperCase()+n.slice(1),s=r[3],i=r[2]*s,a=r[1]*i,{newShape:l,keptDims:u}=w.squeezeShape(r);if(l.length<r.length){let y=Ph(t,l),b=["row","col","depth","depth2"];return`
      ${Oh(y,e)}
      float ${o}(int row, int col, int depth, int depth2) {
        return ${o}(${Lh(b,u)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${o}(int row, int col, int depth, int depth2) {
        int index = round(dot(vec4(row, col, depth, depth2),
                          vec4(${a}, ${i}, ${s}, 1)));
        ${Fh(t)}
      }
    `;let c=t.shapeInfo.flatOffset,p=t.shapeInfo.texShape,f=p[0],d=p[1],m=`int stride2 = ${n}Shape[3];`,h=`int stride1 = ${n}Shape[2] * stride2;`,g=`int stride0 = ${n}Shape[1] * stride1;`;if(d===a&&c==null)return e?`
      float ${o}(int row, int col, int depth, int depth2) {
        ${m}
        ${h}
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(stride1, stride2, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${n}TexShape[1], ${n}TexShape[0]);
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${o}(int row, int col, int depth, int depth2) {
        float texR = float(row);
        float texC =
            dot(vec3(col, depth, depth2),
                vec3(${i}, ${s}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${d}.0, ${f}.0);
        return sampleTexture(${n}, uv);
      }
    `;if(d===s&&c==null)return e?`
      float ${o}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${n}Shape[1] * ${n}Shape[2], ${n}Shape[2], 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${n}TexShape[1], ${n}TexShape[0]);
        return sampleTexture(${n}, uv);
      }
    `:`
      float ${o}(int row, int col, int depth, int depth2) {
        float texR = dot(vec3(row, col, depth),
                         vec3(${r[1]*r[2]}, ${r[2]}, 1));
        float texC = float(depth2);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${d}.0, ${f}.0);
        return sampleTexture(${n}, uv);
      }
    `;let x=Df(n);return e?`
    float ${o}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      ${m}
      ${h}
      ${g}
      int index = row * stride0 + col * stride1 +
          depth * stride2 + depth2;
      vec2 uv = uvFromFlat(${n}TexShape[0], ${n}TexShape[1], index + ${x});
      return sampleTexture(${n}, uv);
    }
  `:`
    float ${o}(int row, int col, int depth, int depth2) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${i} +
          depth * ${s} + depth2;
      vec2 uv = uvFromFlat(${f}, ${d}, index + ${x});
      return sampleTexture(${n}, uv);
    }
  `}function xce(t){let e=t.shapeInfo.logicalShape,r=t.name,n="get"+r.charAt(0).toUpperCase()+r.slice(1),o=e[4],s=e[3]*o,i=e[2]*s,a=e[1]*i,{newShape:l,keptDims:u}=w.squeezeShape(e);if(l.length<e.length){let h=Ph(t,l),g=["row","col","depth","depth2","depth3"];return`
      ${Oh(h)}
      float ${n}(int row, int col, int depth, int depth2, int depth3) {
        return ${n}(${Lh(g,u)});
      }
    `}if(t.shapeInfo.isUniform)return`
      float ${n}(int row, int col, int depth, int depth2, int depth3) {
        float index = dot(
          vec4(row, col, depth, depth2),
          vec4(${a}, ${i}, ${s}, ${o})) +
          depth3;
        ${Fh(t)}
      }
    `;let c=t.shapeInfo.flatOffset,p=t.shapeInfo.texShape,f=p[0],d=p[1];if(d===a&&c==null)return`
      float ${n}(int row, int col, int depth, int depth2, int depth3) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
                         vec4(${i}, ${s}, ${o}, 1));
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${d}.0, ${f}.0);
        return sampleTexture(${r}, uv);
      }
    `;if(d===o&&c==null)return`
      float ${n}(int row, int col, int depth, int depth2, int depth3) {
        float texR = dot(
          vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]},
               ${e[2]*e[3]}, ${e[3]}, 1));
        int texC = depth3;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${d}.0, ${f}.0);
        return sampleTexture(${r}, uv);
      }
    `;let m=Df(r);return`
    float ${n}(int row, int col, int depth, int depth2, int depth3) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${a} + col * ${i} + depth * ${s} +
          depth2 * ${o} + depth3 + ${m};
      vec2 uv = uvFromFlat(${f}, ${d}, index);
      return sampleTexture(${r}, uv);
    }
  `}function yce(t){let e=t.shapeInfo.logicalShape,r=t.name,n="get"+r.charAt(0).toUpperCase()+r.slice(1),{newShape:o,keptDims:s}=w.squeezeShape(e);if(o.length<e.length){let g=Ph(t,o),x=["row","col","depth","depth2","depth3","depth4"];return`
      ${Oh(g)}
      float ${n}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        return ${n}(${Lh(x,s)});
      }
    `}let i=e[5],a=e[4]*i,l=e[3]*a,u=e[2]*l,c=e[1]*u;if(t.shapeInfo.isUniform)return`
      float ${n}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
        int index = round(dot(
          vec4(row, col, depth, depth2),
          vec4(${c}, ${u}, ${l}, ${a})) +
          dot(
            vec2(depth3, depth4),
            vec2(${i}, 1)));
        ${Fh(t)}
      }
    `;let p=t.shapeInfo.flatOffset,f=t.shapeInfo.texShape,d=f[0],m=f[1];if(m===c&&p==null)return`
      float ${n}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        int texR = row;
        float texC = dot(vec4(col, depth, depth2, depth3),
          vec4(${u}, ${l}, ${a}, ${i})) +
               float(depth4);
        vec2 uv = (vec2(texC, texR) + halfCR) /
                   vec2(${m}.0, ${d}.0);
        return sampleTexture(${r}, uv);
      }
    `;if(m===i&&p==null)return`
      float ${n}(int row, int col, int depth,
                    int depth2, int depth3, int depth4) {
        float texR = dot(vec4(row, col, depth, depth2),
          vec4(${e[1]*e[2]*e[3]*e[4]},
               ${e[2]*e[3]*e[4]},
               ${e[3]*e[4]},
               ${e[4]})) + float(depth3);
        int texC = depth4;
        vec2 uv = (vec2(texC, texR) + halfCR) /
                  vec2(${m}.0, ${d}.0);
        return sampleTexture(${r}, uv);
      }
    `;let h=Df(r);return`
    float ${n}(int row, int col, int depth,
                  int depth2, int depth3, int depth4) {
      // Explicitly use integer operations as dot() only works on floats.
      int index = row * ${c} + col * ${u} + depth * ${l} +
          depth2 * ${a} + depth3 * ${i} + depth4 + ${h};
      vec2 uv = uvFromFlat(${d}, ${m}, index);
      return sampleTexture(${r}, uv);
    }
  `}function Fh(t){let e=t.name,r=w.sizeFromShape(t.shapeInfo.logicalShape);return r<2?`return ${e};`:`
    for (int i = 0; i < ${r}; i++) {
      if (i == index) {
        return ${e}[i];
      }
    }
  `}function bce(t,e){let r=t.name,n=r.charAt(0).toUpperCase()+r.slice(1),o="get"+n+"AtOutCoords",s=t.shapeInfo.logicalShape.length,i=e.logicalShape.length,a=oW(t.shapeInfo.logicalShape,e.logicalShape),l=He(i),u=i-s,c,p=["x","y","z","w","u","v"];s===0?c="":i<2&&a.length>=1?c="coords = 0;":c=a.map(y=>`coords.${p[y+u]} = 0;`).join(`
`);let f="";i<2&&s>0?f="coords":f=t.shapeInfo.logicalShape.map((y,b)=>`coords.${p[b+u]}`).join(", ");let d="return outputValue;",h=w.sizeFromShape(t.shapeInfo.logicalShape)===1,x=w.sizeFromShape(e.logicalShape)===1;if(s===1&&!h&&!x)d=`
      return vec4(outputValue.xy, outputValue.xy);
    `;else if(h&&!x)i===1?d=`
        return vec4(outputValue.x, outputValue.x, 0., 0.);
      `:d=`
        return vec4(outputValue.x);
      `;else if(a.length){let y=s-2,b=s-1;a.indexOf(y)>-1&&a.indexOf(b)>-1?d="return vec4(outputValue.x);":a.indexOf(y)>-1?d="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(b)>-1&&(d="return vec4(outputValue.xx, outputValue.zz);")}return`
    vec4 ${o}() {
      ${l} coords = getOutputCoords();
      ${c}
      vec4 outputValue = get${n}(${f});
      ${d}
    }
  `}function vce(t,e){let r=t.name,n=r.charAt(0).toUpperCase()+r.slice(1),o="get"+n+"AtOutCoords",s=e.texShape,i=t.shapeInfo.texShape,a=t.shapeInfo.logicalShape.length,l=e.logicalShape.length;if(!t.shapeInfo.isUniform&&a===l&&t.shapeInfo.flatOffset==null&&w.arraysEqual(i,s))return`
      float ${o}() {
        return sampleTexture(${r}, resultUV);
      }
    `;let u=He(l),c=oW(t.shapeInfo.logicalShape,e.logicalShape),p=l-a,f,d=["x","y","z","w","u","v"];a===0?f="":l<2&&c.length>=1?f="coords = 0;":f=c.map(h=>`coords.${d[h+p]} = 0;`).join(`
`);let m="";return l<2&&a>0?m="coords":m=t.shapeInfo.logicalShape.map((h,g)=>`coords.${d[g+p]}`).join(", "),`
    float ${o}() {
      ${u} coords = getOutputCoords();
      ${f}
      return get${n}(${m});
    }
  `}function He(t){if(t<=1)return"int";if(t===2)return"ivec2";if(t===3)return"ivec3";if(t===4)return"ivec4";if(t===5)return"ivec5";if(t===6)return"ivec6";throw Error(`GPU for rank ${t} is not yet supported`)}function kC(t,e,r){let{newShape:n,keptDims:o}=w.squeezeShape(e),s=e.length,i=t&&s===3&&e[0]===1,a=i?e.slice(1):n,l=!t&&s>1&&!w.arraysEqual(e,r)&&n.length<s||i;return{useSqueezeShape:l,uniformShape:l?a:e,keptDims:o}}function Ph(t,e){let r=JSON.parse(JSON.stringify(t));return r.shapeInfo.logicalShape=e,r}function Lh(t,e){return e.map(r=>t[r]).join(", ")}function uW(t,e,r,n){let o=r.map((c,p)=>{let f={logicalShape:c.shape,texShape:c.isUniform?null:c.texData.texShape,isUniform:c.isUniform,isPacked:c.isUniform?!1:c.texData.isPacked,flatOffset:null};return c.texData!=null&&c.texData.slice!=null&&c.texData.slice.flatOffset>0&&(f.flatOffset=c.texData.slice.flatOffset),{name:e.variableNames[p],shapeInfo:f}}),s=o.map(c=>c.shapeInfo),i={logicalShape:n.shape,texShape:n.texData.texShape,isUniform:!1,isPacked:n.texData.isPacked,flatOffset:null},a=sW(o,i,e),l=z5(t.gl,a),u=t.createProgram(l);return B().get("ENGINE_COMPILE_ONLY")?{program:e,fragmentShader:l,source:a,webGLProgram:u,inShapeInfos:s,outShapeInfo:i,uniformLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,inShapesLocations:null,inTexShapesLocations:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:Object.assign({program:e,fragmentShader:l,source:a,webGLProgram:u,inShapeInfos:s,outShapeInfo:i},V_(t,e,u))}function V_(t,e,r){let n={},o={},s={},i=[],a,l,u,c=null,p=null;p=t.getUniformLocation(r,"NAN",!1),B().getNumber("WEBGL_VERSION")===1&&(c=t.getUniformLocation(r,"INFINITY",!1));let f=!1;for(let d=0;d<e.variableNames.length;d++){let m=e.variableNames[d];n[m]=t.getUniformLocation(r,m,f),n[`offset${m}`]=t.getUniformLocation(r,`offset${m}`,f),e.enableShapeUniforms&&(o[`${m}Shape`]=t.getUniformLocation(r,`${m}Shape`,f),s[`${m}TexShape`]=t.getUniformLocation(r,`${m}TexShape`,f))}return e.enableShapeUniforms&&(a=t.getUniformLocation(r,"outShape",f),u=t.getUniformLocation(r,"outShapeStrides",f),l=t.getUniformLocation(r,"outTexShape",f)),e.customUniforms&&e.customUniforms.forEach((d,m)=>{i[m]=t.getUniformLocation(r,d.name,f)}),{uniformLocations:n,customUniformLocations:i,infLoc:c,nanLoc:p,inShapesLocations:o,inTexShapesLocations:s,outShapeLocation:a,outShapeStridesLocation:u,outTexShapeLocation:l}}function lW(t,e){if(t.length!==e.length)throw Error(`Binary was compiled with ${t.length} inputs, but was executed with ${e.length} inputs`);t.forEach((r,n)=>{let o=r.logicalShape,s=e[n],i=s.shape;if(!w.arraysEqual(o,i))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${o} and ${i} must match`);if(r.isUniform&&s.isUniform)return;let a=r.texShape,l=s.isUniform?null:s.texData.texShape;if(!w.arraysEqual(a,l))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${a} and ${l} must match`)})}function cW(t,e,r,n,o){e.program.enableShapeUniforms||(lW(e.inShapeInfos,r),lW([e.outShapeInfo],[n]));let s=n.texData.texture,i=n.texData.texShape;n.texData.isPacked?t.setOutputPackedMatrixTexture(s.texture,i[0],i[1]):t.setOutputMatrixTexture(s.texture,i[0],i[1]),t.setProgram(e.webGLProgram),B().getNumber("WEBGL_VERSION")===1&&e.infLoc!==null&&t.gl.uniform1f(e.infLoc,1/0),e.nanLoc!==null&&t.gl.uniform1f(e.nanLoc,NaN),r.forEach((l,u)=>{let c=e.program.variableNames[u],p=e.uniformLocations[c],f=e.uniformLocations[`offset${c}`],d=e.inShapesLocations[`${c}Shape`],m=e.inTexShapesLocations[`${c}TexShape`];if(d){let{uniformShape:h}=kC(e.program.packedInputs,l.shape,l.texData.texShape);switch(h.length){case 1:t.gl.uniform1iv(d,new Int32Array(h));break;case 2:t.gl.uniform2iv(d,new Int32Array(h));break;case 3:t.gl.uniform3iv(d,new Int32Array(h));break;case 4:t.gl.uniform4iv(d,new Int32Array(h));break;default:break}}if(m&&t.gl.uniform2i(m,l.texData.texShape[0],l.texData.texShape[1]),p!=null){if(l.isUniform){if(w.sizeFromShape(l.shape)<2)t.gl.uniform1f(p,l.uniformValues[0]);else{let h=l.uniformValues;h instanceof Float32Array||(h=new Float32Array(h)),t.gl.uniform1fv(p,h)}return}l.texData.slice!=null&&f!=null&&t.gl.uniform1i(f,l.texData.slice.flatOffset),t.setInputMatrixTexture(l.texData.texture.texture,p,u)}});let a=e.outShapeLocation;if(a)switch(n.shape.length){case 1:t.gl.uniform1iv(a,new Int32Array(n.shape));break;case 2:t.gl.uniform2iv(a,new Int32Array(n.shape));break;case 3:t.gl.uniform3iv(a,new Int32Array(n.shape));break;case 4:t.gl.uniform4iv(a,new Int32Array(n.shape));break;default:break}if(e.outShapeStridesLocation){let l=w.computeStrides(n.shape);switch(n.shape.length){case 2:t.gl.uniform1iv(e.outShapeStridesLocation,new Int32Array(l));break;case 3:t.gl.uniform2iv(e.outShapeStridesLocation,new Int32Array(l));break;case 4:t.gl.uniform3iv(e.outShapeStridesLocation,new Int32Array(l));break;default:break}}e.outTexShapeLocation&&t.gl.uniform2i(e.outTexShapeLocation,n.texData.texShape[0],n.texData.texShape[1]),e.program.customUniforms&&o&&e.program.customUniforms.forEach((l,u)=>{let c=e.customUniformLocations[u],p=o[u];if(l.type==="float")t.gl.uniform1fv(c,p);else if(l.type==="vec2")t.gl.uniform2fv(c,p);else if(l.type==="vec3")t.gl.uniform3fv(c,p);else if(l.type==="vec4")t.gl.uniform4fv(c,p);else if(l.type==="int")t.gl.uniform1iv(c,p);else if(l.type==="ivec2")t.gl.uniform2iv(c,p);else if(l.type==="ivec3")t.gl.uniform3iv(c,p);else if(l.type==="ivec4")t.gl.uniform4iv(c,p);else throw Error(`uniform type ${l.type} is not supported yet.`)}),t.executeProgram()}function pW(t,e,r){let n="";e.concat(r).forEach(i=>{let a=i.texData!=null&&i.texData.slice!=null&&i.texData.slice.flatOffset>0;if(t.enableShapeUniforms&&!i.isUniform){let l=i.texData.texShape,{useSqueezeShape:u,uniformShape:c,keptDims:p}=kC(t.packedInputs,i.shape,l),f="",d="",m="";if(c.length===1&&t.packedInputs){let C=[Math.ceil(l[0]/2),Math.ceil(l[1]/2)];f=`${C[0]>1}_${C[1]>1}`}else if(c.length===2&&!t.packedInputs)d=`${c[0]>1}_${c[1]>1}`;else if(c.length>2&&!t.packedInputs){let C=w.computeStrides(c);m=`${C[0]===l[1]}_${C[C.length-1]===l[1]}`}let h=i.shape.length,g=c.length===2&&w.arraysEqual(i.shape,l),x=w.sizeFromShape(i.shape)===1,y=T.getBroadcastDims(i.shape,r.shape),b=!t.packedInputs&&h===r.shape.length&&w.arraysEqual(l,r.texData.texShape),v=t.packedInputs||c.length>2?"":`${l[0]>1}_${l[1]>1}`;n+=`${h}_${b}_${u?p:""}_${c.length}_${x}_${y}_${g}_${f}_${d}_${m}_${v}_${a}`}else{let l=i.isUniform?"uniform":i.texData.texShape;n+=`${i.shape}_${l}_${a}`}});let o=t.userCode,s=t.constructor.name;return s+="_"+n+"_"+o+`${B().getNumber("WEBGL_VERSION")}`,s}function Tt(t){return B().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&t<=4}var TC=class{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=Ac.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];let r=Qt();this.outputShape=e,this.enableShapeUniforms=Tt(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Af(["r","c","d"],e):mi(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getA(rc.x, rc.y, rc.z);
        }

        ${r.output} = result;
      }
    `}};var NC=class{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=Ac.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];let r=Qt();this.outputShape=e,this.enableShapeUniforms=Tt(this.outputShape.length),this.userCode=`
      ivec3 outCoordsFromFlatIndex(int index) {
        ${this.enableShapeUniforms?Af(["r","c","d"],e):mi(["r","c","d"],e)}
        return ivec3(r, c, d);
      }

      void main() {
        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));
        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);

        vec4 result = vec4(0.);

        for (int i=0; i<4; i++) {
          int flatIndex = index + i;
          ivec3 rc = outCoordsFromFlatIndex(flatIndex);
          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));
        }

        ${r.output} = result;
      }
    `}};var IC=class{constructor(e){this.variableNames=["A"],this.outTexUsage=Sn.DOWNLOAD;let r=Qt();this.outputShape=e,this.userCode=`
      ${SC}

      void main() {
        float x = getAAtOutCoords();
        ${r.output} = encode_float(x);
      }
    `}};var EC=class{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=Sn.DOWNLOAD;let r=Qt();this.outputShape=e,this.userCode=`
      ${SC}

      void main() {
        ivec3 coords = getOutputCoords();
        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));
        ${r.output} = encode_float(x);
      }
    `}};var Sce={R:0,G:1,B:2,A:3},z0=class{constructor(e,r=!1,n="RGBA"){this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];let o=Qt();this.outputShape=e,this.enableShapeUniforms=Tt(this.outputShape.length);let s="result";r&&(s="floor(result * 255. + 0.5)");let i="";for(let a=0;a<n.length;a++){let l=n[a];i+=`
          if(offset == ${a}) {
            result = values[${Sce[l]}];
          }`}this.userCode=`
      ${this.enableShapeUniforms?$h():Dh(e)}

      void main() {
        ivec3 coords = getOutputCoords();
        int flatIndex = getFlatIndex(coords);
        float result = 0.;
        int offset = imod(flatIndex, ${n.length});

        flatIndex = idiv(flatIndex, ${n.length}, 1.);

        int r = flatIndex / texShape[1];
        if (r < texShape[0]) {
          int c = imod(flatIndex, texShape[1]);
          vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
          vec4 values = ${o.texture2D}(A, uv);
          ${i}
        }
        ${o.output} = vec4(${s}, 0., 0., 0.);
      }
    `}};var _C=class{constructor(e,r=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];let n=Qt();this.outputShape=e,this.enableShapeUniforms=Tt(this.outputShape.length);let o="",s="result";r&&(s="floor(result * 255. + 0.5)");for(let i=0;i<=1;i++)for(let a=0;a<=1;a++){let l=i*2+a;o+=`
          localCoords = coords;
          if(localCoords[2] + ${a} < ${this.enableShapeUniforms?"outShape[2]":`${e[2]}`}) {
          localCoords[2] += ${a};
          if (localCoords[1] + ${i} < ${this.enableShapeUniforms?"outShape[1]":`${e[1]}`}) {
            localCoords[1] += ${i};

            flatIndex = getFlatIndex(localCoords);
            offset = imod(flatIndex, 4);

            flatIndex = idiv(flatIndex, 4, 1.);

            int r = flatIndex / texShape[1];
            int c = imod(flatIndex, texShape[1]);
            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);
            values = ${n.texture2D}(A, uv);

            if (offset == 0) {
              result[${l}] = values[0];
            } else if (offset == 1) {
              result[${l}] = values[1];
            } else if (offset == 2) {
              result[${l}] = values[2];
            } else {
              result[${l}] = values[3];
            }
          }
        }
        `}this.userCode=`
        ${this.enableShapeUniforms?$h():Dh(e)}

        void main() {
          ivec3 coords = getOutputCoords();

          vec4 result = vec4(0.);
          int flatIndex, r, c, offset;
          ivec3 localCoords;
          vec2 uv;
          vec4 values;

          ${o}

          ${n.output} = ${s};
        }
    `}};function fW(t){let e=Qt(),r=`${e.version}
    precision highp float;
    ${e.attribute} vec3 clipSpacePos;
    ${e.attribute} vec2 uv;
    ${e.varyingVs} vec2 resultUV;

    void main() {
      gl_Position = vec4(clipSpacePos, 1);
      resultUV = uv;
    }`;return M5(t,r)}function dW(t){let e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return W5(t,e)}function mW(t){let e=new Uint16Array([0,1,2,2,1,3]);return G5(t,e)}function B0(t,e,r,n,o,s){H5(e,r);let i=U5(t),a=t.TEXTURE_2D;return we(t,()=>t.bindTexture(a,i)),we(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE)),we(t,()=>t.texParameteri(a,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)),we(t,()=>t.texParameteri(a,t.TEXTURE_MIN_FILTER,t.NEAREST)),we(t,()=>t.texParameteri(a,t.TEXTURE_MAG_FILTER,t.NEAREST)),B().getNumber("WEBGL_VERSION")===1?we(t,()=>t.texImage2D(a,0,n,e,r,0,o,s,null)):we(t,()=>t.texStorage2D(a,1,n,e,r)),we(t,()=>t.bindTexture(t.TEXTURE_2D,null)),{texture:i,texShape:[r,e]}}function W_(t){return t.internalFormatFloat}function hW(t,e,r,n){let[o,s]=Ef(e,r);return B0(t,o,s,W_(n),n.textureFormatFloat,t.FLOAT)}function G_(t){return t.internalFormatHalfFloat}function gW(t,e,r,n){let[o,s]=Ef(e,r);return B0(t,o,s,G_(n),n.textureFormatFloat,n.textureTypeHalfFloat)}function U_(t){return t.downloadTextureFormat}function xW(t,e,r,n){let[o,s]=Ef(e,r);return B0(t,o,s,U_(n),t.RGBA,t.UNSIGNED_BYTE)}function H_(t){return t.internalFormatPackedFloat}function yW(t,e,r,n){let[o,s]=Zi(e,r);return B0(t,o,s,H_(n),t.RGBA,t.FLOAT)}function q_(t){return t.internalFormatPackedHalfFloat}function bW(t,e,r,n){let[o,s]=Zi(e,r);return B0(t,o,s,q_(n),t.RGBA,n.textureTypeHalfFloat)}function vW(t,e,r){return we(t,()=>t.bindBuffer(t.ARRAY_BUFFER,r)),M_(t,e,"clipSpacePos",r,3,20,0)&&M_(t,e,"uv",r,2,20,12)}function wW(t,e,r,n,o,s){we(t,()=>t.bindTexture(t.TEXTURE_2D,e));let i,a,l;o instanceof Uint8Array?(i=new Uint8Array(r*n*4),a=t.UNSIGNED_BYTE,l=t.RGBA):(i=new Float32Array(r*n*4),a=t.FLOAT,l=s.internalFormatPackedFloat),i.set(o),B().getNumber("WEBGL_VERSION")===2?we(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,r,n,t.RGBA,a,i)):we(t,()=>t.texImage2D(t.TEXTURE_2D,0,l,r,n,0,t.RGBA,a,i)),we(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function CW(t,e,r){we(t,()=>t.bindTexture(t.TEXTURE_2D,e)),r.data instanceof Uint8Array?B().getNumber("WEBGL_VERSION")===2?we(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,r.width,r.height,t.RGBA,t.UNSIGNED_BYTE,r.data)):we(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,r.width,r.height,0,t.RGBA,t.UNSIGNED_BYTE,r.data)):B().getNumber("WEBGL_VERSION")===2?we(t,()=>t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,r)):we(t,()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r)),we(t,()=>t.bindTexture(t.TEXTURE_2D,null))}function SW(t,e,r,n){let o=t.createBuffer();we(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,o));let a=4*4*e*r;return we(t,()=>t.bufferData(t.PIXEL_PACK_BUFFER,a,t.STREAM_READ)),we(t,()=>t.readPixels(0,0,r,e,t.RGBA,t.FLOAT,0)),we(t,()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,null)),o}function kW(t,e,r){let n=t,o=new Float32Array(r);return n.bindBuffer(n.PIXEL_PACK_BUFFER,e),n.getBufferSubData(n.PIXEL_PACK_BUFFER,0,o),n.bindBuffer(n.PIXEL_PACK_BUFFER,null),o}function TW(t,e,r,n){let[o,s]=Ef(e,r),i=4,a=new Uint8Array(F5(e*r,i));return we(t,()=>t.readPixels(0,0,o,s,n.downloadTextureFormat,t.UNSIGNED_BYTE,a)),new Float32Array(a.buffer)}function NW(t,e,r,n,o,s,i,a){let l=t,u=new Float32Array(P5(s,i));return l.bindBuffer(l.PIXEL_PACK_BUFFER,e),l.getBufferSubData(l.PIXEL_PACK_BUFFER,0,u),l.bindBuffer(l.PIXEL_PACK_BUFFER,null),u}function IW(t,e,r){let n=new Float32Array(e*r*4);return we(t,()=>t.readPixels(0,0,r,e,t.RGBA,t.FLOAT,n)),n}var Mh=class{constructor(e){this.outputTexture=null,this.program=null,this.disposed=!1,this.itemsToPoll=[];let r=B().getNumber("WEBGL_VERSION");if(e!=null?(this.gl=e,O5(r,e)):this.gl=Ro(r),e=this.gl,B().getNumber("WEBGL_VERSION")===2){let s=e;this.createVertexArray=()=>we(s,()=>s.createVertexArray()),this.bindVertexArray=i=>we(s,()=>s.bindVertexArray(i)),this.deleteVertexArray=i=>we(s,()=>s.deleteVertexArray(i)),this.getVertexArray=()=>we(s,()=>s.getParameter(s.VERTEX_ARRAY_BINDING))}else if(e!=null){let s=e.getExtension("OES_vertex_array_object");if(s==null)throw new Error("All WebGL1 implementations are expected to offer OES_vertex_array_object.");this.createVertexArray=()=>we(e,()=>s.createVertexArrayOES()),this.bindVertexArray=i=>we(e,()=>s.bindVertexArrayOES(i)),this.deleteVertexArray=i=>we(e,()=>s.deleteVertexArrayOES(i)),this.getVertexArray=()=>we(e,()=>e.getParameter(s.VERTEX_ARRAY_BINDING_OES))}let n="WEBGL_color_buffer_float",o="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),B().getNumber("WEBGL_VERSION")===1){let s="OES_texture_float",i="OES_texture_half_float";if(this.textureFloatExtension=P0(this.gl,s),es(this.gl,i))this.textureHalfFloatExtension=P0(this.gl,i);else if(B().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),es(this.gl,o))this.colorBufferHalfFloatExtension=P0(this.gl,o);else if(B().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",es(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else if(es(this.gl,o))this.colorBufferHalfFloatExtension=this.gl.getExtension(o);else throw new Error("GL context does not support color renderable floats");this.vertexBuffer=dW(this.gl),this.indexBuffer=mW(this.gl),this.framebuffer=q5(this.gl),this.textureConfig=F0(this.gl,this.textureHalfFloatExtension)}get debug(){return B().getBool("DEBUG")}dispose(){if(this.disposed)return;this.program!=null&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),this.outputTexture!=null&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");let e=this.gl;we(e,()=>e.finish()),we(e,()=>e.bindFramebuffer(e.FRAMEBUFFER,null)),we(e,()=>e.deleteFramebuffer(this.framebuffer)),we(e,()=>e.bindBuffer(e.ARRAY_BUFFER,null)),we(e,()=>e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null)),we(e,()=>e.deleteBuffer(this.indexBuffer)),this.disposed=!0}createFloat32MatrixTexture(e,r){return this.throwIfDisposed(),hW(this.gl,e,r,this.textureConfig)}createFloat16MatrixTexture(e,r){return this.throwIfDisposed(),gW(this.gl,e,r,this.textureConfig)}createUnsignedBytesMatrixTexture(e,r){return this.throwIfDisposed(),xW(this.gl,e,r,this.textureConfig)}uploadPixelDataToTexture(e,r){this.throwIfDisposed(),CW(this.gl,e,r)}uploadDenseMatrixToTexture(e,r,n,o){this.throwIfDisposed(),wW(this.gl,e,r,n,o,this.textureConfig)}createFloat16PackedMatrixTexture(e,r){return this.throwIfDisposed(),bW(this.gl,e,r,this.textureConfig)}createPackedMatrixTexture(e,r){return this.throwIfDisposed(),yW(this.gl,e,r,this.textureConfig)}deleteMatrixTexture(e){this.throwIfDisposed(),this.outputTexture===e&&(z_(this.gl,this.framebuffer),this.outputTexture=null),we(this.gl,()=>this.gl.deleteTexture(e))}downloadByteEncodedFloatMatrixFromOutputTexture(e,r,n){return this.downloadMatrixDriver(e,()=>TW(this.gl,r,n,this.textureConfig))}downloadPackedMatrixFromBuffer(e,r,n,o,s,i){return NW(this.gl,e,r,n,o,s,i,this.textureConfig)}downloadFloat32MatrixFromBuffer(e,r){return kW(this.gl,e,r)}createBufferFromTexture(e,r,n){this.bindTextureToFrameBuffer(e);let o=SW(this.gl,r,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),o}createAndWaitForFence(){let e=this.createFence(this.gl);return this.pollFence(e)}createFence(e){let r,n;if(B().getBool("WEBGL_FENCE_API_ENABLED")){let o=e,s=o.fenceSync(o.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=()=>{let i=o.clientWaitSync(s,0,0);return i===o.ALREADY_SIGNALED||i===o.CONDITION_SATISFIED},r=s}else B().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(r=this.beginQuery(),this.endQuery(),n=()=>this.isQueryAvailable(r,B().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):n=()=>!0;return{query:r,isFencePassed:n}}downloadMatrixFromPackedTexture(e,r,n){return this.downloadMatrixDriver(e,()=>IW(this.gl,r,n))}createProgram(e){this.throwIfDisposed();let r=this.gl;this.vertexShader==null&&(this.vertexShader=fW(r));let n=B5(r);we(r,()=>r.attachShader(n,this.vertexShader)),we(r,()=>r.attachShader(n,e)),V5(r,n);let o;return o=Object.assign(n,{vao:this.createVertexArray()}),this.bindVertexArray(o.vao),we(r,()=>r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,this.indexBuffer)),console.assert(vW(r,o,this.vertexBuffer),"gpgpu_util.bindVertexProgramAttributeStreams not fully successful."),this.debug&&vC(r,o),this.setProgram(o),o}deleteProgram(e){this.throwIfDisposed(),e===this.program&&(this.program=null),e!=null&&(we(this.gl,()=>this.gl.deleteProgram(e)),this.deleteVertexArray(e.vao))}setProgram(e){this.throwIfDisposed(),this.program=e,this.program!=null&&(this.bindVertexArray(this.program.vao),this.debug&&vC(this.gl,this.program)),we(this.gl,()=>this.gl.useProgram(e))}getUniformLocation(e,r,n=!0){return this.throwIfDisposed(),n?j5(this.gl,e,r):K5(this.gl,e,r)}getAttributeLocation(e,r){return this.throwIfDisposed(),we(this.gl,()=>this.gl.getAttribLocation(e,r))}getUniformLocationNoThrow(e,r){return this.throwIfDisposed(),this.gl.getUniformLocation(e,r)}setInputMatrixTexture(e,r,n){this.throwIfDisposed(),this.throwIfNoProgram(),X5(this.gl,e,r,n)}setOutputMatrixTexture(e,r,n){this.setOutputMatrixTextureDriver(e,n,r)}setOutputPackedMatrixTexture(e,r,n){this.throwIfDisposed();let[o,s]=Zi(r,n);this.setOutputMatrixTextureDriver(e,o,s)}setOutputMatrixWriteRegion(e,r,n,o){this.setOutputMatrixWriteRegionDriver(n,e,o,r)}setOutputPackedMatrixWriteRegion(e,r,n,o){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){this.program!=null&&vC(this.gl,this.program),L0(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();let e=this.gl;if(this.debug){let r=this.getVertexArray();console.assert(r===this.program.vao,"VAO changed between setProgram and executeProgram!"),this.debugValidate()}we(e,()=>e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),we(this.gl,()=>this.gl.finish())}getQueryTimerExtension(){return this.disjointQueryTimerExtension==null&&(this.disjointQueryTimerExtension=P0(this.gl,B().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(B().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){let n=this.gl,o=this.getQueryTimerExtensionWebGL2(),s=n.createQuery();return n.beginQuery(o.TIME_ELAPSED_EXT,s),s}let e=this.getQueryTimerExtensionWebGL1(),r=e.createQueryEXT();return e.beginQueryEXT(e.TIME_ELAPSED_EXT,r),r}endQuery(){if(B().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")===2){let r=this.gl,n=this.getQueryTimerExtensionWebGL2();r.endQuery(n.TIME_ELAPSED_EXT);return}let e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(e){return await w.repeatedTry(()=>this.disposed||this.isQueryAvailable(e,B().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))),this.getQueryTime(e,B().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(e,r){if(r===0)return null;if(r===2){let n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}else{let n=this.getQueryTimerExtensionWebGL1();return n.getQueryObjectEXT(e,n.QUERY_RESULT_EXT)/1e6}}isQueryAvailable(e,r){if(r===0)return!0;if(r===2){let n=this.gl,o=this.getQueryTimerExtensionWebGL2(),s=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(o.GPU_DISJOINT_EXT)),s&&!this.disjoint}else{let n=this.getQueryTimerExtensionWebGL1(),o=n.getQueryObjectEXT(e,n.QUERY_RESULT_AVAILABLE_EXT);return this.disjoint==null&&(this.disjoint=this.gl.getParameter(n.GPU_DISJOINT_EXT)),o&&!this.disjoint}}pollFence(e){return new Promise(r=>{this.addItemToPoll(()=>e.isFencePassed(),()=>r())})}pollItems(){let e=Tce(this.itemsToPoll.map(r=>r.isDoneFn));for(let r=0;r<=e;++r){let{resolveFn:n}=this.itemsToPoll[r];n()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}addItemToPoll(e,r){if(this.itemsToPoll.push({isDoneFn:e,resolveFn:r}),this.itemsToPoll.length>1)return;let n;"setTimeoutCustom"in B().platform&&(n=B().platform.setTimeoutCustom.bind(B().platform)),w.repeatedTry(()=>(this.pollItems(),this.itemsToPoll.length===0),()=>0,null,n)}bindTextureToFrameBuffer(e){this.throwIfDisposed(),wC(this.gl,e,this.framebuffer),this.debug&&L0(this.gl)}unbindTextureToFrameBuffer(){this.outputTexture!=null?(wC(this.gl,this.outputTexture,this.framebuffer),this.debug&&L0(this.gl)):z_(this.gl,this.framebuffer)}downloadMatrixDriver(e,r){this.bindTextureToFrameBuffer(e);let n=r();return this.unbindTextureToFrameBuffer(),n}setOutputMatrixTextureDriver(e,r,n){this.throwIfDisposed();let o=this.gl;wC(o,e,this.framebuffer),this.debug&&L0(o),this.outputTexture=e,we(o,()=>o.viewport(0,0,r,n)),we(o,()=>o.scissor(0,0,r,n))}setOutputMatrixWriteRegionDriver(e,r,n,o){this.throwIfDisposed(),we(this.gl,()=>this.gl.scissor(e,r,n,o))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(this.program==null)throw new Error("No GPU program is currently set.")}};function Tce(t){let e=0;for(;e<t.length&&t[e]();++e);return e-1}var{addImpl:EW,bincountImpl:AC,bincountReduceImpl:_W,castImpl:AW,ceilImpl:DW,concatImpl:$W,equalImpl:RW,expImpl:OW,expm1Impl:FW,floorImpl:PW,gatherNdImpl:LW,gatherV2Impl:MW,greaterImpl:zW,greaterEqualImpl:BW,lessImpl:VW,lessEqualImpl:WW,linSpaceImpl:GW,logImpl:UW,maxImpl:HW,maximumImpl:qW,minimumImpl:jW,multiplyImpl:KW,negImpl:XW,notEqualImpl:YW,prodImpl:QW,raggedGatherImpl:ZW,raggedRangeImpl:JW,raggedTensorToTensorImpl:eG,rangeImpl:tG,rsqrtImpl:rG,scatterImpl:nG,sigmoidImpl:oG,simpleAbsImpl:DC,sliceImpl:sG,sparseFillEmptyRowsImpl:iG,sparseReshapeImpl:aG,sparseSegmentReductionImpl:$C,sqrtImpl:lG,stridedSliceImpl:uG,stringNGramsImpl:cG,stringSplitImpl:pG,stringToHashBucketFastImpl:fG,subImpl:dG,tileImpl:mG,topKImpl:hG,transposeImpl:$f,uniqueImpl:gG}=v_;function j_(t,e){return["x","y","z","w","u","v"].slice(0,e).map(r=>`${t}.${r}`)}function ar(t,e){return e===1?[t]:j_(t,e)}function xG(t,e){if(t===1)return"rc";let r="";for(let n=0;n<t;n++)r+=e[n],n<t-1&&(r+=",");return r}var RC=class{constructor(e){if(this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.enableShapeUniforms=Tt(this.outputShape.length),this.rank===0)this.userCode=`
        void main() {
          setOutput(vec4(getA(), 0., 0., 0.));
        }
      `;else{let r=ar("rc",this.rank),n=He(this.rank),o=this.getOutOfBoundsCondition(r),s=this.getSetup(r),i=this.getOutput(r);this.userCode=`
        void main() {
          ${n} rc = getOutputCoords();

          if(${o}) {
            setOutput(vec4(0));
          } else {
            ${s}

            setOutput(vec4(${i}));
          }
        }
      `}}getSourceCoordsArr(e){let r=[];for(let n=0;n<=1;n++)for(let o=0;o<=1;o++){let s=`${n===0?"r":"rp1"}, ${o===0?"c":"cp1"}`;for(let i=2;i<this.rank;i++)s=`${e[e.length-1-i]},`+s;r.push(s)}return r}getOutOfBoundsCondition(e){if(this.rank===1)return`rc > ${this.enableShapeUniforms?"outShape":this.outputShape[0]}`;let r="";for(let n=this.rank-2;n<this.rank;n++)r+=`${e[n]} >= ${this.enableShapeUniforms?`outShape[${n}]`:this.outputShape[n]}`,n<this.rank-1&&(r+="||");return r}getSetup(e){if(this.rank===1)return"";let r=e.slice(-2),n=this.enableShapeUniforms?`outShape[${this.rank} - 1]`:this.outputShape[this.rank-1],o=this.enableShapeUniforms?`outShape[${this.rank} - 2]`:this.outputShape[this.rank-2];return`
      int r = ${r[0]};
      int c = ${r[1]};
      int rp1 = r + 1;
      int cp1 = c + 1;

      bool cEdge = cp1 >= ${n};
      bool rEdge = rp1 >= ${o};
    `}getOutput(e){let r=this.getSourceCoordsArr(e);return this.rank===1?`getA(rc), (rc + 1 >= ${this.enableShapeUniforms?"outShape":this.outputShape[0]} ? 0. : getA(rc + 1)), 0, 0`:`getA(${r[0]}),
            cEdge ? 0. : getA(${r[1]}),
            rEdge ? 0. : getA(${r[2]}),
            rEdge || cEdge ? 0. : getA(${r[3]})`}};var zh=class{constructor(e,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=e,this.enableShapeUniforms=Tt(this.outputShape.length);let n="";for(let o=0;o<4;o++){let s="thisRC = rc;";o%2===1&&(s+="thisRC.z += 1;"),o>1&&(s+="thisRC.y += 1;"),n+=`
        ${s}
        ${o>0?"if(thisRC.y < rows && thisRC.z < cols){":""}
          int flatIndex = getFlatIndex(thisRC);

          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);
          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));

          result[${o}] =
            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);
        ${o>0?"}":""}
      `}this.userCode=`
      ${Nce(r,this.enableShapeUniforms)}
      ${this.enableShapeUniforms?$h():Dh(e)}

      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0.);

        ivec3 thisRC;
        int rows = ${this.enableShapeUniforms?"outShape[1]":e[1]};
        int cols = ${this.enableShapeUniforms?"outShape[2]":e[2]};

        ${n}

        setOutput(result);
      }
    `}};function Nce(t,e){return`
    ivec3 inputCoordsFromReshapedOutCoords(int index) {
      ${e?nW(["r","c","d"],"inputShape"):mi(["r","c","d"],t)}
      return ivec3(r, c, d);
    }
  `}var OC=class{constructor(e){this.gpgpu=e,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}acquireTexture(e,r,n){let o=bG(r,n),s=vG(e,o,n);s in this.freeTextures||(this.freeTextures[s]=[]),s in this.usedTextures||(this.usedTextures[s]=[]);let i=yG(e,o,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[s].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=i,this.log();let l=this.freeTextures[s].shift();return this.usedTextures[s].push(l),l}let a;return o===un.PACKED_2X2_FLOAT32?a=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):o===un.PACKED_2X2_FLOAT16?a=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):o===un.UNPACKED_FLOAT32?a=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):o===un.UNPACKED_FLOAT16?a=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):o===un.PACKED_4X1_UNSIGNED_BYTE&&(a=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[s].push(a),this.numUsedTextures++,this._numBytesAllocated+=i,this.log(),a}releaseTexture(e,r,n,o){if(this.freeTextures==null)return;let s=bG(n,o),i=vG(r,s,o);i in this.freeTextures||(this.freeTextures[i]=[]);let a=yG(r,s,this.gpgpu.gl,this.gpgpu.textureConfig,o),l=B().get("WEBGL_DELETE_TEXTURE_THRESHOLD");l!==-1&&this._numBytesAllocated>l?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=a):(this.freeTextures[i].push(e),this.numFreeTextures++,this._numBytesFree+=a),this.numUsedTextures--;let u=this.usedTextures[i],c=u.indexOf(e);if(c<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u.splice(c,1),this.log()}log(){if(!this.logEnabled)return;let e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${e})`);let r=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*r)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(this.freeTextures!=null){for(let e in this.freeTextures)this.freeTextures[e].forEach(r=>{this.gpgpu.deleteMatrixTexture(r.texture)});for(let e in this.usedTextures)this.usedTextures[e].forEach(r=>{this.gpgpu.deleteMatrixTexture(r.texture)});this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}};function Ice(t,e){let r=t;if(e===r.R32F)return 4;if(e===r.R16F)return 2;if(e===r.RGBA32F)return 16;if(e===t.RGBA)return 16;if(e===r.RGBA16F)return 8;if(e===r.RGBA8)return 4;throw new Error(`Unknown internal format ${e}`)}function yG(t,e,r,n,o){let s=Ece(e,n),i;if(o){let[l,u]=Zi(t[0],t[1]);i=l*u}else{let[l,u]=Ef(t[0],t[1]);i=l*u}let a=Ice(r,s);return i*a}function Ece(t,e){switch(t){case un.PACKED_2X2_FLOAT32:return H_(e);case un.PACKED_2X2_FLOAT16:return q_(e);case un.UNPACKED_FLOAT32:return W_(e);case un.UNPACKED_FLOAT16:return G_(e);case un.PACKED_4X1_UNSIGNED_BYTE:return U_(e);default:throw new Error(`Unknown physical texture type ${t}`)}}function _ce(t){return B().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?un.PACKED_2X2_FLOAT32:un.UNPACKED_FLOAT32:t?un.PACKED_2X2_FLOAT16:un.UNPACKED_FLOAT16}function bG(t,e){if(t===Sn.UPLOAD)return un.PACKED_2X2_FLOAT32;if(t===Sn.RENDER||t==null)return _ce(e);if(t===Sn.DOWNLOAD||t===Sn.PIXELS)return un.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${t}`)}function vG(t,e,r){return`${t[0]}_${t[1]}_${e}_${r}`}var cn=class{constructor(e,r){this.variableNames=["A"],this.outputShape=e,this.enableShapeUniforms=Tt(this.outputShape.length),this.userCode=`
      float unaryOperation(float x) {
        ${r}
      }

      void main() {
        float x = getAAtOutCoords();
        float y = unaryOperation(x);

        setOutput(y);
      }
    `}},Rr="if (isnan(x)) return x;",wG="return x;",K_="return abs(x);";var CG="return (x >= 0.0) ? x : (exp(x) - 1.0);",SG=Rr+`
  return (x < 0.0) ? 0.0 : x;
`,kG=Rr+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,ea="return x;",TG="return 1.0 / (1.0 + exp(-1.0 * x));";var IG="return x;",EG=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,_G=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,AG=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,DG="return 1.0 / (1.0 + exp(-1.0 * x));",co=class{constructor(e,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.enableShapeUniforms=Tt(this.outputShape.length),this.userCode=`
      vec4 unaryOperation(vec4 x) {
        ${r}
      }

      void main() {
        vec4 x = getAAtOutCoords();
        vec4 y = unaryOperation(x);

        setOutput(y);
      }
    `}};var FC=class{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=e,this.enableShapeUniforms=Tt(this.outputShape.length);let r=e.length,n=ar("rc",r),o=He(r),s=xG(r,n),i=n.slice(-2),a=r<=1?"rc":`vec2(${i.join(",")})`;this.userCode=`
      void main() {
        ${o} rc = getOutputCoords();
        vec4 packedInput = getA(${s});

        setOutput(getChannel(packedInput, ${a}));
      }
    `}};var Dce=vn.whereImpl,$ce=1e-7,Rce=1e-4,PC={};function Oce(t){return t in PC||(PC[t]={}),PC[t]}var Fce=B().getNumber("CPU_HANDOFF_SIZE_THRESHOLD"),Pce=600;function Lce(){return B().global.screen==null?1024:B().global.screen.height*B().global.screen.width*window.devicePixelRatio*Pce/1024/1024}var Rf=class extends ya{constructor(e){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.lastGlFlushTime=0,this.warnedAboutMemory=!1,this.pendingDeletes=0,this.disposed=!1,!B().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");let r;if(e!=null){if(e instanceof Mh)r=e;else{let n=Ro(B().getNumber("WEBGL_VERSION"),e);r=new Mh(n)}this.binaryCache={},this.gpgpuCreatedLocally=!1}else{let n=Ro(B().getNumber("WEBGL_VERSION"));r=new Mh(n),this.binaryCache=Oce(B().getNumber("WEBGL_VERSION")),this.gpgpuCreatedLocally=!0}this.gpgpu=r,this.canvas=this.gpgpu.gl.canvas,this.textureManager=new OC(this.gpgpu),this.numMBBeforeWarning=Lce(),this.texData=new kp(this,gs())}nextDataId(){return Rf.nextDataId++}numDataIds(){return this.texData.numDataIds()-this.pendingDeletes}writeTexture(e,r,n,o,s,i){let a=this.makeTensorInfo(r,n),l=this.texData.get(a.dataId);l.isPacked=!1,l.texture={texture:e,texShape:[o,s]},l.texShape=[o,s];let u=M0(r),c=new z0(u,!1,i),p=this.runWebGLProgram(c,[a],n,[[o,s]]);return p.shape=r,l.texture=null,this.disposeIntermediateTensorInfo(a),p.dataId}write(e,r,n){if((B().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||B().getBool("DEBUG"))&&this.checkNumericalProblems(e),n==="complex64"&&e!=null)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");let o={id:this.nextDataId()};return this.texData.set(o,{shape:r,dtype:n,values:e,usage:Sn.UPLOAD,refCount:1}),o}refCount(e){return this.texData.has(e)?this.texData.get(e).refCount:0}incRef(e){let r=this.texData.get(e);r.refCount++}decRef(e){if(this.texData.has(e)){let r=this.texData.get(e);r.refCount--}}move(e,r,n,o,s){if(B().getBool("DEBUG")&&this.checkNumericalProblems(r),o==="complex64")throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:o,values:r,usage:Sn.UPLOAD,refCount:s})}disposeIntermediateTensorInfo(e){this.disposeData(e.dataId)}readSync(e){let r=this.texData.get(e),{values:n,dtype:o,complexTensorInfos:s,slice:i,shape:a,isPacked:l}=r;if(i!=null){let f;l?f=new co(a,ea):f=new cn(a,ea);let d=this.runWebGLProgram(f,[{dataId:e,shape:a,dtype:o}],o),m=this.readSync(d.dataId);return this.disposeIntermediateTensorInfo(d),m}if(n!=null)return this.convertAndCacheOnCPU(e);if(o==="string")return n;let u=this.activeTimers!=null,c;u&&(c=w.now());let p;if(o==="complex64"){let f=this.readSync(s.real.dataId),d=this.readSync(s.imag.dataId);p=T.mergeRealAndImagArrays(f,d)}else p=this.getValuesFromTexture(e);return u&&(this.downloadWaitMs+=w.now()-c),this.convertAndCacheOnCPU(e,p)}async read(e){if(this.pendingRead.has(e)){let m=this.pendingRead.get(e);return new Promise(h=>m.push(h))}let r=this.texData.get(e),{values:n,shape:o,slice:s,dtype:i,complexTensorInfos:a,isPacked:l}=r;if(s!=null){let m;l?m=new co(o,ea):m=new cn(o,ea);let h=this.runWebGLProgram(m,[{dataId:e,shape:o,dtype:i}],i),g=this.read(h.dataId);return this.disposeIntermediateTensorInfo(h),g}if(n!=null)return this.convertAndCacheOnCPU(e);if(B().getBool("DEBUG")&&!B().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&B().getNumber("WEBGL_VERSION")===2)throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let u=null,c;if(i!=="complex64"&&B().get("WEBGL_BUFFER_SUPPORTED")){c=this.decode(e);let m=this.texData.get(c.dataId);u=this.gpgpu.createBufferFromTexture(m.texture.texture,...O0(o))}this.pendingRead.set(e,[]),i!=="complex64"&&await this.gpgpu.createAndWaitForFence();let p;if(i==="complex64"){let m=await Promise.all([this.read(a.real.dataId),this.read(a.imag.dataId)]),h=m[0],g=m[1];p=T.mergeRealAndImagArrays(h,g)}else if(u==null)p=this.getValuesFromTexture(e);else{let m=w.sizeFromShape(o);p=this.gpgpu.downloadFloat32MatrixFromBuffer(u,m)}if(c!=null&&this.disposeIntermediateTensorInfo(c),u!=null){let m=this.gpgpu.gl;we(m,()=>m.deleteBuffer(u))}let f=this.convertAndCacheOnCPU(e,p),d=this.pendingRead.get(e);return this.pendingRead.delete(e),d.forEach(m=>m(f)),this.pendingDisposal.has(e)&&(this.pendingDisposal.delete(e),this.disposeData(e)&&gs().removeDataId(e,this),this.pendingDeletes--),f}readToGPU(e,r={}){let n=this.texData.get(e),{values:o,shape:s,slice:i,dtype:a,isPacked:l,texture:u}=n;if(a==="complex64")throw new Error("Does not support reading texture for complex64 dtype.");if(i!=null){let d;l?d=new co(s,ea):d=new cn(s,ea);let m=this.runWebGLProgram(d,[{dataId:e,shape:s,dtype:a}],a),h=this.readToGPU(m,r);return this.disposeIntermediateTensorInfo(m),h}if(u==null)throw o!=null?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");let c=this.decode(e,r.customTexShape),p=gs().makeTensorFromTensorInfo(c),f=this.texData.get(c.dataId);return Object.assign({tensorRef:p},f.texture)}bufferSync(e){let r=this.readSync(e.dataId);if(e.dtype==="string")try{let n=r.map(o=>w.decodeString(o));return Ee(e.shape,e.dtype,n)}catch{throw new Error("Failed to decode encoded string bytes into utf-8")}return Ee(e.shape,e.dtype,r)}checkNumericalProblems(e){if(e!=null)for(let r=0;r<e.length;r++){let n=e[r];if(!L5(n))throw B().getBool("WEBGL_RENDER_FLOAT32_CAPABLE")?Error(`The value ${n} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`):Error(`The value ${n} cannot be represented on this device.`)}}getValuesFromTexture(e){let{shape:r,dtype:n,isPacked:o}=this.texData.get(e),s=w.sizeFromShape(r);if(B().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){let f=this.decode(e),d=this.texData.get(f.dataId),m=this.gpgpu.downloadMatrixFromPackedTexture(d.texture.texture,...O0(r)).subarray(0,s);return this.disposeIntermediateTensorInfo(f),m}let i=B().getBool("WEBGL_PACK")&&o===!0,a=i?M0(r):r,l=i?new EC(a):new IC(a),u=this.runWebGLProgram(l,[{shape:a,dtype:n,dataId:e}],"float32"),c=this.texData.get(u.dataId),p=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(c.texture.texture,c.texShape[0],c.texShape[1]).subarray(0,s);return this.disposeIntermediateTensorInfo(u),p}timerAvailable(){return B().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}time(e){let r=this.activeTimers,n=[],o=!1;this.programTimersStack==null?(this.programTimersStack=n,o=!0):this.activeTimers.push(n),this.activeTimers=n,e();let s=w.flatten(this.activeTimers.map(l=>l.query)).filter(l=>l!=null),i=w.flatten(this.activeTimers.map(l=>l.name)).filter(l=>l!=null);this.activeTimers=r,o&&(this.programTimersStack=null);let a={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return(async()=>{if(B().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){let l=await Promise.all(s);a.kernelMs=w.sum(l),a.getExtraProfileInfo=()=>l.map((u,c)=>({name:i[c],ms:u})).map(u=>`${u.name}: ${u.ms}`).join(", ")}else a.kernelMs={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,a})()}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return B().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:w.now(),endMs:null}}endTimer(e){return B().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=w.now(),e)}async getQueryTime(e){if(B().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(e);let r=e;return r.endMs-r.startMs}disposeData(e,r=!1){if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(r?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!r&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);let{complexTensorInfos:n}=this.texData.get(e);return n!=null&&(this.disposeData(n.real.dataId,r),this.disposeData(n.imag.dataId,r)),this.texData.delete(e),!0}releaseGPUData(e){let{texture:r,dtype:n,texShape:o,usage:s,isPacked:i,slice:a}=this.texData.get(e),l=a&&a.origDataId||e,u=this.dataRefCount.get(l);u>1?this.dataRefCount.set(l,u-1):(this.dataRefCount.delete(l),r!=null&&(this.numBytesInGPU-=this.computeBytes(o,n),this.textureManager.releaseTexture(r,o,s,i)));let c=this.texData.get(e);c.texture=null,c.texShape=null,c.isPacked=!1,c.slice=null}getTexture(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}getDataInfo(e){return this.texData.get(e)}shouldExecuteOnCPU(e,r=Fce){return B().getBool("WEBGL_CPU_FORWARD")&&e.every(n=>this.texData.get(n.dataId).texture==null&&w.sizeFromShape(n.shape)<r)}getGPGPUContext(){return this.gpgpu}where(e){T.warn("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");let r=e.dataSync();return Dce(e.shape,r)}packedUnaryOp(e,r,n){let o=new co(e.shape,r),s=this.compileAndRun(o,[e],n);return gs().makeTensorFromTensorInfo(s)}abs(e){if(this.shouldExecuteOnCPU([e])&&e.dtype!=="complex64"){let o=DC(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,o)}if(B().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,K_,e.dtype);let r=new cn(e.shape,K_),n=this.compileAndRun(r,[e]);return gs().makeTensorFromTensorInfo(n)}makeTensorInfo(e,r,n){let o;if(r==="string"&&n!=null&&n.length>0&&w.isString(n[0])){let s=n.map(i=>w.encodeString(i));o=this.write(s,e,r)}else o=this.write(n,e,r);return this.texData.get(o).usage=null,{dataId:o,shape:e,dtype:r}}makeOutput(e,r,n){return gs().makeTensorFromTensorInfo(this.makeTensorInfo(e,r,n),this)}unpackTensor(e){let r=new FC(e.shape);return this.runWebGLProgram(r,[e],e.dtype)}packTensor(e){let r=new RC(e.shape),n=!0;return this.runWebGLProgram(r,[e],e.dtype,null,n)}packedReshape(e,r){let n=[Dc(e.shape),...$c(e.shape)],o={dtype:e.dtype,shape:n,dataId:e.dataId},s=[Dc(r),...$c(r)],i=new zh(s,n),a=!0,l=[n],u=this.runWebGLProgram(i,[o],e.dtype,l,a);return{dataId:u.dataId,shape:r,dtype:u.dtype}}decode(e,r){let n=this.texData.get(e),{isPacked:o,shape:s,dtype:i}=n;if(r!=null){let f=w.sizeFromShape(s),d=r[0]*r[1]*4;w.assert(f<=d,()=>"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data.")}let a=M0(s),l;o?l=new NC(a):l=new TC(a);let u=!0,c=[r??O0(a)],p=this.runWebGLProgram(l,[{shape:a,dtype:i,dataId:e}],i,c,u,r);return{dtype:i,shape:s,dataId:p.dataId}}runWebGLProgram(e,r,n,o,s=!1,i){let a=this.makeTensorInfo(e.outputShape,n),l=this.texData.get(a.dataId);if(e.packedOutput&&(l.isPacked=!0),e.outPackingScheme===Ac.DENSE){let x=i??O0(e.outputShape);l.texShape=x.map(y=>y*2)}if(e.outTexUsage!=null&&(l.usage=e.outTexUsage),w.sizeFromShape(a.shape)===0)return l.values=w.getTypedArrayFromDType(a.dtype,0),a;let u=[],c=r.map(x=>{if(x.dtype==="complex64")throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let y=this.texData.get(x.dataId);if(y.texture==null){if(!e.packedInputs&&w.sizeFromShape(x.shape)<=B().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:x.shape,texData:null,isUniform:!0,uniformValues:y.values};e.packedInputs&&(y.isPacked=!0,y.shape=x.shape)}if(this.uploadToGPU(x.dataId),!!y.isPacked!=!!e.packedInputs)x=y.isPacked?this.unpackTensor(x):this.packTensor(x),u.push(x),y=this.texData.get(x.dataId);else if(y.isPacked&&!_f(y.shape,x.shape)){let b=x,v=x.shape;x.shape=y.shape,x=this.packedReshape(x,v),u.push(x),y=this.texData.get(x.dataId),b.shape=v}return{shape:x.shape,texData:y,isUniform:!1}});this.uploadToGPU(a.dataId);let p={shape:a.shape,texData:l,isUniform:!1},f=pW(e,c,p),d=this.getAndSaveBinary(f,()=>uW(this.gpgpu,e,c,p)),m=this.activeTimers!=null,h;m&&(h=this.startTimer()),B().get("ENGINE_COMPILE_ONLY")||cW(this.gpgpu,d,c,p,o),u.forEach(x=>this.disposeIntermediateTensorInfo(x)),m&&(h=this.endTimer(h),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(h)}));let g=B().get("WEBGL_FLUSH_THRESHOLD");if(g>0){let x=w.now();x-this.lastGlFlushTime>g&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=x)}if(!B().getBool("WEBGL_LAZILY_UNPACK")&&l.isPacked&&s===!1){let x=this.unpackTensor(a);return this.disposeIntermediateTensorInfo(a),x}return a}compileAndRun(e,r,n,o,s=!1){return n=n||r[0].dtype,this.runWebGLProgram(e,r,n,o,s)}getAndSaveBinary(e,r){return e in this.binaryCache||(this.binaryCache[e]=r()),this.binaryCache[e]}getTextureManager(){return this.textureManager}dispose(){this.disposed||(B().getBool("IS_TEST")||Object.keys(this.binaryCache).forEach(r=>{this.gpgpu.deleteProgram(this.binaryCache[r].webGLProgram),delete this.binaryCache[r]}),this.textureManager.dispose(),this.canvas!=null&&typeof HTMLCanvasElement<"u"&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0)}floatPrecision(){return this.floatPrecisionValue==null&&(this.floatPrecisionValue=U(()=>{if(!B().get("WEBGL_RENDER_FLOAT32_ENABLED")){let e=B().getBool("DEBUG");B().set("DEBUG",!1);let r=this.abs(Fe(1e-8)).dataSync()[0];if(B().set("DEBUG",e),r>0)return 32}return 16})),this.floatPrecisionValue}epsilon(){return this.floatPrecision()===32?$ce:Rce}uploadToGPU(e){let r=this.texData.get(e),{shape:n,dtype:o,values:s,texture:i,usage:a,isPacked:l}=r;if(i!=null)return;let u=this.activeTimers!=null,c;u&&(c=w.now());let p=r.texShape;if(p==null&&(p=Y5(n,l),r.texShape=p),s!=null){let f=M0(n),d,m=p[1],h=p[0],g=s instanceof Uint8Array||s instanceof Uint8ClampedArray;(l||!g)&&([m,h]=Zi(p[0],p[1])),l?d=new _C(f,g):d=new z0(f,g);let x=g?[h,m]:p,y=this.makeTensorInfo(x,o),b=this.texData.get(y.dataId);g?b.usage=Sn.PIXELS:b.usage=Sn.UPLOAD,b.texShape=x,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(y.dataId),m,h,s);let v=[[h,m]],C=!0,S=this.runWebGLProgram(d,[y],o,v,C),k=this.texData.get(S.dataId);r.texShape=k.texShape,r.isPacked=k.isPacked,r.usage=k.usage,B().get("ENGINE_COMPILE_ONLY")?this.disposeData(S.dataId):(r.texture=k.texture,r.values=null,this.texData.delete(S.dataId)),this.disposeIntermediateTensorInfo(y),u&&(this.uploadWaitMs+=w.now()-c)}else{let f=this.acquireTexture(p,a,o,l);r.texture=f}}convertAndCacheOnCPU(e,r){let n=this.texData.get(e),{dtype:o}=n;return r!=null&&(n.values=Mce(r,o)),n.values}acquireTexture(e,r,n,o){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>this.numMBBeforeWarning*1024*1024){let s=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${s} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(e,r,o)}computeBytes(e,r){return e[0]*e[1]*w.bytesPerElement(r)}checkCompileCompletion(){for(let[,e]of Object.entries(this.binaryCache))this.checkCompletion_(e)}async checkCompileCompletionAsync(){let e=[];if(this.gpgpu.parallelCompilationExtension){for(let[,r]of Object.entries(this.binaryCache))e.push(this.checkCompletionAsync_(r));return Promise.all(e)}else{for(let[,r]of Object.entries(this.binaryCache)){let n=new Promise(o=>{try{this.checkCompletion_(r),o(!0)}catch(s){throw s}});e.push(n)}return Promise.all(e)}}async checkCompletionAsync_(e){return this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)?this.checkCompletion_(e):(await Qx(),this.checkCompletionAsync_(e))}checkCompletion_(e){if(this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)===!1)throw console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS)===!1?(L_(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.")):new Error("Failed to link vertex and fragment shaders.");return!0}getUniformLocations(){for(let[,e]of Object.entries(this.binaryCache)){let{uniformLocations:r,customUniformLocations:n,infLoc:o,nanLoc:s,inShapesLocations:i,inTexShapesLocations:a,outShapeLocation:l,outShapeStridesLocation:u,outTexShapeLocation:c}=V_(this.gpgpu,e.program,e.webGLProgram);e.uniformLocations=r,e.customUniformLocations=n,e.infLoc=o,e.nanLoc=s,e.inShapesLocations=i,e.inTexShapesLocations=a,e.outShapeLocation=l,e.outShapeStridesLocation=u,e.outTexShapeLocation=c}}createTensorFromTexture(e,r,n){let{texture:o,height:s,width:i,channels:a}=e,l=gs().backend;if(!l.gpgpu.gl.isTexture(o))throw new Error("The texture is invalid. Also, please make sure the texture and the TFJS WebGL backend are using the same canvas. If you want to use your own custom canvas, you have to create and use the custom TFJS WebGL backend created from the canvas through 'new tf.MathBackendWebGL(customCanvas)'.");let u=l.writeTexture(o,r,n,s,i,a);return gs().makeTensorFromDataId(u,r,n,l)}};Rf.nextDataId=0;function Mce(t,e){if(e==="float32"||e==="complex64")return t;if(e==="int32"||e==="bool"){let r=e==="int32"?new Int32Array(t.length):new Uint8Array(t.length);for(let n=0;n<r.length;++n)r[n]=Math.round(t[n]);return r}else throw new Error(`Unknown dtype ${e}`)}dc.isBrowser()&&b1("webgl",()=>new Rf,2);var Bh=`
  if (isnan(a)) return a;
  if (isnan(b)) return b;
`;var ts=class{constructor(e,r,n){this.variableNames=["A","B"],this.outputShape=T.assertAndGetBroadcastShape(r,n),this.enableShapeUniforms=Tt(this.outputShape.length),this.userCode=`
      float binaryOperation(float a, float b) {
        ${e}
      }

      void main() {
        float a = getAAtOutCoords();
        float b = getBAtOutCoords();
        setOutput(binaryOperation(a, b));
      }
    `}};var ta=`
  result.r = isNaN.r ? NAN : result.r;
  result.g = isNaN.g ? NAN : result.g;
  result.b = isNaN.b ? NAN : result.b;
  result.a = isNaN.a ? NAN : result.a;
`;var Fs=class{constructor(e,r,n,o=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=T.assertAndGetBroadcastShape(r,n);let s=this.outputShape.length;this.enableShapeUniforms=Tt(s);let i="";if(o)if(s===0||w.sizeFromShape(this.outputShape)===1)i=`
          result.y = 0.;
          result.z = 0.;
          result.w = 0.;
        `;else if(i=`
          ${He(s)} coords = getOutputCoords();
        `,s===1)this.enableShapeUniforms?i+=`
            result.y = (coords + 1) >= outShape ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `:i+=`
            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;
            result.z = 0.;
            result.w = 0.;
          `;else{let l=ar("coords",s);this.enableShapeUniforms?i+=`
            bool nextRowOutOfBounds =
              (${l[s-2]} + 1) >= outShape[${s} - 2];
            bool nextColOutOfBounds =
              (${l[s-1]} + 1) >= outShape[${s} - 1];
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `:i+=`
            bool nextRowOutOfBounds =
              (${l[s-2]} + 1) >= ${this.outputShape[s-2]};
            bool nextColOutOfBounds =
              (${l[s-1]} + 1) >= ${this.outputShape[s-1]};
            result.y = nextColOutOfBounds ? 0. : result.y;
            result.z = nextRowOutOfBounds ? 0. : result.z;
            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;
          `}this.userCode=`
      vec4 binaryOperation(vec4 a, vec4 b) {
        ${e}
      }

      void main() {
        vec4 a = getAAtOutCoords();
        vec4 b = getBAtOutCoords();

        vec4 result = binaryOperation(a, b);
        ${i}

        setOutput(result);
      }
    `}};function lr(t){let{inputs:e,backend:r}=t,{x:n}=e;return r.incRef(n.dataId),{dataId:n.dataId,shape:n.shape,dtype:n.dtype}}var $G={kernelName:Oi,backendName:"webgl",kernelFunc:lr};function po(t){let{inputs:e,backend:r}=t,{real:n,imag:o}=e,s=r.makeTensorInfo(n.shape,"complex64"),i=r.texData.get(s.dataId),a=lr({inputs:{x:n},backend:r}),l=lr({inputs:{x:o},backend:r});return i.complexTensorInfos={real:a,imag:l},s}var RG={kernelName:Vd,backendName:"webgl",kernelFunc:po};var X_="return (a < 0.) ? b * a : a;",Y_=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function zce(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{alpha:s}=n,i=r.makeTensorInfo([],"float32",w.createScalarValue(s,"float32")),a=B().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Fs(Y_,o.shape,i.shape):new ts(X_,o.shape,i.shape),l=r.runWebGLProgram(a,[o,i],"float32");return r.disposeIntermediateTensorInfo(i),l}var OG={kernelName:Lu,backendName:"webgl",kernelFunc:zce};var Q_="return (a < 0.) ? b * a : a;",Z_=`
  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));
  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);
`;function Bce(t){let{inputs:e,backend:r}=t,{x:n,alpha:o}=e,s=B().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Fs(Z_,n.shape,o.shape):new ts(Q_,n.shape,o.shape);return r.runWebGLProgram(s,[n,o],"float32")}var FG={kernelName:Yu,backendName:"webgl",kernelFunc:Bce};var Ps="if (isnan(x)) return x;";function Ne({opSnippet:t,packedOpSnippet:e,cpuKernelImpl:r,dtype:n}){return({inputs:o,backend:s})=>{let{x:i}=o,a=s,l=n||i.dtype;if(a.shouldExecuteOnCPU([i])&&r!=null){let p=a.texData.get(i.dataId),f=r(p.values,l);return a.makeTensorInfo(i.shape,l,f)}let u=B().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&e!=null,c;return u?c=new co(i.shape,e):c=new cn(i.shape,t),a.runWebGLProgram(c,[i],l)}}function ut({opSnippet:t,packedOpSnippet:e,checkOutOfBounds:r=!1,supportsComplex:n=!1,cpuKernelImpl:o,dtype:s}){return({inputs:i,backend:a})=>{let{a:l,b:u}=i,c=a;if(n&&l.dtype==="complex64"){let m=c.texData.get(l.dataId),h=c.texData.get(u.dataId),[g,x]=[[m.complexTensorInfos.real,h.complexTensorInfos.real],[m.complexTensorInfos.imag,h.complexTensorInfos.imag]].map(b=>{let[v,C]=b,S={dataId:v.dataId,dtype:v.dtype,shape:l.shape},k={dataId:C.dataId,dtype:C.dtype,shape:u.shape},N=new ts(t,l.shape,u.shape);return c.runWebGLProgram(N,[S,k],wr(v.dtype,C.dtype))}),y=po({inputs:{real:g,imag:x},backend:c});return c.disposeIntermediateTensorInfo(g),c.disposeIntermediateTensorInfo(x),y}let p=s||wr(l.dtype,u.dtype);if((l.dtype==="string"||u.dtype==="string"||c.shouldExecuteOnCPU([l,u]))&&o!=null){let m=c.texData.get(l.dataId).values,h=c.texData.get(u.dataId).values,g=l.dtype==="string"?T.fromUint8ToStringArray(m):m,x=l.dtype==="string"?T.fromUint8ToStringArray(h):h,[y,b]=o(l.shape,u.shape,g,x,p),v=c.makeTensorInfo(b,p),C=c.texData.get(v.dataId);return C.values=y,v}let f=B().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&e!=null,d;return f?d=new Fs(e,l.shape,u.shape,r):d=new ts(t,l.shape,u.shape),c.runWebGLProgram(d,[l,u],p)}}function Pl(t,e=!1){if(t==="linear")return e?IG:wG;if(t==="relu")return e?_G:SG;if(t==="elu")return e?EG:CG;if(t==="relu6")return e?AG:kG;if(t==="prelu")return e?Z_:Q_;if(t==="leakyrelu")return e?Y_:X_;if(t==="sigmoid")return e?DG:TG;throw new Error(`Activation ${t} has not been implemented for the WebGL backend.`)}var Vh=class{constructor(e,r,n,o=!1,s=!1,i=!1,a=null,l=!1,u=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n,this.enableShapeUniforms=Tt(this.outputShape.length);let c=o?e[1]:e[2],p=Math.ceil(c/2),f=o?"i * 2, rc.y":"rc.y, i * 2",d=s?"rc.z, i * 2":"i * 2, rc.z",m=o?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],h=s?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],g="",x="";a&&(l?g=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${a}
        }`:u?g=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${a}
        }`:g=`vec4 activation(vec4 x) {
          ${a}
        }`,x="result = activation(result);");let y=i?"result += getBiasAtOutCoords();":"";i&&this.variableNames.push("bias"),l&&this.variableNames.push("preluActivationWeights"),u&&this.variableNames.push("leakyreluAlpha");let b="rc.x",v="rc.x";e[0]<r[0]?b=`int(min(float(rc.x), ${e[0]-1}.))`:r[0]<e[0]&&(v=`int(min(float(rc.x), ${r[0]-1}.))`),this.userCode=`
      ${g}
      // Don't use uniform for sharedDimensionPacked for performance.
      const float sharedDimension = ${p}.0;

      vec4 dot2x2ARowBCol(ivec3 rc) {
        vec4 result = vec4(0);
        for (int i = 0; i < ${p}; i++) {
          int batchA = ${b};
          int batchB = ${v};
          vec4 a = getMatrixA(batchA, ${f});
          vec4 b = getMatrixB(batchB, ${d});

          // These swizzled products need to be separately added.
          // See: https://github.com/tensorflow/tfjs/issues/1735
          result += (${m[0]} * ${h[0]});
          result += (${m[1]} * ${h[1]});
        }
        return result;
      }

      void main() {
        ivec3 rc = getOutputCoords();
        vec4 result = dot2x2ARowBCol(rc);

        ${y}

        ${x}

        setOutput(result);
      }
    `}};var J_={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"},V0=class{constructor(e,r,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=T.assertAndGetBroadcastShape(r,n),this.userCode=`
      float binaryOpComplex(
          float areal, float aimag, float breal, float bimag) {
        ${e}
      }

      void main() {
        float areal = getARealAtOutCoords();
        float aimag = getAImagAtOutCoords();
        float breal = getBRealAtOutCoords();
        float bimag = getBImagAtOutCoords();
        setOutput(binaryOpComplex(areal, aimag, breal, bimag));
      }
    `}};var PG="return a * b;";function W0(t){let{inputs:e,backend:r}=t,{a:n,b:o}=e,s=T.upcastType(n.dtype,o.dtype);if(n.dtype==="complex64"){let a=r.texData.get(n.dataId),l=r.texData.get(o.dataId),u=new V0(J_.REAL,n.shape,o.shape),c=new V0(J_.IMAG,n.shape,o.shape),p=[{dataId:a.complexTensorInfos.real.dataId,dtype:a.complexTensorInfos.real.dtype,shape:n.shape},{dataId:a.complexTensorInfos.imag.dataId,dtype:a.complexTensorInfos.imag.dtype,shape:n.shape},{dataId:l.complexTensorInfos.real.dataId,dtype:l.complexTensorInfos.real.dtype,shape:o.shape},{dataId:l.complexTensorInfos.imag.dataId,dtype:l.complexTensorInfos.imag.dtype,shape:o.shape}],f=r.runWebGLProgram(u,p,"float32"),d=r.runWebGLProgram(c,p,"float32"),m=po({inputs:{real:f,imag:d},backend:r});return r.disposeIntermediateTensorInfo(f),r.disposeIntermediateTensorInfo(d),m}if(r.shouldExecuteOnCPU([n,o])){let a=r.texData.get(n.dataId),l=r.texData.get(o.dataId),[u,c]=KW(n.shape,o.shape,a.values,l.values,s),p=r.makeTensorInfo(c,s),f=r.texData.get(p.dataId);return f.values=u,p}let i;return B().getBool("WEBGL_PACK_BINARY_OPERATIONS")?i=new Fs(PG,n.shape,o.shape):i=new ts(PG,n.shape,o.shape),r.runWebGLProgram(i,[n,o],s)}var LG={kernelName:ja,backendName:"webgl",kernelFunc:W0};function MG(t,e,r){let n=[Dc(t.shape),...$c(t.shape)],o={dtype:t.dtype,shape:n,dataId:t.dataId},s=[Dc(e),...$c(e)],i=new zh(s,n),a=!0,l=[n],u=r.runWebGLProgram(i,[o],t.dtype,l,a);return{dataId:u.dataId,shape:e,dtype:u.dtype}}function ce(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{shape:s}=n,i=r,a=w.sizeFromShape(o.shape),l=w.inferFromImplicitShape(s,a),u=w.sizeFromShape(l);w.assert(a===u,()=>`The new shape (${l}) has ${u} elements and the old shape (${o.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`);let c=i.texData.get(o.dataId);return c.isPacked&&!_f(o.shape,l)&&!(c.texture!==null&&_f(c.shape,l))?MG(o,l,i):(i.incRef(o.dataId),{dataId:o.dataId,shape:l,dtype:o.dtype})}var zG={kernelName:Zu,backendName:"webgl",kernelFunc:ce};var G0=class{constructor(e,r){this.variableNames=["x"];let{windowSize:n,batchSize:o,inSize:s,outSize:i}=e;this.outputShape=[o,i];let a=Math.floor(n/4)*4,l=n%4,u="sumValue += dot(values, ones);";if(r!=null){let p=1/r;u=`sumValue += dot(values * ${w.isInt(p)?p.toPrecision(2):p}, ones);`}let c="";s%n>0&&(c=`
        if (inIdx < 0 || inIdx >= ${s}) {
          return 0.0;
        }
      `),this.userCode=`
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${c}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${n};

        float sumValue = 0.0;

        for (int i = 0; i < ${a}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${u}
        }

        int inIdx = inOffset + ${a};
        if (${l===1}) {
          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);

          ${u}
        } else if (${l===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1), 0.0, 0.0);

          ${u}
        } else if (${l===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2), 0.0);

          ${u}
        }
        setOutput(sumValue);
      }
    `}};var LC=class{constructor(e,r){this.variableNames=["x"];let{windowSize:n,batchSize:o,inSize:s,outSize:i}=e;this.outputShape=[o,i];let a="0.0",l="";r==="prod"?a="1.0":r==="min"?(a="1.0 / 1e-20",l="min"):r==="max"&&(a="-1.0 / 1e-20",l="max");let u=`${r}(${r}(${r}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;r==="sum"?u="sumValue":r==="prod"?u="prodValue":r==="all"?u="allValue":r==="any"&&(u="anyValue");let c=Math.floor(n/4)*4,p=n%4,f=`
      if (${r==="sum"}) {
        sumValue += dot(values, ones);
      } else if (${r==="prod"}) {
        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);
        prodValue *= tmp[0] * tmp[1];
      } else {
        minMaxValue = ${l}(values, minMaxValue);
        if (${r==="min"} || ${r==="max"}) {
          minMaxValue = ${l}(values, minMaxValue);
          bvec4 isNaN = isnan(values);
          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {
            minMaxValue = vec4(NAN);
          }
        }
      }
    `,d="vec4";r==="all"?(a="1.0",f=`
        bool reducedAllValue = all(values);
        float floatedReducedAllValue = float(reducedAllValue);
        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);
      `,d="bvec4"):r==="any"&&(a="0.0",f=`
        bool reducedAnyValue = any(values);
        float floatedReducedAnyValue = float(reducedAnyValue);
        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);
      `,d="bvec4");let m="";s%n>0&&(m=`
        if (inIdx < 0 || inIdx >= ${s}) {
          return initializationValue;
        }
      `),this.userCode=`
      const float initializationValue = ${a};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float getValue(int batch, int inIdx) {
        ${m}
        return getX(batch, inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${n};

        vec4 minMaxValue = vec4(${a});
        float prodValue = 1.0;
        float sumValue = 0.0;
        float allValue = 1.0;
        float anyValue = 0.0;

        for (int i = 0; i < ${c}; i += 4) {
          int inIdx = inOffset + i;
          ${d} values = ${d}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          ${f}
        }

        int inIdx = inOffset + ${c};
        if (${p===1}) {
          ${d} values = ${d}(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          ${f}
        } else if (${p===2}) {
          ${d} values = ${d}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          ${f}
        } else if (${p===3}) {
          ${d} values = ${d}(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          ${f}
        }
        setOutput(${u});
      }
    `}};function Wce(t){let e=[];for(;e.length===0||e[e.length-1].outSize!==1;){let r=e.length?e[e.length-1].outSize:t[1],n=T.computeOptimalWindowSize(r);e.push({inSize:r,windowSize:n,outSize:Math.ceil(r/n)})}return e}function Oo(t,e,r,n){let o=Wce(t.shape),s=t;for(let i=0;i<o.length;i++){let{inSize:a,windowSize:l,outSize:u}=o[i],c,p;r==="mean"?c=i===0?new G0({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:u},a):new G0({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:u}):c=new LC({windowSize:l,inSize:a,batchSize:t.shape[0],outSize:u},r),p=s,s=n.runWebGLProgram(c,[s],e),p.dataId!==t.dataId&&n.disposeIntermediateTensorInfo(p)}return s}var MC=class{constructor(e,r){this.variableNames=["A"];let n=new Array(e.length);for(let i=0;i<n.length;i++)n[i]=e[r[i]];this.outputShape=n,this.rank=n.length;let o=He(this.rank),s=Gce(r);this.userCode=`
    void main() {
      ${o} resRC = getOutputCoords();
      setOutput(getA(${s}));
    }
    `}};function Gce(t){let e=t.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);let r=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],n=new Array(e);for(let o=0;o<t.length;o++)n[t[o]]=r[o];return n.join()}var zC=class{constructor(e,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;let n=new Array(e.length);for(let c=0;c<n.length;c++)n[c]=e[r[c]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);let o=He(this.rank),s=j_("rc",this.rank),i=new Array(this.rank);for(let c=0;c<r.length;c++)i[r[c]]=s[c];let a=`vec2(${i.slice(-2).join()})`,l=`++${s[this.rank-1]} < ${n[this.rank-1]}`,u=`getChannel(getA(${i.join()}), ${a})`;this.userCode=`
    void main() {
      ${o} rc = getOutputCoords();
      vec4 result = vec4(0.);
      result[0] = ${u};
      if(${l}) {
        result[1] = ${u};
      }
      --${s[this.rank-1]};
      if(++${s[this.rank-2]} < ${n[this.rank-2]}) {
        result[2] = ${u};
        if(${l}) {
          result[3] = ${u};
        }
      }
      setOutput(result);
    }
    `}};function Rc(t,e,r){let n=B().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new zC(t.shape,e):new MC(t.shape,e);return r.runWebGLProgram(n,[t],t.dtype)}function BG(t,e,r,n){let o=e,s=t.shape.length,i=w.parseAxisParam(o,t.shape),a=i,l=T.getAxesPermutation(a,s),u=l!=null,c=t;u&&(c=Rc(t,l,n),a=T.getInnerMostAxes(a.length,s)),T.assertAxesAreInnerMostDims("sum",a,s);let[p,f]=T.computeOutAndReduceShapes(c.shape,a),d=p;r&&(d=T.expandShapeToKeepDim(p,i));let m=w.sizeFromShape(f),g=w.sizeFromShape(t.shape)/m,x=ce({inputs:{x:c},attrs:{shape:[g,m]},backend:n}),y=Up(t.dtype),b=Oo(x,y,"sum",n),v=ce({inputs:{x:b},attrs:{shape:d},backend:n});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(b),u&&n.disposeIntermediateTensorInfo(c),v}function Of(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{axis:s,keepDims:i}=n;return BG(o,s,i,r)}var VG={kernelName:oc,backendName:"webgl",kernelFunc:Of};function Gt(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{perm:s}=n,i=r,a=o.shape.length,l=new Array(a);for(let c=0;c<l.length;c++)l[c]=o.shape[s[c]];let u;if(i.shouldExecuteOnCPU([o])){let p=i.texData.get(o.dataId).values,f=$f(p,o.shape,o.dtype,s,l);u=i.makeTensorInfo(l,o.dtype);let d=i.texData.get(u.dataId);d.values=f}else u=Rc(o,s,i);return u}var WG={kernelName:Pi,backendName:"webgl",kernelFunc:Gt};var eA=1e3;function Ff({a:t,b:e,transposeA:r,transposeB:n,backend:o,bias:s=null,preluActivationWeights:i=null,leakyreluAlpha:a=0,activation:l=null}){let u=t.shape.length,c=e.shape.length,p=r?t.shape[u-2]:t.shape[u-1],f=n?e.shape[c-1]:e.shape[c-2],d=r?t.shape[u-1]:t.shape[u-2],m=n?e.shape[c-2]:e.shape[c-1],h=t.shape.slice(0,-2),g=e.shape.slice(0,-2),x=w.sizeFromShape(h),y=w.sizeFromShape(g),v=No.assertAndGetBroadcastShape(t.shape.slice(0,-2),e.shape.slice(0,-2)).concat([d,m]);w.assert(p===f,()=>`Error in matMul: inner shapes (${p}) and (${f}) of Tensors with shapes ${t.shape} and ${e.shape} and transposeA=${r} and transposeB=${n} must match.`);let C=r?[x,p,d]:[x,d,p],S=n?[y,m,f]:[y,f,m],k=ce({inputs:{x:t},backend:o,attrs:{shape:C}}),N=ce({inputs:{x:e},backend:o,attrs:{shape:S}}),D=[k,N],$=Math.max(x,y),O=r?k.shape[1]:k.shape[2],V=s!=null,K=i!=null,X=l==="leakyrelu",W=l!=null?Pl(l,!0):null,H=V||K||X||W!=null,Y;if((d===1||m===1)&&O>eA&&H===!1){let Q=k,se=N;r&&(Q=Gt({inputs:{x:k},backend:o,attrs:{perm:[0,2,1]}}),D.push(Q)),n&&(se=Gt({inputs:{x:N},backend:o,attrs:{perm:[0,2,1]}}),D.push(se));let ne=m!==1,re=m===1,ue=Q;ne&&(ue=ce({inputs:{x:Q},backend:o,attrs:{shape:[$,O,1]}}),D.push(ue));let ae=m===1?2:1,le=se;re&&(le=ce({inputs:{x:se},backend:o,attrs:{shape:[$,1,O]}}),D.push(le));let me=W0({inputs:{a:ue,b:le},backend:o});Y=Of({inputs:{x:me},backend:o,attrs:{axis:ae,keepDims:!0}}),D.push(me)}else{let Q=wr(t.dtype,e.dtype),se=new Vh(C,S,[$,d,m],r,n,V,W,K,X),ne=[k,N];if(s!=null&&ne.push(s),K&&ne.push(i),X){let re=o.makeTensorInfo([],"float32",w.createScalarValue(a,"float32"));ne.push(re),D.push(re)}Y=o.runWebGLProgram(se,ne,Q)}let Z=ce({inputs:{x:Y},backend:o,attrs:{shape:v}});D.push(Y);for(let Q of D)o.disposeIntermediateTensorInfo(Q);return Z}function Uce(t){let{inputs:e,backend:r,attrs:n}=t,{a:o,b:s,bias:i,preluActivationWeights:a}=e,{transposeA:l,transposeB:u,activation:c,leakyreluAlpha:p}=n;return Ff({a:o,b:s,transposeA:l,transposeB:u,backend:r,bias:i,preluActivationWeights:a,leakyreluAlpha:p,activation:c})}var GG={kernelName:Pp,backendName:"webgl",kernelFunc:Uce};var UG="return abs(x);";function Hce(t){let{inputs:e,backend:r}=t,{x:n}=e;if(r.shouldExecuteOnCPU([n])&&n.dtype!=="complex64"){let s=r.texData.get(n.dataId),i=DC(s.values);return r.makeTensorInfo(n.shape,n.dtype,i)}let o;return B().getBool("WEBGL_PACK_UNARY_OPERATIONS")?o=new co(n.shape,UG):o=new cn(n.shape,UG),r.runWebGLProgram(o,[n],n.dtype)}var HG={kernelName:bu,backendName:"webgl",kernelFunc:Hce};var qce=Rr+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return acos(x);
`,jce=Ne({opSnippet:qce}),qG={kernelName:va,backendName:"webgl",kernelFunc:jce};var Kce=Rr+`
  if (x < 1.0) return NAN;
return log(x + sqrt(x * x - 1.0));`,Xce=Ne({opSnippet:Kce}),jG={kernelName:wa,backendName:"webgl",kernelFunc:Xce};var KG="return a + b;",Yce=ut({opSnippet:KG,packedOpSnippet:KG,supportsComplex:!0,cpuKernelImpl:EW}),XG={kernelName:ti,backendName:"webgl",kernelFunc:Yce};var BC=class{constructor(e,r){this.outputShape=[],this.outputShape=e,this.variableNames=r.map((s,i)=>`T${i}`);let n=[];this.variableNames.forEach(s=>{n.push(`float v${s} = get${s}AtOutCoords();`)});let o=this.variableNames.map(s=>`v${s}`).join(" + ");this.userCode=`
      void main() {
        ${n.join(`
        `)}

        float result = ${o};
        setOutput(result);
      }
    `}};var VC=class{constructor(e,r){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.variableNames=r.map((s,i)=>`T${i}`);let n=[];this.variableNames.forEach(s=>{n.push(`vec4 v${s} = get${s}AtOutCoords();`)});let o=this.variableNames.map(s=>`v${s}`).join(" + ");this.userCode=`
      void main() {
        ${n.join(`
        `)}

        vec4 result = ${o};
        setOutput(result);
      }
    `}};function WC(t){let{inputs:e,backend:r}=t,n=e;if(n.length===1)return lr({inputs:{x:n[0]},backend:r});if(n.length>B().get("WEBGL_MAX_TEXTURES_IN_SHADER")){let l=Math.floor(n.length/2),u=WC({inputs:n.slice(0,l),backend:r}),c=WC({inputs:n.slice(l),backend:r});return WC({inputs:[u,c],backend:r})}let o=n.map(l=>l.dtype).reduce((l,u)=>wr(l,u)),s=n.map(l=>l.shape),a=B().getBool("WEBGL_PACK")?new VC(n[0].shape,s):new BC(n[0].shape,s);return r.runWebGLProgram(a,n,o)}var YG={kernelName:Fd,backendName:"webgl",kernelFunc:WC};function Qce(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{axis:s,keepDims:i}=n,a=o.shape.length,l=w.parseAxisParam(s,o.shape),u=l,c=T.getAxesPermutation(u,a),p=o;c!=null&&(p=Gt({inputs:{x:o},backend:r,attrs:{perm:c}}),u=T.getInnerMostAxes(u.length,a)),T.assertAxesAreInnerMostDims("all",u,a);let[f,d]=T.computeOutAndReduceShapes(p.shape,u),m=w.sizeFromShape(d),h=ce({inputs:{x:p},backend:r,attrs:{shape:[-1,m]}}),g=Oo(h,h.dtype,"all",r),x;if(i){let y=T.expandShapeToKeepDim(f,l);x=ce({inputs:{x:g},backend:r,attrs:{shape:y}})}else x=ce({inputs:{x:g},backend:r,attrs:{shape:f}});return r.disposeIntermediateTensorInfo(h),r.disposeIntermediateTensorInfo(g),c!=null&&r.disposeIntermediateTensorInfo(p),x}var QG={kernelName:Pd,backendName:"webgl",kernelFunc:Qce};function Zce(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{axis:s,keepDims:i}=n,a=o.shape.length,l=w.parseAxisParam(s,o.shape),u=l,c=T.getAxesPermutation(u,a),p=o;c!=null&&(p=Gt({inputs:{x:o},backend:r,attrs:{perm:c}}),u=T.getInnerMostAxes(u.length,a)),T.assertAxesAreInnerMostDims("any",u,a);let[f,d]=T.computeOutAndReduceShapes(p.shape,u),m=w.sizeFromShape(d),h=ce({inputs:{x:p},backend:r,attrs:{shape:[-1,m]}}),g=Oo(h,h.dtype,"any",r),x;if(i){let y=T.expandShapeToKeepDim(f,l);x=ce({inputs:{x:g},backend:r,attrs:{shape:y}})}else x=ce({inputs:{x:g},backend:r,attrs:{shape:f}});return r.disposeIntermediateTensorInfo(h),r.disposeIntermediateTensorInfo(g),c!=null&&r.disposeIntermediateTensorInfo(p),x}var ZG={kernelName:Ld,backendName:"webgl",kernelFunc:Zce};var GC=class{constructor(e,r,n){this.variableNames=["A"];let{windowSize:o,batchSize:s,outSize:i}=e;n||this.variableNames.push("bestIndicesA"),this.outputShape=[s,i];let a=r==="max"?">":"<",l=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = outIdx * ${o};

        int bestIndex = inOffset;
        float bestValue = getA(batch, bestIndex);

        for (int i = 0; i < ${o}; i++) {
          int inIdx = ${l};
          float candidate = getA(batch, inIdx);
          if (candidate ${a} bestValue) {
            bestValue = candidate;
            bestIndex = inIdx;
          }
        }
        setOutput(float(bestIndex));
      }
    `}};var UC=class{constructor(e,r,n,o){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,w.assert(e.length>2,()=>`Packed arg${n.charAt(0).toUpperCase()+n.slice(1)} supports only inputs with rank above 2.`);let s=e[e.length-1],i=Math.ceil(s/r);this.outputShape=e.slice(0,-1),i>1&&this.outputShape.push(i),o||this.variableNames.push("bestIndicesA");let a=this.outputShape,l=a.length,u=He(l),c=ar("coords",l),p,f;if(i===1){f=l+1;let N=He(f);p=`
        ${N} sourceLocR = ${N}(${c.join()}, 0);
        ++${c[l-1]};
        ${N} sourceLocG = ${N}(${c.join()}, 0);
        ++${c[l-2]};
        ${N} sourceLocA = ${N}(${c.join()}, 0);
        --${c[l-1]};
        ${N} sourceLocB = ${N}(${c.join()}, 0);
        --${c[l-2]};`}else f=l,p=`
        ${u} sourceLocR = coords;
        ++${c[l-1]};
        ${u} sourceLocG = coords;
        ++${c[l-2]};
        ${u} sourceLocA = coords;
        --${c[l-1]};
        ${u} sourceLocB = coords;
        --${c[l-2]};`;let d=["x","y","z","w","u","v"].slice(0,f),m="."+d[f-1],h=d.map(N=>"int "+N),g=ar("sourceLocR",f-1).concat("inIdx.r"),x=ar("sourceLocG",f-1).concat("inIdx.g"),y=ar("sourceLocB",f-1).concat("inIdx.b"),b=ar("sourceLocA",f-1).concat("inIdx.a"),v=n==="max"?"greaterThan":"lessThan",C=o?"":`
          inIdx = round(vec4(getBestIndicesAChannel(${g.join()}),
                             getBestIndicesAChannel(${x.join()}),
                             getBestIndicesAChannel(${y.join()}),
                             getBestIndicesAChannel(${b.join()})));`,S=`vec4(
            getAChannel(${g.join()}),
            hasNextCol ? getAChannel(${x.join()}) : 0.,
            hasNextRow ? getAChannel(${y.join()}) : 0.,
            hasNextRow && hasNextCol ? getAChannel(${b.join()}) : 0.)`,k=o?"":`
      float getBestIndicesAChannel(${h.join()}) {
        return getChannel(getBestIndicesA(${d.join()}),
                                          vec2(${d.slice(-2).join()}));
      }`;this.userCode=`
      float getAChannel(${h.join()}) {
        return getChannel(getA(${d.join()}),
                               vec2(${d.slice(-2).join()}));
      }
      ${k}
      void main() {
        ${u} coords = getOutputCoords();
        bool hasNextCol = ${c[l-1]} < ${a[l-1]-1};
        bool hasNextRow = ${c[l-2]} < ${a[l-2]-1};
        ${p}
        ivec4 srcIdx = ivec4(sourceLocR${m}, sourceLocG${m},
          sourceLocB${m}, sourceLocA${m}) * ${r};
        ivec4 inIdx = srcIdx;
        vec4 bestIndex = vec4(inIdx);
        vec4 bestValue = ${S};

        for (int i = 0; i < ${r}; i++) {
          inIdx = srcIdx;
          ${C}
          vec4 candidate = ${S};
          bvec4 nan = isnan(candidate);
          bvec4 replace = bvec4(
            vec4(${v}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));

          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,
                           replace.y  ? candidate.y : bestValue.y,
                           replace.z  ? candidate.z : bestValue.z,
                           replace.w  ? candidate.w : bestValue.w);
          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));
          srcIdx++;
        }
        setOutput(bestIndex);
      }
    `}};function JG(t,e,r,n=null){let o=e.shape[0],s=e.shape[1];n!=null&&(o=n.shape[0],s=n.shape[1]);let i=T.computeOptimalWindowSize(s),a={windowSize:i,inSize:s,batchSize:o,outSize:Math.ceil(s/i)},l=new GC(a,r,n==null),u=[e];n!=null&&u.push(n);let c=t.runWebGLProgram(l,u,"int32");if(c.shape[1]===1)return c;let p=JG(t,e,r,c);return t.disposeIntermediateTensorInfo(c),p}function e6(t,e,r,n=null){let o=n!=null?n.shape:e.shape,s=o[o.length-1],i=T.computeOptimalWindowSize(s),a=new UC(o,i,r,n==null),l=n==null?[e]:[e,n],u=t.runWebGLProgram(a,l,"int32");if(u.shape.length===e.shape.length){let c=e6(t,e,r,u);return t.disposeIntermediateTensorInfo(u),c}return u}function HC(t,e,r,n){let o=[r];if(T.assertAxesAreInnerMostDims("arg"+n.charAt(0).toUpperCase()+n.slice(1),o,e.shape.length),!B().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){let s=[],i=t.texData.get(e.dataId),a=i!==null&&i.isPacked,l=e;a&&(l=t.unpackTensor(e),s.push(l));let[u,c]=T.computeOutAndReduceShapes(l.shape,o),p=w.sizeFromShape(c),f=ce({inputs:{x:l},backend:t,attrs:{shape:[-1,p]}});s.push(f);let d=JG(t,f,n);s.push(d);let m=ce({inputs:{x:d},backend:t,attrs:{shape:u}});return s.forEach(h=>t.disposeIntermediateTensorInfo(h)),m}return e6(t,e,n)}function Jce(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{axis:s}=n,i=w.parseAxisParam(s,o.shape),a=T.getAxesPermutation(i,o.shape.length),l=o,u=[];a!=null&&(l=Gt({inputs:{x:o},backend:r,attrs:{perm:a}}),u.push(l),i=T.getInnerMostAxes(i.length,l.shape.length)),T.assertAxesAreInnerMostDims("argMax",[i[0]],l.shape.length);let c=HC(r,l,i[0],"max");return u.forEach(p=>r.disposeIntermediateTensorInfo(p)),c}var t6={kernelName:vu,backendName:"webgl",kernelFunc:Jce};function epe(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{axis:s}=n,i=w.parseAxisParam(s,o.shape),a=T.getAxesPermutation(i,o.shape.length),l=o,u=[];a!=null&&(l=Gt({inputs:{x:o},backend:r,attrs:{perm:a}}),u.push(l),i=T.getInnerMostAxes(i.length,l.shape.length)),T.assertAxesAreInnerMostDims("argMin",[i[0]],l.shape.length);let c=HC(r,l,i[0],"min");return u.forEach(p=>r.disposeIntermediateTensorInfo(p)),c}var r6={kernelName:wu,backendName:"webgl",kernelFunc:epe};var tpe=Rr+`
  if (abs(x) > 1.) {
    return NAN;
  }
  return asin(x);
`,rpe=Ne({opSnippet:tpe}),n6={kernelName:Ca,backendName:"webgl",kernelFunc:rpe};var npe=Rr+"return log(x + sqrt(x * x + 1.0));",ope=Ne({opSnippet:npe}),o6={kernelName:Sa,backendName:"webgl",kernelFunc:ope};var spe=Rr+`
  return atan(x);
`,ipe=Ne({opSnippet:spe}),s6={kernelName:ka,backendName:"webgl",kernelFunc:ipe};var ape=Bh+`
  return atan(a, b);
`,lpe=`
  vec4 result = atan(a, b);
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+ta+`
  return result;
`,upe=ut({opSnippet:ape,packedOpSnippet:lpe}),i6={kernelName:Na,backendName:"webgl",kernelFunc:upe};var cpe=Rr+`
  if ((x < -1.0) || (x > 1.0)) return NAN;
return (log(1.0 + x) - log(1.0 - x)) / 2.0;`,ppe=Ne({opSnippet:cpe}),a6={kernelName:Ta,backendName:"webgl",kernelFunc:ppe};var hi=class{constructor(e,r,n,o=!1,s=!1){if(this.variableNames=["x"],r==="avg"&&n)throw new Error("Cannot compute positions for average pool.");let i=e.filterWidth,a=e.strideHeight,l=e.strideWidth,u=e.dilationHeight,c=e.dilationWidth,p=e.effectiveFilterHeight,f=e.effectiveFilterWidth,d=e.padInfo.top,m=e.padInfo.left;this.outputShape=e.outShape;let h=r==="avg",g=`((batch  * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + d`,x=`(xR * ${e.inWidth} + xC) * ${e.inChannels} + d`,y="0.0";if(h||(y="-1.0 / 1e-20"),n){let N=">=";this.userCode=`
        const ivec2 strides = ivec2(${a}, ${l});
        const ivec2 pads = ivec2(${d}, ${m});

        void main() {
          ivec4 coords = getOutputCoords();
          int batch = coords[0];
          int d = coords[3];

          ivec2 xRCCorner = coords.yz * strides - pads;
          int xRCorner = xRCCorner.x;
          int xCCorner = xRCCorner.y;

          // max/min x(?, ?, d) to get y(yR, yC, d).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;
          float avgValue = 0.0;

          for (int wR = 0; wR < ${p};
              wR += ${u}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${f};
                wC += ${c}) {
              int xC = xCCorner + wC;

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float value = getX(batch, xR, xC, d);

              // If a min / max value has already been found, use it. If not,
              // use the current value.
              float currMinMaxValue = mix(
                  value, minMaxValue, minMaxValueFound);
              if (value ${N} currMinMaxValue) {
                minMaxValue = value;
                minMaxValueFound = 1.0;
                minMaxPosition = ${o?s?g:x:`wR * ${f} + wC`};
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}let b="max",v=`${r}(${r}(${r}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;r==="avg"&&(v="avgValue / count");let C=Math.floor(i/4)*4,S=i%4,k=`
      if (${h}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${b}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec2 strides = ivec2(${a}, ${l});
      const ivec2 pads = ivec2(${d}, ${m});
      const float initializationValue = ${y};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xR, int xC, int d) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xR, xC, d);
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d = coords[3];

        ivec2 xRCCorner = coords.yz * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // max/min x(?, ?, d) to get y(yR, yC, d).
        // ? = to be determined
        vec4 minMaxValue = vec4(${y});
        float avgValue = 0.0;
        count = 0.0;

        for (int wR = 0; wR < ${p};
            wR += ${u}) {
          int xR = xRCorner + wR;

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${C}; wC += 4) {
            int xC = xCCorner + wC * ${c};

            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${c}, d),
              getValue(batch, xR, xC + 2 * ${c}, d),
              getValue(batch, xR, xC + 3 * ${c}, d)
            );

            ${k}
          }

          int xC = xCCorner + ${C};
          if (${S===1}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              initializationValue,
              initializationValue,
              initializationValue
            );

            ${k}
          } else if (${S===2}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${c}, d),
              initializationValue,
              initializationValue
            );

            ${k}
          } else if (${S===3}) {
            vec4 values = vec4(
              getValue(batch, xR, xC, d),
              getValue(batch, xR, xC + ${c}, d),
              getValue(batch, xR, xC + 2 * ${c}, d),
              initializationValue
            );

            ${k}
          }
        }
        setOutput(${v});
      }
    `}},Oc=class{constructor(e,r,n,o=!1,s=!1){if(this.variableNames=["x"],r==="avg"&&n)throw new Error("Cannot compute positions for average pool.");let i=e.filterWidth,a=e.strideDepth,l=e.strideHeight,u=e.strideWidth,c=e.dilationDepth,p=e.dilationHeight,f=e.dilationWidth,d=e.effectiveFilterDepth,m=e.effectiveFilterHeight,h=e.effectiveFilterWidth,g=e.padInfo.front,x=e.padInfo.top,y=e.padInfo.left;this.outputShape=e.outShape;let b=r==="avg",v="0.0";if(b||(v="-1.0 / 1e-20"),n){let $=">=";this.userCode=`
        const ivec3 strides =
            ivec3(${a}, ${l}, ${u});
        const ivec3 pads = ivec3(${g}, ${x}, ${y});

        void main() {
          ivec5 coords = getOutputCoords();
          int batch = coords.x;
          int ch = coords.u;

          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
          int xDCorner = xCorner.x;
          int xRCorner = xCorner.y;
          int xCCorner = xCorner.z;

          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).
          // ? = to be determined
          float minMaxValue = 0.0;
          float minMaxValueFound = 0.0;
          int minMaxPosition = 0;

          for (int wD = 0; wD < ${d};
              wD += ${c}) {
            int xD = xDCorner + wD;

            if (xD < 0 || xD >= ${e.inDepth}) {
              continue;
            }

            for (int wR = 0; wR < ${m};
                wR += ${p}) {
              int xR = xRCorner + wR;

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int wC = 0; wC < ${h};
                  wC += ${f}) {
                int xC = xCCorner + wC;

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float value = getX(batch, xD, xR, xC, ch);

                // If a min / max value has already been found, use it. If not,
                // use the current value.
                float currMinMaxValue = mix(
                    value, minMaxValue, minMaxValueFound);
                if (value ${$} currMinMaxValue) {
                  minMaxValue = value;
                  minMaxValueFound = 1.0;
                  minMaxPosition = ${o?s?`(((batch * ${e.inDepth} + xD) * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`((xD * ${e.inHeight} + xR) * ${e.inWidth} + xC) * ${e.inChannels} + ch`:`wD * ${m} * ${h} +
                      wR * ${h} + wC`};
                }
              }
            }
          }
          setOutput(float(minMaxPosition));
        }
      `;return}let C="max",S=`${r}(${r}(${r}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;r==="avg"&&(S="avgValue / count");let k=Math.floor(i/4)*4,N=i%4,D=`
      if (${b}) {
        avgValue += dot(values, ones);
      } else {
        minMaxValue = ${C}(values, minMaxValue);
      }
    `;this.userCode=`
      const ivec3 strides =
        ivec3(${a}, ${l}, ${u});
      const ivec3 pads = ivec3(${g}, ${x}, ${y});
      const float initializationValue = ${v};
      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);

      float count = 0.0;

      float getValue(int batch, int xD, int xR, int xC, int ch) {
        if (xC < 0 || xC >= ${e.inWidth}) {
          return initializationValue;
        }
        count += 1.0;
        return getX(batch, xD, xR, xC, ch);
      }

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xDCorner = xCorner.x;
        int xRCorner = xCorner.y;
        int xCCorner = xCorner.z;

        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).
        // ? = to be determined
        vec4 minMaxValue = vec4(${v});
        float avgValue = 0.0;
        count = 0.0;

        for (int wD = 0; wD < ${d};
            wD += ${c}) {
          int xD = xDCorner + wD;

          if (xD < 0 || xD >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${m};
            wR += ${p}) {
            int xR = xRCorner + wR;

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${k}; wC += 4) {
              int xC = xCCorner + wC * ${f};

              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                getValue(batch, xD, xR, xC + 2 * ${f}, ch),
                getValue(batch, xD, xR, xC + 3 * ${f}, ch)
              );

              ${D}
            }

            int xC = xCCorner + ${k};
            if (${N===1}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                initializationValue,
                initializationValue,
                initializationValue
              );

              ${D}
            } else if (${N===2}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                initializationValue,
                initializationValue
              );

              ${D}
            } else if (${N===3}) {
              vec4 values = vec4(
                getValue(batch, xD, xR, xC, ch),
                getValue(batch, xD, xR, xC + ${f}, ch),
                getValue(batch, xD, xR, xC + 2 * ${f}, ch),
                initializationValue
              );

              ${D}
            }
          }
          setOutput(${S});
        }
      }
    `}};function fpe(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e;Ji(o,"avgPool");let{filterSize:s,strides:i,pad:a,dimRoundingMode:l}=n,u=1;w.assert(T.eitherStridesOrDilationsAreOne(i,u),()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);let c=T.computePool2DInfo(o.shape,s,i,u,a,l);if(c.filterWidth===1&&c.filterHeight===1&&w.arraysEqual(c.inShape,c.outShape))return lr({inputs:{x:o},backend:r});let p=new hi(c,"avg",!1);return r.runWebGLProgram(p,[o],"float32")}var l6={kernelName:Cu,backendName:"webgl",kernelFunc:fpe};function dpe(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{filterSize:s,strides:i,pad:a,dimRoundingMode:l,dataFormat:u}=n,c=[1,1,1],p=T.computePool3DInfo(o.shape,s,i,c,a,l,u),f=new Oc(p,"avg",!1);return r.runWebGLProgram(f,[o],"float32")}var u6={kernelName:Su,backendName:"webgl",kernelFunc:dpe};var qC=class{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;let r=e.filterHeight,n=e.filterWidth,o=e.strideHeight,s=e.strideWidth,i=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterHeight,u=e.effectiveFilterWidth,c=l-1-e.padInfo.top,p=u-1-e.padInfo.left,f=1/(r*n);this.userCode=`
      const ivec2 pads = ivec2(${c}, ${p});
      const float avgMultiplier = float(${f});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${l};
            wR += ${i}) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${u};
            wC+= ${a}) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);

            dotProd += dyValue * avgMultiplier;
          }
        }
        setOutput(dotProd);
      }
    `}},jC=class{constructor(e){this.variableNames=["dy"],this.outputShape=e.inShape;let r=e.filterDepth,n=e.filterHeight,o=e.filterWidth,s=e.strideDepth,i=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,u=e.dilationHeight,c=e.dilationWidth,p=e.effectiveFilterDepth,f=e.effectiveFilterHeight,d=e.effectiveFilterWidth,m=p-1-e.padInfo.front,h=f-1-e.padInfo.top,g=d-1-e.padInfo.left,x=1/(r*n*o);this.userCode=`
      const ivec3 pads = ivec3(${m}, ${h}, ${g});
      const float avgMultiplier = float(${x});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${p};
            wD += ${l}) {
          float dyD = float(dyDCorner + wD) / ${s}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${f};
              wR += ${u}) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${d};
                wC += ${c}) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);

              dotProd += dyValue * avgMultiplier;
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function mpe(t){let{inputs:e,backend:r,attrs:n}=t,{dy:o,input:s}=e,i=s,{filterSize:a,strides:l,pad:u,dimRoundingMode:c}=n,p=[1,1,1],f=T.computePool3DInfo(i.shape,a,l,p,u,c),d=new jC(f);return r.runWebGLProgram(d,[o],i.dtype)}var c6={kernelName:zd,backendName:"webgl",kernelFunc:mpe};function hpe(t){let{inputs:e,backend:r,attrs:n}=t,{dy:o,input:s}=e,i=s;Ji([o,s],"avgPoolGrad");let{filterSize:a,strides:l,pad:u}=n,c=T.computePool2DInfo(i.shape,a,l,1,u),p=new qC(c);return r.runWebGLProgram(p,[o],i.dtype)}var p6={kernelName:Md,backendName:"webgl",kernelFunc:hpe};function gpe(t){let{inputs:e,backend:r,attrs:n}=t,{a:o,b:s}=e,{transposeA:i,transposeB:a}=n;return Ff({a:o,b:s,transposeA:i,transposeB:a,backend:r})}var f6={kernelName:ku,backendName:"webgl",kernelFunc:gpe};var KC=class{constructor(e,r,n,o,s,i){this.outputShape=[],this.variableNames=["x","mean","variance"],T.assertAndGetBroadcastShape(e,r),T.assertAndGetBroadcastShape(e,n);let a="0.0";o!=null&&(T.assertAndGetBroadcastShape(e,o),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="1.0";s!=null&&(T.assertAndGetBroadcastShape(e,s),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        float x = getXAtOutCoords();
        float mean = getMeanAtOutCoords();
        float variance = getVarianceAtOutCoords();
        float offset = ${a};
        float scale = ${l};
        float inv = scale * inversesqrt(variance + float(${i}));
        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));
      }
    `}};var XC=class{constructor(e,r,n,o,s,i){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],T.assertAndGetBroadcastShape(e,r),T.assertAndGetBroadcastShape(e,n);let a="vec4(0.0)";o!=null&&(T.assertAndGetBroadcastShape(e,o),this.variableNames.push("offset"),a="getOffsetAtOutCoords()");let l="vec4(1.0)";s!=null&&(T.assertAndGetBroadcastShape(e,s),this.variableNames.push("scale"),l="getScaleAtOutCoords()"),this.outputShape=e,this.userCode=`
      void main() {
        vec4 offset = ${a};
        vec4 scale = ${l};

        vec4 x = getXAtOutCoords();
        vec4 mean = getMeanAtOutCoords();
        vec4 variance = getVarianceAtOutCoords();

        vec4 inv = scale * inversesqrt(variance + vec4(${i}));

        setOutput((x - mean) * inv + offset);
      }
    `}};var xpe=({inputs:t,backend:e,attrs:r})=>{let{x:n,mean:o,variance:s,offset:i,scale:a}=t;w.assert(o.shape.length===s.shape.length,()=>"Batch normalization gradient requires mean and variance to have equal ranks."),w.assert(i==null||o.shape.length===i.shape.length,()=>"Batch normalization gradient requires mean and offset to have equal ranks."),w.assert(a==null||o.shape.length===a.shape.length,()=>"Batch normalization gradient requires mean and scale to have equal ranks.");let{varianceEpsilon:l}=r;l==null&&(l=.001);let u=[n,o,s],c=null;i!=null&&(c=i.shape,u.push(i));let p=null;a!=null&&(p=a.shape,u.push(a));let f=B().getBool("WEBGL_PACK_NORMALIZATION")?new XC(n.shape,o.shape,s.shape,c,p,l):new KC(n.shape,o.shape,s.shape,c,p,l);return e.runWebGLProgram(f,u,u[0].dtype)},d6={kernelName:Fu,backendName:"webgl",kernelFunc:xpe};var YC=class{constructor(e){this.variableNames=["source"],this.outputShape=e,this.rank=e.length;let r=He(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];let n=ype(this.rank),o,s=e.map((i,a)=>`sourceLoc.${tA[a]} = start[${a}] + coords.${tA[a]};`);o=`
        ${r} sourceLoc;
        ${r} coords = getOutputCoords();
        ${s.join(`
`)}
      `,this.userCode=`
      void main() {
        ${o}
        setOutput(getSource(${n}));
      }
    `}},tA=["x","y","z","w","u","v"];function ype(t){if(t===1)return"sourceLoc";if(t<=6)return tA.slice(0,t).map(e=>"sourceLoc."+e).join(",");throw Error(`Slicing for rank ${t} is not yet supported`)}var QC=class{constructor(e){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e,this.rank=e.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];let r=He(this.rank),n=ar("coords",this.rank),o=ar("sourceLoc",this.rank),s=this.rank===1?"sourceLoc":`vec2(${o.slice(-2).join()})`,i=`getChannel(getSource(${o.join()}), ${s})`,a=`
      result.x = ${i};
      if (++${n[this.rank-1]} < ${e[this.rank-1]}) {
        ++${o[this.rank-1]};
        result.y = ${i};
        --${o[this.rank-1]};
      }
    `,l=this.rank===1?"":`
      --${n[this.rank-1]};
      if (++${n[this.rank-2]} < ${e[this.rank-2]}) {
        ++${o[this.rank-2]};
        result.z = ${i};
        if (++${n[this.rank-1]} < ${e[this.rank-1]}) {
          ++${o[this.rank-1]};
          result.w = ${i};
        }
      }
    `,u=this.rank<=4?`sourceLoc = coords +
            ${r}(${e.map((c,p)=>`start[${p}]`).join()});`:e.map((c,p)=>`${o[p]} = ${n[p]} + start[${p}];`).join(`
`);this.userCode=`
      void main() {
        ${r} coords = getOutputCoords();
        ${r} sourceLoc;
        ${u}
        vec4 result = vec4(0.);
        ${a}
        ${l}
        setOutput(result);
      }
    `}};function bpe(t,e,r,n){let o=n.texData.get(t.dataId),s=n.makeTensorInfo(r,t.dtype),i=n.texData.get(s.dataId);Object.assign(i,o),i.refCount=1,i.shape=r,i.dtype=t.dtype;let a=Ur.computeFlatOffset(e,w.computeStrides(t.shape));o.slice&&(a+=o.slice.flatOffset),i.slice={flatOffset:a,origDataId:o.slice&&o.slice.origDataId||t.dataId};let l=n.dataRefCount.get(i.slice.origDataId)||1;return n.dataRefCount.set(i.slice.origDataId,l+1),s}function gi(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{begin:s,size:i}=n,[a,l]=Ur.parseSliceParams(o,s,i);if(Ur.assertParamsValid(o,a,l),w.sizeFromShape(l)===0)return r.makeTensorInfo(l,o.dtype,[]);if(r.shouldExecuteOnCPU([o])||o.dtype==="string"){let p=r.texData.get(o.dataId),f=sG(p.values,a,l,o.shape,o.dtype);return r.makeTensorInfo(l,o.dtype,f)}let{isPacked:u}=r.texData.get(o.dataId),c=Ur.isSliceContinous(o.shape,a,l);if(u||!c){let p=B().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new QC(l):new YC(l),f=[a];return r.runWebGLProgram(p,[o],o.dtype,f)}return r.uploadToGPU(o.dataId),bpe(o,a,l,r)}var m6={kernelName:nc,backendName:"webgl",kernelFunc:gi};var vpe=t=>{let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{blockShape:s,crops:i}=n;w.assert(o.shape.length<=4,()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet");let a=s.reduce((y,b)=>y*b),l=T.getReshaped(o.shape,s,a),u=T.getPermuted(l.length,s.length),c=T.getReshapedPermuted(o.shape,s,a),p=T.getSliceBeginCoords(i,s.length),f=T.getSliceSize(c,i,s.length),d=[],m=ce({inputs:{x:o},backend:r,attrs:{shape:l}}),h=Gt({inputs:{x:m},backend:r,attrs:{perm:u}}),g=ce({inputs:{x:h},backend:r,attrs:{shape:c}}),x=gi({inputs:{x:g},backend:r,attrs:{begin:p,size:f}});return d.push(m),d.push(h),d.push(g),d.forEach(y=>r.disposeIntermediateTensorInfo(y)),x},h6={kernelName:Tu,backendName:"webgl",kernelFunc:vpe};function wpe(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,weights:s}=e,{size:i}=n,a=r.readSync(o.dataId),l=r.readSync(s.dataId),u=AC(a,l,s.dtype,s.shape,i);return r.makeTensorInfo([i],s.dtype,u)}var g6={kernelName:Bd,backendName:"webgl",kernelFunc:wpe};function Cpe(t){let{inputs:e,backend:r}=t,{s0:n,s1:o}=e,s=r.readSync(n.dataId),i=r.readSync(o.dataId),a=T.assertAndGetBroadcastShape(Array.from(s),Array.from(i));return r.makeTensorInfo([a.length],"int32",Int32Array.from(a))}var x6={kernelName:Pv,backendName:"webgl",kernelFunc:Cpe};var Spe="return float(a != b);",rA=ut({opSnippet:Spe,cpuKernelImpl:YW,dtype:"bool"}),y6={kernelName:Fp,backendName:"webgl",kernelFunc:rA};function Ll(t){let{inputs:e,backend:r}=t,{input:n}=e,o=r.texData.get(n.dataId);return lr({inputs:{x:o.complexTensorInfos.real},backend:r})}var b6={kernelName:pm,backendName:"webgl",kernelFunc:Ll};var kpe="return float(int(x));";function v6(t,e){let r=new cn(t.shape,kpe),n=e.runWebGLProgram(r,[t],"int32");return{dataId:n.dataId,shape:n.shape,dtype:n.dtype}}function nA(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{dtype:s}=n;if(s==="complex64"){if(o.dtype==="complex64")return lr({inputs:{x:o},backend:r});let i=Ot(o.shape),a=nA({inputs:{x:o},backend:r,attrs:{dtype:"float32"}}),l=po({inputs:{real:a,imag:i},backend:r});return i.dispose(),r.disposeIntermediateTensorInfo(a),l}if(o.dtype==="complex64"){let i=Ll({inputs:{input:o},backend:r}),a=nA({inputs:{x:i},backend:r,attrs:{dtype:s}});return r.disposeIntermediateTensorInfo(i),a}if(!w.hasEncodingLoss(o.dtype,s)){let i=lr({inputs:{x:o},backend:r});return{dataId:i.dataId,shape:i.shape,dtype:s}}if(r.shouldExecuteOnCPU([o])){let i=r.texData.get(o.dataId).values,[a,l,u]=AW(i,o.shape,o.dtype,s);return r.makeTensorInfo(a,l,u)}if(s==="int32")return v6(o,r);if(s==="bool"){let i=r.makeTensorInfo([],"bool",w.getTypedArrayFromDType("bool",1)),l=rA({inputs:{a:o,b:i},backend:r});return r.disposeIntermediateTensorInfo(i),l}throw new Error(`Error in Cast: failed to cast ${o.dtype} to ${s}`)}var w6={kernelName:Ri,backendName:"webgl",kernelFunc:nA};var C6="return ceil(x);",Tpe=Ne({opSnippet:C6,packedOpSnippet:C6,cpuKernelImpl:DW}),S6={kernelName:Ia,backendName:"webgl",kernelFunc:Tpe};var ZC=class{constructor(e){this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`

      void main() {
        float value = getAAtOutCoords();
        if (isnan(value)) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, minVal, maxVal));
      }
    `}};var JC=class{constructor(e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=e,this.userCode=`
      void main() {
        vec4 value = getAAtOutCoords();

        if (any(isnan(value))) {
          setOutput(value);
          return;
        }

        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));
      }
    `}};function Npe(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{clipValueMin:s,clipValueMax:i}=n,a;B().getBool("WEBGL_PACK_CLIP")?a=new JC(o.shape):a=new ZC(o.shape);let l=[[s],[i]];return r.runWebGLProgram(a,[o],o.dtype,l)}var k6={kernelName:Ea,backendName:"webgl",kernelFunc:Npe};var eS=class{constructor(e){this.variableNames=["real","imag"],this.outputShape=e,this.userCode=`
      void main() {
        float re = abs(getRealAtOutCoords());
        float im = abs(getImagAtOutCoords());
        float mx = max(re, im);

        // sadly the length function in glsl is not underflow-safe
        // (at least not on Intel GPUs). So the safe solution is
        // to ensure underflow-safety in all cases.
        setOutput(
          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))
        );
      }
    `}};function T6(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}}function Ipe(t){let{inputs:e,backend:r}=t,{x:n}=e,o=r.texData.get(n.dataId),s=new eS(n.shape),i=[T6(n,o.complexTensorInfos.real),T6(n,o.complexTensorInfos.imag)];return r.runWebGLProgram(s,i,i[0].dtype)}var N6={kernelName:Nu,backendName:"webgl",kernelFunc:Ipe};var tS=class{constructor(e){this.outputShape=[],this.outputShape=T.computeOutShape(e,1),this.variableNames=e.map((i,a)=>`T${a}`);let r=new Array(e.length-1);r[0]=e[0][1];for(let i=1;i<r.length;i++)r[i]=r[i-1]+e[i][1];let n=[`if (yC < ${r[0]}) setOutput(getT0(yR, yC));`];for(let i=1;i<r.length;i++){let a=r[i-1];n.push(`else if (yC < ${r[i]}) setOutput(getT${i}(yR, yC-${a}));`)}let o=r.length,s=r[r.length-1];n.push(`else setOutput(getT${o}(yR, yC-${s}));`),this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int yR = coords.x;
        int yC = coords.y;

        ${n.join(`
        `)}
      }
    `}};var nS=class{constructor(e,r){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=T.computeOutShape(e,r);let n=this.outputShape,o=n.length,s=He(o),i=ar("coords",o),a=["x","y","z","w","u","v"].slice(0,o);this.variableNames=e.map((h,g)=>`T${g}`);let l=new Array(e.length-1);l[0]=e[0][r];for(let h=1;h<l.length;h++)l[h]=l[h-1]+e[h][r];let u=a[r],c=a.slice(-2),p=a.join(),f=`if (${u} < ${l[0]}) {
        return getChannel(
            getT0(${p}), vec2(${c.join()}));
        }`;for(let h=1;h<l.length;h++){let g=l[h-1];f+=`
        if (${u} < ${l[h]}  && ${u} >= ${l[h-1]}) {
          return getChannel(
            getT${h}(${rS(a,u,g)}),
            vec2(${rS(c,u,g)}));
        }`}let d=l.length,m=l[l.length-1];f+=`
        return getChannel(
          getT${d}(${rS(a,u,m)}),
          vec2(${rS(c,u,m)}));`,this.userCode=`
      float getValue(${a.map(h=>"int "+h)}) {
        ${f}
      }

      void main() {
        ${s} coords = getOutputCoords();
        vec4 result = vec4(getValue(${i}), 0., 0., 0.);

        ${i[o-1]} = ${i[o-1]} + 1;
        if (${i[o-1]} < ${n[o-1]}) {
          result.g = getValue(${i});
        }

        ${i[o-2]} = ${i[o-2]} + 1;
        if (${i[o-2]} < ${n[o-2]}) {
          result.a = getValue(${i});
        }

        ${i[o-1]} = ${i[o-1]} - 1;
        if (${i[o-2]} < ${n[o-2]} &&
            ${i[o-1]} < ${n[o-1]}) {
          result.b = getValue(${i});
        }
        setOutput(result);
      }
    `}};function rS(t,e,r){let n=t.indexOf(e);return t.map((s,i)=>i===n?`${s} - ${r}`:s).join()}function Pf(t){let{inputs:e,backend:r}=t,{input:n}=e,o=r.texData.get(n.dataId);return lr({inputs:{x:o.complexTensorInfos.imag},backend:r})}var I6={kernelName:nm,backendName:"webgl",kernelFunc:Pf};function Wh(t,e,r){let n=t[0].dtype;if(n==="complex64"){let d=t.map(y=>Ll({inputs:{input:y},backend:r})),m=t.map(y=>Pf({inputs:{input:y},backend:r})),h=Wh(d,e,r),g=Wh(m,e,r),x=po({inputs:{real:h,imag:g},backend:r});return d.forEach(y=>r.disposeIntermediateTensorInfo(y)),m.forEach(y=>r.disposeIntermediateTensorInfo(y)),r.disposeIntermediateTensorInfo(h),r.disposeIntermediateTensorInfo(g),x}let o=r.shouldExecuteOnCPU(t);if(n==="string"&&(o=!0),o){let d=t.map(v=>{let S=[-1,w.sizeFromShape(v.shape.slice(e))];return ce({inputs:{x:v},backend:r,attrs:{shape:S}})}),m=d.map(v=>({vals:r.readSync(v.dataId),shape:v.shape})),h=T.computeOutShape(d.map(v=>v.shape),1),g=d[0].shape[0]===1,x=$W(m,h,n,g),y=T.computeOutShape(t.map(v=>v.shape),e),b=r.makeTensorInfo(y,n,x);return d.forEach(v=>r.disposeIntermediateTensorInfo(v)),b}let s=t.filter(d=>w.sizeFromShape(d.shape)>0),i=B().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&s[0].shape.length>1;if(s.length===1){let d=i?new cn(t[0].shape,ea):new co(t[0].shape,ea);return r.runWebGLProgram(d,t,n)}let a=B().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(s.length>a){let d=[];for(let h=0;h<s.length;h+=a){let g=s.slice(h,h+a);d.push(Wh(g,e,r))}let m=Wh(d,e,r);for(let h of d)r.disposeIntermediateTensorInfo(h);return m}if(i){let d=new nS(s.map(m=>m.shape),e);return r.runWebGLProgram(d,s,n)}let{tensors2D:l,outShape:u}=Epe(s,e,r),c=new tS(l.map(d=>d.shape)),p=r.runWebGLProgram(c,l,n);l.forEach(d=>r.disposeIntermediateTensorInfo(d));let f=ce({inputs:{x:p},attrs:{shape:u},backend:r});return r.disposeIntermediateTensorInfo(p),f}function Epe(t,e,r){let n=T.computeOutShape(t.map(s=>s.shape),e);return{tensors2D:t.map(s=>ce({inputs:{x:s},attrs:{shape:[-1,w.sizeFromShape(s.shape.slice(e))]},backend:r})),outShape:n}}function oA(t){let{inputs:e,backend:r,attrs:n}=t,{axis:o}=n,s=w.parseAxisParam(o,e[0].shape)[0],i=e.map(u=>u.shape);T.assertParamsConsistent(i,s);let a=T.computeOutShape(e.map(u=>u.shape),s);if(w.sizeFromShape(a)===0)return r.makeTensorInfo(a,e[0].dtype,[]);let l=e.filter(u=>w.sizeFromShape(u.shape)>0);return l.length===1?lr({inputs:{x:l[0]},backend:r}):Wh(l,s,r)}var E6={kernelName:Iu,backendName:"webgl",kernelFunc:oA};var Gh=class{constructor(e,r=!1,n=null,o=!1,s=!1){this.variableNames=["x","W"],this.outputShape=e.outShape;let i=e.padInfo.top,a=e.padInfo.left,l=e.strideHeight,u=e.strideWidth,c=e.dilationHeight,p=e.dilationWidth,f=e.filterHeight,d=e.filterWidth,m=Math.floor(e.inChannels/4)*4,h=e.inChannels%4,g=e.dataFormat==="channelsLast",x=g?1:2,y=g?2:3,b=g?3:1,v="",C="";n&&(o?v=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${n}
        }`:s?v=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${n}
        }`:v=`
          float activation(float x) {
            ${n}
          }
        `,C="result = activation(result);");let S=r?"result += getBiasAtOutCoords();":"";r&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${v}

      const ivec2 strides = ivec2(${l}, ${u});
      const ivec2 pads = ivec2(${i}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d2 = coords[${b}];

        ivec2 xRCCorner =
            ivec2(coords[${x}], coords[${y}]) * strides - pads;
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${f}; wR++) {
          int xR = xRCorner + wR * ${c};

          if (xR < 0 || xR >= ${e.inHeight}) {
            continue;
          }

          for (int wC = 0; wC < ${d}; wC++) {
            int xC = xCCorner + wC * ${p};

            if (xC < 0 || xC >= ${e.inWidth}) {
              continue;
            }

            for (int d1 = 0; d1 < ${m}; d1 += 4) {
              vec4 wValues = vec4(
                getW(wR, wC, d1, d2),
                getW(wR, wC, d1 + 1, d2),
                getW(wR, wC, d1 + 2, d2),
                getW(wR, wC, d1 + 3, d2)
              );

              if (${g}) {
                vec4 xValues = vec4(
                  getX(batch, xR, xC, d1),
                  getX(batch, xR, xC, d1 + 1),
                  getX(batch, xR, xC, d1 + 2),
                  getX(batch, xR, xC, d1 + 3)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec4 xValues = vec4(
                  getX(batch, d1, xR, xC),
                  getX(batch, d1 + 1, xR, xC),
                  getX(batch, d1 + 2, xR, xC),
                  getX(batch, d1 + 3, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }
            }

            if (${h===1}) {

              if (${g}) {
                dotProd +=
                    getX(batch, xR, xC, ${m}) *
                    getW(wR, wC, ${m}, d2);
              } else {
                dotProd +=
                    getX(batch, ${m}, xR, xC) *
                    getW(wR, wC, ${m}, d2);
              }

            } else if (${h===2}) {
              vec2 wValues = vec2(
                getW(wR, wC, ${m}, d2),
                getW(wR, wC, ${m} + 1, d2)
              );

              if (${g}) {
                vec2 xValues = vec2(
                  getX(batch, xR, xC, ${m}),
                  getX(batch, xR, xC, ${m} + 1)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec2 xValues = vec2(
                  getX(batch, ${m}, xR, xC),
                  getX(batch, ${m} + 1, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            } else if (${h===3}) {
              vec3 wValues = vec3(
                getW(wR, wC, ${m}, d2),
                getW(wR, wC, ${m} + 1, d2),
                getW(wR, wC, ${m} + 2, d2)
              );

              if (${g}) {
                vec3 xValues = vec3(
                  getX(batch, xR, xC, ${m}),
                  getX(batch, xR, xC, ${m} + 1),
                  getX(batch, xR, xC, ${m} + 2)
                );
                dotProd += dot(xValues, wValues);
              } else {
                vec3 xValues = vec3(
                  getX(batch, ${m}, xR, xC),
                  getX(batch, ${m} + 1, xR, xC),
                  getX(batch, ${m} + 2, xR, xC)
                );
                dotProd += dot(xValues, wValues);
              }

            }
          }
        }

        float result = dotProd;
        ${S}
        ${C}
        setOutput(result);
      }
    `}},oS=class{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;let r=e.padInfo.front,n=e.padInfo.top,o=e.padInfo.left,s=e.strideDepth,i=e.strideHeight,a=e.strideWidth,l=e.dilationDepth,u=e.dilationHeight,c=e.dilationWidth,p=e.filterDepth,f=e.filterHeight,d=e.filterWidth,m=Math.floor(e.inChannels/4)*4,h=e.inChannels%4;this.userCode=`
      const ivec3 strides = ivec3(${s}, ${i}, ${a});
      const ivec3 pads = ivec3(${r}, ${n}, ${o});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d2 = coords.u;

        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;
        int xFCorner = xFRCCorner.x;
        int xRCorner = xFRCCorner.y;
        int xCCorner = xFRCCorner.z;

        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get
        // y(yF, yR, yC, d2). ? = to be determined. : = across all
        // values in that axis.
        float dotProd = 0.0;
        for (int wF = 0; wF < ${p}; wF++) {
          int xF = xFCorner + wF * ${l};

          if (xF < 0 || xF >= ${e.inDepth}) {
            continue;
          }

          for (int wR = 0; wR < ${f}; wR++) {
            int xR = xRCorner + wR * ${u};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int wC = 0; wC < ${d}; wC++) {
              int xC = xCCorner + wC * ${c};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              for (int d1 = 0; d1 < ${m}; d1 += 4) {
                vec4 xValues = vec4(
                  getX(batch, xF, xR, xC, d1),
                  getX(batch, xF, xR, xC, d1 + 1),
                  getX(batch, xF, xR, xC, d1 + 2),
                  getX(batch, xF, xR, xC, d1 + 3)
                );
                vec4 wValues = vec4(
                  getW(wF, wR, wC, d1, d2),
                  getW(wF, wR, wC, d1 + 1, d2),
                  getW(wF, wR, wC, d1 + 2, d2),
                  getW(wF, wR, wC, d1 + 3, d2)
                );

                dotProd += dot(xValues, wValues);
              }

              if (${h===1}) {
                dotProd +=
                  getX(batch, xF, xR, xC, ${m}) *
                  getW(wF, wR, wC, ${m}, d2);
              } else if (${h===2}) {
                vec2 xValues = vec2(
                  getX(batch, xF, xR, xC, ${m}),
                  getX(batch, xF, xR, xC, ${m} + 1)
                );
                vec2 wValues = vec2(
                  getW(wF, wR, wC, ${m}, d2),
                  getW(wF, wR, wC, ${m} + 1, d2)
                );
                dotProd += dot(xValues, wValues);
              } else if (${h===3}) {
                vec3 xValues = vec3(
                  getX(batch, xF, xR, xC, ${m}),
                  getX(batch, xF, xR, xC, ${m} + 1),
                  getX(batch, xF, xR, xC, ${m} + 2)
                );
                vec3 wValues = vec3(
                  getW(wF, wR, wC, ${m}, d2),
                  getW(wF, wR, wC, ${m} + 1, d2),
                  getW(wF, wR, wC, ${m} + 2, d2)
                );
                dotProd += dot(xValues, wValues);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}};var Uh=class{constructor(e,r=!1,n=null,o=!1,s=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Tt(this.outputShape.length);let i=e.padInfo.left,a=e.strideWidth,l=e.dilationWidth,u=e.filterHeight,c=e.filterWidth,p=c,f=`
       int xR; int xC; int xCOffset;
       vec4 wTexel; vec4 previous; vec4 final;`;for(let g=0;g<c;g++)f+=`
           vec4 xTexelC${g*2};
           int xTexelC${g*2}Ready;
           vec4 xTexelC${g*2+1};
           int xTexelC${g*2+1}Ready;
           vec4 xC${g};`;f+=`
     for (int r = 0; r < ${u}; r++) {
      for (int d1 = 0; d1 < ${e.inChannels}; d1 += 2) {
       `;for(let g=0;g<c;g++)f+=`
           xTexelC${g*2} = vec4(0.0);
           xTexelC${g*2}Ready = 0;
           xTexelC${g*2+1} = vec4(0.0);
           xTexelC${g*2+1}Ready = 0;
           xC${g} = vec4(0.0);`;f+=`
         xR = xRCorner + r * dilations[0];
         if (xR >=0 && xR < inDims[0]) {
       `;for(let g=0;g<(p+1)/2;g++){let x=g*2;if(f+=`
           xC = xCCorner + ${x*l};
           `,a===1){if(x<c&&(i%2===1?(f+=`
                 xCOffset = xC + 1;
                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x}Ready == 0) {
                   xTexelC${x} = getX(batch, xR, xCOffset, d1);

                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${x}.zw = vec2(0.0);
                   }
                   xTexelC${x}Ready = 1;
                 }
               `,l===1&&x>0?f+=`
                 xC${x} = vec4(xTexelC${x-2}.zw, xTexelC${x}.xy);
                 `:f+=`
                   xCOffset = xC + 1 - 2;

                   if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       previous.zw = vec2(0.0);
                     }

                     xC${x} = vec4(previous.zw, xTexelC${x}.xy);
                   } else {
                     xC${x} = vec4(0.0, 0.0, xTexelC${x}.xy);
                   }
                   `):f+=`
                 if (xC >= 0 && xC < inDims[1] && xTexelC${x}Ready == 0) {
                   xTexelC${x} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${x}.zw = vec2(0.0);
                   }
                   xTexelC${x}Ready = 1;
                 }

                 xC${x} = xTexelC${x};
                 `,x+1<c)){let y=i%2===0?w.nearestLargerEven(l):l;l%2===0&&i%2===1||l%2!==0&&i%2!==1?(f+=`
                   xCOffset = xC + imod(pads[1], 2) + ${y};

                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x+1}Ready == 0) {
                     xTexelC${x+1} = getX(batch, xR, xCOffset, d1);

                     // Need to manually clear unused channels in case
                     // we're reading from recycled texture.
                     if (xCOffset + 1 >= inDims[1]) {
                       xTexelC${x+1}.zw = vec2(0.0);
                     }
                     xTexelC${x+1}Ready = 1;
                   }
                   `,l>1?f+=`
                     xCOffset -= 2;
                     if (xCOffset >= 0 && xCOffset < inDims[1]) {
                      previous = getX(batch, xR, xCOffset, d1);
                      xC${x+1} = vec4(previous.zw, xTexelC${x+1}.xy);
                     } else {
                      xC${x+1} = vec4(0.0, 0.0, xTexelC${x+1}.xy);
                     }
                     `:f+=`
                     xC${x+1} = vec4(xTexelC${x}.zw, xTexelC${x+1}.xy);
                     `):y===1?f+=`
                     xC${x+1} = xTexelC${x};
                     `:f+=`
                     xCOffset = xC + ${y};

                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x+1}Ready == 0) {
                       xTexelC${x+1} = getX(batch, xR, xCOffset, d1);
                       if (xCOffset + 1 >= inDims[1]) {
                         xTexelC${x+1}.zw = vec2(0.0);
                       }
                       xTexelC${x+1}Ready = 1;
                     }

                     xC${x+1} = xTexelC${x+1};
                     `}}else x<c&&(i%2===1?(f+=`
                 xCOffset = xC + 1 - strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x}Ready == 0) {
                   xTexelC${x} = getX(batch, xR, xCOffset, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${x}.zw = vec2(0.0);
                   }
                   xTexelC${x}Ready = 1;
                 }

                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${x+1}Ready == 0) {
                   xTexelC${x+1} = getX(batch, xR, xC + 1, d1);
                   // Need to manually clear unused channels in case
                   // we're reading from recycled texture.
                   if (xC + 2 >= inDims[1]) {
                     xTexelC${x+1}.zw = vec2(0.0);
                   }
                   xTexelC${x+1}Ready = 1;
                 }

                 xC${x} = vec4(xTexelC${x}.zw, xTexelC${x+1}.zw);
               `,x+1<c&&(f+=`
                   final = vec4(0.0);
                   xCOffset = xC + 1 + strides[1];
                   if(xCOffset >= 0 && xCOffset < inDims[1]) {
                     final = getX(batch, xR, xCOffset, d1);
                   }
                   xC${x+1} = vec4(xTexelC${x+1}.xy, final.xy);
                 `)):(f+=`
                 if(xC >= 0 && xC < inDims[1] && xTexelC${x}Ready == 0) {
                   xTexelC${x} = getX(batch, xR, xC, d1);
                   if (xC + 1 >= inDims[1]) {
                     xTexelC${x}.zw = vec2(0.0);
                   }
                   xTexelC${x}Ready = 1;
                 }

                 xCOffset = xC + strides[1];
                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${x+1}Ready == 0) {
                   xTexelC${x+1} = getX(batch, xR, xCOffset, d1);
                   if (xCOffset + 1 >= inDims[1]) {
                     xTexelC${x+1}.zw = vec2(0.);
                   }
                   xTexelC${x+1}Ready = 1;
                 }

                 xC${x} = vec4(
                   xTexelC${x}.xy, xTexelC${x+1}.xy);
               `,x+1<c&&(f+=`
                   xC${x+1} = vec4(xTexelC${x}.zw, xTexelC${x+1}.zw);
                 `)));x<c&&(f+=`
             wTexel = getW(r, ${x}, d1, d2);
             dotProd += xC${x}.xxzz * vec4(wTexel.xy, wTexel.xy);
             if(d1 + 1 < ${e.inChannels}) {
               dotProd += xC${x}.yyww * vec4(wTexel.zw, wTexel.zw);
             }
           `,x+1<c&&(f+=`
               wTexel = getW(r, ${x+1}, d1, d2);
               dotProd += xC${x+1}.xxzz * vec4(wTexel.xy, wTexel.xy);
               if(d1 + 1 < ${e.inChannels}) {
                 dotProd += xC${x+1}.yyww * vec4(wTexel.zw, wTexel.zw);
               }
             `))}f+=`
     }
   `,f+=`
     }
   `,f+=`
     }
   `;let d="",m="";n&&(o?d=`vec4 activation(vec4 a) {
           vec4 b = getPreluActivationWeightsAtOutCoords();
           ${n}
         }`:s?d=`vec4 activation(vec4 a) {
           vec4 b = getLeakyreluAlphaAtOutCoords();
           ${n}
         }`:d=`vec4 activation(vec4 x) {
           ${n}
         }`,m="result = activation(result);");let h=r?"result += getBiasAtOutCoords();":"";r&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
       ${d}

       void main() {
         ivec4 coords = getOutputCoords();
         int batch = coords.x;
         ivec2 xRCCorner = coords.yz * strides - pads;
         int d2 = coords.w;
         int xRCorner = xRCCorner.x;
         int xCCorner = xRCCorner.y;

         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
         vec4 dotProd = vec4(0.000000000000001);

         ${f}

         vec4 result = dotProd - vec4(0.000000000000001);
         ${h}
         ${m}
         setOutput(result);
       }
     `}};var sS=class{constructor(e,r){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=e,this.enableShapeUniforms=Tt(this.outputShape.length);let{dataFormat:n}=r,o=Qt(),s=n==="channelsLast",i=s?1:2,a=s?2:3,l=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":`if(blockIndex < ${e[2]} && pos < ${e[1]}) {`,u="";for(let c=0;c<=1;c++)for(let p=0;p<=1;p++)u+=`
          blockIndex = rc.z + ${p};
          pos = rc.y + ${c};

          ${l}
            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];
            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);

            if(d0 < inputShape[${i}] && d0 >= 0) {
              // Use custom imod instead mod. On Intel GPU, mod may generate
              // unexpected value.
              // https://github.com/tensorflow/tfjs/issues/5447
              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];
              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /
                  inChannels);

              if(d1 < inputShape[${a}] && d1 >= 0) {

                ch = imod(pos, inChannels);

                if (${s}) {
                  innerDims = vec2(d1, ch);
                  result[${c*2+p}] = getChannel(
                    getA(rc.x, d0, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                } else {
                  innerDims = vec2(d0, d1);
                  result[${c*2+p}] = getChannel(
                    getA(rc.x, ch, int(innerDims.x),
                    int(innerDims.y)), innerDims);
                }
              }
            }
          }
        `;this.userCode=`
      void main() {
        ivec3 rc = getOutputCoords();

        vec4 result = vec4(0);

        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;
        vec2 innerDims;

        ${u}

        ${o.output} = result;
      }
    `}};function iS(t,e){let r=t.length;return r>=3?e?[...t.slice(0,-3),t[r-3]*t[r-2],t[r-1]]:[...t.slice(0,-3),t[r-3],t[r-2]*t[r-1]]:!e&&r===1&&t[0]>1?[t[0],1]:null}function aS({x:t,filter:e,convInfo:r,backend:n,bias:o=null,preluActivationWeights:s=null,leakyreluAlpha:i=0,activation:a=null}){let l=t.shape,u=n.texData.get(t.dataId),c=r.inChannels,p=l[0]*l[1]*l[2],f=r.outChannels,d=r.dataFormat==="channelsLast",m=!1,h=!1,g,x=[];if(s!=null){let v=iS(s.shape,d);v!=null&&(s=ce({inputs:{x:s},backend:n,attrs:{shape:v}}),x.push(s))}if(o!=null){let v=iS(o.shape,d);v!=null&&(o=ce({inputs:{x:o},backend:n,attrs:{shape:v}}),x.push(o))}if(!((p===1||f===1)&&c>eA)&&u.isPacked&&d&&u.texture!=null&&l[2]%2!==0&&w.arraysEqual(u.shape.slice(-3),l.slice(-3))){let v=l[0]*l[1]*(l[2]+1),C={dataId:t.dataId,shape:[1,v,r.inChannels],dtype:t.dtype},S=u.shape;u.shape=u.shape.slice(),u.shape[u.shape.length-2]++,w.assert(_f(u.shape,C.shape),()=>`packed reshape ${u.shape} to ${C.shape} isn't free`);let k=ce({inputs:{x:e},backend:n,attrs:{shape:[1,r.inChannels,r.outChannels]}});x.push(k);let N=Ff({a:C,b:k,backend:n,transposeA:m,transposeB:h,bias:o,activation:a,preluActivationWeights:s,leakyreluAlpha:i}),D=n.texData.get(N.dataId);w.assert(D.isPacked,()=>"batchMatMul result is expected to be packed"),u.shape=S,D.shape=r.outShape,g=lr({inputs:{x:N},backend:n}),g.shape=r.outShape,x.push(N)}else{let v=r.outHeight*r.outWidth,C=ce({inputs:{x:t},backend:n,attrs:{shape:d?[r.batchSize,v,r.inChannels]:[r.batchSize,r.inChannels,v]}}),S=ce({inputs:{x:e},backend:n,attrs:{shape:[1,r.inChannels,r.outChannels]}}),k=Ff({a:d?C:S,b:d?S:C,transposeA:!d,transposeB:h,backend:n,bias:o,activation:a,preluActivationWeights:s,leakyreluAlpha:i});g=ce({inputs:{x:k},backend:n,attrs:{shape:r.outShape}}),x.push(C),x.push(S),x.push(k)}for(let v of x)n.disposeIntermediateTensorInfo(v);return g}function lS({x:t,filter:e,convInfo:r,backend:n,bias:o=null,preluActivationWeights:s=null,leakyreluAlpha:i=0,activation:a=null}){let{filterWidth:l,filterHeight:u,inChannels:c,outWidth:p,outHeight:f,dataFormat:d}=r,m=d==="channelsLast",h=l*u*c,g=f*p,x=[r.batchSize,h,g],y=!0,b=!1,v=[];if(s!=null){let Z=iS(s.shape,m);Z!=null&&(s=ce({inputs:{x:s},backend:n,attrs:{shape:Z}}),v.push(s))}if(o!=null){let Z=iS(o.shape,m);Z!=null&&(o=ce({inputs:{x:o},backend:n,attrs:{shape:Z}}),v.push(o))}let C=ce({inputs:{x:e},backend:n,attrs:{shape:[1,h,w.sizeFromShape(e.shape)/h]}});v.push(C);let S=new sS(x,r),k=[t.shape,[r.padInfo.top,r.padInfo.left],[r.strideHeight,r.strideWidth],[r.dilationHeight,r.dilationWidth],[r.inChannels],[r.filterWidth*r.inChannels],[r.outWidth]],N=n.runWebGLProgram(S,[t],"float32",k),D=ce({inputs:{x:N},backend:n,attrs:{shape:x}});v.push(N),v.push(D);let $=o!=null,O=s!=null,V=a==="leakyrelu",K=a?Pl(a,!0):null,X=new Vh(m?D.shape:C.shape,m?C.shape:D.shape,m?[r.batchSize,g,r.outChannels]:[r.batchSize,r.outChannels,g],y,b,$,K,O,V),W=m?[D,C]:[C,D];if(o&&W.push(o),O&&W.push(s),V){let Z=n.makeTensorInfo([],"float32",w.createScalarValue(i,"float32"));W.push(Z),v.push(Z)}let H=n.runWebGLProgram(X,W,"float32"),Y=ce({inputs:{x:H},backend:n,attrs:{shape:r.outShape}});v.push(H);for(let Z of v)n.disposeIntermediateTensorInfo(Z);return Y}function _pe(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,filter:s}=e,{strides:i,pad:a,dataFormat:l,dilations:u,dimRoundingMode:c}=n,p=T.convertConv2DDataFormat(l),f=T.computeConv2DInfo(o.shape,s.shape,i,u,a,c,!1,p),d;if(f.filterHeight===1&&f.filterWidth===1&&f.dilationHeight===1&&f.dilationWidth===1&&f.strideHeight===1&&f.strideWidth===1&&(f.padInfo.type==="SAME"||f.padInfo.type==="VALID"))d=aS({x:o,filter:s,convInfo:f,backend:r});else if(f.strideWidth<=2&&p==="channelsLast"&&B().getBool("WEBGL_EXP_CONV")){let h=new Uh(f),g=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];d=r.runWebGLProgram(h,[o,s],"float32",g)}else if(B().getBool("WEBGL_CONV_IM2COL"))d=lS({x:o,filter:s,convInfo:f,backend:r});else{let h=new Gh(f);d=r.runWebGLProgram(h,[o,s],"float32")}let m=ce({inputs:{x:d},backend:r,attrs:{shape:f.outShape}});return r.disposeIntermediateTensorInfo(d),m}var _6={kernelName:Eu,backendName:"webgl",kernelFunc:_pe};var uS=class{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;let r=e.strideHeight,n=e.strideWidth,o=e.padInfo.top,s=e.padInfo.left,i=e.dataFormat==="channelsLast";this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int d2 = coords.w;

        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${r} - ${o};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${n} - ${s};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              if (${i}) {
                float dyValue = getDy(b, yR, yC, d2);
                float xValue = getX(b, xR, xC, d1);
                dotProd += (xValue * dyValue);
              } else {
                float dyValue = getDy(b, d2, yR, yC);
                float xValue = getX(b, d1, xR, xC);
                dotProd += (xValue * dyValue);
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}},cS=class{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;let r=e.filterHeight,n=e.filterWidth,o=e.strideHeight,s=e.strideWidth,i=e.dataFormat==="channelsLast",a=r-1-e.padInfo.top,l=n-1-e.padInfo.left,u=i?1:2,c=i?2:3,p=i?3:1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[${p}];

        ivec2 dyCorner = ivec2(coords[${u}], coords[${c}]) - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${r}; wR++) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${r} - 1 - wR;

          for (int wC = 0; wC < ${n}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${n} - 1 - wC;

            for (int d2 = 0; d2 < ${e.outChannels}; d2++) {

              if (${i}) {
                float xValue = getDy(batch, idyR, idyC, d2);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              } else {
                float xValue = getDy(batch, d2, idyR, idyC);
                float wValue = getW(wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }

            }
          }
        }
        setOutput(dotProd);
      }
    `}},pS=class{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;let r=e.strideDepth,n=e.strideHeight,o=e.strideWidth,s=e.padInfo.front,i=e.padInfo.top,a=e.padInfo.left;this.userCode=`
      void main() {
        ivec5 coords = getOutputCoords();
        int wF = coords.x;
        int wR = coords.y;
        int wC = coords.z;
        int d1 = coords.w;
        int d2 = coords.u;

        float dotProd = 0.0;

        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yF = 0; yF < ${e.outDepth}; yF++) {
            int xF = wF + yF * ${r} - ${s};

            if (xF < 0 || xF >= ${e.inDepth}) {
              continue;
            }

            for (int yR = 0; yR < ${e.outHeight}; yR++) {
              int xR = wR + yR * ${n} - ${i};

              if (xR < 0 || xR >= ${e.inHeight}) {
                continue;
              }

              for (int yC = 0; yC < ${e.outWidth}; yC++) {
                int xC = wC + yC * ${o} - ${a};

                if (xC < 0 || xC >= ${e.inWidth}) {
                  continue;
                }

                float dyValue = getDy(b, yF, yR, yC, d2);
                float xValue = getX(b, xF, xR, xC, d1);
                dotProd += (xValue * dyValue);
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}},fS=class{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;let r=e.filterDepth,n=e.filterHeight,o=e.filterWidth,s=e.strideDepth,i=e.strideHeight,a=e.strideWidth,l=r-1-e.padInfo.front,u=n-1-e.padInfo.top,c=o-1-e.padInfo.left;this.userCode=`
      const ivec3 pads = ivec3(${l}, ${u}, ${c});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.u;


        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyFCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        float dotProd = 0.0;
        for (int wF = 0; wF < ${r}; wF++) {
          float dyF = float(dyFCorner + wF) / ${s}.0;

          if (dyF < 0.0 || dyF >= ${e.outDepth}.0 || fract(dyF) > 0.0) {
            continue;
          }
          int idyF = int(dyF);

          int wFPerm = ${r} - 1 - wF;

          for (int wR = 0; wR < ${n}; wR++) {
            float dyR = float(dyRCorner + wR) / ${i}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
              fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            int wRPerm = ${n} - 1 - wR;

            for (int wC = 0; wC < ${o}; wC++) {
              float dyC = float(dyCCorner + wC) / ${a}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              int wCPerm = ${o} - 1 - wC;

              for (int d2 = 0; d2 < ${e.outChannels}; d2++) {
                float xValue = getDy(batch, idyF, idyR, idyC, d2);
                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);
                dotProd += xValue * wValue;
              }
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function Ape(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,dy:s}=e,{strides:i,pad:a,dataFormat:l,dimRoundingMode:u,filterShape:c}=n,p=T.convertConv2DDataFormat(l),f=T.computeConv2DInfo(o.shape,c,i,1,a,u,!1,p),d=new uS(f);return r.runWebGLProgram(d,[o,s],"float32")}var A6={kernelName:Wd,backendName:"webgl",kernelFunc:Ape};function Dpe(t){let{inputs:e,backend:r,attrs:n}=t,{dy:o,filter:s}=e,{inputShape:i,strides:a,pad:l,dataFormat:u,dimRoundingMode:c}=n,p=T.convertConv2DDataFormat(u),f=T.computeConv2DInfo(i,s.shape,a,1,l,c,!1,p),d=new cS(f);return r.runWebGLProgram(d,[o,s],"float32")}var D6={kernelName:_u,backendName:"webgl",kernelFunc:Dpe};function $pe(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,filter:s}=e,{strides:i,pad:a,dilations:l}=n,u=T.computeConv3DInfo(o.shape,s.shape,i,l,a),c=new oS(u);return r.runWebGLProgram(c,[o,s],"float32")}var $6={kernelName:Au,backendName:"webgl",kernelFunc:$pe};function Rpe(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,dy:s}=e,{strides:i,pad:a,filterShape:l}=n,u=T.computeConv3DInfo(o.shape,l,i,1,a),c=new pS(u);return r.runWebGLProgram(c,[o,s],"float32")}var R6={kernelName:Gd,backendName:"webgl",kernelFunc:Rpe};function Ope(t){let{inputs:e,backend:r,attrs:n}=t,{dy:o,filter:s}=e,{pad:i,strides:a,inputShape:l}=n,u=T.computeConv3DInfo(l,s.shape,a,1,i),c=new fS(u);return r.runWebGLProgram(c,[o,s],"float32")}var O6={kernelName:Ud,backendName:"webgl",kernelFunc:Ope};var Fpe=Ps+`
  return cos(x);
`,Ppe=Ne({opSnippet:Fpe}),F6={kernelName:_a,backendName:"webgl",kernelFunc:Ppe};var Lpe=`
  float e2x = exp(-x);
  return (e2x + 1.0 / e2x) / 2.0;
`,Mpe=Ne({opSnippet:Lpe}),P6={kernelName:Aa,backendName:"webgl",kernelFunc:Mpe};var dS=class{constructor(e,r,n,o,s){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];let[i,a,l,u]=e,[c]=r,[p,f]=n;this.outputShape=[c,p,f,u];let d=o==="bilinear"?1:0,[m,h]=[`${a-1}.0`,`${l-1}.0`],[g,x,y]=p>1?[`${(a-1)/(p-1)}`,"(y2-y1) * height_ratio",`y1*${m} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${m}`],[b,v,C]=f>1?[`${(l-1)/(f-1)}`,"(x2-x1) * width_ratio",`x1*${h} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${h}`];this.userCode=`
      const float height_ratio = float(${g});
      const float width_ratio = float(${b});
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int y = coords[1];
        int x = coords[2];
        int d = coords[3];

        // get box vals
        float y1 = getBoxes(b,0);
        float x1 = getBoxes(b,1);
        float y2 = getBoxes(b,2);
        float x2 = getBoxes(b,3);

        // get image in batch index
        int bInd = round(getBoxInd(b));
        if(bInd < 0 || bInd >= ${i}) {
          return;
        }

        float height_scale = ${x};
        float width_scale = ${v};

        float in_y = ${y};
        if( in_y < 0.0 || in_y > ${m} ) {
          setOutput(float(${s}));
          return;
        }
        float in_x = ${C};
        if( in_x < 0.0 || in_x > ${h} ) {
          setOutput(float(${s}));
          return;
        }

        vec2 sourceFracIndexCR = vec2(in_x,in_y);
        if(${d} == 1) {
          // Compute the four integer indices.
          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);
          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));

          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);
          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);
          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);
          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);

          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);

          float top = topLeft + (topRight - topLeft) * fracCR.x;
          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;
          float newValue = top + (bottom - top) * fracCR.y;
          setOutput(newValue);
        } else {
          // Compute the coordinators of nearest neighbor point.
          ivec2 sourceNearestCR = ivec2(floor(
            sourceFracIndexCR + vec2(0.5,0.5)));
          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);
          setOutput(newValue);
        }
      }
    `}};var zpe=t=>{let{inputs:e,backend:r,attrs:n}=t,{image:o,boxes:s,boxInd:i}=e,{cropSize:a,method:l,extrapolationValue:u}=n,c=new dS(o.shape,s.shape,a,l,u);return r.runWebGLProgram(c,[o,s,i],"float32")},L6={kernelName:qd,backendName:"webgl",kernelFunc:zpe};var Lf;(function(t){t.Prod="*",t.Sum="+"})(Lf||(Lf={}));var U0=class{constructor(e,r,n,o){this.op=e,this.outputShape=r,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];let s=this.outputShape.length,i=this.op===Lf.Prod?"1.0":"0.0",a=n?i:`getX(${M6(s,"coords",this.op)})`,l=this.outputShape[this.outputShape.length-1],u="",c="";n?(u=o?`end != ${l-1}`:"end != 0",c=o?"end + 1":"end - 1"):(u=o?`end + pow2 < ${l}`:"end >= pow2",c=o?"end + pow2":"end - pow2"),this.userCode=`
      void main() {
        ${He(s)} coords = getOutputCoords();
        int end = ${z6(s,"coords",this.op)};
        float val = ${a};
        int pow2 = int(pow(2.0, index));
        if (${u}) {
          int idx = ${c};
          ${z6(s,"coords",this.op)} = idx;
          val ${this.op}= getX(${M6(s,"coords",this.op)});
        }
        setOutput(val);
      }
    `}};function M6(t,e,r){if(t===1)return`${e}`;if(t===2)return`${e}.x, ${e}.y`;if(t===3)return`${e}.x, ${e}.y, ${e}.z`;if(t===4)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw new Error(`Cumulative ${r} for rank ${t} is not yet supported`)}function z6(t,e,r){if(t===1)return`${e}`;if(t===2)return`${e}.y`;if(t===3)return`${e}.z`;if(t===4)return`${e}.w`;throw new Error(`Cumulative ${r} for rank ${t} is not yet supported`)}function mS(t,e,r,n,o,s){let i=e.shape.length,a=T.getAxesPermutation([n],i),l=e;a!=null&&(l=Gt({inputs:{x:e},backend:r,attrs:{perm:a}}));let u=T.getInnerMostAxes(1,i)[0];if(u!==i-1)throw new Error(`WebGL cumprod shader expects an inner-most axis=${e.shape.length-1} but got axis=${n}`);let c=l.shape[u],p=lr({inputs:{x:l},backend:r});for(let f=0;f<=Math.ceil(Math.log2(c))-1;f++){let d=new U0(t,l.shape,!1,s),m=[[f]],h=p;p=r.runWebGLProgram(d,[p],p.dtype,m),r.disposeIntermediateTensorInfo(h)}if(o){let f=new U0(t,l.shape,o,s),d=p;p=r.runWebGLProgram(f,[p],p.dtype),r.disposeIntermediateTensorInfo(d)}if(a!=null){let f=T.getUndoAxesPermutation(a),d=Gt({inputs:{x:p},backend:r,attrs:{perm:f}});return r.disposeIntermediateTensorInfo(p),r.disposeIntermediateTensorInfo(l),d}return p}function Bpe(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{axis:s,exclusive:i,reverse:a}=n;return mS(Lf.Prod,o,r,s,i,a)}var B6={kernelName:Hd,backendName:"webgl",kernelFunc:Bpe};function Vpe(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{axis:s,exclusive:i,reverse:a}=n;return mS(Lf.Sum,o,r,s,i,a)}var V6={kernelName:Du,backendName:"webgl",kernelFunc:Vpe};function Wpe(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,weights:s}=e,{size:i,binaryOutput:a}=n;if(o.shape.length===1){let l=r.readSync(o.dataId),u=r.readSync(s.dataId),c=AC(l,u,s.dtype,s.shape,i);return r.makeTensorInfo([i],s.dtype,c)}else if(o.shape.length===2){let l=r.bufferSync(o),u=r.bufferSync(s),c=_W(l,u,i,a);return r.makeTensorInfo(c.shape,s.dtype,c.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${o.shape.length}.`)}var W6={kernelName:jd,backendName:"webgl",kernelFunc:Wpe};var hS=class{constructor(e,r,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=e,this.blockSize=r,this.dataFormat=n,this.userCode=`
    void main() {
      ivec4 coords = getOutputCoords();
      int b = coords[0];
      int h = ${this.getHeightCoordString()};
      int w = ${this.getWidthCoordString()};
      int d = ${this.getDepthCoordString()};

      int in_h = h / ${r};
      int offset_h = imod(h, ${r});
      int in_w = w / ${r};
      int offset_w = imod(w, ${r});
      int offset_d = (offset_h * ${r} + offset_w) *
        ${this.getOutputDepthSize()};
      int in_d = d + offset_d;

      float result = ${this.getInputSamplingString()};
      setOutput(result);
    }
  `}getHeightCoordString(){return this.dataFormat==="NHWC"?"coords[1]":"coords[2]"}getWidthCoordString(){return this.dataFormat==="NHWC"?"coords[2]":"coords[3]"}getDepthCoordString(){return this.dataFormat==="NHWC"?"coords[3]":"coords[1]"}getOutputDepthSize(){return this.dataFormat==="NHWC"?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return this.dataFormat==="NHWC"?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}};function Gpe(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{blockSize:s,dataFormat:i}=n,a=o.shape[0],l=i==="NHWC"?o.shape[1]:o.shape[2],u=i==="NHWC"?o.shape[2]:o.shape[3],c=i==="NHWC"?o.shape[3]:o.shape[1],p=l*s,f=u*s,d=c/(s*s),m=i==="NHWC"?[a,p,f,d]:[a,d,p,f],h=new hS(m,s,i);return r.runWebGLProgram(h,[o],o.dtype)}var G6={kernelName:Kd,backendName:"webgl",kernelFunc:Gpe};var Hh=class{constructor(e,r=!1,n=null,o=!1,s=!1){this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Tt(this.outputShape.length);let i=e.filterHeight,a=e.filterWidth,l=e.outChannels/e.inChannels,u="",c="";n&&(o?u=`float activation(float a) {
          float b = getPreluActivationWeightsAtOutCoords();
          ${n}
        }`:s?u=`float activation(float a) {
          float b = getLeakyreluAlphaAtOutCoords();
          ${n}
        }`:u=`
          float activation(float x) {
            ${n}
          }
        `,c="result = activation(result);");let p=r?"result += getBiasAtOutCoords();":"";r&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${u}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${l};
        int q = d2 - d1 * ${l};

        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.
        for (int wR = 0; wR < ${i}; wR++) {
          int xR = xRCorner + wR * dilations[0];

          if (xR < 0 || xR >= inDims[0]) {
            continue;
          }

          for (int wC = 0; wC < ${a}; wC++) {
            int xC = xCCorner + wC * dilations[1];

            if (xC < 0 || xC >= inDims[1]) {
              continue;
            }

            float xVal = getX(batch, xR, xC, d1);
            float wVal = getW(wR, wC, d1, q);
            dotProd += xVal * wVal;
          }
        }

        float result = dotProd;
        ${p}
        ${c}
        setOutput(result);
      }
    `}};var qh=class{constructor(e,r=!1,n=null,o=!1,s=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=e.outShape,this.enableShapeUniforms=Tt(this.outputShape.length);let i=e.outChannels/e.inChannels,a=e.padInfo.left,l=e.strideWidth,u=e.dilationWidth,c=e.filterHeight,p=e.filterWidth,f=p,d=`
      int xR; int xC; int xCOffset;
      vec4 wTexel; vec4 previous; vec4 final;`;for(let x=0;x<p;x++)d+=`
          vec4 xTexelC${x*2};
          int xTexelC${x*2}Ready;
          vec4 xTexelC${x*2+1};
          int xTexelC${x*2+1}Ready;
          vec4 xC${x};`;d+=`
    for (int r = 0; r < ${c}; r++) {
      `;for(let x=0;x<p;x++)d+=`
          xTexelC${x*2} = vec4(0.0);
          xTexelC${x*2}Ready = 0;
          xTexelC${x*2+1} = vec4(0.0);
          xTexelC${x*2+1}Ready = 0;
          xC${x} = vec4(0.0);`;d+=`
        xR = xRCorner + r * dilations[0];
        if (xR >=0 && xR < inDims[0]) {
      `;for(let x=0;x<(f+1)/2;x++){let y=x*2;if(d+=`
          xC = xCCorner + ${y*u};
          `,l===1){if(y<p&&(a%2===1?(d+=`
                xCOffset = xC + 1;
                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                  xTexelC${y} = getX(batch, xR, xCOffset, d1);

                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${y}.zw = vec2(0.0);
                  }
                  xTexelC${y}Ready = 1;
                }
              `,u===1&&y>0?d+=`
                xC${y} = vec4(xTexelC${y-2}.zw, xTexelC${y}.xy);
                `:d+=`
                  xCOffset = xC + 1 - 2;

                  if (xCOffset >= 0 && xCOffset < inDims[1]) {
                    previous = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      previous.zw = vec2(0.0);
                    }

                    xC${y} = vec4(previous.zw, xTexelC${y}.xy);
                  } else {
                    xC${y} = vec4(0.0, 0.0, xTexelC${y}.xy);
                  }
                  `):d+=`
                if (xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                  xTexelC${y} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${y}.zw = vec2(0.0);
                  }
                  xTexelC${y}Ready = 1;
                }

                xC${y} = xTexelC${y};
                `,y+1<p)){let b=a%2===0?w.nearestLargerEven(u):u;u%2===0&&a%2===1||u%2!==0&&a%2!==1?(d+=`
                  xCOffset = xC + imod(pads[1], 2) + ${b};

                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                    xTexelC${y+1} = getX(batch, xR, xCOffset, d1);

                    // Need to manually clear unused channels in case
                    // we're reading from recycled texture.
                    if (xCOffset + 1 >= inDims[1]) {
                      xTexelC${y+1}.zw = vec2(0.0);
                    }
                    xTexelC${y+1}Ready = 1;
                  }
                  `,u>1?d+=`
                    xCOffset -= 2;
                    if (xCOffset >= 0 && xCOffset < inDims[1]) {
                     previous = getX(batch, xR, xCOffset, d1);
                     xC${y+1} = vec4(previous.zw, xTexelC${y+1}.xy);
                    } else {
                     xC${y+1} = vec4(0.0, 0.0, xTexelC${y+1}.xy);
                    }
                    `:d+=`
                    xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.xy);
                    `):b===1?d+=`
                    xC${y+1} = xTexelC${y};
                    `:d+=`
                    xCOffset = xC + ${b};

                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                      xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                      if (xCOffset + 1 >= inDims[1]) {
                        xTexelC${y+1}.zw = vec2(0.0);
                      }
                      xTexelC${y+1}Ready = 1;
                    }

                    xC${y+1} = xTexelC${y+1};
                    `}}else y<p&&(a%2===1?(d+=`
                xCOffset = xC + 1 - strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y}Ready == 0) {
                  xTexelC${y} = getX(batch, xR, xCOffset, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${y}.zw = vec2(0.0);
                  }
                  xTexelC${y}Ready = 1;
                }

                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC${y+1}Ready == 0) {
                  xTexelC${y+1} = getX(batch, xR, xC + 1, d1);
                  // Need to manually clear unused channels in case
                  // we're reading from recycled texture.
                  if (xC + 2 >= inDims[1]) {
                    xTexelC${y+1}.zw = vec2(0.0);
                  }
                  xTexelC${y+1}Ready = 1;
                }

                xC${y} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
              `,y+1<p&&(d+=`
                  final = vec4(0.0);
                  xCOffset = xC + 1 + strides[1];
                  if(xCOffset >= 0 && xCOffset < inDims[1]) {
                    final = getX(batch, xR, xCOffset, d1);
                  }
                  xC${y+1} = vec4(xTexelC${y+1}.xy, final.xy);
                `)):(d+=`
                if(xC >= 0 && xC < inDims[1] && xTexelC${y}Ready == 0) {
                  xTexelC${y} = getX(batch, xR, xC, d1);
                  if (xC + 1 >= inDims[1]) {
                    xTexelC${y}.zw = vec2(0.0);
                  }
                  xTexelC${y}Ready = 1;
                }

                xCOffset = xC + strides[1];
                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC${y+1}Ready == 0) {
                  xTexelC${y+1} = getX(batch, xR, xCOffset, d1);
                  if (xCOffset + 1 >= inDims[1]) {
                    xTexelC${y+1}.zw = vec2(0.);
                  }
                  xTexelC${y+1}Ready = 1;
                }

                xC${y} = vec4(
                  xTexelC${y}.xy, xTexelC${y+1}.xy);
              `,y+1<p&&(d+=`
                  xC${y+1} = vec4(xTexelC${y}.zw, xTexelC${y+1}.zw);
                `)));y<p&&(d+=`
            wTexel = getW(r, ${y}, d1, q);
            dotProd += xC${y} * vec4(wTexel.xz, wTexel.xz);
          `,y+1<p&&(d+=`
              wTexel = getW(r, ${y+1}, d1, q);
              dotProd += xC${y+1} * vec4(wTexel.xz, wTexel.xz);
            `))}d+=`
    }
  `,d+=`
      }
    `;let m="",h="";n&&(o?m=`vec4 activation(vec4 a) {
          vec4 b = getPreluActivationWeightsAtOutCoords();
          ${n}
        }`:s?m=`vec4 activation(vec4 a) {
          vec4 b = getLeakyreluAlphaAtOutCoords();
          ${n}
        }`:m=`vec4 activation(vec4 x) {
          ${n}
        }`,h="result = activation(result);");let g=r?"result += getBiasAtOutCoords();":"";r&&this.variableNames.push("bias"),o&&this.variableNames.push("preluActivationWeights"),s&&this.variableNames.push("leakyreluAlpha"),this.userCode=`
      ${m}

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        ivec2 xRCCorner = coords.yz * strides - pads;
        int d2 = coords.w;
        int d1 = d2 / ${i};
        int q = d2 - d1 * ${i};
        int xRCorner = xRCCorner.x;
        int xCCorner = xRCCorner.y;

        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.
        vec4 dotProd = vec4(0.000000000000001);

        ${d}

        vec4 result = dotProd - vec4(0.000000000000001);
        ${g}
        ${h}
        setOutput(result);
      }
    `}};function Upe(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,filter:s}=e,{strides:i,pad:a,dilations:l,dimRoundingMode:u}=n,c=l;c==null&&(c=[1,1]),w.assert(T.eitherStridesOrDilationsAreOne(i,c),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${i} and dilations '${c}'`);let p=T.computeConv2DInfo(o.shape,s.shape,i,c,a,u,!0),f;B().getBool("WEBGL_PACK_DEPTHWISECONV")&&p.strideWidth<=2&&p.outChannels/p.inChannels===1?f=new qh(p):f=new Hh(p);let d=[[p.padInfo.top,p.padInfo.left],[p.strideHeight,p.strideWidth],[p.dilationHeight,p.dilationWidth],[p.inHeight,p.inWidth]];return r.runWebGLProgram(f,[o,s],"float32",d)}var U6={kernelName:$u,backendName:"webgl",kernelFunc:Upe};var gS=class{constructor(e){this.variableNames=["x","dy"],this.outputShape=e.filterShape;let r=e.strideHeight,n=e.strideWidth,o=e.padInfo.top,s=e.padInfo.left,i=e.outChannels/e.inChannels;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int wR = coords.x;
        int wC = coords.y;
        int d1 = coords.z;
        int dm = coords.w;
        int d2 = d1 * ${i} + dm;

        float dotProd = 0.0;

        // TO DO: Vec4 over the batch size
        for (int b = 0; b < ${e.batchSize}; b++) {
          for (int yR = 0; yR < ${e.outHeight}; yR++) {
            int xR = wR + yR * ${r} - ${o};

            if (xR < 0 || xR >= ${e.inHeight}) {
              continue;
            }

            for (int yC = 0; yC < ${e.outWidth}; yC++) {
              int xC = wC + yC * ${n} - ${s};

              if (xC < 0 || xC >= ${e.inWidth}) {
                continue;
              }

              float dyValue = getDy(b, yR, yC, d2);
              float xValue = getX(b, xR, xC, d1);
              dotProd += (xValue * dyValue);
            }
          }
        }
        setOutput(dotProd);
      }
    `}},xS=class{constructor(e){this.variableNames=["dy","W"],this.outputShape=e.inShape;let r=e.filterHeight,n=e.filterWidth,o=e.strideHeight,s=e.strideWidth,i=r-1-e.padInfo.top,a=n-1-e.padInfo.left,l=e.outChannels/e.inChannels;this.userCode=`
      const ivec2 pads = ivec2(${i}, ${a});

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords[0];
        int d1 = coords[3];
        ivec2 dyCorner = coords.yz - pads;
        int dyRCorner = dyCorner.x;
        int dyCCorner = dyCorner.y;

        float dotProd = 0.0;

        for (int wR = 0; wR < ${r}; wR++) {
          float dyR = float(dyRCorner + wR) / ${o}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          int wRPerm = ${r} - 1 - wR;

          for (int wC = 0; wC < ${n}; wC++) {
            float dyC = float(dyCCorner + wC) / ${s}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            int wCPerm = ${n} - 1 - wC;

            // TO DO: Vec4 over the channelMul
            for (int dm = 0; dm < ${l}; dm++) {
              int d2 = d1 * ${l} + dm;
              float xValue = getDy(batch, idyR, idyC, d2);
              float wValue = getW(wRPerm, wCPerm, d1, dm);
              dotProd += xValue * wValue;
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function Hpe(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,dy:s}=e,{strides:i,dilations:a,pad:l,dimRoundingMode:u,filterShape:c}=n,p=T.computeConv2DInfo(o.shape,c,i,a,l,u,!0),f=new gS(p);return r.runWebGLProgram(f,[o,s],"float32")}var H6={kernelName:Xd,backendName:"webgl",kernelFunc:Hpe};function qpe(t){let{inputs:e,backend:r,attrs:n}=t,{dy:o,filter:s}=e,{strides:i,dilations:a,pad:l,dimRoundingMode:u,inputShape:c}=n,p=T.computeConv2DInfo(c,s.shape,i,a,l,u,!0),f=new xS(p);return r.runWebGLProgram(f,[o,s],"float32")}var q6={kernelName:Yd,backendName:"webgl",kernelFunc:qpe};var yS=class{constructor(e){this.variableNames=["X"],this.outputShape=[e,e],this.userCode=`
      void main() {
          ivec2 coords = getOutputCoords();
          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;
          setOutput(val);
      }
    `}};function jpe(t){let{inputs:e,backend:r}=t,{x:n}=e,o=[...n.shape,...n.shape],s=w.sizeFromShape(n.shape),i=ce({inputs:{x:n},backend:r,attrs:{shape:[s]}}),a=new yS(s),l=r.runWebGLProgram(a,[i],i.dtype),u=ce({inputs:{x:l},backend:r,attrs:{shape:o}});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(l),u}var j6={kernelName:Lv,backendName:"webgl",kernelFunc:jpe};var bS=class{constructor(e){this.variableNames=["x","W"],this.outputShape=e.outShape;let{inHeight:r,inWidth:n,padInfo:o,strideHeight:s,strideWidth:i,filterHeight:a,filterWidth:l,dilationHeight:u,dilationWidth:c}=e,{top:p,left:f}=o;this.userCode=`
      const ivec2 strides = ivec2(${s}, ${i});
      const ivec2 pads = ivec2(${p}, ${f});
      const float neg_infinity = -3.4e38;

      void main() {
        ivec4 coords = getOutputCoords();
        int batch = coords.x;
        int d1 = coords.w;
        ivec2 outTopLeftCorner =
            coords.yz * strides - pads;
        int hBeg = outTopLeftCorner.x;
        int wBeg = outTopLeftCorner.y;

        float curVal = neg_infinity;
        for (int h = 0; h < ${a}; h++) {
          int hIn = hBeg + h * ${u};

          if (hIn >= 0 && hIn < ${r}) {
            for (int w = 0; w < ${l}; w++) {
              int wIn = wBeg + w * ${c};

              if (wIn >= 0 && wIn < ${n}) {
                float xVal = getX(batch, hIn, wIn, d1);
                float wVal = getW(h, w, d1);

                float val = xVal + wVal;
                if (val > curVal) {
                  curVal = val;
                }
              }
            }
          }
        }

        float result = curVal;
        setOutput(result);
      }
    `}};function Kpe(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,filter:s}=e,{strides:i,pad:a,dilations:l}=n,u=T.computeDilation2DInfo(o.shape,s.shape,i,a,"NHWC",l),c,p=new bS(u);c=r.runWebGLProgram(p,[o,s],"float32");let f=ce({inputs:{x:c},backend:r,attrs:{shape:u.outShape}});return r.disposeIntermediateTensorInfo(c),f}var K6={kernelName:Ru,backendName:"webgl",kernelFunc:Kpe};function Xpe(t){let{inputs:e,backend:r,attrs:n}=t,{equation:o}=n,s=e,{allDims:i,summedDims:a,idDims:l}=T.decodeEinsumEquation(o,s.length);T.checkEinsumDimSizes(i.length,l,s);let{path:u,steps:c}=T.getEinsumComputePath(a,l),p=c.length,f=null,d=i.length,m=[];for(let h=0;h<p;++h){for(let g of c[h]){let{permutationIndices:x,expandDims:y}=T.getEinsumPermutation(d,l[g]),b;T.isIdentityPermutation(x)?b=s[g]:(b=Gt({inputs:{x:s[g]},backend:r,attrs:{perm:x}}),m.push(b));let v=b.shape.slice();for(let C=0;C<y.length;++C)v.splice(y[C],0,1);w.arraysEqual(b.shape,v)||(b=ce({inputs:{x:b},backend:r,attrs:{shape:v}}),m.push(b)),f===null?f=b:(f=W0({inputs:{a:b,b:f},backend:r}),m.push(f))}h<p-1&&(u[h]>=0&&(f=Of({inputs:{x:f},backend:r,attrs:{axis:u[h]-(i.length-d),keepDims:!1}}),m.push(f)),d--)}for(let h of m)h!==f&&r.disposeIntermediateTensorInfo(h);return f}var X6={kernelName:Qd,backendName:"webgl",kernelFunc:Xpe};var Ype="return (x >= 0.0) ? x : (exp(x) - 1.0);",Qpe=`
  vec4 result;

  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);
  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);
  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);
  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);

  return result;
`,Zpe=Ne({opSnippet:Ype,packedOpSnippet:Qpe}),Y6={kernelName:$a,backendName:"webgl",kernelFunc:Zpe};var Jpe="return (b >= 1.0) ? a : a * (b + 1.0);",efe=`
  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));
  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));
`,tfe=t=>{let{inputs:e,backend:r}=t,{dy:n,y:o}=e,s=B().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Fs(efe,n.shape,o.shape):new ts(Jpe,n.shape,o.shape);return r.runWebGLProgram(s,[n,o],n.dtype)},Q6={kernelName:Zd,backendName:"webgl",kernelFunc:tfe};var rfe=`
  return vec4(equal(a, b));
`,nfe="return float(a == b);",ofe=ut({opSnippet:nfe,packedOpSnippet:rfe,dtype:"bool",cpuKernelImpl:RW}),Z6={kernelName:Ep,backendName:"webgl",kernelFunc:ofe};var sfe=`
  // Error function is calculated approximately with elementary function.
  // See "Handbook of Mathematical Functions with Formulas,
  // Graphs, and Mathematical Tables", Abramowitz and Stegun.
  float p = ${T.ERF_P};
  float a1 = ${T.ERF_A1};
  float a2 = ${T.ERF_A2};
  float a3 = ${T.ERF_A3};
  float a4 = ${T.ERF_A4};
  float a5 = ${T.ERF_A5};

  float sign = sign(x);
  x = abs(x);
  float t = 1.0 / (1.0 + p * x);
  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));
`,ife=Ne({opSnippet:sfe}),J6={kernelName:Ra,backendName:"webgl",kernelFunc:ife};var afe=Ps+`
  return exp(x);
`,lfe=`
  vec4 result = exp(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,sA=Ne({opSnippet:afe,packedOpSnippet:lfe,cpuKernelImpl:OW,dtype:"float32"}),eU={kernelName:Oa,backendName:"webgl",kernelFunc:sA};function vS(t){let{inputs:e,attrs:r,backend:n}=t,{dim:o}=r,{input:s}=e,i=s.shape.length,a=s.shape.slice(),l=o;return o<0&&(w.assert(-(i+1)<=o,()=>`Axis must be in the interval [${-(i+1)}, ${i}]`),l=i+o+1),a.splice(l,0,1),ce({inputs:{x:s},backend:n,attrs:{shape:a}})}var tU={kernelName:Ou,backendName:"webgl",kernelFunc:vS};var rU="return exp(x) - 1.0;",ufe=Ne({opSnippet:rU,packedOpSnippet:rU,cpuKernelImpl:FW}),nU={kernelName:Fa,backendName:"webgl",kernelFunc:ufe};var H0=class{constructor(e,r,n){this.variableNames=["real","imag"];let o=r[1];this.outputShape=r;let s=n?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,i=n?`${o}.0`:"1.0",a;if(e==="real")a="return real * expR - imag * expI;";else if(e==="imag")a="return real * expI + imag * expR;";else throw new Error(`FFT component must be either "real" or "imag", got ${e}.`);this.userCode=`
      const float exponentMultiplier = ${s};

      float unaryOpComplex(float real, float expR, float imag, float expI) {
        ${a}
      }

      float mulMatDFT(int batch, int index) {
        float indexRatio = float(index) / float(${o});
        float exponentMultiplierTimesIndexRatio =
            exponentMultiplier * indexRatio;

        float result = 0.0;

        for (int i = 0; i < ${o}; i++) {
          // x = (-2|2 * PI / N) * index * i;
          float x = exponentMultiplierTimesIndexRatio * float(i);
          float expR = cos(x);
          float expI = sin(x);
          float real = getReal(batch, i);
          float imag = getImag(batch, i);

          result +=
              unaryOpComplex(real, expR, imag, expI) / ${i};
        }

        return result;
      }

      void main() {
        ivec2 coords = getOutputCoords();
        setOutput(mulMatDFT(coords[0], coords[1]));
      }
    `}};function wS(t,e,r){let n=r.texData.get(t.dataId),o=w.sizeFromShape(t.shape),s=t.shape[t.shape.length-1],i=o/s,a=ce({inputs:{x:t},backend:r,attrs:{shape:[i,s]}}),l=a.shape,u=new H0("real",l,e),c=new H0("imag",l,e),p=[{dataId:n.complexTensorInfos.real.dataId,dtype:n.complexTensorInfos.real.dtype,shape:l},{dataId:n.complexTensorInfos.imag.dataId,dtype:n.complexTensorInfos.imag.dtype,shape:l}],f=r.runWebGLProgram(u,p,"float32"),d=r.runWebGLProgram(c,p,"float32"),m=po({inputs:{real:f,imag:d},backend:r});r.disposeIntermediateTensorInfo(f),r.disposeIntermediateTensorInfo(d);let h=ce({inputs:{x:m},backend:r,attrs:{shape:t.shape}});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(m),h}function cfe(t){let{inputs:e,backend:r}=t,{input:n}=e;return wS(n,!1,r)}var oU={kernelName:Jd,backendName:"webgl",kernelFunc:cfe};var CS=class{constructor(e,r){this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=e,this.userCode=`
      void main() {
        // Input can be obtained from uniform value.
        setOutput(value);
      }
    `}};function Ml(t){let{backend:e,attrs:r}=t,{shape:n,value:o}=r,{dtype:s}=r;if(s=s||w.inferDtype(o),s==="string"){let i=w.getArrayFromDType(s,w.sizeFromShape(n));return i.fill(o),e.makeTensorInfo(n,s,i)}else{let i=new CS(n,o),a=[[o]];return e.runWebGLProgram(i,[],s,a)}}var sU={kernelName:em,backendName:"webgl",kernelFunc:Ml};var SS=class{constructor(e){this.variableNames=["Image"],this.outputShape=[];let r=e[2];this.outputShape=e,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];

          int coordX = ${r} - x - 1;
          float outputValue;
          if(coordX >= 0 && coordX < ${r}) {
            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);
          } else {
            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);
          }
          setOutput(outputValue);
        }
    `}};var iU={kernelName:tm,backendName:"webgl",kernelFunc:({inputs:t,backend:e})=>{let{image:r}=t,n=e,o=new SS(r.shape);return n.runWebGLProgram(o,[r],r.dtype)}};var aU="return floor(x);",pfe=Ne({opSnippet:aU,packedOpSnippet:aU,cpuKernelImpl:PW}),lU={kernelName:Pa,backendName:"webgl",kernelFunc:pfe};var ffe=`
  float s = sign(a) * sign(b);
  int ia = round(a);
  int ib = round(b);
  if (ib != 0) {
    // Windows (D3D) wants guaranteed non-zero int division at compile-time.
    return float(idiv(ia, ib, s));
  } else {
    return NAN;
  }
`,dfe=`
  ivec4 ia = round(a);
  ivec4 ib = round(b);
  bvec4 cond = notEqual(ib, ivec4(0));
  ivec4 result = ivec4(0);
  vec4 s = sign(a) * sign(b);

  // Windows (D3D) wants guaranteed non-zero int division at compile-time.
  if (cond[0]) {
    result[0] = idiv(ia[0], ib[0], s[0]);
  }
  if (cond[1]) {
    result[1] = idiv(ia[1], ib[1], s[1]);
  }
  if (cond[2]) {
    result[2] = idiv(ia[2], ib[2], s[2]);
  }
  if (cond[3]) {
    result[3] = idiv(ia[3], ib[3], s[3]);
  }
  return vec4(result);
`,mfe=ut({opSnippet:ffe,packedOpSnippet:dfe,dtype:"int32"}),uU={kernelName:La,backendName:"webgl",kernelFunc:mfe};var kS=class{constructor(e){this.variableNames=["A"];let r=Qt(),[n,o]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];
        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${o}.0, ${n}.0);

        vec4 values = ${r.texture2D}(A, uv);
        float value;
        if (depth == 0) {
          value = values.r;
        } else if (depth == 1) {
          value = values.g;
        } else if (depth == 2) {
          value = values.b;
        } else if (depth == 3) {
          value = values.a;
        }

        setOutput(floor(value * 255.0 + 0.5));
      }
    `}};var TS=class{constructor(e){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;let r=Qt(),[n,o]=e;this.outputShape=e,this.userCode=`
      void main() {
        ivec3 coords = getOutputCoords();
        int texR = coords[0];
        int texC = coords[1];
        int depth = coords[2];

        vec4 result = vec4(0.);

        for(int row=0; row<=1; row++) {
          for(int col=0; col<=1; col++) {
            texC = coords[1] + row;
            depth = coords[2] + col;

            vec2 uv = (vec2(texC, texR) + halfCR) /
                       vec2(${o}.0, ${n}.0);
            vec4 values = ${r.texture2D}(A, uv);
            float value;
            if (depth == 0) {
              value = values.r;
            } else if (depth == 1) {
              value = values.g;
            } else if (depth == 2) {
              value = values.b;
            } else if (depth == 3) {
              value = values.a;
            }

            result[row * 2 + col] = floor(value * 255.0 + 0.5);
          }
        }

        ${r.output} = result;
      }
    `}};var cU={kernelName:xx,backendName:"webgl",kernelFunc:hfe},jh,iA=B().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");function hfe(t){let{inputs:e,backend:r,attrs:n}=t,{pixels:o}=e,{numChannels:s}=n,i=typeof HTMLVideoElement<"u"&&o instanceof HTMLVideoElement,a=typeof HTMLImageElement<"u"&&o instanceof HTMLImageElement,[l,u]=i?[o.videoWidth,o.videoHeight]:[o.width,o.height],c=[u,l],p=[u,l,s];if(a||i){let h=B().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");(jh==null||h!==iA)&&(iA=h,jh=document.createElement("canvas").getContext("2d",{willReadFrequently:iA})),jh.canvas.width=l,jh.canvas.height=u,jh.drawImage(o,0,0,l,u),o=jh.canvas}let f=r.makeTensorInfo(c,"int32");r.texData.get(f.dataId).usage=Sn.PIXELS,r.gpgpu.uploadPixelDataToTexture(r.getTexture(f.dataId),o);let d=B().getBool("WEBGL_PACK")?new TS(p):new kS(p),m=r.runWebGLProgram(d,[f],"int32");return r.disposeData(f.dataId),m}function gfe(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,filter:s,bias:i,preluActivationWeights:a}=e,{strides:l,pad:u,dataFormat:c,dilations:p,dimRoundingMode:f,activation:d,leakyreluAlpha:m}=n,h=T.convertConv2DDataFormat(c),g=T.computeConv2DInfo(o.shape,s.shape,l,p,u,f,!1,h),x,y=[],b=i!=null,v=a!=null,C=d==="leakyrelu",S=()=>{let N=[o,s],D=($,O)=>{if(O==="NCHW"&&$.shape.length===1&&$.shape[0]!==1){let V=ce({inputs:{x:$},backend:r,attrs:{shape:[$.shape[0],1,1]}});return y.push(V),V}return $};if(b&&N.push(D(i,c)),v&&N.push(D(a,c)),C){let $=r.makeTensorInfo([],"float32",w.createScalarValue(m,"float32"));N.push($),y.push($)}return N};if(g.filterHeight===1&&g.filterWidth===1&&g.dilationHeight===1&&g.dilationWidth===1&&g.strideHeight===1&&g.strideWidth===1&&(g.padInfo.type==="SAME"||g.padInfo.type==="VALID"))x=aS({x:o,filter:s,convInfo:g,backend:r,bias:i,activation:d,preluActivationWeights:a,leakyreluAlpha:m});else if(g.strideWidth<=2&&h==="channelsLast"&&B().getBool("WEBGL_EXP_CONV")){let N=d?Pl(d,!0):null,D=new Uh(g,b,N,v,C),$=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],O=S();x=r.runWebGLProgram(D,O,"float32",$)}else if(B().getBool("WEBGL_CONV_IM2COL"))x=lS({x:o,filter:s,convInfo:g,backend:r,bias:i,activation:d,preluActivationWeights:a,leakyreluAlpha:m});else{let N=d?Pl(d,!1):null,D=new Gh(g,b,N,v,C),$=S();x=r.runWebGLProgram(D,$,"float32")}let k=ce({inputs:{x},backend:r,attrs:{shape:g.outShape}});return y.push(x),y.forEach(N=>r.disposeIntermediateTensorInfo(N)),k}var pU={kernelName:Lp,backendName:"webgl",kernelFunc:gfe};function xfe(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,filter:s,bias:i,preluActivationWeights:a}=e,{strides:l,pad:u,dilations:c,dimRoundingMode:p,activation:f,leakyreluAlpha:d}=n,m=[],h=c;h==null&&(h=[1,1]),w.assert(T.eitherStridesOrDilationsAreOne(l,h),()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${l} and dilations '${h}'`);let g=T.computeConv2DInfo(o.shape,s.shape,l,h,u,p,!0),x=B().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels===1,y=f?Pl(f,x):null,b=[o,s],v=i!=null,C=a!=null,S=f==="leakyrelu";if(v&&b.push(i),C&&b.push(a),S){let $=r.makeTensorInfo([],"float32",w.createScalarValue(d,"float32"));b.push($),m.push($)}let k;x?k=new qh(g,v,y,C,S):k=new Hh(g,v,y,C,S);let N=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],D=r.runWebGLProgram(k,b,"float32",N);return m.forEach($=>r.disposeIntermediateTensorInfo($)),D}var fU={kernelName:Mp,backendName:"webgl",kernelFunc:xfe};var NS=class{constructor(e,r,n,o){this.sliceDim=e,this.strides=r,this.paramsShape=o,this.variableNames=["x","indices"],this.outputShape=n;let s=He(n.length),i=`
    int index;`;for(let a=0;a<this.sliceDim;a++)i+=`
          index = round(getIndices(coords[0], ${a}));
          out_of_bounds = out_of_bounds || index < 0;
          out_of_bounds = out_of_bounds || index >= ${this.paramsShape[a]};
          flattenIndex += index * ${this.strides[a]};`;this.userCode=`
         void main() {
          ${s} coords = getOutputCoords();
          int flattenIndex = 0;
          bool out_of_bounds = false;

          ${i}

          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));
        }
      `}};function yfe(t){let{inputs:e,backend:r}=t,{params:n,indices:o}=e,s=o.shape,i=s[s.length-1],a=w.sizeFromShape(n.shape),[l,u,c,p]=T.prepareAndValidate(n,o),f=ce({inputs:{x:o},backend:r,attrs:{shape:[u,i]}}),d=ce({inputs:{x:n},backend:r,attrs:{shape:[w.sizeFromShape(n.shape)/c,c]}});if(r.shouldExecuteOnCPU([n,o])||n.dtype==="string"){let x=r.readSync(o.dataId),y=r.bufferSync(n),b=LW(x,y,n.dtype,u,i,c,p,n.shape,a);return r.makeTensorInfo(l,n.dtype,b.values)}let m=new NS(i,p,[u,c],n.shape),h=r.runWebGLProgram(m,[d,f],d.dtype),g=ce({inputs:{x:h},backend:r,attrs:{shape:l}});return r.disposeIntermediateTensorInfo(f),r.disposeIntermediateTensorInfo(d),r.disposeIntermediateTensorInfo(h),g}var dU={kernelName:Mv,backendName:"webgl",kernelFunc:yfe};var IS=class{constructor(e,r){this.variableNames=["A","indices"],this.outputShape=r,this.rank=r.length;let n=He(this.rank),o=bfe(e,2);this.userCode=`
      void main() {
        ${n} resRC = getOutputCoords();
        int index = int(getIndices(resRC.x, resRC.z));
        float inBounds = (index >= 0) && (index < ${e[2]}) ? 1.0 : 0.0;
        setOutput(inBounds * getA(${o}));
      }
    `}};function bfe(t,e){let r=["resRC.x","resRC.y","resRC.z","resRC.w"],n=[];for(let o=0;o<t.length;o++)o===2?n.push("index"):n.push(`${r[o]}`);return n.join()}function aA(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,indices:s}=e,{axis:i,batchDims:a}=n,l=w.parseAxisParam(i,o.shape)[0];if(B().get("DEBUG")){let y=r.readSync(s.dataId),b=o.shape[l];for(let v=0;v<y.length;++v){let C=y[v];w.assert(C<=b-1&&C>=0,()=>`GatherV2: the index value ${C} is not in [0, ${b-1}]`)}}let u=T.segment_util.collectGatherOpShapeInfo(o,s,l,a),c=w.sizeFromShape(s.shape),p=[],f=ce({inputs:{x:o},backend:r,attrs:{shape:[u.batchSize,u.outerSize,u.dimSize,u.sliceSize]}}),d=ce({inputs:{x:s},backend:r,attrs:{shape:[u.batchSize,c/u.batchSize]}});p.push(f),p.push(d);let m=[u.batchSize,u.outerSize,c/u.batchSize,u.sliceSize];if(r.shouldExecuteOnCPU([o,s])||o.dtype==="string"){let y=r.bufferSync(d),b=r.bufferSync(f),v=MW(b,y,m);return p.forEach(C=>r.disposeIntermediateTensorInfo(C)),r.makeTensorInfo(u.outputShape,v.dtype,v.values)}let h=new IS(f.shape,m),g=r.runWebGLProgram(h,[f,d],f.dtype);p.push(g);let x=ce({inputs:{x:g},backend:r,attrs:{shape:u.outputShape}});return p.forEach(y=>r.disposeIntermediateTensorInfo(y)),x}var mU={kernelName:Pu,backendName:"webgl",kernelFunc:aA};var vfe="return float(a > b);",wfe=`
  return vec4(greaterThan(a, b));
`,Cfe=ut({opSnippet:vfe,packedOpSnippet:wfe,cpuKernelImpl:zW,dtype:"bool"}),hU={kernelName:_p,backendName:"webgl",kernelFunc:Cfe};var Sfe="return float(a >= b);",kfe=`
  return vec4(greaterThanEqual(a, b));
`,Tfe=ut({opSnippet:Sfe,packedOpSnippet:kfe,dtype:"bool",cpuKernelImpl:BW}),gU={kernelName:Ma,backendName:"webgl",kernelFunc:Tfe};function Nfe(t){let{inputs:e,backend:r}=t,{input:n}=e;return wS(n,!0,r)}var xU={kernelName:rm,backendName:"webgl",kernelFunc:Nfe};var Ife="return float(!isnan(x) && !isinf(x));",Efe=Ne({opSnippet:Ife,dtype:"bool"}),yU={kernelName:za,backendName:"webgl",kernelFunc:Efe};var _fe="return float(isinf(x));",Afe=Ne({opSnippet:_fe,dtype:"bool"}),bU={kernelName:Ba,backendName:"webgl",kernelFunc:Afe};var Dfe="return float(isnan(x));",$fe=Ne({opSnippet:Dfe,dtype:"bool"}),vU={kernelName:Va,backendName:"webgl",kernelFunc:$fe};var Rfe="return float(a < b);",Ofe=`
  return vec4(lessThan(a, b));
`,Ffe=ut({opSnippet:Rfe,packedOpSnippet:Ofe,cpuKernelImpl:VW,dtype:"bool"}),wU={kernelName:Ap,backendName:"webgl",kernelFunc:Ffe};var Pfe="return float(a <= b);",Lfe=`
  return vec4(lessThanEqual(a, b));
`,Mfe=ut({opSnippet:Pfe,packedOpSnippet:Lfe,cpuKernelImpl:WW,dtype:"bool"}),CU={kernelName:Dp,backendName:"webgl",kernelFunc:Mfe};function zfe(t){let{backend:e,attrs:r}=t,{start:n,stop:o,num:s}=r,i=GW(n,o,s);return e.makeTensorInfo([i.length],"float32",i)}var SU={kernelName:zv,backendName:"webgl",kernelFunc:zfe};var Bfe=Ps+`
  return x < 0.0 ? 0./0. : log(x);
`,Vfe=`
  vec4 result = log(x);
  bvec4 isNaN = isnan(x);
  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);
  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);
  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);
  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);
  return result;
`,Wfe=Ne({opSnippet:Bfe,packedOpSnippet:Vfe,cpuKernelImpl:UW}),kU={kernelName:Wa,backendName:"webgl",kernelFunc:Wfe};var Gfe=Ps+`
  return log(1.0 + x);
`,Ufe=Ne({opSnippet:Gfe}),TU={kernelName:Ga,backendName:"webgl",kernelFunc:Ufe};var Hfe="return float(a >= 1.0 && b >= 1.0);",qfe=`
  return vec4(
    vec4(greaterThanEqual(a, vec4(1.0))) *
    vec4(greaterThanEqual(b, vec4(1.0))));
`,jfe=ut({opSnippet:Hfe,packedOpSnippet:qfe,dtype:"bool"}),NU={kernelName:$p,backendName:"webgl",kernelFunc:jfe};var Kfe="return float(!(x >= 1.0));",Xfe=Ne({opSnippet:Kfe}),IU={kernelName:Rp,backendName:"webgl",kernelFunc:Xfe};var Yfe="return float(a >= 1.0 || b >= 1.0);",Qfe=`
  return min(
    vec4(greaterThanEqual(a, vec4(1.0))) +
    vec4(greaterThanEqual(b, vec4(1.0))),
    vec4(1.0));
`,Zfe=ut({opSnippet:Yfe,packedOpSnippet:Qfe,dtype:"bool"}),EU={kernelName:Op,backendName:"webgl",kernelFunc:Zfe};var ES=class{constructor(e,r,n,o,s){this.variableNames=["x"],this.outputShape=[];let i=r,a=e[3]-1;this.outputShape=e;let l,u=`float(${n}) + float(${o}) * sum`;s===.5?l=`inversesqrt(${u})`:s===1?l=`1.0/(${u})`:l=`exp(log(${u}) * float(-${s}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];
        int d = coords[3];
        float x = getX(b, r, c, d);
        float sum = 0.0;
        for (int j = -${i}; j <= ${i}; j++) {
          int idx = d + j;
          if (idx >= 0 && idx <=  ${a}) {
            float z = getX(b, r, c, idx);
            sum += z * z;
          }
        }
        float val = x * ${l};
        setOutput(val);
      }
    `}};var _S=class{constructor(e,r,n,o,s){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;let i=r,a=e[3]-1;this.outputShape=e;let l,u=`float(${n}) + float(${o}) * sum`;s===.5?l=`inversesqrt(${u})`:s===1?l=`1.0/(${u})`:l=`exp(log(${u}) * float(-${s}));`,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords.x;
        int r = coords.y;
        int c = coords.z;
        int d = coords.w;

        bool hasNextCol = d < ${this.outputShape[3]};
        bool hasNextRow = c < ${this.outputShape[2]};

        vec4 sum = vec4(0.);
        vec4 xFragAtOutputCoords = getX(b, r, c, d);

        vec4 xAtOutputCoords = vec4(
          getChannel(xFragAtOutputCoords, vec2(c, d)),
          hasNextCol ?
            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,
          hasNextRow ?
            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,
          (hasNextRow && hasNextCol) ?
            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0
        );

        int firstChannel = d - ${i};
        vec2 cache = vec2(0.);
        if(firstChannel >= 0){
          vec4 firstChannelFrag = getX(b, r, c, firstChannel);
          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));
            if(hasNextRow){
              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));
            }
        }

        ivec2 depth = ivec2(d, d + 1);
        for (int j = - ${i}; j <= ${i}; j++) {
          ivec2 idx = depth + j;
          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));
          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${a}));

          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;
          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;

          if(depthInRange || depthPlusOneInRange){
            vec4 z = vec4(0.);
            vec4 xFragAtCurrentDepth;
            z.xz = cache.xy;
            if(depthPlusOneInRange && hasNextCol){
              xFragAtCurrentDepth = idx.y != d ?
                getX(b, r, c, idx.y) : xFragAtOutputCoords;
              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));
              if(hasNextRow){
                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));
              }
            }
            cache.xy = z.yw;
            sum += z * z;
          }
        }
        vec4 result = xAtOutputCoords * ${l};
        setOutput(result);
      }
    `}};var Jfe=t=>{let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{depthRadius:s,bias:i,alpha:a,beta:l}=n,u=B().getBool("WEBGL_PACK_NORMALIZATION")?new _S(o.shape,s,i,a,l):new ES(o.shape,s,i,a,l);return r.runWebGLProgram(u,[o],o.dtype)},_U={kernelName:Mu,backendName:"webgl",kernelFunc:Jfe};var AS=class{constructor(e,r,n,o,s){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=e,this.depth=e[3],this.depthRadius=r,this.bias=n,this.alpha=o,this.beta=s,this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int r = coords[1];
        int c = coords[2];

        float result = 0.0;
        for (int d = 0; d < ${this.depth}; ++d) {
          int depthBegin = int(max(0.0, float(d - ${r})));
          int depthEnd = int(min(float(${this.depth}),
              float(d + ${r} + 1)));

          const int MIN_DEPTH_BEGIN = 0;
          const int MAX_DEPTH_END = ${this.depth};

          float norm = 0.0;
          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd) {
              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);
            }
            else {
              break;
            }
          }

          norm = float(${o}) * norm + float(${n});

          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){
            if (k < depthBegin){
              continue;
            }
            else if (k >= depthBegin && k < depthEnd){
              float dyi = -2.0 * float(${o})
                * float(${s})
                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)
                / norm;
              if (k == d) {
                dyi += pow(norm, -1.0 * ${s});
              }
              if (k == coords[3]) {
                dyi *= getDy(b, r, c, d);
                result += dyi;
              }
            }
            else {
              break;
            }
          }
      }
      setOutput(result);
      }
    `}};var ede=t=>{let{inputs:e,backend:r,attrs:n}=t,{x:o,y:s,dy:i}=e,{depthRadius:a,bias:l,alpha:u,beta:c}=n,p=new AS(o.shape,a,l,u,c);return r.runWebGLProgram(p,[o,s,i],o.dtype)},AU={kernelName:om,backendName:"webgl",kernelFunc:ede};function DU(t,e,r,n){let o=w.sizeFromShape(e),i=w.sizeFromShape(t.shape)/o,a=ce({inputs:{x:t},attrs:{shape:[i,o]},backend:n}),l=Oo(a,t.dtype,"max",n),u=ce({inputs:{x:l},attrs:{shape:r},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),u}function lA(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{reductionIndices:s,keepDims:i}=n,a=o.shape.length,l=w.parseAxisParam(s,o.shape),u=l,c=T.getAxesPermutation(u,a),p=c!=null,f=r.shouldExecuteOnCPU([o]),d=o;if(p){if(f){let b=r.texData.get(d.dataId).values,v=new Array(a);for(let k=0;k<v.length;k++)v[k]=o.shape[c[k]];let C=$f(b,o.shape,o.dtype,c,v);d=r.makeTensorInfo(v,o.dtype);let S=r.texData.get(d.dataId);S.values=C}else d=Rc(o,c,r);u=T.getInnerMostAxes(u.length,a)}T.assertAxesAreInnerMostDims("max",u,a);let[m,h]=T.computeOutAndReduceShapes(d.shape,u),g=m;i&&(g=T.expandShapeToKeepDim(m,l));let x;if(f){let b=r.texData.get(d.dataId).values,v=HW(b,w.sizeFromShape(h),g,o.dtype);x=r.makeTensorInfo(g,o.dtype);let C=r.texData.get(x.dataId);C.values=v}else x=DU(d,h,g,r);return p&&r.disposeIntermediateTensorInfo(d),x}var $U={kernelName:zu,backendName:"webgl",kernelFunc:lA};var tde=Bh+`
  return max(a, b);
`,rde=`
  vec4 result = vec4(max(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+ta+`
  return result;
`,nde=ut({opSnippet:tde,packedOpSnippet:rde,cpuKernelImpl:qW}),RU={kernelName:Ua,backendName:"webgl",kernelFunc:nde};function ode(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e;Ji(o,"maxPool");let{filterSize:s,strides:i,pad:a,dimRoundingMode:l}=n,u=1;w.assert(T.eitherStridesOrDilationsAreOne(i,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${i} and dilations '${u}'`);let c=T.computePool2DInfo(o.shape,s,i,u,a,l);if(c.filterWidth===1&&c.filterHeight===1&&w.arraysEqual(c.inShape,c.outShape))return lr({inputs:{x:o},backend:r});let p=new hi(c,"max",!1);return r.runWebGLProgram(p,[o],o.dtype)}var OU={kernelName:Bu,backendName:"webgl",kernelFunc:ode};function sde(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{filterSize:s,strides:i,pad:a,dataFormat:l,dimRoundingMode:u}=n,c=[1,1,1],p=T.computePool3DInfo(o.shape,s,i,c,a,u,l),f=new Oc(p,"max",!1);return r.runWebGLProgram(f,[o],o.dtype)}var FU={kernelName:Vu,backendName:"webgl",kernelFunc:sde};var DS=class{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;let r=e.strideHeight,n=e.strideWidth,o=e.dilationHeight,s=e.effectiveFilterHeight,i=e.effectiveFilterWidth,a=s-1-e.padInfo.top,l=i-1-e.padInfo.left,u=s*i-1;this.userCode=`
      const ivec2 pads = ivec2(${a}, ${l});

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];

        ivec2 dyRCCorner = coords.yz - pads;
        int dyRCorner = dyRCCorner.x;
        int dyCCorner = dyRCCorner.y;

        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;
        for (int wR = 0; wR < ${s};
          wR += ${o}) {
          float dyR = float(dyRCorner + wR) / ${r}.0;

          if (dyR < 0.0 || dyR >= ${e.outHeight}.0 || fract(dyR) > 0.0) {
            continue;
          }
          int idyR = int(dyR);

          for (int wC = 0; wC < ${i}; wC++) {
            float dyC = float(dyCCorner + wC) / ${n}.0;

            if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                fract(dyC) > 0.0) {
              continue;
            }
            int idyC = int(dyC);

            float dyValue = getDy(b, idyR, idyC, d);
            int maxPosValue = ${u} - int(getMaxPos(b, idyR, idyC, d));

            // Get the current value, check it against the value from the
            // position matrix.
            int curPosValue = wR * ${i} + wC;
            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

            dotProd += dyValue * mask;
          }
        }
        setOutput(dotProd);
      }
    `}},$S=class{constructor(e){this.variableNames=["dy","maxPos"],this.outputShape=e.inShape;let r=e.strideDepth,n=e.strideHeight,o=e.strideWidth,s=e.dilationDepth,i=e.dilationHeight,a=e.dilationWidth,l=e.effectiveFilterDepth,u=e.effectiveFilterHeight,c=e.effectiveFilterWidth,p=l-1-e.padInfo.front,f=u-1-e.padInfo.top,d=c-1-e.padInfo.left,m=l*u*c-1;this.userCode=`
      const ivec3 pads = ivec3(${p}, ${f}, ${d});

      void main() {
        ivec5 coords = getOutputCoords();
        int batch = coords.x;
        int ch = coords.u;

        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;
        int dyDCorner = dyCorner.x;
        int dyRCorner = dyCorner.y;
        int dyCCorner = dyCorner.z;

        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get
        // dx(xD, xR, xC, ch).
        // ? = to be determined. : = across all values in that axis.
        float dotProd = 0.0;

        for (int wD = 0; wD < ${l};
           wD += ${s}) {
          float dyD = float(dyDCorner + wD) / ${r}.0;

          if (dyD < 0.0 || dyD >= ${e.outDepth}.0 || fract(dyD) > 0.0) {
            continue;
          }
          int idyD = int(dyD);

          for (int wR = 0; wR < ${u};
              wR += ${i}) {
            float dyR = float(dyRCorner + wR) / ${n}.0;

            if (dyR < 0.0 || dyR >= ${e.outHeight}.0 ||
                fract(dyR) > 0.0) {
              continue;
            }
            int idyR = int(dyR);

            for (int wC = 0; wC < ${c};
                wC += ${a}) {
              float dyC = float(dyCCorner + wC) / ${o}.0;

              if (dyC < 0.0 || dyC >= ${e.outWidth}.0 ||
                  fract(dyC) > 0.0) {
                continue;
              }
              int idyC = int(dyC);

              float dyValue = getDy(batch, idyD, idyR, idyC, ch);
              int maxPosValue = ${m} -
                  int(getMaxPos(batch, idyD, idyR, idyC, ch));

              // Get the current value, check it against the value from the
              // position matrix.
              int curPosValue =
                  wD * ${u} * ${c} +
                  wR * ${c} + wC;
              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);

              dotProd += dyValue * mask;
            }
          }
        }
        setOutput(dotProd);
      }
    `}};function ide(t){let{inputs:e,backend:r,attrs:n}=t,{dy:o,input:s}=e,i=s,{filterSize:a,strides:l,pad:u,dimRoundingMode:c}=n,p=[1,1,1],f=T.computePool3DInfo(i.shape,a,l,p,u,c),d=new Oc(f,"max",!0),m=r.runWebGLProgram(d,[i],i.dtype),h=new $S(f),g=r.runWebGLProgram(h,[o,m],i.dtype);return r.disposeIntermediateTensorInfo(m),g}var PU={kernelName:im,backendName:"webgl",kernelFunc:ide};function ade(t){let{inputs:e,backend:r,attrs:n}=t,{dy:o,input:s,output:i}=e,a=s;Ji([s,i],"maxPoolGrad");let{filterSize:l,strides:u,pad:c,dimRoundingMode:p}=n,f=T.computePool2DInfo(a.shape,l,u,1,c,p),d=!0,m=new hi(f,"max",d),h=r.runWebGLProgram(m,[a],a.dtype),g=new DS(f),x=r.runWebGLProgram(g,[o,h],a.dtype);return r.disposeIntermediateTensorInfo(h),x}var LU={kernelName:sm,backendName:"webgl",kernelFunc:ade};function MU(t,e,r,n){let o=new hi(r,"max",!1),s=n.runWebGLProgram(o,[t],"float32");o=new hi(r,"max",!0,!0,e);let i=n.runWebGLProgram(o,[t],"float32");return[s,i]}var zU={kernelName:Bv,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:r})=>{let{x:n}=t,{filterSize:o,strides:s,pad:i,includeBatchInIndex:a}=e,l=r;w.assert(n.shape.length===4,()=>`Error in maxPool: input must be rank 4 but got rank ${n.shape.length}.`);let u=[1,1];w.assert(T.eitherStridesOrDilationsAreOne(s,u),()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${s} and dilations '${u}'`);let c=T.computePool2DInfo(n.shape,o,s,u,i),[p,f]=MU(n,a,c,l);return[p,f]}};function BU(t,e,r,n){let o=w.sizeFromShape(e),i=w.sizeFromShape(t.shape)/o,a=ce({inputs:{x:t},attrs:{shape:[i,o]},backend:n}),l=Oo(a,"float32","mean",n),u=ce({inputs:{x:l},attrs:{shape:r},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(l),u}var VU={kernelName:Wu,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:r})=>{let{x:n}=t,{keepDims:o,axis:s}=e,i=r,a=n.shape.length,l=w.parseAxisParam(s,n.shape),u=l,c=T.getAxesPermutation(u,a),p=c!=null,f=i.shouldExecuteOnCPU([n]),d=[],m=n;if(p){if(f){let v=i.texData.get(m.dataId).values,C=new Array(a);for(let N=0;N<C.length;N++)C[N]=n.shape[c[N]];let S=$f(v,n.shape,n.dtype,c,C);m=i.makeTensorInfo(C,n.dtype);let k=i.texData.get(m.dataId);k.values=S}else m=Rc(n,c,i);d.push(m),u=T.getInnerMostAxes(u.length,a)}T.assertAxesAreInnerMostDims("sum",u,a);let[h,g]=T.computeOutAndReduceShapes(m.shape,u),x=h;o&&(x=T.expandShapeToKeepDim(h,l));let y=BU(m,g,x,i);for(let b of d)i.disposeIntermediateTensorInfo(b);return y}};function lde(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{axis:s,keepDims:i}=n,a=o.shape.length,l=w.parseAxisParam(s,o.shape),u=l,c=T.getAxesPermutation(u,a),p=o;c!=null&&(p=Gt({inputs:{x:o},backend:r,attrs:{perm:c}}),u=T.getInnerMostAxes(u.length,o.shape.length)),T.assertAxesAreInnerMostDims("min",u,a);let[f,d]=T.computeOutAndReduceShapes(p.shape,u),m=w.sizeFromShape(d),h=ce({inputs:{x:p},backend:r,attrs:{shape:[-1,m]}}),g=Oo(h,h.dtype,"min",r),x;if(i){let y=T.expandShapeToKeepDim(f,l);x=ce({inputs:{x:g},backend:r,attrs:{shape:y}})}else x=ce({inputs:{x:g},backend:r,attrs:{shape:f}});return r.disposeIntermediateTensorInfo(h),r.disposeIntermediateTensorInfo(g),c!=null&&r.disposeIntermediateTensorInfo(p),x}var WU={kernelName:Gu,backendName:"webgl",kernelFunc:lde};var ude=Bh+`
  return min(a, b);
`,cde=`
  vec4 result = vec4(min(a, b));
  bvec4 isNaNA = isnan(a);
  bvec4 isNaNB = isnan(b);
  bvec4 isNaN = bvec4(isNaNA.x || isNaNB.x, isNaNA.y || isNaNB.y, isNaNA.z || isNaNB.z, isNaNA.w || isNaNB.w);
  `+ta+`
  return result;
`,pde=ut({opSnippet:ude,packedOpSnippet:cde,cpuKernelImpl:jW}),GU={kernelName:Ha,backendName:"webgl",kernelFunc:pde};var RS=class{constructor(e,r,n){this.variableNames=["x"],this.outputShape=r.map((c,p)=>c[0]+e[p]+c[1]);let o=e.length,s=He(o),i=r.map(c=>c[0]).join(","),a=r.map((c,p)=>c[0]+e[p]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,o),u=n==="reflect"?0:1;if(o===1){this.userCode=`
        int start = ${i};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start) {
            outC = start * 2 - outC - ${u};
          } else if(outC >= end) {
            outC = (end - 1) * 2 - outC + ${u};
          }
          setOutput(getX(outC - start));
        }
      `;return}this.userCode=`
      ${s} start = ${s}(${i});
      ${s} end = ${s}(${a});

      void main() {
        ${s} outC = getOutputCoords();
        for (int i = 0; i < ${o}; i++) {
          if (outC[i] < start[i]) {
            outC[i] = start[i] * 2 - outC[i] - ${u};
          } else if(outC[i] >= end[i]) {
            outC[i] = (end[i] - 1) * 2 - outC[i] + ${u};
          }
        }
        ${s} coords = outC - start;
        setOutput(getX(${l}));
      }
    `}};var OS=class{constructor(e,r,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r.map((m,h)=>m[0]+e[h]+m[1]);let o=e.length,s=He(o),i=r.map(m=>m[0]).join(","),a=r.map((m,h)=>m[0]+e[h]).join(","),l=ar("rc",o),u=ar("source",o),c=`${l[o-1]} < ${this.outputShape[o-1]}`,p=o===1?"source":`vec2(${u.slice(-2).join()})`,f=n==="reflect"?0:1,d="";if(o===1){let m=`
        ${s} source = rc;
        if (source < start) {
          source = start * 2 - source - ${f};
        } else if (source >= end) {
          source = (end - 1) * 2 - source + ${f};
        }
        source -= start;
      `;d=`
        ${s} rc = outputLoc;
        ${m}
        result[0] = getChannel(getX(${u.join()}), ${p});
        ${l[o-1]} += 1;
        if(${c}) {
          ${m}
          result[1] = getChannel(getX(${u.join()}), ${p});
        }
      `}else{let m=`
        ${s} source = rc;
        ${s} lt = ${s}(lessThan(source, start));
        ${s} gte = ${s}(greaterThanEqual(source, end));
        ${s} orig = 1 - (lt + gte);
        source = orig * source +
                lt * (start * 2 - source - ${f}) +
                gte * ((end - 1) * 2 - source + ${f});
        source -= start;
      `;d=`
        ${s} rc = outputLoc;
        ${m}
        result[0] = getChannel(getX(${u.join()}), ${p});
        ${l[o-1]} += 1;
        if(${c}) {
          ${m}
          result[1] = getChannel(getX(${u.join()}), ${p});
        }
        rc = outputLoc;
        ${l[o-2]} += 1;
        if(${l[o-2]} < ${this.outputShape[o-2]}) {
          ${m}
          result[2] = getChannel(getX(${u.join()}), ${p});
          ${l[o-1]} += 1;
          if(${c}) {
            ${m}
            result[3] = getChannel(getX(${u.join()}), ${p});
          }
        }
      `}this.userCode=`
      const ${s} start = ${s}(${i});
      const ${s} end = ${s}(${a});

      void main() {
        ${s} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${d}
        setOutput(result);
      }
    `}};var fde=({inputs:t,backend:e,attrs:r})=>{let{x:n}=t,{paddings:o,mode:s}=r,i=B().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new OS(n.shape,o,s):new RS(n.shape,o,s);return e.runWebGLProgram(i,[n],n.dtype)},UU={kernelName:Uu,backendName:"webgl",kernelFunc:fde};var dde=`if (b == 0.0) return NAN;
  return mod(a, b);`,mde=`
  vec4 result = mod(a, b);
  bvec4 isNaN = equal(b, vec4(0.0));
  `+ta+`
  return result;
`,hde=ut({opSnippet:dde,packedOpSnippet:mde}),HU={kernelName:qa,backendName:"webgl",kernelFunc:hde};var FS=class{constructor(e,r,n){this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[e,n],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];

        float r = random(seed);
        float cdf = 0.0;

        for (int i = 0; i < ${r-1}; i++) {
          cdf += getProbs(batch, i);

          if (r < cdf) {
            setOutput(float(i));
            return;
          }
        }

        // If no other event happened, last event happened.
        setOutput(float(${r-1}));
      }
    `}};var gde=`
if (a == b) {
  return 1.0;
};
return a / b;`,xde=`
  // vec4 one = vec4(equal(a, b));
  // return one + (vec4(1.0) - one) * a / b;
  vec4 result = a / b;
  if(a.x == b.x) {
    result.x = 1.;
  }
  if(a.y == b.y) {
    result.y = 1.;
  }
  if(a.z == b.z) {
    result.z = 1.;
  }
  if(a.w == b.w) {
    result.w = 1.;
  }

  return result;
`,uA=ut({opSnippet:gde,packedOpSnippet:xde,checkOutOfBounds:!0}),qU={kernelName:Da,backendName:"webgl",kernelFunc:uA};var jU="return a - b;",cA=ut({opSnippet:jU,packedOpSnippet:jU,supportsComplex:!0,cpuKernelImpl:dG}),KU={kernelName:ll,backendName:"webgl",kernelFunc:cA};function pA(t){let{inputs:e,backend:r,attrs:n}=t,{logits:o}=e,{dim:s}=n,i=w.parseAxisParam([s],o.shape),a=lA({inputs:{x:o},backend:r,attrs:{reductionIndices:i,keepDims:!1}}),l=T.expandShapeToKeepDim(a.shape,i),u=ce({inputs:{x:a},backend:r,attrs:{shape:l}}),c=cA({inputs:{a:o,b:u},backend:r}),p=sA({inputs:{x:c},backend:r}),f=Of({inputs:{x:p},backend:r,attrs:{axis:i,keepDims:!1}}),d=ce({inputs:{x:f},backend:r,attrs:{shape:l}}),m=uA({inputs:{a:p,b:d},backend:r});return r.disposeIntermediateTensorInfo(a),r.disposeIntermediateTensorInfo(u),r.disposeIntermediateTensorInfo(c),r.disposeIntermediateTensorInfo(p),r.disposeIntermediateTensorInfo(f),r.disposeIntermediateTensorInfo(d),m}var XU={kernelName:ac,backendName:"webgl",kernelFunc:pA};function yde(t){let{inputs:e,backend:r,attrs:n}=t,{logits:o}=e,{numSamples:s,seed:i,normalized:a}=n,l=a?o:pA({inputs:{logits:o},backend:r,attrs:{dim:o.shape.length-1}}),u=l.shape[0],c=l.shape[1],p=new FS(u,c,s),f=[[i]],d=r.runWebGLProgram(p,[l],"int32",f);return a||r.disposeIntermediateTensorInfo(l),d}var YU={kernelName:Vv,backendName:"webgl",kernelFunc:yde};var bde=Rr+`
  return -x;
`,vde=`
  vec4 result = -x;
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`;function wde(t){let{inputs:e,backend:r}=t,{x:n}=e;if(r.shouldExecuteOnCPU([n])){let s=r.texData.get(n.dataId),[i,a]=XW(s.values,n.shape,n.dtype);return r.makeTensorInfo(a,n.dtype,i)}let o;return B().getBool("WEBGL_PACK_UNARY_OPERATIONS")?o=new co(n.shape,vde):o=new cn(n.shape,bde),r.runWebGLProgram(o,[n],n.dtype)}var QU={kernelName:Hu,backendName:"webgl",kernelFunc:wde};var Cde=vn.nonMaxSuppressionV3Impl;function Sde(t){T.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:e,backend:r,attrs:n}=t,{boxes:o,scores:s}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l}=n,u=r.readSync(o.dataId),c=r.readSync(s.dataId),{selectedIndices:p}=Cde(u,c,i,a,l);return r.makeTensorInfo([p.length],"int32",new Int32Array(p))}var ZU={kernelName:am,backendName:"webgl",kernelFunc:Sde};var kde=vn.nonMaxSuppressionV4Impl;function Tde(t){T.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:e,backend:r,attrs:n}=t,{boxes:o,scores:s}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,padToMaxOutputSize:u}=n,c=r.readSync(o.dataId),p=r.readSync(s.dataId),{selectedIndices:f,validOutputs:d}=kde(c,p,i,a,l,u);return[r.makeTensorInfo([f.length],"int32",new Int32Array(f)),r.makeTensorInfo([],"int32",new Int32Array([d]))]}var JU={kernelName:lm,backendName:"webgl",kernelFunc:Tde};var Nde=vn.nonMaxSuppressionV5Impl;function Ide(t){T.warn("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");let{inputs:e,backend:r,attrs:n}=t,{boxes:o,scores:s}=e,{maxOutputSize:i,iouThreshold:a,scoreThreshold:l,softNmsSigma:u}=n,c=r.readSync(o.dataId),p=r.readSync(s.dataId),f=i,d=a,m=l,h=u,{selectedIndices:g,selectedScores:x}=Nde(c,p,f,d,m,h);return[r.makeTensorInfo([g.length],"int32",new Int32Array(g)),r.makeTensorInfo([x.length],"float32",new Float32Array(x))]}var e8={kernelName:um,backendName:"webgl",kernelFunc:Ide};var PS=class{constructor(e,r,n,o){this.variableNames=["indices"],this.outputShape=[e,r],this.userCode=`
      void main() {
        ivec2 coords = getOutputCoords();
        int index = round(getIndices(coords.x));
        setOutput(mix(float(${o}), float(${n}),
                      float(index == coords.y)));
      }
    `}};var Ede=t=>{let{inputs:e,backend:r,attrs:n}=t,{indices:o}=e,{dtype:s,depth:i,onValue:a,offValue:l}=n,u=w.sizeFromShape(o.shape),c=new PS(u,i,a,l),p=ce({inputs:{x:o},backend:r,attrs:{shape:[u]}}),f=r.runWebGLProgram(c,[p],s);r.disposeIntermediateTensorInfo(p);let d=[...o.shape,i],m=ce({inputs:{x:f},backend:r,attrs:{shape:d}});return r.disposeIntermediateTensorInfo(f),m},t8={kernelName:ju,backendName:"webgl",kernelFunc:Ede};function q0(t){let{inputs:e,backend:r}=t,{x:n}=e;if(n.dtype==="complex64"){let o=Ll({inputs:{input:n},backend:r}),s=q0({inputs:{x:o},backend:r}),i=Pf({inputs:{input:n},backend:r}),a=q0({inputs:{x:i},backend:r}),l=po({inputs:{real:s,imag:a},backend:r});return r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(a),l}else return Ml({attrs:{shape:n.shape,dtype:n.dtype,value:n.dtype==="string"?"":0},backend:r})}var r8={kernelName:cc,backendName:"webgl",kernelFunc:q0};function n8(t){let{inputs:e,backend:r}=t,{x:n}=e;if(n.dtype==="string")throw new Error("onesLike is not supported under string dtype");if(n.dtype==="complex64"){let o=Ll({inputs:{input:n},backend:r}),s=n8({inputs:{x:o},backend:r}),i=Pf({inputs:{input:n},backend:r}),a=q0({inputs:{x:i},backend:r}),l=po({inputs:{real:s,imag:a},backend:r});return r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(a),l}else return Ml({attrs:{shape:n.shape,dtype:n.dtype,value:1},backend:r})}var o8={kernelName:qu,backendName:"webgl",kernelFunc:n8};function _de(t){let{inputs:e,backend:r,attrs:n}=t,{axis:o}=n;if(e.length===1)return vS({inputs:{input:e[0]},backend:r,attrs:{dim:o}});let s=e[0].shape,i=e[0].dtype;e.forEach(c=>{w.assertShapesMatch(s,c.shape,"All tensors passed to stack must have matching shapes"),w.assert(i===c.dtype,()=>"All tensors passed to stack must have matching dtypes")});let a=[],l=e.map(c=>{let p=vS({inputs:{input:c},backend:r,attrs:{dim:o}});return a.push(p),p}),u=oA({inputs:l,backend:r,attrs:{axis:o}});return a.forEach(c=>r.disposeIntermediateTensorInfo(c)),u}var s8={kernelName:Ku,backendName:"webgl",kernelFunc:_de};var LS=class{constructor(e,r,n){this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=r.map((u,c)=>u[0]+e[c]+u[1]);let o=e.length,s=He(o),i=r.map(u=>u[0]).join(","),a=r.map((u,c)=>u[0]+e[c]).join(","),l=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,o);if(o===1){this.userCode=`
        int start = ${i};
        int end = ${a};

        void main() {
          int outC = getOutputCoords();
          if (outC < start || outC >= end) {
            setOutput(value);
          } else {
            setOutput(getX(outC - start));
          }
        }
      `;return}this.userCode=`
      ${s} start = ${s}(${i});
      ${s} end = ${s}(${a});

      void main() {
        ${s} outC = getOutputCoords();
        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {
          setOutput(value);
        } else {
          ${s} coords = outC - start;
          setOutput(getX(${l}));
        }
      }
    `}};var MS=class{constructor(e,r,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=r.map((h,g)=>h[0]+e[g]+h[1]);let o=e.length,s=He(o),i=r.map(h=>h[0]).join(","),a=r.map((h,g)=>h[0]+e[g]).join(","),l=ar("rc",o),u=ar("source",o),c=`${l[o-1]} < ${this.outputShape[o-1]}`,p=o===1?"source":`vec2(${u.slice(-2).join()})`,f=[`${s} rc = outputLoc;`,`${l[o-1]} += 1;
       if(${c}) {
      `,o===1?"":`}
       rc = outputLoc;
       ${l[o-2]} += 1;
       if(${l[o-2]} < ${this.outputShape[o-2]}) {`,o===1?"":`  ${l[o-1]} += 1;
         if(${c}) {`],d=o===1?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",m="";for(let h=0,g=o===1?2:4;h<g;h++)m+=`
        ${f[h]}
        if (${d}) {
          result[${h}] = float(value);
        } else {
          ${s} source = rc - start;
          result[${h}] = getChannel(getX(${u.join()}), ${p});
        }
      `;m+=o===1?"} ":"}}",this.userCode=`
      const ${s} start = ${s}(${i});
      const ${s} end = ${s}(${a});

      void main() {
        ${s} outputLoc = getOutputCoords();
        vec4 result = vec4(0.);
        ${m}
        setOutput(result);
      }
    `}};var fA=t=>{let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{paddings:s,constantValue:i}=n;if(w.sizeFromShape(o.shape)===0){let u=s.map((c,p)=>c[0]+o.shape[p]+c[1]);return Ml({backend:r,attrs:{shape:u,value:i,dtype:o.dtype}})}let a=B().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new MS(o.shape,s,i):new LS(o.shape,s,i),l=[[i]];return r.runWebGLProgram(a,[o],o.dtype,l)},i8={kernelName:Xu,backendName:"webgl",kernelFunc:fA};var Ade=`
  if(a < 0.0 && floor(b) < b){
    return NAN;
  }
  if (b == 0.0) {
    return 1.0;
  }
  return (round(mod(b, 2.0)) != 1) ?
      pow(abs(a), b) : sign(a) * pow(abs(a), b);
`,Dde=`
  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.
  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));
  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);
  vec4 result = multiplier * pow(abs(a), b);

  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS
  bvec4 isExpZero = equal(b, vec4(0.0));
  result.r = isExpZero.r ? 1.0 : result.r;
  result.g = isExpZero.g ? 1.0 : result.g;
  result.b = isExpZero.b ? 1.0 : result.b;
  result.a = isExpZero.a ? 1.0 : result.a;

  bvec4 isNaN1 = lessThan(a, vec4(0.0));
  bvec4 isNaN2 = lessThan(floor(b), b);
  bvec4 isNaN = bvec4(isNaN1.x && isNaN2.x, isNaN1.y && isNaN2.y, isNaN1.z && isNaN2.z, isNaN1.w && isNaN2.w);
  `+ta+`
  return result;
`,$de=ut({opSnippet:Ade,packedOpSnippet:Dde}),a8={kernelName:Ka,backendName:"webgl",kernelFunc:$de};function Rde(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{axis:s,keepDims:i}=n,a=o.shape.length,l=[],u=w.parseAxisParam(s,o.shape),c=u,p=T.getAxesPermutation(c,a),f=o;p!=null&&(f=Gt({inputs:{x:o},backend:r,attrs:{perm:p}}),c=T.getInnerMostAxes(c.length,a),l.push(f)),T.assertAxesAreInnerMostDims("prod",c,a);let d;if(r.shouldExecuteOnCPU([f])){let m=r.texData.get(f.dataId).values,{outVals:h,outShape:g,outDtype:x}=QW(f.shape,f.dtype,m,c);d=r.makeTensorInfo(g,x,h)}else{let[m,h]=T.computeOutAndReduceShapes(f.shape,c),g=w.sizeFromShape(h),x=ce({inputs:{x:f},backend:r,attrs:{shape:[-1,g]}}),y=Up(o.dtype),b=Oo(x,y,"prod",r);d=ce({inputs:{x:b},backend:r,attrs:{shape:m}}),l.push(x),l.push(b)}if(i){l.push(d);let m=T.expandShapeToKeepDim(d.shape,u);d=ce({inputs:{x:d},backend:r,attrs:{shape:m}})}return l.forEach(m=>r.disposeIntermediateTensorInfo(m)),d}var l8={kernelName:Qu,backendName:"webgl",kernelFunc:Rde};function Ode(t){let{inputs:e,backend:r,attrs:n}=t,{paramsNestedSplits:o,paramsDenseValues:s,indices:i}=e,{outputRaggedRank:a}=n,l=o.map(x=>r.readSync(x.dataId)),u=o.map(x=>x.shape),c=r.readSync(s.dataId),p=r.readSync(i.dataId),[f,d,m]=ZW(l,u,c,s.shape,s.dtype,p,i.shape,a),h=f.map(x=>r.makeTensorInfo([x.length],"int32",x)),g=r.makeTensorInfo(m,s.dtype,d);return h.concat([g])}var u8={kernelName:Wv,backendName:"webgl",kernelFunc:Ode};function Fde(t){let{inputs:e,backend:r}=t,{starts:n,limits:o,deltas:s}=e,i=r.readSync(n.dataId),a=r.readSync(o.dataId),l=r.readSync(s.dataId),[u,c]=JW(i,n.shape,n.dtype,a,o.shape,l,s.shape),p=r.makeTensorInfo([u.length],"int32",u),f=r.makeTensorInfo([c.length],n.dtype,c);return[p,f]}var c8={kernelName:Gv,backendName:"webgl",kernelFunc:Fde};function Pde(t){let{inputs:e,backend:r,attrs:n}=t,{shape:o,values:s,defaultValue:i,rowPartitionTensors:a}=e,{rowPartitionTypes:l}=n,u=r.readSync(o.dataId),c=r.readSync(s.dataId),p=r.readSync(i.dataId),f=a.map(g=>r.readSync(g.dataId)),d=a.map(g=>g.shape),[m,h]=eG(u,o.shape,c,s.shape,s.dtype,p,i.shape,f,d,l);return r.makeTensorInfo(m,s.dtype,h)}var p8={kernelName:Uv,backendName:"webgl",kernelFunc:Pde};var dA=t=>{let{backend:e,attrs:r}=t,{start:n,stop:o,step:s,dtype:i}=r,a=tG(n,o,s,i);return e.makeTensorInfo([a.length],i,a)},f8={kernelName:cm,backendName:"webgl",kernelFunc:dA};var Lde="return 1.0 / x;",Mde=Ne({opSnippet:Lde}),d8={kernelName:Xa,backendName:"webgl",kernelFunc:Mde};var zde=Rr+`
  return (x < 0.0) ? 0.0 : x;
`,Bde=`
  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Vde=Ne({opSnippet:zde,packedOpSnippet:Bde}),m8={kernelName:Ya,backendName:"webgl",kernelFunc:Vde};var Wde=Rr+`
  return (x < 0.0) ? 0.0 : min(6.0, x);
`,Gde=`
  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,Ude=Ne({opSnippet:Wde,packedOpSnippet:Gde}),h8={kernelName:Qa,backendName:"webgl",kernelFunc:Ude};var zS=class{constructor(e,r,n,o,s){this.variableNames=["A"],this.outputShape=[];let[i,a,l,u]=e;this.outputShape=[i,r,n,u];let c=[o&&r>1?a-1:a,o&&n>1?l-1:l],p=[o&&r>1?r-1:r,o&&n>1?n-1:n],f;s?f="(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":f="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${c[0]/p[0]},
          ${c[1]/p[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${f};

        // Compute the four integer indices.
        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));
        ivec2 sourceCeilRC = ivec2(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);
        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);
        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);
        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);

        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);

        float top = topLeft + (topRight - topLeft) * fracRC.y;
        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;
        float newValue = top + (bottom - top) * fracRC.x;

        setOutput(newValue);
      }
    `}};var BS=class{constructor(e,r,n,o,s){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];let[i,a,l,u]=e;this.outputShape=[i,r,n,u];let c=[o&&r>1?a-1:a,o&&n>1?l-1:l],p=[o&&r>1?r-1:r,o&&n>1?n-1:n],f;s?f="(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":f="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${c[0]/p[0]},
          ${c[1]/p[1]},
          ${c[1]/p[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${f};

        // Compute the four integer indices.
        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));
        ivec3 sourceCeilRC = ivec3(
          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${n-1};

        // In parallel, construct four corners for all four components in
        // packed 2x2 cell.
        vec4 topLeft = vec4(
          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 bottomLeft = vec4(
          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);

        vec4 topRight = vec4(
          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec4 bottomRight = vec4(
          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),
          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);

        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);

        vec4 top = mix(topLeft, topRight, fracRC.yyzz);
        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);
        vec4 newValue = mix(top, bottom, fracRC.x);

        setOutput(newValue);
      }
    `}};function Hde(t){let{inputs:e,backend:r,attrs:n}=t,{images:o}=e,{alignCorners:s,halfPixelCenters:i,size:a}=n,[l,u]=a,c=B().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new BS(o.shape,l,u,s,i):new zS(o.shape,l,u,s,i);return r.runWebGLProgram(c,[o],"float32")}var g8={kernelName:ec,backendName:"webgl",kernelFunc:Hde};var VS=class{constructor(e,r,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=r;let[,o,s]=r,[,i,a]=e,l=[n&&i>1?o-1:o,n&&a>1?s-1:s],u=[n&&i>1?i-1:i,n&&a>1?a-1:a],c=l[0]/u[0],p=l[1]/u[1],f=1/c,d=1/p,m=Math.ceil(f)*2+2,h=Math.ceil(d)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${c});
        const float widthScale = float(${p});

        const float invHeightScale = float(${f});
        const float invWidthScale = float(${d});

        const int winHeight = int(${m});
        const int winWidth = int(${h});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(startRLerp - float(winHeight / 2));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(startCLerp - float(winWidth / 2));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${i}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float dxR = float(dyR) * heightScale;
            int topDxRIndex = int(floor(dxR));
            int bottomDxRIndex = int(min(ceil(dxR), ${o-1}.0));
            float dxRLerp = dxR - float(topDxRIndex);
            float inverseDxRLerp = 1.0 - dxRLerp;

            float dxC = float(dyC) * widthScale;
            int leftDxCIndex = int(floor(dxC));
            int rightDxCIndex = int(min(ceil(dxC), ${s-1}.0));
            float dxCLerp = dxC - float(leftDxCIndex);
            float inverseDxCLerp = 1.0 - dxCLerp;

            if (r == topDxRIndex && c == leftDxCIndex) {
              // topLeft
              accumulator +=
                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;
            }

            if (r == topDxRIndex && c == rightDxCIndex) {
              // topRight
              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;
            }

            if (r == bottomDxRIndex && c == leftDxCIndex) {
              // bottomLeft
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;
            }

            if (r == bottomDxRIndex && c == rightDxCIndex) {
              // bottomRight
              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}};function qde(t){let{inputs:e,backend:r,attrs:n}=t,{images:o,dy:s}=e,{alignCorners:i}=n,a=new VS(s.shape,o.shape,i);return r.runWebGLProgram(a,[s],s.dtype)}var x8={kernelName:dm,backendName:"webgl",kernelFunc:qde};var WS=class{constructor(e,r,n,o,s){this.variableNames=["A"],this.outputShape=[];let[i,a,l,u]=e;this.outputShape=[i,r,n,u];let c=[o&&r>1?a-1:a,o&&n>1?l-1:l],p=[o&&r>1?r-1:r,o&&n>1?n-1:n],f=o?"0.5":"0.0",d;s?d="max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":d="vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec2 effectiveInputOverOutputRatioRC = vec2(
          ${c[0]/p[0]},
          ${c[1]/p[1]});
      const vec2 inputShapeRC = vec2(${a}.0, ${l}.0);

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        ivec2 yRC = coords.yz;

        // Fractional source index.
        vec2 sourceFracIndexRC = ${d};

        // Compute the coordinators of nearest neighbor point.
        ivec2 sourceNearestRC = ivec2(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${f})));
        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);

        setOutput(newValue);
      }
    `}};var GS=class{constructor(e,r,n,o,s){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];let[i,a,l,u]=e;this.outputShape=[i,r,n,u];let c=[o&&r>1?a-1:a,o&&n>1?l-1:l],p=[o&&r>1?r-1:r,o&&n>1?n-1:n],f=o?"0.5":"0.0",d;s?d="max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":d="vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`
      const vec3 effectiveInputOverOutputRatioRC = vec3(
          ${c[0]/p[0]},
          ${c[1]/p[1]},
          ${c[1]/p[1]});
      const vec3 inputShapeRC = vec3(${a}.0, ${l}.0,
                                     ${l}.0);

      float getAValue(int b, int r, int c, int d) {
        return getChannel(getA(b, r, c, d), vec2(c, d));
      }

      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        // Calculate values for next column in yRC.z.
        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);

        // Fractional source index.
        vec3 sourceFracIndexRC = ${d};

        // Compute the coordinators of nearest neighbor point.
        ivec3 sourceNearestRC = ivec3(
          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${f})));

        // Should we calculate next column and row elements in 2x2 packed cell.
        bool hasNextCol = d < ${u-1};
        bool hasNextRow = coords.z < ${n-1};

        vec4 newValue = vec4(
          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),
          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)
                     : 0.0,
          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)
                     : 0.0,
          (hasNextRow && hasNextCol) ?
            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);

        setOutput(newValue);
      }
    `}};function jde(t){let{inputs:e,backend:r,attrs:n}=t,{images:o}=e,{alignCorners:s,halfPixelCenters:i,size:a}=n,[l,u]=a,c=B().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new GS(o.shape,l,u,s,i):new WS(o.shape,l,u,s,i);return r.runWebGLProgram(c,[o],o.dtype)}var y8={kernelName:Ju,backendName:"webgl",kernelFunc:jde};var US=class{constructor(e,r,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=r;let[,o,s]=r,[,i,a]=e,l=[n&&i>1?o-1:o,n&&a>1?s-1:s],u=[n&&i>1?i-1:i,n&&a>1?a-1:a],c=l[0]/u[0],p=l[1]/u[1],f=1/c,d=1/p,m=Math.ceil(f)*2+2,h=Math.ceil(d)*2+2;this.userCode=`
      void main() {
        ivec4 coords = getOutputCoords();
        int b = coords[0];
        int d = coords[3];
        int r = coords[1];
        int c = coords[2];

        float accumulator = 0.0;

        const float heightScale = float(${c});
        const float widthScale = float(${p});

        const float invHeightScale = float(${f});
        const float invWidthScale = float(${d});

        const int winHeight = int(${m});
        const int winWidth = int(${h});

        // Compute bounds for where in dy we will look
        float startRLerp = floor(float(r) * invHeightScale);
        int startDyR = int(floor(startRLerp - float(winHeight / 2)));

        float startCLerp = floor(float(c) * invWidthScale);
        int startDyC = int(floor(startCLerp - float(winWidth / 2)));

        // Loop over dy
        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {
          int dyR = dyROffset + startDyR;

          // Guard against the window exceeding the bounds of dy
          if (dyR < 0 || dyR >= ${i}) {
            continue;
          }

          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {
            int dyC = dyCOffset + startDyC;

            // Guard against the window exceeding the bounds of dy
            if (dyC < 0 || dyC >= ${a}) {
              continue;
            }

            float sourceFracRow =
              float(${l[0]}) *
                (float(dyR) / float(${u[0]}));

            float sourceFracCol =
                float(${l[1]}) *
                  (float(dyC) / float(${u[1]}));

            int sourceNearestRow = int(min(
                float(int(${o}) - 1),
                ${n} ? float(round(sourceFracRow)) :
                                  float(floor(sourceFracRow))));

            int sourceNearestCol = int(min(
                float(int(${s}) - 1),
                ${n} ? float(round(sourceFracCol)) :
                                  float(floor(sourceFracCol))));

            if (r == sourceNearestRow && c == sourceNearestCol) {
              accumulator += getDy(b, dyR, dyC, d);
            }
          }
        }
        // End loop over dy

        setOutput(accumulator);
      }
    `}};function Kde(t){let{inputs:e,backend:r,attrs:n}=t,{images:o,dy:s}=e,{alignCorners:i}=n,a=new US(s.shape,o.shape,i);return r.runWebGLProgram(a,[s],s.dtype)}var b8={kernelName:fm,backendName:"webgl",kernelFunc:Kde};var HS=class{constructor(e,r){this.variableNames=["x"];let n=e.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);if(this.outputShape=e,n===1){this.userCode=`
        void main() {
          int coord = getOutputCoords();
          setOutput(getX(${e[0]} - coord - 1));
        }
      `;return}let o=a=>r.indexOf(a)!==-1&&e[a]!==1?`${e[a]} - coords[${a}] - 1`:`coords[${a}]`,s=e.map((a,l)=>o(l)).join(","),i=He(n);this.userCode=`
      void main() {
        ${i} coords = getOutputCoords();
        setOutput(getX(${s}));
      }
    `}};var qS=class{constructor(e,r){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;let n=e.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);this.outputShape=e;let o=ar("rc",n),s=`${o[n-1]} + 1 < ${this.outputShape[n-1]}`,i=`${o[n-2]} + 1 < ${this.outputShape[n-2]}`,a=He(n);n===1?this.userCode=`
        void main(){
          int rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = getChannel(getX(${e[0]} - rc - 1),
            ${e[0]} - rc - 1);
          if(${s}){
              result.g = getChannel(getX(${e[0]} - (rc  + 1) - 1),
                ${e[0]} - (rc  + 1) - 1);
          }
          setOutput(result);
        }
      `:this.userCode=`
        void main() {
          ${a} rc = getOutputCoords();
          vec4 result = vec4(0.);
          result.r = ${l(o.slice())};
          if(${s}){
            result.g = ${u(o.slice())};
          }
          if(${i}) {
            result.b = ${c(o.slice())};
            if(${s}) {
              result.a = ${p(o.slice())};
            }
          }
          setOutput(result);
        }
    `;function l(m){return f(m)}function u(m){return m[n-1]="("+m[n-1]+" + 1)",f(m)}function c(m){return m[n-2]="("+m[n-2]+" + 1)",f(m)}function p(m){return m[n-1]="("+m[n-1]+" + 1)",m[n-2]="("+m[n-2]+" + 1)",f(m)}function f(m){let h=e.map((y,b)=>d(b,m)),g=h.join(","),x=h.slice(-2).join(",");return`getChannel(getX(${g}), vec2(${x}))`}function d(m,h){return r.indexOf(m)!==-1&&e[m]!==1?`${e[m]} - ${h[m]} - 1`:`${h[m]}`}}};function Xde(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{dims:s}=n,i=o.shape.length,a=w.parseAxisParam(s,o.shape);if(i===0)return lr({inputs:{x:o},backend:r});let l=B().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new qS(o.shape,a):new HS(o.shape,a);return r.runWebGLProgram(l,[o],o.dtype)}var v8={kernelName:tc,backendName:"webgl",kernelFunc:Xde};var jS=class{constructor(e,r){this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];let n=e[1],o=e[2];this.outputShape=e;let s="";typeof r=="number"?s=`float outputValue = ${r.toFixed(2)};`:s=`
        vec3 fill = vec3(${r.join(",")});
        float outputValue = fill[coords[3]];`,this.userCode=`
        void main() {
          ivec4 coords = getOutputCoords();
          int x = coords[2];
          int y = coords[1];
          float coordXFloat = (float(x) - params[0]) * params[3] -
            (float(y) - params[1]) * params[2];
          float coordYFloat = (float(x) - params[0]) * params[2] +
            (float(y) - params[1]) * params[3];
          int coordX = int(round(coordXFloat + params[0]));
          int coordY = int(round(coordYFloat + params[1]));
          ${s}
          if(coordX >= 0 && coordX < ${o} && coordY >= 0 && coordY < ${n}) {
            outputValue = getImage(coords[0], coordY, coordX, coords[3]);
          }
          setOutput(outputValue);
        }
    `}};var w8={kernelName:bm,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:r})=>{let{image:n}=t,{radians:o,fillValue:s,center:i}=e,a=r,l=new jS(n.shape,s),[u,c]=T.getImageCenter(i,n.shape[1],n.shape[2]),p=[[u,c,Math.sin(o),Math.cos(o)]];return a.runWebGLProgram(l,[n],n.dtype,p)}};var Yde=`
  // OpenGL ES does not support round function.
  // The algorithm is based on banker's rounding.
  float base = floor(x);
  if ((x - base) < 0.5) {
    return floor(x);
  } else if ((x - base) > 0.5) {
    return ceil(x);
  } else {
    if (mod(base, 2.0) == 0.0) {
      return base;
    } else {
      return base + 1.0;
    }
  }
`,Qde=Ne({opSnippet:Yde}),C8={kernelName:Za,backendName:"webgl",kernelFunc:Qde};var Zde="return inversesqrt(x);",Jde=Ne({opSnippet:Zde,cpuKernelImpl:rG}),S8={kernelName:Ja,backendName:"webgl",kernelFunc:Jde};var Kh=class{constructor(e,r,n,o,s,i,a=!0){this.variableNames=["updates","indices","defaultValue"],this.outputShape=i;let l=He(s.length),u=He(i.length),c="";n===1?c="i":n===2&&(c="i, j");let p=`getIndices(${c})`,f="";o===1?f="i":o===2&&(f="i, coords[1]");let d=`getUpdates(${f})`,m=r>1?"strides[j]":"strides";this.userCode=`
        ${l} strides = ${l}(${s});

        void main() {
          ${u} coords = getOutputCoords();
          float sum = 0.0;
          bool found = false;
          for (int i = 0; i < ${e}; i++) {
            int flattenedIndex = 0;
            for (int j = 0; j < ${r}; j++) {
              int index = round(${p});
              flattenedIndex += index * ${m};
            }
            if (flattenedIndex == coords[0]) {
              sum += ${d};
              found = true;
            }
          }
          setOutput(mix(getDefaultValue(), sum, float(found)));
        }
      `}};function eme(t){let{inputs:e,backend:r,attrs:n}=t,{indices:o,updates:s}=e,{shape:i}=n,{sliceRank:a,numUpdates:l,sliceSize:u,strides:c,outputSize:p}=T.calculateShapes(s,o,i),f=[p/u,u];if(p===0)return r.makeTensorInfo(i,o.dtype);let d=ce({inputs:{x:o},backend:r,attrs:{shape:[l,a]}}),m=ce({inputs:{x:s},backend:r,attrs:{shape:[l,u]}}),h=r.makeTensorInfo([],"float32",new Float32Array([0])),g=new Kh(l,a,d.shape.length,m.shape.length,c,f),x=r.runWebGLProgram(g,[m,d,h],m.dtype),y=ce({inputs:{x},backend:r,attrs:{shape:i}});return r.disposeIntermediateTensorInfo(d),r.disposeIntermediateTensorInfo(m),r.disposeIntermediateTensorInfo(x),r.disposeIntermediateTensorInfo(h),y}var k8={kernelName:Hv,backendName:"webgl",kernelFunc:eme};var KS=class{constructor(e,r,n,o){this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[e,n];let s="while (left < right) {",i=`for (int i = 0; i < ${Math.ceil(Math.log2(r+1))}; ++i) { if (left >= right) break;`,a=B().getNumber("WEBGL_VERSION")===2?s:i,l=o==="left"?"<":"<=";this.userCode=`
       int findBound(int batch, float value) {
         int left = 0;
         int right = numInputs;
         int mid;
         ${a}
           mid = (left + right) / 2;
           if (getSortedSequence(batch, mid) ${l} value) {
             left = mid + 1;
           } else {
             right = mid;
           }
         }
         return right;
       }

       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int valueIndex = coords[1];

         float value = getValues(batch, valueIndex);

         setOutput(float(findBound(batch, value)));
       }
     `}};function tme(t){let{inputs:e,backend:r,attrs:n}=t,{sortedSequence:o,values:s}=e,{side:i}=n,a=new KS(o.shape[0],o.shape[1],s.shape[1],i),l=[[o.shape[1]]];return r.runWebGLProgram(a,[o,s],"int32",l)}var T8={kernelName:qv,backendName:"webgl",kernelFunc:tme};var XS=class{constructor(e,r,n){this.variableNames=["c","a","b"],this.outputShape=r;let o,s;if(n>4)throw Error(`Where for rank ${n} is not yet supported`);if(n===1)s="resRC",o="resRC";else{let a=["resRC.x","resRC.y","resRC.z","resRC.w"],l=[],u=[];for(let c=0;c<r.length;c++)u.push(`${a[c]}`),c<e&&l.push(`${a[c]}`);o=l.join(),s=u.join()}let i=He(n);this.userCode=`
      void main() {
        ${i} resRC = getOutputCoords();
        float cVal = getC(${o});
        if (cVal >= 1.0) {
          setOutput(getA(${s}));
        } else {
          setOutput(getB(${s}));
        }
      }
    `}};function rme(t){let{inputs:e,backend:r}=t,{condition:n,t:o,e:s}=e,i=new XS(n.shape.length,o.shape,o.shape.length);return r.runWebGLProgram(i,[n,o,s],wr(o.dtype,s.dtype))}var N8={kernelName:rc,backendName:"webgl",kernelFunc:rme};var nme=`
  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.
  // see: https://arxiv.org/abs/1706.02515
  float scaleAlpha = ${T.SELU_SCALEALPHA};
  float scale = ${T.SELU_SCALE};
  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);
`,ome=Ne({opSnippet:nme}),I8={kernelName:el,backendName:"webgl",kernelFunc:ome};var sme=Ps+`
  return 1.0 / (1.0 + exp(-1.0 * x));
`,ime=`
  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));
  bvec4 isNaN = isnan(x);

  result.r = isNaN.r ? x.r : result.r;
  result.g = isNaN.g ? x.g : result.g;
  result.b = isNaN.b ? x.b : result.b;
  result.a = isNaN.a ? x.a : result.a;

  return result;
`,ame=Ne({opSnippet:sme,packedOpSnippet:ime,cpuKernelImpl:oG}),E8={kernelName:ol,backendName:"webgl",kernelFunc:ame};var lme=`
  if (isnan(x)) { return 0.0; }
  return sign(x);
`,ume=Ne({opSnippet:lme}),_8={kernelName:nl,backendName:"webgl",kernelFunc:ume};var cme=Ps+`
  return sin(x);
`,pme=Ne({opSnippet:cme}),A8={kernelName:tl,backendName:"webgl",kernelFunc:pme};var fme=`
  float e2x = exp(x);
  return (e2x - 1.0 / e2x) / 2.0;
`,dme=Ne({opSnippet:fme}),D8={kernelName:rl,backendName:"webgl",kernelFunc:dme};var mme=`
  float epsilon = 1.1920928955078125e-7;
  float threshold = log(epsilon) + 2.0;

  bool too_large = x > -threshold;
  bool too_small = x < threshold;

  float result;
  float exp_x = exp(x);

  if (too_large){
    result = x;
  }
  else if (too_small){
    result = exp_x;
  }
  else{
    result = log(exp_x + 1.0);
  }
  return result;
`,hme=Ne({opSnippet:mme}),$8={kernelName:sl,backendName:"webgl",kernelFunc:hme};var gme=t=>{let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{blockShape:s,paddings:i}=n;w.assert(o.shape.length<=4,()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet");let a=s.reduce((x,y)=>x*y),l=[[0,0]];l.push(...i);for(let x=1+s.length;x<o.shape.length;++x)l.push([0,0]);let u=[],c=fA({inputs:{x:o},backend:r,attrs:{paddings:l,constantValue:0}}),p=T.getReshaped(c.shape,s,a,!1),f=T.getPermuted(p.length,s.length,!1),d=T.getReshapedPermuted(c.shape,s,a,!1),m=ce({inputs:{x:c},backend:r,attrs:{shape:p}}),h=Gt({inputs:{x:m},backend:r,attrs:{perm:f}}),g=ce({inputs:{x:h},backend:r,attrs:{shape:d}});return u.push(c),u.push(m),u.push(h),u.forEach(x=>r.disposeIntermediateTensorInfo(x)),g},R8={kernelName:sc,backendName:"webgl",kernelFunc:gme};function xme(t){let{inputs:e,backend:r}=t,{indices:n,values:o,denseShape:s,defaultValue:i}=e;if(s.shape.length!==1)throw new Error(`Dense shape must be a vector, saw:
         ${s.shape}`);if(n.shape.length!==2)throw new Error(`Indices must be a matrix, saw:
         ${n.shape}`);if(o.shape.length!==1)throw new Error(`Values must be a vector, saw:
         ${o.shape}`);if(i.shape.length!==0)throw new Error(`Default value must be a scalar, saw:
        ${i.shape}`);let a=r.readSync(n.dataId),l=r.readSync(o.dataId),u=r.readSync(s.dataId),c=r.readSync(i.dataId)[0],[p,f,d,m,h]=iG(a,n.shape,n.dtype,l,o.dtype,u,c);return[r.makeTensorInfo(f,n.dtype,p),r.makeTensorInfo([f[0]],o.dtype,d),r.makeTensorInfo([m.length],"bool",new Uint8Array(m.map(g=>Number(g)))),r.makeTensorInfo([h.length],n.dtype,new Int32Array(h))]}var O8={kernelName:jv,backendName:"webgl",kernelFunc:xme};function yme(t){let{inputs:e,backend:r}=t,{inputIndices:n,inputShape:o,newShape:s}=e;if(n.shape.length!==2)throw new Error(`Input indices should be a matrix but received shape ${n.shape}`);if(o.shape.length!==1)throw new Error(`Input shape should be a vector but received shape ${o.shape}`);if(s.shape.length!==1)throw new Error(`Target shape should be a vector but received shape ${s.shape}`);let i=Array.from(r.readSync(o.dataId)),a=r.readSync(n.dataId),l=Array.from(r.readSync(s.dataId)),[u,c,p]=aG(a,n.shape,n.dtype,i,l);return[r.makeTensorInfo(c,n.dtype,u),r.makeTensorInfo([p.length],s.dtype,new Int32Array(p))]}var F8={kernelName:Kv,backendName:"webgl",kernelFunc:yme};function bme(t){let{inputs:e,backend:r}=t,{data:n,indices:o,segmentIds:s}=e;if(n.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.shape.length!==1)throw new Error(`Indices should be a vector but received shape
              ${o.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
              ${s.shape}`);let i=r.readSync(n.dataId),a=r.readSync(o.dataId),l=r.readSync(s.dataId),[u,c]=$C(i,n.shape,n.dtype,a,l,!0);return r.makeTensorInfo(c,n.dtype,u)}var P8={kernelName:Xv,backendName:"webgl",kernelFunc:bme};function vme(t){let{inputs:e,backend:r}=t,{data:n,indices:o,segmentIds:s}=e;if(n.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(o.shape.length!==1)throw new Error(`Indices should be a vector but received shape
             ${o.shape}`);if(s.shape.length!==1)throw new Error(`Segment ids should be a vector but received shape
             ${s.shape}`);let i=r.readSync(n.dataId),a=r.readSync(o.dataId),l=r.readSync(s.dataId),[u,c]=$C(i,n.shape,n.dtype,a,l);return r.makeTensorInfo(c,n.dtype,u)}var L8={kernelName:Yv,backendName:"webgl",kernelFunc:vme};function wme(t){let{inputs:e,backend:r,attrs:n}=t,{sparseIndices:o,sparseValues:s,defaultValue:i}=e,{outputShape:a}=n,{sliceRank:l,numUpdates:u,sliceSize:c,strides:p,outputSize:f}=T.calculateShapes(s,o,a),d=!1;if(s.dtype==="string"){let x=r.bufferSync(o),y=r.bufferSync(s),b=w.decodeString(r.readSync(i.dataId)[0]),v=nG(x,y,a,f,c,u,l,p,b,d);return r.makeTensorInfo(a,v.dtype,v.values)}let m=new Kh(u,l,o.shape.length,s.shape.length,p,[f,1],d),h=r.runWebGLProgram(m,[s,o,i],s.dtype),g=ce({inputs:{x:h},backend:r,attrs:{shape:a}});return r.disposeIntermediateTensorInfo(h),g}var M8={kernelName:Qv,backendName:"webgl",kernelFunc:wme};function Cme(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{numOrSizeSplits:s,axis:i}=n,a=w.parseAxisParam(i,o.shape)[0],l=T.prepareSplitSize(o,s,a),u=o.shape.length,c=new Array(u).fill(0),p=o.shape.slice();return l.map(f=>{let d=[...p];d[a]=f;let m=gi({inputs:{x:o},backend:r,attrs:{begin:c,size:d}});return c[a]+=f,m})}var z8={kernelName:ic,backendName:"webgl",kernelFunc:Cme};var B8="return sqrt(x);",Sme=Ne({opSnippet:B8,packedOpSnippet:B8,cpuKernelImpl:lG}),V8={kernelName:il,backendName:"webgl",kernelFunc:Sme};var kme="return x * x;",Tme=Ne({opSnippet:kme}),W8={kernelName:mm,backendName:"webgl",kernelFunc:Tme};var G8="return (a - b) * (a - b);",Nme=ut({opSnippet:G8,packedOpSnippet:G8}),U8={kernelName:al,backendName:"webgl",kernelFunc:Nme};function Ime({inputs:t,attrs:e,backend:r}){let{x:n}=t,o=Rr+`
    return x > 0.0 ? 1.0 : float(${e.alpha});
  `,s=new cn(n.shape,o);return r.runWebGLProgram(s,[n],n.dtype)}var H8={kernelName:pl,backendName:"webgl",kernelFunc:Ime};var YS=class{constructor(e,r,n){this.variableNames=["x"],this.outputShape=n;let o=n.length,s=He(n.length),i=He(n.length),a="";if(o===1)a="coords * strides + begin";else{let l=0;a=n.map((u,c)=>(l++,n.length===1?`coords * strides[${c}] + begin[${c}]`:`coords[${l-1}] * strides[${c}] + begin[${c}]`)).join(",")}this.userCode=`
      ${s} begin = ${s}(${e});
      ${s} strides = ${s}(${r});

      void main() {
        ${i} coords = getOutputCoords();
        setOutput(getX(${a}));
      }
    `}};function Eme(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{begin:s,end:i,strides:a,beginMask:l,endMask:u,ellipsisMask:c,newAxisMask:p,shrinkAxisMask:f}=n,{finalShapeSparse:d,finalShape:m,isIdentity:h,sliceDim0:g,isSimpleSlice:x,begin:y,end:b,strides:v}=Ur.sliceInfo(o.shape,s,i,a,l,u,c,p,f),C;if(h)C=ce({inputs:{x:o},backend:r,attrs:{shape:m}});else if(g||x){w.assert(o.shape.length>=1,()=>`Input must have rank at least 1, got: ${o.shape.length}`);let k=Ur.computeOutShape(y,b,v),N=gi({inputs:{x:o},backend:r,attrs:{begin:y,size:k}});C=ce({inputs:{x:N},backend:r,attrs:{shape:m}}),r.disposeIntermediateTensorInfo(N)}else if(r.shouldExecuteOnCPU([o])){let N=r.readSync(o.dataId),D=Ee(o.shape,o.dtype,N),$=uG(d,D,v,y);C=r.makeTensorInfo(m,o.dtype,$.values)}else{let N=new YS(y,v,d);C=r.runWebGLProgram(N,[o],o.dtype)}let S=ce({inputs:{x:C},backend:r,attrs:{shape:m}});return r.disposeIntermediateTensorInfo(C),S}var q8={kernelName:hm,backendName:"webgl",kernelFunc:Eme};function _me(t){let{inputs:e,backend:r,attrs:n}=t,{separator:o,nGramWidths:s,leftPad:i,rightPad:a,padWidth:l,preserveShortSequences:u}=n,{data:c,dataSplits:p}=e,f=r.readSync(c.dataId),d=r.readSync(p.dataId),[m,h]=cG(f,d,o,s,i,a,l,u);return[r.makeTensorInfo([m.length],"string",m),r.makeTensorInfo(p.shape,"int32",h)]}var j8={kernelName:Zv,backendName:"webgl",kernelFunc:_me};function Ame(t){let{inputs:e,backend:r,attrs:n}=t,{skipEmpty:o}=n,{input:s,delimiter:i}=e;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(s.shape.length!==1)throw new Error(`Input must be a vector, got shape: ${s.shape}`);if(i.shape.length!==0)throw new Error(`Delimiter must be a scalar, got shape: ${i.shape}`);let a=r.readSync(s.dataId),l=r.readSync(i.dataId)[0],[u,c,p]=pG(a,l,o),f=c.length;return[r.makeTensorInfo([f,2],"int32",u),r.makeTensorInfo([f],"string",c),r.makeTensorInfo([2],"int32",new Int32Array(p))]}var K8={kernelName:Jv,backendName:"webgl",kernelFunc:Ame};function Dme(t){let{inputs:e,backend:r,attrs:n}=t,{numBuckets:o}=n,{input:s}=e;if(s.dtype!=="string")throw new Error("Input must be of datatype string");if(o<=0)throw new Error("Number of buckets must be at least 1");let i=r.readSync(s.dataId),a=fG(i,o);return r.makeTensorInfo(s.shape,"int32",a)}var X8={kernelName:e1,backendName:"webgl",kernelFunc:Dme};var $me="return tan(x);",Rme=Ne({opSnippet:$me}),Y8={kernelName:ul,backendName:"webgl",kernelFunc:Rme};var Ome=`
  float e2x = exp(-2.0 * abs(x));
  return sign(x) * (1.0 - e2x) / (1.0 + e2x);
`,Fme=Ne({opSnippet:Ome}),Q8={kernelName:cl,backendName:"webgl",kernelFunc:Fme};var QS=class{constructor(e,r){this.variableNames=["A"];let n=new Array(e.length);for(let i=0;i<n.length;i++)n[i]=e[i]*r[i];this.outputShape=n,this.rank=n.length;let o=He(this.rank),s=Pme(e);this.userCode=`
      void main() {
        ${o} resRC = getOutputCoords();
        setOutput(getA(${s}));
      }
    `}};function Pme(t){let e=t.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(e===1)return`imod(resRC, ${t[0]})`;let r=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],n=[];for(let o=0;o<t.length;o++)n.push(`imod(${r[o]}, ${t[o]})`);return n.join()}function mA(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{reps:s}=n;if(o.dtype==="string"||o.shape.length>5){let l=r.readSync(o.dataId),u=o.dtype==="string"?l.map(f=>w.decodeString(f)):l,c=Ee(o.shape,o.dtype,u),p=mG(c,s);return r.makeTensorInfo(p.shape,p.dtype,p.values)}let i=new QS(o.shape,s);return r.runWebGLProgram(i,[o],o.dtype)}var Z8={kernelName:Fi,backendName:"webgl",kernelFunc:mA};var ZS=class{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=e,this.userCode=`
       void main() {
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // We compare elements pair-wise within a group of size 2 * inc.
         // The comparing rule for each group alternates between ascending
         // and descending. Within each group, we compare each pair at
         // positions i and i+inc. To decide whether an element at position i
         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than
         // inc, it is in the first half of the group, we denote it as x0,
         // otherwise we denote it as x1.
         // For example, as shown in the Bitonic top K paper referenced above,
         // Figure5(a) shows that element[1] is in the
         // second half of the group when group size is 2, but it is in the
         // first half of the group when group size is 4.

         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;
         int i = isFirstInPair ? elemIdx : elemIdx - inc;

         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));
         float x0 = i0 < n ? getX(batch, i0) : negativeInf;
         float x1 = i1 < n ? getX(batch, i1) : negativeInf;

         // Denotes which direction indices are in (ascending or descending).
         bool reverse = imod(elemIdx, 2 * dir) >= dir;
         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);
         if (reverse == isGreater) { // Elements in opposite order of direction
           int iTemp = i0;
           i0 = i1;
           i1 = iTemp;
         }
         if (isFirstInPair) {
            setOutput(float(i0));
         } else {
            setOutput(float(i1));
         }
       }
     `}},JS=class{constructor(e){this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=e,this.userCode=`
    void main() {
         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...
         ivec2 coords = getOutputCoords();
         int batch = coords[0];
         int elemIdx = coords[1];

         // The output size is half of the previous size.
         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),
         // we only need to output the indices at positions |, the indices at
         // positions _ can be thrown away, see Figure5(b) After Phase 2
         // (Merge phase) in the Bitonic Top K paper referenced above.
         // For example, the paper shows we only need to output the orange bars.
         // The output sequence should look like this | | | | | | | |.
         // Because the sequence is halved, to map the output index back
         // to the previous sequence to find the corresponding value,
         // we need to double the index. When we double the index,
         // we basically interpolate a position, so 2i looks like
         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position
         // of each 2k positions by - elemIdx % k. E.g. for output at
         // index 4,5,6,7, we want to get the corresponding element at
         // original index 8,9,10,11, for output at index 8,9,10,11,
         // we want to get the corresponding element at original index
         // 16,17,18,19, so on and so forth.

         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));
         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));
         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));

         float x0 = getX(batch, i0);
         float x1 = i1 < n ? getX(batch, i1) : x0;

         setOutput(x0 >= x1 ? float(i0) : float(i1));
       }
     `}};function Mf(t,e){e!==null&&t.disposeIntermediateTensorInfo(e)}function J8(t){let e=1;for(;e<t;)e*=2;return e}function Lme(t){let{inputs:e,backend:r,attrs:n}=t,{x:o}=e,{k:s,sorted:i}=n,a=B().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),l=B().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),u=o.shape,c=u[u.length-1];if(r.shouldExecuteOnCPU([o])||c<a||s>l){let $=r.readSync(o.dataId),[O,V]=hG($,u,o.dtype,s,i);return[r.makeTensorInfo(O.shape,O.dtype,O.values),r.makeTensorInfo(V.shape,V.dtype,V.values)]}if(s===0)return u[u.length-1]=0,[r.makeTensorInfo(u,o.dtype,[]),r.makeTensorInfo(u,"int32",[])];if(c===1)return[o,Ml({attrs:{shape:u,dtype:"int32",value:0},backend:r})];let p=r.texData.get(o.dataId),f=p!==null&&p.isPacked,d=f?r.unpackTensor(o):o,h=w.sizeFromShape(u)/c,g=ce({inputs:{x:d},attrs:{shape:[h,c]},backend:r});f&&Mf(r,d);let x=J8(s),y=J8(c),b=null,v=()=>b===null?[g,g]:[g,b],C=($,O,V)=>{let K=v(),X=new ZS(V),H=[[c],[b===null?1:0],[Number.NEGATIVE_INFINITY],[$],[O]],Y=b;b=r.runWebGLProgram(X,K,"int32",H),Mf(r,Y)};for(let $=1;$<x;$*=2){let O=$*2;for(let V=$;V>=1;V/=2)C(O,V,[h,y])}for(let $=y;$>x;$/=2){let O=v(),V=new JS([h,$/2]),X=[[c],[b===null?1:0],[x]],W=b;b=r.runWebGLProgram(V,O,"int32",X),Mf(r,W);let H=x/2,Y=H*2;for(let Z=H;Z>=1;Z/=2)C(Y,Z,b.shape)}let S=b;b=gi({inputs:{x:b},backend:r,attrs:{begin:0,size:[h,s]}}),Mf(r,S);let k=aA({inputs:{x:g,indices:b},backend:r,attrs:{axis:1,batchDims:1}});Mf(r,g);let N=u.slice(0,-1);N.push(s),S=b,b=ce({inputs:{x:b},attrs:{shape:N},backend:r}),Mf(r,S);let D=k;return k=ce({inputs:{x:k},attrs:{shape:N},backend:r}),Mf(r,D),[k,b]}var eH={kernelName:gm,backendName:"webgl",kernelFunc:Lme};var ek=class{constructor(e,r,n,o,s,i){this.variableNames=["Image","Transforms"],this.outputShape=i;let a=n==="nearest"?1:2,l;switch(o){case"constant":l=1;break;case"reflect":l=2;break;case"wrap":l=3;break;case"nearest":l=4;break;default:l=1;break}this.userCode=`
            float mapCoord(float outCoord, float len) {
              float inCoord = outCoord;
              if(${l} == 2) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    if (inCoord < sz2) {
                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +
                      inCoord;
                    }
                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz2 = 2.0 * len;
                    inCoord -= sz2 * float(int(float(inCoord / sz2)));
                    if (inCoord >= len) {
                      inCoord = sz2 - inCoord - 1.0;
                    }
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 3) {
                if (inCoord < 0.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);
                  }
                } else if (inCoord > len - 1.0) {
                  if (len <= 1.0) {
                    inCoord = 0.0;
                  } else {
                    float sz = len - 1.0;
                    inCoord -= len * float(int(float(inCoord / sz)));
                  }
                }
                return clamp(inCoord, 0.0, len - 1.0);
              } else if (${l} == 4) {
                return clamp(outCoord, 0.0, len - 1.0);
              } else {
                return outCoord;
              }
            }

            float readWithFillValue(int batch, int coordY, int coordX,
              int channel) {
              float outputValue;
              if (0 <= coordY && coordY < ${e} && 0 <= coordX && coordX < ${r}) {
                  outputValue = getImage(batch, coordY, coordX, channel);
              } else {
                outputValue = float(${s});
              }
              return outputValue;
            }

            void main() {
              ivec4 coords = getOutputCoords();
              float outputValue;
              int batch = coords[0];
              int x = coords[2];
              int y = coords[1];
              int channel = coords[3];
              float xf = float(x);
              float yf = float(y);
              float a1 = getTransforms(batch, 0);
              float a2 = getTransforms(batch, 1);
              float a3 = getTransforms(batch, 2);
              float b1 = getTransforms(batch, 3);
              float b2 = getTransforms(batch, 4);
              float b3 = getTransforms(batch, 5);
              float c1 = getTransforms(batch, 6);
              float c2 = getTransforms(batch, 7);
              float projection = c1 * xf + c2 * yf + 1.0;
              if (projection == 0.0) {
                outputValue = float(${s});
              } else {
                float inX = (a1 * xf + a2 * yf + a3) / projection;
                float inY = (b1 * xf + b2 * yf + b3) / projection;
                float mapX = mapCoord(inX, float(${r}));
                float mapY = mapCoord(inY, float(${e}));

                if (${a} == 1) {
                  int coordY = int(round(mapY));
                  int coordX = int(round(mapX));
                  outputValue = readWithFillValue(batch, coordY, coordX,
                    channel);
                } else {
                  float yFloor = floor(mapY);
                  float xFloor = floor(mapX);
                  float yCeil = yFloor + 1.0;
                  float xCeil = xFloor + 1.0;
                  float valueYFloor = (xCeil - mapX) *
                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);
                  float valueYCeil = (xCeil - mapX) *
                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +
                  (mapX - xFloor) *
                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);
                  outputValue = (yCeil - mapY) * valueYFloor +
                  (mapY - yFloor) * valueYCeil;
                }
              }
              setOutput(outputValue);
            }
        `}};function Mme(t){let{inputs:e,backend:r,attrs:n}=t,{image:o,transforms:s}=e,{interpolation:i,fillMode:a,fillValue:l,outputShape:u}=n,[c,p,f,d]=o.shape,[m,h]=u??[p,f],g=[c,m,h,d],x=new ek(p,f,i,a,l,g);return r.runWebGLProgram(x,[o,s],"float32")}var tH={kernelName:xm,backendName:"webgl",kernelFunc:Mme};function zme(t){let{inputs:e,attrs:r,backend:n}=t,{axis:o}=r,{x:s}=e;Ji(s,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");let i=n.readSync(s.dataId),{outputValues:a,outputShape:l,indices:u}=gG(i,o,s.shape,s.dtype);return[n.makeTensorInfo(l,s.dtype,a),n.makeTensorInfo([u.length],"int32",u)]}var rH={kernelName:ym,backendName:"webgl",kernelFunc:zme};function Bme(t){let{inputs:e,backend:r,attrs:n}=t,{value:o}=e,{axis:s}=n;s<0&&(s+=o.shape.length);let i=o,a=i.shape.length,l=o.shape[s],u=new Array(a-1),c=0;for(let h=0;h<a;h++)h!==s&&(u[c++]=i.shape[h]);let p=[],f=new Array(a).fill(0),d=i.shape.slice();d[s]=1;let m=new Array(l);for(let h=0;h<m.length;h++){f[s]=h;let g=gi({inputs:{x:i},backend:r,attrs:{begin:f,size:d}}),x=ce({inputs:{x:g},backend:r,attrs:{shape:u}});m[h]=x,p.push(g)}return p.forEach(h=>r.disposeIntermediateTensorInfo(h)),m}var nH={kernelName:lc,backendName:"webgl",kernelFunc:Bme};var tk=class{constructor(e,r){this.variableNames=["x","segmentIds"];let n=e.windowSize,o=e.batchSize,s=e.inSize,i=e.numSegments,a=i*Math.ceil(s/n);this.outputShape=[o,a];let l="0.0",u="sumValue",c=Math.floor(n/4)*4,p=n%4,f=`
        sumValue += dot(values, segFilter);
    `,d="";s%n>0&&(d=`
        if (inIdx < 0 || inIdx >= ${s}) {
          return initializationValue;
        }
      `);let m="";s%n>0&&(m=`
        if (inIdx < 0 || inIdx >= ${s}) {
          return -1.0;
        }
      `),this.userCode=`
      const float initializationValue = ${l};

      float getValue(int batch, int inIdx) {
        ${d}
        return getX(batch, inIdx);
      }

      float getSegmentIdAtIndex(int inIdx) {
        ${m}
        return getSegmentIds(inIdx);
      }

      void main() {
        ivec2 coords = getOutputCoords();
        int batch = coords[0];
        int outIdx = coords[1];
        int inOffset = int(floor(float(outIdx) / float(
          ${i})) * float(${n}));
        int currentSeg = int(mod(float(outIdx), float(${i})));

        float sumValue = 0.0;

        for (int i = 0; i < ${c}; i += 4) {
          int inIdx = inOffset + i;
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            getValue(batch, inIdx + 3)
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0
          );

          ${f}
        }

        int inIdx = inOffset + ${c};
        if (${p===1}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            initializationValue,
            initializationValue,
            initializationValue
          );

          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            0,
            0,
            0
          );

          ${f}
        } else if (${p===2}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            initializationValue,
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
              0,
              0
          );

          ${f}
        } else if (${p===3}) {
          vec4 values = vec4(
            getValue(batch, inIdx),
            getValue(batch, inIdx + 1),
            getValue(batch, inIdx + 2),
            initializationValue
          );

          vec4 segFilter = vec4(
            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,
            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,
            0
          );

          ${f}
        }
        setOutput(${u});
      }
    `}};function Vme(t){let{inputs:e,backend:r,attrs:n}=t,{x:o,segmentIds:s}=e,{numSegments:i}=n,a=o.shape.length,l=[],u=0,c=T.getAxesPermutation([u],a),p=o;c!=null&&(p=Gt({inputs:{x:o},backend:r,attrs:{perm:c}}),l.push(p),u=T.getInnerMostAxes(1,a)[0]);let f=T.segment_util.computeOutShape(p.shape,u,i),d=w.sizeFromShape([p.shape[u]]),m=ce({inputs:{x:p},backend:r,attrs:{shape:[-1,d]}});l.push(m);let h=Up(o.dtype),g=(v,C,S,k,N)=>{let D=v.shape[0],$=v.shape[1],O=T.segment_util.segOpComputeOptimalWindowSize($,N),V={windowSize:O,inSize:$,batchSize:D,numSegments:N},K=new tk(V,C),X=r.compileAndRun(K,[v,S],k);if(l.push(X),X.shape[1]===N)return X;let W=dA({backend:r,attrs:{start:0,stop:N,step:1,dtype:"float32"}}),H=mA({inputs:{x:W},backend:r,attrs:{reps:[$/O]}});return l.push(W),l.push(H),g(X,C,H,k,N)},x=g(m,"unsortedSegmentSum",s,h,i),y=ce({inputs:{x},backend:r,attrs:{shape:f}}),b=y;if(c!=null){l.push(y);let v=T.getUndoAxesPermutation(c);b=Gt({inputs:{x:b},backend:r,attrs:{perm:v}})}return l.forEach(v=>r.disposeIntermediateTensorInfo(v)),b}var oH={kernelName:uc,backendName:"webgl",kernelFunc:Vme};var Wme=[GG,HG,qG,jG,XG,YG,QG,ZG,t6,r6,n6,o6,s6,i6,a6,l6,u6,c6,p6,f6,d6,h6,g6,x6,w6,S6,k6,RG,N6,E6,_6,A6,D6,$6,R6,O6,F6,P6,L6,B6,V6,W6,G6,U6,H6,q6,j6,K6,X6,Y6,Q6,Z6,J6,eU,tU,nU,oU,sU,iU,lU,uU,cU,pU,fU,dU,mU,hU,gU,$G,xU,I6,yU,bU,vU,OG,wU,CU,SU,kU,TU,NU,IU,EU,_U,AU,$U,RU,OU,FU,PU,LU,zU,VU,WU,GU,UU,HU,YU,LG,QU,ZU,JU,e8,y6,t8,o8,s8,i8,a8,FG,l8,u8,c8,p8,f8,b6,qU,d8,m8,h8,zG,g8,x8,y8,b8,v8,w8,C8,S8,k8,T8,N8,I8,E8,_8,A8,D8,m6,XU,$8,R8,O8,F8,P8,L8,M8,z8,V8,W8,U8,H8,q8,j8,K8,X8,KU,VG,Y8,Q8,Z8,eH,tH,WG,rH,nH,oH,r8];for(let t of Wme)r1(t);var _t=rt(pt()),Bn=rt(Bf());var cp=rt(pt()),Bg=rt(Bf());var IR=rt(pt());var eu=rt(pt());var xge={grad:.9,turn:360,rad:360/(2*Math.PI)},Bl=function(t){return typeof t=="string"?t.length>0:typeof t=="number"},kn=function(t,e,r){return e===void 0&&(e=0),r===void 0&&(r=Math.pow(10,e)),Math.round(r*t)/r+0},Ms=function(t,e,r){return e===void 0&&(e=0),r===void 0&&(r=1),t>r?r:t>e?t:e},u7=function(t){return(t=isFinite(t)?t%360:0)>0?t:t+360},r7=function(t){return{r:Ms(t.r,0,255),g:Ms(t.g,0,255),b:Ms(t.b,0,255),a:Ms(t.a)}},zA=function(t){return{r:kn(t.r),g:kn(t.g),b:kn(t.b),a:kn(t.a,3)}},yge=/^#([0-9a-f]{3,8})$/i,Sk=function(t){var e=t.toString(16);return e.length<2?"0"+e:e},c7=function(t){var e=t.r,r=t.g,n=t.b,o=t.a,s=Math.max(e,r,n),i=s-Math.min(e,r,n),a=i?s===e?(r-n)/i:s===r?2+(n-e)/i:4+(e-r)/i:0;return{h:60*(a<0?a+6:a),s:s?i/s*100:0,v:s/255*100,a:o}},p7=function(t){var e=t.h,r=t.s,n=t.v,o=t.a;e=e/360*6,r/=100,n/=100;var s=Math.floor(e),i=n*(1-r),a=n*(1-(e-s)*r),l=n*(1-(1-e+s)*r),u=s%6;return{r:255*[n,a,i,i,l,n][u],g:255*[l,n,n,a,i,i][u],b:255*[i,i,l,n,n,a][u],a:o}},n7=function(t){return{h:u7(t.h),s:Ms(t.s,0,100),l:Ms(t.l,0,100),a:Ms(t.a)}},o7=function(t){return{h:kn(t.h),s:kn(t.s),l:kn(t.l),a:kn(t.a,3)}},s7=function(t){return p7((r=(e=t).s,{h:e.h,s:(r*=((n=e.l)<50?n:100-n)/100)>0?2*r/(n+r)*100:0,v:n+r,a:e.a}));var e,r,n},Y0=function(t){return{h:(e=c7(t)).h,s:(o=(200-(r=e.s))*(n=e.v)/100)>0&&o<200?r*n/100/(o<=100?o:200-o)*100:0,l:o/2,a:e.a};var e,r,n,o},bge=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,vge=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,wge=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Cge=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,WA={string:[[function(t){var e=yge.exec(t);return e?(t=e[1]).length<=4?{r:parseInt(t[0]+t[0],16),g:parseInt(t[1]+t[1],16),b:parseInt(t[2]+t[2],16),a:t.length===4?kn(parseInt(t[3]+t[3],16)/255,2):1}:t.length===6||t.length===8?{r:parseInt(t.substr(0,2),16),g:parseInt(t.substr(2,2),16),b:parseInt(t.substr(4,2),16),a:t.length===8?kn(parseInt(t.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(t){var e=wge.exec(t)||Cge.exec(t);return e?e[2]!==e[4]||e[4]!==e[6]?null:r7({r:Number(e[1])/(e[2]?100/255:1),g:Number(e[3])/(e[4]?100/255:1),b:Number(e[5])/(e[6]?100/255:1),a:e[7]===void 0?1:Number(e[7])/(e[8]?100:1)}):null},"rgb"],[function(t){var e=bge.exec(t)||vge.exec(t);if(!e)return null;var r,n,o=n7({h:(r=e[1],n=e[2],n===void 0&&(n="deg"),Number(r)*(xge[n]||1)),s:Number(e[3]),l:Number(e[4]),a:e[5]===void 0?1:Number(e[5])/(e[6]?100:1)});return s7(o)},"hsl"]],object:[[function(t){var e=t.r,r=t.g,n=t.b,o=t.a,s=o===void 0?1:o;return Bl(e)&&Bl(r)&&Bl(n)?r7({r:Number(e),g:Number(r),b:Number(n),a:Number(s)}):null},"rgb"],[function(t){var e=t.h,r=t.s,n=t.l,o=t.a,s=o===void 0?1:o;if(!Bl(e)||!Bl(r)||!Bl(n))return null;var i=n7({h:Number(e),s:Number(r),l:Number(n),a:Number(s)});return s7(i)},"hsl"],[function(t){var e=t.h,r=t.s,n=t.v,o=t.a,s=o===void 0?1:o;if(!Bl(e)||!Bl(r)||!Bl(n))return null;var i=function(a){return{h:u7(a.h),s:Ms(a.s,0,100),v:Ms(a.v,0,100),a:Ms(a.a)}}({h:Number(e),s:Number(r),v:Number(n),a:Number(s)});return p7(i)},"hsv"]]},i7=function(t,e){for(var r=0;r<e.length;r++){var n=e[r][0](t);if(n)return[n,e[r][1]]}return[null,void 0]},Sge=function(t){return typeof t=="string"?i7(t.trim(),WA.string):typeof t=="object"&&t!==null?i7(t,WA.object):[null,void 0]};var BA=function(t,e){var r=Y0(t);return{h:r.h,s:Ms(r.s+100*e,0,100),l:r.l,a:r.a}},VA=function(t){return(299*t.r+587*t.g+114*t.b)/1e3/255},a7=function(t,e){var r=Y0(t);return{h:r.h,s:r.s,l:Ms(r.l+100*e,0,100),a:r.a}},GA=function(){function t(e){this.parsed=Sge(e)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return t.prototype.isValid=function(){return this.parsed!==null},t.prototype.brightness=function(){return kn(VA(this.rgba),2)},t.prototype.isDark=function(){return VA(this.rgba)<.5},t.prototype.isLight=function(){return VA(this.rgba)>=.5},t.prototype.toHex=function(){return e=zA(this.rgba),r=e.r,n=e.g,o=e.b,i=(s=e.a)<1?Sk(kn(255*s)):"","#"+Sk(r)+Sk(n)+Sk(o)+i;var e,r,n,o,s,i},t.prototype.toRgb=function(){return zA(this.rgba)},t.prototype.toRgbString=function(){return e=zA(this.rgba),r=e.r,n=e.g,o=e.b,(s=e.a)<1?"rgba("+r+", "+n+", "+o+", "+s+")":"rgb("+r+", "+n+", "+o+")";var e,r,n,o,s},t.prototype.toHsl=function(){return o7(Y0(this.rgba))},t.prototype.toHslString=function(){return e=o7(Y0(this.rgba)),r=e.h,n=e.s,o=e.l,(s=e.a)<1?"hsla("+r+", "+n+"%, "+o+"%, "+s+")":"hsl("+r+", "+n+"%, "+o+"%)";var e,r,n,o,s},t.prototype.toHsv=function(){return e=c7(this.rgba),{h:kn(e.h),s:kn(e.s),v:kn(e.v),a:kn(e.a,3)};var e},t.prototype.invert=function(){return ur({r:255-(e=this.rgba).r,g:255-e.g,b:255-e.b,a:e.a});var e},t.prototype.saturate=function(e){return e===void 0&&(e=.1),ur(BA(this.rgba,e))},t.prototype.desaturate=function(e){return e===void 0&&(e=.1),ur(BA(this.rgba,-e))},t.prototype.grayscale=function(){return ur(BA(this.rgba,-1))},t.prototype.lighten=function(e){return e===void 0&&(e=.1),ur(a7(this.rgba,e))},t.prototype.darken=function(e){return e===void 0&&(e=.1),ur(a7(this.rgba,-e))},t.prototype.rotate=function(e){return e===void 0&&(e=15),this.hue(this.hue()+e)},t.prototype.alpha=function(e){return typeof e=="number"?ur({r:(r=this.rgba).r,g:r.g,b:r.b,a:e}):kn(this.rgba.a,3);var r},t.prototype.hue=function(e){var r=Y0(this.rgba);return typeof e=="number"?ur({h:e,s:r.s,l:r.l,a:r.a}):kn(r.h)},t.prototype.isEqual=function(e){return this.toHex()===ur(e).toHex()},t}(),ur=function(t){return t instanceof GA?t:new GA(t)},l7=[],kk=function(t){t.forEach(function(e){l7.indexOf(e)<0&&(e(GA,WA),l7.push(e))})};function UA(t,e){if(t==null)return{};var r={},n=Object.keys(t),o,s;for(s=0;s<n.length;s++)o=n[s],!(e.indexOf(o)>=0)&&(r[o]=t[o]);return r}function xi(){return xi=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}return t},xi.apply(this,arguments)}var Ut=rt(pt());var Tk=rt(pt());var HA=function(e){return e.reduce(function(r,n){var o=n[0],s=n[1];return r[o]=s,r},{})},qA=typeof window<"u"&&window.document&&window.document.createElement?Tk.useLayoutEffect:Tk.useEffect;var lp=rt(pt()),tK=rt(iR());var Fr="top",dn="bottom",Yr="right",Br="left",HT="auto",ip=[Fr,dn,Yr,Br],Ql="start",rd="end",$j="clippingParents",qT="viewport",Rg="popper",Rj="reference",aR=ip.reduce(function(t,e){return t.concat([e+"-"+Ql,e+"-"+rd])},[]),jT=[].concat(ip,[HT]).reduce(function(t,e){return t.concat([e,e+"-"+Ql,e+"-"+rd])},[]),Tye="beforeRead",Nye="read",Iye="afterRead",Eye="beforeMain",_ye="main",Aye="afterMain",Dye="beforeWrite",$ye="write",Rye="afterWrite",Oj=[Tye,Nye,Iye,Eye,_ye,Aye,Dye,$ye,Rye];function In(t){return t?(t.nodeName||"").toLowerCase():null}function Er(t){if(t==null)return window;if(t.toString()!=="[object Window]"){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function qs(t){var e=Er(t).Element;return t instanceof e||t instanceof Element}function mn(t){var e=Er(t).HTMLElement;return t instanceof e||t instanceof HTMLElement}function Og(t){if(typeof ShadowRoot>"u")return!1;var e=Er(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}function Oye(t){var e=t.state;Object.keys(e.elements).forEach(function(r){var n=e.styles[r]||{},o=e.attributes[r]||{},s=e.elements[r];!mn(s)||!In(s)||(Object.assign(s.style,n),Object.keys(o).forEach(function(i){var a=o[i];a===!1?s.removeAttribute(i):s.setAttribute(i,a===!0?"":a)}))})}function Fye(t){var e=t.state,r={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,r.popper),e.styles=r,e.elements.arrow&&Object.assign(e.elements.arrow.style,r.arrow),function(){Object.keys(e.elements).forEach(function(n){var o=e.elements[n],s=e.attributes[n]||{},i=Object.keys(e.styles.hasOwnProperty(n)?e.styles[n]:r[n]),a=i.reduce(function(l,u){return l[u]="",l},{});!mn(o)||!In(o)||(Object.assign(o.style,a),Object.keys(s).forEach(function(l){o.removeAttribute(l)}))})}}var Fj={name:"applyStyles",enabled:!0,phase:"write",fn:Oye,effect:Fye,requires:["computeStyles"]};function En(t){return t.split("-")[0]}var Ni=Math.max,nd=Math.min,Zl=Math.round;function Fg(){var t=navigator.userAgentData;return t!=null&&t.brands?t.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function Wb(){return!/^((?!chrome|android).)*safari/i.test(Fg())}function js(t,e,r){e===void 0&&(e=!1),r===void 0&&(r=!1);var n=t.getBoundingClientRect(),o=1,s=1;e&&mn(t)&&(o=t.offsetWidth>0&&Zl(n.width)/t.offsetWidth||1,s=t.offsetHeight>0&&Zl(n.height)/t.offsetHeight||1);var i=qs(t)?Er(t):window,a=i.visualViewport,l=!Wb()&&r,u=(n.left+(l&&a?a.offsetLeft:0))/o,c=(n.top+(l&&a?a.offsetTop:0))/s,p=n.width/o,f=n.height/s;return{width:p,height:f,top:c,right:u+p,bottom:c+f,left:u,x:u,y:c}}function od(t){var e=js(t),r=t.offsetWidth,n=t.offsetHeight;return Math.abs(e.width-r)<=1&&(r=e.width),Math.abs(e.height-n)<=1&&(n=e.height),{x:t.offsetLeft,y:t.offsetTop,width:r,height:n}}function Gb(t,e){var r=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(r&&Og(r)){var n=e;do{if(n&&t.isSameNode(n))return!0;n=n.parentNode||n.host}while(n)}return!1}function xo(t){return Er(t).getComputedStyle(t)}function lR(t){return["table","td","th"].indexOf(In(t))>=0}function zn(t){return((qs(t)?t.ownerDocument:t.document)||window.document).documentElement}function Jl(t){return In(t)==="html"?t:t.assignedSlot||t.parentNode||(Og(t)?t.host:null)||zn(t)}function Pj(t){return!mn(t)||xo(t).position==="fixed"?null:t.offsetParent}function Pye(t){var e=/firefox/i.test(Fg()),r=/Trident/i.test(Fg());if(r&&mn(t)){var n=xo(t);if(n.position==="fixed")return null}var o=Jl(t);for(Og(o)&&(o=o.host);mn(o)&&["html","body"].indexOf(In(o))<0;){var s=xo(o);if(s.transform!=="none"||s.perspective!=="none"||s.contain==="paint"||["transform","perspective"].indexOf(s.willChange)!==-1||e&&s.willChange==="filter"||e&&s.filter&&s.filter!=="none")return o;o=o.parentNode}return null}function Ii(t){for(var e=Er(t),r=Pj(t);r&&lR(r)&&xo(r).position==="static";)r=Pj(r);return r&&(In(r)==="html"||In(r)==="body"&&xo(r).position==="static")?e:r||Pye(t)||e}function sd(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function id(t,e,r){return Ni(t,nd(e,r))}function Lj(t,e,r){var n=id(t,e,r);return n>r?r:n}function Ub(){return{top:0,right:0,bottom:0,left:0}}function Hb(t){return Object.assign({},Ub(),t)}function qb(t,e){return e.reduce(function(r,n){return r[n]=t,r},{})}var Lye=function(e,r){return e=typeof e=="function"?e(Object.assign({},r.rects,{placement:r.placement})):e,Hb(typeof e!="number"?e:qb(e,ip))};function Mye(t){var e,r=t.state,n=t.name,o=t.options,s=r.elements.arrow,i=r.modifiersData.popperOffsets,a=En(r.placement),l=sd(a),u=[Br,Yr].indexOf(a)>=0,c=u?"height":"width";if(!(!s||!i)){var p=Lye(o.padding,r),f=od(s),d=l==="y"?Fr:Br,m=l==="y"?dn:Yr,h=r.rects.reference[c]+r.rects.reference[l]-i[l]-r.rects.popper[c],g=i[l]-r.rects.reference[l],x=Ii(s),y=x?l==="y"?x.clientHeight||0:x.clientWidth||0:0,b=h/2-g/2,v=p[d],C=y-f[c]-p[m],S=y/2-f[c]/2+b,k=id(v,S,C),N=l;r.modifiersData[n]=(e={},e[N]=k,e.centerOffset=k-S,e)}}function zye(t){var e=t.state,r=t.options,n=r.element,o=n===void 0?"[data-popper-arrow]":n;o!=null&&(typeof o=="string"&&(o=e.elements.popper.querySelector(o),!o)||!Gb(e.elements.popper,o)||(e.elements.arrow=o))}var Mj={name:"arrow",enabled:!0,phase:"main",fn:Mye,effect:zye,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Ks(t){return t.split("-")[1]}var Bye={top:"auto",right:"auto",bottom:"auto",left:"auto"};function Vye(t){var e=t.x,r=t.y,n=window,o=n.devicePixelRatio||1;return{x:Zl(e*o)/o||0,y:Zl(r*o)/o||0}}function zj(t){var e,r=t.popper,n=t.popperRect,o=t.placement,s=t.variation,i=t.offsets,a=t.position,l=t.gpuAcceleration,u=t.adaptive,c=t.roundOffsets,p=t.isFixed,f=i.x,d=f===void 0?0:f,m=i.y,h=m===void 0?0:m,g=typeof c=="function"?c({x:d,y:h}):{x:d,y:h};d=g.x,h=g.y;var x=i.hasOwnProperty("x"),y=i.hasOwnProperty("y"),b=Br,v=Fr,C=window;if(u){var S=Ii(r),k="clientHeight",N="clientWidth";if(S===Er(r)&&(S=zn(r),xo(S).position!=="static"&&a==="absolute"&&(k="scrollHeight",N="scrollWidth")),S=S,o===Fr||(o===Br||o===Yr)&&s===rd){v=dn;var D=p&&S===C&&C.visualViewport?C.visualViewport.height:S[k];h-=D-n.height,h*=l?1:-1}if(o===Br||(o===Fr||o===dn)&&s===rd){b=Yr;var $=p&&S===C&&C.visualViewport?C.visualViewport.width:S[N];d-=$-n.width,d*=l?1:-1}}var O=Object.assign({position:a},u&&Bye),V=c===!0?Vye({x:d,y:h}):{x:d,y:h};if(d=V.x,h=V.y,l){var K;return Object.assign({},O,(K={},K[v]=y?"0":"",K[b]=x?"0":"",K.transform=(C.devicePixelRatio||1)<=1?"translate("+d+"px, "+h+"px)":"translate3d("+d+"px, "+h+"px, 0)",K))}return Object.assign({},O,(e={},e[v]=y?h+"px":"",e[b]=x?d+"px":"",e.transform="",e))}function Wye(t){var e=t.state,r=t.options,n=r.gpuAcceleration,o=n===void 0?!0:n,s=r.adaptive,i=s===void 0?!0:s,a=r.roundOffsets,l=a===void 0?!0:a;if(!1)var u;var c={placement:En(e.placement),variation:Ks(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:o,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,zj(Object.assign({},c,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:i,roundOffsets:l})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,zj(Object.assign({},c,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}var Bj={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:Wye,data:{}};var KT={passive:!0};function Gye(t){var e=t.state,r=t.instance,n=t.options,o=n.scroll,s=o===void 0?!0:o,i=n.resize,a=i===void 0?!0:i,l=Er(e.elements.popper),u=[].concat(e.scrollParents.reference,e.scrollParents.popper);return s&&u.forEach(function(c){c.addEventListener("scroll",r.update,KT)}),a&&l.addEventListener("resize",r.update,KT),function(){s&&u.forEach(function(c){c.removeEventListener("scroll",r.update,KT)}),a&&l.removeEventListener("resize",r.update,KT)}}var Vj={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:Gye,data:{}};var Uye={left:"right",right:"left",bottom:"top",top:"bottom"};function Pg(t){return t.replace(/left|right|bottom|top/g,function(e){return Uye[e]})}var Hye={start:"end",end:"start"};function XT(t){return t.replace(/start|end/g,function(e){return Hye[e]})}function ad(t){var e=Er(t),r=e.pageXOffset,n=e.pageYOffset;return{scrollLeft:r,scrollTop:n}}function ld(t){return js(zn(t)).left+ad(t).scrollLeft}function uR(t,e){var r=Er(t),n=zn(t),o=r.visualViewport,s=n.clientWidth,i=n.clientHeight,a=0,l=0;if(o){s=o.width,i=o.height;var u=Wb();(u||!u&&e==="fixed")&&(a=o.offsetLeft,l=o.offsetTop)}return{width:s,height:i,x:a+ld(t),y:l}}function cR(t){var e,r=zn(t),n=ad(t),o=(e=t.ownerDocument)==null?void 0:e.body,s=Ni(r.scrollWidth,r.clientWidth,o?o.scrollWidth:0,o?o.clientWidth:0),i=Ni(r.scrollHeight,r.clientHeight,o?o.scrollHeight:0,o?o.clientHeight:0),a=-n.scrollLeft+ld(t),l=-n.scrollTop;return xo(o||r).direction==="rtl"&&(a+=Ni(r.clientWidth,o?o.clientWidth:0)-s),{width:s,height:i,x:a,y:l}}function ud(t){var e=xo(t),r=e.overflow,n=e.overflowX,o=e.overflowY;return/auto|scroll|overlay|hidden/.test(r+o+n)}function YT(t){return["html","body","#document"].indexOf(In(t))>=0?t.ownerDocument.body:mn(t)&&ud(t)?t:YT(Jl(t))}function ap(t,e){var r;e===void 0&&(e=[]);var n=YT(t),o=n===((r=t.ownerDocument)==null?void 0:r.body),s=Er(n),i=o?[s].concat(s.visualViewport||[],ud(n)?n:[]):n,a=e.concat(i);return o?a:a.concat(ap(Jl(i)))}function Lg(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function qye(t,e){var r=js(t,!1,e==="fixed");return r.top=r.top+t.clientTop,r.left=r.left+t.clientLeft,r.bottom=r.top+t.clientHeight,r.right=r.left+t.clientWidth,r.width=t.clientWidth,r.height=t.clientHeight,r.x=r.left,r.y=r.top,r}function Wj(t,e,r){return e===qT?Lg(uR(t,r)):qs(e)?qye(e,r):Lg(cR(zn(t)))}function jye(t){var e=ap(Jl(t)),r=["absolute","fixed"].indexOf(xo(t).position)>=0,n=r&&mn(t)?Ii(t):t;return qs(n)?e.filter(function(o){return qs(o)&&Gb(o,n)&&In(o)!=="body"}):[]}function pR(t,e,r,n){var o=e==="clippingParents"?jye(t):[].concat(e),s=[].concat(o,[r]),i=s[0],a=s.reduce(function(l,u){var c=Wj(t,u,n);return l.top=Ni(c.top,l.top),l.right=nd(c.right,l.right),l.bottom=nd(c.bottom,l.bottom),l.left=Ni(c.left,l.left),l},Wj(t,i,n));return a.width=a.right-a.left,a.height=a.bottom-a.top,a.x=a.left,a.y=a.top,a}function jb(t){var e=t.reference,r=t.element,n=t.placement,o=n?En(n):null,s=n?Ks(n):null,i=e.x+e.width/2-r.width/2,a=e.y+e.height/2-r.height/2,l;switch(o){case Fr:l={x:i,y:e.y-r.height};break;case dn:l={x:i,y:e.y+e.height};break;case Yr:l={x:e.x+e.width,y:a};break;case Br:l={x:e.x-r.width,y:a};break;default:l={x:e.x,y:e.y}}var u=o?sd(o):null;if(u!=null){var c=u==="y"?"height":"width";switch(s){case Ql:l[u]=l[u]-(e[c]/2-r[c]/2);break;case rd:l[u]=l[u]+(e[c]/2-r[c]/2);break;default:}}return l}function Ei(t,e){e===void 0&&(e={});var r=e,n=r.placement,o=n===void 0?t.placement:n,s=r.strategy,i=s===void 0?t.strategy:s,a=r.boundary,l=a===void 0?$j:a,u=r.rootBoundary,c=u===void 0?qT:u,p=r.elementContext,f=p===void 0?Rg:p,d=r.altBoundary,m=d===void 0?!1:d,h=r.padding,g=h===void 0?0:h,x=Hb(typeof g!="number"?g:qb(g,ip)),y=f===Rg?Rj:Rg,b=t.rects.popper,v=t.elements[m?y:f],C=pR(qs(v)?v:v.contextElement||zn(t.elements.popper),l,c,i),S=js(t.elements.reference),k=jb({reference:S,element:b,strategy:"absolute",placement:o}),N=Lg(Object.assign({},b,k)),D=f===Rg?N:S,$={top:C.top-D.top+x.top,bottom:D.bottom-C.bottom+x.bottom,left:C.left-D.left+x.left,right:D.right-C.right+x.right},O=t.modifiersData.offset;if(f===Rg&&O){var V=O[o];Object.keys($).forEach(function(K){var X=[Yr,dn].indexOf(K)>=0?1:-1,W=[Fr,dn].indexOf(K)>=0?"y":"x";$[K]+=V[W]*X})}return $}function fR(t,e){e===void 0&&(e={});var r=e,n=r.placement,o=r.boundary,s=r.rootBoundary,i=r.padding,a=r.flipVariations,l=r.allowedAutoPlacements,u=l===void 0?jT:l,c=Ks(n),p=c?a?aR:aR.filter(function(m){return Ks(m)===c}):ip,f=p.filter(function(m){return u.indexOf(m)>=0});f.length===0&&(f=p);var d=f.reduce(function(m,h){return m[h]=Ei(t,{placement:h,boundary:o,rootBoundary:s,padding:i})[En(h)],m},{});return Object.keys(d).sort(function(m,h){return d[m]-d[h]})}function Kye(t){if(En(t)===HT)return[];var e=Pg(t);return[XT(t),e,XT(e)]}function Xye(t){var e=t.state,r=t.options,n=t.name;if(!e.modifiersData[n]._skip){for(var o=r.mainAxis,s=o===void 0?!0:o,i=r.altAxis,a=i===void 0?!0:i,l=r.fallbackPlacements,u=r.padding,c=r.boundary,p=r.rootBoundary,f=r.altBoundary,d=r.flipVariations,m=d===void 0?!0:d,h=r.allowedAutoPlacements,g=e.options.placement,x=En(g),y=x===g,b=l||(y||!m?[Pg(g)]:Kye(g)),v=[g].concat(b).reduce(function(ae,le){return ae.concat(En(le)===HT?fR(e,{placement:le,boundary:c,rootBoundary:p,padding:u,flipVariations:m,allowedAutoPlacements:h}):le)},[]),C=e.rects.reference,S=e.rects.popper,k=new Map,N=!0,D=v[0],$=0;$<v.length;$++){var O=v[$],V=En(O),K=Ks(O)===Ql,X=[Fr,dn].indexOf(V)>=0,W=X?"width":"height",H=Ei(e,{placement:O,boundary:c,rootBoundary:p,altBoundary:f,padding:u}),Y=X?K?Yr:Br:K?dn:Fr;C[W]>S[W]&&(Y=Pg(Y));var Z=Pg(Y),Q=[];if(s&&Q.push(H[V]<=0),a&&Q.push(H[Y]<=0,H[Z]<=0),Q.every(function(ae){return ae})){D=O,N=!1;break}k.set(O,Q)}if(N)for(var se=m?3:1,ne=function(le){var me=v.find(function(ke){var ve=k.get(ke);if(ve)return ve.slice(0,le).every(function(Te){return Te})});if(me)return D=me,"break"},re=se;re>0;re--){var ue=ne(re);if(ue==="break")break}e.placement!==D&&(e.modifiersData[n]._skip=!0,e.placement=D,e.reset=!0)}}var Gj={name:"flip",enabled:!0,phase:"main",fn:Xye,requiresIfExists:["offset"],data:{_skip:!1}};function Uj(t,e,r){return r===void 0&&(r={x:0,y:0}),{top:t.top-e.height-r.y,right:t.right-e.width+r.x,bottom:t.bottom-e.height+r.y,left:t.left-e.width-r.x}}function Hj(t){return[Fr,Yr,dn,Br].some(function(e){return t[e]>=0})}function Yye(t){var e=t.state,r=t.name,n=e.rects.reference,o=e.rects.popper,s=e.modifiersData.preventOverflow,i=Ei(e,{elementContext:"reference"}),a=Ei(e,{altBoundary:!0}),l=Uj(i,n),u=Uj(a,o,s),c=Hj(l),p=Hj(u);e.modifiersData[r]={referenceClippingOffsets:l,popperEscapeOffsets:u,isReferenceHidden:c,hasPopperEscaped:p},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":c,"data-popper-escaped":p})}var qj={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:Yye};function Qye(t,e,r){var n=En(t),o=[Br,Fr].indexOf(n)>=0?-1:1,s=typeof r=="function"?r(Object.assign({},e,{placement:t})):r,i=s[0],a=s[1];return i=i||0,a=(a||0)*o,[Br,Yr].indexOf(n)>=0?{x:a,y:i}:{x:i,y:a}}function Zye(t){var e=t.state,r=t.options,n=t.name,o=r.offset,s=o===void 0?[0,0]:o,i=jT.reduce(function(c,p){return c[p]=Qye(p,e.rects,s),c},{}),a=i[e.placement],l=a.x,u=a.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=l,e.modifiersData.popperOffsets.y+=u),e.modifiersData[n]=i}var jj={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:Zye};function Jye(t){var e=t.state,r=t.name;e.modifiersData[r]=jb({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})}var Kj={name:"popperOffsets",enabled:!0,phase:"read",fn:Jye,data:{}};function dR(t){return t==="x"?"y":"x"}function e0e(t){var e=t.state,r=t.options,n=t.name,o=r.mainAxis,s=o===void 0?!0:o,i=r.altAxis,a=i===void 0?!1:i,l=r.boundary,u=r.rootBoundary,c=r.altBoundary,p=r.padding,f=r.tether,d=f===void 0?!0:f,m=r.tetherOffset,h=m===void 0?0:m,g=Ei(e,{boundary:l,rootBoundary:u,padding:p,altBoundary:c}),x=En(e.placement),y=Ks(e.placement),b=!y,v=sd(x),C=dR(v),S=e.modifiersData.popperOffsets,k=e.rects.reference,N=e.rects.popper,D=typeof h=="function"?h(Object.assign({},e.rects,{placement:e.placement})):h,$=typeof D=="number"?{mainAxis:D,altAxis:D}:Object.assign({mainAxis:0,altAxis:0},D),O=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,V={x:0,y:0};if(!!S){if(s){var K,X=v==="y"?Fr:Br,W=v==="y"?dn:Yr,H=v==="y"?"height":"width",Y=S[v],Z=Y+g[X],Q=Y-g[W],se=d?-N[H]/2:0,ne=y===Ql?k[H]:N[H],re=y===Ql?-N[H]:-k[H],ue=e.elements.arrow,ae=d&&ue?od(ue):{width:0,height:0},le=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:Ub(),me=le[X],ke=le[W],ve=id(0,k[H],ae[H]),Te=b?k[H]/2-se-ve-me-$.mainAxis:ne-ve-me-$.mainAxis,Ve=b?-k[H]/2+se+ve+ke+$.mainAxis:re+ve+ke+$.mainAxis,qe=e.elements.arrow&&Ii(e.elements.arrow),R=qe?v==="y"?qe.clientTop||0:qe.clientLeft||0:0,q=(K=O?.[v])!=null?K:0,P=Y+Te-q-R,ie=Y+Ve-q,pe=id(d?nd(Z,P):Z,Y,d?Ni(Q,ie):Q);S[v]=pe,V[v]=pe-Y}if(a){var fe,Se=v==="x"?Fr:Br,at=v==="x"?dn:Yr,We=S[C],Mt=C==="y"?"height":"width",mt=We+g[Se],he=We-g[at],st=[Fr,Br].indexOf(x)!==-1,ht=(fe=O?.[C])!=null?fe:0,vo=st?mt:We-k[Mt]-N[Mt]-ht+$.altAxis,_r=st?We+k[Mt]+N[Mt]-ht-$.altAxis:he,gn=d&&st?Lj(vo,We,_r):id(d?vo:mt,We,d?_r:he);S[C]=gn,V[C]=gn-We}e.modifiersData[n]=V}}var Xj={name:"preventOverflow",enabled:!0,phase:"main",fn:e0e,requiresIfExists:["offset"]};function mR(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}function hR(t){return t===Er(t)||!mn(t)?ad(t):mR(t)}function t0e(t){var e=t.getBoundingClientRect(),r=Zl(e.width)/t.offsetWidth||1,n=Zl(e.height)/t.offsetHeight||1;return r!==1||n!==1}function gR(t,e,r){r===void 0&&(r=!1);var n=mn(e),o=mn(e)&&t0e(e),s=zn(e),i=js(t,o,r),a={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(n||!n&&!r)&&((In(e)!=="body"||ud(s))&&(a=hR(e)),mn(e)?(l=js(e,!0),l.x+=e.clientLeft,l.y+=e.clientTop):s&&(l.x=ld(s))),{x:i.left+a.scrollLeft-l.x,y:i.top+a.scrollTop-l.y,width:i.width,height:i.height}}function r0e(t){var e=new Map,r=new Set,n=[];t.forEach(function(s){e.set(s.name,s)});function o(s){r.add(s.name);var i=[].concat(s.requires||[],s.requiresIfExists||[]);i.forEach(function(a){if(!r.has(a)){var l=e.get(a);l&&o(l)}}),n.push(s)}return t.forEach(function(s){r.has(s.name)||o(s)}),n}function xR(t){var e=r0e(t);return Oj.reduce(function(r,n){return r.concat(e.filter(function(o){return o.phase===n}))},[])}function yR(t){var e;return function(){return e||(e=new Promise(function(r){Promise.resolve().then(function(){e=void 0,r(t())})})),e}}function bR(t){var e=t.reduce(function(r,n){var o=r[n.name];return r[n.name]=o?Object.assign({},o,n,{options:Object.assign({},o.options,n.options),data:Object.assign({},o.data,n.data)}):n,r},{});return Object.keys(e).map(function(r){return e[r]})}var Yj={placement:"bottom",modifiers:[],strategy:"absolute"};function Qj(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return!e.some(function(n){return!(n&&typeof n.getBoundingClientRect=="function")})}function Zj(t){t===void 0&&(t={});var e=t,r=e.defaultModifiers,n=r===void 0?[]:r,o=e.defaultOptions,s=o===void 0?Yj:o;return function(a,l,u){u===void 0&&(u=s);var c={placement:"bottom",orderedModifiers:[],options:Object.assign({},Yj,s),modifiersData:{},elements:{reference:a,popper:l},attributes:{},styles:{}},p=[],f=!1,d={state:c,setOptions:function(x){var y=typeof x=="function"?x(c.options):x;h(),c.options=Object.assign({},s,c.options,y),c.scrollParents={reference:qs(a)?ap(a):a.contextElement?ap(a.contextElement):[],popper:ap(l)};var b=xR(bR([].concat(n,c.options.modifiers)));if(c.orderedModifiers=b.filter(function(O){return O.enabled}),!1){var v;if(getBasePlacement(c.options.placement)===auto)var C;var S,k,N,D,$}return m(),d.update()},forceUpdate:function(){if(!f){var x=c.elements,y=x.reference,b=x.popper;if(!!Qj(y,b)){c.rects={reference:gR(y,Ii(b),c.options.strategy==="fixed"),popper:od(b)},c.reset=!1,c.placement=c.options.placement,c.orderedModifiers.forEach(function(O){return c.modifiersData[O.name]=Object.assign({},O.data)});for(var v=0,C=0;C<c.orderedModifiers.length;C++){if(c.reset===!0){c.reset=!1,C=-1;continue}var S=c.orderedModifiers[C],k=S.fn,N=S.options,D=N===void 0?{}:N,$=S.name;typeof k=="function"&&(c=k({state:c,options:D,name:$,instance:d})||c)}}}},update:yR(function(){return new Promise(function(g){d.forceUpdate(),g(c)})}),destroy:function(){h(),f=!0}};if(!Qj(a,l))return d;d.setOptions(u).then(function(g){!f&&u.onFirstUpdate&&u.onFirstUpdate(g)});function m(){c.orderedModifiers.forEach(function(g){var x=g.name,y=g.options,b=y===void 0?{}:y,v=g.effect;if(typeof v=="function"){var C=v({state:c,name:x,instance:d,options:b}),S=function(){};p.push(C||S)}})}function h(){p.forEach(function(g){return g()}),p=[]}return d}}var n0e=[Vj,Kj,Bj,Fj,jj,Gj,Xj,Mj,qj],vR=Zj({defaultModifiers:n0e});var rK=rt(eK());var l0e=[],wR=function(e,r,n){n===void 0&&(n={});var o=lp.useRef(null),s={onFirstUpdate:n.onFirstUpdate,placement:n.placement||"bottom",strategy:n.strategy||"absolute",modifiers:n.modifiers||l0e},i=lp.useState({styles:{popper:{position:s.strategy,left:"0",top:"0"},arrow:{position:"absolute"}},attributes:{}}),a=i[0],l=i[1],u=lp.useMemo(function(){return{name:"updateState",enabled:!0,phase:"write",fn:function(d){var m=d.state,h=Object.keys(m.elements);tK.flushSync(function(){l({styles:HA(h.map(function(g){return[g,m.styles[g]||{}]})),attributes:HA(h.map(function(g){return[g,m.attributes[g]]}))})})},requires:["computeStyles"]}},[]),c=lp.useMemo(function(){var f={onFirstUpdate:s.onFirstUpdate,placement:s.placement,strategy:s.strategy,modifiers:[].concat(s.modifiers,[u,{name:"applyStyles",enabled:!1}])};return(0,rK.default)(o.current,f)?o.current||f:(o.current=f,f)},[s.onFirstUpdate,s.placement,s.strategy,s.modifiers,u]),p=lp.useRef();return qA(function(){p.current&&p.current.setOptions(c)},[c]),qA(function(){if(!(e==null||r==null)){var f=n.createPopper||vR,d=f(e,r,c);return p.current=d,function(){d.destroy(),p.current=null}}},[e,r,n.createPopper]),{state:p.current?p.current.state:null,styles:a.styles,attributes:a.attributes,update:p.current?p.current.update:null,forceUpdate:p.current?p.current.forceUpdate:null}};function sK(t){var e=Ut.useRef(t);return e.current=t,Ut.useCallback(function(){return e.current},[])}var u0e=function(){};function c0e(t){var e=t.initial,r=t.value,n=t.onChange,o=n===void 0?u0e:n;if(e===void 0&&r===void 0)throw new TypeError('Either "value" or "initial" variable must be set. Now both are undefined');var s=Ut.useState(e),i=s[0],a=s[1],l=sK(i),u=Ut.useCallback(function(p){var f=l(),d=typeof p=="function"?p(f):p;typeof d.persist=="function"&&d.persist(),a(d),typeof o=="function"&&o(d)},[l,o]),c=r!==void 0;return[c?r:i,c?o:u]}function iK(t,e){return t===void 0&&(t=0),e===void 0&&(e=0),function(){return{width:0,height:0,top:e,right:t,bottom:e,left:t,x:0,y:0,toJSON:function(){return null}}}}var p0e=["styles","attributes"],nK={getBoundingClientRect:iK()},oK={closeOnOutsideClick:!0,closeOnTriggerHidden:!1,defaultVisible:!1,delayHide:0,delayShow:0,followCursor:!1,interactive:!1,mutationObserverOptions:{attributes:!0,childList:!0,subtree:!0},offset:[0,6],trigger:"hover"};function Mg(t,e){var r,n,o;t===void 0&&(t={}),e===void 0&&(e={});var s=Object.keys(oK).reduce(function(W,H){var Y;return xi({},W,(Y={},Y[H]=W[H]!==void 0?W[H]:oK[H],Y))},t),i=Ut.useMemo(function(){return[{name:"offset",options:{offset:s.offset}}]},Array.isArray(s.offset)?s.offset:[]),a=xi({},e,{placement:e.placement||s.placement,modifiers:e.modifiers||i}),l=Ut.useState(null),u=l[0],c=l[1],p=Ut.useState(null),f=p[0],d=p[1],m=c0e({initial:s.defaultVisible,value:s.visible,onChange:s.onVisibleChange}),h=m[0],g=m[1],x=Ut.useRef();Ut.useEffect(function(){return function(){return clearTimeout(x.current)}},[]);var y=wR(s.followCursor?nK:u,f,a),b=y.styles,v=y.attributes,C=UA(y,p0e),S=C.update,k=sK({visible:h,triggerRef:u,tooltipRef:f,finalConfig:s}),N=Ut.useCallback(function(W){return Array.isArray(s.trigger)?s.trigger.includes(W):s.trigger===W},Array.isArray(s.trigger)?s.trigger:[s.trigger]),D=Ut.useCallback(function(){clearTimeout(x.current),x.current=window.setTimeout(function(){return g(!1)},s.delayHide)},[s.delayHide,g]),$=Ut.useCallback(function(){clearTimeout(x.current),x.current=window.setTimeout(function(){return g(!0)},s.delayShow)},[s.delayShow,g]),O=Ut.useCallback(function(){k().visible?D():$()},[k,D,$]);Ut.useEffect(function(){if(!!k().finalConfig.closeOnOutsideClick){var W=function(Y){var Z,Q=k(),se=Q.tooltipRef,ne=Q.triggerRef,re=(Y.composedPath==null||(Z=Y.composedPath())==null?void 0:Z[0])||Y.target;re instanceof Node&&se!=null&&ne!=null&&!se.contains(re)&&!ne.contains(re)&&D()};return document.addEventListener("mousedown",W),function(){return document.removeEventListener("mousedown",W)}}},[k,D]),Ut.useEffect(function(){if(!(u==null||!N("click")))return u.addEventListener("click",O),function(){return u.removeEventListener("click",O)}},[u,N,O]),Ut.useEffect(function(){if(!(u==null||!N("double-click")))return u.addEventListener("dblclick",O),function(){return u.removeEventListener("dblclick",O)}},[u,N,O]),Ut.useEffect(function(){if(!(u==null||!N("right-click"))){var W=function(Y){Y.preventDefault(),O()};return u.addEventListener("contextmenu",W),function(){return u.removeEventListener("contextmenu",W)}}},[u,N,O]),Ut.useEffect(function(){if(!(u==null||!N("focus")))return u.addEventListener("focus",$),u.addEventListener("blur",D),function(){u.removeEventListener("focus",$),u.removeEventListener("blur",D)}},[u,N,$,D]),Ut.useEffect(function(){if(!(u==null||!N("hover")))return u.addEventListener("mouseenter",$),u.addEventListener("mouseleave",D),function(){u.removeEventListener("mouseenter",$),u.removeEventListener("mouseleave",D)}},[u,N,$,D]),Ut.useEffect(function(){if(!(f==null||!N("hover")||!k().finalConfig.interactive))return f.addEventListener("mouseenter",$),f.addEventListener("mouseleave",D),function(){f.removeEventListener("mouseenter",$),f.removeEventListener("mouseleave",D)}},[f,N,$,D,k]);var V=C==null||(r=C.state)==null||(n=r.modifiersData)==null||(o=n.hide)==null?void 0:o.isReferenceHidden;Ut.useEffect(function(){s.closeOnTriggerHidden&&V&&D()},[s.closeOnTriggerHidden,D,V]),Ut.useEffect(function(){if(!s.followCursor||u==null)return;function W(H){var Y=H.clientX,Z=H.clientY;nK.getBoundingClientRect=iK(Y,Z),S?.()}return u.addEventListener("mousemove",W),function(){return u.removeEventListener("mousemove",W)}},[s.followCursor,u,S]),Ut.useEffect(function(){if(!(f==null||S==null||s.mutationObserverOptions==null)){var W=new MutationObserver(S);return W.observe(f,s.mutationObserverOptions),function(){return W.disconnect()}}},[s.mutationObserverOptions,f,S]);var K=function(H){return H===void 0&&(H={}),xi({},H,{style:xi({},H.style,b.popper)},v.popper,{"data-popper-interactive":s.interactive})},X=function(H){return H===void 0&&(H={}),xi({},H,v.arrow,{style:xi({},H.style,b.arrow),"data-popper-arrow":!0})};return xi({getArrowProps:X,getTooltipProps:K,setTooltipRef:d,setTriggerRef:c,tooltipRef:f,triggerRef:u,visible:h},C)}var la=function(t,e,r){return e===void 0&&(e=0),r===void 0&&(r=1),t>r?r:t>e?t:e},CR=function(t){var e=t/255;return e<.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)},SR=function(t){return 255*(t>.0031308?1.055*Math.pow(t,.4166666666666667)-.055:12.92*t)},kR=96.422,TR=100,NR=82.521,f0e=function(t){var e,r,n={x:.9555766*(e=t).x+-.0230393*e.y+.0631636*e.z,y:-.0282895*e.x+1.0099416*e.y+.0210077*e.z,z:.0122982*e.x+-.020483*e.y+1.3299098*e.z};return r={r:SR(.032404542*n.x-.015371385*n.y-.004985314*n.z),g:SR(-.00969266*n.x+.018760108*n.y+41556e-8*n.z),b:SR(556434e-9*n.x-.002040259*n.y+.010572252*n.z),a:t.a},{r:la(r.r,0,255),g:la(r.g,0,255),b:la(r.b,0,255),a:la(r.a)}},d0e=function(t){var e=CR(t.r),r=CR(t.g),n=CR(t.b);return function(o){return{x:la(o.x,0,kR),y:la(o.y,0,TR),z:la(o.z,0,NR),a:la(o.a)}}(function(o){return{x:1.0478112*o.x+.0228866*o.y+-.050127*o.z,y:.0295424*o.x+.9904844*o.y+-.0170491*o.z,z:-.0092345*o.x+.0150436*o.y+.7521316*o.z,a:o.a}}({x:100*(.4124564*e+.3575761*r+.1804375*n),y:100*(.2126729*e+.7151522*r+.072175*n),z:100*(.0193339*e+.119192*r+.9503041*n),a:t.a}))},Kb=216/24389,zg=24389/27,aK=function(t){var e=d0e(t),r=e.x/kR,n=e.y/TR,o=e.z/NR;return r=r>Kb?Math.cbrt(r):(zg*r+16)/116,{l:116*(n=n>Kb?Math.cbrt(n):(zg*n+16)/116)-16,a:500*(r-n),b:200*(n-(o=o>Kb?Math.cbrt(o):(zg*o+16)/116)),alpha:e.a}},m0e=function(t,e,r){var n,o=aK(t),s=aK(e);return function(i){var a=(i.l+16)/116,l=i.a/500+a,u=a-i.b/200;return f0e({x:(Math.pow(l,3)>Kb?Math.pow(l,3):(116*l-16)/zg)*kR,y:(i.l>8?Math.pow((i.l+16)/116,3):i.l/zg)*TR,z:(Math.pow(u,3)>Kb?Math.pow(u,3):(116*u-16)/zg)*NR,a:i.alpha})}({l:la((n={l:o.l*(1-r)+s.l*r,a:o.a*(1-r)+s.a*r,b:o.b*(1-r)+s.b*r,alpha:o.alpha*(1-r)+s.alpha*r}).l,0,400),a:n.a,b:n.b,alpha:la(n.alpha)})};function ZT(t){function e(r,n,o){o===void 0&&(o=5);for(var s=[],i=1/(o-1),a=0;a<=o-1;a++)s.push(r.mix(n,i*a));return s}t.prototype.mix=function(r,n){n===void 0&&(n=.5);var o=r instanceof t?r:new t(r),s=m0e(this.toRgb(),o.toRgb(),n);return new t(s)},t.prototype.tints=function(r){return e(this,"#fff",r)},t.prototype.shades=function(r){return e(this,"#000",r)},t.prototype.tones=function(r){return e(this,"#808080",r)}}function JT(t,e){var r={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},n={};for(var o in r)n[r[o]]=o;var s={};t.prototype.toName=function(i){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var a,l,u=n[this.toHex()];if(u)return u;if(i?.closest){var c=this.toRgb(),p=1/0,f="black";if(!s.length)for(var d in r)s[d]=new t(r[d]).toRgb();for(var m in r){var h=(a=c,l=s[m],Math.pow(a.r-l.r,2)+Math.pow(a.g-l.g,2)+Math.pow(a.b-l.b,2));h<p&&(p=h,f=m)}return f}},e.string.push([function(i){var a=i.toLowerCase(),l=a==="transparent"?"#0000":r[a];return l?new t(l).toRgb():null},"name"])}kk([ZT,JT]);function up(t,e,r,n="red",o="blue"){return t>=0?ur(o).mix(ur("white"),Math.min(Math.max(1-t/r,0),1)):ur(n).mix(ur("white"),Math.min(Math.max(1- -t/-e,0),1))}function Xb(t){return t.replace(/\s/g,"&nbsp;").replace(/\n/g,"\xB6")}function lK({token:t,value:e,min:r,max:n,negativeColor:o,positiveColor:s}){let{getTooltipProps:i,setTooltipRef:a,setTriggerRef:l,visible:u}=Mg({followCursor:!0}),c=up(e,r,n,o,s).toRgbString(),p=ur(c).brightness()<.6?"white":"black",f={display:"inline-block",backgroundColor:c,color:p,lineHeight:"1em",padding:"3px 0",marginLeft:-1,marginBottom:1,borderWidth:1,borderStyle:"solid",borderColor:"#eee"},d=Xb(t),m=t.match(/\n/g);return eu.default.createElement(eu.default.Fragment,null,eu.default.createElement("span",{ref:l},eu.default.createElement("span",{style:f,dangerouslySetInnerHTML:{__html:d}}),m?.map((h,g)=>eu.default.createElement("br",{key:g}))),u&&eu.default.createElement("div",{ref:a,...i({style:{background:"#333",color:"white",textAlign:"center",padding:10,borderRadius:5,boxShadow:"5px 5px rgba(0, 0, 0, 0.03)",marginTop:15,zIndex:1}})},eu.default.createElement("strong",null,t),eu.default.createElement("br",null),e))}function eN({maxValue:t,minValue:e,negativeColor:r,positiveColor:n,tokens:o,values:s,paddingBottom:i}){let a=e??Math.min(...s),l=t??Math.max(...s);return IR.default.createElement("div",{className:"colored-tokens",style:{paddingBottom:i}},o.map((u,c)=>IR.default.createElement(lK,{key:c,token:u,value:s[c],min:a,max:l,negativeColor:r,positiveColor:n})))}function tN({activationsList:t,tokensList:e,minValue:r,maxValue:n}){let o={border:"1px solid black",borderRadius:5,padding:10,marginTop:10,marginBottom:10,backgroundColor:"#f5f5f5"};return cp.default.createElement("div",null,t&&e&&t.length>1&&t.map((s,i)=>cp.default.createElement(Bg.Row,{key:i},cp.default.createElement(Bg.Col,{style:o},cp.default.createElement(eN,{minValue:r,maxValue:n,tokens:e[i],values:s,paddingBottom:0})))),t&&e&&t.length===1&&cp.default.createElement(Bg.Row,{key:0},cp.default.createElement(Bg.Col,null,cp.default.createElement(eN,{tokens:e[0],values:t[0]}))))}var ER=rt(pt());function h0e(t){return t.length<3?t.join("-"):`${t[0]}-${t[t.length-1]}`}function g0e(t){let e=t.split("-");if(e.length===1)return[parseInt(e[0],10)];let r=parseInt(e[0],10),n=parseInt(e[e.length-1],10);return Array.from({length:n-r+1},(o,s)=>r+s)}function Vg({smallestNumber:t=0,largestNumber:e,currentRangeArr:r,setCurrentValue:n,numValsInRange:o,id:s}){let i=h0e(r),a=[];for(let l=t;l<=e;l+=o){let u=l,c=Math.min(l+o-1,e);u===c?a.push(`${u}`):a.push(`${u}-${c}`)}return ER.default.createElement("select",{value:i,onChange:l=>n(g0e(l.target.value)),id:s},a.map(l=>ER.default.createElement("option",{key:l},l)))}var _R=rt(pt());function us({smallestNumber:t=0,largestNumber:e,currentValue:r,setCurrentValue:n,id:o,labels:s}){let i=[...Array(e-t+1).keys()].map(l=>l+t),a=s&&s.length===i.length?s:i.map(l=>l.toString());return _R.default.createElement("select",{value:r,onChange:l=>n(Number(l.target.value)),id:o},i.map((l,u)=>_R.default.createElement("option",{key:l,value:l},a[u])))}function Yb(t,e){return t.slice(e[0][0],e[0][1]).map(r=>r.slice(e[1][0],e[1][1]))}function Qb(t){if(t.length===0)return[0,1];let e=Number.MAX_VALUE,r=Number.MIN_VALUE;for(let n=0;n<t.length;n+=1)if(Array.isArray(t[n])){let[o,s]=Qb(t[n]);e=Math.min(e,o),r=Math.max(r,s)}else e=Math.min(e,t[n]),r=Math.max(r,t[n]);return[e,r]}function x0e(t,e,r){return t.slice([0,e,r],[-1,1,1]).squeeze([1,2]).arraySync()}function y0e({tokens:t,activations:e,firstDimensionName:r="Layer",secondDimensionName:n="Neuron",firstDimensionLabels:o,secondDimensionLabels:s}){let i=typeof t[0]=="string"?[t]:t,a=typeof e[0][0][0]=="number"?[e]:e,[l,u]=Qb(a),c=a.map(D=>Cr(D)),p=c[0].shape[1],f=c[0].shape[2],d=c.length,[m,h]=(0,_t.useState)(Math.min(5,d)),[g,x]=(0,_t.useState)([...Array(m).keys()]),[y,b]=(0,_t.useState)(0),[v,C]=(0,_t.useState)(0);(0,_t.useEffect)(()=>{x([...Array(m).keys()])},[m]);let S=g.map(D=>x0e(c[D],y,v)),k=g.map(D=>i[D]),N={paddingTop:5,paddingBottom:5};return _t.default.createElement(Bn.Container,{fluid:!0},_t.default.createElement(Bn.Row,null,_t.default.createElement(Bn.Col,null,_t.default.createElement(Bn.Row,{style:N},_t.default.createElement(Bn.Col,null,_t.default.createElement("label",{htmlFor:"layer-selector",style:{marginRight:15}},r,":"),_t.default.createElement(us,{id:"layer-selector",largestNumber:p-1,currentValue:y,setCurrentValue:b,labels:o}))),_t.default.createElement(Bn.Row,{style:N},_t.default.createElement(Bn.Col,null,_t.default.createElement("label",{htmlFor:"neuron-selector",style:{marginRight:15}},n,":"),_t.default.createElement(us,{id:"neuron-selector",largestNumber:f-1,currentValue:v,setCurrentValue:C,labels:s}))),d>1&&_t.default.createElement(Bn.Row,{style:N},_t.default.createElement(Bn.Col,null,_t.default.createElement("label",{htmlFor:"sample-selector",style:{marginRight:15}},"Samples:"),_t.default.createElement(Vg,{id:"sample-selector",largestNumber:d-1,currentRangeArr:g,setCurrentValue:x,numValsInRange:m})))),_t.default.createElement(Bn.Col,null,d>1&&_t.default.createElement(Bn.Row,{style:N},_t.default.createElement(Bn.Col,null,_t.default.createElement("label",{htmlFor:"samples-per-page-selector",style:{marginRight:15}},"Samples per page:"),_t.default.createElement(us,{id:"samples-per-page-selector",smallestNumber:1,largestNumber:d,currentValue:m,setCurrentValue:h}))))),_t.default.createElement(Bn.Row,null,_t.default.createElement(Bn.Col,null,_t.default.createElement(tN,{activationsList:S,tokensList:k,minValue:l,maxValue:u}))))}var Vn=rt(pt()),pu=rt(Bf());var yp=rt(pt());function _i(){}var FR=(()=>{let t=0;return()=>t++})();function nr(t){return t===null||typeof t>"u"}function yr(t){if(Array.isArray&&Array.isArray(t))return!0;let e=Object.prototype.toString.call(t);return e.slice(0,7)==="[object"&&e.slice(-6)==="Array]"}function dt(t){return t!==null&&Object.prototype.toString.call(t)==="[object Object]"}function Qr(t){return(typeof t=="number"||t instanceof Number)&&isFinite(+t)}function yo(t,e){return Qr(t)?t:e}function xr(t,e){return typeof t>"u"?e:t}var PR=(t,e)=>typeof t=="string"&&t.endsWith("%")?parseFloat(t)/100*e:+t;function br(t,e,r){if(t&&typeof t.call=="function")return t.apply(r,e)}function At(t,e,r,n){let o,s,i;if(yr(t))if(s=t.length,n)for(o=s-1;o>=0;o--)e.call(r,t[o],o);else for(o=0;o<s;o++)e.call(r,t[o],o);else if(dt(t))for(i=Object.keys(t),s=i.length,o=0;o<s;o++)e.call(r,t[i[o]],i[o])}function Hg(t,e){let r,n,o,s;if(!t||!e||t.length!==e.length)return!1;for(r=0,n=t.length;r<n;++r)if(o=t[r],s=e[r],o.datasetIndex!==s.datasetIndex||o.index!==s.index)return!1;return!0}function ev(t){if(yr(t))return t.map(ev);if(dt(t)){let e=Object.create(null),r=Object.keys(t),n=r.length,o=0;for(;o<n;++o)e[r[o]]=ev(t[r[o]]);return e}return t}function bK(t){return["__proto__","prototype","constructor"].indexOf(t)===-1}function vK(t,e,r,n){if(!bK(t))return;let o=e[t],s=r[t];dt(o)&&dt(s)?pd(o,s,n):e[t]=ev(s)}function pd(t,e,r){let n=yr(e)?e:[e],o=n.length;if(!dt(t))return t;r=r||{};let s=r.merger||vK,i;for(let a=0;a<o;++a){if(i=n[a],!dt(i))continue;let l=Object.keys(i);for(let u=0,c=l.length;u<c;++u)s(l[u],t,i,r)}return t}function fd(t,e){return pd(t,e,{merger:wK})}function wK(t,e,r){if(!bK(t))return;let n=e[t],o=r[t];dt(n)&&dt(o)?fd(n,o):Object.prototype.hasOwnProperty.call(e,t)||(e[t]=ev(o))}var uK={"":t=>t,x:t=>t.x,y:t=>t.y};function CK(t){let e=t.split("."),r=[],n="";for(let o of e)n+=o,n.endsWith("\\")?n=n.slice(0,-1)+".":(r.push(n),n="");return r}function b0e(t){let e=CK(t);return r=>{for(let n of e){if(n==="")break;r=r&&r[n]}return r}}function qg(t,e){return(uK[e]||(uK[e]=b0e(e)))(t)}function rv(t){return t.charAt(0).toUpperCase()+t.slice(1)}var ps=t=>typeof t<"u",ua=t=>typeof t=="function",cN=(t,e)=>{if(t.size!==e.size)return!1;for(let r of t)if(!e.has(r))return!1;return!0};function LR(t){return t.type==="mouseup"||t.type==="click"||t.type==="contextmenu"}var _n=Math.PI,cs=2*_n,v0e=cs+_n,tv=Number.POSITIVE_INFINITY,SK=_n/180,oo=_n/2,pp=_n/4,$R=_n*2/3,ca=Math.log10,jg=Math.sign;function Kg(t,e,r){return Math.abs(t-e)<r}function pN(t){let e=Math.round(t);t=Kg(t,e,t/1e3)?e:t;let r=Math.pow(10,Math.floor(ca(t))),n=t/r;return(n<=1?1:n<=2?2:n<=5?5:10)*r}function MR(t){let e=[],r=Math.sqrt(t),n;for(n=1;n<r;n++)t%n===0&&(e.push(n),e.push(t/n));return r===(r|0)&&e.push(r),e.sort((o,s)=>o-s).pop(),e}function Xg(t){return!isNaN(parseFloat(t))&&isFinite(t)}function zR(t,e){let r=Math.round(t);return r-e<=t&&r+e>=t}function fN(t,e,r){let n,o,s;for(n=0,o=t.length;n<o;n++)s=t[n][r],isNaN(s)||(e.min=Math.min(e.min,s),e.max=Math.max(e.max,s))}function pa(t){return t*(_n/180)}function nv(t){return t*(180/_n)}function dN(t){if(!Qr(t))return;let e=1,r=0;for(;Math.round(t*e)/e!==t;)e*=10,r++;return r}function BR(t,e){let r=e.x-t.x,n=e.y-t.y,o=Math.sqrt(r*r+n*n),s=Math.atan2(n,r);return s<-.5*_n&&(s+=cs),{angle:s,distance:o}}function VR(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function Ys(t){return(t%cs+cs)%cs}function WR(t,e,r,n){let o=Ys(t),s=Ys(e),i=Ys(r),a=Ys(s-o),l=Ys(i-o),u=Ys(o-s),c=Ys(o-i);return o===s||o===i||n&&s===i||a>l&&u<c}function Qs(t,e,r){return Math.max(e,Math.min(r,t))}function GR(t){return Qs(t,-32768,32767)}function ov(t,e,r){r=r||(i=>t[i]<e);let n=t.length-1,o=0,s;for(;n-o>1;)s=o+n>>1,r(s)?o=s:n=s;return{lo:o,hi:n}}var sv=(t,e,r,n)=>ov(t,r,n?o=>{let s=t[o][e];return s<r||s===r&&t[o+1][e]===r}:o=>t[o][e]<r),UR=(t,e,r)=>ov(t,r,n=>t[n][e]>=r);function HR(t,e,r){let n=0,o=t.length;for(;n<o&&t[n]<e;)n++;for(;o>n&&t[o-1]>r;)o--;return n>0||o<t.length?t.slice(n,o):t}var kK=["push","pop","shift","splice","unshift"];function qR(t,e){if(t._chartjs){t._chartjs.listeners.push(e);return}Object.defineProperty(t,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[e]}}),kK.forEach(r=>{let n="_onData"+rv(r),o=t[r];Object.defineProperty(t,r,{configurable:!0,enumerable:!1,value(...s){let i=o.apply(this,s);return t._chartjs.listeners.forEach(a=>{typeof a[n]=="function"&&a[n](...s)}),i}})})}function mN(t,e){let r=t._chartjs;if(!r)return;let n=r.listeners,o=n.indexOf(e);o!==-1&&n.splice(o,1),!(n.length>0)&&(kK.forEach(s=>{delete t[s]}),delete t._chartjs)}function jR(t){let e=new Set,r,n;for(r=0,n=t.length;r<n;++r)e.add(t[r]);return e.size===n?t:Array.from(e)}var hN=function(){return typeof window>"u"?function(t){return t()}:window.requestAnimationFrame}();function gN(t,e){let r=!1;return function(...n){r||(r=!0,hN.call(window,()=>{r=!1,t.apply(e,n)}))}}function KR(t,e){let r;return function(...n){return e?(clearTimeout(r),r=setTimeout(t,e,n)):t.apply(this,n),e}}var XR=t=>t==="start"?"left":t==="end"?"right":"center",xN=(t,e,r)=>t==="start"?e:t==="end"?r:(e+r)/2;var rN=t=>t===0||t===1,cK=(t,e,r)=>-(Math.pow(2,10*(t-=1))*Math.sin((t-e)*cs/r)),pK=(t,e,r)=>Math.pow(2,-10*t)*Math.sin((t-e)*cs/r)+1,aN={linear:t=>t,easeInQuad:t=>t*t,easeOutQuad:t=>-t*(t-2),easeInOutQuad:t=>(t/=.5)<1?.5*t*t:-.5*(--t*(t-2)-1),easeInCubic:t=>t*t*t,easeOutCubic:t=>(t-=1)*t*t+1,easeInOutCubic:t=>(t/=.5)<1?.5*t*t*t:.5*((t-=2)*t*t+2),easeInQuart:t=>t*t*t*t,easeOutQuart:t=>-((t-=1)*t*t*t-1),easeInOutQuart:t=>(t/=.5)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2),easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>(t-=1)*t*t*t*t+1,easeInOutQuint:t=>(t/=.5)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2),easeInSine:t=>-Math.cos(t*oo)+1,easeOutSine:t=>Math.sin(t*oo),easeInOutSine:t=>-.5*(Math.cos(_n*t)-1),easeInExpo:t=>t===0?0:Math.pow(2,10*(t-1)),easeOutExpo:t=>t===1?1:-Math.pow(2,-10*t)+1,easeInOutExpo:t=>rN(t)?t:t<.5?.5*Math.pow(2,10*(t*2-1)):.5*(-Math.pow(2,-10*(t*2-1))+2),easeInCirc:t=>t>=1?t:-(Math.sqrt(1-t*t)-1),easeOutCirc:t=>Math.sqrt(1-(t-=1)*t),easeInOutCirc:t=>(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1),easeInElastic:t=>rN(t)?t:cK(t,.075,.3),easeOutElastic:t=>rN(t)?t:pK(t,.075,.3),easeInOutElastic(t){return rN(t)?t:t<.5?.5*cK(t*2,.1125,.45):.5+.5*pK(t*2-1,.1125,.45)},easeInBack(t){return t*t*((1.70158+1)*t-1.70158)},easeOutBack(t){return(t-=1)*t*((1.70158+1)*t+1.70158)+1},easeInOutBack(t){let e=1.70158;return(t/=.5)<1?.5*(t*t*(((e*=1.525)+1)*t-e)):.5*((t-=2)*t*(((e*=1.525)+1)*t+e)+2)},easeInBounce:t=>1-aN.easeOutBounce(1-t),easeOutBounce(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},easeInOutBounce:t=>t<.5?aN.easeInBounce(t*2)*.5:aN.easeOutBounce(t*2-1)*.5+.5},yN=aN;function iv(t){return t+.5|0}var fp=(t,e,r)=>Math.max(Math.min(t,r),e);function Zb(t){return fp(iv(t*2.55),0,255)}function dp(t){return fp(iv(t*255),0,255)}function tu(t){return fp(iv(t/2.55)/100,0,1)}function fK(t){return fp(iv(t*100),0,100)}var Xs={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},RR=[..."0123456789ABCDEF"],w0e=t=>RR[t&15],C0e=t=>RR[(t&240)>>4]+RR[t&15],nN=t=>(t&240)>>4===(t&15),S0e=t=>nN(t.r)&&nN(t.g)&&nN(t.b)&&nN(t.a);function k0e(t){var e=t.length,r;return t[0]==="#"&&(e===4||e===5?r={r:255&Xs[t[1]]*17,g:255&Xs[t[2]]*17,b:255&Xs[t[3]]*17,a:e===5?Xs[t[4]]*17:255}:(e===7||e===9)&&(r={r:Xs[t[1]]<<4|Xs[t[2]],g:Xs[t[3]]<<4|Xs[t[4]],b:Xs[t[5]]<<4|Xs[t[6]],a:e===9?Xs[t[7]]<<4|Xs[t[8]]:255})),r}var T0e=(t,e)=>t<255?e(t):"";function N0e(t){var e=S0e(t)?w0e:C0e;return t?"#"+e(t.r)+e(t.g)+e(t.b)+T0e(t.a,e):void 0}var I0e=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function TK(t,e,r){let n=e*Math.min(r,1-r),o=(s,i=(s+t/30)%12)=>r-n*Math.max(Math.min(i-3,9-i,1),-1);return[o(0),o(8),o(4)]}function E0e(t,e,r){let n=(o,s=(o+t/60)%6)=>r-r*e*Math.max(Math.min(s,4-s,1),0);return[n(5),n(3),n(1)]}function _0e(t,e,r){let n=TK(t,1,.5),o;for(e+r>1&&(o=1/(e+r),e*=o,r*=o),o=0;o<3;o++)n[o]*=1-e-r,n[o]+=e;return n}function A0e(t,e,r,n,o){return t===o?(e-r)/n+(e<r?6:0):e===o?(r-t)/n+2:(t-e)/n+4}function YR(t){let r=t.r/255,n=t.g/255,o=t.b/255,s=Math.max(r,n,o),i=Math.min(r,n,o),a=(s+i)/2,l,u,c;return s!==i&&(c=s-i,u=a>.5?c/(2-s-i):c/(s+i),l=A0e(r,n,o,c,s),l=l*60+.5),[l|0,u||0,a]}function QR(t,e,r,n){return(Array.isArray(e)?t(e[0],e[1],e[2]):t(e,r,n)).map(dp)}function ZR(t,e,r){return QR(TK,t,e,r)}function D0e(t,e,r){return QR(_0e,t,e,r)}function $0e(t,e,r){return QR(E0e,t,e,r)}function NK(t){return(t%360+360)%360}function R0e(t){let e=I0e.exec(t),r=255,n;if(!e)return;e[5]!==n&&(r=e[6]?Zb(+e[5]):dp(+e[5]));let o=NK(+e[2]),s=+e[3]/100,i=+e[4]/100;return e[1]==="hwb"?n=D0e(o,s,i):e[1]==="hsv"?n=$0e(o,s,i):n=ZR(o,s,i),{r:n[0],g:n[1],b:n[2],a:r}}function O0e(t,e){var r=YR(t);r[0]=NK(r[0]+e),r=ZR(r),t.r=r[0],t.g=r[1],t.b=r[2]}function F0e(t){if(!t)return;let e=YR(t),r=e[0],n=fK(e[1]),o=fK(e[2]);return t.a<255?`hsla(${r}, ${n}%, ${o}%, ${tu(t.a)})`:`hsl(${r}, ${n}%, ${o}%)`}var dK={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},mK={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function P0e(){let t={},e=Object.keys(mK),r=Object.keys(dK),n,o,s,i,a;for(n=0;n<e.length;n++){for(i=a=e[n],o=0;o<r.length;o++)s=r[o],a=a.replace(s,dK[s]);s=parseInt(mK[i],16),t[a]=[s>>16&255,s>>8&255,s&255]}return t}var oN;function L0e(t){oN||(oN=P0e(),oN.transparent=[0,0,0,0]);let e=oN[t.toLowerCase()];return e&&{r:e[0],g:e[1],b:e[2],a:e.length===4?e[3]:255}}var M0e=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function z0e(t){let e=M0e.exec(t),r=255,n,o,s;if(!!e){if(e[7]!==n){let i=+e[7];r=e[8]?Zb(i):fp(i*255,0,255)}return n=+e[1],o=+e[3],s=+e[5],n=255&(e[2]?Zb(n):fp(n,0,255)),o=255&(e[4]?Zb(o):fp(o,0,255)),s=255&(e[6]?Zb(s):fp(s,0,255)),{r:n,g:o,b:s,a:r}}}function B0e(t){return t&&(t.a<255?`rgba(${t.r}, ${t.g}, ${t.b}, ${tu(t.a)})`:`rgb(${t.r}, ${t.g}, ${t.b})`)}var AR=t=>t<=.0031308?t*12.92:Math.pow(t,1/2.4)*1.055-.055,Wg=t=>t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4);function V0e(t,e,r){let n=Wg(tu(t.r)),o=Wg(tu(t.g)),s=Wg(tu(t.b));return{r:dp(AR(n+r*(Wg(tu(e.r))-n))),g:dp(AR(o+r*(Wg(tu(e.g))-o))),b:dp(AR(s+r*(Wg(tu(e.b))-s))),a:t.a+r*(e.a-t.a)}}function sN(t,e,r){if(t){let n=YR(t);n[e]=Math.max(0,Math.min(n[e]+n[e]*r,e===0?360:1)),n=ZR(n),t.r=n[0],t.g=n[1],t.b=n[2]}}function IK(t,e){return t&&Object.assign(e||{},t)}function hK(t){var e={r:0,g:0,b:0,a:255};return Array.isArray(t)?t.length>=3&&(e={r:t[0],g:t[1],b:t[2],a:255},t.length>3&&(e.a=dp(t[3]))):(e=IK(t,{r:0,g:0,b:0,a:1}),e.a=dp(e.a)),e}function W0e(t){return t.charAt(0)==="r"?z0e(t):R0e(t)}var Gg=class{constructor(e){if(e instanceof Gg)return e;let r=typeof e,n;r==="object"?n=hK(e):r==="string"&&(n=k0e(e)||L0e(e)||W0e(e)),this._rgb=n,this._valid=!!n}get valid(){return this._valid}get rgb(){var e=IK(this._rgb);return e&&(e.a=tu(e.a)),e}set rgb(e){this._rgb=hK(e)}rgbString(){return this._valid?B0e(this._rgb):void 0}hexString(){return this._valid?N0e(this._rgb):void 0}hslString(){return this._valid?F0e(this._rgb):void 0}mix(e,r){if(e){let n=this.rgb,o=e.rgb,s,i=r===s?.5:r,a=2*i-1,l=n.a-o.a,u=((a*l===-1?a:(a+l)/(1+a*l))+1)/2;s=1-u,n.r=255&u*n.r+s*o.r+.5,n.g=255&u*n.g+s*o.g+.5,n.b=255&u*n.b+s*o.b+.5,n.a=i*n.a+(1-i)*o.a,this.rgb=n}return this}interpolate(e,r){return e&&(this._rgb=V0e(this._rgb,e._rgb,r)),this}clone(){return new Gg(this.rgb)}alpha(e){return this._rgb.a=dp(e),this}clearer(e){let r=this._rgb;return r.a*=1-e,this}greyscale(){let e=this._rgb,r=iv(e.r*.3+e.g*.59+e.b*.11);return e.r=e.g=e.b=r,this}opaquer(e){let r=this._rgb;return r.a*=1+e,this}negate(){let e=this._rgb;return e.r=255-e.r,e.g=255-e.g,e.b=255-e.b,this}lighten(e){return sN(this._rgb,2,e),this}darken(e){return sN(this._rgb,2,-e),this}saturate(e){return sN(this._rgb,1,e),this}desaturate(e){return sN(this._rgb,1,-e),this}rotate(e){return O0e(this._rgb,e),this}};function EK(t){return new Gg(t)}function JR(t){if(t&&typeof t=="object"){let e=t.toString();return e==="[object CanvasPattern]"||e==="[object CanvasGradient]"}return!1}function bN(t){return JR(t)?t:EK(t)}function lN(t){return JR(t)?t:EK(t).saturate(.5).darken(.1).hexString()}var G0e=["x","y","borderWidth","radius","tension"],U0e=["color","borderColor","backgroundColor"];function H0e(t){t.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),t.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:e=>e!=="onProgress"&&e!=="onComplete"&&e!=="fn"}),t.set("animations",{colors:{type:"color",properties:U0e},numbers:{type:"number",properties:G0e}}),t.describe("animations",{_fallback:"animation"}),t.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:e=>e|0}}}})}function q0e(t){t.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}var gK=new Map;function j0e(t,e){e=e||{};let r=t+JSON.stringify(e),n=gK.get(r);return n||(n=new Intl.NumberFormat(t,e),gK.set(r,n)),n}function av(t,e,r){return j0e(e,r).format(t)}var _K={values(t){return yr(t)?t:""+t},numeric(t,e,r){if(t===0)return"0";let n=this.chart.options.locale,o,s=t;if(r.length>1){let u=Math.max(Math.abs(r[0].value),Math.abs(r[r.length-1].value));(u<1e-4||u>1e15)&&(o="scientific"),s=K0e(t,r)}let i=ca(Math.abs(s)),a=Math.max(Math.min(-1*Math.floor(i),20),0),l={notation:o,minimumFractionDigits:a,maximumFractionDigits:a};return Object.assign(l,this.options.ticks.format),av(t,n,l)},logarithmic(t,e,r){if(t===0)return"0";let n=r[e].significand||t/Math.pow(10,Math.floor(ca(t)));return[1,2,3,5,10,15].includes(n)||e>.8*r.length?_K.numeric.call(this,t,e,r):""}};function K0e(t,e){let r=e.length>3?e[2].value-e[1].value:e[1].value-e[0].value;return Math.abs(r)>=1&&t!==Math.floor(t)&&(r=t-Math.floor(t)),r}var lv={formatters:_K};function X0e(t){t.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(e,r)=>r.lineWidth,tickColor:(e,r)=>r.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:lv.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),t.route("scale.ticks","color","","color"),t.route("scale.grid","color","","borderColor"),t.route("scale.border","color","","borderColor"),t.route("scale.title","color","","color"),t.describe("scale",{_fallback:!1,_scriptable:e=>!e.startsWith("before")&&!e.startsWith("after")&&e!=="callback"&&e!=="parser",_indexable:e=>e!=="borderDash"&&e!=="tickBorderDash"&&e!=="dash"}),t.describe("scales",{_fallback:"scale"}),t.describe("scale.ticks",{_scriptable:e=>e!=="backdropPadding"&&e!=="callback",_indexable:e=>e!=="backdropPadding"})}var hp=Object.create(null),vN=Object.create(null);function Jb(t,e){if(!e)return t;let r=e.split(".");for(let n=0,o=r.length;n<o;++n){let s=r[n];t=t[s]||(t[s]=Object.create(null))}return t}function DR(t,e,r){return typeof e=="string"?pd(Jb(t,e),r):pd(Jb(t,""),e)}var OR=class{constructor(e,r){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=n=>n.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(n,o)=>lN(o.backgroundColor),this.hoverBorderColor=(n,o)=>lN(o.borderColor),this.hoverColor=(n,o)=>lN(o.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(e),this.apply(r)}set(e,r){return DR(this,e,r)}get(e){return Jb(this,e)}describe(e,r){return DR(vN,e,r)}override(e,r){return DR(hp,e,r)}route(e,r,n,o){let s=Jb(this,e),i=Jb(this,n),a="_"+r;Object.defineProperties(s,{[a]:{value:s[r],writable:!0},[r]:{enumerable:!0,get(){let l=this[a],u=i[o];return dt(l)?Object.assign({},u,l):xr(l,u)},set(l){this[a]=l}}})}apply(e){e.forEach(r=>r(this))}},Vr=new OR({_scriptable:t=>!t.startsWith("on"),_indexable:t=>t!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[H0e,q0e,X0e]);function AK(t){return!t||nr(t.size)||nr(t.family)?null:(t.style?t.style+" ":"")+(t.weight?t.weight+" ":"")+t.size+"px "+t.family}function Ug(t,e,r,n,o){let s=e[o];return s||(s=e[o]=t.measureText(o).width,r.push(o)),s>n&&(n=s),n}function eO(t,e,r,n){n=n||{};let o=n.data=n.data||{},s=n.garbageCollect=n.garbageCollect||[];n.font!==e&&(o=n.data={},s=n.garbageCollect=[],n.font=e),t.save(),t.font=e;let i=0,a=r.length,l,u,c,p,f;for(l=0;l<a;l++)if(p=r[l],p!=null&&yr(p)!==!0)i=Ug(t,o,s,i,p);else if(yr(p))for(u=0,c=p.length;u<c;u++)f=p[u],f!=null&&!yr(f)&&(i=Ug(t,o,s,i,f));t.restore();let d=s.length/2;if(d>r.length){for(l=0;l<d;l++)delete o[s[l]];s.splice(0,d)}return i}function ru(t,e,r){let n=t.currentDevicePixelRatio,o=r!==0?Math.max(r/2,.5):0;return Math.round((e-o)*n)/n+o}function wN(t,e){e=e||t.getContext("2d"),e.save(),e.resetTransform(),e.clearRect(0,0,t.width,t.height),e.restore()}function CN(t,e,r,n){tO(t,e,r,n,null)}function tO(t,e,r,n,o){let s,i,a,l,u,c,p,f,d=e.pointStyle,m=e.rotation,h=e.radius,g=(m||0)*SK;if(d&&typeof d=="object"&&(s=d.toString(),s==="[object HTMLImageElement]"||s==="[object HTMLCanvasElement]")){t.save(),t.translate(r,n),t.rotate(g),t.drawImage(d,-d.width/2,-d.height/2,d.width,d.height),t.restore();return}if(!(isNaN(h)||h<=0)){switch(t.beginPath(),d){default:o?t.ellipse(r,n,o/2,h,0,0,cs):t.arc(r,n,h,0,cs),t.closePath();break;case"triangle":c=o?o/2:h,t.moveTo(r+Math.sin(g)*c,n-Math.cos(g)*h),g+=$R,t.lineTo(r+Math.sin(g)*c,n-Math.cos(g)*h),g+=$R,t.lineTo(r+Math.sin(g)*c,n-Math.cos(g)*h),t.closePath();break;case"rectRounded":u=h*.516,l=h-u,i=Math.cos(g+pp)*l,p=Math.cos(g+pp)*(o?o/2-u:l),a=Math.sin(g+pp)*l,f=Math.sin(g+pp)*(o?o/2-u:l),t.arc(r-p,n-a,u,g-_n,g-oo),t.arc(r+f,n-i,u,g-oo,g),t.arc(r+p,n+a,u,g,g+oo),t.arc(r-f,n+i,u,g+oo,g+_n),t.closePath();break;case"rect":if(!m){l=Math.SQRT1_2*h,c=o?o/2:l,t.rect(r-c,n-l,2*c,2*l);break}g+=pp;case"rectRot":p=Math.cos(g)*(o?o/2:h),i=Math.cos(g)*h,a=Math.sin(g)*h,f=Math.sin(g)*(o?o/2:h),t.moveTo(r-p,n-a),t.lineTo(r+f,n-i),t.lineTo(r+p,n+a),t.lineTo(r-f,n+i),t.closePath();break;case"crossRot":g+=pp;case"cross":p=Math.cos(g)*(o?o/2:h),i=Math.cos(g)*h,a=Math.sin(g)*h,f=Math.sin(g)*(o?o/2:h),t.moveTo(r-p,n-a),t.lineTo(r+p,n+a),t.moveTo(r+f,n-i),t.lineTo(r-f,n+i);break;case"star":p=Math.cos(g)*(o?o/2:h),i=Math.cos(g)*h,a=Math.sin(g)*h,f=Math.sin(g)*(o?o/2:h),t.moveTo(r-p,n-a),t.lineTo(r+p,n+a),t.moveTo(r+f,n-i),t.lineTo(r-f,n+i),g+=pp,p=Math.cos(g)*(o?o/2:h),i=Math.cos(g)*h,a=Math.sin(g)*h,f=Math.sin(g)*(o?o/2:h),t.moveTo(r-p,n-a),t.lineTo(r+p,n+a),t.moveTo(r+f,n-i),t.lineTo(r-f,n+i);break;case"line":i=o?o/2:Math.cos(g)*h,a=Math.sin(g)*h,t.moveTo(r-i,n-a),t.lineTo(r+i,n+a);break;case"dash":t.moveTo(r,n),t.lineTo(r+Math.cos(g)*(o?o/2:h),n+Math.sin(g)*h);break}t.fill(),e.borderWidth>0&&t.stroke()}}function SN(t,e,r){return r=r||.5,!e||t&&t.x>e.left-r&&t.x<e.right+r&&t.y>e.top-r&&t.y<e.bottom+r}function kN(t,e){t.save(),t.beginPath(),t.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),t.clip()}function TN(t){t.restore()}function Yg(t,e,r,n,o,s={}){let i=yr(e)?e:[e],a=s.strokeWidth>0&&s.strokeColor!=="",l,u;for(t.save(),t.font=o.string,Y0e(t,s),l=0;l<i.length;++l)u=i[l],s.backdrop&&Z0e(t,s.backdrop),a&&(s.strokeColor&&(t.strokeStyle=s.strokeColor),nr(s.strokeWidth)||(t.lineWidth=s.strokeWidth),t.strokeText(u,r,n,s.maxWidth)),t.fillText(u,r,n,s.maxWidth),Q0e(t,r,n,u,s),n+=o.lineHeight;t.restore()}function Y0e(t,e){e.translation&&t.translate(e.translation[0],e.translation[1]),nr(e.rotation)||t.rotate(e.rotation),e.color&&(t.fillStyle=e.color),e.textAlign&&(t.textAlign=e.textAlign),e.textBaseline&&(t.textBaseline=e.textBaseline)}function Q0e(t,e,r,n,o){if(o.strikethrough||o.underline){let s=t.measureText(n),i=e-s.actualBoundingBoxLeft,a=e+s.actualBoundingBoxRight,l=r-s.actualBoundingBoxAscent,u=r+s.actualBoundingBoxDescent,c=o.strikethrough?(l+u)/2:u;t.strokeStyle=t.fillStyle,t.beginPath(),t.lineWidth=o.decorationWidth||2,t.moveTo(i,c),t.lineTo(a,c),t.stroke()}}function Z0e(t,e){let r=t.fillStyle;t.fillStyle=e.color,t.fillRect(e.left,e.top,e.width,e.height),t.fillStyle=r}function nu(t,e){let{x:r,y:n,w:o,h:s,radius:i}=e;t.arc(r+i.topLeft,n+i.topLeft,i.topLeft,-oo,_n,!0),t.lineTo(r,n+s-i.bottomLeft),t.arc(r+i.bottomLeft,n+s-i.bottomLeft,i.bottomLeft,_n,oo,!0),t.lineTo(r+o-i.bottomRight,n+s),t.arc(r+o-i.bottomRight,n+s-i.bottomRight,i.bottomRight,oo,0,!0),t.lineTo(r+o,n+i.topRight),t.arc(r+o-i.topRight,n+i.topRight,i.topRight,0,-oo,!0),t.lineTo(r+i.topLeft,n)}var J0e=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,ebe=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function DK(t,e){let r=(""+t).match(J0e);if(!r||r[1]==="normal")return e*1.2;switch(t=+r[2],r[3]){case"px":return t;case"%":t/=100;break}return e*t}var tbe=t=>+t||0;function NN(t,e){let r={},n=dt(e),o=n?Object.keys(e):e,s=dt(t)?n?i=>xr(t[i],t[e[i]]):i=>t[i]:()=>t;for(let i of o)r[i]=tbe(s(i));return r}function rO(t){return NN(t,{top:"y",right:"x",bottom:"y",left:"x"})}function ou(t){return NN(t,["topLeft","topRight","bottomLeft","bottomRight"])}function Vo(t){let e=rO(t);return e.width=e.left+e.right,e.height=e.top+e.bottom,e}function bo(t,e){t=t||{},e=e||Vr.font;let r=xr(t.size,e.size);typeof r=="string"&&(r=parseInt(r,10));let n=xr(t.style,e.style);n&&!(""+n).match(ebe)&&(console.warn('Invalid font style specified: "'+n+'"'),n=void 0);let o={family:xr(t.family,e.family),lineHeight:DK(xr(t.lineHeight,e.lineHeight),r),size:r,style:n,weight:xr(t.weight,e.weight),string:""};return o.string=AK(o),o}function Qg(t,e,r,n){let o=!0,s,i,a;for(s=0,i=t.length;s<i;++s)if(a=t[s],a!==void 0&&(e!==void 0&&typeof a=="function"&&(a=a(e),o=!1),r!==void 0&&yr(a)&&(a=a[r%a.length],o=!1),a!==void 0))return n&&!o&&(n.cacheable=!1),a}function nO(t,e,r){let{min:n,max:o}=t,s=PR(e,(o-n)/2),i=(a,l)=>r&&a===0?0:a+l;return{min:i(n,-Math.abs(s)),max:i(o,s)}}function su(t,e){return Object.assign(Object.create(t),e)}function uv(t,e=[""],r=t,n,o=()=>t[0]){ps(n)||(n=OK("_fallback",t));let s={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:t,_rootScopes:r,_fallback:n,_getTarget:o,override:i=>uv([i,...t],e,r,n)};return new Proxy(s,{deleteProperty(i,a){return delete i[a],delete i._keys,delete t[0][a],!0},get(i,a){return $K(i,a,()=>ube(a,e,t,i))},getOwnPropertyDescriptor(i,a){return Reflect.getOwnPropertyDescriptor(i._scopes[0],a)},getPrototypeOf(){return Reflect.getPrototypeOf(t[0])},has(i,a){return yK(i).includes(a)},ownKeys(i){return yK(i)},set(i,a,l){let u=i._storage||(i._storage=o());return i[a]=u[a]=l,delete i._keys,!0}})}function mp(t,e,r,n){let o={_cacheable:!1,_proxy:t,_context:e,_subProxy:r,_stack:new Set,_descriptors:IN(t,n),setContext:s=>mp(t,s,r,n),override:s=>mp(t.override(s),e,r,n)};return new Proxy(o,{deleteProperty(s,i){return delete s[i],delete t[i],!0},get(s,i,a){return $K(s,i,()=>nbe(s,i,a))},getOwnPropertyDescriptor(s,i){return s._descriptors.allKeys?Reflect.has(t,i)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(t,i)},getPrototypeOf(){return Reflect.getPrototypeOf(t)},has(s,i){return Reflect.has(t,i)},ownKeys(){return Reflect.ownKeys(t)},set(s,i,a){return t[i]=a,delete s[i],!0}})}function IN(t,e={scriptable:!0,indexable:!0}){let{_scriptable:r=e.scriptable,_indexable:n=e.indexable,_allKeys:o=e.allKeys}=t;return{allKeys:o,scriptable:r,indexable:n,isScriptable:ua(r)?r:()=>r,isIndexable:ua(n)?n:()=>n}}var rbe=(t,e)=>t?t+rv(e):e,oO=(t,e)=>dt(e)&&t!=="adapters"&&(Object.getPrototypeOf(e)===null||e.constructor===Object);function $K(t,e,r){if(Object.prototype.hasOwnProperty.call(t,e))return t[e];let n=r();return t[e]=n,n}function nbe(t,e,r){let{_proxy:n,_context:o,_subProxy:s,_descriptors:i}=t,a=n[e];return ua(a)&&i.isScriptable(e)&&(a=obe(e,a,t,r)),yr(a)&&a.length&&(a=sbe(e,a,t,i.isIndexable)),oO(e,a)&&(a=mp(a,o,s&&s[e],i)),a}function obe(t,e,r,n){let{_proxy:o,_context:s,_subProxy:i,_stack:a}=r;if(a.has(t))throw new Error("Recursion detected: "+Array.from(a).join("->")+"->"+t);return a.add(t),e=e(s,i||n),a.delete(t),oO(t,e)&&(e=sO(o._scopes,o,t,e)),e}function sbe(t,e,r,n){let{_proxy:o,_context:s,_subProxy:i,_descriptors:a}=r;if(ps(s.index)&&n(t))e=e[s.index%e.length];else if(dt(e[0])){let l=e,u=o._scopes.filter(c=>c!==l);e=[];for(let c of l){let p=sO(u,o,t,c);e.push(mp(p,s,i&&i[t],a))}}return e}function RK(t,e,r){return ua(t)?t(e,r):t}var ibe=(t,e)=>t===!0?e:typeof t=="string"?qg(e,t):void 0;function abe(t,e,r,n,o){for(let s of e){let i=ibe(r,s);if(i){t.add(i);let a=RK(i._fallback,r,o);if(ps(a)&&a!==r&&a!==n)return a}else if(i===!1&&ps(n)&&r!==n)return null}return!1}function sO(t,e,r,n){let o=e._rootScopes,s=RK(e._fallback,r,n),i=[...t,...o],a=new Set;a.add(n);let l=xK(a,i,r,s||r,n);return l===null||ps(s)&&s!==r&&(l=xK(a,i,s,l,n),l===null)?!1:uv(Array.from(a),[""],o,s,()=>lbe(e,r,n))}function xK(t,e,r,n,o){for(;r;)r=abe(t,e,r,n,o);return r}function lbe(t,e,r){let n=t._getTarget();e in n||(n[e]={});let o=n[e];return yr(o)&&dt(r)?r:o||{}}function ube(t,e,r,n){let o;for(let s of e)if(o=OK(rbe(s,t),r),ps(o))return oO(t,o)?sO(r,n,t,o):o}function OK(t,e){for(let r of e){if(!r)continue;let n=r[t];if(ps(n))return n}}function yK(t){let e=t._keys;return e||(e=t._keys=cbe(t._scopes)),e}function cbe(t){let e=new Set;for(let r of t)for(let n of Object.keys(r).filter(o=>!o.startsWith("_")))e.add(n);return Array.from(e)}var wQt=Number.EPSILON||1e-14;function EN(){return typeof window<"u"&&typeof document<"u"}function cv(t){let e=t.parentNode;return e&&e.toString()==="[object ShadowRoot]"&&(e=e.host),e}function uN(t,e,r){let n;return typeof t=="string"?(n=parseInt(t,10),t.indexOf("%")!==-1&&(n=n/100*e.parentNode[r])):n=t,n}var _N=t=>t.ownerDocument.defaultView.getComputedStyle(t,null);function FK(t,e){return _N(t).getPropertyValue(e)}var pbe=["top","right","bottom","left"];function cd(t,e,r){let n={};r=r?"-"+r:"";for(let o=0;o<4;o++){let s=pbe[o];n[s]=parseFloat(t[e+"-"+s+r])||0}return n.width=n.left+n.right,n.height=n.top+n.bottom,n}var fbe=(t,e,r)=>(t>0||e>0)&&(!r||!r.shadowRoot);function dbe(t,e){let r=t.touches,n=r&&r.length?r[0]:t,{offsetX:o,offsetY:s}=n,i=!1,a,l;if(fbe(o,s,t.target))a=o,l=s;else{let u=e.getBoundingClientRect();a=n.clientX-u.left,l=n.clientY-u.top,i=!0}return{x:a,y:l,box:i}}function iu(t,e){if("native"in t)return t;let{canvas:r,currentDevicePixelRatio:n}=e,o=_N(r),s=o.boxSizing==="border-box",i=cd(o,"padding"),a=cd(o,"border","width"),{x:l,y:u,box:c}=dbe(t,r),p=i.left+(c&&a.left),f=i.top+(c&&a.top),{width:d,height:m}=e;return s&&(d-=i.width+a.width,m-=i.height+a.height),{x:Math.round((l-p)/d*r.width/n),y:Math.round((u-f)/m*r.height/n)}}function mbe(t,e,r){let n,o;if(e===void 0||r===void 0){let s=cv(t);if(!s)e=t.clientWidth,r=t.clientHeight;else{let i=s.getBoundingClientRect(),a=_N(s),l=cd(a,"border","width"),u=cd(a,"padding");e=i.width-u.width-l.width,r=i.height-u.height-l.height,n=uN(a.maxWidth,s,"clientWidth"),o=uN(a.maxHeight,s,"clientHeight")}}return{width:e,height:r,maxWidth:n||tv,maxHeight:o||tv}}var iN=t=>Math.round(t*10)/10;function iO(t,e,r,n){let o=_N(t),s=cd(o,"margin"),i=uN(o.maxWidth,t,"clientWidth")||tv,a=uN(o.maxHeight,t,"clientHeight")||tv,l=mbe(t,e,r),{width:u,height:c}=l;if(o.boxSizing==="content-box"){let f=cd(o,"border","width"),d=cd(o,"padding");u-=d.width+f.width,c-=d.height+f.height}return u=Math.max(0,u-s.width),c=Math.max(0,n?Math.floor(u/n):c-s.height),u=iN(Math.min(u,i,l.maxWidth)),c=iN(Math.min(c,a,l.maxHeight)),u&&!c&&(c=iN(u/2)),(e!==void 0||r!==void 0)&&n&&l.height&&c>l.height&&(c=l.height,u=iN(Math.floor(c*n))),{width:u,height:c}}function AN(t,e,r){let n=e||1,o=Math.floor(t.height*n),s=Math.floor(t.width*n);t.height=o/n,t.width=s/n;let i=t.canvas;return i.style&&(r||!i.style.height&&!i.style.width)&&(i.style.height=`${t.height}px`,i.style.width=`${t.width}px`),t.currentDevicePixelRatio!==n||i.height!==o||i.width!==s?(t.currentDevicePixelRatio=n,i.height=o,i.width=s,t.ctx.setTransform(n,0,0,n,0,0),!0):!1}var aO=function(){let t=!1;try{let e={get passive(){return t=!0,!1}};window.addEventListener("test",null,e),window.removeEventListener("test",null,e)}catch{}return t}();function DN(t,e){let r=FK(t,e),n=r&&r.match(/^(\d+)(\.\d+)?px$/);return n?+n[1]:void 0}var hbe=function(t,e){return{x(r){return t+t+e-r},setWidth(r){e=r},textAlign(r){return r==="center"?r:r==="right"?"left":"right"},xPlus(r,n){return r-n},leftForLtr(r,n){return r-n}}},gbe=function(){return{x(t){return t},setWidth(t){},textAlign(t){return t},xPlus(t,e){return t+e},leftForLtr(t,e){return t}}};function pv(t,e,r){return t?hbe(e,r):gbe()}function lO(t,e){let r,n;(e==="ltr"||e==="rtl")&&(r=t.canvas.style,n=[r.getPropertyValue("direction"),r.getPropertyPriority("direction")],r.setProperty("direction",e,"important"),t.prevTextDirection=n)}function uO(t,e){e!==void 0&&(delete t.prevTextDirection,t.canvas.style.setProperty("direction",e[0],e[1]))}var hO=class{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(e,r,n,o){let s=r.listeners[o],i=r.duration;s.forEach(a=>a({chart:e,initial:r.initial,numSteps:i,currentStep:Math.min(n-r.start,i)}))}_refresh(){this._request||(this._running=!0,this._request=hN.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(e=Date.now()){let r=0;this._charts.forEach((n,o)=>{if(!n.running||!n.items.length)return;let s=n.items,i=s.length-1,a=!1,l;for(;i>=0;--i)l=s[i],l._active?(l._total>n.duration&&(n.duration=l._total),l.tick(e),a=!0):(s[i]=s[s.length-1],s.pop());a&&(o.draw(),this._notify(o,n,e,"progress")),s.length||(n.running=!1,this._notify(o,n,e,"complete"),n.initial=!1),r+=s.length}),this._lastDate=e,r===0&&(this._running=!1)}_getAnims(e){let r=this._charts,n=r.get(e);return n||(n={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},r.set(e,n)),n}listen(e,r,n){this._getAnims(e).listeners[r].push(n)}add(e,r){!r||!r.length||this._getAnims(e).items.push(...r)}has(e){return this._getAnims(e).items.length>0}start(e){let r=this._charts.get(e);!r||(r.running=!0,r.start=Date.now(),r.duration=r.items.reduce((n,o)=>Math.max(n,o._duration),0),this._refresh())}running(e){if(!this._running)return!1;let r=this._charts.get(e);return!(!r||!r.running||!r.items.length)}stop(e){let r=this._charts.get(e);if(!r||!r.items.length)return;let n=r.items,o=n.length-1;for(;o>=0;--o)n[o].cancel();r.items=[],this._notify(e,r,Date.now(),"complete")}remove(e){return this._charts.delete(e)}},au=new hO,PK="transparent",$be={boolean(t,e,r){return r>.5?e:t},color(t,e,r){let n=bN(t||PK),o=n.valid&&bN(e||PK);return o&&o.valid?o.mix(n,r).hexString():e},number(t,e,r){return t+(e-t)*r}},gO=class{constructor(e,r,n,o){let s=r[n];o=Qg([e.to,o,s,e.from]);let i=Qg([e.from,s,o]);this._active=!0,this._fn=e.fn||$be[e.type||typeof i],this._easing=yN[e.easing]||yN.linear,this._start=Math.floor(Date.now()+(e.delay||0)),this._duration=this._total=Math.floor(e.duration),this._loop=!!e.loop,this._target=r,this._prop=n,this._from=i,this._to=o,this._promises=void 0}active(){return this._active}update(e,r,n){if(this._active){this._notify(!1);let o=this._target[this._prop],s=n-this._start,i=this._duration-s;this._start=n,this._duration=Math.floor(Math.max(i,e.duration)),this._total+=s,this._loop=!!e.loop,this._to=Qg([e.to,r,o,e.from]),this._from=Qg([e.from,o,r])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(e){let r=e-this._start,n=this._duration,o=this._prop,s=this._from,i=this._loop,a=this._to,l;if(this._active=s!==a&&(i||r<n),!this._active){this._target[o]=a,this._notify(!0);return}if(r<0){this._target[o]=s;return}l=r/n%2,l=i&&l>1?2-l:l,l=this._easing(Math.min(1,Math.max(0,l))),this._target[o]=this._fn(s,a,l)}wait(){let e=this._promises||(this._promises=[]);return new Promise((r,n)=>{e.push({res:r,rej:n})})}_notify(e){let r=e?"res":"rej",n=this._promises||[];for(let o=0;o<n.length;o++)n[o][r]()}},WN=class{constructor(e,r){this._chart=e,this._properties=new Map,this.configure(r)}configure(e){if(!dt(e))return;let r=Object.keys(Vr.animation),n=this._properties;Object.getOwnPropertyNames(e).forEach(o=>{let s=e[o];if(!dt(s))return;let i={};for(let a of r)i[a]=s[a];(yr(s.properties)&&s.properties||[o]).forEach(a=>{(a===o||!n.has(a))&&n.set(a,i)})})}_animateOptions(e,r){let n=r.options,o=Obe(e,n);if(!o)return[];let s=this._createAnimations(o,n);return n.$shared&&Rbe(e.options.$animations,n).then(()=>{e.options=n},()=>{}),s}_createAnimations(e,r){let n=this._properties,o=[],s=e.$animations||(e.$animations={}),i=Object.keys(r),a=Date.now(),l;for(l=i.length-1;l>=0;--l){let u=i[l];if(u.charAt(0)==="$")continue;if(u==="options"){o.push(...this._animateOptions(e,r));continue}let c=r[u],p=s[u],f=n.get(u);if(p)if(f&&p.active()){p.update(f,c,a);continue}else p.cancel();if(!f||!f.duration){e[u]=c;continue}s[u]=p=new gO(f,e,u,c),o.push(p)}return o}update(e,r){if(this._properties.size===0){Object.assign(e,r);return}let n=this._createAnimations(e,r);if(n.length)return au.add(this._chart,n),!0}};function Rbe(t,e){let r=[],n=Object.keys(e);for(let o=0;o<n.length;o++){let s=t[n[o]];s&&s.active()&&r.push(s.wait())}return Promise.all(r)}function Obe(t,e){if(!e)return;let r=t.options;if(!r){t.options=e;return}return r.$shared&&(t.options=r=Object.assign({},r,{$shared:!1,$animations:{}})),r}function LK(t,e){let r=t&&t.options||{},n=r.reverse,o=r.min===void 0?e:0,s=r.max===void 0?e:0;return{start:n?s:o,end:n?o:s}}function Fbe(t,e,r){if(r===!1)return!1;let n=LK(t,r),o=LK(e,r);return{top:o.end,right:n.end,bottom:o.start,left:n.start}}function Pbe(t){let e,r,n,o;return dt(t)?(e=t.top,r=t.right,n=t.bottom,o=t.left):e=r=n=o=t,{top:e,right:r,bottom:n,left:o,disabled:t===!1}}function bX(t,e){let r=[],n=t._getSortedDatasetMetas(e),o,s;for(o=0,s=n.length;o<s;++o)r.push(n[o].index);return r}function MK(t,e,r,n={}){let o=t.keys,s=n.mode==="single",i,a,l,u;if(e!==null){for(i=0,a=o.length;i<a;++i){if(l=+o[i],l===r){if(n.all)continue;break}u=t.values[l],Qr(u)&&(s||e===0||jg(e)===jg(u))&&(e+=u)}return e}}function Lbe(t){let e=Object.keys(t),r=new Array(e.length),n,o,s;for(n=0,o=e.length;n<o;++n)s=e[n],r[n]={x:s,y:t[s]};return r}function zK(t,e){let r=t&&t.options.stacked;return r||r===void 0&&e.stack!==void 0}function Mbe(t,e,r){return`${t.id}.${e.id}.${r.stack||r.type}`}function zbe(t){let{min:e,max:r,minDefined:n,maxDefined:o}=t.getUserBounds();return{min:n?e:Number.NEGATIVE_INFINITY,max:o?r:Number.POSITIVE_INFINITY}}function Bbe(t,e,r){let n=t[e]||(t[e]={});return n[r]||(n[r]={})}function BK(t,e,r,n){for(let o of e.getMatchingVisibleMetas(n).reverse()){let s=t[o.index];if(r&&s>0||!r&&s<0)return o.index}return null}function VK(t,e){let{chart:r,_cachedMeta:n}=t,o=r._stacks||(r._stacks={}),{iScale:s,vScale:i,index:a}=n,l=s.axis,u=i.axis,c=Mbe(s,i,n),p=e.length,f;for(let d=0;d<p;++d){let m=e[d],{[l]:h,[u]:g}=m,x=m._stacks||(m._stacks={});f=x[u]=Bbe(o,c,h),f[a]=g,f._top=BK(f,i,!0,n.type),f._bottom=BK(f,i,!1,n.type)}}function cO(t,e){let r=t.scales;return Object.keys(r).filter(n=>r[n].axis===e).shift()}function Vbe(t,e){return su(t,{active:!1,dataset:void 0,datasetIndex:e,index:e,mode:"default",type:"dataset"})}function Wbe(t,e,r){return su(t,{active:!1,dataIndex:e,parsed:void 0,raw:void 0,element:r,index:e,mode:"default",type:"data"})}function fv(t,e){let r=t.controller.index,n=t.vScale&&t.vScale.axis;if(!!n){e=e||t._parsed;for(let o of e){let s=o._stacks;if(!s||s[n]===void 0||s[n][r]===void 0)return;delete s[n][r]}}}var pO=t=>t==="reset"||t==="none",WK=(t,e)=>e?t:Object.assign({},t),Gbe=(t,e,r)=>t&&!e.hidden&&e._stacked&&{keys:bX(r,!0),values:null},gp=class{constructor(e,r){this.chart=e,this._ctx=e.ctx,this.index=r,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){let e=this._cachedMeta;this.configure(),this.linkScales(),e._stacked=zK(e.vScale,e),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(e){this.index!==e&&fv(this._cachedMeta),this.index=e}linkScales(){let e=this.chart,r=this._cachedMeta,n=this.getDataset(),o=(p,f,d,m)=>p==="x"?f:p==="r"?m:d,s=r.xAxisID=xr(n.xAxisID,cO(e,"x")),i=r.yAxisID=xr(n.yAxisID,cO(e,"y")),a=r.rAxisID=xr(n.rAxisID,cO(e,"r")),l=r.indexAxis,u=r.iAxisID=o(l,s,i,a),c=r.vAxisID=o(l,i,s,a);r.xScale=this.getScaleForId(s),r.yScale=this.getScaleForId(i),r.rScale=this.getScaleForId(a),r.iScale=this.getScaleForId(u),r.vScale=this.getScaleForId(c)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(e){return this.chart.scales[e]}_getOtherScale(e){let r=this._cachedMeta;return e===r.iScale?r.vScale:r.iScale}reset(){this._update("reset")}_destroy(){let e=this._cachedMeta;this._data&&mN(this._data,this),e._stacked&&fv(e)}_dataCheck(){let e=this.getDataset(),r=e.data||(e.data=[]),n=this._data;if(dt(r))this._data=Lbe(r);else if(n!==r){if(n){mN(n,this);let o=this._cachedMeta;fv(o),o._parsed=[]}r&&Object.isExtensible(r)&&qR(r,this),this._syncList=[],this._data=r}}addElements(){let e=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(e.dataset=new this.datasetElementType)}buildOrUpdateElements(e){let r=this._cachedMeta,n=this.getDataset(),o=!1;this._dataCheck();let s=r._stacked;r._stacked=zK(r.vScale,r),r.stack!==n.stack&&(o=!0,fv(r),r.stack=n.stack),this._resyncElements(e),(o||s!==r._stacked)&&VK(this,r._parsed)}configure(){let e=this.chart.config,r=e.datasetScopeKeys(this._type),n=e.getOptionScopes(this.getDataset(),r,!0);this.options=e.createResolver(n,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(e,r){let{_cachedMeta:n,_data:o}=this,{iScale:s,_stacked:i}=n,a=s.axis,l=e===0&&r===o.length?!0:n._sorted,u=e>0&&n._parsed[e-1],c,p,f;if(this._parsing===!1)n._parsed=o,n._sorted=!0,f=o;else{yr(o[e])?f=this.parseArrayData(n,o,e,r):dt(o[e])?f=this.parseObjectData(n,o,e,r):f=this.parsePrimitiveData(n,o,e,r);let d=()=>p[a]===null||u&&p[a]<u[a];for(c=0;c<r;++c)n._parsed[c+e]=p=f[c],l&&(d()&&(l=!1),u=p);n._sorted=l}i&&VK(this,f)}parsePrimitiveData(e,r,n,o){let{iScale:s,vScale:i}=e,a=s.axis,l=i.axis,u=s.getLabels(),c=s===i,p=new Array(o),f,d,m;for(f=0,d=o;f<d;++f)m=f+n,p[f]={[a]:c||s.parse(u[m],m),[l]:i.parse(r[m],m)};return p}parseArrayData(e,r,n,o){let{xScale:s,yScale:i}=e,a=new Array(o),l,u,c,p;for(l=0,u=o;l<u;++l)c=l+n,p=r[c],a[l]={x:s.parse(p[0],c),y:i.parse(p[1],c)};return a}parseObjectData(e,r,n,o){let{xScale:s,yScale:i}=e,{xAxisKey:a="x",yAxisKey:l="y"}=this._parsing,u=new Array(o),c,p,f,d;for(c=0,p=o;c<p;++c)f=c+n,d=r[f],u[c]={x:s.parse(qg(d,a),f),y:i.parse(qg(d,l),f)};return u}getParsed(e){return this._cachedMeta._parsed[e]}getDataElement(e){return this._cachedMeta.data[e]}applyStack(e,r,n){let o=this.chart,s=this._cachedMeta,i=r[e.axis],a={keys:bX(o,!0),values:r._stacks[e.axis]};return MK(a,i,s.index,{mode:n})}updateRangeFromParsed(e,r,n,o){let s=n[r.axis],i=s===null?NaN:s,a=o&&n._stacks[r.axis];o&&a&&(o.values=a,i=MK(o,s,this._cachedMeta.index)),e.min=Math.min(e.min,i),e.max=Math.max(e.max,i)}getMinMax(e,r){let n=this._cachedMeta,o=n._parsed,s=n._sorted&&e===n.iScale,i=o.length,a=this._getOtherScale(e),l=Gbe(r,n,this.chart),u={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:c,max:p}=zbe(a),f,d;function m(){d=o[f];let h=d[a.axis];return!Qr(d[e.axis])||c>h||p<h}for(f=0;f<i&&!(!m()&&(this.updateRangeFromParsed(u,e,d,l),s));++f);if(s){for(f=i-1;f>=0;--f)if(!m()){this.updateRangeFromParsed(u,e,d,l);break}}return u}getAllParsedValues(e){let r=this._cachedMeta._parsed,n=[],o,s,i;for(o=0,s=r.length;o<s;++o)i=r[o][e.axis],Qr(i)&&n.push(i);return n}getMaxOverflow(){return!1}getLabelAndValue(e){let r=this._cachedMeta,n=r.iScale,o=r.vScale,s=this.getParsed(e);return{label:n?""+n.getLabelForValue(s[n.axis]):"",value:o?""+o.getLabelForValue(s[o.axis]):""}}_update(e){let r=this._cachedMeta;this.update(e||"default"),r._clip=Pbe(xr(this.options.clip,Fbe(r.xScale,r.yScale,this.getMaxOverflow())))}update(e){}draw(){let e=this._ctx,r=this.chart,n=this._cachedMeta,o=n.data||[],s=r.chartArea,i=[],a=this._drawStart||0,l=this._drawCount||o.length-a,u=this.options.drawActiveElementsOnTop,c;for(n.dataset&&n.dataset.draw(e,s,a,l),c=a;c<a+l;++c){let p=o[c];p.hidden||(p.active&&u?i.push(p):p.draw(e,s))}for(c=0;c<i.length;++c)i[c].draw(e,s)}getStyle(e,r){let n=r?"active":"default";return e===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(n):this.resolveDataElementOptions(e||0,n)}getContext(e,r,n){let o=this.getDataset(),s;if(e>=0&&e<this._cachedMeta.data.length){let i=this._cachedMeta.data[e];s=i.$context||(i.$context=Wbe(this.getContext(),e,i)),s.parsed=this.getParsed(e),s.raw=o.data[e],s.index=s.dataIndex=e}else s=this.$context||(this.$context=Vbe(this.chart.getContext(),this.index)),s.dataset=o,s.index=s.datasetIndex=this.index;return s.active=!!r,s.mode=n,s}resolveDatasetElementOptions(e){return this._resolveElementOptions(this.datasetElementType.id,e)}resolveDataElementOptions(e,r){return this._resolveElementOptions(this.dataElementType.id,r,e)}_resolveElementOptions(e,r="default",n){let o=r==="active",s=this._cachedDataOpts,i=e+"-"+r,a=s[i],l=this.enableOptionSharing&&ps(n);if(a)return WK(a,l);let u=this.chart.config,c=u.datasetElementScopeKeys(this._type,e),p=o?[`${e}Hover`,"hover",e,""]:[e,""],f=u.getOptionScopes(this.getDataset(),c),d=Object.keys(Vr.elements[e]),m=()=>this.getContext(n,o),h=u.resolveNamedOptions(f,d,m,p);return h.$shared&&(h.$shared=l,s[i]=Object.freeze(WK(h,l))),h}_resolveAnimations(e,r,n){let o=this.chart,s=this._cachedDataOpts,i=`animation-${r}`,a=s[i];if(a)return a;let l;if(o.options.animation!==!1){let c=this.chart.config,p=c.datasetAnimationScopeKeys(this._type,r),f=c.getOptionScopes(this.getDataset(),p);l=c.createResolver(f,this.getContext(e,n,r))}let u=new WN(o,l&&l.animations);return l&&l._cacheable&&(s[i]=Object.freeze(u)),u}getSharedOptions(e){if(!!e.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},e))}includeOptions(e,r){return!r||pO(e)||this.chart._animationsDisabled}_getSharedOptions(e,r){let n=this.resolveDataElementOptions(e,r),o=this._sharedOptions,s=this.getSharedOptions(n),i=this.includeOptions(r,s)||s!==o;return this.updateSharedOptions(s,r,n),{sharedOptions:s,includeOptions:i}}updateElement(e,r,n,o){pO(o)?Object.assign(e,n):this._resolveAnimations(r,o).update(e,n)}updateSharedOptions(e,r,n){e&&!pO(r)&&this._resolveAnimations(void 0,r).update(e,n)}_setStyle(e,r,n,o){e.active=o;let s=this.getStyle(r,o);this._resolveAnimations(r,n,o).update(e,{options:!o&&this.getSharedOptions(s)||s})}removeHoverStyle(e,r,n){this._setStyle(e,n,"active",!1)}setHoverStyle(e,r,n){this._setStyle(e,n,"active",!0)}_removeDatasetHoverStyle(){let e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!1)}_setDatasetHoverStyle(){let e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!0)}_resyncElements(e){let r=this._data,n=this._cachedMeta.data;for(let[a,l,u]of this._syncList)this[a](l,u);this._syncList=[];let o=n.length,s=r.length,i=Math.min(s,o);i&&this.parse(0,i),s>o?this._insertElements(o,s-o,e):s<o&&this._removeElements(s,o-s)}_insertElements(e,r,n=!0){let o=this._cachedMeta,s=o.data,i=e+r,a,l=u=>{for(u.length+=r,a=u.length-1;a>=i;a--)u[a]=u[a-r]};for(l(s),a=e;a<i;++a)s[a]=new this.dataElementType;this._parsing&&l(o._parsed),this.parse(e,r),n&&this.updateElements(s,e,r,"reset")}updateElements(e,r,n,o){}_removeElements(e,r){let n=this._cachedMeta;if(this._parsing){let o=n._parsed.splice(e,r);n._stacked&&fv(n,o)}n.data.splice(e,r)}_sync(e){if(this._parsing)this._syncList.push(e);else{let[r,n,o]=e;this[r](n,o)}this.chart._dataChanges.push([this.index,...e])}_onDataPush(){let e=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-e,e])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(e,r){r&&this._sync(["_removeElements",e,r]);let n=arguments.length-2;n&&this._sync(["_insertElements",e,n])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}};zt(gp,"defaults",{}),zt(gp,"datasetElementType",null),zt(gp,"dataElementType",null);function dd(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}var vv=class{static override(e){Object.assign(vv.prototype,e)}constructor(e){this.options=e||{}}init(){}formats(){return dd()}parse(){return dd()}format(){return dd()}add(){return dd()}diff(){return dd()}startOf(){return dd()}endOf(){return dd()}},Ube={_date:vv};function Hbe(t,e,r,n){let{controller:o,data:s,_sorted:i}=t,a=o._cachedMeta.iScale;if(a&&e===a.axis&&e!=="r"&&i&&s.length){let l=a._reversePixels?UR:sv;if(n){if(o._sharedOptions){let u=s[0],c=typeof u.getRange=="function"&&u.getRange(e);if(c){let p=l(s,e,r-c),f=l(s,e,r+c);return{lo:p.lo,hi:f.hi}}}}else return l(s,e,r)}return{lo:0,hi:s.length-1}}function Sv(t,e,r,n,o){let s=t.getSortedVisibleDatasetMetas(),i=r[e];for(let a=0,l=s.length;a<l;++a){let{index:u,data:c}=s[a],{lo:p,hi:f}=Hbe(s[a],e,i,o);for(let d=p;d<=f;++d){let m=c[d];m.skip||n(m,u,d)}}}function qbe(t){let e=t.indexOf("x")!==-1,r=t.indexOf("y")!==-1;return function(n,o){let s=e?Math.abs(n.x-o.x):0,i=r?Math.abs(n.y-o.y):0;return Math.sqrt(Math.pow(s,2)+Math.pow(i,2))}}function fO(t,e,r,n,o){let s=[];return!o&&!t.isPointInArea(e)||Sv(t,r,e,function(a,l,u){!o&&!SN(a,t.chartArea,0)||a.inRange(e.x,e.y,n)&&s.push({element:a,datasetIndex:l,index:u})},!0),s}function jbe(t,e,r,n){let o=[];function s(i,a,l){let{startAngle:u,endAngle:c}=i.getProps(["startAngle","endAngle"],n),{angle:p}=BR(i,{x:e.x,y:e.y});WR(p,u,c)&&o.push({element:i,datasetIndex:a,index:l})}return Sv(t,r,e,s),o}function Kbe(t,e,r,n,o,s){let i=[],a=qbe(r),l=Number.POSITIVE_INFINITY;function u(c,p,f){let d=c.inRange(e.x,e.y,o);if(n&&!d)return;let m=c.getCenterPoint(o);if(!(!!s||t.isPointInArea(m))&&!d)return;let g=a(e,m);g<l?(i=[{element:c,datasetIndex:p,index:f}],l=g):g===l&&i.push({element:c,datasetIndex:p,index:f})}return Sv(t,r,e,u),i}function dO(t,e,r,n,o,s){return!s&&!t.isPointInArea(e)?[]:r==="r"&&!n?jbe(t,e,r,o):Kbe(t,e,r,n,o,s)}function GK(t,e,r,n,o){let s=[],i=r==="x"?"inXRange":"inYRange",a=!1;return Sv(t,r,e,(l,u,c)=>{l[i](e[r],o)&&(s.push({element:l,datasetIndex:u,index:c}),a=a||l.inRange(e.x,e.y,o))}),n&&!a?[]:s}var Xbe={evaluateInteractionItems:Sv,modes:{index(t,e,r,n){let o=iu(e,t),s=r.axis||"x",i=r.includeInvisible||!1,a=r.intersect?fO(t,o,s,n,i):dO(t,o,s,!1,n,i),l=[];return a.length?(t.getSortedVisibleDatasetMetas().forEach(u=>{let c=a[0].index,p=u.data[c];p&&!p.skip&&l.push({element:p,datasetIndex:u.index,index:c})}),l):[]},dataset(t,e,r,n){let o=iu(e,t),s=r.axis||"xy",i=r.includeInvisible||!1,a=r.intersect?fO(t,o,s,n,i):dO(t,o,s,!1,n,i);if(a.length>0){let l=a[0].datasetIndex,u=t.getDatasetMeta(l).data;a=[];for(let c=0;c<u.length;++c)a.push({element:u[c],datasetIndex:l,index:c})}return a},point(t,e,r,n){let o=iu(e,t),s=r.axis||"xy",i=r.includeInvisible||!1;return fO(t,o,s,n,i)},nearest(t,e,r,n){let o=iu(e,t),s=r.axis||"xy",i=r.includeInvisible||!1;return dO(t,o,s,r.intersect,n,i)},x(t,e,r,n){let o=iu(e,t);return GK(t,o,"x",r.intersect,n)},y(t,e,r,n){let o=iu(e,t);return GK(t,o,"y",r.intersect,n)}}},vX=["left","top","right","bottom"];function dv(t,e){return t.filter(r=>r.pos===e)}function UK(t,e){return t.filter(r=>vX.indexOf(r.pos)===-1&&r.box.axis===e)}function mv(t,e){return t.sort((r,n)=>{let o=e?n:r,s=e?r:n;return o.weight===s.weight?o.index-s.index:o.weight-s.weight})}function Ybe(t){let e=[],r,n,o,s,i,a;for(r=0,n=(t||[]).length;r<n;++r)o=t[r],{position:s,options:{stack:i,stackWeight:a=1}}=o,e.push({index:r,box:o,pos:s,horizontal:o.isHorizontal(),weight:o.weight,stack:i&&s+i,stackWeight:a});return e}function Qbe(t){let e={};for(let r of t){let{stack:n,pos:o,stackWeight:s}=r;if(!n||!vX.includes(o))continue;let i=e[n]||(e[n]={count:0,placed:0,weight:0,size:0});i.count++,i.weight+=s}return e}function Zbe(t,e){let r=Qbe(t),{vBoxMaxWidth:n,hBoxMaxHeight:o}=e,s,i,a;for(s=0,i=t.length;s<i;++s){a=t[s];let{fullSize:l}=a.box,u=r[a.stack],c=u&&a.stackWeight/u.weight;a.horizontal?(a.width=c?c*n:l&&e.availableWidth,a.height=o):(a.width=n,a.height=c?c*o:l&&e.availableHeight)}return r}function Jbe(t){let e=Ybe(t),r=mv(e.filter(u=>u.box.fullSize),!0),n=mv(dv(e,"left"),!0),o=mv(dv(e,"right")),s=mv(dv(e,"top"),!0),i=mv(dv(e,"bottom")),a=UK(e,"x"),l=UK(e,"y");return{fullSize:r,leftAndTop:n.concat(s),rightAndBottom:o.concat(l).concat(i).concat(a),chartArea:dv(e,"chartArea"),vertical:n.concat(o).concat(l),horizontal:s.concat(i).concat(a)}}function HK(t,e,r,n){return Math.max(t[r],e[r])+Math.max(t[n],e[n])}function wX(t,e){t.top=Math.max(t.top,e.top),t.left=Math.max(t.left,e.left),t.bottom=Math.max(t.bottom,e.bottom),t.right=Math.max(t.right,e.right)}function eve(t,e,r,n){let{pos:o,box:s}=r,i=t.maxPadding;if(!dt(o)){r.size&&(t[o]-=r.size);let p=n[r.stack]||{size:0,count:1};p.size=Math.max(p.size,r.horizontal?s.height:s.width),r.size=p.size/p.count,t[o]+=r.size}s.getPadding&&wX(i,s.getPadding());let a=Math.max(0,e.outerWidth-HK(i,t,"left","right")),l=Math.max(0,e.outerHeight-HK(i,t,"top","bottom")),u=a!==t.w,c=l!==t.h;return t.w=a,t.h=l,r.horizontal?{same:u,other:c}:{same:c,other:u}}function tve(t){let e=t.maxPadding;function r(n){let o=Math.max(e[n]-t[n],0);return t[n]+=o,o}t.y+=r("top"),t.x+=r("left"),r("right"),r("bottom")}function rve(t,e){let r=e.maxPadding;function n(o){let s={left:0,top:0,right:0,bottom:0};return o.forEach(i=>{s[i]=Math.max(e[i],r[i])}),s}return n(t?["left","right"]:["top","bottom"])}function xv(t,e,r,n){let o=[],s,i,a,l,u,c;for(s=0,i=t.length,u=0;s<i;++s){a=t[s],l=a.box,l.update(a.width||e.w,a.height||e.h,rve(a.horizontal,e));let{same:p,other:f}=eve(e,r,a,n);u|=p&&o.length,c=c||f,l.fullSize||o.push(a)}return u&&xv(o,e,r,n)||c}function $N(t,e,r,n,o){t.top=r,t.left=e,t.right=e+n,t.bottom=r+o,t.width=n,t.height=o}function qK(t,e,r,n){let o=r.padding,{x:s,y:i}=e;for(let a of t){let l=a.box,u=n[a.stack]||{count:1,placed:0,weight:1},c=a.stackWeight/u.weight||1;if(a.horizontal){let p=e.w*c,f=u.size||l.height;ps(u.start)&&(i=u.start),l.fullSize?$N(l,o.left,i,r.outerWidth-o.right-o.left,f):$N(l,e.left+u.placed,i,p,f),u.start=i,u.placed+=p,i=l.bottom}else{let p=e.h*c,f=u.size||l.width;ps(u.start)&&(s=u.start),l.fullSize?$N(l,s,o.top,f,r.outerHeight-o.bottom-o.top):$N(l,s,e.top+u.placed,f,p),u.start=s,u.placed+=p,s=l.right}}e.x=s,e.y=i}var RN={addBox(t,e){t.boxes||(t.boxes=[]),e.fullSize=e.fullSize||!1,e.position=e.position||"top",e.weight=e.weight||0,e._layers=e._layers||function(){return[{z:0,draw(r){e.draw(r)}}]},t.boxes.push(e)},removeBox(t,e){let r=t.boxes?t.boxes.indexOf(e):-1;r!==-1&&t.boxes.splice(r,1)},configure(t,e,r){e.fullSize=r.fullSize,e.position=r.position,e.weight=r.weight},update(t,e,r,n){if(!t)return;let o=Vo(t.options.layout.padding),s=Math.max(e-o.width,0),i=Math.max(r-o.height,0),a=Jbe(t.boxes),l=a.vertical,u=a.horizontal;At(t.boxes,h=>{typeof h.beforeLayout=="function"&&h.beforeLayout()});let c=l.reduce((h,g)=>g.box.options&&g.box.options.display===!1?h:h+1,0)||1,p=Object.freeze({outerWidth:e,outerHeight:r,padding:o,availableWidth:s,availableHeight:i,vBoxMaxWidth:s/2/c,hBoxMaxHeight:i/2}),f=Object.assign({},o);wX(f,Vo(n));let d=Object.assign({maxPadding:f,w:s,h:i,x:o.left,y:o.top},o),m=Zbe(l.concat(u),p);xv(a.fullSize,d,p,m),xv(l,d,p,m),xv(u,d,p,m)&&xv(l,d,p,m),tve(d),qK(a.leftAndTop,d,p,m),d.x+=d.w,d.y+=d.h,qK(a.rightAndBottom,d,p,m),t.chartArea={left:d.left,top:d.top,right:d.left+d.w,bottom:d.top+d.h,height:d.h,width:d.w},At(a.chartArea,h=>{let g=h.box;Object.assign(g,t.chartArea),g.update(d.w,d.h,{left:0,top:0,right:0,bottom:0})})}},GN=class{acquireContext(e,r){}releaseContext(e){return!1}addEventListener(e,r,n){}removeEventListener(e,r,n){}getDevicePixelRatio(){return 1}getMaximumSize(e,r,n,o){return r=Math.max(0,r||e.width),n=n||e.height,{width:r,height:Math.max(0,o?Math.floor(r/o):n)}}isAttached(e){return!0}updateConfig(e){}},xO=class extends GN{acquireContext(e){return e&&e.getContext&&e.getContext("2d")||null}updateConfig(e){e.options.animation=!1}},BN="$chartjs",nve={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},jK=t=>t===null||t==="";function ove(t,e){let r=t.style,n=t.getAttribute("height"),o=t.getAttribute("width");if(t[BN]={initial:{height:n,width:o,style:{display:r.display,height:r.height,width:r.width}}},r.display=r.display||"block",r.boxSizing=r.boxSizing||"border-box",jK(o)){let s=DN(t,"width");s!==void 0&&(t.width=s)}if(jK(n))if(t.style.height==="")t.height=t.width/(e||2);else{let s=DN(t,"height");s!==void 0&&(t.height=s)}return t}var CX=aO?{passive:!0}:!1;function sve(t,e,r){t.addEventListener(e,r,CX)}function ive(t,e,r){t.canvas.removeEventListener(e,r,CX)}function ave(t,e){let r=nve[t.type]||t.type,{x:n,y:o}=iu(t,e);return{type:r,chart:e,native:t,x:n!==void 0?n:null,y:o!==void 0?o:null}}function UN(t,e){for(let r of t)if(r===e||r.contains(e))return!0}function lve(t,e,r){let n=t.canvas,o=new MutationObserver(s=>{let i=!1;for(let a of s)i=i||UN(a.addedNodes,n),i=i&&!UN(a.removedNodes,n);i&&r()});return o.observe(document,{childList:!0,subtree:!0}),o}function uve(t,e,r){let n=t.canvas,o=new MutationObserver(s=>{let i=!1;for(let a of s)i=i||UN(a.removedNodes,n),i=i&&!UN(a.addedNodes,n);i&&r()});return o.observe(document,{childList:!0,subtree:!0}),o}var wv=new Map,KK=0;function SX(){let t=window.devicePixelRatio;t!==KK&&(KK=t,wv.forEach((e,r)=>{r.currentDevicePixelRatio!==t&&e()}))}function cve(t,e){wv.size||window.addEventListener("resize",SX),wv.set(t,e)}function pve(t){wv.delete(t),wv.size||window.removeEventListener("resize",SX)}function fve(t,e,r){let n=t.canvas,o=n&&cv(n);if(!o)return;let s=gN((a,l)=>{let u=o.clientWidth;r(a,l),u<o.clientWidth&&r()},window),i=new ResizeObserver(a=>{let l=a[0],u=l.contentRect.width,c=l.contentRect.height;u===0&&c===0||s(u,c)});return i.observe(o),cve(t,s),i}function mO(t,e,r){r&&r.disconnect(),e==="resize"&&pve(t)}function dve(t,e,r){let n=t.canvas,o=gN(s=>{t.ctx!==null&&r(ave(s,t))},t);return sve(n,e,o),o}var yO=class extends GN{acquireContext(e,r){let n=e&&e.getContext&&e.getContext("2d");return n&&n.canvas===e?(ove(e,r),n):null}releaseContext(e){let r=e.canvas;if(!r[BN])return!1;let n=r[BN].initial;["height","width"].forEach(s=>{let i=n[s];nr(i)?r.removeAttribute(s):r.setAttribute(s,i)});let o=n.style||{};return Object.keys(o).forEach(s=>{r.style[s]=o[s]}),r.width=r.width,delete r[BN],!0}addEventListener(e,r,n){this.removeEventListener(e,r);let o=e.$proxies||(e.$proxies={}),i={attach:lve,detach:uve,resize:fve}[r]||dve;o[r]=i(e,r,n)}removeEventListener(e,r){let n=e.$proxies||(e.$proxies={}),o=n[r];if(!o)return;({attach:mO,detach:mO,resize:mO}[r]||ive)(e,r,o),n[r]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(e,r,n,o){return iO(e,r,n,o)}isAttached(e){let r=cv(e);return!!(r&&r.isConnected)}};function mve(t){return!EN()||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas?xO:yO}var uu=class{constructor(){zt(this,"active",!1)}tooltipPosition(e){let{x:r,y:n}=this.getProps(["x","y"],e);return{x:r,y:n}}hasValue(){return Xg(this.x)&&Xg(this.y)}getProps(e,r){let n=this.$animations;if(!r||!n)return this;let o={};return e.forEach(s=>{o[s]=n[s]&&n[s].active()?n[s]._to:this[s]}),o}};zt(uu,"defaults",{}),zt(uu,"defaultRoutes");function hve(t,e){let r=t.options.ticks,n=gve(t),o=Math.min(r.maxTicksLimit||n,n),s=r.major.enabled?yve(e):[],i=s.length,a=s[0],l=s[i-1],u=[];if(i>o)return bve(e,u,s,i/o),u;let c=xve(s,e,o);if(i>0){let p,f,d=i>1?Math.round((l-a)/(i-1)):null;for(ON(e,u,c,nr(d)?0:a-d,a),p=0,f=i-1;p<f;p++)ON(e,u,c,s[p],s[p+1]);return ON(e,u,c,l,nr(d)?e.length:l+d),u}return ON(e,u,c),u}function gve(t){let e=t.options.offset,r=t._tickSize(),n=t._length/r+(e?0:1),o=t._maxLength/r;return Math.floor(Math.min(n,o))}function xve(t,e,r){let n=vve(t),o=e.length/r;if(!n)return Math.max(o,1);let s=MR(n);for(let i=0,a=s.length-1;i<a;i++){let l=s[i];if(l>o)return l}return Math.max(o,1)}function yve(t){let e=[],r,n;for(r=0,n=t.length;r<n;r++)t[r].major&&e.push(r);return e}function bve(t,e,r,n){let o=0,s=r[0],i;for(n=Math.ceil(n),i=0;i<t.length;i++)i===s&&(e.push(t[i]),o++,s=r[o*n])}function ON(t,e,r,n,o){let s=xr(n,0),i=Math.min(xr(o,t.length),t.length),a=0,l,u,c;for(r=Math.ceil(r),o&&(l=o-n,r=l/Math.floor(l/r)),c=s;c<0;)a++,c=Math.round(s+a*r);for(u=Math.max(s,0);u<i;u++)u===c&&(e.push(t[u]),a++,c=Math.round(s+a*r))}function vve(t){let e=t.length,r,n;if(e<2)return!1;for(n=t[0],r=1;r<e;++r)if(t[r]-t[r-1]!==n)return!1;return n}var wve=t=>t==="left"?"right":t==="right"?"left":t,XK=(t,e,r)=>e==="top"||e==="left"?t[e]+r:t[e]-r;function YK(t,e){let r=[],n=t.length/e,o=t.length,s=0;for(;s<o;s+=n)r.push(t[Math.floor(s)]);return r}function Cve(t,e,r){let n=t.ticks.length,o=Math.min(e,n-1),s=t._startPixel,i=t._endPixel,a=1e-6,l=t.getPixelForTick(o),u;if(!(r&&(n===1?u=Math.max(l-s,i-l):e===0?u=(t.getPixelForTick(1)-l)/2:u=(l-t.getPixelForTick(o-1))/2,l+=o<e?u:-u,l<s-a||l>i+a)))return l}function Sve(t,e){At(t,r=>{let n=r.gc,o=n.length/2,s;if(o>e){for(s=0;s<o;++s)delete r.data[n[s]];n.splice(0,o)}})}function hv(t){return t.drawTicks?t.tickLength:0}function QK(t,e){if(!t.display)return 0;let r=bo(t.font,e),n=Vo(t.padding);return(yr(t.text)?t.text.length:1)*r.lineHeight+n.height}function kve(t,e){return su(t,{scale:e,type:"scale"})}function Tve(t,e,r){return su(t,{tick:r,index:e,type:"tick"})}function Nve(t,e,r){let n=XR(t);return(r&&e!=="right"||!r&&e==="right")&&(n=wve(n)),n}function Ive(t,e,r,n){let{top:o,left:s,bottom:i,right:a,chart:l}=t,{chartArea:u,scales:c}=l,p=0,f,d,m,h=i-o,g=a-s;if(t.isHorizontal()){if(d=xN(n,s,a),dt(r)){let x=Object.keys(r)[0],y=r[x];m=c[x].getPixelForValue(y)+h-e}else r==="center"?m=(u.bottom+u.top)/2+h-e:m=XK(t,r,e);f=a-s}else{if(dt(r)){let x=Object.keys(r)[0],y=r[x];d=c[x].getPixelForValue(y)-g+e}else r==="center"?d=(u.left+u.right)/2-g+e:d=XK(t,r,e);m=xN(n,i,o),p=r==="left"?-oo:oo}return{titleX:d,titleY:m,maxWidth:f,rotation:p}}var cu=class extends uu{constructor(e){super(),this.id=e.id,this.type=e.type,this.options=void 0,this.ctx=e.ctx,this.chart=e.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(e){this.options=e.setContext(this.getContext()),this.axis=e.axis,this._userMin=this.parse(e.min),this._userMax=this.parse(e.max),this._suggestedMin=this.parse(e.suggestedMin),this._suggestedMax=this.parse(e.suggestedMax)}parse(e,r){return e}getUserBounds(){let{_userMin:e,_userMax:r,_suggestedMin:n,_suggestedMax:o}=this;return e=yo(e,Number.POSITIVE_INFINITY),r=yo(r,Number.NEGATIVE_INFINITY),n=yo(n,Number.POSITIVE_INFINITY),o=yo(o,Number.NEGATIVE_INFINITY),{min:yo(e,n),max:yo(r,o),minDefined:Qr(e),maxDefined:Qr(r)}}getMinMax(e){let{min:r,max:n,minDefined:o,maxDefined:s}=this.getUserBounds(),i;if(o&&s)return{min:r,max:n};let a=this.getMatchingVisibleMetas();for(let l=0,u=a.length;l<u;++l)i=a[l].controller.getMinMax(this,e),o||(r=Math.min(r,i.min)),s||(n=Math.max(n,i.max));return r=s&&r>n?n:r,n=o&&r>n?r:n,{min:yo(r,yo(n,r)),max:yo(n,yo(r,n))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){let e=this.chart.data;return this.options.labels||(this.isHorizontal()?e.xLabels:e.yLabels)||e.labels||[]}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){br(this.options.beforeUpdate,[this])}update(e,r,n){let{beginAtZero:o,grace:s,ticks:i}=this.options,a=i.sampleSize;this.beforeUpdate(),this.maxWidth=e,this.maxHeight=r,this._margins=n=Object.assign({left:0,right:0,top:0,bottom:0},n),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+n.left+n.right:this.height+n.top+n.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=nO(this,s,o),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();let l=a<this.ticks.length;this._convertTicksToLabels(l?YK(this.ticks,a):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),i.display&&(i.autoSkip||i.source==="auto")&&(this.ticks=hve(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),l&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let e=this.options.reverse,r,n;this.isHorizontal()?(r=this.left,n=this.right):(r=this.top,n=this.bottom,e=!e),this._startPixel=r,this._endPixel=n,this._reversePixels=e,this._length=n-r,this._alignToPixels=this.options.alignToPixels}afterUpdate(){br(this.options.afterUpdate,[this])}beforeSetDimensions(){br(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){br(this.options.afterSetDimensions,[this])}_callHooks(e){this.chart.notifyPlugins(e,this.getContext()),br(this.options[e],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){br(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(e){let r=this.options.ticks,n,o,s;for(n=0,o=e.length;n<o;n++)s=e[n],s.label=br(r.callback,[s.value,n,e],this)}afterTickToLabelConversion(){br(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){br(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){let e=this.options,r=e.ticks,n=this.ticks.length,o=r.minRotation||0,s=r.maxRotation,i=o,a,l,u;if(!this._isVisible()||!r.display||o>=s||n<=1||!this.isHorizontal()){this.labelRotation=o;return}let c=this._getLabelSizes(),p=c.widest.width,f=c.highest.height,d=Qs(this.chart.width-p,0,this.maxWidth);a=e.offset?this.maxWidth/n:d/(n-1),p+6>a&&(a=d/(n-(e.offset?.5:1)),l=this.maxHeight-hv(e.grid)-r.padding-QK(e.title,this.chart.options.font),u=Math.sqrt(p*p+f*f),i=nv(Math.min(Math.asin(Qs((c.highest.height+6)/a,-1,1)),Math.asin(Qs(l/u,-1,1))-Math.asin(Qs(f/u,-1,1)))),i=Math.max(o,Math.min(s,i))),this.labelRotation=i}afterCalculateLabelRotation(){br(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){br(this.options.beforeFit,[this])}fit(){let e={width:0,height:0},{chart:r,options:{ticks:n,title:o,grid:s}}=this,i=this._isVisible(),a=this.isHorizontal();if(i){let l=QK(o,r.options.font);if(a?(e.width=this.maxWidth,e.height=hv(s)+l):(e.height=this.maxHeight,e.width=hv(s)+l),n.display&&this.ticks.length){let{first:u,last:c,widest:p,highest:f}=this._getLabelSizes(),d=n.padding*2,m=pa(this.labelRotation),h=Math.cos(m),g=Math.sin(m);if(a){let x=n.mirror?0:g*p.width+h*f.height;e.height=Math.min(this.maxHeight,e.height+x+d)}else{let x=n.mirror?0:h*p.width+g*f.height;e.width=Math.min(this.maxWidth,e.width+x+d)}this._calculatePadding(u,c,g,h)}}this._handleMargins(),a?(this.width=this._length=r.width-this._margins.left-this._margins.right,this.height=e.height):(this.width=e.width,this.height=this._length=r.height-this._margins.top-this._margins.bottom)}_calculatePadding(e,r,n,o){let{ticks:{align:s,padding:i},position:a}=this.options,l=this.labelRotation!==0,u=a!=="top"&&this.axis==="x";if(this.isHorizontal()){let c=this.getPixelForTick(0)-this.left,p=this.right-this.getPixelForTick(this.ticks.length-1),f=0,d=0;l?u?(f=o*e.width,d=n*r.height):(f=n*e.height,d=o*r.width):s==="start"?d=r.width:s==="end"?f=e.width:s!=="inner"&&(f=e.width/2,d=r.width/2),this.paddingLeft=Math.max((f-c+i)*this.width/(this.width-c),0),this.paddingRight=Math.max((d-p+i)*this.width/(this.width-p),0)}else{let c=r.height/2,p=e.height/2;s==="start"?(c=0,p=e.height):s==="end"&&(c=r.height,p=0),this.paddingTop=c+i,this.paddingBottom=p+i}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){br(this.options.afterFit,[this])}isHorizontal(){let{axis:e,position:r}=this.options;return r==="top"||r==="bottom"||e==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(e){this.beforeTickToLabelConversion(),this.generateTickLabels(e);let r,n;for(r=0,n=e.length;r<n;r++)nr(e[r].label)&&(e.splice(r,1),n--,r--);this.afterTickToLabelConversion()}_getLabelSizes(){let e=this._labelSizes;if(!e){let r=this.options.ticks.sampleSize,n=this.ticks;r<n.length&&(n=YK(n,r)),this._labelSizes=e=this._computeLabelSizes(n,n.length)}return e}_computeLabelSizes(e,r){let{ctx:n,_longestTextCache:o}=this,s=[],i=[],a=0,l=0,u,c,p,f,d,m,h,g,x,y,b;for(u=0;u<r;++u){if(f=e[u].label,d=this._resolveTickFontOptions(u),n.font=m=d.string,h=o[m]=o[m]||{data:{},gc:[]},g=d.lineHeight,x=y=0,!nr(f)&&!yr(f))x=Ug(n,h.data,h.gc,x,f),y=g;else if(yr(f))for(c=0,p=f.length;c<p;++c)b=f[c],!nr(b)&&!yr(b)&&(x=Ug(n,h.data,h.gc,x,b),y+=g);s.push(x),i.push(y),a=Math.max(x,a),l=Math.max(y,l)}Sve(o,r);let v=s.indexOf(a),C=i.indexOf(l),S=k=>({width:s[k]||0,height:i[k]||0});return{first:S(0),last:S(r-1),widest:S(v),highest:S(C),widths:s,heights:i}}getLabelForValue(e){return e}getPixelForValue(e,r){return NaN}getValueForPixel(e){}getPixelForTick(e){let r=this.ticks;return e<0||e>r.length-1?null:this.getPixelForValue(r[e].value)}getPixelForDecimal(e){this._reversePixels&&(e=1-e);let r=this._startPixel+e*this._length;return GR(this._alignToPixels?ru(this.chart,r,0):r)}getDecimalForPixel(e){let r=(e-this._startPixel)/this._length;return this._reversePixels?1-r:r}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){let{min:e,max:r}=this;return e<0&&r<0?r:e>0&&r>0?e:0}getContext(e){let r=this.ticks||[];if(e>=0&&e<r.length){let n=r[e];return n.$context||(n.$context=Tve(this.getContext(),e,n))}return this.$context||(this.$context=kve(this.chart.getContext(),this))}_tickSize(){let e=this.options.ticks,r=pa(this.labelRotation),n=Math.abs(Math.cos(r)),o=Math.abs(Math.sin(r)),s=this._getLabelSizes(),i=e.autoSkipPadding||0,a=s?s.widest.width+i:0,l=s?s.highest.height+i:0;return this.isHorizontal()?l*n>a*o?a/n:l/o:l*o<a*n?l/n:a/o}_isVisible(){let e=this.options.display;return e!=="auto"?!!e:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(e){let r=this.axis,n=this.chart,o=this.options,{grid:s,position:i,border:a}=o,l=s.offset,u=this.isHorizontal(),p=this.ticks.length+(l?1:0),f=hv(s),d=[],m=a.setContext(this.getContext()),h=m.display?m.width:0,g=h/2,x=function(H){return ru(n,H,h)},y,b,v,C,S,k,N,D,$,O,V,K;if(i==="top")y=x(this.bottom),k=this.bottom-f,D=y-g,O=x(e.top)+g,K=e.bottom;else if(i==="bottom")y=x(this.top),O=e.top,K=x(e.bottom)-g,k=y+g,D=this.top+f;else if(i==="left")y=x(this.right),S=this.right-f,N=y-g,$=x(e.left)+g,V=e.right;else if(i==="right")y=x(this.left),$=e.left,V=x(e.right)-g,S=y+g,N=this.left+f;else if(r==="x"){if(i==="center")y=x((e.top+e.bottom)/2+.5);else if(dt(i)){let H=Object.keys(i)[0],Y=i[H];y=x(this.chart.scales[H].getPixelForValue(Y))}O=e.top,K=e.bottom,k=y+g,D=k+f}else if(r==="y"){if(i==="center")y=x((e.left+e.right)/2);else if(dt(i)){let H=Object.keys(i)[0],Y=i[H];y=x(this.chart.scales[H].getPixelForValue(Y))}S=y-g,N=S-f,$=e.left,V=e.right}let X=xr(o.ticks.maxTicksLimit,p),W=Math.max(1,Math.ceil(p/X));for(b=0;b<p;b+=W){let H=this.getContext(b),Y=s.setContext(H),Z=a.setContext(H),Q=Y.lineWidth,se=Y.color,ne=Z.dash||[],re=Z.dashOffset,ue=Y.tickWidth,ae=Y.tickColor,le=Y.tickBorderDash||[],me=Y.tickBorderDashOffset;v=Cve(this,b,l),v!==void 0&&(C=ru(n,v,Q),u?S=N=$=V=C:k=D=O=K=C,d.push({tx1:S,ty1:k,tx2:N,ty2:D,x1:$,y1:O,x2:V,y2:K,width:Q,color:se,borderDash:ne,borderDashOffset:re,tickWidth:ue,tickColor:ae,tickBorderDash:le,tickBorderDashOffset:me}))}return this._ticksLength=p,this._borderValue=y,d}_computeLabelItems(e){let r=this.axis,n=this.options,{position:o,ticks:s}=n,i=this.isHorizontal(),a=this.ticks,{align:l,crossAlign:u,padding:c,mirror:p}=s,f=hv(n.grid),d=f+c,m=p?-c:d,h=-pa(this.labelRotation),g=[],x,y,b,v,C,S,k,N,D,$,O,V,K="middle";if(o==="top")S=this.bottom-m,k=this._getXAxisLabelAlignment();else if(o==="bottom")S=this.top+m,k=this._getXAxisLabelAlignment();else if(o==="left"){let W=this._getYAxisLabelAlignment(f);k=W.textAlign,C=W.x}else if(o==="right"){let W=this._getYAxisLabelAlignment(f);k=W.textAlign,C=W.x}else if(r==="x"){if(o==="center")S=(e.top+e.bottom)/2+d;else if(dt(o)){let W=Object.keys(o)[0],H=o[W];S=this.chart.scales[W].getPixelForValue(H)+d}k=this._getXAxisLabelAlignment()}else if(r==="y"){if(o==="center")C=(e.left+e.right)/2-d;else if(dt(o)){let W=Object.keys(o)[0],H=o[W];C=this.chart.scales[W].getPixelForValue(H)}k=this._getYAxisLabelAlignment(f).textAlign}r==="y"&&(l==="start"?K="top":l==="end"&&(K="bottom"));let X=this._getLabelSizes();for(x=0,y=a.length;x<y;++x){b=a[x],v=b.label;let W=s.setContext(this.getContext(x));N=this.getPixelForTick(x)+s.labelOffset,D=this._resolveTickFontOptions(x),$=D.lineHeight,O=yr(v)?v.length:1;let H=O/2,Y=W.color,Z=W.textStrokeColor,Q=W.textStrokeWidth,se=k;i?(C=N,k==="inner"&&(x===y-1?se=this.options.reverse?"left":"right":x===0?se=this.options.reverse?"right":"left":se="center"),o==="top"?u==="near"||h!==0?V=-O*$+$/2:u==="center"?V=-X.highest.height/2-H*$+$:V=-X.highest.height+$/2:u==="near"||h!==0?V=$/2:u==="center"?V=X.highest.height/2-H*$:V=X.highest.height-O*$,p&&(V*=-1),h!==0&&!W.showLabelBackdrop&&(C+=$/2*Math.sin(h))):(S=N,V=(1-O)*$/2);let ne;if(W.showLabelBackdrop){let re=Vo(W.backdropPadding),ue=X.heights[x],ae=X.widths[x],le=V-re.top,me=0-re.left;switch(K){case"middle":le-=ue/2;break;case"bottom":le-=ue;break}switch(k){case"center":me-=ae/2;break;case"right":me-=ae;break}ne={left:me,top:le,width:ae+re.width,height:ue+re.height,color:W.backdropColor}}g.push({rotation:h,label:v,font:D,color:Y,strokeColor:Z,strokeWidth:Q,textOffset:V,textAlign:se,textBaseline:K,translation:[C,S],backdrop:ne})}return g}_getXAxisLabelAlignment(){let{position:e,ticks:r}=this.options;if(-pa(this.labelRotation))return e==="top"?"left":"right";let o="center";return r.align==="start"?o="left":r.align==="end"?o="right":r.align==="inner"&&(o="inner"),o}_getYAxisLabelAlignment(e){let{position:r,ticks:{crossAlign:n,mirror:o,padding:s}}=this.options,i=this._getLabelSizes(),a=e+s,l=i.widest.width,u,c;return r==="left"?o?(c=this.right+s,n==="near"?u="left":n==="center"?(u="center",c+=l/2):(u="right",c+=l)):(c=this.right-a,n==="near"?u="right":n==="center"?(u="center",c-=l/2):(u="left",c=this.left)):r==="right"?o?(c=this.left+s,n==="near"?u="right":n==="center"?(u="center",c-=l/2):(u="left",c-=l)):(c=this.left+a,n==="near"?u="left":n==="center"?(u="center",c+=l/2):(u="right",c=this.right)):u="right",{textAlign:u,x:c}}_computeLabelArea(){if(this.options.ticks.mirror)return;let e=this.chart,r=this.options.position;if(r==="left"||r==="right")return{top:0,left:this.left,bottom:e.height,right:this.right};if(r==="top"||r==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:e.width}}drawBackground(){let{ctx:e,options:{backgroundColor:r},left:n,top:o,width:s,height:i}=this;r&&(e.save(),e.fillStyle=r,e.fillRect(n,o,s,i),e.restore())}getLineWidthForValue(e){let r=this.options.grid;if(!this._isVisible()||!r.display)return 0;let o=this.ticks.findIndex(s=>s.value===e);return o>=0?r.setContext(this.getContext(o)).lineWidth:0}drawGrid(e){let r=this.options.grid,n=this.ctx,o=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(e)),s,i,a=(l,u,c)=>{!c.width||!c.color||(n.save(),n.lineWidth=c.width,n.strokeStyle=c.color,n.setLineDash(c.borderDash||[]),n.lineDashOffset=c.borderDashOffset,n.beginPath(),n.moveTo(l.x,l.y),n.lineTo(u.x,u.y),n.stroke(),n.restore())};if(r.display)for(s=0,i=o.length;s<i;++s){let l=o[s];r.drawOnChartArea&&a({x:l.x1,y:l.y1},{x:l.x2,y:l.y2},l),r.drawTicks&&a({x:l.tx1,y:l.ty1},{x:l.tx2,y:l.ty2},{color:l.tickColor,width:l.tickWidth,borderDash:l.tickBorderDash,borderDashOffset:l.tickBorderDashOffset})}}drawBorder(){let{chart:e,ctx:r,options:{border:n,grid:o}}=this,s=n.setContext(this.getContext()),i=n.display?s.width:0;if(!i)return;let a=o.setContext(this.getContext(0)).lineWidth,l=this._borderValue,u,c,p,f;this.isHorizontal()?(u=ru(e,this.left,i)-i/2,c=ru(e,this.right,a)+a/2,p=f=l):(p=ru(e,this.top,i)-i/2,f=ru(e,this.bottom,a)+a/2,u=c=l),r.save(),r.lineWidth=s.width,r.strokeStyle=s.color,r.beginPath(),r.moveTo(u,p),r.lineTo(c,f),r.stroke(),r.restore()}drawLabels(e){if(!this.options.ticks.display)return;let n=this.ctx,o=this._computeLabelArea();o&&kN(n,o);let s=this._labelItems||(this._labelItems=this._computeLabelItems(e)),i,a;for(i=0,a=s.length;i<a;++i){let l=s[i],u=l.font,c=l.label,p=l.textOffset;Yg(n,c,0,p,u,l)}o&&TN(n)}drawTitle(){let{ctx:e,options:{position:r,title:n,reverse:o}}=this;if(!n.display)return;let s=bo(n.font),i=Vo(n.padding),a=n.align,l=s.lineHeight/2;r==="bottom"||r==="center"||dt(r)?(l+=i.bottom,yr(n.text)&&(l+=s.lineHeight*(n.text.length-1))):l+=i.top;let{titleX:u,titleY:c,maxWidth:p,rotation:f}=Ive(this,l,r,a);Yg(e,n.text,0,0,s,{color:n.color,maxWidth:p,rotation:f,textAlign:Nve(a,r,o),textBaseline:"middle",translation:[u,c]})}draw(e){!this._isVisible()||(this.drawBackground(),this.drawGrid(e),this.drawBorder(),this.drawTitle(),this.drawLabels(e))}_layers(){let e=this.options,r=e.ticks&&e.ticks.z||0,n=xr(e.grid&&e.grid.z,-1),o=xr(e.border&&e.border.z,0);return!this._isVisible()||this.draw!==cu.prototype.draw?[{z:r,draw:s=>{this.draw(s)}}]:[{z:n,draw:s=>{this.drawBackground(),this.drawGrid(s),this.drawTitle()}},{z:o,draw:()=>{this.drawBorder()}},{z:r,draw:s=>{this.drawLabels(s)}}]}getMatchingVisibleMetas(e){let r=this.chart.getSortedVisibleDatasetMetas(),n=this.axis+"AxisID",o=[],s,i;for(s=0,i=r.length;s<i;++s){let a=r[s];a[n]===this.id&&(!e||a.type===e)&&o.push(a)}return o}_resolveTickFontOptions(e){let r=this.options.ticks.setContext(this.getContext(e));return bo(r.font)}_maxDigits(){let e=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/e}},Jg=class{constructor(e,r,n){this.type=e,this.scope=r,this.override=n,this.items=Object.create(null)}isForType(e){return Object.prototype.isPrototypeOf.call(this.type.prototype,e.prototype)}register(e){let r=Object.getPrototypeOf(e),n;Ave(r)&&(n=this.register(r));let o=this.items,s=e.id,i=this.scope+"."+s;if(!s)throw new Error("class does not have id: "+e);return s in o||(o[s]=e,Eve(e,i,n),this.override&&Vr.override(e.id,e.overrides)),i}get(e){return this.items[e]}unregister(e){let r=this.items,n=e.id,o=this.scope;n in r&&delete r[n],o&&n in Vr[o]&&(delete Vr[o][n],this.override&&delete hp[n])}};function Eve(t,e,r){let n=pd(Object.create(null),[r?Vr.get(r):{},Vr.get(e),t.defaults]);Vr.set(e,n),t.defaultRoutes&&_ve(e,t.defaultRoutes),t.descriptors&&Vr.describe(e,t.descriptors)}function _ve(t,e){Object.keys(e).forEach(r=>{let n=r.split("."),o=n.pop(),s=[t].concat(n).join("."),i=e[r].split("."),a=i.pop(),l=i.join(".");Vr.route(s,o,l,a)})}function Ave(t){return"id"in t&&"defaults"in t}var bO=class{constructor(){this.controllers=new Jg(gp,"datasets",!0),this.elements=new Jg(uu,"elements"),this.plugins=new Jg(Object,"plugins"),this.scales=new Jg(cu,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...e){this._each("register",e)}remove(...e){this._each("unregister",e)}addControllers(...e){this._each("register",e,this.controllers)}addElements(...e){this._each("register",e,this.elements)}addPlugins(...e){this._each("register",e,this.plugins)}addScales(...e){this._each("register",e,this.scales)}getController(e){return this._get(e,this.controllers,"controller")}getElement(e){return this._get(e,this.elements,"element")}getPlugin(e){return this._get(e,this.plugins,"plugin")}getScale(e){return this._get(e,this.scales,"scale")}removeControllers(...e){this._each("unregister",e,this.controllers)}removeElements(...e){this._each("unregister",e,this.elements)}removePlugins(...e){this._each("unregister",e,this.plugins)}removeScales(...e){this._each("unregister",e,this.scales)}_each(e,r,n){[...r].forEach(o=>{let s=n||this._getRegistryForType(o);n||s.isForType(o)||s===this.plugins&&o.id?this._exec(e,s,o):At(o,i=>{let a=n||this._getRegistryForType(i);this._exec(e,a,i)})})}_exec(e,r,n){let o=rv(e);br(n["before"+o],[],n),r[e](n),br(n["after"+o],[],n)}_getRegistryForType(e){for(let r=0;r<this._typedRegistries.length;r++){let n=this._typedRegistries[r];if(n.isForType(e))return n}return this.plugins}_get(e,r,n){let o=r.get(e);if(o===void 0)throw new Error('"'+e+'" is not a registered '+n+".");return o}},da=new bO,vO=class{constructor(){this._init=[]}notify(e,r,n,o){r==="beforeInit"&&(this._init=this._createDescriptors(e,!0),this._notify(this._init,e,"install"));let s=o?this._descriptors(e).filter(o):this._descriptors(e),i=this._notify(s,e,r,n);return r==="afterDestroy"&&(this._notify(s,e,"stop"),this._notify(this._init,e,"uninstall")),i}_notify(e,r,n,o){o=o||{};for(let s of e){let i=s.plugin,a=i[n],l=[r,o,s.options];if(br(a,l,i)===!1&&o.cancelable)return!1}return!0}invalidate(){nr(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(e){if(this._cache)return this._cache;let r=this._cache=this._createDescriptors(e);return this._notifyStateChanges(e),r}_createDescriptors(e,r){let n=e&&e.config,o=xr(n.options&&n.options.plugins,{}),s=Dve(n);return o===!1&&!r?[]:Rve(e,s,o,r)}_notifyStateChanges(e){let r=this._oldCache||[],n=this._cache,o=(s,i)=>s.filter(a=>!i.some(l=>a.plugin.id===l.plugin.id));this._notify(o(r,n),e,"stop"),this._notify(o(n,r),e,"start")}};function Dve(t){let e={},r=[],n=Object.keys(da.plugins.items);for(let s=0;s<n.length;s++)r.push(da.getPlugin(n[s]));let o=t.plugins||[];for(let s=0;s<o.length;s++){let i=o[s];r.indexOf(i)===-1&&(r.push(i),e[i.id]=!0)}return{plugins:r,localIds:e}}function $ve(t,e){return!e&&t===!1?null:t===!0?{}:t}function Rve(t,{plugins:e,localIds:r},n,o){let s=[],i=t.getContext();for(let a of e){let l=a.id,u=$ve(n[l],o);u!==null&&s.push({plugin:a,options:Ove(t.config,{plugin:a,local:r[l]},u,i)})}return s}function Ove(t,{plugin:e,local:r},n,o){let s=t.pluginScopeKeys(e),i=t.getOptionScopes(n,s);return r&&e.defaults&&i.push(e.defaults),t.createResolver(i,o,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function wO(t,e){let r=Vr.datasets[t]||{};return((e.datasets||{})[t]||{}).indexAxis||e.indexAxis||r.indexAxis||"x"}function Fve(t,e){let r=t;return t==="_index_"?r=e:t==="_value_"&&(r=e==="x"?"y":"x"),r}function Pve(t,e){return t===e?"_index_":"_value_"}function Lve(t){if(t==="top"||t==="bottom")return"x";if(t==="left"||t==="right")return"y"}function HN(t,e){if(t==="x"||t==="y"||t==="r"||(t=e.axis||Lve(e.position)||t.length>1&&HN(t[0].toLowerCase(),e),t))return t;throw new Error(`Cannot determine type of '${name}' axis. Please provide 'axis' or 'position' option.`)}function Mve(t,e){let r=hp[t.type]||{scales:{}},n=e.scales||{},o=wO(t.type,e),s=Object.create(null);return Object.keys(n).forEach(i=>{let a=n[i];if(!dt(a))return console.error(`Invalid scale configuration for scale: ${i}`);if(a._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${i}`);let l=HN(i,a),u=Pve(l,o),c=r.scales||{};s[i]=fd(Object.create(null),[{axis:l},a,c[l],c[u]])}),t.data.datasets.forEach(i=>{let a=i.type||t.type,l=i.indexAxis||wO(a,e),c=(hp[a]||{}).scales||{};Object.keys(c).forEach(p=>{let f=Fve(p,l),d=i[f+"AxisID"]||f;s[d]=s[d]||Object.create(null),fd(s[d],[{axis:f},n[d],c[p]])})}),Object.keys(s).forEach(i=>{let a=s[i];fd(a,[Vr.scales[a.type],Vr.scale])}),s}function kX(t){let e=t.options||(t.options={});e.plugins=xr(e.plugins,{}),e.scales=Mve(t,e)}function TX(t){return t=t||{},t.datasets=t.datasets||[],t.labels=t.labels||[],t}function zve(t){return t=t||{},t.data=TX(t.data),kX(t),t}var ZK=new Map,NX=new Set;function FN(t,e){let r=ZK.get(t);return r||(r=e(),ZK.set(t,r),NX.add(r)),r}var gv=(t,e,r)=>{let n=qg(e,r);n!==void 0&&t.add(n)},CO=class{constructor(e){this._config=zve(e),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(e){this._config.type=e}get data(){return this._config.data}set data(e){this._config.data=TX(e)}get options(){return this._config.options}set options(e){this._config.options=e}get plugins(){return this._config.plugins}update(){let e=this._config;this.clearCache(),kX(e)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(e){return FN(e,()=>[[`datasets.${e}`,""]])}datasetAnimationScopeKeys(e,r){return FN(`${e}.transition.${r}`,()=>[[`datasets.${e}.transitions.${r}`,`transitions.${r}`],[`datasets.${e}`,""]])}datasetElementScopeKeys(e,r){return FN(`${e}-${r}`,()=>[[`datasets.${e}.elements.${r}`,`datasets.${e}`,`elements.${r}`,""]])}pluginScopeKeys(e){let r=e.id,n=this.type;return FN(`${n}-plugin-${r}`,()=>[[`plugins.${r}`,...e.additionalOptionScopes||[]]])}_cachedScopes(e,r){let n=this._scopeCache,o=n.get(e);return(!o||r)&&(o=new Map,n.set(e,o)),o}getOptionScopes(e,r,n){let{options:o,type:s}=this,i=this._cachedScopes(e,n),a=i.get(r);if(a)return a;let l=new Set;r.forEach(c=>{e&&(l.add(e),c.forEach(p=>gv(l,e,p))),c.forEach(p=>gv(l,o,p)),c.forEach(p=>gv(l,hp[s]||{},p)),c.forEach(p=>gv(l,Vr,p)),c.forEach(p=>gv(l,vN,p))});let u=Array.from(l);return u.length===0&&u.push(Object.create(null)),NX.has(r)&&i.set(r,u),u}chartOptionScopes(){let{options:e,type:r}=this;return[e,hp[r]||{},Vr.datasets[r]||{},{type:r},Vr,vN]}resolveNamedOptions(e,r,n,o=[""]){let s={$shared:!0},{resolver:i,subPrefixes:a}=JK(this._resolverCache,e,o),l=i;if(Vve(i,r)){s.$shared=!1,n=ua(n)?n():n;let u=this.createResolver(e,n,a);l=mp(i,n,u)}for(let u of r)s[u]=l[u];return s}createResolver(e,r,n=[""],o){let{resolver:s}=JK(this._resolverCache,e,n);return dt(r)?mp(s,r,void 0,o):s}};function JK(t,e,r){let n=t.get(e);n||(n=new Map,t.set(e,n));let o=r.join(),s=n.get(o);return s||(s={resolver:uv(e,r),subPrefixes:r.filter(a=>!a.toLowerCase().includes("hover"))},n.set(o,s)),s}var Bve=t=>dt(t)&&Object.getOwnPropertyNames(t).reduce((e,r)=>e||ua(t[r]),!1);function Vve(t,e){let{isScriptable:r,isIndexable:n}=IN(t);for(let o of e){let s=r(o),i=n(o),a=(i||s)&&t[o];if(s&&(ua(a)||Bve(a))||i&&yr(a))return!0}return!1}var Wve="4.0.1",Gve=["top","bottom","left","right","chartArea"];function eX(t,e){return t==="top"||t==="bottom"||Gve.indexOf(t)===-1&&e==="x"}function tX(t,e){return function(r,n){return r[t]===n[t]?r[e]-n[e]:r[t]-n[t]}}function rX(t){let e=t.chart,r=e.options.animation;e.notifyPlugins("afterRender"),br(r&&r.onComplete,[t],e)}function Uve(t){let e=t.chart,r=e.options.animation;br(r&&r.onProgress,[t],e)}function IX(t){return EN()&&typeof t=="string"?t=document.getElementById(t):t&&t.length&&(t=t[0]),t&&t.canvas&&(t=t.canvas),t}var VN={},nX=t=>{let e=IX(t);return Object.values(VN).filter(r=>r.canvas===e).pop()};function Hve(t,e,r){let n=Object.keys(t);for(let o of n){let s=+o;if(s>=e){let i=t[o];delete t[o],(r>0||s>e)&&(t[s+r]=i)}}}function qve(t,e,r,n){return!r||t.type==="mouseout"?null:n?e:t}function jve(t){let{xScale:e,yScale:r}=t;if(e&&r)return{left:e.left,right:e.right,top:r.top,bottom:r.bottom}}var ma=class{static register(...e){da.add(...e),oX()}static unregister(...e){da.remove(...e),oX()}constructor(e,r){let n=this.config=new CO(r),o=IX(e),s=nX(o);if(s)throw new Error("Canvas is already in use. Chart with ID '"+s.id+"' must be destroyed before the canvas with ID '"+s.canvas.id+"' can be reused.");let i=n.createResolver(n.chartOptionScopes(),this.getContext());this.platform=new(n.platform||mve(o)),this.platform.updateConfig(n);let a=this.platform.acquireContext(o,i.aspectRatio),l=a&&a.canvas,u=l&&l.height,c=l&&l.width;if(this.id=FR(),this.ctx=a,this.canvas=l,this.width=c,this.height=u,this._options=i,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new vO,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=KR(p=>this.update(p),i.resizeDelay||0),this._dataChanges=[],VN[this.id]=this,!a||!l){console.error("Failed to create chart: can't acquire context from the given item");return}au.listen(this,"complete",rX),au.listen(this,"progress",Uve),this._initialize(),this.attached&&this.update()}get aspectRatio(){let{options:{aspectRatio:e,maintainAspectRatio:r},width:n,height:o,_aspectRatio:s}=this;return nr(e)?r&&s?s:o?n/o:null:e}get data(){return this.config.data}set data(e){this.config.data=e}get options(){return this._options}set options(e){this.config.options=e}get registry(){return da}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():AN(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return wN(this.canvas,this.ctx),this}stop(){return au.stop(this),this}resize(e,r){au.running(this)?this._resizeBeforeDraw={width:e,height:r}:this._resize(e,r)}_resize(e,r){let n=this.options,o=this.canvas,s=n.maintainAspectRatio&&this.aspectRatio,i=this.platform.getMaximumSize(o,e,r,s),a=n.devicePixelRatio||this.platform.getDevicePixelRatio(),l=this.width?"resize":"attach";this.width=i.width,this.height=i.height,this._aspectRatio=this.aspectRatio,AN(this,a,!0)&&(this.notifyPlugins("resize",{size:i}),br(n.onResize,[this,i],this),this.attached&&this._doResize(l)&&this.render())}ensureScalesHaveIDs(){let r=this.options.scales||{};At(r,(n,o)=>{n.id=o})}buildOrUpdateScales(){let e=this.options,r=e.scales,n=this.scales,o=Object.keys(n).reduce((i,a)=>(i[a]=!1,i),{}),s=[];r&&(s=s.concat(Object.keys(r).map(i=>{let a=r[i],l=HN(i,a),u=l==="r",c=l==="x";return{options:a,dposition:u?"chartArea":c?"bottom":"left",dtype:u?"radialLinear":c?"category":"linear"}}))),At(s,i=>{let a=i.options,l=a.id,u=HN(l,a),c=xr(a.type,i.dtype);(a.position===void 0||eX(a.position,u)!==eX(i.dposition))&&(a.position=i.dposition),o[l]=!0;let p=null;if(l in n&&n[l].type===c)p=n[l];else{let f=da.getScale(c);p=new f({id:l,type:c,ctx:this.ctx,chart:this}),n[p.id]=p}p.init(a,e)}),At(o,(i,a)=>{i||delete n[a]}),At(n,i=>{RN.configure(this,i,i.options),RN.addBox(this,i)})}_updateMetasets(){let e=this._metasets,r=this.data.datasets.length,n=e.length;if(e.sort((o,s)=>o.index-s.index),n>r){for(let o=r;o<n;++o)this._destroyDatasetMeta(o);e.splice(r,n-r)}this._sortedMetasets=e.slice(0).sort(tX("order","index"))}_removeUnreferencedMetasets(){let{_metasets:e,data:{datasets:r}}=this;e.length>r.length&&delete this._stacks,e.forEach((n,o)=>{r.filter(s=>s===n._dataset).length===0&&this._destroyDatasetMeta(o)})}buildOrUpdateControllers(){let e=[],r=this.data.datasets,n,o;for(this._removeUnreferencedMetasets(),n=0,o=r.length;n<o;n++){let s=r[n],i=this.getDatasetMeta(n),a=s.type||this.config.type;if(i.type&&i.type!==a&&(this._destroyDatasetMeta(n),i=this.getDatasetMeta(n)),i.type=a,i.indexAxis=s.indexAxis||wO(a,this.options),i.order=s.order||0,i.index=n,i.label=""+s.label,i.visible=this.isDatasetVisible(n),i.controller)i.controller.updateIndex(n),i.controller.linkScales();else{let l=da.getController(a),{datasetElementType:u,dataElementType:c}=Vr.datasets[a];Object.assign(l,{dataElementType:da.getElement(c),datasetElementType:u&&da.getElement(u)}),i.controller=new l(this,n),e.push(i.controller)}}return this._updateMetasets(),e}_resetElements(){At(this.data.datasets,(e,r)=>{this.getDatasetMeta(r).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(e){let r=this.config;r.update();let n=this._options=r.createResolver(r.chartOptionScopes(),this.getContext()),o=this._animationsDisabled=!n.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:e,cancelable:!0})===!1)return;let s=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let i=0;for(let u=0,c=this.data.datasets.length;u<c;u++){let{controller:p}=this.getDatasetMeta(u),f=!o&&s.indexOf(p)===-1;p.buildOrUpdateElements(f),i=Math.max(+p.getMaxOverflow(),i)}i=this._minPadding=n.layout.autoPadding?i:0,this._updateLayout(i),o||At(s,u=>{u.reset()}),this._updateDatasets(e),this.notifyPlugins("afterUpdate",{mode:e}),this._layers.sort(tX("z","_idx"));let{_active:a,_lastEvent:l}=this;l?this._eventHandler(l,!0):a.length&&this._updateHoverStyles(a,a,!0),this.render()}_updateScales(){At(this.scales,e=>{RN.removeBox(this,e)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){let e=this.options,r=new Set(Object.keys(this._listeners)),n=new Set(e.events);(!cN(r,n)||!!this._responsiveListeners!==e.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){let{_hiddenIndices:e}=this,r=this._getUniformDataChanges()||[];for(let{method:n,start:o,count:s}of r){let i=n==="_removeElements"?-s:s;Hve(e,o,i)}}_getUniformDataChanges(){let e=this._dataChanges;if(!e||!e.length)return;this._dataChanges=[];let r=this.data.datasets.length,n=s=>new Set(e.filter(i=>i[0]===s).map((i,a)=>a+","+i.splice(1).join(","))),o=n(0);for(let s=1;s<r;s++)if(!cN(o,n(s)))return;return Array.from(o).map(s=>s.split(",")).map(s=>({method:s[1],start:+s[2],count:+s[3]}))}_updateLayout(e){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;RN.update(this,this.width,this.height,e);let r=this.chartArea,n=r.width<=0||r.height<=0;this._layers=[],At(this.boxes,o=>{n&&o.position==="chartArea"||(o.configure&&o.configure(),this._layers.push(...o._layers()))},this),this._layers.forEach((o,s)=>{o._idx=s}),this.notifyPlugins("afterLayout")}_updateDatasets(e){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:e,cancelable:!0})!==!1){for(let r=0,n=this.data.datasets.length;r<n;++r)this.getDatasetMeta(r).controller.configure();for(let r=0,n=this.data.datasets.length;r<n;++r)this._updateDataset(r,ua(e)?e({datasetIndex:r}):e);this.notifyPlugins("afterDatasetsUpdate",{mode:e})}}_updateDataset(e,r){let n=this.getDatasetMeta(e),o={meta:n,index:e,mode:r,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",o)!==!1&&(n.controller._update(r),o.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",o))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(au.has(this)?this.attached&&!au.running(this)&&au.start(this):(this.draw(),rX({chart:this})))}draw(){let e;if(this._resizeBeforeDraw){let{width:n,height:o}=this._resizeBeforeDraw;this._resize(n,o),this._resizeBeforeDraw=null}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;let r=this._layers;for(e=0;e<r.length&&r[e].z<=0;++e)r[e].draw(this.chartArea);for(this._drawDatasets();e<r.length;++e)r[e].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(e){let r=this._sortedMetasets,n=[],o,s;for(o=0,s=r.length;o<s;++o){let i=r[o];(!e||i.visible)&&n.push(i)}return n}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;let e=this.getSortedVisibleDatasetMetas();for(let r=e.length-1;r>=0;--r)this._drawDataset(e[r]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(e){let r=this.ctx,n=e._clip,o=!n.disabled,s=jve(e)||this.chartArea,i={meta:e,index:e.index,cancelable:!0};this.notifyPlugins("beforeDatasetDraw",i)!==!1&&(o&&kN(r,{left:n.left===!1?0:s.left-n.left,right:n.right===!1?this.width:s.right+n.right,top:n.top===!1?0:s.top-n.top,bottom:n.bottom===!1?this.height:s.bottom+n.bottom}),e.controller.draw(),o&&TN(r),i.cancelable=!1,this.notifyPlugins("afterDatasetDraw",i))}isPointInArea(e){return SN(e,this.chartArea,this._minPadding)}getElementsAtEventForMode(e,r,n,o){let s=Xbe.modes[r];return typeof s=="function"?s(this,e,n,o):[]}getDatasetMeta(e){let r=this.data.datasets[e],n=this._metasets,o=n.filter(s=>s&&s._dataset===r).pop();return o||(o={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:r&&r.order||0,index:e,_dataset:r,_parsed:[],_sorted:!1},n.push(o)),o}getContext(){return this.$context||(this.$context=su(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(e){let r=this.data.datasets[e];if(!r)return!1;let n=this.getDatasetMeta(e);return typeof n.hidden=="boolean"?!n.hidden:!r.hidden}setDatasetVisibility(e,r){let n=this.getDatasetMeta(e);n.hidden=!r}toggleDataVisibility(e){this._hiddenIndices[e]=!this._hiddenIndices[e]}getDataVisibility(e){return!this._hiddenIndices[e]}_updateVisibility(e,r,n){let o=n?"show":"hide",s=this.getDatasetMeta(e),i=s.controller._resolveAnimations(void 0,o);ps(r)?(s.data[r].hidden=!n,this.update()):(this.setDatasetVisibility(e,n),i.update(s,{visible:n}),this.update(a=>a.datasetIndex===e?o:void 0))}hide(e,r){this._updateVisibility(e,r,!1)}show(e,r){this._updateVisibility(e,r,!0)}_destroyDatasetMeta(e){let r=this._metasets[e];r&&r.controller&&r.controller._destroy(),delete this._metasets[e]}_stop(){let e,r;for(this.stop(),au.remove(this),e=0,r=this.data.datasets.length;e<r;++e)this._destroyDatasetMeta(e)}destroy(){this.notifyPlugins("beforeDestroy");let{canvas:e,ctx:r}=this;this._stop(),this.config.clearCache(),e&&(this.unbindEvents(),wN(e,r),this.platform.releaseContext(r),this.canvas=null,this.ctx=null),delete VN[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...e){return this.canvas.toDataURL(...e)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){let e=this._listeners,r=this.platform,n=(s,i)=>{r.addEventListener(this,s,i),e[s]=i},o=(s,i,a)=>{s.offsetX=i,s.offsetY=a,this._eventHandler(s)};At(this.options.events,s=>n(s,o))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});let e=this._responsiveListeners,r=this.platform,n=(l,u)=>{r.addEventListener(this,l,u),e[l]=u},o=(l,u)=>{e[l]&&(r.removeEventListener(this,l,u),delete e[l])},s=(l,u)=>{this.canvas&&this.resize(l,u)},i,a=()=>{o("attach",a),this.attached=!0,this.resize(),n("resize",s),n("detach",i)};i=()=>{this.attached=!1,o("resize",s),this._stop(),this._resize(0,0),n("attach",a)},r.isAttached(this.canvas)?a():i()}unbindEvents(){At(this._listeners,(e,r)=>{this.platform.removeEventListener(this,r,e)}),this._listeners={},At(this._responsiveListeners,(e,r)=>{this.platform.removeEventListener(this,r,e)}),this._responsiveListeners=void 0}updateHoverStyle(e,r,n){let o=n?"set":"remove",s,i,a,l;for(r==="dataset"&&(s=this.getDatasetMeta(e[0].datasetIndex),s.controller["_"+o+"DatasetHoverStyle"]()),a=0,l=e.length;a<l;++a){i=e[a];let u=i&&this.getDatasetMeta(i.datasetIndex).controller;u&&u[o+"HoverStyle"](i.element,i.datasetIndex,i.index)}}getActiveElements(){return this._active||[]}setActiveElements(e){let r=this._active||[],n=e.map(({datasetIndex:s,index:i})=>{let a=this.getDatasetMeta(s);if(!a)throw new Error("No dataset found at index "+s);return{datasetIndex:s,element:a.data[i],index:i}});!Hg(n,r)&&(this._active=n,this._lastEvent=null,this._updateHoverStyles(n,r))}notifyPlugins(e,r,n){return this._plugins.notify(this,e,r,n)}isPluginEnabled(e){return this._plugins._cache.filter(r=>r.plugin.id===e).length===1}_updateHoverStyles(e,r,n){let o=this.options.hover,s=(l,u)=>l.filter(c=>!u.some(p=>c.datasetIndex===p.datasetIndex&&c.index===p.index)),i=s(r,e),a=n?e:s(e,r);i.length&&this.updateHoverStyle(i,o.mode,!1),a.length&&o.mode&&this.updateHoverStyle(a,o.mode,!0)}_eventHandler(e,r){let n={event:e,replay:r,cancelable:!0,inChartArea:this.isPointInArea(e)},o=i=>(i.options.events||this.options.events).includes(e.native.type);if(this.notifyPlugins("beforeEvent",n,o)===!1)return;let s=this._handleEvent(e,r,n.inChartArea);return n.cancelable=!1,this.notifyPlugins("afterEvent",n,o),(s||n.changed)&&this.render(),this}_handleEvent(e,r,n){let{_active:o=[],options:s}=this,i=r,a=this._getActiveElements(e,o,n,i),l=LR(e),u=qve(e,this._lastEvent,n,l);n&&(this._lastEvent=null,br(s.onHover,[e,a,this],this),l&&br(s.onClick,[e,a,this],this));let c=!Hg(a,o);return(c||r)&&(this._active=a,this._updateHoverStyles(a,o,r)),this._lastEvent=u,c}_getActiveElements(e,r,n,o){if(e.type==="mouseout")return[];if(!n)return r;let s=this.options.hover;return this.getElementsAtEventForMode(e,s.mode,s,o)}};zt(ma,"defaults",Vr),zt(ma,"instances",VN),zt(ma,"overrides",hp),zt(ma,"registry",da),zt(ma,"version",Wve),zt(ma,"getChart",nX);function oX(){return At(ma.instances,t=>t._plugins.invalidate())}var qN=ma;var yv={average(t){if(!t.length)return!1;let e,r,n=0,o=0,s=0;for(e=0,r=t.length;e<r;++e){let i=t[e].element;if(i&&i.hasValue()){let a=i.tooltipPosition();n+=a.x,o+=a.y,++s}}return{x:n/s,y:o/s}},nearest(t,e){if(!t.length)return!1;let r=e.x,n=e.y,o=Number.POSITIVE_INFINITY,s,i,a;for(s=0,i=t.length;s<i;++s){let l=t[s].element;if(l&&l.hasValue()){let u=l.getCenterPoint(),c=VR(e,u);c<o&&(o=c,a=l)}}if(a){let l=a.tooltipPosition();r=l.x,n=l.y}return{x:r,y:n}}};function fa(t,e){return e&&(yr(e)?Array.prototype.push.apply(t,e):t.push(e)),t}function lu(t){return(typeof t=="string"||t instanceof String)&&t.indexOf(`
`)>-1?t.split(`
`):t}function Kve(t,e){let{element:r,datasetIndex:n,index:o}=e,s=t.getDatasetMeta(n).controller,{label:i,value:a}=s.getLabelAndValue(o);return{chart:t,label:i,parsed:s.getParsed(o),raw:t.data.datasets[n].data[o],formattedValue:a,dataset:s.getDataset(),dataIndex:o,datasetIndex:n,element:r}}function sX(t,e){let r=t.chart.ctx,{body:n,footer:o,title:s}=t,{boxWidth:i,boxHeight:a}=e,l=bo(e.bodyFont),u=bo(e.titleFont),c=bo(e.footerFont),p=s.length,f=o.length,d=n.length,m=Vo(e.padding),h=m.height,g=0,x=n.reduce((v,C)=>v+C.before.length+C.lines.length+C.after.length,0);if(x+=t.beforeBody.length+t.afterBody.length,p&&(h+=p*u.lineHeight+(p-1)*e.titleSpacing+e.titleMarginBottom),x){let v=e.displayColors?Math.max(a,l.lineHeight):l.lineHeight;h+=d*v+(x-d)*l.lineHeight+(x-1)*e.bodySpacing}f&&(h+=e.footerMarginTop+f*c.lineHeight+(f-1)*e.footerSpacing);let y=0,b=function(v){g=Math.max(g,r.measureText(v).width+y)};return r.save(),r.font=u.string,At(t.title,b),r.font=l.string,At(t.beforeBody.concat(t.afterBody),b),y=e.displayColors?i+2+e.boxPadding:0,At(n,v=>{At(v.before,b),At(v.lines,b),At(v.after,b)}),y=0,r.font=c.string,At(t.footer,b),r.restore(),g+=m.width,{width:g,height:h}}function Xve(t,e){let{y:r,height:n}=e;return r<n/2?"top":r>t.height-n/2?"bottom":"center"}function Yve(t,e,r,n){let{x:o,width:s}=n,i=r.caretSize+r.caretPadding;if(t==="left"&&o+s+i>e.width||t==="right"&&o-s-i<0)return!0}function Qve(t,e,r,n){let{x:o,width:s}=r,{width:i,chartArea:{left:a,right:l}}=t,u="center";return n==="center"?u=o<=(a+l)/2?"left":"right":o<=s/2?u="left":o>=i-s/2&&(u="right"),Yve(u,t,e,r)&&(u="center"),u}function iX(t,e,r){let n=r.yAlign||e.yAlign||Xve(t,r);return{xAlign:r.xAlign||e.xAlign||Qve(t,e,r,n),yAlign:n}}function Zve(t,e){let{x:r,width:n}=t;return e==="right"?r-=n:e==="center"&&(r-=n/2),r}function Jve(t,e,r){let{y:n,height:o}=t;return e==="top"?n+=r:e==="bottom"?n-=o+r:n-=o/2,n}function aX(t,e,r,n){let{caretSize:o,caretPadding:s,cornerRadius:i}=t,{xAlign:a,yAlign:l}=r,u=o+s,{topLeft:c,topRight:p,bottomLeft:f,bottomRight:d}=ou(i),m=Zve(e,a),h=Jve(e,l,u);return l==="center"?a==="left"?m+=u:a==="right"&&(m-=u):a==="left"?m-=Math.max(c,f)+o:a==="right"&&(m+=Math.max(p,d)+o),{x:Qs(m,0,n.width-e.width),y:Qs(h,0,n.height-e.height)}}function PN(t,e,r){let n=Vo(r.padding);return e==="center"?t.x+t.width/2:e==="right"?t.x+t.width-n.right:t.x+n.left}function lX(t){return fa([],lu(t))}function e1e(t,e,r){return su(t,{tooltip:e,tooltipItems:r,type:"tooltip"})}function uX(t,e){let r=e&&e.dataset&&e.dataset.tooltip&&e.dataset.tooltip.callbacks;return r?t.override(r):t}var EX={beforeTitle:_i,title(t){if(t.length>0){let e=t[0],r=e.chart.data.labels,n=r?r.length:0;if(this&&this.options&&this.options.mode==="dataset")return e.dataset.label||"";if(e.label)return e.label;if(n>0&&e.dataIndex<n)return r[e.dataIndex]}return""},afterTitle:_i,beforeBody:_i,beforeLabel:_i,label(t){if(this&&this.options&&this.options.mode==="dataset")return t.label+": "+t.formattedValue||t.formattedValue;let e=t.dataset.label||"";e&&(e+=": ");let r=t.formattedValue;return nr(r)||(e+=r),e},labelColor(t){let r=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{borderColor:r.borderColor,backgroundColor:r.backgroundColor,borderWidth:r.borderWidth,borderDash:r.borderDash,borderDashOffset:r.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(t){let r=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{pointStyle:r.pointStyle,rotation:r.rotation}},afterLabel:_i,afterBody:_i,beforeFooter:_i,footer:_i,afterFooter:_i};function Wo(t,e,r,n){let o=t[e].call(r,n);return typeof o>"u"?EX[e].call(r,n):o}var bv=class extends uu{constructor(e){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=e.chart,this.options=e.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(e){this.options=e,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){let e=this._cachedAnimations;if(e)return e;let r=this.chart,n=this.options.setContext(this.getContext()),o=n.enabled&&r.options.animation&&n.animations,s=new WN(this.chart,o);return o._cacheable&&(this._cachedAnimations=Object.freeze(s)),s}getContext(){return this.$context||(this.$context=e1e(this.chart.getContext(),this,this._tooltipItems))}getTitle(e,r){let{callbacks:n}=r,o=Wo(n,"beforeTitle",this,e),s=Wo(n,"title",this,e),i=Wo(n,"afterTitle",this,e),a=[];return a=fa(a,lu(o)),a=fa(a,lu(s)),a=fa(a,lu(i)),a}getBeforeBody(e,r){return lX(Wo(r.callbacks,"beforeBody",this,e))}getBody(e,r){let{callbacks:n}=r,o=[];return At(e,s=>{let i={before:[],lines:[],after:[]},a=uX(n,s);fa(i.before,lu(Wo(a,"beforeLabel",this,s))),fa(i.lines,Wo(a,"label",this,s)),fa(i.after,lu(Wo(a,"afterLabel",this,s))),o.push(i)}),o}getAfterBody(e,r){return lX(Wo(r.callbacks,"afterBody",this,e))}getFooter(e,r){let{callbacks:n}=r,o=Wo(n,"beforeFooter",this,e),s=Wo(n,"footer",this,e),i=Wo(n,"afterFooter",this,e),a=[];return a=fa(a,lu(o)),a=fa(a,lu(s)),a=fa(a,lu(i)),a}_createItems(e){let r=this._active,n=this.chart.data,o=[],s=[],i=[],a=[],l,u;for(l=0,u=r.length;l<u;++l)a.push(Kve(this.chart,r[l]));return e.filter&&(a=a.filter((c,p,f)=>e.filter(c,p,f,n))),e.itemSort&&(a=a.sort((c,p)=>e.itemSort(c,p,n))),At(a,c=>{let p=uX(e.callbacks,c);o.push(Wo(p,"labelColor",this,c)),s.push(Wo(p,"labelPointStyle",this,c)),i.push(Wo(p,"labelTextColor",this,c))}),this.labelColors=o,this.labelPointStyles=s,this.labelTextColors=i,this.dataPoints=a,a}update(e,r){let n=this.options.setContext(this.getContext()),o=this._active,s,i=[];if(!o.length)this.opacity!==0&&(s={opacity:0});else{let a=yv[n.position].call(this,o,this._eventPosition);i=this._createItems(n),this.title=this.getTitle(i,n),this.beforeBody=this.getBeforeBody(i,n),this.body=this.getBody(i,n),this.afterBody=this.getAfterBody(i,n),this.footer=this.getFooter(i,n);let l=this._size=sX(this,n),u=Object.assign({},a,l),c=iX(this.chart,n,u),p=aX(n,u,c,this.chart);this.xAlign=c.xAlign,this.yAlign=c.yAlign,s={opacity:1,x:p.x,y:p.y,width:l.width,height:l.height,caretX:a.x,caretY:a.y}}this._tooltipItems=i,this.$context=void 0,s&&this._resolveAnimations().update(this,s),e&&n.external&&n.external.call(this,{chart:this.chart,tooltip:this,replay:r})}drawCaret(e,r,n,o){let s=this.getCaretPosition(e,n,o);r.lineTo(s.x1,s.y1),r.lineTo(s.x2,s.y2),r.lineTo(s.x3,s.y3)}getCaretPosition(e,r,n){let{xAlign:o,yAlign:s}=this,{caretSize:i,cornerRadius:a}=n,{topLeft:l,topRight:u,bottomLeft:c,bottomRight:p}=ou(a),{x:f,y:d}=e,{width:m,height:h}=r,g,x,y,b,v,C;return s==="center"?(v=d+h/2,o==="left"?(g=f,x=g-i,b=v+i,C=v-i):(g=f+m,x=g+i,b=v-i,C=v+i),y=g):(o==="left"?x=f+Math.max(l,c)+i:o==="right"?x=f+m-Math.max(u,p)-i:x=this.caretX,s==="top"?(b=d,v=b-i,g=x-i,y=x+i):(b=d+h,v=b+i,g=x+i,y=x-i),C=b),{x1:g,x2:x,x3:y,y1:b,y2:v,y3:C}}drawTitle(e,r,n){let o=this.title,s=o.length,i,a,l;if(s){let u=pv(n.rtl,this.x,this.width);for(e.x=PN(this,n.titleAlign,n),r.textAlign=u.textAlign(n.titleAlign),r.textBaseline="middle",i=bo(n.titleFont),a=n.titleSpacing,r.fillStyle=n.titleColor,r.font=i.string,l=0;l<s;++l)r.fillText(o[l],u.x(e.x),e.y+i.lineHeight/2),e.y+=i.lineHeight+a,l+1===s&&(e.y+=n.titleMarginBottom-a)}}_drawColorBox(e,r,n,o,s){let i=this.labelColors[n],a=this.labelPointStyles[n],{boxHeight:l,boxWidth:u,boxPadding:c}=s,p=bo(s.bodyFont),f=PN(this,"left",s),d=o.x(f),m=l<p.lineHeight?(p.lineHeight-l)/2:0,h=r.y+m;if(s.usePointStyle){let g={radius:Math.min(u,l)/2,pointStyle:a.pointStyle,rotation:a.rotation,borderWidth:1},x=o.leftForLtr(d,u)+u/2,y=h+l/2;e.strokeStyle=s.multiKeyBackground,e.fillStyle=s.multiKeyBackground,CN(e,g,x,y),e.strokeStyle=i.borderColor,e.fillStyle=i.backgroundColor,CN(e,g,x,y)}else{e.lineWidth=dt(i.borderWidth)?Math.max(...Object.values(i.borderWidth)):i.borderWidth||1,e.strokeStyle=i.borderColor,e.setLineDash(i.borderDash||[]),e.lineDashOffset=i.borderDashOffset||0;let g=o.leftForLtr(d,u-c),x=o.leftForLtr(o.xPlus(d,1),u-c-2),y=ou(i.borderRadius);Object.values(y).some(b=>b!==0)?(e.beginPath(),e.fillStyle=s.multiKeyBackground,nu(e,{x:g,y:h,w:u,h:l,radius:y}),e.fill(),e.stroke(),e.fillStyle=i.backgroundColor,e.beginPath(),nu(e,{x,y:h+1,w:u-2,h:l-2,radius:y}),e.fill()):(e.fillStyle=s.multiKeyBackground,e.fillRect(g,h,u,l),e.strokeRect(g,h,u,l),e.fillStyle=i.backgroundColor,e.fillRect(x,h+1,u-2,l-2))}e.fillStyle=this.labelTextColors[n]}drawBody(e,r,n){let{body:o}=this,{bodySpacing:s,bodyAlign:i,displayColors:a,boxHeight:l,boxWidth:u,boxPadding:c}=n,p=bo(n.bodyFont),f=p.lineHeight,d=0,m=pv(n.rtl,this.x,this.width),h=function(N){r.fillText(N,m.x(e.x+d),e.y+f/2),e.y+=f+s},g=m.textAlign(i),x,y,b,v,C,S,k;for(r.textAlign=i,r.textBaseline="middle",r.font=p.string,e.x=PN(this,g,n),r.fillStyle=n.bodyColor,At(this.beforeBody,h),d=a&&g!=="right"?i==="center"?u/2+c:u+2+c:0,v=0,S=o.length;v<S;++v){for(x=o[v],y=this.labelTextColors[v],r.fillStyle=y,At(x.before,h),b=x.lines,a&&b.length&&(this._drawColorBox(r,e,v,m,n),f=Math.max(p.lineHeight,l)),C=0,k=b.length;C<k;++C)h(b[C]),f=p.lineHeight;At(x.after,h)}d=0,f=p.lineHeight,At(this.afterBody,h),e.y-=s}drawFooter(e,r,n){let o=this.footer,s=o.length,i,a;if(s){let l=pv(n.rtl,this.x,this.width);for(e.x=PN(this,n.footerAlign,n),e.y+=n.footerMarginTop,r.textAlign=l.textAlign(n.footerAlign),r.textBaseline="middle",i=bo(n.footerFont),r.fillStyle=n.footerColor,r.font=i.string,a=0;a<s;++a)r.fillText(o[a],l.x(e.x),e.y+i.lineHeight/2),e.y+=i.lineHeight+n.footerSpacing}}drawBackground(e,r,n,o){let{xAlign:s,yAlign:i}=this,{x:a,y:l}=e,{width:u,height:c}=n,{topLeft:p,topRight:f,bottomLeft:d,bottomRight:m}=ou(o.cornerRadius);r.fillStyle=o.backgroundColor,r.strokeStyle=o.borderColor,r.lineWidth=o.borderWidth,r.beginPath(),r.moveTo(a+p,l),i==="top"&&this.drawCaret(e,r,n,o),r.lineTo(a+u-f,l),r.quadraticCurveTo(a+u,l,a+u,l+f),i==="center"&&s==="right"&&this.drawCaret(e,r,n,o),r.lineTo(a+u,l+c-m),r.quadraticCurveTo(a+u,l+c,a+u-m,l+c),i==="bottom"&&this.drawCaret(e,r,n,o),r.lineTo(a+d,l+c),r.quadraticCurveTo(a,l+c,a,l+c-d),i==="center"&&s==="left"&&this.drawCaret(e,r,n,o),r.lineTo(a,l+p),r.quadraticCurveTo(a,l,a+p,l),r.closePath(),r.fill(),o.borderWidth>0&&r.stroke()}_updateAnimationTarget(e){let r=this.chart,n=this.$animations,o=n&&n.x,s=n&&n.y;if(o||s){let i=yv[e.position].call(this,this._active,this._eventPosition);if(!i)return;let a=this._size=sX(this,e),l=Object.assign({},i,this._size),u=iX(r,e,l),c=aX(e,l,u,r);(o._to!==c.x||s._to!==c.y)&&(this.xAlign=u.xAlign,this.yAlign=u.yAlign,this.width=a.width,this.height=a.height,this.caretX=i.x,this.caretY=i.y,this._resolveAnimations().update(this,c))}}_willRender(){return!!this.opacity}draw(e){let r=this.options.setContext(this.getContext()),n=this.opacity;if(!n)return;this._updateAnimationTarget(r);let o={width:this.width,height:this.height},s={x:this.x,y:this.y};n=Math.abs(n)<.001?0:n;let i=Vo(r.padding),a=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;r.enabled&&a&&(e.save(),e.globalAlpha=n,this.drawBackground(s,e,o,r),lO(e,r.textDirection),s.y+=i.top,this.drawTitle(s,e,r),this.drawBody(s,e,r),this.drawFooter(s,e,r),uO(e,r.textDirection),e.restore())}getActiveElements(){return this._active||[]}setActiveElements(e,r){let n=this._active,o=e.map(({datasetIndex:a,index:l})=>{let u=this.chart.getDatasetMeta(a);if(!u)throw new Error("Cannot find a dataset at index "+a);return{datasetIndex:a,element:u.data[l],index:l}}),s=!Hg(n,o),i=this._positionChanged(o,r);(s||i)&&(this._active=o,this._eventPosition=r,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(e,r,n=!0){if(r&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;let o=this.options,s=this._active||[],i=this._getActiveElements(e,s,r,n),a=this._positionChanged(i,e),l=r||!Hg(i,s)||a;return l&&(this._active=i,(o.enabled||o.external)&&(this._eventPosition={x:e.x,y:e.y},this.update(!0,r))),l}_getActiveElements(e,r,n,o){let s=this.options;if(e.type==="mouseout")return[];if(!o)return r;let i=this.chart.getElementsAtEventForMode(e,s.mode,s,n);return s.reverse&&i.reverse(),i}_positionChanged(e,r){let{caretX:n,caretY:o,options:s}=this,i=yv[s.position].call(this,e,r);return i!==!1&&(n!==i.x||o!==i.y)}};zt(bv,"positioners",yv);var _X={id:"tooltip",_element:bv,positioners:yv,afterInit(t,e,r){r&&(t.tooltip=new bv({chart:t,options:r}))},beforeUpdate(t,e,r){t.tooltip&&t.tooltip.initialize(r)},reset(t,e,r){t.tooltip&&t.tooltip.initialize(r)},afterDraw(t){let e=t.tooltip;if(e&&e._willRender()){let r={tooltip:e};if(t.notifyPlugins("beforeTooltipDraw",{...r,cancelable:!0})===!1)return;e.draw(t.ctx),t.notifyPlugins("afterTooltipDraw",r)}},afterEvent(t,e){if(t.tooltip){let r=e.replay;t.tooltip.handleEvent(e.event,r,e.inChartArea)&&(e.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(t,e)=>e.bodyFont.size,boxWidth:(t,e)=>e.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:EX},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:t=>t!=="filter"&&t!=="itemSort"&&t!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]};var t1e=(t,e,r,n)=>(typeof e=="string"?(r=t.push(e)-1,n.unshift({index:r,label:e})):isNaN(e)&&(r=null),r);function r1e(t,e,r,n){let o=t.indexOf(e);if(o===-1)return t1e(t,e,r,n);let s=t.lastIndexOf(e);return o!==s?r:o}var n1e=(t,e)=>t===null?null:Qs(Math.round(t),0,e);function cX(t){let e=this.getLabels();return t>=0&&t<e.length?e[t]:t}var ex=class extends cu{constructor(e){super(e),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(e){let r=this._addedLabels;if(r.length){let n=this.getLabels();for(let{index:o,label:s}of r)n[o]===s&&n.splice(o,1);this._addedLabels=[]}super.init(e)}parse(e,r){if(nr(e))return null;let n=this.getLabels();return r=isFinite(r)&&n[r]===e?r:r1e(n,e,xr(r,e),this._addedLabels),n1e(r,n.length-1)}determineDataLimits(){let{minDefined:e,maxDefined:r}=this.getUserBounds(),{min:n,max:o}=this.getMinMax(!0);this.options.bounds==="ticks"&&(e||(n=0),r||(o=this.getLabels().length-1)),this.min=n,this.max=o}buildTicks(){let e=this.min,r=this.max,n=this.options.offset,o=[],s=this.getLabels();s=e===0&&r===s.length-1?s:s.slice(e,r+1),this._valueRange=Math.max(s.length-(n?0:1),1),this._startValue=this.min-(n?.5:0);for(let i=e;i<=r;i++)o.push({value:i});return o}getLabelForValue(e){return cX.call(this,e)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(e){return typeof e!="number"&&(e=this.parse(e)),e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getPixelForTick(e){let r=this.ticks;return e<0||e>r.length-1?null:this.getPixelForValue(r[e].value)}getValueForPixel(e){return Math.round(this._startValue+this.getDecimalForPixel(e)*this._valueRange)}getBasePixel(){return this.bottom}};zt(ex,"id","category"),zt(ex,"defaults",{ticks:{callback:cX}});function o1e(t,e){let r=[],{bounds:o,step:s,min:i,max:a,precision:l,count:u,maxTicks:c,maxDigits:p,includeBounds:f}=t,d=s||1,m=c-1,{min:h,max:g}=e,x=!nr(i),y=!nr(a),b=!nr(u),v=(g-h)/(p+1),C=pN((g-h)/m/d)*d,S,k,N,D;if(C<1e-14&&!x&&!y)return[{value:h},{value:g}];D=Math.ceil(g/C)-Math.floor(h/C),D>m&&(C=pN(D*C/m/d)*d),nr(l)||(S=Math.pow(10,l),C=Math.ceil(C*S)/S),o==="ticks"?(k=Math.floor(h/C)*C,N=Math.ceil(g/C)*C):(k=h,N=g),x&&y&&s&&zR((a-i)/s,C/1e3)?(D=Math.round(Math.min((a-i)/C,c)),C=(a-i)/D,k=i,N=a):b?(k=x?i:k,N=y?a:N,D=u-1,C=(N-k)/D):(D=(N-k)/C,Kg(D,Math.round(D),C/1e3)?D=Math.round(D):D=Math.ceil(D));let $=Math.max(dN(C),dN(k));S=Math.pow(10,nr(l)?$:l),k=Math.round(k*S)/S,N=Math.round(N*S)/S;let O=0;for(x&&(f&&k!==i?(r.push({value:i}),k<i&&O++,Kg(Math.round((k+O*C)*S)/S,i,pX(i,v,t))&&O++):k<i&&O++);O<D;++O)r.push({value:Math.round((k+O*C)*S)/S});return y&&f&&N!==a?r.length&&Kg(r[r.length-1].value,a,pX(a,v,t))?r[r.length-1].value=a:r.push({value:a}):(!y||N===a)&&r.push({value:N}),r}function pX(t,e,{horizontal:r,minRotation:n}){let o=pa(n),s=(r?Math.sin(o):Math.cos(o))||.001,i=.75*e*(""+t).length;return Math.min(e/s,i)}var nx=class extends cu{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(e,r){return nr(e)||(typeof e=="number"||e instanceof Number)&&!isFinite(+e)?null:+e}handleTickRangeOptions(){let{beginAtZero:e}=this.options,{minDefined:r,maxDefined:n}=this.getUserBounds(),{min:o,max:s}=this,i=l=>o=r?o:l,a=l=>s=n?s:l;if(e){let l=jg(o),u=jg(s);l<0&&u<0?a(0):l>0&&u>0&&i(0)}if(o===s){let l=s===0?1:Math.abs(s*.05);a(s+l),e||i(o-l)}this.min=o,this.max=s}getTickLimit(){let e=this.options.ticks,{maxTicksLimit:r,stepSize:n}=e,o;return n?(o=Math.ceil(this.max/n)-Math.floor(this.min/n)+1,o>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${n} would result generating up to ${o} ticks. Limiting to 1000.`),o=1e3)):(o=this.computeTickLimit(),r=r||11),r&&(o=Math.min(r,o)),o}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){let e=this.options,r=e.ticks,n=this.getTickLimit();n=Math.max(2,n);let o={maxTicks:n,bounds:e.bounds,min:e.min,max:e.max,precision:r.precision,step:r.stepSize,count:r.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:r.minRotation||0,includeBounds:r.includeBounds!==!1},s=this._range||this,i=o1e(o,s);return e.bounds==="ticks"&&fN(i,this,"value"),e.reverse?(i.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),i}configure(){let e=this.ticks,r=this.min,n=this.max;if(super.configure(),this.options.offset&&e.length){let o=(n-r)/Math.max(e.length-1,1)/2;r-=o,n+=o}this._startValue=r,this._endValue=n,this._valueRange=n-r}getLabelForValue(e){return av(e,this.chart.options.locale,this.options.ticks.format)}},tx=class extends nx{determineDataLimits(){let{min:e,max:r}=this.getMinMax(!0);this.min=Qr(e)?e:0,this.max=Qr(r)?r:1,this.handleTickRangeOptions()}computeTickLimit(){let e=this.isHorizontal(),r=e?this.width:this.height,n=pa(this.options.ticks.minRotation),o=(e?Math.sin(n):Math.cos(n))||.001,s=this._resolveTickFontOptions(0);return Math.ceil(r/Math.min(40,s.lineHeight/o))}getPixelForValue(e){return e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getValueForPixel(e){return this._startValue+this.getDecimalForPixel(e)*this._valueRange}};zt(tx,"id","linear"),zt(tx,"defaults",{ticks:{callback:lv.formatters.numeric}});var Cv=t=>Math.floor(ca(t)),md=(t,e)=>Math.pow(10,Cv(t)+e);function fX(t){return t/Math.pow(10,Cv(t))===1}function dX(t,e,r){let n=Math.pow(10,r),o=Math.floor(t/n);return Math.ceil(e/n)-o}function s1e(t,e){let r=e-t,n=Cv(r);for(;dX(t,e,n)>10;)n++;for(;dX(t,e,n)<10;)n--;return Math.min(n,Cv(t))}function i1e(t,{min:e,max:r}){e=yo(t.min,e);let n=[],o=Cv(e),s=s1e(e,r),i=s<0?Math.pow(10,Math.abs(s)):1,a=Math.pow(10,s),l=o>s?Math.pow(10,o):0,u=Math.round((e-l)*i)/i,c=Math.floor((e-l)/a/10)*a*10,p=Math.floor((u-c)/Math.pow(10,s)),f=yo(t.min,Math.round((l+c+p*Math.pow(10,s))*i)/i);for(;f<r;)n.push({value:f,major:fX(f),significand:p}),p>=10?p=p<15?15:20:p++,p>=20&&(s++,p=2,i=s>=0?1:i),f=Math.round((l+c+p*Math.pow(10,s))*i)/i;let d=yo(t.max,f);return n.push({value:d,major:fX(d),significand:p}),n}var LN=class extends cu{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(e,r){let n=nx.prototype.parse.apply(this,[e,r]);if(n===0){this._zero=!0;return}return Qr(n)&&n>0?n:null}determineDataLimits(){let{min:e,max:r}=this.getMinMax(!0);this.min=Qr(e)?Math.max(0,e):null,this.max=Qr(r)?Math.max(0,r):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!Qr(this._userMin)&&(this.min=e===md(this.min,0)?md(this.min,-1):md(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){let{minDefined:e,maxDefined:r}=this.getUserBounds(),n=this.min,o=this.max,s=a=>n=e?n:a,i=a=>o=r?o:a;n===o&&(n<=0?(s(1),i(10)):(s(md(n,-1)),i(md(o,1)))),n<=0&&s(md(o,-1)),o<=0&&i(md(n,1)),this.min=n,this.max=o}buildTicks(){let e=this.options,r={min:this._userMin,max:this._userMax},n=i1e(r,this);return e.bounds==="ticks"&&fN(n,this,"value"),e.reverse?(n.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),n}getLabelForValue(e){return e===void 0?"0":av(e,this.chart.options.locale,this.options.ticks.format)}configure(){let e=this.min;super.configure(),this._startValue=ca(e),this._valueRange=ca(this.max)-ca(e)}getPixelForValue(e){return(e===void 0||e===0)&&(e=this.min),e===null||isNaN(e)?NaN:this.getPixelForDecimal(e===this.min?0:(ca(e)-this._startValue)/this._valueRange)}getValueForPixel(e){let r=this.getDecimalForPixel(e);return Math.pow(10,this._startValue+r*this._valueRange)}};zt(LN,"id","logarithmic"),zt(LN,"defaults",{ticks:{callback:lv.formatters.logarithmic,major:{enabled:!0}}});function SO(t){let e=t.ticks;if(e.display&&t.display){let r=Vo(e.backdropPadding);return xr(e.font&&e.font.size,Vr.font.size)+r.height}return 0}function a1e(t,e,r){return r=yr(r)?r:[r],{w:eO(t,e.string,r),h:r.length*e.lineHeight}}function mX(t,e,r,n,o){return t===n||t===o?{start:e-r/2,end:e+r/2}:t<n||t>o?{start:e-r,end:e}:{start:e,end:e+r}}function l1e(t){let e={l:t.left+t._padding.left,r:t.right-t._padding.right,t:t.top+t._padding.top,b:t.bottom-t._padding.bottom},r=Object.assign({},e),n=[],o=[],s=t._pointLabels.length,i=t.options.pointLabels,a=i.centerPointLabels?_n/s:0;for(let l=0;l<s;l++){let u=i.setContext(t.getPointLabelContext(l));o[l]=u.padding;let c=t.getPointPosition(l,t.drawingArea+o[l],a),p=bo(u.font),f=a1e(t.ctx,p,t._pointLabels[l]);n[l]=f;let d=Ys(t.getIndexAngle(l)+a),m=Math.round(nv(d)),h=mX(m,c.x,f.w,0,180),g=mX(m,c.y,f.h,90,270);u1e(r,e,d,h,g)}t.setCenterPoint(e.l-r.l,r.r-e.r,e.t-r.t,r.b-e.b),t._pointLabelItems=c1e(t,n,o)}function u1e(t,e,r,n,o){let s=Math.abs(Math.sin(r)),i=Math.abs(Math.cos(r)),a=0,l=0;n.start<e.l?(a=(e.l-n.start)/s,t.l=Math.min(t.l,e.l-a)):n.end>e.r&&(a=(n.end-e.r)/s,t.r=Math.max(t.r,e.r+a)),o.start<e.t?(l=(e.t-o.start)/i,t.t=Math.min(t.t,e.t-l)):o.end>e.b&&(l=(o.end-e.b)/i,t.b=Math.max(t.b,e.b+l))}function c1e(t,e,r){let n=[],o=t._pointLabels.length,s=t.options,i=SO(s)/2,a=t.drawingArea,l=s.pointLabels.centerPointLabels?_n/o:0;for(let u=0;u<o;u++){let c=t.getPointPosition(u,a+i+r[u],l),p=Math.round(nv(Ys(c.angle+oo))),f=e[u],d=d1e(c.y,f.h,p),m=p1e(p),h=f1e(c.x,f.w,m);n.push({x:c.x,y:d,textAlign:m,left:h,top:d,right:h+f.w,bottom:d+f.h})}return n}function p1e(t){return t===0||t===180?"center":t<180?"left":"right"}function f1e(t,e,r){return r==="right"?t-=e:r==="center"&&(t-=e/2),t}function d1e(t,e,r){return r===90||r===270?t-=e/2:(r>270||r<90)&&(t-=e),t}function m1e(t,e){let{ctx:r,options:{pointLabels:n}}=t;for(let o=e-1;o>=0;o--){let s=n.setContext(t.getPointLabelContext(o)),i=bo(s.font),{x:a,y:l,textAlign:u,left:c,top:p,right:f,bottom:d}=t._pointLabelItems[o],{backdropColor:m}=s;if(!nr(m)){let h=ou(s.borderRadius),g=Vo(s.backdropPadding);r.fillStyle=m;let x=c-g.left,y=p-g.top,b=f-c+g.width,v=d-p+g.height;Object.values(h).some(C=>C!==0)?(r.beginPath(),nu(r,{x,y,w:b,h:v,radius:h}),r.fill()):r.fillRect(x,y,b,v)}Yg(r,t._pointLabels[o],a,l+i.lineHeight/2,i,{color:s.color,textAlign:u,textBaseline:"middle"})}}function AX(t,e,r,n){let{ctx:o}=t;if(r)o.arc(t.xCenter,t.yCenter,e,0,cs);else{let s=t.getPointPosition(0,e);o.moveTo(s.x,s.y);for(let i=1;i<n;i++)s=t.getPointPosition(i,e),o.lineTo(s.x,s.y)}}function h1e(t,e,r,n,o){let s=t.ctx,i=e.circular,{color:a,lineWidth:l}=e;!i&&!n||!a||!l||r<0||(s.save(),s.strokeStyle=a,s.lineWidth=l,s.setLineDash(o.dash),s.lineDashOffset=o.dashOffset,s.beginPath(),AX(t,r,i,n),s.closePath(),s.stroke(),s.restore())}function g1e(t,e,r){return su(t,{label:r,index:e,type:"pointLabel"})}var Zg=class extends nx{constructor(e){super(e),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){let e=this._padding=Vo(SO(this.options)/2),r=this.width=this.maxWidth-e.width,n=this.height=this.maxHeight-e.height;this.xCenter=Math.floor(this.left+r/2+e.left),this.yCenter=Math.floor(this.top+n/2+e.top),this.drawingArea=Math.floor(Math.min(r,n)/2)}determineDataLimits(){let{min:e,max:r}=this.getMinMax(!1);this.min=Qr(e)&&!isNaN(e)?e:0,this.max=Qr(r)&&!isNaN(r)?r:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/SO(this.options))}generateTickLabels(e){nx.prototype.generateTickLabels.call(this,e),this._pointLabels=this.getLabels().map((r,n)=>{let o=br(this.options.pointLabels.callback,[r,n],this);return o||o===0?o:""}).filter((r,n)=>this.chart.getDataVisibility(n))}fit(){let e=this.options;e.display&&e.pointLabels.display?l1e(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(e,r,n,o){this.xCenter+=Math.floor((e-r)/2),this.yCenter+=Math.floor((n-o)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(e,r,n,o))}getIndexAngle(e){let r=cs/(this._pointLabels.length||1),n=this.options.startAngle||0;return Ys(e*r+pa(n))}getDistanceFromCenterForValue(e){if(nr(e))return NaN;let r=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-e)*r:(e-this.min)*r}getValueForDistanceFromCenter(e){if(nr(e))return NaN;let r=e/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-r:this.min+r}getPointLabelContext(e){let r=this._pointLabels||[];if(e>=0&&e<r.length){let n=r[e];return g1e(this.getContext(),e,n)}}getPointPosition(e,r,n=0){let o=this.getIndexAngle(e)-oo+n;return{x:Math.cos(o)*r+this.xCenter,y:Math.sin(o)*r+this.yCenter,angle:o}}getPointPositionForValue(e,r){return this.getPointPosition(e,this.getDistanceFromCenterForValue(r))}getBasePosition(e){return this.getPointPositionForValue(e||0,this.getBaseValue())}getPointLabelPosition(e){let{left:r,top:n,right:o,bottom:s}=this._pointLabelItems[e];return{left:r,top:n,right:o,bottom:s}}drawBackground(){let{backgroundColor:e,grid:{circular:r}}=this.options;if(e){let n=this.ctx;n.save(),n.beginPath(),AX(this,this.getDistanceFromCenterForValue(this._endValue),r,this._pointLabels.length),n.closePath(),n.fillStyle=e,n.fill(),n.restore()}}drawGrid(){let e=this.ctx,r=this.options,{angleLines:n,grid:o,border:s}=r,i=this._pointLabels.length,a,l,u;if(r.pointLabels.display&&m1e(this,i),o.display&&this.ticks.forEach((c,p)=>{if(p!==0){l=this.getDistanceFromCenterForValue(c.value);let f=this.getContext(p),d=o.setContext(f),m=s.setContext(f);h1e(this,d,l,i,m)}}),n.display){for(e.save(),a=i-1;a>=0;a--){let c=n.setContext(this.getPointLabelContext(a)),{color:p,lineWidth:f}=c;!f||!p||(e.lineWidth=f,e.strokeStyle=p,e.setLineDash(c.borderDash),e.lineDashOffset=c.borderDashOffset,l=this.getDistanceFromCenterForValue(r.ticks.reverse?this.min:this.max),u=this.getPointPosition(a,l),e.beginPath(),e.moveTo(this.xCenter,this.yCenter),e.lineTo(u.x,u.y),e.stroke())}e.restore()}}drawBorder(){}drawLabels(){let e=this.ctx,r=this.options,n=r.ticks;if(!n.display)return;let o=this.getIndexAngle(0),s,i;e.save(),e.translate(this.xCenter,this.yCenter),e.rotate(o),e.textAlign="center",e.textBaseline="middle",this.ticks.forEach((a,l)=>{if(l===0&&!r.reverse)return;let u=n.setContext(this.getContext(l)),c=bo(u.font);if(s=this.getDistanceFromCenterForValue(this.ticks[l].value),u.showLabelBackdrop){e.font=c.string,i=e.measureText(a.label).width,e.fillStyle=u.backdropColor;let p=Vo(u.backdropPadding);e.fillRect(-i/2-p.left,-s-c.size/2-p.top,i+p.width,c.size+p.height)}Yg(e,a.label,0,-s,c,{color:u.color})}),e.restore()}drawTitle(){}};zt(Zg,"id","radialLinear"),zt(Zg,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:lv.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(e){return e},padding:5,centerPointLabels:!1}}),zt(Zg,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),zt(Zg,"descriptors",{angleLines:{_fallback:"grid"}});var jN={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},Go=Object.keys(jN);function x1e(t,e){return t-e}function hX(t,e){if(nr(e))return null;let r=t._adapter,{parser:n,round:o,isoWeekday:s}=t._parseOpts,i=e;return typeof n=="function"&&(i=n(i)),Qr(i)||(i=typeof n=="string"?r.parse(i,n):r.parse(i)),i===null?null:(o&&(i=o==="week"&&(Xg(s)||s===!0)?r.startOf(i,"isoWeek",s):r.startOf(i,o)),+i)}function gX(t,e,r,n){let o=Go.length;for(let s=Go.indexOf(t);s<o-1;++s){let i=jN[Go[s]],a=i.steps?i.steps:Number.MAX_SAFE_INTEGER;if(i.common&&Math.ceil((r-e)/(a*i.size))<=n)return Go[s]}return Go[o-1]}function y1e(t,e,r,n,o){for(let s=Go.length-1;s>=Go.indexOf(r);s--){let i=Go[s];if(jN[i].common&&t._adapter.diff(o,n,i)>=e-1)return i}return Go[r?Go.indexOf(r):0]}function b1e(t){for(let e=Go.indexOf(t)+1,r=Go.length;e<r;++e)if(jN[Go[e]].common)return Go[e]}function xX(t,e,r){if(!r)t[e]=!0;else if(r.length){let{lo:n,hi:o}=ov(r,e),s=r[n]>=e?r[n]:r[o];t[s]=!0}}function v1e(t,e,r,n){let o=t._adapter,s=+o.startOf(e[0].value,n),i=e[e.length-1].value,a,l;for(a=s;a<=i;a=+o.add(a,1,n))l=r[a],l>=0&&(e[l].major=!0);return e}function yX(t,e,r){let n=[],o={},s=e.length,i,a;for(i=0;i<s;++i)a=e[i],o[a]=i,n.push({value:a,major:!1});return s===0||!r?n:v1e(t,n,o,r)}var rx=class extends cu{constructor(e){super(e),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(e,r={}){let n=e.time||(e.time={}),o=this._adapter=new Ube._date(e.adapters.date);o.init(r),fd(n.displayFormats,o.formats()),this._parseOpts={parser:n.parser,round:n.round,isoWeekday:n.isoWeekday},super.init(e),this._normalized=r.normalized}parse(e,r){return e===void 0?null:hX(this,e)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){let e=this.options,r=this._adapter,n=e.time.unit||"day",{min:o,max:s,minDefined:i,maxDefined:a}=this.getUserBounds();function l(u){!i&&!isNaN(u.min)&&(o=Math.min(o,u.min)),!a&&!isNaN(u.max)&&(s=Math.max(s,u.max))}(!i||!a)&&(l(this._getLabelBounds()),(e.bounds!=="ticks"||e.ticks.source!=="labels")&&l(this.getMinMax(!1))),o=Qr(o)&&!isNaN(o)?o:+r.startOf(Date.now(),n),s=Qr(s)&&!isNaN(s)?s:+r.endOf(Date.now(),n)+1,this.min=Math.min(o,s-1),this.max=Math.max(o+1,s)}_getLabelBounds(){let e=this.getLabelTimestamps(),r=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;return e.length&&(r=e[0],n=e[e.length-1]),{min:r,max:n}}buildTicks(){let e=this.options,r=e.time,n=e.ticks,o=n.source==="labels"?this.getLabelTimestamps():this._generate();e.bounds==="ticks"&&o.length&&(this.min=this._userMin||o[0],this.max=this._userMax||o[o.length-1]);let s=this.min,i=this.max,a=HR(o,s,i);return this._unit=r.unit||(n.autoSkip?gX(r.minUnit,this.min,this.max,this._getLabelCapacity(s)):y1e(this,a.length,r.minUnit,this.min,this.max)),this._majorUnit=!n.major.enabled||this._unit==="year"?void 0:b1e(this._unit),this.initOffsets(o),e.reverse&&a.reverse(),yX(this,a,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(e=>+e.value))}initOffsets(e=[]){let r=0,n=0,o,s;this.options.offset&&e.length&&(o=this.getDecimalForValue(e[0]),e.length===1?r=1-o:r=(this.getDecimalForValue(e[1])-o)/2,s=this.getDecimalForValue(e[e.length-1]),e.length===1?n=s:n=(s-this.getDecimalForValue(e[e.length-2]))/2);let i=e.length<3?.5:.25;r=Qs(r,0,i),n=Qs(n,0,i),this._offsets={start:r,end:n,factor:1/(r+1+n)}}_generate(){let e=this._adapter,r=this.min,n=this.max,o=this.options,s=o.time,i=s.unit||gX(s.minUnit,r,n,this._getLabelCapacity(r)),a=xr(o.ticks.stepSize,1),l=i==="week"?s.isoWeekday:!1,u=Xg(l)||l===!0,c={},p=r,f,d;if(u&&(p=+e.startOf(p,"isoWeek",l)),p=+e.startOf(p,u?"day":i),e.diff(n,r,i)>1e5*a)throw new Error(r+" and "+n+" are too far apart with stepSize of "+a+" "+i);let m=o.ticks.source==="data"&&this.getDataTimestamps();for(f=p,d=0;f<n;f=+e.add(f,a,i),d++)xX(c,f,m);return(f===n||o.bounds==="ticks"||d===1)&&xX(c,f,m),Object.keys(c).sort((h,g)=>h-g).map(h=>+h)}getLabelForValue(e){let r=this._adapter,n=this.options.time;return n.tooltipFormat?r.format(e,n.tooltipFormat):r.format(e,n.displayFormats.datetime)}_tickFormatFunction(e,r,n,o){let s=this.options,i=s.ticks.callback;if(i)return br(i,[e,r,n],this);let a=s.time.displayFormats,l=this._unit,u=this._majorUnit,c=l&&a[l],p=u&&a[u],f=n[r],d=u&&p&&f&&f.major;return this._adapter.format(e,o||(d?p:c))}generateTickLabels(e){let r,n,o;for(r=0,n=e.length;r<n;++r)o=e[r],o.label=this._tickFormatFunction(o.value,r,e)}getDecimalForValue(e){return e===null?NaN:(e-this.min)/(this.max-this.min)}getPixelForValue(e){let r=this._offsets,n=this.getDecimalForValue(e);return this.getPixelForDecimal((r.start+n)*r.factor)}getValueForPixel(e){let r=this._offsets,n=this.getDecimalForPixel(e)/r.factor-r.end;return this.min+n*(this.max-this.min)}_getLabelSize(e){let r=this.options.ticks,n=this.ctx.measureText(e).width,o=pa(this.isHorizontal()?r.maxRotation:r.minRotation),s=Math.cos(o),i=Math.sin(o),a=this._resolveTickFontOptions(0).size;return{w:n*s+a*i,h:n*i+a*s}}_getLabelCapacity(e){let r=this.options.time,n=r.displayFormats,o=n[r.unit]||n.millisecond,s=this._tickFormatFunction(e,0,yX(this,[e],this._majorUnit),o),i=this._getLabelSize(s),a=Math.floor(this.isHorizontal()?this.width/i.w:this.height/i.h)-1;return a>0?a:1}getDataTimestamps(){let e=this._cache.data||[],r,n;if(e.length)return e;let o=this.getMatchingVisibleMetas();if(this._normalized&&o.length)return this._cache.data=o[0].controller.getAllParsedValues(this);for(r=0,n=o.length;r<n;++r)e=e.concat(o[r].controller.getAllParsedValues(this));return this._cache.data=this.normalize(e)}getLabelTimestamps(){let e=this._cache.labels||[],r,n;if(e.length)return e;let o=this.getLabels();for(r=0,n=o.length;r<n;++r)e.push(hX(this,o[r]));return this._cache.labels=this._normalized?e:this.normalize(e)}normalize(e){return jR(e.sort(x1e))}};zt(rx,"id","time"),zt(rx,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function MN(t,e,r){let n=0,o=t.length-1,s,i,a,l;r?(e>=t[n].pos&&e<=t[o].pos&&({lo:n,hi:o}=sv(t,"pos",e)),{pos:s,time:a}=t[n],{pos:i,time:l}=t[o]):(e>=t[n].time&&e<=t[o].time&&({lo:n,hi:o}=sv(t,"time",e)),{time:s,pos:a}=t[n],{time:i,pos:l}=t[o]);let u=i-s;return u?a+(l-a)*(e-s)/u:a}var zN=class extends rx{constructor(e){super(e),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){let e=this._getTimestampsForTable(),r=this._table=this.buildLookupTable(e);this._minPos=MN(r,this.min),this._tableRange=MN(r,this.max)-this._minPos,super.initOffsets(e)}buildLookupTable(e){let{min:r,max:n}=this,o=[],s=[],i,a,l,u,c;for(i=0,a=e.length;i<a;++i)u=e[i],u>=r&&u<=n&&o.push(u);if(o.length<2)return[{time:r,pos:0},{time:n,pos:1}];for(i=0,a=o.length;i<a;++i)c=o[i+1],l=o[i-1],u=o[i],Math.round((c+l)/2)!==u&&s.push({time:u,pos:i/(a-1)});return s}_getTimestampsForTable(){let e=this._cache.all||[];if(e.length)return e;let r=this.getDataTimestamps(),n=this.getLabelTimestamps();return r.length&&n.length?e=this.normalize(r.concat(n)):e=r.length?r:n,e=this._cache.all=e,e}getDecimalForValue(e){return(MN(this._table,e)-this._minPos)/this._tableRange}getValueForPixel(e){let r=this._offsets,n=this.getDecimalForPixel(e)/r.factor-r.end;return MN(this._table,n*this._tableRange+this._minPos,!0)}};zt(zN,"id","timeseries"),zt(zN,"defaults",rx.defaults);var w1e="1.3.0",xp=class extends gp{initialize(){this.enableOptionSharing=!0,super.initialize()}update(e){let r=this,n=r._cachedMeta;r.updateElements(n.data,0,n.data.length,e)}updateElements(e,r,n,o){let s=this,i=o==="reset",{xScale:a,yScale:l}=s._cachedMeta,u=s.resolveDataElementOptions(r,o),c=s.getSharedOptions(o,e[r],u);for(let p=r;p<r+n;p++){let f=!i&&s.getParsed(p),d=i?a.getBasePixel():a.getPixelForValue(f.x),m=i?l.getBasePixel():l.getPixelForValue(f.y),h=s.resolveDataElementOptions(p,o),{width:g,height:x,anchorX:y,anchorY:b}=h,v={x:C1e(y,d,g),y:S1e(b,m,x),width:g,height:x,options:h};s.updateElement(e[p],p,v,o)}s.updateSharedOptions(c,o)}draw(){let e=this,r=e.getMeta().data||[],n,o;for(n=0,o=r.length;n<o;++n)r[n].draw(e._ctx)}};function C1e(t,e,r){return t==="left"||t==="start"?e:t==="right"||t==="end"?e-r:e-r/2}function S1e(t,e,r){return t==="top"||t==="start"?e:t==="bottom"||t==="end"?e-r:e-r/2}xp.id="matrix";xp.version=w1e;xp.defaults={dataElementType:"matrix",animations:{numbers:{type:"number",properties:["x","y","width","height"]}}};xp.overrides={interaction:{mode:"nearest",intersect:!0},scales:{x:{type:"linear",offset:!0},y:{type:"linear",reverse:!0}}};function DX(t,e){let{x:r,y:n,width:o,height:s}=t.getProps(["x","y","width","height"],e);return{left:r,top:n,right:r+o,bottom:n+s}}function KN(t,e,r){return Math.max(Math.min(t,r),e)}function k1e(t,e,r){let n=t.options.borderWidth,o,s,i,a;return dt(n)?(o=+n.top||0,s=+n.right||0,i=+n.bottom||0,a=+n.left||0):o=s=i=a=+n||0,{t:KN(o,0,r),r:KN(s,0,e),b:KN(i,0,r),l:KN(a,0,e)}}function T1e(t){let e=DX(t),r=e.right-e.left,n=e.bottom-e.top,o=k1e(t,r/2,n/2);return{outer:{x:e.left,y:e.top,w:r,h:n},inner:{x:e.left+o.l,y:e.top+o.t,w:r-o.l-o.r,h:n-o.t-o.b}}}function kO(t,e,r,n){let o=e===null,s=r===null,i=!t||o&&s?!1:DX(t,n);return i&&(o||e>=i.left&&e<=i.right)&&(s||r>=i.top&&r<=i.bottom)}var ox=class extends uu{constructor(e){super(),this.options=void 0,this.width=void 0,this.height=void 0,e&&Object.assign(this,e)}draw(e){let r=this.options,{inner:n,outer:o}=T1e(this),s=ou(r.borderRadius);e.save(),o.w!==n.w||o.h!==n.h?(e.beginPath(),nu(e,{x:o.x,y:o.y,w:o.w,h:o.h,radius:s}),nu(e,{x:n.x,y:n.y,w:n.w,h:n.h,radius:s}),e.fillStyle=r.backgroundColor,e.fill(),e.fillStyle=r.borderColor,e.fill("evenodd")):(e.beginPath(),nu(e,{x:n.x,y:n.y,w:n.w,h:n.h,radius:s}),e.fillStyle=r.backgroundColor,e.fill()),e.restore()}inRange(e,r,n){return kO(this,e,r,n)}inXRange(e,r){return kO(this,e,null,r)}inYRange(e,r){return kO(this,null,e,r)}getCenterPoint(e){let{x:r,y:n,width:o,height:s}=this.getProps(["x","y","width","height"],e);return{x:r+o/2,y:n+s/2}}tooltipPosition(){return this.getCenterPoint()}getRange(e){return e==="x"?this.width/2:this.height/2}};ox.id="matrix";ox.defaults={backgroundColor:void 0,borderColor:void 0,borderWidth:void 0,borderRadius:0,anchorX:"center",anchorY:"center",width:20,height:20};var Uo=rt(pt(),1);var RX="label";function $X(t,e){typeof t=="function"?t(e):t&&(t.current=e)}function N1e(t,e){let r=t.options;r&&e&&Object.assign(r,e)}function OX(t,e){t.labels=e}function FX(t,e){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:RX,n=[];t.datasets=e.map(o=>{let s=t.datasets.find(i=>i[r]===o[r]);return!s||!o.data||n.includes(s)?{...o}:(n.push(s),Object.assign(s,o),s)})}function I1e(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:RX,r={labels:[],datasets:[]};return OX(r,t.labels),FX(r,t.datasets,e),r}function E1e(t,e){let{height:r=150,width:n=300,redraw:o=!1,datasetIdKey:s,type:i,data:a,options:l,plugins:u=[],fallbackContent:c,updateMode:p,...f}=t,d=(0,Uo.useRef)(null),m=(0,Uo.useRef)(),h=()=>{!d.current||(m.current=new qN(d.current,{type:i,data:I1e(a,s),options:l&&{...l},plugins:u}),$X(e,m.current))},g=()=>{$X(e,null),m.current&&(m.current.destroy(),m.current=null)};return(0,Uo.useEffect)(()=>{!o&&m.current&&l&&N1e(m.current,l)},[o,l]),(0,Uo.useEffect)(()=>{!o&&m.current&&OX(m.current.config.data,a.labels)},[o,a.labels]),(0,Uo.useEffect)(()=>{!o&&m.current&&a.datasets&&FX(m.current.config.data,a.datasets,s)},[o,a.datasets]),(0,Uo.useEffect)(()=>{!m.current||(o?(g(),setTimeout(h)):m.current.update(p))},[o,l,a.labels,a.datasets,p]),(0,Uo.useEffect)(()=>{!m.current||(g(),setTimeout(h))},[i]),(0,Uo.useEffect)(()=>(h(),()=>g()),[]),Uo.default.createElement("canvas",Object.assign({ref:d,role:"img",height:r,width:n},f),c)}var PX=(0,Uo.forwardRef)(E1e);var XN=rt(Bf());qN.register(ex,_X,ox,xp,tx);var _1e="rgb(200,200,200)";function YN({attention:t,maxValue:e=1,minValue:r=-1,negativeColor:n,positiveColor:o,upperTriColor:s=_1e,showAxisLabels:i=!0,zoomed:a=!1,maskUpperTri:l=!0,tokens:u}){let c=(0,yp.useMemo)(()=>u.map((m,h)=>`${m.replace(/\s/g,"")} (${h})`),[u]),f={datasets:[{data:(0,yp.useMemo)(()=>t.map((m,h)=>m.map((g,x)=>({srcIdx:x,destIdx:h,srcToken:u[x],destToken:u[h],x:c[x],y:c[h],v:g}))).flat(),[t,u,c]),backgroundColor(m){let h=m.dataset.data[m.dataIndex];return l&&h.srcIdx>h.destIdx?ur(s).toRgbString():up(h.v,r,e,n,o).toRgbString()},width:m=>m.chart.chartArea.width/u.length,height:m=>m.chart.chartArea.height/u.length}]},d={animation:{duration:0},plugins:{tooltip:{enabled:i,yAlign:"bottom",callbacks:{title:()=>"",label({raw:m}){let h=m;return l&&h.destIdx<h.srcIdx?"N/A":[`(${h.destIdx}, ${h.srcIdx})`,`Src: ${h.srcToken}`,`Dest: ${h.destToken} `,`Val: ${h.v}`]}}}},scales:{x:{title:{display:!0,text:"Source Token",padding:1},type:"category",labels:c,offset:!0,ticks:{display:!0,minRotation:45,maxRotation:90},grid:{display:!1},display:i},y:{title:{display:!0,text:"Destination Token",padding:1},type:"category",offset:!0,labels:[...c].reverse(),ticks:{display:!0},grid:{display:!1},display:i}}};return yp.default.createElement(XN.Col,null,yp.default.createElement(XN.Row,null,yp.default.createElement("div",{style:{position:"relative",maxWidth:a?`min(100%, ${Math.round(u.length*8)}em)`:"initial",width:a?"initial":"100%",aspectRatio:"1/1"}},yp.default.createElement(PX,{type:"matrix",options:d,data:f,width:1e3,height:1e3,updateMode:"none"}))))}var TO=rt(pt());function hd(t=null){let[e,r]=(0,TO.useState)(null),[n,o]=(0,TO.useState)(t);function s(u){o(u)}function i(u){r(u)}function a(){r(null)}return{focused:e??n,onClick:s,onMouseEnter:i,onMouseLeave:a}}function QN(t,e,r="100%"){return`hsla(${Math.round(t/e*360)}, 70%, 50%,  ${r})`}function A1e({attention:t,attentionHeadNames:e,focused:r,maxValue:n,minValue:o,negativeColor:s,onClick:i,onMouseEnter:a,onMouseLeave:l,positiveColor:u,maskUpperTri:c,tokens:p}){return Vn.default.createElement(pu.Row,{style:{marginBottom:15}},t.map((f,d)=>{let m=r===d;return Vn.default.createElement(pu.Col,{lg:1,md:2,xs:3,style:{margin:0,padding:0},key:d},Vn.default.createElement("div",{style:{padding:3},onClick:()=>i(d),onMouseEnter:()=>a(d),onMouseLeave:l},Vn.default.createElement("div",{style:{position:"relative",borderStyle:"solid",borderWidth:1,borderColor:QN(d,t.length),boxShadow:m?`0px 0px 4px 3px ${QN(d,t.length,"60%")}`:void 0}},Vn.default.createElement("h4",{style:{position:"absolute",top:0,right:0,zIndex:100,margin:0,padding:1,background:QN(d,t.length),color:"white"}},e[d]),Vn.default.createElement(YN,{attention:f,tokens:p,showAxisLabels:!1,maxValue:n,minValue:o,negativeColor:s,positiveColor:u,maskUpperTri:c}))))}))}function D1e({attention:t,attentionHeadNames:e,maxValue:r,minValue:n,negativeColor:o,positiveColor:s,maskUpperTri:i=!0,tokens:a}){let{focused:l,onClick:u,onMouseEnter:c,onMouseLeave:p}=hd(0),f=e||t.map((d,m)=>`Head ${m}`);return Vn.default.createElement(pu.Container,null,Vn.default.createElement("h3",{style:{marginBottom:15}},"Head Selector (hover to view, click to lock)"),Vn.default.createElement(A1e,{attention:t,attentionHeadNames:f,focused:l,maxValue:r,minValue:n,negativeColor:o,onClick:u,onMouseEnter:c,onMouseLeave:p,positiveColor:s,maskUpperTri:i,tokens:a}),Vn.default.createElement(pu.Row,null,Vn.default.createElement(pu.Col,{xs:12},Vn.default.createElement("h3",{style:{marginBottom:10}},f[l]," Zoomed"),Vn.default.createElement("div",null,Vn.default.createElement("h2",{style:{position:"absolute",top:0,right:0,zIndex:1e3,margin:6,padding:"5px 10px",background:QN(l,t.length),color:"white"}},f[l]),Vn.default.createElement(YN,{attention:t[l],maxValue:r,minValue:n,negativeColor:o,positiveColor:s,zoomed:!0,maskUpperTri:i,tokens:a})))),Vn.default.createElement(pu.Row,null))}var fr=rt(pt());var zX=rt(NO());var sx=rt(pt());function IO({coloredAttention:t,style:e={},isSelected:r=!1}){let n=(0,sx.useRef)(null);return(0,sx.useEffect)(()=>{let o=n.current;Ex.toPixels(t.toInt(),o)},[t]),sx.default.createElement("canvas",{ref:n,style:{imageRendering:"pixelated",borderColor:r?"rgba(0,0,200,0.5)":"#DDD",borderStyle:"solid",borderWidth:1,boxShadow:r?"0px 0px 3px 3px rgba(0,0,200,0.4)":void 0,width:200,...e}})}var LX=rt(NO()),JN=rt(pt());function $1e(t,e,r,n){let o=e,s=e,i=0,a=e;return typeof n=="number"&&r==="DESTINATION_TO_SOURCE"?(o=n,s=n,i=e,a=e):typeof n=="number"&&r==="SOURCE_TO_DESTINATION"&&(o=e,s=e,i=n,a=n),t.slice([o,i],[s+1-o,a+1-i])}function R1e({focusedToken:t,onClickToken:e,onMouseEnterToken:r,onMouseLeaveToken:n,maxAttentionAcrossHeads:o,text:s,tokenIndex:i,tokensView:a}){let l=t!==null&&t===i,c=$1e(o,i,a,t).mean(0).mean(0),[p,f,d]=c.arraySync(),m=(0,LX.default)({r:p,g:f,b:d}),h=m.getBrightness()<180?"white":"black";return JN.default.createElement("button",{style:{backgroundColor:m.toRgbString(),borderColor:"#DDD",borderStyle:"solid",borderWidth:0,borderRightWidth:1,color:h,display:"inline-block",marginBottom:3,padding:"3px 0px",boxShadow:l?"0px 0px 3px 3px rgba(0,0,200,0.4)":void 0},onClick:()=>e(i),onMouseEnter:()=>r(i),onMouseLeave:n,dangerouslySetInnerHTML:{__html:s.replace(" ","&nbsp;")}})}function MX({coloredAttention:t,focusedHead:e,focusedToken:r,onClickToken:n,onMouseEnterToken:o,onMouseLeaveToken:s,tokens:i,tokensView:a}){let l=typeof e=="number"?t.slice([e],[1]):t,u=Fx("hdsc -> dsch",l).min(3);return JN.default.createElement("div",null,i.map((c,p)=>JN.default.createElement(R1e,{focusedToken:r,onClickToken:n,onMouseEnterToken:o,onMouseLeaveToken:s,key:p,maxAttentionAcrossHeads:u,text:c,tokenIndex:p,tokensView:a})))}function O1e(t){let r=Cr(t).arraySync(),n=r.map((o,s)=>o.map(i=>i.map(a=>{let l=(0,zX.default)({h:s/r.length*360,s:.8,l:1-.75*a}),{r:u,g:c,b:p}=l.toRgb();return[u,c,p]})));return Cr(n)}function F1e({tokens:t,attention:e,headLabels:r}){let[n,o]=(0,fr.useState)("DESTINATION_TO_SOURCE"),{focused:s,onClick:i,onMouseEnter:a,onMouseLeave:l}=hd(),{focused:u,onClick:c,onMouseEnter:p,onMouseLeave:f}=hd(),d=(0,fr.useMemo)(()=>O1e(e),[e]),m=d.unstack(0),h=Fx("hdsc -> dsch",d).min(3),g=s===null?h:m[s];return fr.default.createElement("div",null,fr.default.createElement("div",{style:{display:"flex"}},fr.default.createElement("div",null,fr.default.createElement("h4",null,"Attention Patterns"),fr.default.createElement(IO,{coloredAttention:g})),fr.default.createElement("div",{style:{marginLeft:15}},fr.default.createElement("h4",null,"Head selector",fr.default.createElement("span",{style:{fontWeight:"normal"}}," ","(hover to focus, click to lock)")),fr.default.createElement("div",{style:{display:"flex",flexWrap:"wrap"}},m.map((x,y)=>fr.default.createElement("figure",{key:y,style:{margin:0,marginRight:15},onClick:()=>i(y),onMouseEnter:()=>a(y),onMouseLeave:l},fr.default.createElement(IO,{coloredAttention:x,style:{width:80},isSelected:y===s}),fr.default.createElement("figcaption",null,r?.[y]??`Head ${y}`)))))),fr.default.createElement("div",{className:"tokens"},fr.default.createElement("h4",{style:{display:"inline-block",marginRight:15}},"Tokens",fr.default.createElement("span",{style:{fontWeight:"normal"}}," (click to focus)")),fr.default.createElement("select",{value:n,onChange:x=>o(x.target.value)},fr.default.createElement("option",{value:"DESTINATION_TO_SOURCE"},"Source \u2190 Destination"),fr.default.createElement("option",{value:"SOURCE_TO_DESTINATION"},"Destination \u2190 Source")),fr.default.createElement("div",null,fr.default.createElement(MX,{coloredAttention:d,focusedHead:s,focusedToken:u,onClickToken:c,onMouseEnterToken:p,onMouseLeaveToken:f,tokens:t,tokensView:n}))))}function gd(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function EO(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function eI(t){let e,r,n;t.length!==2?(e=gd,r=(a,l)=>gd(t(a),l),n=(a,l)=>t(a)-l):(e=t===gd||t===EO?t:P1e,r=t,n=t);function o(a,l,u=0,c=a.length){if(u<c){if(e(l,l)!==0)return c;do{let p=u+c>>>1;r(a[p],l)<0?u=p+1:c=p}while(u<c)}return u}function s(a,l,u=0,c=a.length){if(u<c){if(e(l,l)!==0)return c;do{let p=u+c>>>1;r(a[p],l)<=0?u=p+1:c=p}while(u<c)}return u}function i(a,l,u=0,c=a.length){let p=o(a,l,u,c-1);return p>u&&n(a[p-1],l)>-n(a[p],l)?p-1:p}return{left:o,center:i,right:s}}function P1e(){return 0}function _O(t){return t===null?NaN:+t}var BX=eI(gd),VX=BX.right,L1e=BX.left,M1e=eI(_O).center,AO=VX;var z1e=Math.sqrt(50),B1e=Math.sqrt(10),V1e=Math.sqrt(2);function tI(t,e,r){let n=(e-t)/Math.max(0,r),o=Math.floor(Math.log10(n)),s=n/Math.pow(10,o),i=s>=z1e?10:s>=B1e?5:s>=V1e?2:1,a,l,u;return o<0?(u=Math.pow(10,-o)/i,a=Math.round(t*u),l=Math.round(e*u),a/u<t&&++a,l/u>e&&--l,u=-u):(u=Math.pow(10,o)*i,a=Math.round(t/u),l=Math.round(e/u),a*u<t&&++a,l*u>e&&--l),l<a&&.5<=r&&r<2?tI(t,e,r*2):[a,l,u]}function rI(t,e,r){if(e=+e,t=+t,r=+r,!(r>0))return[];if(t===e)return[t];let n=e<t,[o,s,i]=n?tI(e,t,r):tI(t,e,r);if(!(s>=o))return[];let a=s-o+1,l=new Array(a);if(n)if(i<0)for(let u=0;u<a;++u)l[u]=(s-u)/-i;else for(let u=0;u<a;++u)l[u]=(s-u)*i;else if(i<0)for(let u=0;u<a;++u)l[u]=(o+u)/-i;else for(let u=0;u<a;++u)l[u]=(o+u)*i;return l}function kv(t,e,r){return e=+e,t=+t,r=+r,tI(t,e,r)[2]}function DO(t,e,r){e=+e,t=+t,r=+r;let n=e<t,o=n?kv(e,t,r):kv(t,e,r);return(n?-1:1)*(o<0?1/-o:o)}function WX(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function GX(t,e){switch(arguments.length){case 0:break;case 1:{typeof t=="function"?this.interpolator(t):this.range(t);break}default:{this.domain(t),typeof e=="function"?this.interpolator(e):this.range(e);break}}return this}function ix(t,e,r){t.prototype=e.prototype=r,r.constructor=t}function Tv(t,e){var r=Object.create(t.prototype);for(var n in e)r[n]=e[n];return r}function vd(){}var bp=.7,bd=1/bp,ax="\\s*([+-]?\\d+)\\s*",Nv="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",ha="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",W1e=/^#([0-9a-f]{3,8})$/,G1e=new RegExp(`^rgb\\(${ax},${ax},${ax}\\)$`),U1e=new RegExp(`^rgb\\(${ha},${ha},${ha}\\)$`),H1e=new RegExp(`^rgba\\(${ax},${ax},${ax},${Nv}\\)$`),q1e=new RegExp(`^rgba\\(${ha},${ha},${ha},${Nv}\\)$`),j1e=new RegExp(`^hsl\\(${Nv},${ha},${ha}\\)$`),K1e=new RegExp(`^hsla\\(${Nv},${ha},${ha},${Nv}\\)$`),UX={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};ix(vd,vp,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:HX,formatHex:HX,formatHex8:X1e,formatHsl:Y1e,formatRgb:qX,toString:qX});function HX(){return this.rgb().formatHex()}function X1e(){return this.rgb().formatHex8()}function Y1e(){return ZX(this).formatHsl()}function qX(){return this.rgb().formatRgb()}function vp(t){var e,r;return t=(t+"").trim().toLowerCase(),(e=W1e.exec(t))?(r=e[1].length,e=parseInt(e[1],16),r===6?jX(e):r===3?new Wn(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):r===8?nI(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):r===4?nI(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=G1e.exec(t))?new Wn(e[1],e[2],e[3],1):(e=U1e.exec(t))?new Wn(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=H1e.exec(t))?nI(e[1],e[2],e[3],e[4]):(e=q1e.exec(t))?nI(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=j1e.exec(t))?YX(e[1],e[2]/100,e[3]/100,1):(e=K1e.exec(t))?YX(e[1],e[2]/100,e[3]/100,e[4]):UX.hasOwnProperty(t)?jX(UX[t]):t==="transparent"?new Wn(NaN,NaN,NaN,0):null}function jX(t){return new Wn(t>>16&255,t>>8&255,t&255,1)}function nI(t,e,r,n){return n<=0&&(t=e=r=NaN),new Wn(t,e,r,n)}function RO(t){return t instanceof vd||(t=vp(t)),t?(t=t.rgb(),new Wn(t.r,t.g,t.b,t.opacity)):new Wn}function lx(t,e,r,n){return arguments.length===1?RO(t):new Wn(t,e,r,n??1)}function Wn(t,e,r,n){this.r=+t,this.g=+e,this.b=+r,this.opacity=+n}ix(Wn,lx,Tv(vd,{brighter(t){return t=t==null?bd:Math.pow(bd,t),new Wn(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?bp:Math.pow(bp,t),new Wn(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Wn(yd(this.r),yd(this.g),yd(this.b),sI(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:KX,formatHex:KX,formatHex8:Q1e,formatRgb:XX,toString:XX}));function KX(){return`#${xd(this.r)}${xd(this.g)}${xd(this.b)}`}function Q1e(){return`#${xd(this.r)}${xd(this.g)}${xd(this.b)}${xd((isNaN(this.opacity)?1:this.opacity)*255)}`}function XX(){let t=sI(this.opacity);return`${t===1?"rgb(":"rgba("}${yd(this.r)}, ${yd(this.g)}, ${yd(this.b)}${t===1?")":`, ${t})`}`}function sI(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function yd(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function xd(t){return t=yd(t),(t<16?"0":"")+t.toString(16)}function YX(t,e,r,n){return n<=0?t=e=r=NaN:r<=0||r>=1?t=e=NaN:e<=0&&(t=NaN),new Ai(t,e,r,n)}function ZX(t){if(t instanceof Ai)return new Ai(t.h,t.s,t.l,t.opacity);if(t instanceof vd||(t=vp(t)),!t)return new Ai;if(t instanceof Ai)return t;t=t.rgb();var e=t.r/255,r=t.g/255,n=t.b/255,o=Math.min(e,r,n),s=Math.max(e,r,n),i=NaN,a=s-o,l=(s+o)/2;return a?(e===s?i=(r-n)/a+(r<n)*6:r===s?i=(n-e)/a+2:i=(e-r)/a+4,a/=l<.5?s+o:2-s-o,i*=60):a=l>0&&l<1?0:i,new Ai(i,a,l,t.opacity)}function JX(t,e,r,n){return arguments.length===1?ZX(t):new Ai(t,e,r,n??1)}function Ai(t,e,r,n){this.h=+t,this.s=+e,this.l=+r,this.opacity=+n}ix(Ai,JX,Tv(vd,{brighter(t){return t=t==null?bd:Math.pow(bd,t),new Ai(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?bp:Math.pow(bp,t),new Ai(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*e,o=2*r-n;return new Wn($O(t>=240?t-240:t+120,o,n),$O(t,o,n),$O(t<120?t+240:t-120,o,n),this.opacity)},clamp(){return new Ai(QX(this.h),oI(this.s),oI(this.l),sI(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){let t=sI(this.opacity);return`${t===1?"hsl(":"hsla("}${QX(this.h)}, ${oI(this.s)*100}%, ${oI(this.l)*100}%${t===1?")":`, ${t})`}`}}));function QX(t){return t=(t||0)%360,t<0?t+360:t}function oI(t){return Math.max(0,Math.min(1,t||0))}function $O(t,e,r){return(t<60?e+(r-e)*t/60:t<180?r:t<240?e+(r-e)*(240-t)/60:e)*255}var eY=Math.PI/180,tY=180/Math.PI;var sY=-.14861,OO=1.78277,FO=-.29227,iI=-.90649,Iv=1.97294,rY=Iv*iI,nY=Iv*OO,oY=OO*FO-iI*sY;function Z1e(t){if(t instanceof wd)return new wd(t.h,t.s,t.l,t.opacity);t instanceof Wn||(t=RO(t));var e=t.r/255,r=t.g/255,n=t.b/255,o=(oY*n+rY*e-nY*r)/(oY+rY-nY),s=n-o,i=(Iv*(r-o)-FO*s)/iI,a=Math.sqrt(i*i+s*s)/(Iv*o*(1-o)),l=a?Math.atan2(i,s)*tY-120:NaN;return new wd(l<0?l+360:l,a,o,t.opacity)}function Zs(t,e,r,n){return arguments.length===1?Z1e(t):new wd(t,e,r,n??1)}function wd(t,e,r,n){this.h=+t,this.s=+e,this.l=+r,this.opacity=+n}ix(wd,Zs,Tv(vd,{brighter(t){return t=t==null?bd:Math.pow(bd,t),new wd(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?bp:Math.pow(bp,t),new wd(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=isNaN(this.h)?0:(this.h+120)*eY,e=+this.l,r=isNaN(this.s)?0:this.s*e*(1-e),n=Math.cos(t),o=Math.sin(t);return new Wn(255*(e+r*(sY*n+OO*o)),255*(e+r*(FO*n+iI*o)),255*(e+r*(Iv*n)),this.opacity)}}));function PO(t,e,r,n,o){var s=t*t,i=s*t;return((1-3*t+3*s-i)*e+(4-6*s+3*i)*r+(1+3*t+3*s-3*i)*n+i*o)/6}function iY(t){var e=t.length-1;return function(r){var n=r<=0?r=0:r>=1?(r=1,e-1):Math.floor(r*e),o=t[n],s=t[n+1],i=n>0?t[n-1]:2*o-s,a=n<e-1?t[n+2]:2*s-o;return PO((r-n/e)*e,i,o,s,a)}}function aY(t){var e=t.length;return function(r){var n=Math.floor(((r%=1)<0?++r:r)*e),o=t[(n+e-1)%e],s=t[n%e],i=t[(n+1)%e],a=t[(n+2)%e];return PO((r-n/e)*e,o,s,i,a)}}var ux=t=>()=>t;function lY(t,e){return function(r){return t+r*e}}function J1e(t,e,r){return t=Math.pow(t,r),e=Math.pow(e,r)-t,r=1/r,function(n){return Math.pow(t+n*e,r)}}function uY(t,e){var r=e-t;return r?lY(t,r>180||r<-180?r-360*Math.round(r/360):r):ux(isNaN(t)?e:t)}function cY(t){return(t=+t)==1?fu:function(e,r){return r-e?J1e(e,r,t):ux(isNaN(e)?r:e)}}function fu(t,e){var r=e-t;return r?lY(t,r):ux(isNaN(t)?e:t)}var aI=function t(e){var r=cY(e);function n(o,s){var i=r((o=lx(o)).r,(s=lx(s)).r),a=r(o.g,s.g),l=r(o.b,s.b),u=fu(o.opacity,s.opacity);return function(c){return o.r=i(c),o.g=a(c),o.b=l(c),o.opacity=u(c),o+""}}return n.gamma=t,n}(1);function pY(t){return function(e){var r=e.length,n=new Array(r),o=new Array(r),s=new Array(r),i,a;for(i=0;i<r;++i)a=lx(e[i]),n[i]=a.r||0,o[i]=a.g||0,s[i]=a.b||0;return n=t(n),o=t(o),s=t(s),a.opacity=1,function(l){return a.r=n(l),a.g=o(l),a.b=s(l),a+""}}}var LO=pY(iY),ewe=pY(aY);function fY(t,e){e||(e=[]);var r=t?Math.min(e.length,t.length):0,n=e.slice(),o;return function(s){for(o=0;o<r;++o)n[o]=t[o]*(1-s)+e[o]*s;return n}}function dY(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function mY(t,e){var r=e?e.length:0,n=t?Math.min(r,t.length):0,o=new Array(n),s=new Array(r),i;for(i=0;i<n;++i)o[i]=du(t[i],e[i]);for(;i<r;++i)s[i]=e[i];return function(a){for(i=0;i<n;++i)s[i]=o[i](a);return s}}function hY(t,e){var r=new Date;return t=+t,e=+e,function(n){return r.setTime(t*(1-n)+e*n),r}}function wp(t,e){return t=+t,e=+e,function(r){return t*(1-r)+e*r}}function gY(t,e){var r={},n={},o;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(o in e)o in t?r[o]=du(t[o],e[o]):n[o]=e[o];return function(s){for(o in r)n[o]=r[o](s);return n}}var zO=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,MO=new RegExp(zO.source,"g");function twe(t){return function(){return t}}function rwe(t){return function(e){return t(e)+""}}function xY(t,e){var r=zO.lastIndex=MO.lastIndex=0,n,o,s,i=-1,a=[],l=[];for(t=t+"",e=e+"";(n=zO.exec(t))&&(o=MO.exec(e));)(s=o.index)>r&&(s=e.slice(r,s),a[i]?a[i]+=s:a[++i]=s),(n=n[0])===(o=o[0])?a[i]?a[i]+=o:a[++i]=o:(a[++i]=null,l.push({i,x:wp(n,o)})),r=MO.lastIndex;return r<e.length&&(s=e.slice(r),a[i]?a[i]+=s:a[++i]=s),a.length<2?l[0]?rwe(l[0].x):twe(e):(e=l.length,function(u){for(var c=0,p;c<e;++c)a[(p=l[c]).i]=p.x(u);return a.join("")})}function du(t,e){var r=typeof e,n;return e==null||r==="boolean"?ux(e):(r==="number"?wp:r==="string"?(n=vp(e))?(e=n,aI):xY:e instanceof vp?aI:e instanceof Date?hY:dY(e)?fY:Array.isArray(e)?mY:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?gY:wp)(t,e)}function Ev(t,e){return t=+t,e=+e,function(r){return Math.round(t*(1-r)+e*r)}}function yY(t){return function e(r){r=+r;function n(o,s){var i=t((o=Zs(o)).h,(s=Zs(s)).h),a=fu(o.s,s.s),l=fu(o.l,s.l),u=fu(o.opacity,s.opacity);return function(c){return o.h=i(c),o.s=a(c),o.l=l(Math.pow(c,r)),o.opacity=u(c),o+""}}return n.gamma=e,n}(1)}var nwe=yY(uY),lI=yY(fu);function BO(t){return function(){return t}}function VO(t){return+t}var bY=[0,1];function mu(t){return t}function WO(t,e){return(e-=t=+t)?function(r){return(r-t)/e}:BO(isNaN(e)?NaN:.5)}function owe(t,e){var r;return t>e&&(r=t,t=e,e=r),function(n){return Math.max(t,Math.min(e,n))}}function swe(t,e,r){var n=t[0],o=t[1],s=e[0],i=e[1];return o<n?(n=WO(o,n),s=r(i,s)):(n=WO(n,o),s=r(s,i)),function(a){return s(n(a))}}function iwe(t,e,r){var n=Math.min(t.length,e.length)-1,o=new Array(n),s=new Array(n),i=-1;for(t[n]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++i<n;)o[i]=WO(t[i],t[i+1]),s[i]=r(e[i],e[i+1]);return function(a){var l=AO(t,a,1,n)-1;return s[l](o[l](a))}}function vY(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function awe(){var t=bY,e=bY,r=du,n,o,s,i=mu,a,l,u;function c(){var f=Math.min(t.length,e.length);return i!==mu&&(i=owe(t[0],t[f-1])),a=f>2?iwe:swe,l=u=null,p}function p(f){return f==null||isNaN(f=+f)?s:(l||(l=a(t.map(n),e,r)))(n(i(f)))}return p.invert=function(f){return i(o((u||(u=a(e,t.map(n),wp)))(f)))},p.domain=function(f){return arguments.length?(t=Array.from(f,VO),c()):t.slice()},p.range=function(f){return arguments.length?(e=Array.from(f),c()):e.slice()},p.rangeRound=function(f){return e=Array.from(f),r=Ev,c()},p.clamp=function(f){return arguments.length?(i=f?!0:mu,c()):i!==mu},p.interpolate=function(f){return arguments.length?(r=f,c()):r},p.unknown=function(f){return arguments.length?(s=f,p):s},function(f,d){return n=f,o=d,c()}}function GO(){return awe()(mu,mu)}function wY(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function Cd(t,e){if((r=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var r,n=t.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+t.slice(r+1)]}function ga(t){return t=Cd(Math.abs(t)),t?t[1]:NaN}function CY(t,e){return function(r,n){for(var o=r.length,s=[],i=0,a=t[0],l=0;o>0&&a>0&&(l+a+1>n&&(a=Math.max(1,n-l)),s.push(r.substring(o-=a,o+a)),!((l+=a+1)>n));)a=t[i=(i+1)%t.length];return s.reverse().join(e)}}function SY(t){return function(e){return e.replace(/[0-9]/g,function(r){return t[+r]})}}var lwe=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Cp(t){if(!(e=lwe.exec(t)))throw new Error("invalid format: "+t);var e;return new uI({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}Cp.prototype=uI.prototype;function uI(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}uI.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function kY(t){e:for(var e=t.length,r=1,n=-1,o;r<e;++r)switch(t[r]){case".":n=o=r;break;case"0":n===0&&(n=r),o=r;break;default:if(!+t[r])break e;n>0&&(n=0);break}return n>0?t.slice(0,n)+t.slice(o+1):t}var UO;function TY(t,e){var r=Cd(t,e);if(!r)return t+"";var n=r[0],o=r[1],s=o-(UO=Math.max(-8,Math.min(8,Math.floor(o/3)))*3)+1,i=n.length;return s===i?n:s>i?n+new Array(s-i+1).join("0"):s>0?n.slice(0,s)+"."+n.slice(s):"0."+new Array(1-s).join("0")+Cd(t,Math.max(0,e+s-1))[0]}function HO(t,e){var r=Cd(t,e);if(!r)return t+"";var n=r[0],o=r[1];return o<0?"0."+new Array(-o).join("0")+n:n.length>o+1?n.slice(0,o+1)+"."+n.slice(o+1):n+new Array(o-n.length+2).join("0")}var qO={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:wY,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>HO(t*100,e),r:HO,s:TY,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function jO(t){return t}var NY=Array.prototype.map,IY=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function EY(t){var e=t.grouping===void 0||t.thousands===void 0?jO:CY(NY.call(t.grouping,Number),t.thousands+""),r=t.currency===void 0?"":t.currency[0]+"",n=t.currency===void 0?"":t.currency[1]+"",o=t.decimal===void 0?".":t.decimal+"",s=t.numerals===void 0?jO:SY(NY.call(t.numerals,String)),i=t.percent===void 0?"%":t.percent+"",a=t.minus===void 0?"\u2212":t.minus+"",l=t.nan===void 0?"NaN":t.nan+"";function u(p){p=Cp(p);var f=p.fill,d=p.align,m=p.sign,h=p.symbol,g=p.zero,x=p.width,y=p.comma,b=p.precision,v=p.trim,C=p.type;C==="n"?(y=!0,C="g"):qO[C]||(b===void 0&&(b=12),v=!0,C="g"),(g||f==="0"&&d==="=")&&(g=!0,f="0",d="=");var S=h==="$"?r:h==="#"&&/[boxX]/.test(C)?"0"+C.toLowerCase():"",k=h==="$"?n:/[%p]/.test(C)?i:"",N=qO[C],D=/[defgprs%]/.test(C);b=b===void 0?6:/[gprs]/.test(C)?Math.max(1,Math.min(21,b)):Math.max(0,Math.min(20,b));function $(O){var V=S,K=k,X,W,H;if(C==="c")K=N(O)+K,O="";else{O=+O;var Y=O<0||1/O<0;if(O=isNaN(O)?l:N(Math.abs(O),b),v&&(O=kY(O)),Y&&+O==0&&m!=="+"&&(Y=!1),V=(Y?m==="("?m:a:m==="-"||m==="("?"":m)+V,K=(C==="s"?IY[8+UO/3]:"")+K+(Y&&m==="("?")":""),D){for(X=-1,W=O.length;++X<W;)if(H=O.charCodeAt(X),48>H||H>57){K=(H===46?o+O.slice(X+1):O.slice(X))+K,O=O.slice(0,X);break}}}y&&!g&&(O=e(O,1/0));var Z=V.length+O.length+K.length,Q=Z<x?new Array(x-Z+1).join(f):"";switch(y&&g&&(O=e(Q+O,Q.length?x-K.length:1/0),Q=""),d){case"<":O=V+O+K+Q;break;case"=":O=V+Q+O+K;break;case"^":O=Q.slice(0,Z=Q.length>>1)+V+O+K+Q.slice(Z);break;default:O=Q+V+O+K;break}return s(O)}return $.toString=function(){return p+""},$}function c(p,f){var d=u((p=Cp(p),p.type="f",p)),m=Math.max(-8,Math.min(8,Math.floor(ga(f)/3)))*3,h=Math.pow(10,-m),g=IY[8+m/3];return function(x){return d(h*x)+g}}return{format:u,formatPrefix:c}}var cI,pI,fI;KO({thousands:",",grouping:[3],currency:["$",""]});function KO(t){return cI=EY(t),pI=cI.format,fI=cI.formatPrefix,cI}function XO(t){return Math.max(0,-ga(Math.abs(t)))}function YO(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(ga(e)/3)))*3-ga(Math.abs(t)))}function QO(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,ga(e)-ga(t))+1}function ZO(t,e,r,n){var o=DO(t,e,r),s;switch(n=Cp(n??",f"),n.type){case"s":{var i=Math.max(Math.abs(t),Math.abs(e));return n.precision==null&&!isNaN(s=YO(o,i))&&(n.precision=s),fI(n,i)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(s=QO(o,Math.max(Math.abs(t),Math.abs(e))))&&(n.precision=s-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(s=XO(o))&&(n.precision=s-(n.type==="%")*2);break}}return pI(n)}function JO(t){var e=t.domain;return t.ticks=function(r){var n=e();return rI(n[0],n[n.length-1],r??10)},t.tickFormat=function(r,n){var o=e();return ZO(o[0],o[o.length-1],r??10,n)},t.nice=function(r){r==null&&(r=10);var n=e(),o=0,s=n.length-1,i=n[o],a=n[s],l,u,c=10;for(a<i&&(u=i,i=a,a=u,u=o,o=s,s=u);c-- >0;){if(u=kv(i,a,r),u===l)return n[o]=i,n[s]=a,e(n);if(u>0)i=Math.floor(i/u)*u,a=Math.ceil(a/u)*u;else if(u<0)i=Math.ceil(i*u)/u,a=Math.floor(a*u)/u;else break;l=u}return t},t}function _v(){var t=GO();return t.copy=function(){return vY(t,_v())},WX.apply(t,arguments),JO(t)}function uwe(){var t=0,e=1,r,n,o,s,i=mu,a=!1,l;function u(p){return p==null||isNaN(p=+p)?l:i(o===0?.5:(p=(s(p)-r)*o,a?Math.max(0,Math.min(1,p)):p))}u.domain=function(p){return arguments.length?([t,e]=p,r=s(t=+t),n=s(e=+e),o=r===n?0:1/(n-r),u):[t,e]},u.clamp=function(p){return arguments.length?(a=!!p,u):a},u.interpolator=function(p){return arguments.length?(i=p,u):i};function c(p){return function(f){var d,m;return arguments.length?([d,m]=f,i=p(d,m),u):[i(0),i(1)]}}return u.range=c(du),u.rangeRound=c(Ev),u.unknown=function(p){return arguments.length?(l=p,u):l},function(p){return s=p,r=p(t),n=p(e),o=r===n?0:1/(n-r),u}}function cwe(t,e){return e.domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown())}function Sd(){var t=JO(uwe()(mu));return t.copy=function(){return cwe(t,Sd())},GX.apply(t,arguments)}function dr(t){for(var e=t.length/6|0,r=new Array(e),n=0;n<e;)r[n]="#"+t.slice(n*6,++n*6);return r}var Zr=t=>LO(t[t.length-1]);var _Y=new Array(3).concat("af8dc3f7f7f77fbf7b","7b3294c2a5cfa6dba0008837","7b3294c2a5cff7f7f7a6dba0008837","762a83af8dc3e7d4e8d9f0d37fbf7b1b7837","762a83af8dc3e7d4e8f7f7f7d9f0d37fbf7b1b7837","762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b7837","762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b7837","40004b762a839970abc2a5cfe7d4e8d9f0d3a6dba05aae611b783700441b","40004b762a839970abc2a5cfe7d4e8f7f7f7d9f0d3a6dba05aae611b783700441b").map(dr),eF=Zr(_Y);var AY=new Array(3).concat("e9a3c9f7f7f7a1d76a","d01c8bf1b6dab8e1864dac26","d01c8bf1b6daf7f7f7b8e1864dac26","c51b7de9a3c9fde0efe6f5d0a1d76a4d9221","c51b7de9a3c9fde0eff7f7f7e6f5d0a1d76a4d9221","c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221","c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221","8e0152c51b7dde77aef1b6dafde0efe6f5d0b8e1867fbc414d9221276419","8e0152c51b7dde77aef1b6dafde0eff7f7f7e6f5d0b8e1867fbc414d9221276419").map(dr),tF=Zr(AY);var DY=new Array(3).concat("fc8d59ffffbf91bfdb","d7191cfdae61abd9e92c7bb6","d7191cfdae61ffffbfabd9e92c7bb6","d73027fc8d59fee090e0f3f891bfdb4575b4","d73027fc8d59fee090ffffbfe0f3f891bfdb4575b4","d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4","d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4","a50026d73027f46d43fdae61fee090e0f3f8abd9e974add14575b4313695","a50026d73027f46d43fdae61fee090ffffbfe0f3f8abd9e974add14575b4313695").map(dr),rF=Zr(DY);var $Y=new Array(3).concat("fc8d59ffffbf99d594","d7191cfdae61abdda42b83ba","d7191cfdae61ffffbfabdda42b83ba","d53e4ffc8d59fee08be6f59899d5943288bd","d53e4ffc8d59fee08bffffbfe6f59899d5943288bd","d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd","d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd","9e0142d53e4ff46d43fdae61fee08be6f598abdda466c2a53288bd5e4fa2","9e0142d53e4ff46d43fdae61fee08bffffbfe6f598abdda466c2a53288bd5e4fa2").map(dr),nF=Zr($Y);var RY=new Array(3).concat("deebf79ecae13182bd","eff3ffbdd7e76baed62171b5","eff3ffbdd7e76baed63182bd08519c","eff3ffc6dbef9ecae16baed63182bd08519c","eff3ffc6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b5084594","f7fbffdeebf7c6dbef9ecae16baed64292c62171b508519c08306b").map(dr),oF=Zr(RY);var OY=new Array(3).concat("e5f5e0a1d99b31a354","edf8e9bae4b374c476238b45","edf8e9bae4b374c47631a354006d2c","edf8e9c7e9c0a1d99b74c47631a354006d2c","edf8e9c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45005a32","f7fcf5e5f5e0c7e9c0a1d99b74c47641ab5d238b45006d2c00441b").map(dr),sF=Zr(OY);var FY=new Array(3).concat("f0f0f0bdbdbd636363","f7f7f7cccccc969696525252","f7f7f7cccccc969696636363252525","f7f7f7d9d9d9bdbdbd969696636363252525","f7f7f7d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525","fffffff0f0f0d9d9d9bdbdbd969696737373525252252525000000").map(dr),iF=Zr(FY);var PY=new Array(3).concat("efedf5bcbddc756bb1","f2f0f7cbc9e29e9ac86a51a3","f2f0f7cbc9e29e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8756bb154278f","f2f0f7dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a34a1486","fcfbfdefedf5dadaebbcbddc9e9ac8807dba6a51a354278f3f007d").map(dr),aF=Zr(PY);var LY=new Array(3).concat("fee0d2fc9272de2d26","fee5d9fcae91fb6a4acb181d","fee5d9fcae91fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4ade2d26a50f15","fee5d9fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181d99000d","fff5f0fee0d2fcbba1fc9272fb6a4aef3b2ccb181da50f1567000d").map(dr),lF=Zr(LY);var MY=new Array(3).concat("fee6cefdae6be6550d","feeddefdbe85fd8d3cd94701","feeddefdbe85fd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3ce6550da63603","feeddefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d948018c2d04","fff5ebfee6cefdd0a2fdae6bfd8d3cf16913d94801a636037f2704").map(dr),uF=Zr(MY);function cF(t){return t=Math.max(0,Math.min(1,t)),"rgb("+Math.max(0,Math.min(255,Math.round(-4.54-t*(35.34-t*(2381.73-t*(6402.7-t*(7024.72-t*2710.57)))))))+", "+Math.max(0,Math.min(255,Math.round(32.49+t*(170.73+t*(52.82-t*(131.46-t*(176.58-t*67.37)))))))+", "+Math.max(0,Math.min(255,Math.round(81.24+t*(442.36-t*(2482.43-t*(6167.24-t*(6614.94-t*2475.67)))))))+")"}var pF=lI(Zs(-100,.75,.35),Zs(80,1.5,.8)),pwe=lI(Zs(260,.75,.35),Zs(80,1.5,.8)),Ftr=Zs();function dI(t){var e=t.length;return function(r){return t[Math.max(0,Math.min(e-1,Math.floor(r*e)))]}}var fF=dI(dr("44015444025645045745055946075a46085c460a5d460b5e470d60470e6147106347116447136548146748166848176948186a481a6c481b6d481c6e481d6f481f70482071482173482374482475482576482677482878482979472a7a472c7a472d7b472e7c472f7d46307e46327e46337f463480453581453781453882443983443a83443b84433d84433e85423f854240864241864142874144874045884046883f47883f48893e49893e4a893e4c8a3d4d8a3d4e8a3c4f8a3c508b3b518b3b528b3a538b3a548c39558c39568c38588c38598c375a8c375b8d365c8d365d8d355e8d355f8d34608d34618d33628d33638d32648e32658e31668e31678e31688e30698e306a8e2f6b8e2f6c8e2e6d8e2e6e8e2e6f8e2d708e2d718e2c718e2c728e2c738e2b748e2b758e2a768e2a778e2a788e29798e297a8e297b8e287c8e287d8e277e8e277f8e27808e26818e26828e26828e25838e25848e25858e24868e24878e23888e23898e238a8d228b8d228c8d228d8d218e8d218f8d21908d21918c20928c20928c20938c1f948c1f958b1f968b1f978b1f988b1f998a1f9a8a1e9b8a1e9c891e9d891f9e891f9f881fa0881fa1881fa1871fa28720a38620a48621a58521a68522a78522a88423a98324aa8325ab8225ac8226ad8127ad8128ae8029af7f2ab07f2cb17e2db27d2eb37c2fb47c31b57b32b67a34b67935b77937b87838b9773aba763bbb753dbc743fbc7340bd7242be7144bf7046c06f48c16e4ac16d4cc26c4ec36b50c46a52c56954c56856c66758c7655ac8645cc8635ec96260ca6063cb5f65cb5e67cc5c69cd5b6ccd5a6ece5870cf5773d05675d05477d1537ad1517cd2507fd34e81d34d84d44b86d54989d5488bd6468ed64590d74393d74195d84098d83e9bd93c9dd93ba0da39a2da37a5db36a8db34aadc32addc30b0dd2fb2dd2db5de2bb8de29bade28bddf26c0df25c2df23c5e021c8e020cae11fcde11dd0e11cd2e21bd5e21ad8e219dae319dde318dfe318e2e418e5e419e7e419eae51aece51befe51cf1e51df4e61ef6e620f8e621fbe723fde725")),dF=dI(dr("00000401000501010601010802010902020b02020d03030f03031204041405041606051806051a07061c08071e0907200a08220b09240c09260d0a290e0b2b100b2d110c2f120d31130d34140e36150e38160f3b180f3d19103f1a10421c10441d11471e114920114b21114e22115024125325125527125829115a2a115c2c115f2d11612f116331116533106734106936106b38106c390f6e3b0f703d0f713f0f72400f74420f75440f764510774710784910784a10794c117a4e117b4f127b51127c52137c54137d56147d57157e59157e5a167e5c167f5d177f5f187f601880621980641a80651a80671b80681c816a1c816b1d816d1d816e1e81701f81721f817320817521817621817822817922827b23827c23827e24828025828125818326818426818627818827818928818b29818c29818e2a81902a81912b81932b80942c80962c80982d80992d809b2e7f9c2e7f9e2f7fa02f7fa1307ea3307ea5317ea6317da8327daa337dab337cad347cae347bb0357bb2357bb3367ab5367ab73779b83779ba3878bc3978bd3977bf3a77c03a76c23b75c43c75c53c74c73d73c83e73ca3e72cc3f71cd4071cf4070d0416fd2426fd3436ed5446dd6456cd8456cd9466bdb476adc4869de4968df4a68e04c67e24d66e34e65e44f64e55064e75263e85362e95462ea5661eb5760ec5860ed5a5fee5b5eef5d5ef05f5ef1605df2625df2645cf3655cf4675cf4695cf56b5cf66c5cf66e5cf7705cf7725cf8745cf8765cf9785df9795df97b5dfa7d5efa7f5efa815ffb835ffb8560fb8761fc8961fc8a62fc8c63fc8e64fc9065fd9266fd9467fd9668fd9869fd9a6afd9b6bfe9d6cfe9f6dfea16efea36ffea571fea772fea973feaa74feac76feae77feb078feb27afeb47bfeb67cfeb77efeb97ffebb81febd82febf84fec185fec287fec488fec68afec88cfeca8dfecc8ffecd90fecf92fed194fed395fed597fed799fed89afdda9cfddc9efddea0fde0a1fde2a3fde3a5fde5a7fde7a9fde9aafdebacfcecaefceeb0fcf0b2fcf2b4fcf4b6fcf6b8fcf7b9fcf9bbfcfbbdfcfdbf")),mF=dI(dr("00000401000501010601010802010a02020c02020e03021004031204031405041706041907051b08051d09061f0a07220b07240c08260d08290e092b10092d110a30120a32140b34150b37160b39180c3c190c3e1b0c411c0c431e0c451f0c48210c4a230c4c240c4f260c51280b53290b552b0b572d0b592f0a5b310a5c320a5e340a5f3609613809623909633b09643d09653e0966400a67420a68440a68450a69470b6a490b6a4a0c6b4c0c6b4d0d6c4f0d6c510e6c520e6d540f6d550f6d57106e59106e5a116e5c126e5d126e5f136e61136e62146e64156e65156e67166e69166e6a176e6c186e6d186e6f196e71196e721a6e741a6e751b6e771c6d781c6d7a1d6d7c1d6d7d1e6d7f1e6c801f6c82206c84206b85216b87216b88226a8a226a8c23698d23698f24699025689225689326679526679727669827669a28659b29649d29649f2a63a02a63a22b62a32c61a52c60a62d60a82e5fa92e5eab2f5ead305dae305cb0315bb1325ab3325ab43359b63458b73557b93556ba3655bc3754bd3853bf3952c03a51c13a50c33b4fc43c4ec63d4dc73e4cc83f4bca404acb4149cc4248ce4347cf4446d04545d24644d34743d44842d54a41d74b3fd84c3ed94d3dda4e3cdb503bdd513ade5238df5337e05536e15635e25734e35933e45a31e55c30e65d2fe75e2ee8602de9612bea632aeb6429eb6628ec6726ed6925ee6a24ef6c23ef6e21f06f20f1711ff1731df2741cf3761bf37819f47918f57b17f57d15f67e14f68013f78212f78410f8850ff8870ef8890cf98b0bf98c0af98e09fa9008fa9207fa9407fb9606fb9706fb9906fb9b06fb9d07fc9f07fca108fca309fca50afca60cfca80dfcaa0ffcac11fcae12fcb014fcb216fcb418fbb61afbb81dfbba1ffbbc21fbbe23fac026fac228fac42afac62df9c72ff9c932f9cb35f8cd37f8cf3af7d13df7d340f6d543f6d746f5d949f5db4cf4dd4ff4df53f4e156f3e35af3e55df2e661f2e865f2ea69f1ec6df1ed71f1ef75f1f179f2f27df2f482f3f586f3f68af4f88ef5f992f6fa96f8fb9af9fc9dfafda1fcffa4")),hF=dI(dr("0d088710078813078916078a19068c1b068d1d068e20068f2206902406912605912805922a05932c05942e05952f059631059733059735049837049938049a3a049a3c049b3e049c3f049c41049d43039e44039e46039f48039f4903a04b03a14c02a14e02a25002a25102a35302a35502a45601a45801a45901a55b01a55c01a65e01a66001a66100a76300a76400a76600a76700a86900a86a00a86c00a86e00a86f00a87100a87201a87401a87501a87701a87801a87a02a87b02a87d03a87e03a88004a88104a78305a78405a78606a68707a68808a68a09a58b0aa58d0ba58e0ca48f0da4910ea3920fa39410a29511a19613a19814a099159f9a169f9c179e9d189d9e199da01a9ca11b9ba21d9aa31e9aa51f99a62098a72197a82296aa2395ab2494ac2694ad2793ae2892b02991b12a90b22b8fb32c8eb42e8db52f8cb6308bb7318ab83289ba3388bb3488bc3587bd3786be3885bf3984c03a83c13b82c23c81c33d80c43e7fc5407ec6417dc7427cc8437bc9447aca457acb4679cc4778cc4977cd4a76ce4b75cf4c74d04d73d14e72d24f71d35171d45270d5536fd5546ed6556dd7566cd8576bd9586ada5a6ada5b69db5c68dc5d67dd5e66de5f65de6164df6263e06363e16462e26561e26660e3685fe4695ee56a5de56b5de66c5ce76e5be76f5ae87059e97158e97257ea7457eb7556eb7655ec7754ed7953ed7a52ee7b51ef7c51ef7e50f07f4ff0804ef1814df1834cf2844bf3854bf3874af48849f48948f58b47f58c46f68d45f68f44f79044f79143f79342f89441f89540f9973ff9983ef99a3efa9b3dfa9c3cfa9e3bfb9f3afba139fba238fca338fca537fca636fca835fca934fdab33fdac33fdae32fdaf31fdb130fdb22ffdb42ffdb52efeb72dfeb82cfeba2cfebb2bfebd2afebe2afec029fdc229fdc328fdc527fdc627fdc827fdca26fdcb26fccd25fcce25fcd025fcd225fbd324fbd524fbd724fad824fada24f9dc24f9dd25f8df25f8e125f7e225f7e425f6e626f6e826f5e926f5eb27f4ed27f3ee27f3f027f2f227f1f426f1f525f0f724f0f921"));var G=rt(pt());function kd(t){if(!t||t.length<4)return 1;let e=t,r=/^#?([a-f\d])([a-f\d])([a-f\d])$/i;e=e.replace(r,(a,l,u,c)=>l+l+u+u+c+c);let n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);if(!n)return 1;let o=parseInt(n[1],16),s=parseInt(n[2],16),i=parseInt(n[3],16);return(.2126*o+.7152*s+.0722*i)/255}var dwe=_v().domain([0,.5,1]).range(["#ffffff","#ff9966","#ff6633"]).clamp(!0);function Av(t,e,r={}){let{minClamp:n=0,maxClamp:o=.7,isDiverging:s=!1,shouldApplyRangeClamp:i=!0}=r;return!s&&i?Sd(l=>t(l*(o-n)+n)).domain(e).clamp(!0):s?Sd(t).domain(e).clamp(!0):Sd(t).domain(e).clamp(!0)}function gF(t,e=0,r=.7){return n=>t(n*(r-e)+e)}var Td={claudeOranges:dwe,viridis:fF,plasma:hF,inferno:gF(mF),magma:gF(dF),cividis:cF,gray:gF(iF,.1,.9),coolwarm:pF,rdylbu:rF,piyg:tF,prgn:eF,spectral:nF,blues:oF,greens:sF,reds:lF,oranges:uF,purples:aF},mI=["coolwarm","rdylbu","piyg","prgn","spectral"];function mwe(t,e,r,n=null){if(!t.length||!t[0]?.length)return[];let o=t.length,s=t[0].length,i=[],a=n??0;for(let l=0;l<s;l++){let u=-1/0,c=0,p=0;for(let f=0;f<o;f++){let d=t[f]?.[l]??0;d>u&&(u=d),c+=Math.abs(d),Math.abs(d)>a&&(p+=1)}i.push({index:r?r[l]:l,label:e[l]??`Feature ${l}`,score:0,maxActivation:u,meanAbsActivation:c/o,nonZeroCount:p})}return i}function hwe(t,e){return[...t].sort((r,n)=>{let o=0,s=0;switch(e){case"l1":o=r.meanAbsActivation,s=n.meanAbsActivation;break;case"l0":o=r.nonZeroCount,s=n.nonZeroCount;break;case"max":default:o=r.maxActivation,s=n.maxActivation;break}return s-o})}function hI(t,e,r,n,o,s){if(!e[t])return[];let i=e[0]?.length??0,a=[];for(let l=0;l<i;l++){let u=e[t][l]??0;(s===null||Math.abs(u)>=s)&&a.push({index:n?n[l]:l,label:r[l]??`Feature ${l}`,activation:u})}return a.sort((l,u)=>Math.abs(u.activation)-Math.abs(l.activation)).slice(0,o)}var Jr={light:{bg:"#ffffff",text:"#000000",border:"#ccc",containerBg:"#f9f9f9",selectedItemBg:"#e0e8ff",selectedItemBorder:"#4a90e2",hoverOutline:"#cccccc",subtleBorder:"#eee",dimText:"#555",closeButton:"#aaa",boxHoverBg:"#f0f0f0"},dark:{bg:"#1e1e1e",text:"#e0e0e0",border:"#555",containerBg:"#2a2a2a",selectedItemBg:"#3a4a7e",selectedItemBorder:"#6a90e2",hoverOutline:"#777777",subtleBorder:"#444",dimText:"#aaa",closeButton:"#ccc",boxHoverBg:"#333333"},"claude-brown":{bg:"hsl(30, 40%, 96%)",text:"hsl(30, 30%, 20%)",border:"hsl(30, 20%, 70%)",containerBg:"hsl(30, 30%, 90%)",selectedItemBg:"hsl(30, 50%, 80%)",selectedItemBorder:"hsl(30, 70%, 50%)",hoverOutline:"hsl(30, 30%, 60%)",subtleBorder:"hsl(30, 25%, 85%)",dimText:"hsl(30, 20%, 40%)",closeButton:"hsl(30, 25%, 50%)",boxHoverBg:"hsl(30, 35%, 92%)"}},gwe=(t,e)=>{let r=Jr[t]??Jr.light;return{container:{fontFamily:"sans-serif",padding:"10px",border:`1px solid ${r.border}`,borderRadius:"5px",position:"relative",backgroundColor:r.bg,color:r.text},controls:{marginBottom:"10px",display:"flex",gap:"15px",alignItems:"center",flexWrap:"wrap",flexShrink:0},featureSearch:{marginBottom:"10px"},featureListContainer:{marginBottom:"15px",maxHeight:"200px",overflowY:"auto",border:`1px solid ${r.subtleBorder}`,backgroundColor:r.containerBg},featureListItem:{padding:"5px 8px",cursor:"pointer",borderBottom:`1px solid ${r.subtleBorder}`,fontSize:"0.9em",display:"flex",justifyContent:"space-between"},featureListItemHover:{outline:`1px solid ${r.hoverOutline}`},featureListItemSelected:{backgroundColor:r.selectedItemBg,fontWeight:"bold",borderLeft:`3px solid ${r.selectedItemBorder}`,color:r.text},featureScore:{color:r.dimText,fontSize:"0.9em"},selectedFeaturesContainer:{marginTop:"15px",marginBottom:"15px",padding:"10px",border:`1px solid ${r.border}`,borderRadius:"4px",maxHeight:"200px",overflowY:"auto",flexShrink:0},selectedFeatureInfoBox:{border:`1px solid ${r.border}`,borderRadius:"3px",padding:"8px",marginBottom:"8px",backgroundColor:r.bg,position:"relative",fontSize:"0.9em",transition:"background-color 0.1s ease-in-out"},featureValueIndicator:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:"auto",minWidth:"2.5em",height:"1.5em",marginLeft:"5px",border:`1px solid ${r.border}`,borderRadius:"3px",verticalAlign:"middle",padding:"0 4px",fontSize:"0.85em",overflow:"hidden",whiteSpace:"nowrap"},selectedTokensContainer:{marginTop:"15px",marginBottom:"5px",padding:"10px",border:`1px solid ${r.border}`,borderRadius:"4px",maxHeight:"200px",overflowY:"auto",flexShrink:0},selectedTokensContainerCompactWrap:{display:"flex",flexWrap:"wrap",gap:"5px"},selectedTokenInfoBox:{border:`1px solid ${r.border}`,borderRadius:"3px",padding:"8px",marginBottom:"8px",backgroundColor:r.bg,position:"relative",fontSize:"0.9em",transition:"background-color 0.1s ease-in-out"},selectedTokenInfoBoxCompactTile:{border:`1px solid ${r.border}`,borderRadius:"3px",padding:"2px 5px",backgroundColor:r.bg,fontSize:"0.85em",display:"inline-flex",alignItems:"center",gap:"4px",whiteSpace:"nowrap"},selectedItemCloseButton:{position:"absolute",top:"2px",right:"5px",background:"none",border:"none",color:r.closeButton,cursor:"pointer",fontSize:"1.2em",padding:"0",lineHeight:"1"},tokenSequence:{display:"flex",flexWrap:"wrap",gap:"0",lineHeight:1.2,border:`1px solid ${r.subtleBorder}`,padding:"5px",marginTop:"10px",flexShrink:0,letterSpacing:"normal"},token:{padding:"0",margin:"-1px -1px 0 -1px",borderRadius:"2px",cursor:"pointer",whiteSpace:"pre",border:"1px solid transparent",transition:"outline 0.1s ease-in-out, background-color 0.1s ease-in-out",letterSpacing:"0.08em",display:"inline-block",position:"relative",verticalAlign:"middle",lineHeight:1.2,overflow:"visible"},tokenTextOverlay:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",alignItems:"center",justifyContent:"center",padding:"2px 0px",zIndex:1,pointerEvents:"none",width:"100%",height:"100%",letterSpacing:"0.08em"},tokenHover:{outline:`1px solid ${r.hoverOutline}`,outlineOffset:"0px"},tokenClicked:{outline:`2px solid ${r.selectedItemBorder}`,outlineOffset:"-1px",textDecoration:"underline",textUnderlineOffset:"2px"},tooltip:{position:"absolute",backgroundColor:t==="light"?"rgba(0, 0, 0, 0.85)":"rgba(40, 40, 40, 0.9)",color:t==="light"?"white":"#e0e0e0",padding:"8px 10px",borderRadius:"4px",fontSize:"0.85em",zIndex:10,maxWidth:"350px",pointerEvents:"none",boxShadow:"0 2px 5px rgba(0,0,0,0.2)"},tooltipSticky:{pointerEvents:"auto"},tooltipCloseButton:{position:"absolute",top:"2px",right:"5px",background:"none",border:"none",color:t==="light"?"#ccc":"#aaa",cursor:"pointer",fontSize:"1.2em",padding:"0",lineHeight:"1"},tooltipFeature:{padding:"2px 0",cursor:"pointer"},tooltipFeatureHover:{textDecoration:"underline"},inputGroup:{display:"flex",alignItems:"center",gap:"5px"},compactButton:{padding:"2px 6px",fontSize:"0.8em"},featureGrid:{display:"flex",flexWrap:"wrap",gap:"3px",padding:"5px"},featureTile:{padding:"1px 2px",fontSize:"0.85em",border:`1px solid ${r.border}`,borderRadius:"3px",cursor:"pointer",textAlign:"center",whiteSpace:"nowrap",minWidth:"2.5em"},featureTileHover:{outline:`1px solid ${r.hoverOutline}`},featureTileSelected:{backgroundColor:r.selectedItemBg,fontWeight:"bold",borderColor:r.selectedItemBorder,color:r.text},mainContentArea:{display:"flex",flexDirection:"column"},featureListIndexValue:{fontWeight:"bold",marginRight:"5px"},featureListDescription:{color:r.dimText},dynamicInfoLabel:{fontStyle:"italic",marginRight:"5px"}}},xwe=t=>{switch(t){case"l1":return"L1";case"l0":return"L0";case"max":default:return"Max"}},ywe=({tokens:t,featureActivations:e,featureLabels:r,featureIDs:n,numTopFeaturesPerToken:o=5,numTopFeaturesOverall:s=20,initialRankingMetric:i="max",activationThreshold:a=null,colorMap:l="reds",colorMidpoint:u})=>{let[c,p]=(0,G.useState)(i),[f,d]=(0,G.useState)(a),[m,h]=(0,G.useState)(null),[g,x]=(0,G.useState)(null),[y,b]=(0,G.useState)(null),[v,C]=(0,G.useState)([]),[S,k]=(0,G.useState)(""),[N,D]=(0,G.useState)(s),[$,O]=(0,G.useState)(o),[V,K]=(0,G.useState)(null),[X,W]=(0,G.useState)(null),[H,Y]=(0,G.useState)(u??null),[Z,Q]=(0,G.useState)("200px"),[se,ne]=(0,G.useState)("200px"),[re,ue]=(0,G.useState)(null),[ae,le]=(0,G.useState)([]),[me,ke]=(0,G.useState)(null),[ve,Te]=(0,G.useState)(!1),[Ve,qe]=(0,G.useState)("claude-brown"),[R,q]=(0,G.useState)("claudeOranges"),[P,ie]=(0,G.useState)(!1),[pe,fe]=(0,G.useState)(!0),[Se,at]=(0,G.useState)(!1),[We,Mt]=(0,G.useState)("200px"),mt=(0,G.useRef)(null),he=(0,G.useMemo)(()=>gwe(Ve,pe),[Ve,pe]),st=Jr[Ve]??Jr.light,ht=(0,G.useMemo)(()=>{let j=new Map;if(n)n.forEach((de,Ie)=>{j.set(de,Ie)});else if(e.length>0&&e[0]){let de=e[0].length;for(let Ie=0;Ie<de;Ie++)j.set(Ie,Ie)}return j},[n,e]),vo=(0,G.useMemo)(()=>mwe(e,r,n,f),[e,r,n,f]),_r=(0,G.useMemo)(()=>{let j=vo.map(de=>{let Ie=0;switch(c){case"l1":Ie=de.meanAbsActivation;break;case"l0":Ie=de.nonZeroCount;break;case"max":default:Ie=de.maxActivation;break}return{...de,score:Ie}});return hwe(j,c)},[vo,c]),gn=(0,G.useMemo)(()=>{let j=S.toLowerCase().trim();return j?_r.filter(de=>de.label.toLowerCase().includes(j)||String(de.index).includes(j)):_r},[_r,S]),xa=(0,G.useMemo)(()=>gn.slice(0,N),[gn,N]),Js=g??(ae.length===1?ae[0]:m),cx=ve&&ae.length>=2,xI=!ve&&ae.length>=1,Sp=(0,G.useMemo)(()=>ae.map(j=>_r.find(de=>de.index===j)).filter(j=>j!==void 0),[ae,_r]),Nd=(0,G.useMemo)(()=>{let j=ht.get(Js??-1);if(j===void 0||!e[0])return{min:0,max:0};let de=e.map(Ie=>Ie[j]??0);return{min:Math.min(...de),max:Math.max(...de)}},[Js,e,ht]),Dv=(0,G.useMemo)(()=>{let j=ht.get(Js??-1);if(j===void 0||!e[0])return()=>he.container.backgroundColor||"#ffffff";let de=e.map(en=>en[j]??0),Ie=Math.min(...de),Ke=Math.max(...de),Ft=V!==null&&V!==""?parseFloat(V):Ie,or=X!==null&&X!==""?parseFloat(X):Ke,Qe=Number.isNaN(Ft)?Ie:Ft,bt=Number.isNaN(or)?Ke:or,qt=R.toLowerCase();pe&&(qt="claudeOranges");let hr=Td[qt]??Td.reds;if(Td[qt]||console.warn(`Color map "${qt}" not supported, using Reds.`),mI.includes(qt)){let en=(Qe+bt)/2;if(H!==null&&H!==""){let gu=parseFloat(H);Number.isNaN(gu)||(en=gu)}let ei=[Qe===en&&Qe===bt?Qe-.001:Qe,en,bt===en&&bt===Qe?bt+.001:bt];return Av(hr,ei,{isDiverging:!0})}let Pt=Qe,Wr=Qe===bt?bt+1e-5:bt;return Av(hr,[Pt,Wr],{minClamp:0,maxClamp:.7,isDiverging:!1})},[Js,R,V,X,H,e,he.container.backgroundColor,pe,ht]),Di=(0,G.useMemo)(()=>{let j={};if(!e[0])return j;let de=e[0].length,Ie=R.toLowerCase(),Ke=Td[Ie]??Td.reds,Ft=mI.includes(Ie);for(let or=0;or<de;or++){let Qe=e.map(Wr=>Wr[or]??0),bt=Math.min(...Qe),mr=Math.max(...Qe),qt=V!==null&&V!==""?parseFloat(V):bt,hr=X!==null&&X!==""?parseFloat(X):mr,gt=Number.isNaN(qt)?bt:qt,Pt=Number.isNaN(hr)?mr:hr;if(Ft){let Wr=(gt+Pt)/2;if(H!==null&&H!==""){let ei=parseFloat(H);Number.isNaN(ei)||(Wr=ei)}let en=[gt===Wr&&gt===Pt?gt-.001:gt,Wr,Pt===Wr&&Pt===gt?Pt+.001:Pt];j[or]=Av(Ke,en,{isDiverging:!0})}else{let Wr=gt,en=gt===Pt?Pt+1e-5:Pt;j[or]=Av(Ke,[Wr,en],{minClamp:0,maxClamp:.7,isDiverging:!1})}}return j},[e,R,V,X,H,Td,mI,Av]),CF=(0,G.useCallback)((j,de)=>{if(x(j),Se){let Ie=_r.find(Ke=>Ke.index===j);if(Ie&&(!re||!re.isClick||re.index!==j)){let Ke=mt.current?.getBoundingClientRect(),Ft={x:de.clientX-(Ke?.left??0)+15,y:de.clientY-(Ke?.top??0)+15};ue({...Ie,isClick:!1,position:Ft})}}},[Se,_r,re,mt]),SF=(0,G.useCallback)(()=>{x(null),Se&&re&&!re.isClick&&ue(null)},[Se,re]),kF=(0,G.useCallback)((j,de)=>{if(le(Ie=>Ie.includes(j)?Ie.filter(Ke=>Ke!==j):[...Ie,j]),le(Ie=>(Ie.length===1?h(Ie[0]):h(null),Ie)),Se){let Ie=_r.find(Ke=>Ke.index===j);if(!Ie)return;if(re?.index===j&&re.isClick)ue(null);else{let Ke=mt.current?.getBoundingClientRect(),Ft={x:de.clientX-(Ke?.left??0)+15,y:de.clientY-(Ke?.top??0)+15};ue({...Ie,isClick:!0,position:Ft})}}},[Se,_r,re,mt]),XY=(0,G.useCallback)((j,de)=>{if(ke(j),v.includes(j)){let qt=hI(j,e,r,n,$,f),hr=ht.get(m??-1),gt=hr!==void 0?e[j]?.[hr]??null:null,Pt=mt.current?.getBoundingClientRect(),Wr=mt.current?.scrollLeft??0,en=mt.current?.scrollTop??0,ei={x:de.clientX-(Pt?.left??0)+Wr+15,y:de.clientY-(Pt?.top??0)+en+15};b({tokenIndex:j,topFeatures:qt,selectedFeatureValue:gt,position:ei});return}let Ie=hI(j,e,r,n,$,f),Ke=ht.get(m??-1),Ft=Ke!==void 0?e[j]?.[Ke]??null:null,or=mt.current?.getBoundingClientRect(),Qe=mt.current?.scrollLeft??0,bt=mt.current?.scrollTop??0,mr={x:de.clientX-(or?.left??0)+Qe+15,y:de.clientY-(or?.top??0)+bt+15};b({tokenIndex:j,topFeatures:Ie,selectedFeatureValue:Ft,position:mr})},[e,r,n,$,f,m,v,ht]),YY=(0,G.useCallback)(()=>{ke(null),b(null)},[]),QY=(0,G.useCallback)(j=>{C(de=>de.includes(j)?de.filter(Ie=>Ie!==j):[...de,j]),b(null)},[]),TF=j=>{if(le(de=>de.includes(j)?de.filter(Ie=>Ie!==j):[...de,j]),le(de=>(de.length===1?h(de[0]):h(null),de)),Se&&re?.isClick){let de=_r.find(Ie=>Ie.index===j);de&&ue({...de,isClick:!0,position:re.position})}},yI=(0,G.useCallback)(j=>{C(de=>de.filter(Ie=>Ie!==j)),b(null)},[]),NF=(0,G.useCallback)(j=>{le(de=>de.filter(Ie=>Ie!==j)),le(de=>(de.length===1?h(de[0]):de.length===0&&h(null),de))},[]),ZY=(0,G.useCallback)(()=>{ue(null)},[]),bI=(j,de)=>{(de===""||de==="-"||!Number.isNaN(parseFloat(de)))&&j(de)},JY=(0,G.useCallback)(()=>{K(null),W(null),h(null),C([]),ue(null),b(null),le([]),ke(null),Te(!1),q(l),ie(!1),qe("claude-brown"),fe(!0),Y(u??null)},[l,u]),eQ=(0,G.useCallback)(()=>{at(j=>!j),ue(null),x(null)},[]),tQ=(0,G.useCallback)(()=>{Q(j=>j==="200px"?"500px":"200px")},[]),rQ=(0,G.useCallback)(j=>{Te(j.target.checked)},[]),nQ=(0,G.useCallback)(()=>{qe(j=>j==="light"?"dark":"light"),fe(!1)},[]),oQ=(0,G.useCallback)(()=>{qe("claude-brown"),q("claudeOranges"),fe(!0)},[]),sQ=(0,G.useCallback)(()=>{ie(j=>!j)},[]),iQ=(0,G.useMemo)(()=>Object.keys(Td).filter(j=>j!=="claudeOranges"),[]),aQ=(0,G.useCallback)(()=>{ne(j=>j==="200px"?"500px":"200px")},[]),lQ=(0,G.useCallback)(()=>{Mt(j=>j==="200px"?"500px":"200px")},[]),Id=(0,G.useCallback)((j,de)=>{if(j===null)return"N/A";let Ie=ht.get(j);return Ie===void 0?"N/A":(e[de]?.[Ie]??0).toPrecision(3)},[ht,e]),Ed=(0,G.useCallback)((j,de)=>{if(j===null)return st.bg;let Ie=ht.get(j);if(Ie===void 0)return st.bg;let Ke=e[de]?.[Ie]??0,Ft=Di[Ie];return Ft?Ft(Ke):st.bg},[ht,e,Di,st.bg]),vI=(0,G.useCallback)(j=>kd(j)>.5?Jr.light.text:Jr.dark.text,[Jr.light.text,Jr.dark.text]);if(!t||!e)return G.default.createElement("div",{style:he.container},"Loading or no data...");let uQ=j=>v.includes(j);return G.default.createElement("div",{style:{...he.container},ref:mt},G.default.createElement("div",{style:he.controls},G.default.createElement("div",null,G.default.createElement("label",null,"Rank by: "),G.default.createElement("select",{value:c,onChange:j=>p(j.target.value)},G.default.createElement("option",{value:"max"},"Max Activation"),G.default.createElement("option",{value:"l1"},"Mean Abs Activation (L1)"),G.default.createElement("option",{value:"l0"},"Non-Zero Count (L0)"))),G.default.createElement("div",null,G.default.createElement("label",null,"Threshold: "),G.default.createElement("input",{type:"number",step:"any",placeholder:"None",value:f===null?"":f,onChange:j=>d(j.target.value===""?null:parseFloat(j.target.value)),style:{width:"60px"},title:"Activation threshold for L0 ranking and token tooltips"})),G.default.createElement("div",{style:he.inputGroup},G.default.createElement("label",null,"Min Color: "),G.default.createElement("input",{type:"number",step:"any",placeholder:Nd.min.toPrecision(3),value:V??"",onChange:j=>bI(K,j.target.value),style:{width:"60px"},title:"Minimum value for color scale (leave blank for auto)"})),G.default.createElement("div",{style:he.inputGroup},G.default.createElement("label",null,"Max Color: "),G.default.createElement("input",{type:"number",step:"any",placeholder:Nd.max.toPrecision(3),value:X??"",onChange:j=>bI(W,j.target.value),style:{width:"60px"},title:"Maximum value for color scale (leave blank for auto)"})),mI.includes(R.toLowerCase())&&G.default.createElement("div",{style:he.inputGroup},G.default.createElement("label",null,"Midpoint: "),G.default.createElement("input",{type:"number",step:"any",placeholder:`(${(Nd.min+Nd.max)/2})`,value:H??"",onChange:j=>bI(Y,j.target.value),style:{width:"60px"},title:"Midpoint for diverging color scale (leave blank for auto)"})),G.default.createElement("div",{style:he.inputGroup},G.default.createElement("button",{onClick:JY,title:"Reset color bounds, selected features, and selected tokens"},"Reset All")),G.default.createElement("div",null,G.default.createElement("label",null,"Top Overall: "),G.default.createElement("input",{type:"number",min:"1",step:"1",value:N,onChange:j=>D(parseInt(j.target.value,10)),style:{width:"50px"}})),G.default.createElement("div",null,G.default.createElement("label",null,"Top Per Token: "),G.default.createElement("input",{type:"number",min:"1",step:"1",value:$,onChange:j=>O(parseInt(j.target.value,10)),style:{width:"50px"}})),G.default.createElement("div",{style:he.inputGroup},G.default.createElement("input",{type:"checkbox",id:"multiColorCheckbox",checked:ve,onChange:rQ,disabled:ae.length<2,title:ae.length<2?"Select 2 or more features to enable":"Color tokens based on activations of all selected features"}),G.default.createElement("label",{htmlFor:"multiColorCheckbox"},"Multi-Color Tokens")),G.default.createElement("div",null,G.default.createElement("label",null,"Color Map: "),G.default.createElement("select",{value:R,onChange:j=>{q(j.target.value),fe(!1)},title:"Select color map for activations"},iQ.map(j=>G.default.createElement("option",{key:j,value:j},j)))),G.default.createElement("button",{onClick:nQ,title:`Switch to ${Ve==="light"?"Dark":"Light"} Mode`},Ve==="light"?"Dark Mode":"Light Mode"),G.default.createElement("button",{onClick:oQ,title:"Activate Claude Mode Theme",style:{opacity:.7}},"\u2728"),G.default.createElement("button",{onClick:eQ,style:{...he.compactButton,marginLeft:"auto"},title:Se?"Show Full Labels":"Show Compact View"},Se?"Expand View":"Compact View")),G.default.createElement("div",{style:{display:"flex",justifyContent:"flex-start",alignItems:"center",marginBottom:"5px",flexWrap:"wrap",gap:"10px"}},G.default.createElement("div",{style:{...he.featureSearch,marginRight:"auto"}}," ",G.default.createElement("label",null,"Search Features: "),G.default.createElement("input",{type:"text",placeholder:"Index or Label...",value:S,onChange:j=>k(j.target.value),style:{width:"200px",padding:"4px"}})),G.default.createElement("div",{style:{display:"flex",gap:"5px",alignItems:"center",marginLeft:"10px"}},G.default.createElement("button",{onClick:tQ,style:he.compactButton,title:Z==="200px"?"Expand Feature List":"Collapse Feature List"},Z==="200px"?"Expand":"Collapse"))),G.default.createElement("div",{style:{...he.featureListContainer,maxHeight:Z}},G.default.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"baseline",paddingRight:"8px",paddingTop:"10px",paddingLeft:"5px",paddingBottom:"10px",position:"sticky",top:0,backgroundColor:st.containerBg,zIndex:5,boxShadow:"0 2px 4px rgba(0,0,0,0.05)",isolation:"isolate",backdropFilter:"blur(2px)"}},G.default.createElement("strong",null,"Top ",xa.length," Features (",gn.length," Total) (Ranked by"," ",xwe(c),S?", Filtered":"","):"),!Se&&G.default.createElement("span",{style:{fontSize:"0.8em",color:st.dimText,whiteSpace:"nowrap"}},"Value ")),Se?G.default.createElement("div",{style:he.featureGrid},xa.map(j=>{let de=`Index: ${j.index}
Max: ${j.maxActivation.toFixed(3)}, L1: ${j.meanAbsActivation.toFixed(3)}, L0: ${j.nonZeroCount}
${j.label}`,Ie=ae.includes(j.index),Ke=g===j.index;return G.default.createElement("div",{key:j.index,style:{...he.featureTile,...Ke?he.featureTileHover:{},...Ie?he.featureTileSelected:{}},onMouseEnter:Ft=>CF(j.index,Ft),onMouseLeave:SF,onClick:Ft=>kF(j.index,Ft),title:de},j.index," ")})):G.default.createElement("div",null,xa.map(j=>{let de=j.index,Ie=me!==null?ht.get(de):void 0,Ke=me!==null&&Ie!==void 0?e[me]?.[Ie]??0:null,Ft=ht.get(j.index),or=Ft!==void 0&&Di?Di[Ft]:null,Qe=Ke!==null&&or?or(Ke):st.bg,bt=st.text;Ke!==null&&(bt=kd(Qe)>.5?Jr.light.text:Jr.dark.text);let mr=Ke?.toPrecision(3)??"N/A",qt=Ke!==null?`Activation at Token ${me}: ${Ke.toPrecision(4)}`:"Hover over a token to see value";return G.default.createElement("div",{key:j.index,style:{...he.featureListItem,...g===j.index?he.featureListItemHover:{},...ae.includes(j.index)?he.featureListItemSelected:{}},onMouseEnter:hr=>CF(j.index,hr),onMouseLeave:SF,onClick:hr=>kF(j.index,hr),title:`Feature ${j.index}: ${j.label}
Max: ${j.maxActivation.toPrecision(3)}, L1: ${j.meanAbsActivation.toPrecision(3)}, L0: ${j.nonZeroCount}`},G.default.createElement("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",marginRight:"10px"}},G.default.createElement("strong",null,"Feature ",j.index,":")," ",j.label,G.default.createElement("span",{style:{fontSize:"0.85em",color:he.featureScore.color,marginLeft:"5px"}},"(Max: ",j.maxActivation.toPrecision(3),", L1:"," ",j.meanAbsActivation.toPrecision(3),", L0:"," ",j.nonZeroCount,")")),G.default.createElement("div",{style:{display:"flex",alignItems:"center",marginLeft:"auto",flexShrink:0}},G.default.createElement("span",{style:{...he.featureValueIndicator,backgroundColor:Qe,color:bt},title:qt},mr)))})),gn.length>N&&G.default.createElement("div",{style:{textAlign:"center",padding:"5px",fontSize:"0.8em",color:"#555"}},"Showing ",N," of ",gn.length," ","features."),gn.length===0&&S&&G.default.createElement("div",{style:{textAlign:"center",padding:"5px",fontSize:"0.9em",color:"#777"}},"No features match search term.")),Sp.length>0&&G.default.createElement("div",{style:{...he.selectedFeaturesContainer,maxHeight:se,position:"relative"}},G.default.createElement("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"5px",position:"sticky",top:0,backgroundColor:st.containerBg,zIndex:5,paddingBottom:"3px",paddingTop:"3px",borderBottom:`1px solid ${st.subtleBorder}`,width:"100%",boxShadow:"0 2px 4px rgba(0,0,0,0.05)",isolation:"isolate"}},G.default.createElement("strong",null,"Selected Features:"),G.default.createElement("button",{onClick:aQ,style:he.compactButton,title:se==="200px"?"Expand Selected Features":"Collapse Selected Features"},se==="200px"?"Expand":"Collapse")),G.default.createElement("div",{style:{paddingTop:"10px"}}," ",Sp.map(j=>{let de=ht.get(j.index),Ie=me!==null&&de!==void 0?e[me]?.[de]??0:null,Ke=de!==void 0&&Di?Di[de]:null,Ft=Ie!==null&&Ke?Ke(Ie):st.bg,or=st.text;Ie!==null&&(or=kd(Ft)>.5?Jr.light.text:Jr.dark.text);let Qe=Ie?.toPrecision(3)??"N/A",bt=me!==null&&de!==void 0&&e[me]?.[de]!==void 0;if(Se)return G.default.createElement("div",{key:j.index,onMouseEnter:()=>x(j.index),onMouseLeave:()=>x(null),style:{...he.selectedFeatureInfoBox,display:"flex",justifyContent:"space-between",alignItems:"center",padding:"4px 8px"}},G.default.createElement("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",marginRight:"10px"},title:j.label},G.default.createElement("strong",null,"Feature ",j.index,":")," ",j.label,G.default.createElement("span",{style:{fontSize:"0.85em",color:he.featureScore.color,marginLeft:"5px",whiteSpace:"nowrap"},title:`Max: ${j.maxActivation.toPrecision(3)}, L1: ${j.meanAbsActivation.toPrecision(3)}, L0: ${j.nonZeroCount}`},"(Max: ",j.maxActivation.toPrecision(3),", L1:"," ",j.meanAbsActivation.toPrecision(3),", L0:"," ",j.nonZeroCount,")")),G.default.createElement("div",{style:{display:"flex",alignItems:"center",gap:"5px",marginLeft:"auto",flexShrink:0}},G.default.createElement("span",{style:{...he.featureValueIndicator,backgroundColor:Ft,color:or},title:`Activation at hovered token: ${Qe}`},Qe),G.default.createElement("button",{onClick:()=>NF(j.index),style:{...he.selectedItemCloseButton,position:"static",fontSize:"1.1em",padding:"0 3px"},title:"Deselect Feature"},"\xD7")));let mr={backgroundColor:bt?st.boxHoverBg:st.bg};return G.default.createElement("div",{key:j.index,style:{...he.selectedFeatureInfoBox,...mr},onMouseEnter:()=>x(j.index),onMouseLeave:()=>x(null)},G.default.createElement("button",{onClick:()=>NF(j.index),style:he.selectedItemCloseButton,title:"Deselect Feature"},"\xD7"),G.default.createElement("div",null,G.default.createElement("strong",null,"Feature ",j.index,":")," ",j.label," - ",G.default.createElement("span",{style:{fontSize:"0.9em",color:he.featureScore.color}},"(Max: ",j.maxActivation.toPrecision(3),", L1:"," ",j.meanAbsActivation.toPrecision(3),", L0:"," ",j.nonZeroCount,")")),G.default.createElement("div",{style:{marginTop:"3px"}},G.default.createElement("span",{style:he.dynamicInfoLabel},"Value at Token "),me!==null?G.default.createElement("span",{style:{fontWeight:"bold"}},t[me]):"?",":",G.default.createElement("span",{style:{...he.featureValueIndicator,backgroundColor:Ft,color:or},title:`Activation: ${Qe}`},Qe)))}))),v.length>0&&G.default.createElement("div",{style:{...he.selectedTokensContainer,maxHeight:We,position:"relative",...Se&&!P?he.selectedTokensContainerCompactWrap:{}}},G.default.createElement("div",{style:{display:"flex",gap:"10px",justifyContent:"space-between",alignItems:"center",marginBottom:"5px",position:"sticky",top:0,backgroundColor:st.containerBg,zIndex:5,paddingBottom:"3px",paddingTop:"3px",borderBottom:`1px solid ${st.subtleBorder}`,width:"100%",boxShadow:"0 2px 4px rgba(0,0,0,0.05)",isolation:"isolate",backdropFilter:"blur(2px)"}},G.default.createElement("strong",null,"Selected Tokens:"),G.default.createElement("div",{style:{display:"flex",gap:"5px"}},!(Se&&!P)&&G.default.createElement("button",{onClick:sQ,style:he.compactButton,title:P?"Hide Top Features list":"Show Top Features list"},P?"Hide Top Features":"Show Top Features"),G.default.createElement("button",{onClick:lQ,style:he.compactButton,title:We==="200px"?"Expand Selected Tokens":"Collapse Selected Tokens"},We==="200px"?"Expand":"Collapse"))),G.default.createElement("div",{style:{paddingTop:"10px"}}," ",v.map(j=>{let de=m,Ie=de!==null?ht.get(de):void 0,Ke=null;Ie!==void 0&&j<e.length?Ke=e[j]?.[Ie]??0:de!==null&&(console.warn(`[SaeVis] Could not find array index for selected feature ID: ${de}.`),Ke=null);let Ft=Ie!==void 0&&Di?Di[Ie]:null,or=Ke!==null&&Ft?Ft(Ke):st.bg,Qe=st.text;Ke!==null&&(Qe=kd(or)>.5?Jr.light.text:Jr.dark.text);let bt=Ke!==null?Ke.toPrecision(3):"N/A",mr=ht.get(g??-1),qt=mr!==void 0&&e[j]?.[mr]!==void 0,hr={...he.selectedTokenInfoBox,backgroundColor:qt?st.boxHoverBg:st.bg};return Se&&!P?G.default.createElement("div",{key:j,style:he.selectedTokenInfoBoxCompactTile},G.default.createElement("span",null,G.default.createElement("strong",null,"T",j,":"),' "',t[j].substring(0,10),'"',t[j].length>10?"...":""),g!==null&&G.default.createElement("span",{style:{...he.featureValueIndicator,padding:"0 2px",height:"1.3em",minWidth:"2em",fontSize:"0.8em",backgroundColor:Ed(g,j),color:vI(Ed(g,j))},title:`Feature ${g}: ${Id(g,j)}`},Id(g,j)),g===null&&m!==null&&G.default.createElement("span",{style:{...he.featureValueIndicator,padding:"0 2px",height:"1.3em",minWidth:"2em",fontSize:"0.8em",backgroundColor:or,color:Qe},title:`Feature ${de??"?"}: ${bt}`},bt),g===null&&m===null&&G.default.createElement("span",{style:{...he.featureValueIndicator,padding:"0 2px",height:"1.3em",minWidth:"2em",fontSize:"0.8em"}},"N/A"),G.default.createElement("button",{onClick:()=>yI(j),style:{...he.selectedItemCloseButton,position:"static",fontSize:"1em",padding:"0 2px"},title:"Deselect Token"},"\xD7")):Se?G.default.createElement("div",{key:j,style:hr},G.default.createElement("button",{onClick:()=>yI(j),style:he.selectedItemCloseButton,title:"Deselect Token"},"\xD7"),G.default.createElement("strong",null,"Token ",j,': "',t[j],'"'),G.default.createElement("div",{style:{marginTop:"5px",paddingTop:"5px",borderTop:`1px dashed ${he.container.borderColor}`}},g!==null&&G.default.createElement(G.default.Fragment,null,G.default.createElement("span",{style:he.dynamicInfoLabel},"Feature ",g,":"," "),G.default.createElement("span",{style:{...he.featureValueIndicator,backgroundColor:Ed(g,j),color:vI(Ed(g,j))},title:`Value: ${Id(g,j)}`},Id(g,j))),g===null&&m!==null&&G.default.createElement(G.default.Fragment,null,G.default.createElement("span",{style:he.dynamicInfoLabel},"Feature ",de??"?",":"," "),G.default.createElement("span",{style:{...he.featureValueIndicator,backgroundColor:or,color:Qe},title:`Value: ${bt}`},bt)),g===null&&m===null&&G.default.createElement("span",{style:he.dynamicInfoLabel},"Hover over a feature to see values"))):G.default.createElement("div",{key:j,style:hr},G.default.createElement("button",{onClick:()=>yI(j),style:he.selectedItemCloseButton,title:"Deselect Token"},"\xD7"),G.default.createElement("strong",null,"Token ",j,': "',t[j],'"'),G.default.createElement("div",{style:{marginTop:"3px"}},g!==null&&G.default.createElement(G.default.Fragment,null,G.default.createElement("span",{style:he.dynamicInfoLabel},"Feature ",g,":"," "),G.default.createElement("span",{style:{...he.featureValueIndicator,backgroundColor:Ed(g,j),color:vI(Ed(g,j))},title:`Value: ${Id(g,j)}`},Id(g,j))),g===null&&m!==null&&G.default.createElement(G.default.Fragment,null,G.default.createElement("span",{style:he.dynamicInfoLabel},"Feature ",de??"?",":"," "),G.default.createElement("span",{style:{...he.featureValueIndicator,backgroundColor:or,color:Qe},title:`Value: ${bt}`},bt)),g===null&&m===null&&G.default.createElement("span",{style:he.dynamicInfoLabel},"Hover over a feature to see values")),P&&G.default.createElement("div",{style:{marginTop:"5px",paddingTop:"5px",borderTop:`1px dashed ${he.container.borderColor}`},title:`Showing top ${$} features with abs activation >= ${f??0}`},G.default.createElement("strong",null,"Top Features:"),hI(j,e,r,n,$,f).length===0&&G.default.createElement("div",null,"(None above threshold)"),hI(j,e,r,n,$,f).map(gt=>G.default.createElement("div",{key:gt.index},G.default.createElement("span",{style:he.featureListIndexValue},`Feature ${gt.index}: ${gt.activation.toFixed(3)}`)," ",G.default.createElement("span",{style:{...he.featureListDescription,cursor:"pointer"},className:"feature-list-item-clickable",onClick:()=>TF(gt.index),onMouseEnter:Pt=>{Pt.target.style.textDecoration="underline"},onMouseLeave:Pt=>{Pt.target.style.textDecoration="none"},title:`Select Feature ${gt.index} for coloring/multi-select`},"- ",gt.label.substring(0,60),gt.label.length>60?"...":"")))))}))),G.default.createElement("div",{style:he.tokenSequence},t.map((j,de)=>{let Ie=me===de,Ke=uQ(de),Ft=cx,or=xI,Qe={...he.token},bt=j;if(g!==null){let mr=ht.get(g??-1);if(mr!==void 0){let qt=e[de]?.[mr]??0,gt=Dv(qt),Pt=kd(gt)>.5?Jr.light.text:Jr.dark.text,Wr=f!==null&&qt!==0&&Math.abs(qt)<f;Qe={...Qe,backgroundColor:gt,color:Pt,opacity:Wr?.5:1}}else console.warn("Could not find array index for hovered feature:",g)}else if(Ft){let qt=100/ae.length,hr=ae.map(gt=>{let Pt=ht.get(gt);if(Pt===void 0)return console.warn("Could not find array index for selected feature:",gt),null;let Wr=e[de]?.[Pt]??0,en=Di[Pt],ei=en?en(Wr):"transparent",gu={height:`${qt}%`,width:"100%",backgroundColor:ei};return G.default.createElement("div",{key:gt,style:gu})});Qe={...Qe,display:"inline",position:"relative",backgroundColor:"transparent",color:st.text},bt=G.default.createElement("span",{style:{position:"relative",display:"inline-block",verticalAlign:"bottom"}},G.default.createElement("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",flexDirection:"column",zIndex:0}},hr),G.default.createElement("span",{style:{...he.tokenTextOverlay,position:"relative"}},typeof j=="string"?j.replace(/\n/g,"\u21B5"):""))}else if(or){let mr=ae.reduce((Wr,en)=>{let ei=ht.get(en);if(ei===void 0)return console.warn("Could not find array index for selected feature:",en),Wr;let gu=e[de]?.[ei]??0;return Math.abs(gu)>Wr.maxAbs?{index:en,value:gu,maxAbs:Math.abs(gu)}:Wr},{index:-1,value:0,maxAbs:-1/0}),qt=ht.get(mr.index??-1),hr=qt!==void 0?Di[qt]:null,gt=hr?hr(mr.value):"transparent",Pt=kd(gt)>.5?Jr.light.text:Jr.dark.text;Qe={...Qe,backgroundColor:gt,color:Pt}}else{let mr=ht.get(Js??-1);if(mr!==void 0){let qt=e[de]?.[mr]??0,hr=Js!==null?Dv(qt):he.container.backgroundColor||"transparent",gt=kd(hr)>.5?Jr.light.text:Jr.dark.text,Pt=Js!==null&&f!==null&&qt!==0&&Math.abs(qt)<f;Qe={...Qe,backgroundColor:hr,color:gt,opacity:Pt?.5:1}}else Qe={...Qe,backgroundColor:he.container.backgroundColor||"transparent",color:st.text}}return Ie&&!Ke&&(Qe={...Qe,...he.tokenHover}),Ke&&(Qe={...Qe,...he.tokenClicked}),G.default.createElement("span",{key:de,style:Qe,onMouseEnter:mr=>XY(de,mr),onMouseLeave:YY,onClick:()=>QY(de),title:j.includes(`
`)?j.replace(/\n/g,"\u21B5"):void 0},typeof bt=="string"?bt.replace(/\n/g,"\u21B5"):bt)})),y&&G.default.createElement("div",{style:{...he.tooltip,left:`${y.position.x}px`,top:`${y.position.y}px`}},G.default.createElement("strong",null,"Token ",y.tokenIndex,': "',t[y.tokenIndex],'"'),y.selectedFeatureValue!==null&&G.default.createElement("div",{style:{marginTop:"5px",borderTop:"1px dashed #ccc",paddingTop:"5px"}},"Selected Feature ",m,":"," ",y.selectedFeatureValue.toPrecision(3)),G.default.createElement("br",null),G.default.createElement("strong",{title:`Showing top ${$} features with abs activation >= ${f??0}`},"Top Features:"),y.topFeatures.length===0&&G.default.createElement("div",null,"(None above threshold)"),y.topFeatures.map(j=>G.default.createElement("div",{key:j.index},G.default.createElement("span",{style:he.featureListIndexValue},`Feature ${j.index}: ${j.activation.toFixed(3)}`),G.default.createElement("span",{style:{...he.featureListDescription,cursor:"pointer"},className:"feature-list-item-clickable",onClick:()=>TF(j.index),onMouseEnter:de=>{de.target.style.textDecoration="underline"},onMouseLeave:de=>{de.target.style.textDecoration="none"},title:`Select Feature ${j.index} for coloring/multi-select`},"- ",j.label.substring(0,60),j.label.length>60?"...":"")))),Se&&re&&G.default.createElement("div",{style:{...he.tooltip,position:"absolute",left:`${re.position.x}px`,top:`${re.position.y}px`,...re.isClick?he.tooltipSticky:{}}},re.isClick&&G.default.createElement("button",{onClick:ZY,style:he.tooltipCloseButton,title:"Close Feature Info"},"\xD7"),G.default.createElement("strong",null,"Feature ",re.index),G.default.createElement("div",{style:{marginTop:"5px"}},G.default.createElement("strong",null,"Label:")," ",re.label),G.default.createElement("div",{style:{marginTop:"5px",paddingTop:"5px",borderTop:"1px dashed #ccc"}},G.default.createElement("strong",null,"Stats:"),G.default.createElement("div",null,"Max: ",re.maxActivation.toPrecision(3)),G.default.createElement("div",null,"L1: ",re.meanAbsActivation.toPrecision(3)),G.default.createElement("div",null,"L0: ",re.nonZeroCount))))};var zY=rt(pt());function bwe({name:t}){return zY.default.createElement("p",null,"Hello, ",t,"!")}var vr=rt(pt());var hu=rt(pt());function gI({token:t,value:e,min:r,max:n,negativeColor:o,positiveColor:s,tooltip:i=hu.default.createElement(hu.default.Fragment,null,"Intentionally Left Blank")}){let{getTooltipProps:a,setTooltipRef:l,setTriggerRef:u,visible:c}=Mg({followCursor:!0}),p=up(e,r,n,o,s).toRgbString(),f=ur(p).brightness()<.6?"white":"black",d={display:"inline-block",backgroundColor:p,color:f,lineHeight:"1em",padding:"3px 0",marginLeft:-1,marginBottom:1,borderWidth:1,borderStyle:"solid",borderColor:"#eee"},m=Xb(t),h=t.match(/\n/g);return hu.default.createElement(hu.default.Fragment,null,hu.default.createElement("span",{ref:u},hu.default.createElement("span",{style:d,dangerouslySetInnerHTML:{__html:m}}),h?.map((g,x)=>hu.default.createElement("br",{key:x}))),c&&hu.default.createElement("div",{ref:l,...a({style:{background:"#eee",color:"black",textAlign:"center",padding:10,borderRadius:5,boxShadow:"5px 5px rgba(0, 0, 0, 0.03)",marginTop:15}})},i))}kk([ZT,JT]);var xF=5;function BY(t,e="blue",r=-xF){return ur(e).mix(ur("grey"),Math.min(-t/-r,1))}function yF({token:t}){return vr.default.createElement("span",{style:{borderColor:"green",borderWidth:1,borderStyle:"solid"},dangerouslySetInnerHTML:{__html:Xb(t)}})}function VY({token:t,logProb:e,rank:r,isCorrectToken:n}){let o={color:"orange",backgroundColor:BY(e).toRgbString(),fontWeight:"bold"},s={color:"white",backgroundColor:BY(e).toRgbString()};return vr.default.createElement("tr",{style:n?o:s},vr.default.createElement("td",null,"#",r),vr.default.createElement("td",null,(Math.exp(e)*100).toFixed(2),"%"),vr.default.createElement("td",null,e.toFixed(3)),vr.default.createElement("td",null,vr.default.createElement(yF,{token:t})))}function vwe({currentCorrectToken:t,currentCorrectTokenRank:e,currentCorrectTokenLogProb:r,currentTopKLogProbs:n,currentTopKTokens:o,prevToken:s}){return vr.default.createElement("div",null,vr.default.createElement("div",{style:{fontSize:20,fontWeight:"bold",backgroundColor:"white",color:"black"}},vr.default.createElement(yF,{token:s})," -",">"," ",vr.default.createElement(yF,{token:t})),vr.default.createElement("table",null,vr.default.createElement("tr",null,vr.default.createElement("th",null,"Rank"),vr.default.createElement("th",null,"Prob"),vr.default.createElement("th",null,"Log Prob"),vr.default.createElement("th",null,"String")),vr.default.createElement(VY,{token:t,logProb:r,rank:e,isCorrectToken:!0}),vr.default.createElement("hr",null),o.map((i,a)=>vr.default.createElement(VY,{key:a,token:o[a],logProb:n[a],rank:a,isCorrectToken:e===a}))))}function wwe({prompt:t,topKLogProbs:e,topKTokens:r,correctTokenRank:n,correctTokenLogProb:o}){return vr.default.createElement("div",{style:{paddingBottom:350}},t.slice(1).map((s,i)=>vr.default.createElement(gI,{key:i,token:s,value:Math.max(xF+o[i],0),min:-.1,max:xF,positiveColor:"red",tooltip:vr.default.createElement(vwe,{currentCorrectToken:s,currentCorrectTokenRank:n[i],currentCorrectTokenLogProb:o[i],currentTopKLogProbs:e[i],currentTopKTokens:r[i],prevToken:t[i]})})))}var UY=rt(pt()),HY=rt(GY());function Cwe(t,e,r={}){let n=document.querySelector(`#${t}`),o=HY.default.createRoot(n),s=UY.default.createElement(e,r);o.render(s)}var Ht=rt(pt());var vF=rt(pt());function qY({maxValue:t,minValue:e,negativeColor:r,positiveColor:n,tokens:o,values:s,tooltips:i}){let a=e??Math.min(...s),l=t??Math.max(...s);return vF.default.createElement("div",{className:"colored-tokens",style:{paddingBottom:30}},o.map((u,c)=>vF.default.createElement(gI,{key:c,token:u,value:s[c],min:a,max:l,negativeColor:r,positiveColor:n,tooltip:i[c]})))}var wF=6;function Swe({values:t,labels:e,selectedValue:r,setSelectedValue:n}){let o=t.shape[1],{focused:s,onClick:i,onMouseEnter:a,onMouseLeave:l}=hd();(0,Ht.useEffect)(()=>{s!==null&&n(s)},[s,n]);let u=[];for(let c=0;c<o;c++){let p=c===r,f=e[c];u.push(Ht.default.createElement("div",{key:c,style:{display:"inline-block",padding:"0 5px",backgroundColor:p?"black":"white",color:p?"white":"black",cursor:"pointer"},onClick:()=>i(c),onMouseEnter:()=>a(c),onMouseLeave:l},f))}return Ht.default.createElement("div",null,u)}function jY({value:t,setValue:e,defaultValue:r,label:n}){return Ht.default.createElement("div",null,Ht.default.createElement("label",{htmlFor:n},n,":")," ",Ht.default.createElement("input",{type:"text",id:"number",value:t,onChange:i=>{e(parseFloat(i.target.value))}}),r&&Ht.default.createElement("button",{type:"button",onClick:()=>{e(r)}},"Reset"))}function kwe({title:t,labels:e,values:r,tokenIndex:n,currentValueIndex:o}){let s=r.shape[1],i=[];for(let a=0;a<s;a++)i.push(Ht.default.createElement("tr",{key:a},Ht.default.createElement("td",{style:{fontWeight:"bold"}},e[a]),Ht.default.createElement("td",{style:{textAlign:"right",fontWeight:o===a?"bold":"normal"}},r.bufferSync().get(n,a).toFixed(wF))));return Ht.default.createElement(Ht.default.Fragment,null,Ht.default.createElement("div",{style:{fontWeight:"bold",fontSize:16,backgroundColor:"white"}},t),Ht.default.createElement("table",null,Ht.default.createElement("tbody",null,i)))}function Twe({tokens:t,values:e,labels:r,positiveBounds:n,negativeBounds:o}){let s=Cr(e),i=s.shape[1],a=n?Cr(n):s.max(0).maximum(1e-7),l=o?Cr(o):s.min(0).minimum(-1e-7),u=r||Array.from(Array(i).keys()).map((b,v)=>`${v}`),[c,p]=(0,Ht.useState)(0),f=Number(a.arraySync()[c].toFixed(wF)),d=Number(l.arraySync()[c].toFixed(wF)),[m,h]=(0,Ht.useState)(Number(f)),[g,x]=(0,Ht.useState)(Number(d)),y=s.slice([0,c],[-1,1]).squeeze([1]);return Ht.default.createElement("div",{style:{paddingBottom:20*i}},Ht.default.createElement(Swe,{values:s,labels:u,selectedValue:c,setSelectedValue:p}),Ht.default.createElement(jY,{value:m,setValue:h,defaultValue:f,label:"Positive Bound"}),Ht.default.createElement(jY,{value:g,setValue:x,defaultValue:d,label:"Negative Bound"}),Ht.default.createElement("br",null),Ht.default.createElement(qY,{tokens:t,values:y.arraySync(),maxValue:m,minValue:g,tooltips:y.arraySync().map((b,v)=>Ht.default.createElement(kwe,{key:v,title:t[v],labels:u,values:s,tokenIndex:v,currentValueIndex:c}))}))}var Dt=rt(pt()),Gn=rt(Bf());function Nwe({tokens:t,activations:e,zerothDimensionName:r="Layer",firstDimensionName:n="Neuron",zerothDimensionLabels:o,firstDimensionLabels:s}){let i=e.length,a=e[0].length,l=e[0][0].length,[u,c]=(0,Dt.useState)(Math.min(5,l)),[p,f]=(0,Dt.useState)([...Array(u).keys()]),[d,m]=(0,Dt.useState)(0),[h,g]=(0,Dt.useState)(0);(0,Dt.useEffect)(()=>{f([...Array(u).keys()])},[u]);let x=p.map(S=>e[d][h][S]),y=p.map(S=>t[d][h][S]),[b,v]=Qb(e[d][h]),C={paddingTop:5,paddingBottom:5};return Dt.default.createElement(Gn.Container,{fluid:!0},Dt.default.createElement(Gn.Row,null,Dt.default.createElement(Gn.Col,null,Dt.default.createElement(Gn.Row,{style:C},Dt.default.createElement(Gn.Col,null,Dt.default.createElement("label",{htmlFor:"layer-selector",style:{marginRight:15}},r,":"),Dt.default.createElement(us,{id:"layer-selector",largestNumber:i-1,currentValue:d,setCurrentValue:m,labels:o}))),Dt.default.createElement(Gn.Row,{style:C},Dt.default.createElement(Gn.Col,null,Dt.default.createElement("label",{htmlFor:"neuron-selector",style:{marginRight:15}},n,":"),Dt.default.createElement(us,{id:"neuron-selector",largestNumber:a-1,currentValue:h,setCurrentValue:g,labels:s}))),l>1&&Dt.default.createElement(Gn.Row,{style:C},Dt.default.createElement(Gn.Col,null,Dt.default.createElement("label",{htmlFor:"sample-selector",style:{marginRight:15}},"Samples (descending):"),Dt.default.createElement(Vg,{id:"sample-selector",largestNumber:l-1,currentRangeArr:p,setCurrentValue:f,numValsInRange:u})))),Dt.default.createElement(Gn.Col,null,l>1&&Dt.default.createElement(Gn.Row,{style:C},Dt.default.createElement(Gn.Col,null,Dt.default.createElement("label",{htmlFor:"samples-per-page-selector",style:{marginRight:15}},"Samples per page:"),Dt.default.createElement(us,{id:"samples-per-page-selector",smallestNumber:1,largestNumber:l,currentValue:u,setCurrentValue:c}))))),Dt.default.createElement(Gn.Row,null,Dt.default.createElement(Gn.Col,null,Dt.default.createElement(tN,{activationsList:x,tokensList:y,minValue:b,maxValue:v}))))}var De=rt(pt()),hn=rt(Bf());function KY({tdKey:t,token:e,value:r,minValue:n,maxValue:o,negativeColor:s,positiveColor:i}){let{getTooltipProps:a,setTooltipRef:l,setTriggerRef:u,visible:c}=Mg({followCursor:!0}),p=up(r,n,o,s,i).toRgbString(),f=ur(p).brightness()<.6?"white":"black",m=e.replace(/\s/g,"&nbsp;").replace(/\n/g,"\xB6");return De.default.createElement("td",{key:t,style:{backgroundColor:p,borderWidth:1,borderStyle:"solid",borderColor:"black"}},De.default.createElement("span",{ref:u,style:{display:"block",color:f},dangerouslySetInnerHTML:{__html:m}}),c&&De.default.createElement("div",{ref:l,...a({style:{background:"#333",color:"white",textAlign:"center",padding:10,borderRadius:5,boxShadow:"5px 5px rgba(0, 0, 0, 0.03)",marginTop:15,zIndex:1}})},De.default.createElement("strong",null,e),De.default.createElement("br",null),r))}function Iwe({topkActivations:t,bottomkActivations:e,topkTokens:r,bottomkTokens:n,neuronNumbers:o,filter:s,colLabel:i}){return De.default.createElement("table",{style:{marginTop:15,marginLeft:15}},De.default.createElement("thead",null,De.default.createElement("tr",null,De.default.createElement("th",{colSpan:o.length+1,style:{textAlign:"center",paddingLeft:"9ch"}},i)),De.default.createElement("tr",null,De.default.createElement("th",{key:"default",style:{textAlign:"center"}}),o.map(a=>De.default.createElement("th",{key:a,style:{textAlign:"center"}},a)))),De.default.createElement("tbody",null,s.includes("topk")&&t.map((a,l)=>De.default.createElement("tr",{key:l},l===0&&De.default.createElement("td",{key:"default",style:{textAlign:"center",fontWeight:"bold"},rowSpan:t.length},"Topk \u2193"),a.map((u,c)=>De.default.createElement(KY,{key:c,tdKey:c,token:r[l][c],value:u,minValue:0,maxValue:1})))),s==="topk+bottomk"&&De.default.createElement("tr",null,De.default.createElement("td",{key:"default",style:{textAlign:"center"}}),Array(t[0].length).fill(0).map((a,l)=>De.default.createElement("td",{key:l},De.default.createElement("div",{style:{textAlign:"center"}},"...")))),s.includes("bottomk")&&e.map((a,l)=>De.default.createElement("tr",{key:l},l===0&&De.default.createElement("td",{key:"default",style:{textAlign:"center",fontWeight:"bold"},rowSpan:e.length},"Bottomk \u2193"),a.map((u,c)=>De.default.createElement(KY,{key:c,tdKey:c,token:n[l][c],value:u,minValue:0,maxValue:1}))))))}function Ewe({tokens:t,topkVals:e,topkIdxs:r,bottomkVals:n,bottomkIdxs:o,firstDimensionName:s="Layer",thirdDimensionName:i="Neuron",sampleLabels:a,firstDimensionLabels:l}){let u=e.length,c=e[0].length,p=e[0][0].length,f=e[0][0][0].length,[d,m]=(0,De.useState)(0),[h,g]=(0,De.useState)(0),[x,y]=(0,De.useState)(5),[b,v]=(0,De.useState)(p),[C,S]=(0,De.useState)([...Array(x).keys()]),[k,N]=(0,De.useState)("topk+bottomk");(0,De.useEffect)(()=>{S(u>1?[...Array(x).keys()]:[0])},[x,u]);let D=t[d],$=[[0,b],[C[0],C[C.length-1]+1]],O=Yb(e[d][h],$),V=Yb(r[d][h],$),K=Yb(n[d][h],$),X=Yb(o[d][h],$),W=V.map(Z=>Z.map(Q=>D[Q])),H=X.map(Z=>Z.map(Q=>D[Q])),Y={paddingTop:5,paddingBottom:5};return De.default.createElement("div",null,De.default.createElement(hn.Container,{fluid:!0},De.default.createElement(hn.Row,null,De.default.createElement(hn.Col,null,De.default.createElement(hn.Row,{style:Y},De.default.createElement(hn.Col,null,De.default.createElement("label",{htmlFor:"sample-selector",style:{marginRight:15}},"Sample:"),De.default.createElement(us,{id:"sample-selector",smallestNumber:0,largestNumber:u-1,currentValue:d,setCurrentValue:m,labels:a}))),De.default.createElement(hn.Row,{style:Y},De.default.createElement(hn.Col,null,De.default.createElement("label",{htmlFor:"layer-selector",style:{marginRight:15}},s,":"),De.default.createElement(us,{id:"layer-selector",largestNumber:c-1,currentValue:h,setCurrentValue:g,labels:l}))),De.default.createElement(hn.Row,{style:Y},De.default.createElement(hn.Col,null,De.default.createElement("label",{htmlFor:"neuron-selector",style:{marginRight:15}},i,":"),De.default.createElement(Vg,{id:"neuron-selector",largestNumber:f-1,currentRangeArr:C,setCurrentValue:S,numValsInRange:x})))),De.default.createElement(hn.Col,null,De.default.createElement(hn.Row,{style:Y},De.default.createElement(hn.Col,null,De.default.createElement("label",{htmlFor:"filter-select",style:{marginRight:15}},"Filter:"),De.default.createElement("select",{value:k,onChange:Z=>N(Z.target.value),id:"filter-select"},De.default.createElement("option",{value:void 0},"topk+bottomk"),De.default.createElement("option",{value:"topk"},"topk"),De.default.createElement("option",{value:"bottomk"},"bottomk")))),De.default.createElement(hn.Row,{style:Y},De.default.createElement(hn.Col,null,De.default.createElement("label",{htmlFor:"visibleCols-selector",style:{marginRight:15}},i,"s to show:"),De.default.createElement(us,{id:"visible-cols-selector",smallestNumber:1,largestNumber:f,currentValue:x,setCurrentValue:y}))),De.default.createElement(hn.Row,{style:Y},De.default.createElement(hn.Col,null,De.default.createElement("label",{htmlFor:"k-selector",style:{marginRight:15}},"k:"),De.default.createElement(us,{id:"k-selector",smallestNumber:1,largestNumber:p,currentValue:b,setCurrentValue:v})))))),De.default.createElement(Iwe,{topkActivations:O,bottomkActivations:K,topkTokens:W,bottomkTokens:H,neuronNumbers:C,filter:k,colLabel:i}))}export{D1e as AttentionHeads,YN as AttentionPattern,F1e as AttentionPatterns,eN as ColoredTokens,Twe as ColoredTokensMulti,bwe as Hello,ywe as SaeVis,y0e as TextNeuronActivations,wwe as TokenLogProbs,Nwe as TopkSamples,Ewe as TopkTokens,Cwe as render};
//# sourceMappingURL=esm.js.map
